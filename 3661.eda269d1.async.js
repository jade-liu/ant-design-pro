(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[3661],{64335:function(ur,L,x){"use strict";var J=x(67294),E=(0,J.createContext)({});L.Z=E},21349:function(ur,L,x){"use strict";var J=x(84305),E=x(69224),p=x(17781),w=x.n(p),F=x(67294),Q=x(94184),Y=x.n(Q),le=x(64335),ne=function(we){var Ie=(0,F.useContext)(le.Z),$t=we.children,Zt=we.contentWidth,Xt=we.className,Ft=we.style,Lt=(0,F.useContext)(E.ZP.ConfigContext),_t=Lt.getPrefixCls,pt=we.prefixCls||_t("pro"),Cr=Zt||Ie.contentWidth,Gt="".concat(pt,"-grid-content");return F.createElement("div",{className:Y()(Gt,Xt,{wide:Cr==="Fixed"}),style:Ft},F.createElement("div",{className:"".concat(pt,"-grid-content-children")},$t))};L.Z=ne},46343:function(ur,L,x){"use strict";x.d(L,{zj:function(){return dt},oI:function(){return ln},ni:function(){return ae},gg:function(){return Fr}});var J=x(34155);/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function E(tr,se,ge,Re){function tt(Mt){return Mt instanceof ge?Mt:new ge(function(Dt){Dt(Mt)})}return new(ge||(ge=Promise))(function(Mt,Dt){function S(Ue){try{pe(Re.next(Ue))}catch(Je){Dt(Je)}}function z(Ue){try{pe(Re.throw(Ue))}catch(Je){Dt(Je)}}function pe(Ue){Ue.done?Mt(Ue.value):tt(Ue.value).then(S,z)}pe((Re=Re.apply(tr,se||[])).next())})}function p(tr,se){var ge={label:0,sent:function(){if(Mt[0]&1)throw Mt[1];return Mt[1]},trys:[],ops:[]},Re,tt,Mt,Dt;return Dt={next:S(0),throw:S(1),return:S(2)},typeof Symbol=="function"&&(Dt[Symbol.iterator]=function(){return this}),Dt;function S(pe){return function(Ue){return z([pe,Ue])}}function z(pe){if(Re)throw new TypeError("Generator is already executing.");for(;ge;)try{if(Re=1,tt&&(Mt=pe[0]&2?tt.return:pe[0]?tt.throw||((Mt=tt.return)&&Mt.call(tt),0):tt.next)&&!(Mt=Mt.call(tt,pe[1])).done)return Mt;switch(tt=0,Mt&&(pe=[pe[0]&2,Mt.value]),pe[0]){case 0:case 1:Mt=pe;break;case 4:return ge.label++,{value:pe[1],done:!1};case 5:ge.label++,tt=pe[1],pe=[0];continue;case 7:pe=ge.ops.pop(),ge.trys.pop();continue;default:if(Mt=ge.trys,!(Mt=Mt.length>0&&Mt[Mt.length-1])&&(pe[0]===6||pe[0]===2)){ge=0;continue}if(pe[0]===3&&(!Mt||pe[1]>Mt[0]&&pe[1]<Mt[3])){ge.label=pe[1];break}if(pe[0]===6&&ge.label<Mt[1]){ge.label=Mt[1],Mt=pe;break}if(Mt&&ge.label<Mt[2]){ge.label=Mt[2],ge.ops.push(pe);break}Mt[2]&&ge.ops.pop(),ge.trys.pop();continue}pe=se.call(tr,ge)}catch(Ue){pe=[6,Ue],tt=0}finally{Re=Mt=0}if(pe[0]&5)throw pe[1];return{value:pe[0]?pe[1]:void 0,done:!0}}}function w(tr,se){var ge=typeof Symbol=="function"&&tr[Symbol.iterator];if(!ge)return tr;var Re=ge.call(tr),tt,Mt=[],Dt;try{for(;(se===void 0||se-- >0)&&!(tt=Re.next()).done;)Mt.push(tt.value)}catch(S){Dt={error:S}}finally{try{tt&&!tt.done&&(ge=Re.return)&&ge.call(Re)}finally{if(Dt)throw Dt.error}}return Mt}function F(){for(var tr=[],se=0;se<arguments.length;se++)tr=tr.concat(w(arguments[se]));return tr}function Q(tr){return tr&&tr.__esModule&&Object.prototype.hasOwnProperty.call(tr,"default")?tr.default:tr}function Y(tr,se){return se={exports:{}},tr(se,se.exports),se.exports}var le=Y(function(tr,se){Object.defineProperty(se,"__esModule",{value:!0}),se.default=ge;function ge(Re){return Re&&typeof Re.length=="number"&&Re.length>=0&&Re.length%1==0}tr.exports=se.default});Q(le);var ne=Y(function(tr,se){Object.defineProperty(se,"__esModule",{value:!0}),se.default=function(ge){return function(){for(var Re=[],tt=arguments.length;tt--;)Re[tt]=arguments[tt];var Mt=Re.pop();return ge.call(this,Re,Mt)}},tr.exports=se.default});Q(ne);var be=Y(function(tr,se){Object.defineProperty(se,"__esModule",{value:!0}),se.fallback=tt,se.wrap=Mt;var ge=se.hasSetImmediate=typeof setImmediate=="function"&&setImmediate,Re=se.hasNextTick=typeof J=="object"&&typeof J.nextTick=="function";function tt(S){setTimeout(S,0)}function Mt(S){return function(z){for(var pe=[],Ue=arguments.length-1;Ue-- >0;)pe[Ue]=arguments[Ue+1];return S(function(){return z.apply(void 0,pe)})}}var Dt;ge?Dt=setImmediate:Re?Dt=J.nextTick:Dt=tt,se.default=Mt(Dt)});Q(be);var we=be.fallback,Ie=be.wrap,$t=be.hasSetImmediate,Zt=be.hasNextTick,Xt=Y(function(tr,se){Object.defineProperty(se,"__esModule",{value:!0}),se.default=Mt;var ge=tt(ne),Re=tt(be);function tt(z){return z&&z.__esModule?z:{default:z}}function Mt(z){return(0,Ft.isAsync)(z)?function(){for(var pe=[],Ue=arguments.length;Ue--;)pe[Ue]=arguments[Ue];var Je=pe.pop(),mt=z.apply(this,pe);return Dt(mt,Je)}:(0,ge.default)(function(pe,Ue){var Je;try{Je=z.apply(this,pe)}catch(mt){return Ue(mt)}if(Je&&typeof Je.then=="function")return Dt(Je,Ue);Ue(null,Je)})}function Dt(z,pe){return z.then(function(Ue){S(pe,null,Ue)},function(Ue){S(pe,Ue&&Ue.message?Ue:new Error(Ue))})}function S(z,pe,Ue){try{z(pe,Ue)}catch(Je){(0,Re.default)(function(mt){throw mt},Je)}}tr.exports=se.default});Q(Xt);var Ft=Y(function(tr,se){Object.defineProperty(se,"__esModule",{value:!0}),se.isAsyncIterable=se.isAsyncGenerator=se.isAsync=void 0;var ge=Re(Xt);function Re(z){return z&&z.__esModule?z:{default:z}}function tt(z){return z[Symbol.toStringTag]==="AsyncFunction"}function Mt(z){return z[Symbol.toStringTag]==="AsyncGenerator"}function Dt(z){return typeof z[Symbol.asyncIterator]=="function"}function S(z){if(typeof z!="function")throw new Error("expected a function");return tt(z)?(0,ge.default)(z):z}se.default=S,se.isAsync=tt,se.isAsyncGenerator=Mt,se.isAsyncIterable=Dt});Q(Ft);var Lt=Ft.isAsyncIterable,_t=Ft.isAsyncGenerator,pt=Ft.isAsync,Cr=Y(function(tr,se){Object.defineProperty(se,"__esModule",{value:!0}),se.default=ge;function ge(Re,tt){if(tt===void 0&&(tt=Re.length),!tt)throw new Error("arity is undefined");function Mt(){for(var Dt=this,S=[],z=arguments.length;z--;)S[z]=arguments[z];return typeof S[tt-1]=="function"?Re.apply(this,S):new Promise(function(pe,Ue){S[tt-1]=function(Je){for(var mt=[],Ct=arguments.length-1;Ct-- >0;)mt[Ct]=arguments[Ct+1];if(Je)return Ue(Je);pe(mt.length>1?mt:mt[0])},Re.apply(Dt,S)})}return Object.defineProperty(Mt,"name",{configurable:!0,value:"awaitable("+Re.name+")"}),Mt}tr.exports=se.default});Q(Cr);var Gt=Y(function(tr,se){Object.defineProperty(se,"__esModule",{value:!0});var ge=Mt(le),Re=Mt(Ft),tt=Mt(Cr);function Mt(Dt){return Dt&&Dt.__esModule?Dt:{default:Dt}}se.default=(0,tt.default)(function(Dt,S,z){var pe=(0,ge.default)(S)?[]:{};Dt(S,function(Ue,Je,mt){(0,Re.default)(Ue)(function(Ct){for(var H,Ht=[],Vt=arguments.length-1;Vt-- >0;)Ht[Vt]=arguments[Vt+1];Ht.length<2&&(H=Ht,Ht=H[0]),pe[Je]=Ht,mt(Ct)})},function(Ue){return z(Ue,pe)})},3),tr.exports=se.default});Q(Gt);var ar=Y(function(tr,se){Object.defineProperty(se,"__esModule",{value:!0}),se.default=ge;function ge(Re){function tt(){for(var Mt=[],Dt=arguments.length;Dt--;)Mt[Dt]=arguments[Dt];if(Re!==null){var S=Re;Re=null,S.apply(this,Mt)}}return Object.assign(tt,Re),tt}tr.exports=se.default});Q(ar);var gt=Y(function(tr,se){Object.defineProperty(se,"__esModule",{value:!0}),se.default=function(ge){return ge[Symbol.iterator]&&ge[Symbol.iterator]()},tr.exports=se.default});Q(gt);var Ye=Y(function(tr,se){Object.defineProperty(se,"__esModule",{value:!0}),se.default=z;var ge=tt(le),Re=tt(gt);function tt(pe){return pe&&pe.__esModule?pe:{default:pe}}function Mt(pe){var Ue=-1,Je=pe.length;return function(){return++Ue<Je?{value:pe[Ue],key:Ue}:null}}function Dt(pe){var Ue=-1;return function(){var mt=pe.next();return mt.done?null:(Ue++,{value:mt.value,key:Ue})}}function S(pe){var Ue=pe?Object.keys(pe):[],Je=-1,mt=Ue.length;return function(){var H=Ue[++Je];return Je<mt?{value:pe[H],key:H}:null}}function z(pe){if((0,ge.default)(pe))return Mt(pe);var Ue=(0,Re.default)(pe);return Ue?Dt(Ue):S(pe)}tr.exports=se.default});Q(Ye);var Et=Y(function(tr,se){Object.defineProperty(se,"__esModule",{value:!0}),se.default=ge;function ge(Re){return function(){for(var tt=[],Mt=arguments.length;Mt--;)tt[Mt]=arguments[Mt];if(Re===null)throw new Error("Callback was already called.");var Dt=Re;Re=null,Dt.apply(this,tt)}}tr.exports=se.default});Q(Et);var Ne=Y(function(tr,se){Object.defineProperty(se,"__esModule",{value:!0});var ge={};se.default=ge,tr.exports=se.default});Q(Ne);var Ae=Y(function(tr,se){Object.defineProperty(se,"__esModule",{value:!0}),se.default=tt;var ge=Re(Ne);function Re(Mt){return Mt&&Mt.__esModule?Mt:{default:Mt}}function tt(Mt,Dt,S,z){var pe=!1,Ue=!1,Je=!1,mt=0,Ct=0;function H(){mt>=Dt||Je||pe||(Je=!0,Mt.next().then(function(_r){var Er=_r.value,Ar=_r.done;if(!(Ue||pe)){if(Je=!1,Ar){pe=!0,mt<=0&&z(null);return}mt++,S(Er,Ct,Ht),Ct++,H()}}).catch(Vt))}function Ht(_r,Er){if(mt-=1,!Ue){if(_r)return Vt(_r);if(_r===!1){pe=!0,Ue=!0;return}if(Er===ge.default||pe&&mt<=0)return pe=!0,z(null);H()}}function Vt(_r){Ue||(Je=!1,pe=!0,z(_r))}H()}tr.exports=se.default});Q(Ae);var Be=Y(function(tr,se){Object.defineProperty(se,"__esModule",{value:!0});var ge=S(ar),Re=S(Ye),tt=S(Et),Mt=S(Ae),Dt=S(Ne);function S(z){return z&&z.__esModule?z:{default:z}}se.default=function(z){return function(pe,Ue,Je){if(Je=(0,ge.default)(Je),z<=0)throw new RangeError("concurrency limit cannot be less than 1");if(!pe)return Je(null);if((0,Ft.isAsyncGenerator)(pe))return(0,Mt.default)(pe,z,Ue,Je);if((0,Ft.isAsyncIterable)(pe))return(0,Mt.default)(pe[Symbol.asyncIterator](),z,Ue,Je);var mt=(0,Re.default)(pe),Ct=!1,H=!1,Ht=0,Vt=!1;function _r(Ar,Pr){if(!H)if(Ht-=1,Ar)Ct=!0,Je(Ar);else if(Ar===!1)Ct=!0,H=!0;else{if(Pr===Dt.default||Ct&&Ht<=0)return Ct=!0,Je(null);Vt||Er()}}function Er(){for(Vt=!0;Ht<z&&!Ct;){var Ar=mt();if(Ar===null){Ct=!0,Ht<=0&&Je(null);return}Ht+=1,Ue(Ar.value,Ar.key,(0,tt.default)(_r))}Vt=!1}Er()}},tr.exports=se.default});Q(Be);var bt=Y(function(tr,se){Object.defineProperty(se,"__esModule",{value:!0});var ge=Mt(Be),Re=Mt(Ft),tt=Mt(Cr);function Mt(S){return S&&S.__esModule?S:{default:S}}function Dt(S,z,pe,Ue){return(0,ge.default)(z)(S,(0,Re.default)(pe),Ue)}se.default=(0,tt.default)(Dt,4),tr.exports=se.default});Q(bt);var ir=Y(function(tr,se){Object.defineProperty(se,"__esModule",{value:!0});var ge=tt(bt),Re=tt(Cr);function tt(Dt){return Dt&&Dt.__esModule?Dt:{default:Dt}}function Mt(Dt,S,z){return(0,ge.default)(Dt,1,S,z)}se.default=(0,Re.default)(Mt,3),tr.exports=se.default});Q(ir);var re=Y(function(tr,se){Object.defineProperty(se,"__esModule",{value:!0}),se.default=Mt;var ge=tt(Gt),Re=tt(ir);function tt(Dt){return Dt&&Dt.__esModule?Dt:{default:Dt}}function Mt(Dt,S){return(0,ge.default)(Re.default,Dt,S)}tr.exports=se.default}),Ee=Q(re),ae=function(){function tr(){for(var se=arguments,ge=[],Re=0;Re<arguments.length;Re++)ge[Re]=se[Re];this.args=[],this.tasks=[]}return tr.prototype.call=function(){for(var se=arguments,ge=[],Re=0;Re<arguments.length;Re++)ge[Re]=se[Re];return this.args=ge,Ee(this.tasks)},tr.prototype.tap=function(se,ge){var Re=this;this.tasks.push(function(tt){ge.apply(void 0,F(Re.args)),tt(null,se)})},tr}(),me=Y(function(tr,se){Object.defineProperty(se,"__esModule",{value:!0});var ge=pe(le),Re=pe(Ne),tt=pe(bt),Mt=pe(ar),Dt=pe(Et),S=pe(Ft),z=pe(Cr);function pe(Ct){return Ct&&Ct.__esModule?Ct:{default:Ct}}function Ue(Ct,H,Ht){Ht=(0,Mt.default)(Ht);var Vt=0,_r=0,Er=Ct.length,Ar=!1;Er===0&&Ht(null);function Pr(Ke,yt){Ke===!1&&(Ar=!0),Ar!==!0&&(Ke?Ht(Ke):(++_r===Er||yt===Re.default)&&Ht(null))}for(;Vt<Er;Vt++)H(Ct[Vt],Vt,(0,Dt.default)(Pr))}function Je(Ct,H,Ht){return(0,tt.default)(Ct,Infinity,H,Ht)}function mt(Ct,H,Ht){var Vt=(0,ge.default)(Ct)?Ue:Je;return Vt(Ct,(0,S.default)(H),Ht)}se.default=(0,z.default)(mt,3),tr.exports=se.default});Q(me);var Te=Y(function(tr,se){Object.defineProperty(se,"__esModule",{value:!0}),se.default=Mt;var ge=tt(me),Re=tt(Gt);function tt(Dt){return Dt&&Dt.__esModule?Dt:{default:Dt}}function Mt(Dt,S){return(0,Re.default)(ge.default,Dt,S)}tr.exports=se.default}),Qe=Q(Te),dt=function(){function tr(){for(var se=arguments,ge=[],Re=0;Re<arguments.length;Re++)ge[Re]=se[Re];this.tasks=[]}return tr.prototype.promise=function(){for(var se=arguments,ge=[],Re=0;Re<arguments.length;Re++)ge[Re]=se[Re];return Qe(this.tasks)},tr.prototype.tapPromise=function(se,ge){var Re=this;this.tasks.push(function(tt){return E(Re,void 0,void 0,function(){return p(this,function(Mt){switch(Mt.label){case 0:return[4,ge()];case 1:return Mt.sent(),tt(null,se),[2]}})})})},tr}(),Jt=Y(function(tr,se){Object.defineProperty(se,"__esModule",{value:!0});var ge=Dt(ar),Re=Dt(Et),tt=Dt(Ft),Mt=Dt(Cr);function Dt(z){return z&&z.__esModule?z:{default:z}}function S(z,pe){if(pe=(0,ge.default)(pe),!Array.isArray(z))return pe(new Error("First argument to waterfall must be an array of functions"));if(!z.length)return pe();var Ue=0;function Je(Ct){var H=(0,tt.default)(z[Ue++]);H.apply(void 0,Ct.concat([(0,Re.default)(mt)]))}function mt(Ct){for(var H=[],Ht=arguments.length-1;Ht-- >0;)H[Ht]=arguments[Ht+1];if(Ct!==!1){if(Ct||Ue===z.length)return pe.apply(void 0,[Ct].concat(H));Je(H)}}Je([])}se.default=(0,Mt.default)(S),tr.exports=se.default}),Nr=Q(Jt),Fr=function(){function tr(){for(var se=arguments,ge=[],Re=0;Re<arguments.length;Re++)ge[Re]=se[Re];this.tasks=[]}return tr.prototype.call=function(){for(var se=arguments,ge=[],Re=0;Re<arguments.length;Re++)ge[Re]=se[Re];return Nr(this.tasks)},tr.prototype.tap=function(se,ge){this.tasks.length===0?this.tasks.push(function(Re){var tt=ge();Re(tt?null:!1,tt)}):this.tasks.push(function(Re,tt){var Mt=ge();tt(Mt?null:!1,se)})},tr}(),ln=function(){function tr(){for(var se=arguments,ge=[],Re=0;Re<arguments.length;Re++)ge[Re]=se[Re];this.tasks=[]}return tr.prototype.call=function(){for(var se=arguments,ge=[],Re=0;Re<arguments.length;Re++)ge[Re]=se[Re];return Ee(this.tasks)},tr.prototype.tap=function(se,ge){this.tasks.push(function(Re){var tt=ge();Re(tt,se)})},tr}()},58881:function(ur,L,x){"use strict";x.d(L,{nC:function(){return J.ZP},Hp:function(){return J.Hp},e7:function(){return J.e7},yT:function(){return J.yT},vK:function(){return p.v},BlendType:function(){return F.h},AttributeType:function(){return Q.GC},ScaleTypes:function(){return Q.vY},StyleScaleType:function(){return Q.ee},MapServiceEvent:function(){return ne.I},CoordinateSystem:function(){return be.l},CoordinateUniform:function(){return be.k},CameraUniform:function(){return $t.l},SceneEventList:function(){return Ft.P},PositionType:function(){return gt.d},gl:function(){return z.gl}});var J=x(85951),E=x(69530),p=x(72302),w=x(76915),F=x(77252),Q=x(31251),Y=x(8628),le=x.n(Y);x.o(Y,"CameraUniform")&&x.d(L,{CameraUniform:function(){return Y.CameraUniform}}),x.o(Y,"CityBuildingLayer")&&x.d(L,{CityBuildingLayer:function(){return Y.CityBuildingLayer}}),x.o(Y,"CoordinateSystem")&&x.d(L,{CoordinateSystem:function(){return Y.CoordinateSystem}}),x.o(Y,"CoordinateUniform")&&x.d(L,{CoordinateUniform:function(){return Y.CoordinateUniform}}),x.o(Y,"HeatmapLayer")&&x.d(L,{HeatmapLayer:function(){return Y.HeatmapLayer}}),x.o(Y,"ImageLayer")&&x.d(L,{ImageLayer:function(){return Y.ImageLayer}}),x.o(Y,"LineLayer")&&x.d(L,{LineLayer:function(){return Y.LineLayer}}),x.o(Y,"MapServiceEvent")&&x.d(L,{MapServiceEvent:function(){return Y.MapServiceEvent}}),x.o(Y,"Marker")&&x.d(L,{Marker:function(){return Y.Marker}}),x.o(Y,"PointLayer")&&x.d(L,{PointLayer:function(){return Y.PointLayer}}),x.o(Y,"PolygonLayer")&&x.d(L,{PolygonLayer:function(){return Y.PolygonLayer}}),x.o(Y,"Popup")&&x.d(L,{Popup:function(){return Y.Popup}}),x.o(Y,"PositionType")&&x.d(L,{PositionType:function(){return Y.PositionType}}),x.o(Y,"RasterLayer")&&x.d(L,{RasterLayer:function(){return Y.RasterLayer}}),x.o(Y,"Scene")&&x.d(L,{Scene:function(){return Y.Scene}}),x.o(Y,"SceneEventList")&&x.d(L,{SceneEventList:function(){return Y.SceneEventList}}),x.o(Y,"gl")&&x.d(L,{gl:function(){return Y.gl}});var ne=x(16606),be=x(47282),we=x(41906),Ie=x.n(we);x.o(we,"CameraUniform")&&x.d(L,{CameraUniform:function(){return we.CameraUniform}}),x.o(we,"CityBuildingLayer")&&x.d(L,{CityBuildingLayer:function(){return we.CityBuildingLayer}}),x.o(we,"HeatmapLayer")&&x.d(L,{HeatmapLayer:function(){return we.HeatmapLayer}}),x.o(we,"ImageLayer")&&x.d(L,{ImageLayer:function(){return we.ImageLayer}}),x.o(we,"LineLayer")&&x.d(L,{LineLayer:function(){return we.LineLayer}}),x.o(we,"Marker")&&x.d(L,{Marker:function(){return we.Marker}}),x.o(we,"PointLayer")&&x.d(L,{PointLayer:function(){return we.PointLayer}}),x.o(we,"PolygonLayer")&&x.d(L,{PolygonLayer:function(){return we.PolygonLayer}}),x.o(we,"Popup")&&x.d(L,{Popup:function(){return we.Popup}}),x.o(we,"PositionType")&&x.d(L,{PositionType:function(){return we.PositionType}}),x.o(we,"RasterLayer")&&x.d(L,{RasterLayer:function(){return we.RasterLayer}}),x.o(we,"Scene")&&x.d(L,{Scene:function(){return we.Scene}}),x.o(we,"SceneEventList")&&x.d(L,{SceneEventList:function(){return we.SceneEventList}}),x.o(we,"gl")&&x.d(L,{gl:function(){return we.gl}});var $t=x(4594),Zt=x(1910),Xt=x.n(Zt);x.o(Zt,"CityBuildingLayer")&&x.d(L,{CityBuildingLayer:function(){return Zt.CityBuildingLayer}}),x.o(Zt,"HeatmapLayer")&&x.d(L,{HeatmapLayer:function(){return Zt.HeatmapLayer}}),x.o(Zt,"ImageLayer")&&x.d(L,{ImageLayer:function(){return Zt.ImageLayer}}),x.o(Zt,"LineLayer")&&x.d(L,{LineLayer:function(){return Zt.LineLayer}}),x.o(Zt,"Marker")&&x.d(L,{Marker:function(){return Zt.Marker}}),x.o(Zt,"PointLayer")&&x.d(L,{PointLayer:function(){return Zt.PointLayer}}),x.o(Zt,"PolygonLayer")&&x.d(L,{PolygonLayer:function(){return Zt.PolygonLayer}}),x.o(Zt,"Popup")&&x.d(L,{Popup:function(){return Zt.Popup}}),x.o(Zt,"PositionType")&&x.d(L,{PositionType:function(){return Zt.PositionType}}),x.o(Zt,"RasterLayer")&&x.d(L,{RasterLayer:function(){return Zt.RasterLayer}}),x.o(Zt,"Scene")&&x.d(L,{Scene:function(){return Zt.Scene}}),x.o(Zt,"SceneEventList")&&x.d(L,{SceneEventList:function(){return Zt.SceneEventList}}),x.o(Zt,"gl")&&x.d(L,{gl:function(){return Zt.gl}});var Ft=x(19793),Lt=x(93102),_t=x.n(Lt);x.o(Lt,"CityBuildingLayer")&&x.d(L,{CityBuildingLayer:function(){return Lt.CityBuildingLayer}}),x.o(Lt,"HeatmapLayer")&&x.d(L,{HeatmapLayer:function(){return Lt.HeatmapLayer}}),x.o(Lt,"ImageLayer")&&x.d(L,{ImageLayer:function(){return Lt.ImageLayer}}),x.o(Lt,"LineLayer")&&x.d(L,{LineLayer:function(){return Lt.LineLayer}}),x.o(Lt,"Marker")&&x.d(L,{Marker:function(){return Lt.Marker}}),x.o(Lt,"PointLayer")&&x.d(L,{PointLayer:function(){return Lt.PointLayer}}),x.o(Lt,"PolygonLayer")&&x.d(L,{PolygonLayer:function(){return Lt.PolygonLayer}}),x.o(Lt,"Popup")&&x.d(L,{Popup:function(){return Lt.Popup}}),x.o(Lt,"PositionType")&&x.d(L,{PositionType:function(){return Lt.PositionType}}),x.o(Lt,"RasterLayer")&&x.d(L,{RasterLayer:function(){return Lt.RasterLayer}}),x.o(Lt,"Scene")&&x.d(L,{Scene:function(){return Lt.Scene}}),x.o(Lt,"gl")&&x.d(L,{gl:function(){return Lt.gl}});var pt=x(64532),Cr=x.n(pt);x.o(pt,"CityBuildingLayer")&&x.d(L,{CityBuildingLayer:function(){return pt.CityBuildingLayer}}),x.o(pt,"HeatmapLayer")&&x.d(L,{HeatmapLayer:function(){return pt.HeatmapLayer}}),x.o(pt,"ImageLayer")&&x.d(L,{ImageLayer:function(){return pt.ImageLayer}}),x.o(pt,"LineLayer")&&x.d(L,{LineLayer:function(){return pt.LineLayer}}),x.o(pt,"Marker")&&x.d(L,{Marker:function(){return pt.Marker}}),x.o(pt,"PointLayer")&&x.d(L,{PointLayer:function(){return pt.PointLayer}}),x.o(pt,"PolygonLayer")&&x.d(L,{PolygonLayer:function(){return pt.PolygonLayer}}),x.o(pt,"Popup")&&x.d(L,{Popup:function(){return pt.Popup}}),x.o(pt,"PositionType")&&x.d(L,{PositionType:function(){return pt.PositionType}}),x.o(pt,"RasterLayer")&&x.d(L,{RasterLayer:function(){return pt.RasterLayer}}),x.o(pt,"Scene")&&x.d(L,{Scene:function(){return pt.Scene}}),x.o(pt,"gl")&&x.d(L,{gl:function(){return pt.gl}});var Gt=x(2811),ar=x.n(Gt);x.o(Gt,"CityBuildingLayer")&&x.d(L,{CityBuildingLayer:function(){return Gt.CityBuildingLayer}}),x.o(Gt,"HeatmapLayer")&&x.d(L,{HeatmapLayer:function(){return Gt.HeatmapLayer}}),x.o(Gt,"ImageLayer")&&x.d(L,{ImageLayer:function(){return Gt.ImageLayer}}),x.o(Gt,"LineLayer")&&x.d(L,{LineLayer:function(){return Gt.LineLayer}}),x.o(Gt,"Marker")&&x.d(L,{Marker:function(){return Gt.Marker}}),x.o(Gt,"PointLayer")&&x.d(L,{PointLayer:function(){return Gt.PointLayer}}),x.o(Gt,"PolygonLayer")&&x.d(L,{PolygonLayer:function(){return Gt.PolygonLayer}}),x.o(Gt,"Popup")&&x.d(L,{Popup:function(){return Gt.Popup}}),x.o(Gt,"PositionType")&&x.d(L,{PositionType:function(){return Gt.PositionType}}),x.o(Gt,"RasterLayer")&&x.d(L,{RasterLayer:function(){return Gt.RasterLayer}}),x.o(Gt,"Scene")&&x.d(L,{Scene:function(){return Gt.Scene}}),x.o(Gt,"gl")&&x.d(L,{gl:function(){return Gt.gl}});var gt=x(66690),Ye=x(81732),Et=x.n(Ye);x.o(Ye,"CityBuildingLayer")&&x.d(L,{CityBuildingLayer:function(){return Ye.CityBuildingLayer}}),x.o(Ye,"HeatmapLayer")&&x.d(L,{HeatmapLayer:function(){return Ye.HeatmapLayer}}),x.o(Ye,"ImageLayer")&&x.d(L,{ImageLayer:function(){return Ye.ImageLayer}}),x.o(Ye,"LineLayer")&&x.d(L,{LineLayer:function(){return Ye.LineLayer}}),x.o(Ye,"Marker")&&x.d(L,{Marker:function(){return Ye.Marker}}),x.o(Ye,"PointLayer")&&x.d(L,{PointLayer:function(){return Ye.PointLayer}}),x.o(Ye,"PolygonLayer")&&x.d(L,{PolygonLayer:function(){return Ye.PolygonLayer}}),x.o(Ye,"Popup")&&x.d(L,{Popup:function(){return Ye.Popup}}),x.o(Ye,"RasterLayer")&&x.d(L,{RasterLayer:function(){return Ye.RasterLayer}}),x.o(Ye,"Scene")&&x.d(L,{Scene:function(){return Ye.Scene}}),x.o(Ye,"gl")&&x.d(L,{gl:function(){return Ye.gl}});var Ne=x(84007),Ae=x.n(Ne);x.o(Ne,"CityBuildingLayer")&&x.d(L,{CityBuildingLayer:function(){return Ne.CityBuildingLayer}}),x.o(Ne,"HeatmapLayer")&&x.d(L,{HeatmapLayer:function(){return Ne.HeatmapLayer}}),x.o(Ne,"ImageLayer")&&x.d(L,{ImageLayer:function(){return Ne.ImageLayer}}),x.o(Ne,"LineLayer")&&x.d(L,{LineLayer:function(){return Ne.LineLayer}}),x.o(Ne,"Marker")&&x.d(L,{Marker:function(){return Ne.Marker}}),x.o(Ne,"PointLayer")&&x.d(L,{PointLayer:function(){return Ne.PointLayer}}),x.o(Ne,"PolygonLayer")&&x.d(L,{PolygonLayer:function(){return Ne.PolygonLayer}}),x.o(Ne,"Popup")&&x.d(L,{Popup:function(){return Ne.Popup}}),x.o(Ne,"RasterLayer")&&x.d(L,{RasterLayer:function(){return Ne.RasterLayer}}),x.o(Ne,"Scene")&&x.d(L,{Scene:function(){return Ne.Scene}}),x.o(Ne,"gl")&&x.d(L,{gl:function(){return Ne.gl}});var Be=x(79042),bt=x.n(Be);x.o(Be,"CityBuildingLayer")&&x.d(L,{CityBuildingLayer:function(){return Be.CityBuildingLayer}}),x.o(Be,"HeatmapLayer")&&x.d(L,{HeatmapLayer:function(){return Be.HeatmapLayer}}),x.o(Be,"ImageLayer")&&x.d(L,{ImageLayer:function(){return Be.ImageLayer}}),x.o(Be,"LineLayer")&&x.d(L,{LineLayer:function(){return Be.LineLayer}}),x.o(Be,"Marker")&&x.d(L,{Marker:function(){return Be.Marker}}),x.o(Be,"PointLayer")&&x.d(L,{PointLayer:function(){return Be.PointLayer}}),x.o(Be,"PolygonLayer")&&x.d(L,{PolygonLayer:function(){return Be.PolygonLayer}}),x.o(Be,"Popup")&&x.d(L,{Popup:function(){return Be.Popup}}),x.o(Be,"RasterLayer")&&x.d(L,{RasterLayer:function(){return Be.RasterLayer}}),x.o(Be,"Scene")&&x.d(L,{Scene:function(){return Be.Scene}}),x.o(Be,"gl")&&x.d(L,{gl:function(){return Be.gl}});var ir=x(89648),re=x(90919),Ee=x.n(re);x.o(re,"CityBuildingLayer")&&x.d(L,{CityBuildingLayer:function(){return re.CityBuildingLayer}}),x.o(re,"HeatmapLayer")&&x.d(L,{HeatmapLayer:function(){return re.HeatmapLayer}}),x.o(re,"ImageLayer")&&x.d(L,{ImageLayer:function(){return re.ImageLayer}}),x.o(re,"LineLayer")&&x.d(L,{LineLayer:function(){return re.LineLayer}}),x.o(re,"Marker")&&x.d(L,{Marker:function(){return re.Marker}}),x.o(re,"PointLayer")&&x.d(L,{PointLayer:function(){return re.PointLayer}}),x.o(re,"PolygonLayer")&&x.d(L,{PolygonLayer:function(){return re.PolygonLayer}}),x.o(re,"Popup")&&x.d(L,{Popup:function(){return re.Popup}}),x.o(re,"RasterLayer")&&x.d(L,{RasterLayer:function(){return re.RasterLayer}}),x.o(re,"Scene")&&x.d(L,{Scene:function(){return re.Scene}}),x.o(re,"gl")&&x.d(L,{gl:function(){return re.gl}});var ae=x(75925),me=x.n(ae);x.o(ae,"CityBuildingLayer")&&x.d(L,{CityBuildingLayer:function(){return ae.CityBuildingLayer}}),x.o(ae,"HeatmapLayer")&&x.d(L,{HeatmapLayer:function(){return ae.HeatmapLayer}}),x.o(ae,"ImageLayer")&&x.d(L,{ImageLayer:function(){return ae.ImageLayer}}),x.o(ae,"LineLayer")&&x.d(L,{LineLayer:function(){return ae.LineLayer}}),x.o(ae,"Marker")&&x.d(L,{Marker:function(){return ae.Marker}}),x.o(ae,"PointLayer")&&x.d(L,{PointLayer:function(){return ae.PointLayer}}),x.o(ae,"PolygonLayer")&&x.d(L,{PolygonLayer:function(){return ae.PolygonLayer}}),x.o(ae,"Popup")&&x.d(L,{Popup:function(){return ae.Popup}}),x.o(ae,"RasterLayer")&&x.d(L,{RasterLayer:function(){return ae.RasterLayer}}),x.o(ae,"Scene")&&x.d(L,{Scene:function(){return ae.Scene}}),x.o(ae,"gl")&&x.d(L,{gl:function(){return ae.gl}});var Te=x(85040),Qe=x.n(Te);x.o(Te,"CityBuildingLayer")&&x.d(L,{CityBuildingLayer:function(){return Te.CityBuildingLayer}}),x.o(Te,"HeatmapLayer")&&x.d(L,{HeatmapLayer:function(){return Te.HeatmapLayer}}),x.o(Te,"ImageLayer")&&x.d(L,{ImageLayer:function(){return Te.ImageLayer}}),x.o(Te,"LineLayer")&&x.d(L,{LineLayer:function(){return Te.LineLayer}}),x.o(Te,"Marker")&&x.d(L,{Marker:function(){return Te.Marker}}),x.o(Te,"PointLayer")&&x.d(L,{PointLayer:function(){return Te.PointLayer}}),x.o(Te,"PolygonLayer")&&x.d(L,{PolygonLayer:function(){return Te.PolygonLayer}}),x.o(Te,"Popup")&&x.d(L,{Popup:function(){return Te.Popup}}),x.o(Te,"RasterLayer")&&x.d(L,{RasterLayer:function(){return Te.RasterLayer}}),x.o(Te,"Scene")&&x.d(L,{Scene:function(){return Te.Scene}}),x.o(Te,"gl")&&x.d(L,{gl:function(){return Te.gl}});var dt=x(8594),Jt=x.n(dt);x.o(dt,"CityBuildingLayer")&&x.d(L,{CityBuildingLayer:function(){return dt.CityBuildingLayer}}),x.o(dt,"HeatmapLayer")&&x.d(L,{HeatmapLayer:function(){return dt.HeatmapLayer}}),x.o(dt,"ImageLayer")&&x.d(L,{ImageLayer:function(){return dt.ImageLayer}}),x.o(dt,"LineLayer")&&x.d(L,{LineLayer:function(){return dt.LineLayer}}),x.o(dt,"Marker")&&x.d(L,{Marker:function(){return dt.Marker}}),x.o(dt,"PointLayer")&&x.d(L,{PointLayer:function(){return dt.PointLayer}}),x.o(dt,"PolygonLayer")&&x.d(L,{PolygonLayer:function(){return dt.PolygonLayer}}),x.o(dt,"Popup")&&x.d(L,{Popup:function(){return dt.Popup}}),x.o(dt,"RasterLayer")&&x.d(L,{RasterLayer:function(){return dt.RasterLayer}}),x.o(dt,"Scene")&&x.d(L,{Scene:function(){return dt.Scene}}),x.o(dt,"gl")&&x.d(L,{gl:function(){return dt.gl}});var Nr=x(67571),Fr=x.n(Nr);x.o(Nr,"CityBuildingLayer")&&x.d(L,{CityBuildingLayer:function(){return Nr.CityBuildingLayer}}),x.o(Nr,"HeatmapLayer")&&x.d(L,{HeatmapLayer:function(){return Nr.HeatmapLayer}}),x.o(Nr,"ImageLayer")&&x.d(L,{ImageLayer:function(){return Nr.ImageLayer}}),x.o(Nr,"LineLayer")&&x.d(L,{LineLayer:function(){return Nr.LineLayer}}),x.o(Nr,"Marker")&&x.d(L,{Marker:function(){return Nr.Marker}}),x.o(Nr,"PointLayer")&&x.d(L,{PointLayer:function(){return Nr.PointLayer}}),x.o(Nr,"PolygonLayer")&&x.d(L,{PolygonLayer:function(){return Nr.PolygonLayer}}),x.o(Nr,"Popup")&&x.d(L,{Popup:function(){return Nr.Popup}}),x.o(Nr,"RasterLayer")&&x.d(L,{RasterLayer:function(){return Nr.RasterLayer}}),x.o(Nr,"Scene")&&x.d(L,{Scene:function(){return Nr.Scene}}),x.o(Nr,"gl")&&x.d(L,{gl:function(){return Nr.gl}});var ln=x(66718),tr=x.n(ln);x.o(ln,"CityBuildingLayer")&&x.d(L,{CityBuildingLayer:function(){return ln.CityBuildingLayer}}),x.o(ln,"HeatmapLayer")&&x.d(L,{HeatmapLayer:function(){return ln.HeatmapLayer}}),x.o(ln,"ImageLayer")&&x.d(L,{ImageLayer:function(){return ln.ImageLayer}}),x.o(ln,"LineLayer")&&x.d(L,{LineLayer:function(){return ln.LineLayer}}),x.o(ln,"Marker")&&x.d(L,{Marker:function(){return ln.Marker}}),x.o(ln,"PointLayer")&&x.d(L,{PointLayer:function(){return ln.PointLayer}}),x.o(ln,"PolygonLayer")&&x.d(L,{PolygonLayer:function(){return ln.PolygonLayer}}),x.o(ln,"Popup")&&x.d(L,{Popup:function(){return ln.Popup}}),x.o(ln,"RasterLayer")&&x.d(L,{RasterLayer:function(){return ln.RasterLayer}}),x.o(ln,"Scene")&&x.d(L,{Scene:function(){return ln.Scene}}),x.o(ln,"gl")&&x.d(L,{gl:function(){return ln.gl}});var se=x(92364),ge=x(78010),Re=x.n(ge);x.o(ge,"CityBuildingLayer")&&x.d(L,{CityBuildingLayer:function(){return ge.CityBuildingLayer}}),x.o(ge,"HeatmapLayer")&&x.d(L,{HeatmapLayer:function(){return ge.HeatmapLayer}}),x.o(ge,"ImageLayer")&&x.d(L,{ImageLayer:function(){return ge.ImageLayer}}),x.o(ge,"LineLayer")&&x.d(L,{LineLayer:function(){return ge.LineLayer}}),x.o(ge,"Marker")&&x.d(L,{Marker:function(){return ge.Marker}}),x.o(ge,"PointLayer")&&x.d(L,{PointLayer:function(){return ge.PointLayer}}),x.o(ge,"PolygonLayer")&&x.d(L,{PolygonLayer:function(){return ge.PolygonLayer}}),x.o(ge,"Popup")&&x.d(L,{Popup:function(){return ge.Popup}}),x.o(ge,"RasterLayer")&&x.d(L,{RasterLayer:function(){return ge.RasterLayer}}),x.o(ge,"Scene")&&x.d(L,{Scene:function(){return ge.Scene}}),x.o(ge,"gl")&&x.d(L,{gl:function(){return ge.gl}});var tt=x(68116),Mt=x.n(tt);x.o(tt,"CityBuildingLayer")&&x.d(L,{CityBuildingLayer:function(){return tt.CityBuildingLayer}}),x.o(tt,"HeatmapLayer")&&x.d(L,{HeatmapLayer:function(){return tt.HeatmapLayer}}),x.o(tt,"ImageLayer")&&x.d(L,{ImageLayer:function(){return tt.ImageLayer}}),x.o(tt,"LineLayer")&&x.d(L,{LineLayer:function(){return tt.LineLayer}}),x.o(tt,"Marker")&&x.d(L,{Marker:function(){return tt.Marker}}),x.o(tt,"PointLayer")&&x.d(L,{PointLayer:function(){return tt.PointLayer}}),x.o(tt,"PolygonLayer")&&x.d(L,{PolygonLayer:function(){return tt.PolygonLayer}}),x.o(tt,"Popup")&&x.d(L,{Popup:function(){return tt.Popup}}),x.o(tt,"RasterLayer")&&x.d(L,{RasterLayer:function(){return tt.RasterLayer}}),x.o(tt,"Scene")&&x.d(L,{Scene:function(){return tt.Scene}}),x.o(tt,"gl")&&x.d(L,{gl:function(){return tt.gl}});var Dt=x(23067),S=x.n(Dt);x.o(Dt,"CityBuildingLayer")&&x.d(L,{CityBuildingLayer:function(){return Dt.CityBuildingLayer}}),x.o(Dt,"HeatmapLayer")&&x.d(L,{HeatmapLayer:function(){return Dt.HeatmapLayer}}),x.o(Dt,"ImageLayer")&&x.d(L,{ImageLayer:function(){return Dt.ImageLayer}}),x.o(Dt,"LineLayer")&&x.d(L,{LineLayer:function(){return Dt.LineLayer}}),x.o(Dt,"Marker")&&x.d(L,{Marker:function(){return Dt.Marker}}),x.o(Dt,"PointLayer")&&x.d(L,{PointLayer:function(){return Dt.PointLayer}}),x.o(Dt,"PolygonLayer")&&x.d(L,{PolygonLayer:function(){return Dt.PolygonLayer}}),x.o(Dt,"Popup")&&x.d(L,{Popup:function(){return Dt.Popup}}),x.o(Dt,"RasterLayer")&&x.d(L,{RasterLayer:function(){return Dt.RasterLayer}}),x.o(Dt,"Scene")&&x.d(L,{Scene:function(){return Dt.Scene}}),x.o(Dt,"gl")&&x.d(L,{gl:function(){return Dt.gl}});var z=x(7648)},85951:function(ur,L,x){"use strict";x.d(L,{e7:function(){return ac},Hp:function(){return Gc},ZP:function(){return Ff},yT:function(){return yo}});var J=x(28660),E=x(26729),p=x.n(E),w=x(86700),F=x(84879),Q=x(72302),Y=x(96156),le=x(6610),ne=x(5991),be=x(6901),we=x(49296),Ie=x.n(we);function $t(N,U){var P=Object.keys(N);if(Object.getOwnPropertySymbols){var O=Object.getOwnPropertySymbols(N);U&&(O=O.filter(function(q){return Object.getOwnPropertyDescriptor(N,q).enumerable})),P.push.apply(P,O)}return P}function Zt(N){for(var U=1;U<arguments.length;U++){var P=arguments[U]!=null?arguments[U]:{};U%2?$t(Object(P),!0).forEach(function(O){(0,Y.Z)(N,O,P[O])}):Object.getOwnPropertyDescriptors?Object.defineProperties(N,Object.getOwnPropertyDescriptors(P)):$t(Object(P)).forEach(function(O){Object.defineProperty(N,O,Object.getOwnPropertyDescriptor(P,O))})}return N}function Xt(N,U){var P;if(typeof Symbol=="undefined"||N[Symbol.iterator]==null){if(Array.isArray(N)||(P=Ft(N))||U&&N&&typeof N.length=="number"){P&&(N=P);var O=0,q=function(){};return{s:q,n:function(){return O>=N.length?{done:!0}:{done:!1,value:N[O++]}},e:function(mr){throw mr},f:q}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var ve=!0,$e=!1,xt;return{s:function(){P=N[Symbol.iterator]()},n:function(){var mr=P.next();return ve=mr.done,mr},e:function(mr){$e=!0,xt=mr},f:function(){try{!ve&&P.return!=null&&P.return()}finally{if($e)throw xt}}}}function Ft(N,U){if(!!N){if(typeof N=="string")return Lt(N,U);var P=Object.prototype.toString.call(N).slice(8,-1);if(P==="Object"&&N.constructor&&(P=N.constructor.name),P==="Map"||P==="Set")return Array.from(N);if(P==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(P))return Lt(N,U)}}function Lt(N,U){(U==null||U>N.length)&&(U=N.length);for(var P=0,O=new Array(U);P<U;P++)O[P]=N[P];return O}var _t=30;function pt(N){var U=N.characterSet,P=N.getFontWidth,O=N.fontHeight,q=N.buffer,ve=N.maxCanvasWidth,$e=N.mapping,xt=$e===void 0?{}:$e,vt=N.xOffset,mr=vt===void 0?0:vt,Br=N.yOffset,In=Br===void 0?0:Br,Bn=0,fi=mr;Array.from(U).forEach(function(wi,ha){if(!xt[wi]){var Ti=P(wi,ha);fi+_t>ve&&(fi=0,Bn++),xt[wi]={x:fi,y:In+Bn*_t,width:_t,height:_t,advance:Ti},fi+=_t}});var Ci=O+q*2;return{mapping:xt,xOffset:fi,yOffset:In+Bn*Ci,canvasHeight:ar(In+(Bn+1)*Ci)}}function Cr(N,U,P){var O=0,q=0,ve=0,$e=[],xt={},vt=Xt(N),mr;try{for(vt.s();!(mr=vt.n()).done;){var Br=mr.value;if(!xt[Br.id]){var In=Br.size;O+In+U>P&&(Gt(xt,$e,q),O=0,q=ve+q+U,ve=0,$e=[]),$e.push({icon:Br,xOffset:O}),O=O+In+U,ve=Math.max(ve,In)}}}catch(fi){vt.e(fi)}finally{vt.f()}$e.length>0&&Gt(xt,$e,q);var Bn=ar(ve+q+U);return{mapping:xt,canvasHeight:Bn}}function Gt(N,U,P){var O=Xt(U),q;try{for(O.s();!(q=O.n()).done;){var ve=q.value,$e=ve.icon,xt=ve.xOffset;N[$e.id]=Zt(Zt({},$e),{},{x:xt,y:P,image:$e.image,width:$e.width,height:$e.height})}}catch(vt){O.e(vt)}finally{O.f()}}function ar(N){return Math.pow(2,Math.ceil(Math.log2(N)))}var gt,Ye,Et;function Ne(N,U){var P;if(typeof Symbol=="undefined"||N[Symbol.iterator]==null){if(Array.isArray(N)||(P=Ae(N))||U&&N&&typeof N.length=="number"){P&&(N=P);var O=0,q=function(){};return{s:q,n:function(){return O>=N.length?{done:!0}:{done:!1,value:N[O++]}},e:function(mr){throw mr},f:q}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var ve=!0,$e=!1,xt;return{s:function(){P=N[Symbol.iterator]()},n:function(){var mr=P.next();return ve=mr.done,mr},e:function(mr){$e=!0,xt=mr},f:function(){try{!ve&&P.return!=null&&P.return()}finally{if($e)throw xt}}}}function Ae(N,U){if(!!N){if(typeof N=="string")return Be(N,U);var P=Object.prototype.toString.call(N).slice(8,-1);if(P==="Object"&&N.constructor&&(P=N.constructor.name),P==="Map"||P==="Set")return Array.from(N);if(P==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(P))return Be(N,U)}}function Be(N,U){(U==null||U>N.length)&&(U=N.length);for(var P=0,O=new Array(U);P<U;P++)O[P]=N[P];return O}function bt(N,U){var P=Object.keys(N);if(Object.getOwnPropertySymbols){var O=Object.getOwnPropertySymbols(N);U&&(O=O.filter(function(q){return Object.getOwnPropertyDescriptor(N,q).enumerable})),P.push.apply(P,O)}return P}function ir(N){for(var U=1;U<arguments.length;U++){var P=arguments[U]!=null?arguments[U]:{};U%2?bt(Object(P),!0).forEach(function(O){(0,Y.Z)(N,O,P[O])}):Object.getOwnPropertyDescriptors?Object.defineProperties(N,Object.getOwnPropertyDescriptors(P)):bt(Object(P)).forEach(function(O){Object.defineProperty(N,O,Object.getOwnPropertyDescriptor(P,O))})}return N}var re=se(),Ee="sans-serif",ae="normal",me=24,Te=3,Qe=.25,dt=8,Jt=1024,Nr=1,Fr=1,ln=3,tr=null;function se(){for(var N=[],U=32;U<128;U++)N.push(String.fromCharCode(U));return N}function ge(N,U,P,O){N.font="".concat(O," ").concat(P,"px ").concat(U),N.fillStyle="black",N.textBaseline="middle"}function Re(N,U){for(var P=0;P<N.length;P++)U.data[4*P+3]=N[P]}var tt=(gt=(0,w.b2)(),gt(Ye=(Et=function(){function N(){(0,le.Z)(this,N),this.fontAtlas=void 0,this.iconFontMap=void 0,this.iconFontGlyphs={},this.fontOptions=void 0,this.key=void 0,this.cache=new be.z6(ln)}return(0,ne.Z)(N,[{key:"scale",get:function(){return Fr}},{key:"canvas",get:function(){var P=this.cache.get(this.key);return P&&P.data}},{key:"mapping",get:function(){var P=this.cache.get(this.key);return P&&P.mapping}},{key:"init",value:function(){this.cache.clear(),this.fontOptions={fontFamily:Ee,fontWeight:ae,characterSet:re,fontSize:me,buffer:Te,sdf:!0,cutoff:Qe,radius:dt,iconfont:!1},this.key="",this.iconFontMap=new Map}},{key:"addIconGlyphs",value:function(P){var O=this;P.forEach(function(q){O.iconFontGlyphs[q.name]=q.unicode})}},{key:"addIconFont",value:function(P,O){this.iconFontMap.set(P,O)}},{key:"getIconFontKey",value:function(P){return this.iconFontMap.get(P)||P}},{key:"getGlyph",value:function(P){return this.iconFontGlyphs[P]?String.fromCharCode(parseInt(this.iconFontGlyphs[P],16)):""}},{key:"setFontOptions",value:function(P){this.fontOptions=ir(ir({},this.fontOptions),P),this.key=this.getKey();var O=this.getNewChars(this.key,this.fontOptions.characterSet),q=this.cache.get(this.key);if(!(q&&O.length===0)){var ve=this.generateFontAtlas(this.key,O,q);this.fontAtlas=ve,this.cache.set(this.key,ve)}}},{key:"destroy",value:function(){this.cache.clear(),this.iconFontMap.clear()}},{key:"generateFontAtlas",value:function(P,O,q){var ve=this.fontOptions,$e=ve.fontFamily,xt=ve.fontWeight,vt=ve.fontSize,mr=ve.buffer,Br=ve.sdf,In=ve.radius,Bn=ve.cutoff,fi=ve.iconfont,Ci=q&&q.data;Ci||(Ci=document.createElement("canvas"),Ci.width=Jt);var wi=Ci.getContext("2d");ge(wi,$e,vt,xt);var ha=pt(ir({getFontWidth:function(iu){return wi.measureText(iu).width},fontHeight:vt*Fr,buffer:mr,characterSet:O,maxCanvasWidth:Jt},q&&{mapping:q.mapping,xOffset:q.xOffset,yOffset:q.yOffset})),Ti=ha.mapping,Va=ha.canvasHeight,Bo=ha.xOffset,Uo=ha.yOffset,us=wi.getImageData(0,0,Ci.width,Ci.height);if(Ci.height=Va,wi.putImageData(us,0,0),ge(wi,$e,vt,xt),Br){var co=new(Ie())(vt,mr,In,Bn,$e,xt),ya=wi.getImageData(0,0,co.size,co.size),pa=Ne(O),_o;try{for(pa.s();!(_o=pa.n()).done;){var fo=_o.value;if(fi){var Ga=String.fromCharCode(parseInt(fo.replace("&#x","").replace(";",""),16)),$o=co.draw(Ga);Re($o,ya)}else Re(co.draw(fo),ya);wi.putImageData(ya,Ti[fo].x,Ti[fo].y)}}catch(gs){pa.e(gs)}finally{pa.f()}}else{var Jo=Ne(O),oc;try{for(Jo.s();!(oc=Jo.n()).done;){var Gl=oc.value;wi.fillText(Gl,Ti[Gl].x,Ti[Gl].y+vt*Nr)}}catch(gs){Jo.e(gs)}finally{Jo.f()}}return{xOffset:Bo,yOffset:Uo,mapping:Ti,data:Ci,width:Ci.width,height:Ci.height}}},{key:"getKey",value:function(){return"key";var P,O,q,ve,$e,xt,vt,mr}},{key:"getNewChars",value:function(P,O){var q=this.cache.get(P);if(!q)return O;var ve=[],$e=q.mapping,xt=new Set(Object.keys($e)),vt=new Set(O);return vt.forEach(function(mr){xt.has(mr)||ve.push(mr)}),ve}}]),N}(),Et))||Ye),Mt=x(10379),Dt=x(46070),S=x(77608),z,pe,Ue;function Je(N){var U=mt();return function(){var O=(0,S.Z)(N),q;if(U){var ve=(0,S.Z)(this).constructor;q=Reflect.construct(O,arguments,ve)}else q=O.apply(this,arguments);return(0,Dt.Z)(this,q)}}function mt(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(N){return!1}}var Ct=3,H=1024,Ht=64,Vt=(z=(0,w.b2)(),z(pe=(Ue=function(N){(0,Mt.Z)(P,N);var U=Je(P);function P(){var O;(0,le.Z)(this,P);for(var q=arguments.length,ve=new Array(q),$e=0;$e<q;$e++)ve[$e]=arguments[$e];return O=U.call.apply(U,[this].concat(ve)),O.canvasHeight=128,O.texture=void 0,O.canvas=void 0,O.iconData=void 0,O.iconMap=void 0,O.ctx=void 0,O.loadingImageCount=0,O}return(0,ne.Z)(P,[{key:"isLoading",value:function(){return this.loadingImageCount===0}},{key:"init",value:function(){this.iconData=[],this.iconMap={},this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d")}},{key:"addImage",value:function(q,ve){var $e=this,xt=new Image;if(this.loadingImageCount++,this.hasImage(q))throw new Error("Image Id already exists");this.iconData.push({id:q,size:Ht}),this.updateIconMap(),this.loadImage(ve).then(function(vt){xt=vt;var mr=$e.iconData.find(function(Br){return Br.id===q});mr&&(mr.image=xt,mr.width=xt.width,mr.height=xt.height),$e.update()})}},{key:"getTexture",value:function(){return this.texture}},{key:"getIconMap",value:function(){return this.iconMap}},{key:"getCanvas",value:function(){return this.canvas}},{key:"hasImage",value:function(q){return this.iconMap.hasOwnProperty(q)}},{key:"removeImage",value:function(q){this.hasImage(q)&&(this.iconData=this.iconData.filter(function(ve){return ve.id!==q}),delete this.iconMap[q],this.update())}},{key:"destroy",value:function(){this.iconData=[],this.iconMap={}}},{key:"update",value:function(){this.updateIconMap(),this.updateIconAtlas(),this.loadingImageCount--,this.loadingImageCount===0&&this.emit("imageUpdate")}},{key:"updateIconAtlas",value:function(){var q=this;this.canvas.width=H,this.canvas.height=this.canvasHeight,Object.keys(this.iconMap).forEach(function(ve){var $e=q.iconMap[ve],xt=$e.x,vt=$e.y,mr=$e.image,Br=$e.width,In=Br===void 0?64:Br,Bn=$e.height,fi=Bn===void 0?64:Bn,Ci=Math.max(In,fi),wi=Ci/Ht,ha=fi/wi,Ti=In/wi;mr&&q.ctx.drawImage(mr,xt+(Ht-Ti)/2,vt+(Ht-ha)/2,Ti,ha)})}},{key:"updateIconMap",value:function(){var q=Cr(this.iconData,Ct,H),ve=q.mapping,$e=q.canvasHeight;this.iconMap=ve,this.canvasHeight=$e}},{key:"loadImage",value:function(q){return new Promise(function(ve,$e){if(q instanceof HTMLImageElement){ve(q);return}var xt=new Image;xt.crossOrigin="anonymous",xt.onload=function(){ve(xt)},xt.onerror=function(){$e(new Error("Could not load image at "+q))},xt.src=q instanceof File?URL.createObjectURL(q):q})}}]),P}(E.EventEmitter),Ue))||pe),_r=x(28481),Er=x(85975),Ar,Pr,Ke,yt=(Ar=(0,w.b2)(),Ar(Pr=(Ke=function(){function N(){(0,le.Z)(this,N),this.viewport=void 0,this.overridedViewProjectionMatrix=void 0,this.jitteredViewProjectionMatrix=void 0,this.jitteredProjectionMatrix=void 0,this.viewMatrixInverse=void 0,this.cameraPosition=void 0}return(0,ne.Z)(N,[{key:"init",value:function(){}},{key:"update",value:function(P){this.viewport=P,this.viewMatrixInverse=Er.create(),Er.invert(this.viewMatrixInverse,P.getViewMatrix()),this.cameraPosition=[this.viewMatrixInverse[12],this.viewMatrixInverse[13],this.viewMatrixInverse[14]]}},{key:"getProjectionMatrix",value:function(){return this.jitteredProjectionMatrix||this.viewport.getProjectionMatrix()}},{key:"getViewMatrix",value:function(){return this.viewport.getViewMatrix()}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.getViewMatrixUncentered()}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.getViewProjectionMatrixUncentered()}},{key:"getViewProjectionMatrix",value:function(){return this.overridedViewProjectionMatrix||this.jitteredViewProjectionMatrix||this.viewport.getViewProjectionMatrix()}},{key:"getZoom",value:function(){return this.viewport.getZoom()}},{key:"getZoomScale",value:function(){return this.viewport.getZoomScale()}},{key:"getCenter",value:function(){var P=this.viewport.getCenter(),O=(0,_r.Z)(P,2),q=O[0],ve=O[1];return[q,ve]}},{key:"getFocalDistance",value:function(){return this.viewport.getFocalDistance()}},{key:"getCameraPosition",value:function(){return this.cameraPosition}},{key:"projectFlat",value:function(P,O){return this.viewport.projectFlat(P,O)}},{key:"setViewProjectionMatrix",value:function(P){this.overridedViewProjectionMatrix=P}},{key:"jitterProjectionMatrix",value:function(P,O){var q=Er.fromTranslation(Er.create(),[P,O,0]);this.jitteredProjectionMatrix=Er.multiply(Er.create(),q,this.viewport.getProjectionMatrix()),this.jitteredViewProjectionMatrix=Er.multiply(Er.create(),this.jitteredProjectionMatrix,this.viewport.getViewMatrix())}},{key:"clearJitterProjectionMatrix",value:function(){this.jitteredProjectionMatrix=void 0,this.jitteredViewProjectionMatrix=void 0}}]),N}(),Ke))||Pr),lt,lr,qr;function ut(N,U){var P;if(typeof Symbol=="undefined"||N[Symbol.iterator]==null){if(Array.isArray(N)||(P=It(N))||U&&N&&typeof N.length=="number"){P&&(N=P);var O=0,q=function(){};return{s:q,n:function(){return O>=N.length?{done:!0}:{done:!1,value:N[O++]}},e:function(mr){throw mr},f:q}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var ve=!0,$e=!1,xt;return{s:function(){P=N[Symbol.iterator]()},n:function(){var mr=P.next();return ve=mr.done,mr},e:function(mr){$e=!0,xt=mr},f:function(){try{!ve&&P.return!=null&&P.return()}finally{if($e)throw xt}}}}function It(N,U){if(!!N){if(typeof N=="string")return Qt(N,U);var P=Object.prototype.toString.call(N).slice(8,-1);if(P==="Object"&&N.constructor&&(P=N.constructor.name),P==="Map"||P==="Set")return Array.from(N);if(P==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(P))return Qt(N,U)}}function Qt(N,U){(U==null||U>N.length)&&(U=N.length);for(var P=0,O=new Array(U);P<U;P++)O[P]=N[P];return O}var gr=(lt=(0,w.b2)(),lt(lr=(qr=function(){function N(){(0,le.Z)(this,N),this.container=void 0,this.controlCorners=void 0,this.controlContainer=void 0,this.scene=void 0,this.mapsService=void 0,this.controls=[],this.unAddControls=[]}return(0,ne.Z)(N,[{key:"init",value:function(P,O){this.container=P.container,this.scene=O,this.mapsService=O.get(Q.v.IMapService),this.initControlPos()}},{key:"addControl",value:function(P,O){var q=O.get(Q.v.IMapService);q.map?(P.addTo(this.scene),this.controls.push(P)):this.unAddControls.push(P)}},{key:"getControlByName",value:function(P){return this.controls.find(function(O){return O.controlOption.name===P})}},{key:"removeControl",value:function(P){var O=this.controls.indexOf(P);return O>-1&&this.controls.splice(O,1),P.remove(),this}},{key:"addControls",value:function(){var P=this;this.unAddControls.forEach(function(O){O.addTo(P.scene),P.controls.push(O)}),this.unAddControls=[]}},{key:"destroy",value:function(){var P=ut(this.controls),O;try{for(P.s();!(O=P.n()).done;){var q=O.value;q.remove()}}catch(ve){P.e(ve)}finally{P.f()}this.controls=[],this.clearControlPos()}},{key:"initControlPos",value:function(){var P=this.controlCorners={},O="l7-",q=this.controlContainer=be.SO.create("div",O+"control-container",this.container);function ve($e,xt){var vt=O+$e+" "+O+xt;P[$e+xt]=be.SO.create("div",vt,q)}ve("top","left"),ve("top","right"),ve("bottom","left"),ve("bottom","right")}},{key:"clearControlPos",value:function(){for(var P in this.controlCorners)this.controlCorners[P]&&be.SO.remove(this.controlCorners[P]);this.controlContainer&&be.SO.remove(this.controlContainer),delete this.controlCorners,delete this.controlContainer}}]),N}(),qr))||lr),gn,Cn,vi,xi=(gn=(0,w.b2)(),gn(Cn=(vi=function(){function N(){(0,le.Z)(this,N),this.container=void 0,this.scene=void 0,this.mapsService=void 0,this.markers=[],this.markerLayers=[],this.unAddMarkers=[],this.unAddMarkerLayers=[]}return(0,ne.Z)(N,[{key:"addMarkerLayer",value:function(P){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markerLayers.push(P),P.addTo(this.scene)):this.unAddMarkerLayers.push(P)}},{key:"removeMarkerLayer",value:function(P){P.destroy(),this.markerLayers.indexOf(P);var O=this.markerLayers.indexOf(P);O>-1&&this.markerLayers.splice(O,1)}},{key:"addMarker",value:function(P){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markers.push(P),P.addTo(this.scene)):this.unAddMarkers.push(P)}},{key:"addMarkers",value:function(){var P=this;this.unAddMarkers.forEach(function(O){O.addTo(P.scene),P.markers.push(O)}),this.unAddMarkers=[]}},{key:"addMarkerLayers",value:function(){var P=this;this.unAddMarkerLayers.forEach(function(O){P.markerLayers.push(O),O.addTo(P.scene)}),this.unAddMarkers=[]}},{key:"removeMarker",value:function(P){P.remove(),this.markers.indexOf(P);var O=this.markers.indexOf(P);O>-1&&this.markers.splice(O,1)}},{key:"removeAllMarkers",value:function(){this.destroy()}},{key:"init",value:function(P){this.scene=P,this.mapsService=P.get(Q.v.IMapService)}},{key:"destroy",value:function(){this.markers.forEach(function(P){P.remove()}),this.markers=[],this.markerLayers.forEach(function(P){P.destroy()}),this.markerLayers=[]}},{key:"removeMakerLayerMarker",value:function(P){P.destroy()}}]),N}(),vi))||Cn),Ri,Wi,si,G=(Ri=(0,w.b2)(),Ri(Wi=(si=function(){function N(){(0,le.Z)(this,N),this.scene=void 0,this.popup=void 0,this.mapsService=void 0,this.unAddPopup=void 0}return(0,ne.Z)(N,[{key:"removePopup",value:function(P){P.remove()}},{key:"destroy",value:function(){this.popup.remove()}},{key:"addPopup",value:function(P){this.popup&&this.popup.remove(),this.mapsService.map&&this.mapsService.getMarkerContainer()?(P.addTo(this.scene),this.popup=P):this.unAddPopup=P}},{key:"initPopup",value:function(){this.unAddPopup&&(this.addPopup(this.unAddPopup),this.unAddPopup=null)}},{key:"init",value:function(P){this.scene=P,this.mapsService=P.get(Q.v.IMapService)}}]),N}(),si))||Wi),I=x(82492),Z=x.n(I),$={MapToken:"\u60A8\u6B63\u5728\u4F7F\u7528 Demo\u6D4B\u8BD5\u5730\u56FEtoken\uFF0C\u5982\u679C\u751F\u4EA7\u73AF\u5883\u4E2D\u4F7F\u7528\u53BB\u5BF9\u5E94\u5730\u56FE\u8BF7\u6CE8\u518CToken",SDK:"\u8BF7\u786E\u8BA4\u5F15\u5165\u4E86mapbox-gl api\u4E14\u5728L7\u4E4B\u524D\u5F15\u5165"},ie=$,Le,Ge,ue;function De(N,U){var P=Object.keys(N);if(Object.getOwnPropertySymbols){var O=Object.getOwnPropertySymbols(N);U&&(O=O.filter(function(q){return Object.getOwnPropertyDescriptor(N,q).enumerable})),P.push.apply(P,O)}return P}function wt(N){for(var U=1;U<arguments.length;U++){var P=arguments[U]!=null?arguments[U]:{};U%2?De(Object(P),!0).forEach(function(O){(0,Y.Z)(N,O,P[O])}):Object.getOwnPropertyDescriptors?Object.defineProperties(N,Object.getOwnPropertyDescriptors(P)):De(Object(P)).forEach(function(O){Object.defineProperty(N,O,Object.getOwnPropertyDescriptor(P,O))})}return N}var Ir={id:"map",logoPosition:"bottomleft",logoVisible:!0,antialias:!0,preserveDrawingBuffer:!1,pickBufferScale:1,fitBoundsOptions:{animate:!1}},Ur={colors:["rgb(103,0,31)","rgb(178,24,43)","rgb(214,96,77)","rgb(244,165,130)","rgb(253,219,199)","rgb(247,247,247)","rgb(209,229,240)","rgb(146,197,222)","rgb(67,147,195)","rgb(33,102,172)","rgb(5,48,97)"],size:10,shape:"circle",scales:{},shape2d:["circle","triangle","square","pentagon","hexagon","octogon","hexagram","rhombus","vesica"],shape3d:["cylinder","triangleColumn","hexagonColumn","squareColumn"],minZoom:-1,maxZoom:24,visible:!0,autoFit:!1,pickingBuffer:0,enablePropagation:!1,zIndex:0,blend:"normal",pickedFeatureID:-1,enableMultiPassRenderer:!1,enablePicking:!0,active:!1,activeColor:"#2f54eb",enableHighlight:!1,enableSelect:!1,highlightColor:"#2f54eb",selectColor:"blue",enableTAA:!1,jitterScale:1,enableLighting:!1,animateOption:{enable:!1,interval:.2,duration:4,trailLength:.15},forward:!0},jt=(Le=(0,w.b2)(),Le(Ge=(ue=function(){function N(){(0,le.Z)(this,N),this.sceneConfigCache={},this.layerConfigCache={}}return(0,ne.Z)(N,[{key:"getSceneConfig",value:function(P){return this.sceneConfigCache[P]}},{key:"getSceneWarninfo",value:function(P){return ie[P]}},{key:"setSceneConfig",value:function(P,O){this.sceneConfigCache[P]=wt(wt({},Ir),O)}},{key:"getLayerConfig",value:function(P){return this.layerConfigCache[P]}},{key:"setLayerConfig",value:function(P,O,q){this.layerConfigCache[O]=wt({},Z()({},this.sceneConfigCache[P],Ur,q))}},{key:"clean",value:function(){this.sceneConfigCache={},this.layerConfigCache={}}}]),N}(),ue))||Ge),dr=x(55770),Hr=x(3473),_n=x(98333),vr=Math.PI/180,vn=512,$r=4003e4;function cn(N){var U=N.latitude,P=U===void 0?0:U,O=N.zoom,q=O===void 0?0:O,ve=N.scale,$e=N.highPrecision,xt=$e===void 0?!1:$e,vt=N.flipY,mr=vt===void 0?!1:vt;ve=ve!==void 0?ve:Math.pow(2,q);var Br={},In=vn*ve,Bn=Math.cos(P*vr),fi=In/360,Ci=fi/Bn,wi=In/$r/Bn;if(Br.pixelsPerMeter=[wi,-wi,wi],Br.metersPerPixel=[1/wi,-1/wi,1/wi],Br.pixelsPerDegree=[fi,-Ci,wi],Br.degreesPerPixel=[1/fi,-1/Ci,1/wi],xt){var ha=vr*Math.tan(P*vr)/Bn,Ti=fi*ha/2,Va=In/$r*ha,Bo=Va/Ci*wi;Br.pixelsPerDegree2=[0,-Ti,Va],Br.pixelsPerMeter2=[Bo,0,Bo],mr&&(Br.pixelsPerDegree2[1]=-Br.pixelsPerDegree2[1],Br.pixelsPerMeter2[1]=-Br.pixelsPerMeter2[1])}return mr&&(Br.pixelsPerMeter[1]=-Br.pixelsPerMeter[1],Br.metersPerPixel[1]=-Br.metersPerPixel[1],Br.pixelsPerDegree[1]=-Br.pixelsPerDegree[1],Br.degreesPerPixel[1]=-Br.degreesPerPixel[1]),Br}var pi=x(47282),pn,_i,Xi,mi,Di,Pi,po=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],ji=(pn=(0,w.b2)(),_i=(0,w.f3)(Q.v.ICameraService),pn(Xi=(mi=(Pi=function(){function N(){(0,le.Z)(this,N),this.needRefresh=!0,(0,dr.Z)(this,"cameraService",Di,this),this.coordinateSystem=void 0,this.viewportCenter=void 0,this.viewportCenterProjection=void 0,this.pixelsPerDegree=void 0,this.pixelsPerDegree2=void 0,this.pixelsPerMeter=void 0}return(0,ne.Z)(N,[{key:"refresh",value:function(){var P=this.cameraService.getZoom(),O=this.cameraService.getZoomScale(),q=this.cameraService.getCenter(),ve=cn({latitude:q[1],zoom:P}),$e=ve.pixelsPerMeter,xt=ve.pixelsPerDegree;this.viewportCenter=q,this.viewportCenterProjection=[0,0,0,0],this.pixelsPerMeter=$e,this.pixelsPerDegree=xt,this.pixelsPerDegree2=[0,0,0],this.coordinateSystem===pi.l.LNGLAT||this.coordinateSystem===pi.l.P20?this.cameraService.setViewProjectionMatrix(void 0):this.coordinateSystem===pi.l.LNGLAT_OFFSET?this.calculateLnglatOffset(q,P):this.coordinateSystem===pi.l.P20_OFFSET&&this.calculateLnglatOffset(q,P,O,!0),this.needRefresh=!1}},{key:"getCoordinateSystem",value:function(){return this.coordinateSystem}},{key:"setCoordinateSystem",value:function(P){this.coordinateSystem=P}},{key:"getViewportCenter",value:function(){return this.viewportCenter}},{key:"getViewportCenterProjection",value:function(){return this.viewportCenterProjection}},{key:"getPixelsPerDegree",value:function(){return this.pixelsPerDegree}},{key:"getPixelsPerDegree2",value:function(){return this.pixelsPerDegree2}},{key:"getPixelsPerMeter",value:function(){return this.pixelsPerMeter}},{key:"calculateLnglatOffset",value:function(P,O,q,ve){var $e=cn({latitude:P[1],zoom:O,scale:q,flipY:ve,highPrecision:!0}),xt=$e.pixelsPerMeter,vt=$e.pixelsPerDegree,mr=$e.pixelsPerDegree2,Br=this.cameraService.getViewMatrix(),In=this.cameraService.getProjectionMatrix(),Bn=Er.multiply([],In,Br),fi=this.cameraService.projectFlat([Math.fround(P[0]),Math.fround(P[1])],Math.pow(2,O));this.viewportCenterProjection=_n.fF([],[fi[0],fi[1],0,1],Bn),Br=this.cameraService.getViewMatrixUncentered()||Br,Bn=Er.multiply([],In,Br),Bn=Er.multiply([],Bn,po),this.cameraService.setViewProjectionMatrix(Bn),this.pixelsPerMeter=xt,this.pixelsPerDegree=vt,this.pixelsPerDegree2=mr}}]),N}(),Pi),Di=(0,Hr.Z)(mi.prototype,"cameraService",[_i],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mi))||Xi),Rn=x(63349),Dn=x(50840),li=x.n(Dn),Vn=x(89648),Na,ps,ki,Ba,xu,uu,_a,oo;function Wa(N){var U=Xa();return function(){var O=(0,S.Z)(N),q;if(U){var ve=(0,S.Z)(this).constructor;q=Reflect.construct(O,arguments,ve)}else q=O.apply(this,arguments);return(0,Dt.Z)(this,q)}}function Xa(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(N){return!1}}var Wo={panstart:"dragstart",panmove:"dragging",panend:"dragend",pancancel:"dragcancle"},sa=(Na=(0,w.b2)(),ps=(0,w.f3)(Q.v.IMapService),ki=(0,w.f3)(Q.v.ILogService),Na(Ba=(xu=(oo=function(N){(0,Mt.Z)(P,N);var U=Wa(P);function P(){var O;(0,le.Z)(this,P);for(var q=arguments.length,ve=new Array(q),$e=0;$e<q;$e++)ve[$e]=arguments[$e];return O=U.call.apply(U,[this].concat(ve)),(0,dr.Z)(O,"mapService",uu,(0,Rn.Z)(O)),(0,dr.Z)(O,"logger",_a,(0,Rn.Z)(O)),O.hammertime=void 0,O.lastClickTime=0,O.lastClickXY=[-1,-1],O.clickTimer=void 0,O.$containter=void 0,O.onDrag=function(xt){var vt=O.interactionEvent(xt);vt.type=Wo[vt.type],O.emit(Vn.s.Drag,vt)},O.onHammer=function(xt){xt.srcEvent.stopPropagation();var vt=O.interactionEvent(xt);O.emit(Vn.s.Hover,vt)},O.onTouch=function(xt){var vt=xt.touches[0];O.onHover({x:vt.pageX,y:vt.pageY,type:"touch"})},O.onHover=function(xt){var vt=xt.clientX,mr=xt.clientY,Br=vt,In=mr,Bn=xt.type,fi=O.mapService.getMapContainer();if(fi){var Ci=fi.getBoundingClientRect(),wi=Ci.top,ha=Ci.left;Br=Br-ha-fi.clientLeft,In=In-wi-fi.clientTop}var Ti=O.mapService.containerToLngLat([Br,In]);if(Bn==="click"){if("ontouchstart"in document.documentElement)return;O.isDoubleTap(Br,In,Ti);return}if(Bn==="touch"){O.isDoubleTap(Br,In,Ti);return}Bn!=="click"&&Bn!=="dblclick"&&O.emit(Vn.s.Hover,{x:Br,y:In,lngLat:Ti,type:Bn,target:xt})},O}return(0,ne.Z)(P,[{key:"init",value:function(){this.addEventListenerOnMap(),this.$containter=this.mapService.getMapContainer()}},{key:"destroy",value:function(){this.hammertime&&this.hammertime.destroy(),this.removeEventListenerOnMap(),this.off(Vn.s.Hover)}},{key:"triggerHover",value:function(q){var ve=q.x,$e=q.y;this.emit(Vn.s.Hover,{x:ve,y:$e})}},{key:"triggerSelect",value:function(q){this.emit(Vn.s.Select,{featureId:q})}},{key:"triggerActive",value:function(q){this.emit(Vn.s.Active,{featureId:q})}},{key:"addEventListenerOnMap",value:function(){var q=this.mapService.getMapContainer();if(q){var ve=new(li()).Manager(q);ve.add(new(li()).Tap({event:"dblclick",taps:2})),ve.add(new(li()).Tap({event:"click"})),ve.add(new(li()).Pan({threshold:0,pointers:0})),ve.add(new(li()).Press({})),ve.on("dblclick click",this.onHammer),ve.on("panstart panmove panend pancancel",this.onDrag),q.addEventListener("mousemove",this.onHover),q.addEventListener("mousedown",this.onHover,!0),q.addEventListener("mouseup",this.onHover),q.addEventListener("contextmenu",this.onHover),this.hammertime=ve,this.logger.debug("add event listeners on canvas")}}},{key:"removeEventListenerOnMap",value:function(){var q=this.mapService.getMapContainer();q&&(q.removeEventListener("mousemove",this.onHover),this.hammertime.off("panstart panmove panend pancancel",this.onDrag),q.removeEventListener("mousedown",this.onHover),q.removeEventListener("mouseup",this.onHover),q.removeEventListener("contextmenu",this.onHover))}},{key:"interactionEvent",value:function(q){var ve=q.type,$e=q.pointerType,xt,vt;$e==="touch"?(vt=Math.floor(q.pointers[0].clientY),xt=Math.floor(q.pointers[0].clientX)):(vt=Math.floor(q.srcEvent.y),xt=Math.floor(q.srcEvent.x));var mr=this.mapService.getMapContainer();if(mr){var Br=mr.getBoundingClientRect(),In=Br.top,Bn=Br.left;xt-=Bn,vt-=In}var fi=this.mapService.containerToLngLat([xt,vt]);return{x:xt,y:vt,lngLat:fi,type:ve,target:q.srcEvent}}},{key:"isDoubleTap",value:function(q,ve,$e){var xt=this,vt=new Date().getTime(),mr="click";vt-this.lastClickTime<400&&Math.abs(this.lastClickXY[0]-q)<10&&Math.abs(this.lastClickXY[1]-ve)<10?(this.lastClickTime=0,this.lastClickXY=[-1,-1],this.clickTimer&&clearTimeout(this.clickTimer),mr="dblclick",this.emit(Vn.s.Hover,{x:q,y:ve,lngLat:$e,type:mr})):(this.lastClickTime=vt,this.lastClickXY=[q,ve],this.clickTimer=setTimeout(function(){mr="click",xt.emit(Vn.s.Hover,{x:q,y:ve,lngLat:$e,type:mr})},400))}}]),P}(p()),oo),uu=(0,Hr.Z)(xu.prototype,"mapService",[ps],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_a=(0,Hr.Z)(xu.prototype,"logger",[ki],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xu))||Ba),Ya=x(92137),Ta=x(87757),xa=x.n(Ta),ta=x(7648),sl,rs,qa,La,fa,he,Pe,ct,cr,tn,kn,Zi;function Yi(N,U){var P=Object.keys(N);if(Object.getOwnPropertySymbols){var O=Object.getOwnPropertySymbols(N);U&&(O=O.filter(function(q){return Object.getOwnPropertyDescriptor(N,q).enumerable})),P.push.apply(P,O)}return P}function Ka(N){for(var U=1;U<arguments.length;U++){var P=arguments[U]!=null?arguments[U]:{};U%2?Yi(Object(P),!0).forEach(function(O){(0,Y.Z)(N,O,P[O])}):Object.getOwnPropertyDescriptors?Object.defineProperties(N,Object.getOwnPropertyDescriptors(P)):Yi(Object(P)).forEach(function(O){Object.defineProperty(N,O,Object.getOwnPropertyDescriptor(P,O))})}return N}var $a=(sl=(0,w.b2)(),rs=(0,w.f3)(Q.v.IRendererService),qa=(0,w.f3)(Q.v.IGlobalConfigService),La=(0,w.f3)(Q.v.IInteractionService),fa=(0,w.f3)(Q.v.ILayerService),sl(he=(Pe=(Zi=function(){function N(){var U=this;(0,le.Z)(this,N),(0,dr.Z)(this,"rendererService",ct,this),(0,dr.Z)(this,"configService",cr,this),(0,dr.Z)(this,"interactionService",tn,this),(0,dr.Z)(this,"layerService",kn,this),this.pickingFBO=void 0,this.width=0,this.height=0,this.alreadyInPicking=!1,this.pickBufferScale=1,this.pickFromPickingFBO=function(P,O){var q,ve=O.x,$e=O.y,xt=O.lngLat,vt=O.type,mr=O.target,Br=!1,In=U.rendererService,Bn=In.getViewportSize,fi=In.readPixels,Ci=In.getContainer,wi=Ci().getBoundingClientRect(),ha=wi.width,Ti=wi.height;ha*=be.SO.DPR,Ti*=be.SO.DPR;var Va=P.getLayerConfig(),Bo=Va.enableHighlight,Uo=Va.enableSelect,us=ve*be.SO.DPR,co=$e*be.SO.DPR;if(us>ha-1*be.SO.DPR||us<0||co>Ti-1*be.SO.DPR||co<0)return!1;var ya;if(ya=fi({x:Math.floor(us/U.pickBufferScale),y:Math.floor((Ti-($e+1)*be.SO.DPR)/U.pickBufferScale),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:U.pickingFBO}),ya[0]!==0||ya[1]!==0||ya[2]!==0){var pa=(0,be.W0)(ya),_o=P.getSource().getFeatureById(pa);pa!==P.getCurrentPickId()&&vt==="mousemove"&&(vt="mouseenter");var fo={x:ve,y:$e,type:vt,lngLat:xt,featureId:pa,feature:_o,target:mr};_o&&(Br=!0,P.setCurrentPickId(pa),U.triggerHoverOnLayer(P,fo))}else{var Ga={x:ve,y:$e,lngLat:xt,type:P.getCurrentPickId()!==null&&vt==="mousemove"?"mouseout":"un"+vt,featureId:null,target:mr,feature:null};U.triggerHoverOnLayer(P,Ka(Ka({},Ga),{},{type:"unpick"})),U.triggerHoverOnLayer(P,Ga),P.setCurrentPickId(null)}if(Bo&&U.highlightPickedFeature(P,ya),Uo&&vt==="click"&&((q=ya)===null||q===void 0?void 0:q.toString())!==[0,0,0,0].toString()){var $o=(0,be.W0)(ya);P.getCurrentSelectedId()===null||$o!==P.getCurrentSelectedId()?(U.selectFeature(P,ya),P.setCurrentSelectedId($o)):(U.selectFeature(P,new Uint8Array([0,0,0,0])),P.setCurrentSelectedId(null))}return Br}}return(0,ne.Z)(N,[{key:"init",value:function(P){var O=this.rendererService,q=O.createTexture2D,ve=O.createFramebuffer,$e=O.getViewportSize,xt=O.getContainer,vt=xt().getBoundingClientRect(),mr=vt.width,Br=vt.height;mr*=be.SO.DPR,Br*=be.SO.DPR,this.pickBufferScale=this.configService.getSceneConfig(P).pickBufferScale||1,this.pickingFBO=ve({color:q({width:Math.round(mr/this.pickBufferScale),height:Math.round(Br/this.pickBufferScale),wrapS:ta.gl.CLAMP_TO_EDGE,wrapT:ta.gl.CLAMP_TO_EDGE})}),this.interactionService.on(Vn.s.Hover,this.pickingAllLayer.bind(this))}},{key:"boxPickLayer",value:function(){var U=(0,Ya.Z)(xa().mark(function O(q,ve,$e){var xt=this,vt,mr,Br,In;return xa().wrap(function(fi){for(;;)switch(fi.prev=fi.next){case 0:vt=this.rendererService,mr=vt.useFramebuffer,Br=vt.clear,In=vt.getContainer,this.resizePickingFBO(),mr(this.pickingFBO,function(){Br({framebuffer:xt.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),q.hooks.beforePickingEncode.call(),q.renderModels(),q.hooks.afterPickingEncode.call();var Ci=xt.pickBox(q,ve);$e(Ci)});case 3:case"end":return fi.stop()}},O,this)}));function P(O,q,ve){return U.apply(this,arguments)}return P}()},{key:"pickBox",value:function(P,O){var q=this,ve=O.map(function(Ga){var $o=Ga<0?0:Ga;return Math.floor($o*be.SO.DPR/q.pickBufferScale)}),$e=(0,_r.Z)(ve,4),xt=$e[0],vt=$e[1],mr=$e[2],Br=$e[3],In=this.rendererService,Bn=In.getViewportSize,fi=In.readPixels,Ci=In.getContainer,wi=Ci().getBoundingClientRect(),ha=wi.width,Ti=wi.height;if(ha*=be.SO.DPR,Ti*=be.SO.DPR,xt>(ha-1)*be.SO.DPR/this.pickBufferScale||mr<0||vt>(Ti-1)*be.SO.DPR/this.pickBufferScale||Br<0)return[];var Va,Bo=Math.min(ha/this.pickBufferScale,mr)-xt,Uo=Math.min(Ti/this.pickBufferScale,Br)-vt;Va=fi({x:xt,y:Math.floor(Ti/this.pickBufferScale-(Br+1)),width:Bo,height:Uo,data:new Uint8Array(Bo*Uo*4),framebuffer:this.pickingFBO});for(var us=[],co={},ya=0;ya<Va.length/4;ya=ya+1){var pa=Va.slice(ya*4,ya*4+4),_o=(0,be.W0)(pa);if(_o!==-1&&!co[_o]){var fo=P.getSource().getFeatureById(_o);us.push(fo),co[_o]=!0}}return us}},{key:"pickingAllLayer",value:function(){var U=(0,Ya.Z)(xa().mark(function O(q){return xa().wrap(function($e){for(;;)switch($e.prev=$e.next){case 0:if(!(this.alreadyInPicking||this.layerService.alreadyInRendering)){$e.next=2;break}return $e.abrupt("return");case 2:return this.alreadyInPicking=!0,$e.next=5,this.pickingLayers(q);case 5:this.layerService.renderLayers(),this.alreadyInPicking=!1;case 7:case"end":return $e.stop()}},O,this)}));function P(O){return U.apply(this,arguments)}return P}()},{key:"resizePickingFBO",value:function(){var P=this.rendererService.getContainer,O=P().getBoundingClientRect(),q=O.width,ve=O.height;q*=be.SO.DPR,ve*=be.SO.DPR,(this.width!==q||this.height!==ve)&&(this.pickingFBO.resize({width:Math.round(q/this.pickBufferScale),height:Math.round(ve/this.pickBufferScale)}),this.width=q,this.height=ve)}},{key:"pickingLayers",value:function(){var U=(0,Ya.Z)(xa().mark(function O(q){var ve=this,$e,xt,vt,mr,Br;return xa().wrap(function(Bn){for(;;)switch(Bn.prev=Bn.next){case 0:$e=this.rendererService,xt=$e.getViewportSize,vt=$e.useFramebuffer,mr=$e.clear,Br=$e.getContainer,this.resizePickingFBO(),vt(this.pickingFBO,function(){var fi=ve.layerService.getLayers();fi.filter(function(Ci){return Ci.needPick(q.type)}).reverse().some(function(Ci){mr({framebuffer:ve.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),Ci.hooks.beforePickingEncode.call(),Ci.renderModels(),Ci.hooks.afterPickingEncode.call();var wi=ve.pickFromPickingFBO(Ci,q);return wi&&!Ci.getLayerConfig().enablePropagation})});case 3:case"end":return Bn.stop()}},O,this)}));function P(O){return U.apply(this,arguments)}return P}()},{key:"triggerHoverOnLayer",value:function(P,O){P.emit(O.type,O)}},{key:"isEventCrash",value:function(P){var O=!0;return P.target.path.map(function(q){q.classList&&q.classList.forEach(function(ve){(ve==="l7-marker"||ve==="l7-popup")&&(O=!1)})}),O}},{key:"highlightPickedFeature",value:function(P,O){var q=(0,_r.Z)(O,3),ve=q[0],$e=q[1],xt=q[2];P.hooks.beforeHighlight.call([ve,$e,xt])}},{key:"selectFeature",value:function(P,O){var q=(0,_r.Z)(O,3),ve=q[0],$e=q[1],xt=q[2];P.hooks.beforeSelect.call([ve,$e,xt])}}]),N}(),Zi),ct=(0,Hr.Z)(Pe.prototype,"rendererService",[rs],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cr=(0,Hr.Z)(Pe.prototype,"configService",[qa],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tn=(0,Hr.Z)(Pe.prototype,"interactionService",[La],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kn=(0,Hr.Z)(Pe.prototype,"layerService",[fa],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Pe))||he),Xo=function(){function N(){var U=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;(0,le.Z)(this,N),this.autoStart=void 0,this.startTime=0,this.oldTime=0,this.running=!1,this.elapsedTime=0,this.autoStart=U}return(0,ne.Z)(N,[{key:"start",value:function(){this.startTime=(typeof performance=="undefined"?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}},{key:"stop",value:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}},{key:"getElapsedTime",value:function(){return this.getDelta(),this.elapsedTime}},{key:"getDelta",value:function(){var P=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var O=(typeof performance=="undefined"?Date:performance).now();P=(O-this.oldTime)/1e3,this.oldTime=O,this.elapsedTime+=P}return P}}]),N}(),xs,Hl,Xu,Ro,Cs,so,Ps,Ra,ci=(xs=(0,w.b2)(),Hl=(0,w.f3)(Q.v.IRendererService),Xu=(0,w.f3)(Q.v.IGlobalConfigService),xs(Ro=(Cs=(Ra=function(){function N(){(0,le.Z)(this,N),this.clock=new Xo,this.alreadyInRendering=!1,this.layers=[],this.layerRenderID=void 0,this.sceneInited=!1,this.animateInstanceCount=0,(0,dr.Z)(this,"renderService",so,this),(0,dr.Z)(this,"configService",Ps,this)}return(0,ne.Z)(N,[{key:"add",value:function(P){this.sceneInited&&P.init(),this.layers.push(P)}},{key:"initLayers",value:function(){this.sceneInited=!0,this.layers.forEach(function(P){P.inited||P.init()})}},{key:"getLayers",value:function(){return this.layers}},{key:"getLayer",value:function(P){return this.layers.find(function(O){return O.id===P})}},{key:"getLayerByName",value:function(P){return this.layers.find(function(O){return O.name===P})}},{key:"remove",value:function(P){var O=this.layers.indexOf(P);O>-1&&this.layers.splice(O,1),P.emit("remove",null),P.destroy(),this.renderLayers()}},{key:"removeAllLayers",value:function(){this.destroy()}},{key:"renderLayers",value:function(){this.alreadyInRendering||(this.alreadyInRendering=!0,this.clear(),this.updateRenderOrder(),this.layers.filter(function(P){return P.inited}).filter(function(P){return P.isVisible()}).forEach(function(P){P.hooks.beforeRenderData.call(),P.hooks.beforeRender.call(),P.render(),P.hooks.afterRender.call()}),this.alreadyInRendering=!1)}},{key:"updateRenderOrder",value:function(){this.layers.sort(function(P,O){return P.zIndex-O.zIndex})}},{key:"destroy",value:function(){this.layers.forEach(function(P){return P.destroy()}),this.layers=[],this.renderLayers()}},{key:"startAnimate",value:function(){this.animateInstanceCount++==0&&(this.clock.start(),this.runRender())}},{key:"stopAnimate",value:function(){--this.animateInstanceCount==0&&(this.stopRender(),this.clock.stop())}},{key:"clear",value:function(){this.renderService.clear({color:[0,0,0,0],depth:1,stencil:0,framebuffer:null})}},{key:"runRender",value:function(){this.renderLayers(),this.layerRenderID=requestAnimationFrame(this.runRender.bind(this))}},{key:"stopRender",value:function(){cancelAnimationFrame(this.layerRenderID)}}]),N}(),Ra),so=(0,Hr.Z)(Cs.prototype,"renderService",[Hl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ps=(0,Hr.Z)(Cs.prototype,"configService",[Xu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Cs))||Ro),ul=x(81253),ba=x(85061),Nn=x(14293),Ws=x.n(Nn),Wl=function(){function N(U){var P=this;(0,le.Z)(this,N),this.name=void 0,this.type=void 0,this.scale=void 0,this.descriptor=void 0,this.featureBufferLayout=[],this.needRescale=!1,this.needRemapping=!1,this.needRegenerateVertices=!1,this.featureRange={startIndex:0,endIndex:Infinity},this.vertexAttribute=void 0,this.defaultCallback=function(O){if(O.length===0){var q;return((q=P.scale)===null||q===void 0?void 0:q.defaultValues)||[]}return O.map(function(ve,$e){var xt,vt=(xt=P.scale)===null||xt===void 0?void 0:xt.scalers[$e].func,mr=vt(ve);return mr})},this.setProps(U)}return(0,ne.Z)(N,[{key:"setProps",value:function(P){Object.assign(this,P)}},{key:"mapping",value:function(P){var O;if((O=this.scale)!==null&&O!==void 0&&O.callback){var q,ve=(q=this.scale)===null||q===void 0?void 0:q.callback.apply(q,(0,ba.Z)(P));if(!Ws()(ve))return[ve]}return this.defaultCallback(P)}},{key:"resetDescriptor",value:function(){this.descriptor&&(this.descriptor.buffer.data=[])}}]),N}(),uo,je,Pt,yr,On,Gi,Sa;function Za(N,U){var P=Object.keys(N);if(Object.getOwnPropertySymbols){var O=Object.getOwnPropertySymbols(N);U&&(O=O.filter(function(q){return Object.getOwnPropertyDescriptor(N,q).enumerable})),P.push.apply(P,O)}return P}function ra(N){for(var U=1;U<arguments.length;U++){var P=arguments[U]!=null?arguments[U]:{};U%2?Za(Object(P),!0).forEach(function(O){(0,Y.Z)(N,O,P[O])}):Object.getOwnPropertyDescriptors?Object.defineProperties(N,Object.getOwnPropertyDescriptors(P)):Za(Object(P)).forEach(function(O){Object.defineProperty(N,O,Object.getOwnPropertyDescriptor(P,O))})}return N}function Da(N){return new Promise(function(U){return setTimeout(U,N)})}var Do=(uo={},(0,Y.Z)(uo,ta.gl.FLOAT,4),(0,Y.Z)(uo,ta.gl.UNSIGNED_BYTE,1),(0,Y.Z)(uo,ta.gl.UNSIGNED_SHORT,2),uo),Co=(je=(0,w.b2)(),Pt=(0,w.f3)(Q.v.IRendererService),je(yr=(On=(Sa=function(){function N(){(0,le.Z)(this,N),this.attributesAndIndices=void 0,(0,dr.Z)(this,"rendererService",Gi,this),this.attributes=[],this.triangulation=void 0,this.featureLayout={sizePerElement:0,elements:[]}}return(0,ne.Z)(N,[{key:"registerStyleAttribute",value:function(P){var O=this.getLayerStyleAttribute(P.name||"");return O?O.setProps(P):(O=new Wl(P),this.attributes.push(O)),O}},{key:"updateStyleAttribute",value:function(P,O,q){var ve=this.getLayerStyleAttribute(P);ve||(ve=this.registerStyleAttribute(ra(ra({},O),{},{name:P})));var $e=O.scale;$e&&ve&&(ve.scale=$e,ve.needRescale=!0,ve.needRemapping=!0,ve.needRegenerateVertices=!0,q&&q.featureRange&&(ve.featureRange=q.featureRange))}},{key:"getLayerStyleAttributes",value:function(){return this.attributes}},{key:"getLayerStyleAttribute",value:function(P){return this.attributes.find(function(O){return O.name===P})}},{key:"getLayerAttributeScale",value:function(P){var O,q=this.getLayerStyleAttribute(P),ve=q==null||(O=q.scale)===null||O===void 0?void 0:O.scalers;return ve&&ve[0]?ve[0].func:null}},{key:"updateAttributeByFeatureRange",value:function(P,O){var q=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,ve=arguments.length>3?arguments[3]:void 0,$e=this.attributes.find(function(Uo){return Uo.name===P});if($e&&$e.descriptor){var xt=$e.descriptor,vt=xt.update,mr=xt.buffer,Br=xt.size,In=Br===void 0?0:Br,Bn=Do[mr.type||ta.gl.FLOAT];if(vt){var fi=this.featureLayout,Ci=fi.elements,wi=fi.sizePerElement,ha=Ci.slice(q,ve);if(!ha.length)return;var Ti=ha[0].offset,Va=Ti*In*Bn,Bo=ha.map(function(Uo,us){for(var co=Uo.featureIdx,ya=Uo.vertices,pa=Uo.normals,_o=ya.length/wi,fo=[],Ga=0;Ga<_o;Ga++){var $o=pa?pa.slice(Ga*3,Ga*3+3):[];fo.push.apply(fo,(0,ba.Z)(vt(O[co],co,ya.slice(Ga*wi,Ga*wi+wi),us,$o)))}return fo}).reduce(function(Uo,us){return Uo.push.apply(Uo,(0,ba.Z)(us)),Uo},[]);$e.vertexAttribute.updateBuffer({data:Bo,offset:Va})}}}},{key:"createAttributesAndIndices",value:function(P,O){var q=this;this.featureLayout={sizePerElement:0,elements:[]},O&&(this.triangulation=O);var ve=this.attributes.map(function(Ti){return Ti.resetDescriptor(),Ti.descriptor}),$e=0,xt=[],vt=[],mr=[],Br=3;P.forEach(function(Ti,Va){var Bo=q.triangulation(Ti),Uo=Bo.indices,us=Bo.vertices,co=Bo.normals,ya=Bo.size;Uo.forEach(function(Ga){vt.push(Ga+$e)}),Br=ya;var pa=us.length/ya;q.featureLayout.sizePerElement=Br,q.featureLayout.elements.push({featureIdx:Va,vertices:us,normals:co,offset:$e}),$e+=pa;for(var _o=function($o){var Jo=(co==null?void 0:co.slice($o*3,$o*3+3))||[],oc=us.slice($o*ya,$o*ya+ya);ve.forEach(function(Gl,gs){if(Gl&&Gl.update){var iu;(iu=Gl.buffer.data).push.apply(iu,(0,ba.Z)(Gl.update(Ti,Va,oc,$o,Jo)))}})},fo=0;fo<pa;fo++)_o(fo)});var In=this.rendererService,Bn=In.createAttribute,fi=In.createBuffer,Ci=In.createElements,wi={};ve.forEach(function(Ti,Va){if(Ti){var Bo=Ti.buffer,Uo=Ti.update,us=Ti.name,co=(0,ul.Z)(Ti,["buffer","update","name"]),ya=Bn(ra({buffer:fi(Bo)},co));wi[Ti.name||""]=ya,q.attributes[Va].vertexAttribute=ya}});var ha=Ci({data:vt,type:ta.gl.UNSIGNED_INT,count:vt.length});return this.attributesAndIndices={attributes:wi,elements:ha},this.attributesAndIndices}},{key:"clearAllAttributes",value:function(){var P;this.attributes.forEach(function(O){O.vertexAttribute&&O.vertexAttribute.destroy()}),(P=this.attributesAndIndices)===null||P===void 0||P.elements.destroy(),this.attributes=[]}}]),N}(),Sa),Gi=(0,Hr.Z)(On.prototype,"rendererService",[Pt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),On))||yr),bi=x(90484),Yu=x(34155);function lu(N){if(typeof window!="undefined"&&(0,bi.Z)(window.process)==="object"&&window.process.type==="renderer"||typeof Yu!="undefined"&&(0,bi.Z)(Yu.versions)==="object"&&Boolean(Yu.versions.electron))return!0;var U=(typeof navigator=="undefined"?"undefined":(0,bi.Z)(navigator))==="object"&&typeof navigator.userAgent=="string"&&navigator.userAgent,P=N||U;return!!(P&&P.indexOf("Electron")>=0)}var Yo=x(34155);function ll(){var N=(typeof Yo=="undefined"?"undefined":(0,bi.Z)(Yo))==="object"&&String(Yo)==="[object process]"&&!Yo.browser;return!N||lu()}function bo(){return ll()&&typeof document!="undefined"}var bs=typeof __VERSION__!="undefined"?__VERSION__:"untranspiled source",Po=ll();function cu(N){try{var U=window[N],P="__storage_test__";return U.setItem(P,P),U.removeItem(P),U}catch(O){return null}}var Ms=function(){function N(U,P){var O=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"sessionStorage";(0,le.Z)(this,N),this.storage=cu(O),this.id=U,this.config={},Object.assign(this.config,P),this._loadConfiguration()}return(0,ne.Z)(N,[{key:"getConfiguration",value:function(){return this.config}},{key:"setConfiguration",value:function(P){return this.config={},this.updateConfiguration(P)}},{key:"updateConfiguration",value:function(P){if(Object.assign(this.config,P),this.storage){var O=JSON.stringify(this.config);this.storage.setItem(this.id,O)}return this}},{key:"_loadConfiguration",value:function(){var P={};if(this.storage){var O=this.storage.getItem(this.id);P=O?JSON.parse(O):{}}return Object.assign(this.config,P),this}}]),N}();function uc(N){var U;return N<10?U="".concat(N.toFixed(2),"ms"):N<100?U="".concat(N.toFixed(1),"ms"):N<1e3?U="".concat(N.toFixed(0),"ms"):U="".concat((N/1e3).toFixed(2),"s"),U}function Kc(N){var U=arguments.length>1&&arguments[1]!==void 0?arguments[1]:8,P=Math.max(U-N.length,0);return"".concat(" ".repeat(P)).concat(N)}function Aa(N){var U=arguments.length>1&&arguments[1]!==void 0?arguments[1]:8,P=Math.max(U-N.length,0);return"".concat(N).concat(" ".repeat(P))}function gf(N){var U=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},P=1e-16,O=U.isInteger,q=O===void 0?!1:O;if(Array.isArray(N)||ArrayBuffer.isView(N))return ku(N,U);if(!Number.isFinite(N))return String(N);if(Math.abs(N)<P)return q?"0":"0.";if(q||Math.abs(N)>100&&Math.abs(N)<1e4)return N.toFixed(0);var ve=N.toPrecision(2),$e=ve.indexOf(".0");return $e===ve.length-2?ve.slice(0,-1):ve}function ku(N,U){for(var P=U.maxElts,O=P===void 0?16:P,q=U.size,ve=q===void 0?1:q,$e="[",xt=0;xt<N.length&&xt<O;++xt)xt>0&&($e+=",".concat(xt%ve==0?" ":"")),$e+=gf(N[xt],U);var vt=N.length>O?"...":"]";return"".concat($e).concat(vt)}function Ml(N,U,P){var O=arguments.length>3&&arguments[3]!==void 0?arguments[3]:600,q=N.src.replace(/\(/g,"%28").replace(/\)/g,"%29");N.width>O&&(P=Math.min(P,O/N.width));var ve=N.width*P,$e=N.height*P,xt=["font-size:1px;","padding:".concat(Math.floor($e/2),"px ").concat(Math.floor(ve/2),"px;"),"line-height:".concat($e,"px;"),"background:url(".concat(q,");"),"background-size:".concat(ve,"px ").concat($e,"px;"),"color:transparent;"].join("");return["".concat(U," %c+"),xt]}var Ic={BLACK:30,RED:31,GREEN:32,YELLOW:33,BLUE:34,MAGENTA:35,CYAN:36,WHITE:37,BRIGHT_BLACK:90,BRIGHT_RED:91,BRIGHT_GREEN:92,BRIGHT_YELLOW:93,BRIGHT_BLUE:94,BRIGHT_MAGENTA:95,BRIGHT_CYAN:96,BRIGHT_WHITE:97};function lc(N){return typeof N=="string"?Ic[N.toUpperCase()]||Ic.WHITE:N}function eo(N,U,P){return!Po&&typeof N=="string"&&(U&&(U=lc(U),N="[".concat(U,"m").concat(N,"[39m")),P&&(U=lc(P),N="[".concat(P+10,"m").concat(N,"[49m"))),N}function cl(N){if(typeof Symbol=="undefined"||N[Symbol.iterator]==null){if(Array.isArray(N)||(N=fl(N))){var U=0,P=function(){};return{s:P,n:function(){return U>=N.length?{done:!0}:{done:!1,value:N[U++]}},e:function(vt){throw vt},f:P}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var O,q=!0,ve=!1,$e;return{s:function(){O=N[Symbol.iterator]()},n:function(){var vt=O.next();return q=vt.done,vt},e:function(vt){ve=!0,$e=vt},f:function(){try{!q&&O.return!=null&&O.return()}finally{if(ve)throw $e}}}}function fl(N,U){if(!!N){if(typeof N=="string")return ns(N,U);var P=Object.prototype.toString.call(N).slice(8,-1);if(P==="Object"&&N.constructor&&(P=N.constructor.name),P==="Map"||P==="Set")return Array.from(P);if(P==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(P))return ns(N,U)}}function ns(N,U){(U==null||U>N.length)&&(U=N.length);for(var P=0,O=new Array(U);P<U;P++)O[P]=N[P];return O}function cc(N){var U=arguments.length>1&&arguments[1]!==void 0?arguments[1]:["constructor"],P=Object.getPrototypeOf(N),O=Object.getOwnPropertyNames(P),q=cl(O),ve;try{var $e=function(){var vt=ve.value;typeof N[vt]=="function"&&(U.find(function(mr){return vt===mr})||(N[vt]=N[vt].bind(N)))};for(q.s();!(ve=q.n()).done;)$e()}catch(xt){q.e(xt)}finally{q.f()}}function Ku(N,U){if(!N)throw new Error(U||"Assertion failed")}var Xs=x(34155),Ko={self:typeof self!="undefined"&&self,window:typeof window!="undefined"&&window,global:typeof x.g!="undefined"&&x.g,document:typeof document!="undefined"&&document,process:(typeof Xs=="undefined"?"undefined":(0,bi.Z)(Xs))==="object"&&Xs},Oc=Ko.self||Ko.window||Ko.global,bu=Ko.window||Ko.self||Ko.global,$u=Ko.global||Ko.self||Ko.window,Of=Ko.document||{},hl=Ko.process||{},Ea=console;function Ju(){var N;if(Po&&bu.performance)N=bu.performance.now();else if(hl.hrtime){var U=hl.hrtime();N=U[0]*1e3+U[1]/1e6}else N=Date.now();return N}var Xl={debug:Po&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},Yl={enabled:!0,level:0};function Ys(){}var Lc={},Kl={once:!0};function $l(N){for(var U in N)for(var P in N[U])return P||"untitled";return"empty"}var Qu=function(){function N(){var U=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},P=U.id;(0,le.Z)(this,N),this.id=P,this.VERSION=bs,this._startTs=Ju(),this._deltaTs=Ju(),this.LOG_THROTTLE_TIMEOUT=0,this._storage=new Ms("__probe-".concat(this.id,"__"),Yl),this.userData={},this.timeStamp("".concat(this.id," started")),cc(this),Object.seal(this)}return(0,ne.Z)(N,[{key:"isEnabled",value:function(){return this._storage.config.enabled}},{key:"getLevel",value:function(){return this._storage.config.level}},{key:"getTotal",value:function(){return Number((Ju()-this._startTs).toPrecision(10))}},{key:"getDelta",value:function(){return Number((Ju()-this._deltaTs).toPrecision(10))}},{key:"getPriority",value:function(){return this.level}},{key:"enable",value:function(){var P=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return this._storage.updateConfiguration({enabled:P}),this}},{key:"setLevel",value:function(P){return this._storage.updateConfiguration({level:P}),this}},{key:"assert",value:function(P,O){Ku(P,O)}},{key:"warn",value:function(P){return this._getLogFunction(0,P,Xl.warn,arguments,Kl)}},{key:"error",value:function(P){return this._getLogFunction(0,P,Xl.error,arguments)}},{key:"deprecated",value:function(P,O){return this.warn("`".concat(P,"` is deprecated and will be removed in a later version. Use `").concat(O,"` instead"))}},{key:"removed",value:function(P,O){return this.error("`".concat(P,"` has been removed. Use `").concat(O,"` instead"))}},{key:"probe",value:function(P,O){return this._getLogFunction(P,O,Xl.log,arguments,{time:!0,once:!0})}},{key:"log",value:function(P,O){return this._getLogFunction(P,O,Xl.debug,arguments)}},{key:"info",value:function(P,O){return this._getLogFunction(P,O,console.info,arguments)}},{key:"once",value:function(P,O){return this._getLogFunction(P,O,Xl.debug||Xl.info,arguments,Kl)}},{key:"table",value:function(P,O,q){return O?this._getLogFunction(P,O,console.table||Ys,q&&[q],{tag:$l(O)}):Ys}},{key:"image",value:function(P){var O=P.logLevel,q=P.priority,ve=P.image,$e=P.message,xt=$e===void 0?"":$e,vt=P.scale,mr=vt===void 0?1:vt;return this._shouldLog(O||q)?Po?Rc({image:ve,message:xt,scale:mr}):pl({image:ve,message:xt,scale:mr}):Ys}},{key:"settings",value:function(){console.table?console.table(this._storage.config):console.log(this._storage.config)}},{key:"get",value:function(P){return this._storage.config[P]}},{key:"set",value:function(P,O){this._storage.updateConfiguration((0,Y.Z)({},P,O))}},{key:"time",value:function(P,O){return this._getLogFunction(P,O,console.time?console.time:console.info)}},{key:"timeEnd",value:function(P,O){return this._getLogFunction(P,O,console.timeEnd?console.timeEnd:console.info)}},{key:"timeStamp",value:function(P,O){return this._getLogFunction(P,O,console.timeStamp||Ys)}},{key:"group",value:function(P,O){var q=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{collapsed:!1};q=Il({logLevel:P,message:O,opts:q});var ve=q,$e=ve.collapsed;return q.method=($e?console.groupCollapsed:console.group)||console.info,this._getLogFunction(q)}},{key:"groupCollapsed",value:function(P,O){var q=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this.group(P,O,Object.assign({},q,{collapsed:!0}))}},{key:"groupEnd",value:function(P){return this._getLogFunction(P,"",console.groupEnd||Ys)}},{key:"withGroup",value:function(P,O,q){this.group(P,O)();try{q()}finally{this.groupEnd(P)()}}},{key:"trace",value:function(){console.trace&&console.trace()}},{key:"_shouldLog",value:function(P){return this.isEnabled()&&this.getLevel()>=Su(P)}},{key:"_getLogFunction",value:function(P,O,q){var ve=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[],$e=arguments.length>4?arguments[4]:void 0;if(this._shouldLog(P)){var xt;$e=Il({logLevel:P,message:O,args:ve,opts:$e}),q=q||$e.method,Ku(q),$e.total=this.getTotal(),$e.delta=this.getDelta(),this._deltaTs=Ju();var vt=$e.tag||$e.message;if($e.once)if(!Lc[vt])Lc[vt]=Ju();else return Ys;return O=Ol(this.id,$e.message,$e),(xt=q).bind.apply(xt,[console,O].concat((0,ba.Z)($e.args)))}return Ys}},{key:"level",set:function(P){this.setLevel(P)},get:function(){return this.getLevel()}},{key:"priority",set:function(P){this.level=P},get:function(){return this.level}}]),N}();Qu.VERSION=bs;function Su(N){if(!N)return 0;var U;switch((0,bi.Z)(N)){case"number":U=N;break;case"object":U=N.logLevel||N.priority||0;break;default:return 0}return Ku(Number.isFinite(U)&&U>=0),U}function Il(N){var U=N.logLevel,P=N.message;N.logLevel=Su(U);for(var O=N.args?Array.from(N.args):[];O.length&&O.shift()!==P;);switch(N.args=O,(0,bi.Z)(U)){case"string":case"function":P!==void 0&&O.unshift(P),N.message=U;break;case"object":Object.assign(N,U);break;default:}typeof N.message=="function"&&(N.message=N.message());var q=(0,bi.Z)(N.message);return Ku(q==="string"||q==="object"),Object.assign(N,N.opts)}function Ol(N,U,P){if(typeof U=="string"){var O=P.time?Kc(uc(P.total)):"";U=P.time?"".concat(N,": ").concat(O,"  ").concat(U):"".concat(N,": ").concat(U),U=eo(U,P.color,P.background)}return U}function pl(N){var U=N.image,P=N.message,O=P===void 0?"":P,q=N.scale,ve=q===void 0?1:q,$e=null;try{$e=x(75307)}catch(xt){}return $e?function(){return $e(U,{fit:"box",width:"".concat(Math.round(80*ve),"%")}).then(function(xt){return console.log(xt)})}:Ys}function Rc(N){var U=N.image,P=N.message,O=P===void 0?"":P,q=N.scale,ve=q===void 0?1:q;if(typeof U=="string"){var $e=new Image;return $e.onload=function(){var Br,In=Ml($e,O,ve);(Br=console).log.apply(Br,(0,ba.Z)(In))},$e.src=U,Ys}var xt=U.nodeName||"";if(xt.toLowerCase()==="img"){var vt;return(vt=console).log.apply(vt,(0,ba.Z)(Ml(U,O,ve))),Ys}if(xt.toLowerCase()==="canvas"){var mr=new Image;return mr.onload=function(){var Br;return(Br=console).log.apply(Br,(0,ba.Z)(Ml(mr,O,ve)))},mr.src=U.toDataURL(),Ys}return Ys}var dl,Ks,Ll=new Qu({id:"L7"}).enable(!1);Ll.priority=5;var $c=(dl=(0,w.b2)(),dl(Ks=function(){function N(){(0,le.Z)(this,N)}return(0,ne.Z)(N,[{key:"error",value:function(P){Ll.error(P)()}},{key:"warn",value:function(P){Ll.probe(1,P)()}},{key:"info",value:function(P){Ll.info(3,P)()}},{key:"debug",value:function(P){Ll.probe(4,P)()}}]),N}())||Ks),Jc=x(46343),ma=x(67709),Jl=x.n(ma),fc=window.document.documentElement.style,qu=0;function Rl(N){var U=N;if(typeof N=="string"&&(U=document.getElementById(N)),U){var P=document.createElement("div");return P.style.cssText+=`
      position: absolute;
      z-index:2;
      height: 100%;
      width: 100%;
      pointer-events: none;
    `,P.id="l7-scene-".concat(qu++),P.classList.add("l7-scene"),U.appendChild(P),P}return null}var hc,Fu,Dc,Qc,qc,Dl,kc,Fc,zc,vl,Nc,zu,ka,Ql,Nu,el,Ni,Pa,Ma,ql,kl,ec,yf,_f,Fl,Bu,Uu,to,ds,ml,lo,Tn,Is,tc,gl,$s;function Us(N){var U=yl();return function(){var O=(0,S.Z)(N),q;if(U){var ve=(0,S.Z)(this).constructor;q=Reflect.construct(O,arguments,ve)}else q=O.apply(this,arguments);return(0,Dt.Z)(this,q)}}function yl(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(N){return!1}}var Jr=(hc=(0,w.b2)(),Fu=(0,w.f3)(Q.v.SceneID),Dc=(0,w.f3)(Q.v.IIconService),Qc=(0,w.f3)(Q.v.IFontService),qc=(0,w.f3)(Q.v.IControlService),Dl=(0,w.f3)(Q.v.ILogService),kc=(0,w.f3)(Q.v.IGlobalConfigService),Fc=(0,w.f3)(Q.v.IMapService),zc=(0,w.f3)(Q.v.ICoordinateSystemService),vl=(0,w.f3)(Q.v.IRendererService),Nc=(0,w.f3)(Q.v.ILayerService),zu=(0,w.f3)(Q.v.ICameraService),ka=(0,w.f3)(Q.v.IInteractionService),Ql=(0,w.f3)(Q.v.IPickingService),Nu=(0,w.f3)(Q.v.IShaderModuleService),el=(0,w.f3)(Q.v.IMarkerService),Ni=(0,w.f3)(Q.v.IPopupService),hc(Pa=(Ma=($s=function(N){(0,Mt.Z)(P,N);var U=Us(P);function P(){var O;return(0,le.Z)(this,P),O=U.call(this),O.destroyed=!1,O.loaded=!1,O.loadFont=!1,O.fontFamily="",(0,dr.Z)(O,"id",ql,(0,Rn.Z)(O)),(0,dr.Z)(O,"iconService",kl,(0,Rn.Z)(O)),(0,dr.Z)(O,"fontService",ec,(0,Rn.Z)(O)),(0,dr.Z)(O,"controlService",yf,(0,Rn.Z)(O)),(0,dr.Z)(O,"logger",_f,(0,Rn.Z)(O)),(0,dr.Z)(O,"configService",Fl,(0,Rn.Z)(O)),(0,dr.Z)(O,"map",Bu,(0,Rn.Z)(O)),(0,dr.Z)(O,"coordinateSystemService",Uu,(0,Rn.Z)(O)),(0,dr.Z)(O,"rendererService",to,(0,Rn.Z)(O)),(0,dr.Z)(O,"layerService",ds,(0,Rn.Z)(O)),(0,dr.Z)(O,"cameraService",ml,(0,Rn.Z)(O)),(0,dr.Z)(O,"interactionService",lo,(0,Rn.Z)(O)),(0,dr.Z)(O,"pickingService",Tn,(0,Rn.Z)(O)),(0,dr.Z)(O,"shaderModuleService",Is,(0,Rn.Z)(O)),(0,dr.Z)(O,"markerService",tc,(0,Rn.Z)(O)),(0,dr.Z)(O,"popupService",gl,(0,Rn.Z)(O)),O.inited=!1,O.initPromise=void 0,O.rendering=!1,O.$container=void 0,O.canvas=void 0,O.markerContainer=void 0,O.hooks=void 0,O.handleWindowResized=function(){O.emit("resize"),O.$container&&(O.initContainer(),be.SO.triggerResize(),O.coordinateSystemService.needRefresh=!0,O.render())},O.handleMapCameraChanged=function(q){O.cameraService.update(q),O.render()},O.hooks={init:new Jc.zj},O}return(0,ne.Z)(P,[{key:"init",value:function(q){var ve=this;this.configService.setSceneConfig(this.id,q),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.fontService.init(),this.hooks.init.tapPromise("initMap",(0,Ya.Z)(xa().mark(function $e(){return xa().wrap(function(vt){for(;;)switch(vt.prev=vt.next){case 0:return vt.next=2,new Promise(function(mr){ve.map.onCameraChanged(function(Br){ve.cameraService.init(),ve.cameraService.update(Br),ve.map.version!=="GAODE2.x"&&mr()}),ve.map.version!=="GAODE2.x"?ve.map.init():mr()});case 2:if(!(ve.map.version==="GAODE2.x"&&ve.map.initViewPort)){vt.next=6;break}return vt.next=5,ve.map.init();case 5:ve.map.initViewPort();case 6:ve.map.onCameraChanged(ve.handleMapCameraChanged),ve.map.addMarkerContainer(),ve.markerService.addMarkers(),ve.markerService.addMarkerLayers(),ve.popupService.initPopup(),ve.interactionService.init(),ve.interactionService.on(Vn.s.Drag,ve.addSceneEvent.bind(ve)),ve.logger.debug("map ".concat(ve.id," loaded"));case 14:case"end":return vt.stop()}},$e)}))),this.hooks.init.tapPromise("initRenderer",(0,Ya.Z)(xa().mark(function $e(){var xt;return xa().wrap(function(mr){for(;;)switch(mr.prev=mr.next){case 0:if(xt=Rl(ve.configService.getSceneConfig(ve.id).id||""),ve.$container=xt,!xt){mr.next=11;break}return ve.canvas=be.SO.create("canvas","",xt),ve.setCanvas(),mr.next=7,ve.rendererService.init(ve.canvas,ve.configService.getSceneConfig(ve.id));case 7:Jl()(ve.$container,ve.handleWindowResized),window.matchMedia("screen and (-webkit-min-device-pixel-ratio: 1.5)").addListener(ve.handleWindowResized),mr.next=12;break;case 11:ve.logger.error("\u5BB9\u5668 id \u4E0D\u5B58\u5728");case 12:ve.pickingService.init(ve.id),ve.logger.debug("scene ".concat(ve.id," renderer loaded"));case 14:case"end":return mr.stop()}},$e)}))),this.initPromise=this.hooks.init.promise(),this.render()}},{key:"addLayer",value:function(q){this.logger.debug("add layer ".concat(q.name," to scene ").concat(this.id)),this.layerService.add(q),this.render()}},{key:"render",value:function(){var O=(0,Ya.Z)(xa().mark(function ve(){return xa().wrap(function(xt){for(;;)switch(xt.prev=xt.next){case 0:if(!(this.rendering||this.destroyed)){xt.next=2;break}return xt.abrupt("return");case 2:if(this.rendering=!0,this.inited){xt.next=16;break}return xt.next=6,this.initPromise;case 6:if(this.destroyed&&this.destroy(),!(this.loadFont&&document.fonts)){xt.next=10;break}return xt.next=10,document.fonts.load("24px ".concat(this.fontFamily),"L7text");case 10:this.logger.info(" render inited"),this.layerService.initLayers(),this.controlService.addControls(),this.loaded=!0,this.emit("loaded"),this.inited=!0;case 16:this.layerService.renderLayers(),this.logger.debug("scene ".concat(this.id," render")),this.rendering=!1;case 19:case"end":return xt.stop()}},ve,this)}));function q(){return O.apply(this,arguments)}return q}()},{key:"addFontFace",value:function(q,ve){this.fontFamily=q;var $e=document.createElement("style");$e.type="text/css",$e.innerText=`
        @font-face{
            font-family: '`.concat(q,`';
            src: url('`).concat(ve,`') format('woff2'),
            url('`).concat(ve,`') format('woff'),
            url('`).concat(ve,`') format('truetype');
        }`),document.getElementsByTagName("head")[0].appendChild($e),this.loadFont=!0}},{key:"getSceneContainer",value:function(){return this.$container}},{key:"exportPng",value:function(q){var ve,$e=(ve=this.$container)===null||ve===void 0?void 0:ve.getElementsByTagName("canvas")[0];this.render();var xt=q==="jpg"?$e==null?void 0:$e.toDataURL("image/jpeg"):$e==null?void 0:$e.toDataURL("image/png");return xt}},{key:"getSceneConfig",value:function(){return this.configService.getSceneConfig(this.id)}},{key:"addMarkerContainer",value:function(){var q=this.$container.parentElement;q!==null&&(this.markerContainer=be.SO.create("div","l7-marker-container",q))}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"destroy",value:function(){if(!this.inited){this.destroyed=!0;return}this.emit("destroy"),this.layerService.destroy(),this.rendererService.destroy(),this.map.destroy(),this.interactionService.destroy(),this.controlService.destroy(),this.markerService.destroy(),this.removeAllListeners(),this.inited=!1,(0,ma.unbind)(this.$container,this.handleWindowResized),window.matchMedia("screen and (min-resolution: 2dppx)").removeListener(this.handleWindowResized)}},{key:"initContainer",value:function(){var q,ve,$e=be.SO.DPR,xt=((q=this.$container)===null||q===void 0?void 0:q.clientWidth)||400,vt=((ve=this.$container)===null||ve===void 0?void 0:ve.clientHeight)||300,mr=this.canvas;mr&&(mr.width=xt*$e,mr.height=vt*$e,mr.style.width="".concat(xt,"px"),mr.style.height="".concat(vt,"px")),this.rendererService.viewport({x:0,y:0,width:$e*xt,height:$e*vt})}},{key:"setCanvas",value:function(){var q,ve,$e=be.SO.DPR,xt=((q=this.$container)===null||q===void 0?void 0:q.clientWidth)||400,vt=((ve=this.$container)===null||ve===void 0?void 0:ve.clientHeight)||300,mr=this.canvas;mr.width=xt*$e,mr.height=vt*$e,mr.style.width="".concat(xt,"px"),mr.style.height="".concat(vt,"px")}},{key:"addSceneEvent",value:function(q){this.emit(q.type,q)}}]),P}(E.EventEmitter),$s),ql=(0,Hr.Z)(Ma.prototype,"id",[Fu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kl=(0,Hr.Z)(Ma.prototype,"iconService",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ec=(0,Hr.Z)(Ma.prototype,"fontService",[Qc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yf=(0,Hr.Z)(Ma.prototype,"controlService",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_f=(0,Hr.Z)(Ma.prototype,"logger",[Dl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Fl=(0,Hr.Z)(Ma.prototype,"configService",[kc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Bu=(0,Hr.Z)(Ma.prototype,"map",[Fc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Uu=(0,Hr.Z)(Ma.prototype,"coordinateSystemService",[zc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),to=(0,Hr.Z)(Ma.prototype,"rendererService",[vl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ds=(0,Hr.Z)(Ma.prototype,"layerService",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ml=(0,Hr.Z)(Ma.prototype,"cameraService",[zu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lo=(0,Hr.Z)(Ma.prototype,"interactionService",[ka],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Tn=(0,Hr.Z)(Ma.prototype,"pickingService",[Ql],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Is=(0,Hr.Z)(Ma.prototype,"shaderModuleService",[Nu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tc=(0,Hr.Z)(Ma.prototype,"markerService",[el],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gl=(0,Hr.Z)(Ma.prototype,"popupService",[Ni],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ma))||Pa),Bc=x(44908),pc=x.n(Bc);function tl(N){var U=0;switch(N){case"vec2":case"ivec2":U=2;break;case"vec3":case"ivec3":U=3;break;case"vec4":case"ivec4":case"mat2":U=4;break;case"mat3":U=9;break;case"mat4":U=16;break;default:}return U}var Js=/uniform\s+(bool|float|int|vec2|vec3|vec4|ivec2|ivec3|ivec4|mat2|mat3|mat4|sampler2D|samplerCube)\s+([\s\S]*?);/g;function Ss(N){var U={};return N=N.replace(Js,function(P,O,q){var ve=q.split(":"),$e=ve[0].trim(),xt="";switch(ve.length>1&&(xt=ve[1].trim()),O){case"bool":xt=xt==="true";break;case"float":case"int":xt=Number(xt);break;case"vec2":case"vec3":case"vec4":case"ivec2":case"ivec3":case"ivec4":case"mat2":case"mat3":case"mat4":xt?xt=xt.replace("[","").replace("]","").split(",").reduce(function(vt,mr){return vt.push(Number(mr.trim())),vt},[]):xt=new Array(tl(O)).fill(0);break;default:}return U[$e]=xt,"uniform ".concat(O," ").concat($e,`;
`)}),{content:N,uniforms:U}}var dc,vc,Os;function ju(N,U){var P=Object.keys(N);if(Object.getOwnPropertySymbols){var O=Object.getOwnPropertySymbols(N);U&&(O=O.filter(function(q){return Object.getOwnPropertyDescriptor(N,q).enumerable})),P.push.apply(P,O)}return P}function _l(N){for(var U=1;U<arguments.length;U++){var P=arguments[U]!=null?arguments[U]:{};U%2?ju(Object(P),!0).forEach(function(O){(0,Y.Z)(N,O,P[O])}):Object.getOwnPropertyDescriptors?Object.defineProperties(N,Object.getOwnPropertyDescriptors(P)):ju(Object(P)).forEach(function(O){Object.defineProperty(N,O,Object.getOwnPropertyDescriptor(P,O))})}return N}var zl="#define PI 3.14159265359",ef=`#define SHIFT_RIGHT17 1.0 / 131072.0
#define SHIFT_RIGHT18 1.0 / 262144.0
#define SHIFT_RIGHT19 1.0 / 524288.0
#define SHIFT_RIGHT20 1.0 / 1048576.0
#define SHIFT_RIGHT21 1.0 / 2097152.0
#define SHIFT_RIGHT22 1.0 / 4194304.0
#define SHIFT_RIGHT23 1.0 / 8388608.0
#define SHIFT_RIGHT24 1.0 / 16777216.0

#define SHIFT_LEFT17 131072.0
#define SHIFT_LEFT18 262144.0
#define SHIFT_LEFT19 524288.0
#define SHIFT_LEFT20 1048576.0
#define SHIFT_LEFT21 2097152.0
#define SHIFT_LEFT22 4194304.0
#define SHIFT_LEFT23 8388608.0
#define SHIFT_LEFT24 16777216.0

vec2 unpack_float(float packedValue) {
  int packedIntValue = int(packedValue);
  int v0 = packedIntValue / 256;
  return vec2(v0, packedIntValue - v0 * 256);
}

vec4 decode_color(vec2 encodedColor) {
  return vec4(
    unpack_float(encodedColor[0]) / 255.0,
    unpack_float(encodedColor[1]) / 255.0
  );
}
`,Uc=`#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2


float calc_lighting(vec4 pos) {

    vec3 worldPos = vec3(pos * u_ModelMatrix);

    vec3 worldNormal = a_Normal;
      // //cal light weight
    vec3 viewDir = normalize(u_CameraPosition - worldPos);

    vec3 lightDir = normalize(vec3(1, -10.5, 12));

    vec3 halfDir = normalize(viewDir+lightDir);
      // //lambert
    float lambert = dot(worldNormal, lightDir);
        //specular
    float specular = pow(max(0.0, dot(worldNormal, halfDir)), 32.0);
        //sum to light weight
    float lightWeight = ambientRatio + diffuseRatio * lambert + specularRatio * specular;

    return lightWeight;
}
`,Eu=`// Blinn-Phong model
// apply lighting in vertex shader instead of fragment shader
// @see https://learnopengl.com/Advanced-Lighting/Advanced-Lighting
uniform float u_Ambient : 1.0;
uniform float u_Diffuse : 1.0;
uniform float u_Specular : 1.0;
uniform int u_NumOfDirectionalLights : 1;
uniform int u_NumOfSpotLights : 0;

#define SHININESS 32.0
#define MAX_NUM_OF_DIRECTIONAL_LIGHTS 3
#define MAX_NUM_OF_SPOT_LIGHTS 3

struct DirectionalLight {
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
};

struct SpotLight {
  vec3 position;
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
  float constant;
  float linear;
  float quadratic;
  float angle;
  float blur;
  float exponent;
};

uniform DirectionalLight u_DirectionalLights[MAX_NUM_OF_DIRECTIONAL_LIGHTS];
uniform SpotLight u_SpotLights[MAX_NUM_OF_SPOT_LIGHTS];

vec3 calc_directional_light(DirectionalLight light, vec3 normal, vec3 viewDir) {
  vec3 lightDir = normalize(light.direction);
  // diffuse shading
  float diff = max(dot(normal, lightDir), 0.0);
  // Blinn-Phong specular shading
  vec3 halfwayDir = normalize(lightDir + viewDir);
  float spec = pow(max(dot(normal, halfwayDir), 0.0), SHININESS);

  vec3 ambient = light.ambient * u_Ambient;
  vec3 diffuse = light.diffuse * diff * u_Diffuse;
  vec3 specular = light.specular * spec * u_Specular;

  return ambient + diffuse + specular;
}

// vec3 calc_spot_light(SpotLight light, vec3 normal, vec3 fragPos, vec3 viewDir) {
//   vec3 lightDir = normalize(light.position - fragPos);
//   // diffuse shading
//   float diff = max(dot(normal, lightDir), 0.0);
//   // specular shading
//   vec3 reflectDir = reflect(-lightDir, normal);
//   float spec = pow(max(dot(viewDir, reflectDir), 0.0), SHININESS);
//   // attenuation
//   float distance = length(light.position - fragPos);
//   float attenuation = 1.0 / (light.constant + light.linear * distance +
//           light.quadratic * (distance * distance));

//   vec3 ambient = light.ambient * u_Ambient;
//   vec3 diffuse = light.diffuse * diff * u_Diffuse;
//   vec3 specular = light.specular * spec * u_Specular;

//   float spotEffect = dot(normalize(light.direction), -lightDir);
//   float spotCosCutoff = cos(light.angle / 180.0 * PI);
//   float spotCosOuterCutoff = cos((light.angle + light.blur) / 180.0 * PI);
//   float spotCosInnerCutoff = cos((light.angle - light.blur) / 180.0 * PI);
//   if (spotEffect > spotCosCutoff) {
//     spotEffect = pow(smoothstep(spotCosOuterCutoff, spotCosInnerCutoff, spotEffect), light.exponent);
//   } else {
//     spotEffect = 0.0;
//   }

//   return ambient + attenuation * (spotEffect * diffuse + specular);
// }

vec3 calc_lighting(vec3 position, vec3 normal, vec3 viewDir) {
  vec3 weight = vec3(0.0);
  for (int i = 0; i < MAX_NUM_OF_DIRECTIONAL_LIGHTS; i++) {
    if (i >= u_NumOfDirectionalLights) {
      break;
    }
    weight += calc_directional_light(u_DirectionalLights[i], normal, viewDir);
  }
  // for (int i = 0; i < MAX_NUM_OF_SPOT_LIGHTS; i++) {
  //   if (i >= u_NumOfSpotLights) {
  //     break;
  //   }
  //   weight += calc_spot_light(u_SpotLights[i], normal, position, viewDir);
  // }
  return weight;
}
`,Qs=`varying vec4 v_PickingResult;
uniform vec4 u_HighlightColor : [0, 0, 0, 0];
uniform float u_PickingStage : 0.0;

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

/*
 * Returns highlight color if this item is selected.
 */
vec4 filterHighlightColor(vec4 color) {
  bool selected = bool(v_PickingResult.a);

  if (selected) {
    vec4 highLightColor = u_HighlightColor * COLOR_SCALE;

    float highLightAlpha = highLightColor.a;
    float highLightRatio = highLightAlpha / (highLightAlpha + color.a * (1.0 - highLightAlpha));

    vec3 resultRGB = mix(color.rgb, highLightColor.rgb, highLightRatio);
    return vec4(resultRGB, color.a);
  } else {
    return color;
  }
}

/*
 * Returns picking color if picking enabled else unmodified argument.
 */
vec4 filterPickingColor(vec4 color) {
  vec3 pickingColor = v_PickingResult.rgb;
  if (u_PickingStage == PICKING_ENCODE && length(pickingColor) < 0.001) {
    discard;
  }
  return u_PickingStage == PICKING_ENCODE ? vec4(pickingColor, step(0.001,color.a)): color;
}

/*
 * Returns picking color if picking is enabled if not
 * highlight color if this item is selected, otherwise unmodified argument.
 */
vec4 filterColor(vec4 color) {
  return filterPickingColor(filterHighlightColor(color));
}
`,Fi=`attribute vec3 a_PickingColor;
varying vec4 v_PickingResult;

uniform vec3 u_PickingColor : [0, 0, 0];
uniform vec4 u_HighlightColor : [0, 0, 0, 0];
uniform float u_PickingStage : 0.0;
uniform float u_PickingThreshold : 1.0;
uniform float u_PickingBuffer: 0.0;

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

bool isVertexPicked(vec3 vertexColor) {
  return
    abs(vertexColor.r - u_PickingColor.r) < u_PickingThreshold &&
    abs(vertexColor.g - u_PickingColor.g) < u_PickingThreshold &&
    abs(vertexColor.b - u_PickingColor.b) < u_PickingThreshold;
}

void setPickingColor(vec3 pickingColor) {
  // compares only in highlight stage
  v_PickingResult.a = float((u_PickingStage == PICKING_HIGHLIGHT) && isVertexPicked(pickingColor));

  // Stores the picking color so that the fragment shader can render it during picking
  v_PickingResult.rgb = pickingColor * COLOR_SCALE;
}

float setPickingSize(float x) {
   return u_PickingStage == PICKING_ENCODE ? x + u_PickingBuffer : x;
}

float setPickingOrder(float z) {
   bool selected = bool(v_PickingResult.a);
   return selected ? z + 1. : 0.;
}
`,Zu=`
#define E 2.718281828459045
vec2 ProjectFlat(vec2 lnglat){
  float maxs=85.0511287798;
  float lat=max(min(maxs,lnglat.y),-maxs);
  float scale= 268435456.;
  float d=PI/180.;
  float x=lnglat.x*d;
  float y=lat*d;
  y=log(tan((PI/4.)+(y/2.)));

  float a=.5/PI,
  b=.5,
  c=-.5/PI;
  d=.5;
  x=scale*(a*x+b);
  y=scale*(c*y+d);
  return vec2(x,y);
}

vec2 unProjectFlat(vec2 px){
  float a=.5/PI;
  float b=.5;
  float c=-.5/PI;
  float d=.5;
  float scale = 268435456.;
  float x=(px.x/scale-b)/a;
  float y=(px.y/scale-d)/c;
  y=(atan(pow(E,y))-(PI/4.))*2.;
  d=PI/180.;
  float lat=y/d;
  float lng=x/d;
  return vec2(lng,lat);
}

float pixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}

// gaode2.0
vec2 customProject(vec2 lnglat) { // \u7ECF\u7EAC\u5EA6 => \u5E73\u9762\u5750\u6807
  float t = lnglat.x;
  float e = lnglat.y;
  float Sm = 180.0 / PI;
  float Tm = 6378137.0;
  float Rm = PI / 180.0;
  float r = 85.0511287798;
  e = max(min(r, e), -r);
  t *= Rm;
  e *= Rm;
  e = log(tan(PI / 4.0 + e / 2.0));
  return vec2(t * Tm, e * Tm);
}

vec2 unProjCustomCoord(vec2 point) { // \u5E73\u9762\u5750\u6807 => \u7ECF\u7EAC\u5EA6
  float Sm = 57.29577951308232; //180 / Math.PI
  float Tm = 6378137.0;
  float t = point.x;
  float e = point.y;
  return vec2(t / Tm * Sm, (2.0 * atan(exp(e / Tm)) - PI / 2.0) * Sm);
}


float customPixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}`,is=`#define TILE_SIZE 512.0
#define PI 3.1415926536
#define WORLD_SCALE TILE_SIZE / (PI * 2.0)

#define COORDINATE_SYSTEM_LNGLAT 1.0
#define COORDINATE_SYSTEM_LNGLAT_OFFSET 2.0
#define COORDINATE_SYSTEM_VECTOR_TILE 3.0
#define COORDINATE_SYSTEM_IDENTITY 4.0
#define COORDINATE_SYSTEM_P20 5.0
#define COORDINATE_SYSTEM_P20_OFFSET 6.0
#define COORDINATE_SYSTEM_METER_OFFSET 7.0

#define COORDINATE_SYSTEM_P20_2 8.0

uniform mat4 u_ViewMatrix;
uniform mat4 u_ProjectionMatrix;
uniform mat4 u_ViewProjectionMatrix;
uniform float u_Zoom : 1;
uniform float u_ZoomScale : 1;

uniform float u_CoordinateSystem;
uniform vec2 u_ViewportCenter;
uniform vec4 u_ViewportCenterProjection;
uniform vec3 u_PixelsPerDegree;
uniform vec3 u_PixelsPerDegree2;
uniform vec3 u_PixelsPerMeter;

uniform vec2 u_ViewportSize;
uniform float u_DevicePixelRatio;
uniform float u_FocalDistance;
uniform vec3 u_CameraPosition;

// uniform mat4 u_Mvp;

// web mercator coords -> world coords
vec2 project_mercator(vec2 lnglat) {
  float x = lnglat.x;
  return vec2(
    radians(x) + PI,
    PI - log(tan(PI * 0.25 + radians(lnglat.y) * 0.5))
  );
}

float project_scale(float meters) {
  return meters * u_PixelsPerMeter.z;
}


// offset coords -> world coords
vec4 project_offset(vec4 offset) {
  float dy = offset.y;
  dy = clamp(dy, -1., 1.);
  vec3 pixels_per_unit = u_PixelsPerDegree + u_PixelsPerDegree2 * dy;
  return vec4(offset.xyz * pixels_per_unit, offset.w);
}

vec3 project_normal(vec3 normal) {
  vec4 normal_modelspace = u_ModelMatrix * vec4(normal, 0.0);
  return normalize(normal_modelspace.xyz * u_PixelsPerMeter);
}

vec3 project_offset_normal(vec3 vector) {
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01
    || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // normals generated by the polygon tesselator are in lnglat offsets instead of meters
    return normalize(vector * u_PixelsPerDegree);
  }
  return project_normal(vector);
}
// || u_CoordinateSystem < COORDINATE_SYSTEM_P20_OFFSET + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_P20_OFFSET - 0.01
// reverse Y
vec3 reverse_offset_normal(vec3 vector) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 ||u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET ) {
    return vector * vec3(1.0, -1.0, 1.0);
  }

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.0
    return vector;
  }
  return vector;
}

vec4 project_position(vec4 position) {
  float a = COORDINATE_SYSTEM_LNGLAT_OFFSET;
  float b = COORDINATE_SYSTEM_P20_OFFSET;
  float c = COORDINATE_SYSTEM_LNGLAT;
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
    || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    float X = position.x - u_ViewportCenter.x;
    float Y = position.y - u_ViewportCenter.y;
    return project_offset(vec4(X, Y, position.z, position.w));
  }
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01) {
    return vec4(
      project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale,
      project_scale(position.z),
      position.w
    );
  }

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {
    return vec4(
      (project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale - vec2(215440491., 106744817.)) * vec2(1., -1.),
      project_scale(position.z),
      position.w
    );
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // return vec4(
    //   (position.xy * WORLD_SCALE * u_ZoomScale) * vec2(1., -1.), 
    //   project_scale(position.z), 
    //   position.w);

     return vec4(
      position.xy, 
      project_scale(position.z), 
      position.w);
  }
  return position;

  // TODO: \u74E6\u7247\u5750\u6807\u7CFB & \u5E38\u89C4\u4E16\u754C\u5750\u6807\u7CFB
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
  vec2 offset = pixels / u_ViewportSize * u_DevicePixelRatio * 2.0;
  return offset * u_FocalDistance;
}

float project_pixel(float pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel;
}
vec2 project_pixel(vec2 pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel * -1.;
}

vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
    position.w *= u_PixelsPerMeter.z;
  }

  return viewProjectionMatrix * position + center;
}

// Projects from common space coordinates to clip space
vec4 project_common_position_to_clipspace(vec4 position) {
  return project_common_position_to_clipspace(
    position,
    u_ViewProjectionMatrix,
    u_ViewportCenterProjection
  );
}

vec4 unproject_clipspace_to_position(vec4 clipspacePos, mat4 u_InverseViewProjectionMatrix) {
  vec4 pos = u_InverseViewProjectionMatrix * (clipspacePos - u_ViewportCenterProjection);

  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
     pos.w = pos.w / u_PixelsPerMeter.z;
  }
  return pos;
}


bool isEqual( float a,  float b) {
    return  a< b + 0.001 && a > b - 0.001;
}`,Mo=`/**
 * 2D signed distance field functions
 * @see http://www.iquilezles.org/www/articles/distfunctions2d/distfunctions2d.htm
 */

float ndot(vec2 a, vec2 b ) { return a.x*b.x - a.y*b.y; }

float sdCircle(vec2 p, float r) {
  return length(p) - r;
}

float sdEquilateralTriangle(vec2 p) {
  float k = sqrt(3.0);
  p.x = abs(p.x) - 1.0;
  p.y = p.y + 1.0/k;
  if( p.x + k*p.y > 0.0 ) p = vec2(p.x-k*p.y,-k*p.x-p.y)/2.0;
  p.x -= clamp( p.x, -2.0, 0.0 );
  return -length(p)*sign(p.y);
}

float sdBox(vec2 p, vec2 b) {
  vec2 d = abs(p)-b;
  return length(max(d,vec2(0))) + min(max(d.x,d.y),0.0);
}

float sdPentagon(vec2 p, float r) {
  vec3 k = vec3(0.809016994,0.587785252,0.726542528);
  p.x = abs(p.x);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= vec2(clamp(p.x,-r*k.z,r*k.z),r);
  return length(p)*sign(p.y);
}

float sdHexagon(vec2 p, float r) {
  vec3 k = vec3(-0.866025404,0.5,0.577350269);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdOctogon(vec2 p, float r) {
  vec3 k = vec3(-0.9238795325, 0.3826834323, 0.4142135623 );
  p = abs(p);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdHexagram(vec2 p, float r) {
  vec4 k=vec4(-0.5,0.8660254038,0.5773502692,1.7320508076);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= 2.0*min(dot(k.yx,p),0.0)*k.yx;
  p -= vec2(clamp(p.x,r*k.z,r*k.w),r);
  return length(p)*sign(p.y);
}

float sdRhombus(vec2 p, vec2 b) {
  vec2 q = abs(p);
  float h = clamp((-2.0*ndot(q,b)+ndot(b,b))/dot(b,b),-1.0,1.0);
  float d = length( q - 0.5*b*vec2(1.0-h,1.0+h) );
  return d * sign( q.x*b.y + q.y*b.x - b.x*b.y );
}

float sdVesica(vec2 p, float r, float d) {
  p = abs(p);
  float b = sqrt(r*r-d*d); // can delay this sqrt
  return ((p.y-b)*d>p.x*b)
          ? length(p-vec2(0.0,b))
          : length(p-vec2(-d,0.0))-r;
}
`,xl=/precision\s+(high|low|medium)p\s+float/,rl=`#ifdef GL_FRAGMENT_PRECISION_HIGH
 precision highp float;
 #else
 precision mediump float;
#endif
`,fu=/#pragma include (["^+"]?["\ "[a-zA-Z_0-9](.*)"]*?)/g,vs=(dc=(0,w.b2)(),dc(vc=(Os=function(){function N(){(0,le.Z)(this,N),this.moduleCache={},this.rawContentCache={}}return(0,ne.Z)(N,[{key:"registerBuiltinModules",value:function(){this.destroy(),this.registerModule("common",{vs:zl,fs:zl}),this.registerModule("decode",{vs:ef,fs:""}),this.registerModule("projection",{vs:is,fs:""}),this.registerModule("project",{vs:Zu,fs:""}),this.registerModule("sdf_2d",{vs:"",fs:Mo}),this.registerModule("lighting",{vs:Eu,fs:""}),this.registerModule("light",{vs:Uc,fs:""}),this.registerModule("picking",{vs:Fi,fs:Qs})}},{key:"registerModule",value:function(P,O){if(!this.rawContentCache[P]){var q=O.vs,ve=O.fs,$e=O.uniforms,xt=Ss(q),vt=xt.content,mr=xt.uniforms,Br=Ss(ve),In=Br.content,Bn=Br.uniforms;this.rawContentCache[P]={fs:In,uniforms:_l(_l(_l({},mr),Bn),$e),vs:vt}}}},{key:"destroy",value:function(){this.moduleCache={},this.rawContentCache={}}},{key:"getModule",value:function(P){var O=this;if(this.moduleCache[P])return this.moduleCache[P];var q=this.rawContentCache[P].vs,ve=this.rawContentCache[P].fs,$e=this.processModule(q,[],"vs"),xt=$e.content,vt=$e.includeList,mr=this.processModule(ve,[],"fs"),Br=mr.content,In=mr.includeList,Bn=Br,fi=pc()(vt.concat(In).concat(P)).reduce(function(Ci,wi){return _l(_l({},Ci),O.rawContentCache[wi].uniforms)},{});return xl.test(Br)||(Bn=rl+Br),this.moduleCache[P]={fs:Bn.trim(),uniforms:fi,vs:xt.trim()},this.moduleCache[P]}},{key:"processModule",value:function(P,O,q){var ve=this,$e=P.replace(fu,function(xt,vt){var mr=vt.split(" "),Br=mr[0].replace(/"/g,"");if(O.indexOf(Br)>-1)return"";var In=ve.rawContentCache[Br][q];O.push(Br);var Bn=ve.processModule(In,O,q),fi=Bn.content;return fi});return{content:$e,includeList:O}}}]),N}(),Os))||vc),nl=x(66213),Un=x(92364),Mn,rc,as,vo,ko,hu,js=(Mn=(0,w.b2)(),rc=(0,w.f3)(Q.v.IShaderModuleService),Mn(as=(vo=(hu=function(){function N(){(0,le.Z)(this,N),(0,dr.Z)(this,"shaderModuleService",ko,this),this.rendererService=void 0,this.cameraService=void 0,this.mapService=void 0,this.interactionService=void 0,this.layerService=void 0,this.config=void 0}return(0,ne.Z)(N,[{key:"getName",value:function(){return""}},{key:"getType",value:function(){return Un.G.Normal}},{key:"init",value:function(P,O){this.config=O,this.rendererService=P.getContainer().get(Q.v.IRendererService),this.cameraService=P.getContainer().get(Q.v.ICameraService),this.mapService=P.getContainer().get(Q.v.IMapService),this.interactionService=P.getContainer().get(Q.v.IInteractionService),this.layerService=P.getContainer().get(Q.v.ILayerService)}},{key:"render",value:function(P){}}]),N}(),hu),ko=(0,Hr.Z)(vo.prototype,"shaderModuleService",[rc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vo))||as),Nl,Ki;function So(N){var U=tf();return function(){var O=(0,S.Z)(N),q;if(U){var ve=(0,S.Z)(this).constructor;q=Reflect.construct(O,arguments,ve)}else q=O.apply(this,arguments);return(0,Dt.Z)(this,q)}}function tf(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(N){return!1}}var bl=(Nl=(0,w.b2)(),Nl(Ki=function(N){(0,Mt.Z)(P,N);var U=So(P);function P(){return(0,le.Z)(this,P),U.apply(this,arguments)}return(0,ne.Z)(P,[{key:"getName",value:function(){return"clear"}},{key:"init",value:function(q,ve){(0,nl.Z)((0,S.Z)(P.prototype),"init",this).call(this,q,ve)}},{key:"render",value:function(){this.rendererService.clear({color:[0,0,0,0],depth:1,framebuffer:null})}}]),P}(js))||Ki),mc,wu,Es,il,Tu,gc;function nc(N,U){var P;if(typeof Symbol=="undefined"||N[Symbol.iterator]==null){if(Array.isArray(N)||(P=yc(N))||U&&N&&typeof N.length=="number"){P&&(N=P);var O=0,q=function(){};return{s:q,n:function(){return O>=N.length?{done:!0}:{done:!1,value:N[O++]}},e:function(mr){throw mr},f:q}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var ve=!0,$e=!1,xt;return{s:function(){P=N[Symbol.iterator]()},n:function(){var mr=P.next();return ve=mr.done,mr},e:function(mr){$e=!0,xt=mr},f:function(){try{!ve&&P.return!=null&&P.return()}finally{if($e)throw xt}}}}function yc(N,U){if(!!N){if(typeof N=="string")return jc(N,U);var P=Object.prototype.toString.call(N).slice(8,-1);if(P==="Object"&&N.constructor&&(P=N.constructor.name),P==="Map"||P==="Set")return Array.from(N);if(P==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(P))return jc(N,U)}}function jc(N,U){(U==null||U>N.length)&&(U=N.length);for(var P=0,O=new Array(U);P<U;P++)O[P]=N[P];return O}var Bl=(mc=(0,w.b2)(),wu=(0,w.f3)(Q.v.IPostProcessor),mc(Es=(il=(gc=function(){function N(){(0,le.Z)(this,N),this.passes=[],(0,dr.Z)(this,"postProcessor",Tu,this),this.layer=void 0,this.renderFlag=void 0,this.width=0,this.height=0}return(0,ne.Z)(N,[{key:"setLayer",value:function(P){this.layer=P}},{key:"setRenderFlag",value:function(P){this.renderFlag=P}},{key:"getRenderFlag",value:function(){return this.renderFlag}},{key:"getPostProcessor",value:function(){return this.postProcessor}},{key:"render",value:function(){var U=(0,Ya.Z)(xa().mark(function O(){var q,ve,$e;return xa().wrap(function(vt){for(;;)switch(vt.prev=vt.next){case 0:q=nc(this.passes),vt.prev=1,q.s();case 3:if((ve=q.n()).done){vt.next=9;break}return $e=ve.value,vt.next=7,$e.render(this.layer);case 7:vt.next=3;break;case 9:vt.next=14;break;case 11:vt.prev=11,vt.t0=vt.catch(1),q.e(vt.t0);case 14:return vt.prev=14,q.f(),vt.finish(14);case 17:this.layer.renderModels();case 18:case"end":return vt.stop()}},O,this,[[1,11,14,17]])}));function P(){return U.apply(this,arguments)}return P}()},{key:"resize",value:function(P,O){(this.width!==P||this.height!==O)&&(this.width=P,this.height=O)}},{key:"add",value:function(P,O){P.getType()===Un.G.PostProcessing?this.postProcessor.add(P,this.layer,O):(P.init(this.layer,O),this.passes.push(P))}},{key:"insert",value:function(P,O,q){P.init(this.layer,O),this.passes.splice(q,0,P)}},{key:"destroy",value:function(){this.passes.length=0}}]),N}(),gc),Tu=(0,Hr.Z)(il.prototype,"postProcessor",[wu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),il))||Es),qs,_c,al,Au,Ul,pu;function eu(N,U){var P=Object.keys(N);if(Object.getOwnPropertySymbols){var O=Object.getOwnPropertySymbols(N);U&&(O=O.filter(function(q){return Object.getOwnPropertyDescriptor(N,q).enumerable})),P.push.apply(P,O)}return P}function xc(N){for(var U=1;U<arguments.length;U++){var P=arguments[U]!=null?arguments[U]:{};U%2?eu(Object(P),!0).forEach(function(O){(0,Y.Z)(N,O,P[O])}):Object.getOwnPropertyDescriptors?Object.defineProperties(N,Object.getOwnPropertyDescriptors(P)):eu(Object(P)).forEach(function(O){Object.defineProperty(N,O,Object.getOwnPropertyDescriptor(P,O))})}return N}function bc(N){var U=Zc();return function(){var O=(0,S.Z)(N),q;if(U){var ve=(0,S.Z)(this).constructor;q=Reflect.construct(O,arguments,ve)}else q=O.apply(this,arguments);return(0,Dt.Z)(this,q)}}function Zc(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(N){return!1}}var Sc=(qs=(0,w.b2)(),_c=(0,w.f3)(Q.v.ILogService),qs(al=(Au=(pu=function(N){(0,Mt.Z)(P,N);var U=bc(P);function P(){var O;(0,le.Z)(this,P);for(var q=arguments.length,ve=new Array(q),$e=0;$e<q;$e++)ve[$e]=arguments[$e];return O=U.call.apply(U,[this].concat(ve)),(0,dr.Z)(O,"logger",Ul,(0,Rn.Z)(O)),O.pickingFBO=void 0,O.layer=void 0,O.width=0,O.height=0,O.alreadyInRendering=!1,O.pickFromPickingFBO=function(xt){var vt=xt.x,mr=xt.y,Br=xt.lngLat,In=xt.type;if(!(!O.layer.isVisible()||!O.layer.needPick(In))){var Bn=O.rendererService,fi=Bn.getViewportSize,Ci=Bn.readPixels,wi=Bn.useFramebuffer,ha=fi(),Ti=ha.width,Va=ha.height,Bo=O.layer.getLayerConfig(),Uo=Bo.enableHighlight,us=Bo.enableSelect,co=vt*be.SO.DPR,ya=mr*be.SO.DPR;if(!(co>Ti||co<0||ya>Va||ya<0)){var pa;wi(O.pickingFBO,function(){var _o;if(pa=Ci({x:Math.round(co),y:Math.round(Va-(mr+1)*be.SO.DPR),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:O.pickingFBO}),pa[0]!==0||pa[1]!==0||pa[2]!==0){O.logger.debug("picked");var fo=(0,be.W0)(pa),Ga=O.layer.getSource().getFeatureById(fo),$o={x:vt,y:mr,type:In,lngLat:Br,featureId:fo,feature:Ga};Ga&&(O.layer.setCurrentPickId(fo),O.triggerHoverOnLayer($o))}else{var Jo={x:vt,y:mr,lngLat:Br,type:O.layer.getCurrentPickId()===null?"un"+In:"mouseout",featureId:null,feature:null};O.triggerHoverOnLayer(xc(xc({},Jo),{},{type:"unpick"})),O.triggerHoverOnLayer(Jo),O.layer.setCurrentPickId(null)}Uo&&O.highlightPickedFeature(pa),us&&In==="click"&&((_o=pa)===null||_o===void 0?void 0:_o.toString())!==[0,0,0,0].toString()&&O.selectFeature(pa)})}}},O}return(0,ne.Z)(P,[{key:"getType",value:function(){return Un.G.Normal}},{key:"getName",value:function(){return"pixelPicking"}},{key:"init",value:function(q,ve){(0,nl.Z)((0,S.Z)(P.prototype),"init",this).call(this,q,ve),this.layer=q;var $e=this.rendererService,xt=$e.createTexture2D,vt=$e.createFramebuffer,mr=$e.getViewportSize,Br=mr(),In=Br.width,Bn=Br.height;this.pickingFBO=vt({color:xt({width:In,height:Bn,wrapS:ta.gl.CLAMP_TO_EDGE,wrapT:ta.gl.CLAMP_TO_EDGE})}),this.interactionService.on(Vn.s.Hover,this.pickFromPickingFBO),this.interactionService.on(Vn.s.Select,this.selectFeatureHandle.bind(this)),this.interactionService.on(Vn.s.Active,this.highlightFeatureHandle.bind(this))}},{key:"render",value:function(q){var ve=this;if(!this.alreadyInRendering){var $e=this.rendererService,xt=$e.getViewportSize,vt=$e.useFramebuffer,mr=$e.clear,Br=xt(),In=Br.width,Bn=Br.height;this.alreadyInRendering=!0,(this.width!==In||this.height!==Bn)&&(this.pickingFBO.resize({width:In,height:Bn}),this.width=In,this.height=Bn),vt(this.pickingFBO,function(){mr({framebuffer:ve.pickingFBO,color:[0,0,0,0],stencil:0,depth:1});var fi=ve.layer.multiPassRenderer.getRenderFlag();ve.layer.multiPassRenderer.setRenderFlag(!1),q.hooks.beforePickingEncode.call(),q.render(),q.hooks.afterPickingEncode.call(),ve.layer.multiPassRenderer.setRenderFlag(fi),ve.alreadyInRendering=!1})}}},{key:"triggerHoverOnLayer",value:function(q){this.layer.emit(q.type,q)}},{key:"highlightPickedFeature",value:function(q){var ve=(0,_r.Z)(q,3),$e=ve[0],xt=ve[1],vt=ve[2];this.layer.hooks.beforeHighlight.call([$e,xt,vt]),this.layerService.renderLayers()}},{key:"selectFeature",value:function(q){var ve=(0,_r.Z)(q,3),$e=ve[0],xt=ve[1],vt=ve[2];this.layer.hooks.beforeSelect.call([$e,xt,vt]),this.layerService.renderLayers()}},{key:"selectFeatureHandle",value:function(q){var ve=q.featureId,$e=(0,be.Z6)(ve);this.selectFeature(new Uint8Array($e))}},{key:"highlightFeatureHandle",value:function(q){var ve=q.featureId,$e=(0,be.Z6)(ve);this.highlightPickedFeature(new Uint8Array($e))}}]),P}(js),pu),Ul=(0,Hr.Z)(Au.prototype,"logger",[_c],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Au))||al),n=x(69530),s,a;function h(N,U){var P=Object.keys(N);if(Object.getOwnPropertySymbols){var O=Object.getOwnPropertySymbols(N);U&&(O=O.filter(function(q){return Object.getOwnPropertyDescriptor(N,q).enumerable})),P.push.apply(P,O)}return P}function g(N){for(var U=1;U<arguments.length;U++){var P=arguments[U]!=null?arguments[U]:{};U%2?h(Object(P),!0).forEach(function(O){(0,Y.Z)(N,O,P[O])}):Object.getOwnPropertyDescriptors?Object.defineProperties(N,Object.getOwnPropertyDescriptors(P)):h(Object(P)).forEach(function(O){Object.defineProperty(N,O,Object.getOwnPropertyDescriptor(P,O))})}return N}function b(N){var U=T();return function(){var O=(0,S.Z)(N),q;if(U){var ve=(0,S.Z)(this).constructor;q=Reflect.construct(O,arguments,ve)}else q=O.apply(this,arguments);return(0,Dt.Z)(this,q)}}function T(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(N){return!1}}var R=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,V=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,te=(s=(0,w.b2)(),s(a=function(N){(0,Mt.Z)(P,N);var U=b(P);function P(){return(0,le.Z)(this,P),U.apply(this,arguments)}return(0,ne.Z)(P,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:V,fs:R});var q=this.shaderModuleService.getModule("blur-pass"),ve=q.vs,$e=q.fs,xt=q.uniforms,vt=this.rendererService.getViewportSize(),mr=vt.width,Br=vt.height;return{vs:ve,fs:$e,uniforms:g(g({},xt),{},{u_ViewportSize:[mr,Br]})}}},{key:"convertOptionsToUniforms",value:function(q){var ve={};return Ws()(q.blurRadius)||(ve.u_BlurDir=[q.blurRadius,0]),ve}}]),P}(n.Z))||a),de,ye;function xe(N,U){var P=Object.keys(N);if(Object.getOwnPropertySymbols){var O=Object.getOwnPropertySymbols(N);U&&(O=O.filter(function(q){return Object.getOwnPropertyDescriptor(N,q).enumerable})),P.push.apply(P,O)}return P}function He(N){for(var U=1;U<arguments.length;U++){var P=arguments[U]!=null?arguments[U]:{};U%2?xe(Object(P),!0).forEach(function(O){(0,Y.Z)(N,O,P[O])}):Object.getOwnPropertyDescriptors?Object.defineProperties(N,Object.getOwnPropertyDescriptors(P)):xe(Object(P)).forEach(function(O){Object.defineProperty(N,O,Object.getOwnPropertyDescriptor(P,O))})}return N}function Ze(N){var U=nt();return function(){var O=(0,S.Z)(N),q;if(U){var ve=(0,S.Z)(this).constructor;q=Reflect.construct(O,arguments,ve)}else q=O.apply(this,arguments);return(0,Dt.Z)(this,q)}}function nt(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(N){return!1}}var ze=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,rt=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,ht=(de=(0,w.b2)(),de(ye=function(N){(0,Mt.Z)(P,N);var U=Ze(P);function P(){return(0,le.Z)(this,P),U.apply(this,arguments)}return(0,ne.Z)(P,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:rt,fs:ze});var q=this.shaderModuleService.getModule("blur-pass"),ve=q.vs,$e=q.fs,xt=q.uniforms,vt=this.rendererService.getViewportSize(),mr=vt.width,Br=vt.height;return{vs:ve,fs:$e,uniforms:He(He({},xt),{},{u_ViewportSize:[mr,Br]})}}},{key:"convertOptionsToUniforms",value:function(q){var ve={};return Ws()(q.blurRadius)||(ve.u_BlurDir=[0,q.blurRadius]),ve}}]),P}(n.Z))||ye),Nt,or;function rr(N,U){var P=Object.keys(N);if(Object.getOwnPropertySymbols){var O=Object.getOwnPropertySymbols(N);U&&(O=O.filter(function(q){return Object.getOwnPropertyDescriptor(N,q).enumerable})),P.push.apply(P,O)}return P}function sr(N){for(var U=1;U<arguments.length;U++){var P=arguments[U]!=null?arguments[U]:{};U%2?rr(Object(P),!0).forEach(function(O){(0,Y.Z)(N,O,P[O])}):Object.getOwnPropertyDescriptors?Object.defineProperties(N,Object.getOwnPropertyDescriptors(P)):rr(Object(P)).forEach(function(O){Object.defineProperty(N,O,Object.getOwnPropertyDescriptor(P,O))})}return N}function Lr(N){var U=rn();return function(){var O=(0,S.Z)(N),q;if(U){var ve=(0,S.Z)(this).constructor;q=Reflect.construct(O,arguments,ve)}else q=O.apply(this,arguments);return(0,Dt.Z)(this,q)}}function rn(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(N){return!1}}var Qr=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Angle : 0;
uniform float u_Size : 8;

#pragma include "common"

float scale = PI / u_Size;

float pattern(float u_Angle, vec2 texSize, vec2 texCoord) {
  float s = sin(u_Angle), c = cos(u_Angle);
  vec2 tex = texCoord * texSize - u_Center * texSize;
  vec2 point = vec2(
    c * tex.x - s * tex.y,
    s * tex.x + c * tex.y
  ) * scale;
  return (sin(point.x) * sin(point.y)) * 4.0;
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/colorhalftone.js
vec4 colorHalftone_filterColor(vec4 color, vec2 texSize, vec2 texCoord) {
  vec3 cmy = 1.0 - color.rgb;
  float k = min(cmy.x, min(cmy.y, cmy.z));
  cmy = (cmy - k) / (1.0 - k);
  cmy = clamp(
    cmy * 10.0 - 3.0 + vec3(
      pattern(u_Angle + 0.26179, texSize, texCoord),
      pattern(u_Angle + 1.30899, texSize, texCoord),
      pattern(u_Angle, texSize, texCoord)
    ),
    0.0,
    1.0
  );
  k = clamp(k * 10.0 - 5.0 + pattern(u_Angle + 0.78539, texSize, texCoord), 0.0, 1.0);
  return vec4(1.0 - cmy - k, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = colorHalftone_filterColor(gl_FragColor, u_ViewportSize, v_UV);
}`,xn=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,jn=(Nt=(0,w.b2)(),Nt(or=function(N){(0,Mt.Z)(P,N);var U=Lr(P);function P(){return(0,le.Z)(this,P),U.apply(this,arguments)}return(0,ne.Z)(P,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("colorhalftone-pass",{vs:xn,fs:Qr});var q=this.shaderModuleService.getModule("colorhalftone-pass"),ve=q.vs,$e=q.fs,xt=q.uniforms,vt=this.rendererService.getViewportSize(),mr=vt.width,Br=vt.height;return{vs:ve,fs:$e,uniforms:sr(sr({},xt),{},{u_ViewportSize:[mr,Br]})}}}]),P}(n.Z))||or),Xn,Wn;function $i(N){var U=Sn();return function(){var O=(0,S.Z)(N),q;if(U){var ve=(0,S.Z)(this).constructor;q=Reflect.construct(O,arguments,ve)}else q=O.apply(this,arguments);return(0,Dt.Z)(this,q)}}function Sn(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(N){return!1}}var oi=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,Si=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,ai=(Xn=(0,w.b2)(),Xn(Wn=function(N){(0,Mt.Z)(P,N);var U=$i(P);function P(){return(0,le.Z)(this,P),U.apply(this,arguments)}return(0,ne.Z)(P,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("copy-pass",{vs:Si,fs:oi}),this.shaderModuleService.getModule("copy-pass")}}]),P}(n.Z))||Wn),ii,Ei;function ri(N,U){var P=Object.keys(N);if(Object.getOwnPropertySymbols){var O=Object.getOwnPropertySymbols(N);U&&(O=O.filter(function(q){return Object.getOwnPropertyDescriptor(N,q).enumerable})),P.push.apply(P,O)}return P}function Qn(N){for(var U=1;U<arguments.length;U++){var P=arguments[U]!=null?arguments[U]:{};U%2?ri(Object(P),!0).forEach(function(O){(0,Y.Z)(N,O,P[O])}):Object.getOwnPropertyDescriptors?Object.defineProperties(N,Object.getOwnPropertyDescriptors(P)):ri(Object(P)).forEach(function(O){Object.defineProperty(N,O,Object.getOwnPropertyDescriptor(P,O))})}return N}function mo(N){var U=Ja();return function(){var O=(0,S.Z)(N),q;if(U){var ve=(0,S.Z)(this).constructor;q=Reflect.construct(O,arguments,ve)}else q=O.apply(this,arguments);return(0,Dt.Z)(this,q)}}function Ja(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(N){return!1}}var os=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Scale : 10;

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/hexagonalpixelate.js
vec4 hexagonalPixelate_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 tex = (texCoord * texSize - u_Center * texSize) / u_Scale;
  tex.y /= 0.866025404;
  tex.x -= tex.y * 0.5;
  vec2 a;
  if (tex.x + tex.y - floor(tex.x) - floor(tex.y) < 1.0) {
    a = vec2(floor(tex.x), floor(tex.y));
  }
  else a = vec2(ceil(tex.x), ceil(tex.y));
  vec2 b = vec2(ceil(tex.x), floor(tex.y));
  vec2 c = vec2(floor(tex.x), ceil(tex.y));
  vec3 TEX = vec3(tex.x, tex.y, 1.0 - tex.x - tex.y);
  vec3 A = vec3(a.x, a.y, 1.0 - a.x - a.y);
  vec3 B = vec3(b.x, b.y, 1.0 - b.x - b.y);
  vec3 C = vec3(c.x, c.y, 1.0 - c.x - c.y);
  float alen = length(TEX - A);
  float blen = length(TEX - B);
  float clen = length(TEX - C);
  vec2 choice;
  if (alen < blen) {
    if (alen < clen) choice = a;
    else choice = c;
  } else {
    if (blen < clen) choice = b;
    else choice = c;
  }
  choice.x += choice.y * 0.5;
  choice.y *= 0.866025404;
  choice *= u_Scale / texSize;
  return texture2D(texture, choice + u_Center);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = hexagonalPixelate_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,Fo=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Qa=(ii=(0,w.b2)(),ii(Ei=function(N){(0,Mt.Z)(P,N);var U=mo(P);function P(){return(0,le.Z)(this,P),U.apply(this,arguments)}return(0,ne.Z)(P,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("hexagonalpixelate-pass",{vs:Fo,fs:os});var q=this.shaderModuleService.getModule("hexagonalpixelate-pass"),ve=q.vs,$e=q.fs,xt=q.uniforms,vt=this.rendererService.getViewportSize(),mr=vt.width,Br=vt.height;return{vs:ve,fs:$e,uniforms:Qn(Qn({},xt),{},{u_ViewportSize:[mr,Br]})}}}]),P}(n.Z))||Ei),ro,ms;function zo(N,U){var P=Object.keys(N);if(Object.getOwnPropertySymbols){var O=Object.getOwnPropertySymbols(N);U&&(O=O.filter(function(q){return Object.getOwnPropertyDescriptor(N,q).enumerable})),P.push.apply(P,O)}return P}function Cu(N){for(var U=1;U<arguments.length;U++){var P=arguments[U]!=null?arguments[U]:{};U%2?zo(Object(P),!0).forEach(function(O){(0,Y.Z)(N,O,P[O])}):Object.getOwnPropertyDescriptors?Object.defineProperties(N,Object.getOwnPropertyDescriptors(P)):zo(Object(P)).forEach(function(O){Object.defineProperty(N,O,Object.getOwnPropertyDescriptor(P,O))})}return N}function ss(N){var U=Zs();return function(){var O=(0,S.Z)(N),q;if(U){var ve=(0,S.Z)(this).constructor;q=Reflect.construct(O,arguments,ve)}else q=O.apply(this,arguments);return(0,Dt.Z)(this,q)}}function Zs(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(N){return!1}}var Vs=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform float u_Strength : 0.6;

vec4 ink_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 dx = vec2(1.0 / texSize.x, 0.0);
  vec2 dy = vec2(0.0, 1.0 / texSize.y);
  vec4 color = texture2D(texture, texCoord);
  float bigTotal = 0.0;
  float smallTotal = 0.0;
  vec3 bigAverage = vec3(0.0);
  vec3 smallAverage = vec3(0.0);
  for (float x = -2.0; x <= 2.0; x += 1.0) {
    for (float y = -2.0; y <= 2.0; y += 1.0) {
      vec3 sample = texture2D(texture, texCoord + dx * x + dy * y).rgb;
      bigAverage += sample;
      bigTotal += 1.0;
      if (abs(x) + abs(y) < 2.0) {
        smallAverage += sample;
        smallTotal += 1.0;
      }
    }
  }
  vec3 edge = max(vec3(0.0), bigAverage / bigTotal - smallAverage / smallTotal);
  float power = u_Strength * u_Strength * u_Strength * u_Strength * u_Strength;
  return vec4(color.rgb - dot(edge, edge) * power * 100000.0, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = ink_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,Sl=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,El=(ro=(0,w.b2)(),ro(ms=function(N){(0,Mt.Z)(P,N);var U=ss(P);function P(){return(0,le.Z)(this,P),U.apply(this,arguments)}return(0,ne.Z)(P,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("ink-pass",{vs:Sl,fs:Vs});var q=this.shaderModuleService.getModule("ink-pass"),ve=q.vs,$e=q.fs,xt=q.uniforms,vt=this.rendererService.getViewportSize(),mr=vt.width,Br=vt.height;return{vs:ve,fs:$e,uniforms:Cu(Cu({},xt),{},{u_ViewportSize:[mr,Br]})}}}]),P}(n.Z))||ms),Ls,Vu;function jl(N){var U=du();return function(){var O=(0,S.Z)(N),q;if(U){var ve=(0,S.Z)(this).constructor;q=Reflect.construct(O,arguments,ve)}else q=O.apply(this,arguments);return(0,Dt.Z)(this,q)}}function du(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(N){return!1}}var wl=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform float u_Amount : 0.5;

float rand(vec2 co) {
  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/noise.js
vec4 noise_filterColor(vec4 color, vec2 texCoord) {
  float diff = (rand(texCoord) - 0.5) * u_Amount;
  color.r += diff;
  color.g += diff;
  color.b += diff;
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = noise_filterColor(gl_FragColor, v_UV);
}`,tu=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,no=(Ls=(0,w.b2)(),Ls(Vu=function(N){(0,Mt.Z)(P,N);var U=jl(P);function P(){return(0,le.Z)(this,P),U.apply(this,arguments)}return(0,ne.Z)(P,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("noise-pass",{vs:tu,fs:wl}),this.shaderModuleService.getModule("noise-pass")}}]),P}(n.Z))||Vu),Pu,vu;function ws(N){var U=Ji();return function(){var O=(0,S.Z)(N),q;if(U){var ve=(0,S.Z)(this).constructor;q=Reflect.construct(O,arguments,ve)}else q=O.apply(this,arguments);return(0,Dt.Z)(this,q)}}function Ji(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(N){return!1}}var No=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,go=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform float u_Amount : 0.5;

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/sepia.js
vec4 sepia_filterColor(vec4 color) {
  float r = color.r;
  float g = color.g;
  float b = color.b;
  color.r =
    min(1.0, (r * (1.0 - (0.607 * u_Amount))) + (g * (0.769 * u_Amount)) + (b * (0.189 * u_Amount)));
  color.g = min(1.0, (r * 0.349 * u_Amount) + (g * (1.0 - (0.314 * u_Amount))) + (b * 0.168 * u_Amount));
  color.b = min(1.0, (r * 0.272 * u_Amount) + (g * 0.534 * u_Amount) + (b * (1.0 - (0.869 * u_Amount))));
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = sepia_filterColor(gl_FragColor);
}`,Mu=(Pu=(0,w.b2)(),Pu(vu=function(N){(0,Mt.Z)(P,N);var U=ws(P);function P(){return(0,le.Z)(this,P),U.apply(this,arguments)}return(0,ne.Z)(P,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("sepia-pass",{vs:No,fs:go}),this.shaderModuleService.getModule("sepia-pass")}}]),P}(n.Z))||vu),ru,mu,Gu,Iu,Gs,nu,Tl,rf=(ru=(0,w.b2)(),mu=(0,w.f3)(Q.v.IRendererService),Gu=(0,w.zY)(),ru(Iu=(Gs=(Tl=function(){function N(){(0,le.Z)(this,N),(0,dr.Z)(this,"rendererService",nu,this),this.passes=[],this.readFBO=void 0,this.writeFBO=void 0}return(0,ne.Z)(N,[{key:"getReadFBO",value:function(){return this.readFBO}},{key:"getWriteFBO",value:function(){return this.writeFBO}},{key:"render",value:function(){var U=(0,Ya.Z)(xa().mark(function O(q){var ve,$e;return xa().wrap(function(vt){for(;;)switch(vt.prev=vt.next){case 0:ve=0;case 1:if(!(ve<this.passes.length)){vt.next=10;break}return $e=this.passes[ve],$e.setRenderToScreen(this.isLastEnabledPass(ve)),vt.next=6,$e.render(q);case 6:ve!==this.passes.length-1&&this.swap();case 7:ve++,vt.next=1;break;case 10:case"end":return vt.stop()}},O,this)}));function P(O){return U.apply(this,arguments)}return P}()},{key:"resize",value:function(P,O){this.readFBO.resize({width:P,height:O}),this.writeFBO.resize({width:P,height:O})}},{key:"add",value:function(P,O,q){P.init(O,q),this.passes.push(P)}},{key:"insert",value:function(P,O,q,ve){P.init(q,ve),this.passes.splice(O,0,P)}},{key:"getPostProcessingPassByName",value:function(P){return this.passes.find(function(O){return O.getName()===P})}},{key:"init",value:function(){}},{key:"isLastEnabledPass",value:function(P){for(var O=P+1;O<this.passes.length;O++)if(this.passes[O].isEnabled())return!1;return!0}},{key:"swap",value:function(){var P=this.readFBO;this.readFBO=this.writeFBO,this.writeFBO=P}}]),N}(),Tl),nu=(0,Hr.Z)(Gs.prototype,"rendererService",[mu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),(0,Hr.Z)(Gs.prototype,"init",[Gu],Object.getOwnPropertyDescriptor(Gs.prototype,"init"),Gs.prototype),Gs))||Iu),gu,ga;function dh(N){var U=Hf();return function(){var O=(0,S.Z)(N),q;if(U){var ve=(0,S.Z)(this).constructor;q=Reflect.construct(O,arguments,ve)}else q=O.apply(this,arguments);return(0,Dt.Z)(this,q)}}function Hf(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(N){return!1}}var Wf=(gu=(0,w.b2)(),gu(ga=function(N){(0,Mt.Z)(P,N);var U=dh(P);function P(){return(0,le.Z)(this,P),U.apply(this,arguments)}return(0,ne.Z)(P,[{key:"getType",value:function(){return Un.G.Normal}},{key:"getName",value:function(){return"render"}},{key:"init",value:function(q,ve){(0,nl.Z)((0,S.Z)(P.prototype),"init",this).call(this,q,ve)}},{key:"render",value:function(q){var ve=this.rendererService,$e=ve.useFramebuffer,xt=ve.clear;$e(null,function(){xt({color:[0,0,0,0],depth:1,stencil:0}),q.multiPassRenderer.setRenderFlag(!1),q.render(),q.multiPassRenderer.setRenderFlag(!0)})}}]),P}(js))||ga),Zl,Lf,vh,ic,Rf,xf,Xf,Vl;function Vc(N,U){var P=Object.keys(N);if(Object.getOwnPropertySymbols){var O=Object.getOwnPropertySymbols(N);U&&(O=O.filter(function(q){return Object.getOwnPropertyDescriptor(N,q).enumerable})),P.push.apply(P,O)}return P}function Df(N){for(var U=1;U<arguments.length;U++){var P=arguments[U]!=null?arguments[U]:{};U%2?Vc(Object(P),!0).forEach(function(O){(0,Y.Z)(N,O,P[O])}):Object.getOwnPropertyDescriptors?Object.defineProperties(N,Object.getOwnPropertyDescriptors(P)):Vc(Object(P)).forEach(function(O){Object.defineProperty(N,O,Object.getOwnPropertyDescriptor(P,O))})}return N}function Yf(N){var U=Kf();return function(){var O=(0,S.Z)(N),q;if(U){var ve=(0,S.Z)(this).constructor;q=Reflect.construct(O,arguments,ve)}else q=O.apply(this,arguments);return(0,Dt.Z)(this,q)}}function Kf(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(N){return!1}}var $f=`uniform float u_opacity : 1.0;
uniform float u_MixRatio : 0.5;

uniform sampler2D u_Diffuse1;
uniform sampler2D u_Diffuse2;

varying vec2 v_UV;

void main() {
  vec4 texel1 = texture2D(u_Diffuse1, v_UV);
  vec4 texel2 = texture2D(u_Diffuse2, v_UV);
  gl_FragColor = u_opacity * mix(texel1, texel2, u_MixRatio);
}
`,Jf=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,Qf=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`;function mh(N,U){for(var P=0,O=1/U,q=N;q>0;)P=P+O*(q%U),q=Math.floor(q/U),O=O/U;return P}var kf=1,gh=(Zl=(0,w.b2)(),Lf=(0,w.f3)(Q.v.IShaderModuleService),vh=(0,w.f3)(Q.v.ILogService),Zl(ic=(Rf=(Vl=function(N){(0,Mt.Z)(P,N);var U=Yf(P);function P(){var O;(0,le.Z)(this,P);for(var q=arguments.length,ve=new Array(q),$e=0;$e<q;$e++)ve[$e]=arguments[$e];return O=U.call.apply(U,[this].concat(ve)),(0,dr.Z)(O,"shaderModuleService",xf,(0,Rn.Z)(O)),(0,dr.Z)(O,"logger",Xf,(0,Rn.Z)(O)),O.haltonSequence=[],O.accumulatingId=0,O.frame=0,O.timer=void 0,O.sampleRenderTarget=void 0,O.prevRenderTarget=void 0,O.outputRenderTarget=void 0,O.copyRenderTarget=void 0,O.blendModel=void 0,O.outputModel=void 0,O.copyModel=void 0,O}return(0,ne.Z)(P,[{key:"getType",value:function(){return Un.G.Normal}},{key:"getName",value:function(){return"taa"}},{key:"init",value:function(q,ve){(0,nl.Z)((0,S.Z)(P.prototype),"init",this).call(this,q,ve);var $e=this.rendererService,xt=$e.createFramebuffer,vt=$e.createTexture2D;this.sampleRenderTarget=xt({color:vt({width:1,height:1,wrapS:ta.gl.CLAMP_TO_EDGE,wrapT:ta.gl.CLAMP_TO_EDGE})}),this.prevRenderTarget=xt({color:vt({width:1,height:1,wrapS:ta.gl.CLAMP_TO_EDGE,wrapT:ta.gl.CLAMP_TO_EDGE})}),this.outputRenderTarget=xt({color:vt({width:1,height:1,wrapS:ta.gl.CLAMP_TO_EDGE,wrapT:ta.gl.CLAMP_TO_EDGE})}),this.copyRenderTarget=xt({color:vt({width:1,height:1,wrapS:ta.gl.CLAMP_TO_EDGE,wrapT:ta.gl.CLAMP_TO_EDGE})});for(var mr=0;mr<30;mr++)this.haltonSequence.push([mh(mr,2),mh(mr,3)]);this.blendModel=this.createTriangleModel("blend-pass",$f),this.outputModel=this.createTriangleModel("copy-pass",Jf,{blend:{enable:!0,func:{srcRGB:ta.gl.ONE,dstRGB:ta.gl.ONE_MINUS_SRC_ALPHA,srcAlpha:ta.gl.ONE,dstAlpha:ta.gl.ONE_MINUS_SRC_ALPHA},equation:{rgb:ta.gl.FUNC_ADD,alpha:ta.gl.FUNC_ADD}}}),this.copyModel=this.createTriangleModel("copy-pass",Jf)}},{key:"render",value:function(q){var ve=this,$e=this.rendererService,xt=$e.clear,vt=$e.getViewportSize,mr=$e.useFramebuffer,Br=vt(),In=Br.width,Bn=Br.height;this.sampleRenderTarget.resize({width:In,height:Bn}),this.prevRenderTarget.resize({width:In,height:Bn}),this.outputRenderTarget.resize({width:In,height:Bn}),this.copyRenderTarget.resize({width:In,height:Bn}),this.resetFrame(),this.stopAccumulating();var fi=q.multiPassRenderer.getPostProcessor().getReadFBO();mr(fi,function(){xt({color:[0,0,0,0],depth:1,stencil:0,framebuffer:fi}),q.multiPassRenderer.setRenderFlag(!1),q.render(),q.multiPassRenderer.setRenderFlag(!0)});var Ci=function wi(ha){!ve.accumulatingId||ha!==ve.accumulatingId||ve.isFinished()||(ve.doRender(q),requestAnimationFrame(function(){wi(ha)}))};this.accumulatingId=kf++,this.timer=window.setTimeout(function(){Ci(ve.accumulatingId)},50)}},{key:"doRender",value:function(q){var ve=this;this.logger.debug("accumulatingId: ".concat(this.accumulatingId));var $e=this.rendererService,xt=$e.clear,vt=$e.getViewportSize,mr=$e.useFramebuffer,Br=vt(),In=Br.width,Bn=Br.height,fi=q.getLayerConfig(),Ci=fi.jitterScale,wi=Ci===void 0?1:Ci,ha=this.haltonSequence[this.frame%this.haltonSequence.length];this.cameraService.jitterProjectionMatrix((ha[0]*2-1)/In*wi,(ha[1]*2-1)/Bn*wi),q.multiPassRenderer.setRenderFlag(!1),q.hooks.beforeRender.call(),mr(this.sampleRenderTarget,function(){xt({color:[0,0,0,0],depth:1,stencil:0,framebuffer:ve.sampleRenderTarget}),q.render()}),q.hooks.afterRender.call(),q.multiPassRenderer.setRenderFlag(!0);var Ti=q.getLayerConfig();mr(this.outputRenderTarget,function(){ve.blendModel.draw({uniforms:{u_opacity:Ti.opacity||1,u_MixRatio:ve.frame===0?1:.9,u_Diffuse1:ve.sampleRenderTarget,u_Diffuse2:ve.frame===0?q.multiPassRenderer.getPostProcessor().getReadFBO():ve.prevRenderTarget}})}),this.frame===0&&xt({color:[0,0,0,0],depth:1,stencil:0,framebuffer:this.copyRenderTarget}),this.frame>=1&&(mr(this.copyRenderTarget,function(){ve.outputModel.draw({uniforms:{u_Texture:ve.outputRenderTarget}})}),mr(q.multiPassRenderer.getPostProcessor().getReadFBO(),function(){ve.copyModel.draw({uniforms:{u_Texture:ve.copyRenderTarget}})}),q.multiPassRenderer.getPostProcessor().render(q));var Va=this.prevRenderTarget;this.prevRenderTarget=this.outputRenderTarget,this.outputRenderTarget=Va,this.frame++,this.cameraService.clearJitterProjectionMatrix()}},{key:"isFinished",value:function(){return this.frame>=this.haltonSequence.length}},{key:"resetFrame",value:function(){this.frame=0}},{key:"stopAccumulating",value:function(){this.accumulatingId=0,window.clearTimeout(this.timer)}},{key:"createTriangleModel",value:function(q,ve,$e){this.shaderModuleService.registerModule(q,{vs:Qf,fs:ve});var xt=this.shaderModuleService.getModule(q),vt=xt.vs,mr=xt.fs,Br=xt.uniforms,In=this.rendererService,Bn=In.createAttribute,fi=In.createBuffer,Ci=In.createModel;return Ci(Df({vs:vt,fs:mr,attributes:{a_Position:Bn({buffer:fi({data:[-4,-4,4,-4,0,4],type:ta.gl.FLOAT}),size:2})},uniforms:Df({},Br),depth:{enable:!1},count:3},$e))}}]),P}(js),Vl),xf=(0,Hr.Z)(Rf.prototype,"shaderModuleService",[Lf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xf=(0,Hr.Z)(Rf.prototype,"logger",[vh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Rf))||ic),Ou=new w.W2;Ou.bind(Q.v.IGlobalConfigService).to(jt).inSingletonScope(),Ou.bind(Q.v.IShaderModuleService).to(vs).inSingletonScope(),Ou.bind(Q.v.ILogService).to($c).inSingletonScope(),(0,w.GW)((0,w.b2)(),E.EventEmitter),Ou.bind(Q.v.IEventEmitter).to(E.EventEmitter);var bf=(0,F.Z)(Ou,!1),yo=function(U){var P=bf.lazyInject(U);return function(O,q,ve){P.call(this,O,q),ve&&(ve.initializer=function(){return O[q]})}},nf=function(U){var P=bf.lazyMultiInject(U);return function(O,q,ve){P.call(this,O,q),ve&&(ve.initializer=function(){return O[q]})}},Ff=Ou,Al=0;function Gc(){var N=new w.W2;return N.parent=Ou,N.bind(Q.v.SceneID).toConstantValue("".concat(Al++)),N.bind(Q.v.ILayerService).to(ci).inSingletonScope(),N.bind(Q.v.ISceneService).to(Jr).inSingletonScope(),N.bind(Q.v.ICameraService).to(yt).inSingletonScope(),N.bind(Q.v.ICoordinateSystemService).to(ji).inSingletonScope(),N.bind(Q.v.IInteractionService).to(sa).inSingletonScope(),N.bind(Q.v.IPickingService).to($a).inSingletonScope(),N.bind(Q.v.IControlService).to(gr).inSingletonScope(),N.bind(Q.v.IMarkerService).to(xi).inSingletonScope(),N.bind(Q.v.IIconService).to(Vt).inSingletonScope(),N.bind(Q.v.IFontService).to(tt).inSingletonScope(),N.bind(Q.v.IPopupService).to(G).inSingletonScope(),N.bind(Q.v.INormalPass).to(bl).whenTargetNamed("clear"),N.bind(Q.v.INormalPass).to(Sc).whenTargetNamed("pixelPicking"),N.bind(Q.v.INormalPass).to(Wf).whenTargetNamed("render"),N.bind(Q.v.INormalPass).to(gh).whenTargetNamed("taa"),N.bind(Q.v.IFactoryNormalPass).toFactory(function(U){return function(P){return U.container.getNamed(Q.v.INormalPass,P)}}),N.bind(Q.v.IPostProcessingPass).to(ai).whenTargetNamed("copy"),N.bind(Q.v.IPostProcessingPass).to(te).whenTargetNamed("blurH"),N.bind(Q.v.IPostProcessingPass).to(ht).whenTargetNamed("blurV"),N.bind(Q.v.IPostProcessingPass).to(no).whenTargetNamed("noise"),N.bind(Q.v.IPostProcessingPass).to(Mu).whenTargetNamed("sepia"),N.bind(Q.v.IPostProcessingPass).to(jn).whenTargetNamed("colorHalftone"),N.bind(Q.v.IPostProcessingPass).to(Qa).whenTargetNamed("hexagonalPixelate"),N.bind(Q.v.IPostProcessingPass).to(El).whenTargetNamed("ink"),N.bind(Q.v.IFactoryPostProcessingPass).toFactory(function(U){return function(P){var O=U.container.getNamed(Q.v.IPostProcessingPass,P);return O.setName(P),O}}),N}function ac(N){var U=new w.W2;return U.parent=N,U.bind(Q.v.IStyleAttributeService).to(Co).inSingletonScope(),U.bind(Q.v.IMultiPassRenderer).to(Bl).inSingletonScope(),U.bind(Q.v.IPostProcessor).to(rf).inSingletonScope(),U}},2811:function(){},64532:function(){},4594:function(ur,L,x){"use strict";x.d(L,{l:function(){return J}});var J={ProjectionMatrix:"u_ProjectionMatrix",ViewMatrix:"u_ViewMatrix",ViewProjectionMatrix:"u_ViewProjectionMatrix",Zoom:"u_Zoom",ZoomScale:"u_ZoomScale",FocalDistance:"u_FocalDistance",CameraPosition:"u_CameraPosition"}},66690:function(ur,L,x){"use strict";x.d(L,{d:function(){return J}});var J;(function(E){E.TOPRIGHT="topright",E.TOPLEFT="topleft",E.BOTTOMRIGHT="bottomright",E.BOTTOMLEFT="bottomleft"})(J||(J={}))},81732:function(){},84007:function(){},1910:function(){},47282:function(ur,L,x){"use strict";x.d(L,{l:function(){return J},k:function(){return E}});var J;(function(p){p[p.LNGLAT=1]="LNGLAT",p[p.LNGLAT_OFFSET=2]="LNGLAT_OFFSET",p[p.VECTOR_TILE=3]="VECTOR_TILE",p[p.IDENTITY=4]="IDENTITY",p[p.P20=5]="P20",p[p.P20_OFFSET=6]="P20_OFFSET",p[p.METER_OFFSET=7]="METER_OFFSET",p[p.P20_2=8]="P20_2"})(J||(J={}));var E={CoordinateSystem:"u_CoordinateSystem",ViewportCenter:"u_ViewportCenter",ViewportCenterProjection:"u_ViewportCenterProjection",PixelsPerDegree:"u_PixelsPerDegree",PixelsPerDegree2:"u_PixelsPerDegree2",PixelsPerMeter:"u_PixelsPerMeter",Mvp:"u_Mvp"}},89648:function(ur,L,x){"use strict";x.d(L,{s:function(){return J}});var J;(function(E){E.Hover="hover",E.Click="click",E.Select="select",E.Active="active",E.Drag="drag"})(J||(J={}))},90919:function(){},77252:function(ur,L,x){"use strict";x.d(L,{h:function(){return J}});var J;(function(E){E.normal="normal",E.additive="additive",E.subtractive="subtractive",E.min="min",E.max="max",E.none="none"})(J||(J={}))},31251:function(ur,L,x){"use strict";x.d(L,{vY:function(){return J},ee:function(){return E},GC:function(){return p}});var J;(function(w){w.LINEAR="linear",w.POWER="power",w.LOG="log",w.IDENTITY="identity",w.TIME="time",w.QUANTILE="quantile",w.QUANTIZE="quantize",w.THRESHOLD="threshold",w.CAT="cat"})(J||(J={}));var E;(function(w){w.CONSTANT="constant",w.VARIABLE="variable"})(E||(E={}));var p;(function(w){w[w.Attribute=0]="Attribute",w[w.InstancedAttribute=1]="InstancedAttribute",w[w.Uniform=2]="Uniform"})(p||(p={}))},79042:function(){},16606:function(ur,L,x){"use strict";x.d(L,{I:function(){return J}});var J=["mapload"]},75925:function(){},85040:function(){},8594:function(){},67571:function(){},66718:function(){},92364:function(ur,L,x){"use strict";x.d(L,{G:function(){return J}});var J;(function(E){E.Normal="normal",E.PostProcessing="post-processing"})(J||(J={}))},78010:function(){},41906:function(){},68116:function(){},23067:function(){},7648:function(ur,L,x){"use strict";x.d(L,{gl:function(){return J}});var J;(function(E){E[E.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",E[E.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",E[E.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",E[E.POINTS=0]="POINTS",E[E.LINES=1]="LINES",E[E.LINE_LOOP=2]="LINE_LOOP",E[E.LINE_STRIP=3]="LINE_STRIP",E[E.TRIANGLES=4]="TRIANGLES",E[E.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",E[E.TRIANGLE_FAN=6]="TRIANGLE_FAN",E[E.ZERO=0]="ZERO",E[E.ONE=1]="ONE",E[E.SRC_COLOR=768]="SRC_COLOR",E[E.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",E[E.SRC_ALPHA=770]="SRC_ALPHA",E[E.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",E[E.DST_ALPHA=772]="DST_ALPHA",E[E.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",E[E.DST_COLOR=774]="DST_COLOR",E[E.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",E[E.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",E[E.FUNC_ADD=32774]="FUNC_ADD",E[E.BLEND_EQUATION=32777]="BLEND_EQUATION",E[E.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",E[E.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",E[E.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",E[E.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",E[E.MAX_EXT=32776]="MAX_EXT",E[E.MIN_EXT=32775]="MIN_EXT",E[E.BLEND_DST_RGB=32968]="BLEND_DST_RGB",E[E.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",E[E.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",E[E.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",E[E.CONSTANT_COLOR=32769]="CONSTANT_COLOR",E[E.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",E[E.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",E[E.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",E[E.BLEND_COLOR=32773]="BLEND_COLOR",E[E.ARRAY_BUFFER=34962]="ARRAY_BUFFER",E[E.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",E[E.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",E[E.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",E[E.STREAM_DRAW=35040]="STREAM_DRAW",E[E.STATIC_DRAW=35044]="STATIC_DRAW",E[E.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",E[E.BUFFER_SIZE=34660]="BUFFER_SIZE",E[E.BUFFER_USAGE=34661]="BUFFER_USAGE",E[E.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",E[E.FRONT=1028]="FRONT",E[E.BACK=1029]="BACK",E[E.FRONT_AND_BACK=1032]="FRONT_AND_BACK",E[E.CULL_FACE=2884]="CULL_FACE",E[E.BLEND=3042]="BLEND",E[E.DITHER=3024]="DITHER",E[E.STENCIL_TEST=2960]="STENCIL_TEST",E[E.DEPTH_TEST=2929]="DEPTH_TEST",E[E.SCISSOR_TEST=3089]="SCISSOR_TEST",E[E.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",E[E.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",E[E.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",E[E.NO_ERROR=0]="NO_ERROR",E[E.INVALID_ENUM=1280]="INVALID_ENUM",E[E.INVALID_VALUE=1281]="INVALID_VALUE",E[E.INVALID_OPERATION=1282]="INVALID_OPERATION",E[E.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",E[E.CW=2304]="CW",E[E.CCW=2305]="CCW",E[E.LINE_WIDTH=2849]="LINE_WIDTH",E[E.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",E[E.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",E[E.CULL_FACE_MODE=2885]="CULL_FACE_MODE",E[E.FRONT_FACE=2886]="FRONT_FACE",E[E.DEPTH_RANGE=2928]="DEPTH_RANGE",E[E.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",E[E.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",E[E.DEPTH_FUNC=2932]="DEPTH_FUNC",E[E.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",E[E.STENCIL_FUNC=2962]="STENCIL_FUNC",E[E.STENCIL_FAIL=2964]="STENCIL_FAIL",E[E.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",E[E.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",E[E.STENCIL_REF=2967]="STENCIL_REF",E[E.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",E[E.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",E[E.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",E[E.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",E[E.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",E[E.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",E[E.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",E[E.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",E[E.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",E[E.VIEWPORT=2978]="VIEWPORT",E[E.SCISSOR_BOX=3088]="SCISSOR_BOX",E[E.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",E[E.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",E[E.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",E[E.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",E[E.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",E[E.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",E[E.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",E[E.RED_BITS=3410]="RED_BITS",E[E.GREEN_BITS=3411]="GREEN_BITS",E[E.BLUE_BITS=3412]="BLUE_BITS",E[E.ALPHA_BITS=3413]="ALPHA_BITS",E[E.DEPTH_BITS=3414]="DEPTH_BITS",E[E.STENCIL_BITS=3415]="STENCIL_BITS",E[E.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",E[E.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",E[E.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",E[E.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",E[E.SAMPLES=32937]="SAMPLES",E[E.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",E[E.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",E[E.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",E[E.DONT_CARE=4352]="DONT_CARE",E[E.FASTEST=4353]="FASTEST",E[E.NICEST=4354]="NICEST",E[E.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",E[E.BYTE=5120]="BYTE",E[E.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",E[E.SHORT=5122]="SHORT",E[E.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",E[E.INT=5124]="INT",E[E.UNSIGNED_INT=5125]="UNSIGNED_INT",E[E.FLOAT=5126]="FLOAT",E[E.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",E[E.ALPHA=6406]="ALPHA",E[E.RGB=6407]="RGB",E[E.RGBA=6408]="RGBA",E[E.LUMINANCE=6409]="LUMINANCE",E[E.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",E[E.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",E[E.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",E[E.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",E[E.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",E[E.VERTEX_SHADER=35633]="VERTEX_SHADER",E[E.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",E[E.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",E[E.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",E[E.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",E[E.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",E[E.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",E[E.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",E[E.SHADER_TYPE=35663]="SHADER_TYPE",E[E.DELETE_STATUS=35712]="DELETE_STATUS",E[E.LINK_STATUS=35714]="LINK_STATUS",E[E.VALIDATE_STATUS=35715]="VALIDATE_STATUS",E[E.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",E[E.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",E[E.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",E[E.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",E[E.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",E[E.NEVER=512]="NEVER",E[E.LESS=513]="LESS",E[E.EQUAL=514]="EQUAL",E[E.LEQUAL=515]="LEQUAL",E[E.GREATER=516]="GREATER",E[E.NOTEQUAL=517]="NOTEQUAL",E[E.GEQUAL=518]="GEQUAL",E[E.ALWAYS=519]="ALWAYS",E[E.KEEP=7680]="KEEP",E[E.REPLACE=7681]="REPLACE",E[E.INCR=7682]="INCR",E[E.DECR=7683]="DECR",E[E.INVERT=5386]="INVERT",E[E.INCR_WRAP=34055]="INCR_WRAP",E[E.DECR_WRAP=34056]="DECR_WRAP",E[E.VENDOR=7936]="VENDOR",E[E.RENDERER=7937]="RENDERER",E[E.VERSION=7938]="VERSION",E[E.NEAREST=9728]="NEAREST",E[E.LINEAR=9729]="LINEAR",E[E.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",E[E.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",E[E.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",E[E.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",E[E.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",E[E.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",E[E.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",E[E.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",E[E.TEXTURE_2D=3553]="TEXTURE_2D",E[E.TEXTURE=5890]="TEXTURE",E[E.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",E[E.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",E[E.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",E[E.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",E[E.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",E[E.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",E[E.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",E[E.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",E[E.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",E[E.TEXTURE0=33984]="TEXTURE0",E[E.TEXTURE1=33985]="TEXTURE1",E[E.TEXTURE2=33986]="TEXTURE2",E[E.TEXTURE3=33987]="TEXTURE3",E[E.TEXTURE4=33988]="TEXTURE4",E[E.TEXTURE5=33989]="TEXTURE5",E[E.TEXTURE6=33990]="TEXTURE6",E[E.TEXTURE7=33991]="TEXTURE7",E[E.TEXTURE8=33992]="TEXTURE8",E[E.TEXTURE9=33993]="TEXTURE9",E[E.TEXTURE10=33994]="TEXTURE10",E[E.TEXTURE11=33995]="TEXTURE11",E[E.TEXTURE12=33996]="TEXTURE12",E[E.TEXTURE13=33997]="TEXTURE13",E[E.TEXTURE14=33998]="TEXTURE14",E[E.TEXTURE15=33999]="TEXTURE15",E[E.TEXTURE16=34e3]="TEXTURE16",E[E.TEXTURE17=34001]="TEXTURE17",E[E.TEXTURE18=34002]="TEXTURE18",E[E.TEXTURE19=34003]="TEXTURE19",E[E.TEXTURE20=34004]="TEXTURE20",E[E.TEXTURE21=34005]="TEXTURE21",E[E.TEXTURE22=34006]="TEXTURE22",E[E.TEXTURE23=34007]="TEXTURE23",E[E.TEXTURE24=34008]="TEXTURE24",E[E.TEXTURE25=34009]="TEXTURE25",E[E.TEXTURE26=34010]="TEXTURE26",E[E.TEXTURE27=34011]="TEXTURE27",E[E.TEXTURE28=34012]="TEXTURE28",E[E.TEXTURE29=34013]="TEXTURE29",E[E.TEXTURE30=34014]="TEXTURE30",E[E.TEXTURE31=34015]="TEXTURE31",E[E.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",E[E.REPEAT=10497]="REPEAT",E[E.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",E[E.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",E[E.FLOAT_VEC2=35664]="FLOAT_VEC2",E[E.FLOAT_VEC3=35665]="FLOAT_VEC3",E[E.FLOAT_VEC4=35666]="FLOAT_VEC4",E[E.INT_VEC2=35667]="INT_VEC2",E[E.INT_VEC3=35668]="INT_VEC3",E[E.INT_VEC4=35669]="INT_VEC4",E[E.BOOL=35670]="BOOL",E[E.BOOL_VEC2=35671]="BOOL_VEC2",E[E.BOOL_VEC3=35672]="BOOL_VEC3",E[E.BOOL_VEC4=35673]="BOOL_VEC4",E[E.FLOAT_MAT2=35674]="FLOAT_MAT2",E[E.FLOAT_MAT3=35675]="FLOAT_MAT3",E[E.FLOAT_MAT4=35676]="FLOAT_MAT4",E[E.SAMPLER_2D=35678]="SAMPLER_2D",E[E.SAMPLER_CUBE=35680]="SAMPLER_CUBE",E[E.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",E[E.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",E[E.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",E[E.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",E[E.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",E[E.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",E[E.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",E[E.COMPILE_STATUS=35713]="COMPILE_STATUS",E[E.LOW_FLOAT=36336]="LOW_FLOAT",E[E.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",E[E.HIGH_FLOAT=36338]="HIGH_FLOAT",E[E.LOW_INT=36339]="LOW_INT",E[E.MEDIUM_INT=36340]="MEDIUM_INT",E[E.HIGH_INT=36341]="HIGH_INT",E[E.FRAMEBUFFER=36160]="FRAMEBUFFER",E[E.RENDERBUFFER=36161]="RENDERBUFFER",E[E.RGBA4=32854]="RGBA4",E[E.RGB5_A1=32855]="RGB5_A1",E[E.RGB565=36194]="RGB565",E[E.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",E[E.STENCIL_INDEX=6401]="STENCIL_INDEX",E[E.STENCIL_INDEX8=36168]="STENCIL_INDEX8",E[E.DEPTH_STENCIL=34041]="DEPTH_STENCIL",E[E.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",E[E.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",E[E.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",E[E.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",E[E.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",E[E.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",E[E.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",E[E.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",E[E.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",E[E.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",E[E.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",E[E.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",E[E.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",E[E.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",E[E.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",E[E.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",E[E.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",E[E.NONE=0]="NONE",E[E.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",E[E.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",E[E.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",E[E.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",E[E.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",E[E.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",E[E.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",E[E.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",E[E.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",E[E.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",E[E.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",E[E.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",E[E.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",E[E.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL"})(J||(J={}))},69530:function(ur,L,x){"use strict";x.d(L,{Z:function(){return Et}});var J=x(96156),E=x(55770),p=x(6610),w=x(5991),F=x(3473),Q=x(11700),Y=x.n(Q),le=x(14293),ne=x.n(le),be=x(68929),we=x.n(be),Ie=x(86700),$t=x(58881),Zt=x(72302),Xt=x(92364),Ft,Lt,_t,pt,Cr,Gt;function ar(Ne,Ae){var Be=Object.keys(Ne);if(Object.getOwnPropertySymbols){var bt=Object.getOwnPropertySymbols(Ne);Ae&&(bt=bt.filter(function(ir){return Object.getOwnPropertyDescriptor(Ne,ir).enumerable})),Be.push.apply(Be,bt)}return Be}function gt(Ne){for(var Ae=1;Ae<arguments.length;Ae++){var Be=arguments[Ae]!=null?arguments[Ae]:{};Ae%2?ar(Object(Be),!0).forEach(function(bt){(0,J.Z)(Ne,bt,Be[bt])}):Object.getOwnPropertyDescriptors?Object.defineProperties(Ne,Object.getOwnPropertyDescriptors(Be)):ar(Object(Be)).forEach(function(bt){Object.defineProperty(Ne,bt,Object.getOwnPropertyDescriptor(Be,bt))})}return Ne}var Ye=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Et=(Ft=(0,Ie.b2)(),Lt=(0,Ie.f3)(Zt.v.IShaderModuleService),Ft(_t=(pt=(Gt=function(){function Ne(){(0,p.Z)(this,Ne),(0,E.Z)(this,"shaderModuleService",Cr,this),this.rendererService=void 0,this.config=void 0,this.quad=Ye,this.enabled=!0,this.renderToScreen=!1,this.model=void 0,this.name=void 0,this.optionsToUpdate={}}return(0,w.Z)(Ne,[{key:"getName",value:function(){return this.name}},{key:"setName",value:function(Be){this.name=Be}},{key:"getType",value:function(){return Xt.G.PostProcessing}},{key:"init",value:function(Be,bt){this.config=bt,this.rendererService=Be.getContainer().get(Zt.v.IRendererService);var ir=this.rendererService,re=ir.createAttribute,Ee=ir.createBuffer,ae=ir.createModel,me=this.setupShaders(),Te=me.vs,Qe=me.fs,dt=me.uniforms;this.model=ae({vs:Te,fs:Qe,attributes:{a_Position:re({buffer:Ee({data:[-4,-4,4,-4,0,4],type:$t.gl.FLOAT}),size:2})},uniforms:gt(gt({u_Texture:null},dt),this.config&&this.convertOptionsToUniforms(this.config)),depth:{enable:!1},count:3,blend:{enable:this.getName()==="copy"}})}},{key:"render",value:function(Be){var bt=this,ir=Be.multiPassRenderer.getPostProcessor(),re=this.rendererService,Ee=re.useFramebuffer,ae=re.getViewportSize,me=re.clear,Te=ae(),Qe=Te.width,dt=Te.height;Ee(this.renderToScreen?null:ir.getWriteFBO(),function(){me({framebuffer:ir.getWriteFBO(),color:[0,0,0,0],depth:1,stencil:0}),bt.model.draw({uniforms:gt({u_Texture:ir.getReadFBO(),u_ViewportSize:[Qe,dt]},bt.convertOptionsToUniforms(bt.optionsToUpdate))})})}},{key:"isEnabled",value:function(){return this.enabled}},{key:"setEnabled",value:function(Be){this.enabled=Be}},{key:"setRenderToScreen",value:function(Be){this.renderToScreen=Be}},{key:"updateOptions",value:function(Be){this.optionsToUpdate=gt(gt({},this.optionsToUpdate),Be)}},{key:"setupShaders",value:function(){throw new Error("Method not implemented.")}},{key:"convertOptionsToUniforms",value:function(Be){var bt={};return Object.keys(Be).forEach(function(ir){ne()(Be[ir])||(bt["u_".concat(Y()(we()(ir)))]=Be[ir])}),bt}}]),Ne}(),Gt),Cr=(0,F.Z)(pt.prototype,"shaderModuleService",[Lt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pt))||_t)},19793:function(ur,L,x){"use strict";x.d(L,{P:function(){return J}});var J=["loaded","maploaded","resize","destroy","dragstart","dragging","dragend","dragcancel"]},93102:function(){},8628:function(){},72302:function(ur,L,x){"use strict";x.d(L,{v:function(){return J}});var J={IEventEmitter:Symbol.for("IEventEmitter"),ISceneService:Symbol.for("ISceneService"),IGlobalConfigService:Symbol.for("IGlobalConfigService"),ICameraService:Symbol.for("ICameraService"),ICoordinateSystemService:Symbol.for("ICoordinateSystemService"),ILayerService:Symbol.for("ILayerService"),ILayerMappingService:Symbol.for("ILayerMappingService"),ILayerStyleService:Symbol.for("ILayerStyleService"),ILogService:Symbol.for("ILogService"),IMapService:Symbol.for("IMapService"),IMarkerService:Symbol.for("IMarkerService"),IPopupService:Symbol.for("PopupService"),IFactoryMapService:Symbol.for("Factory<IMapService>"),IRendererService:Symbol.for("IRendererService"),IShaderModuleService:Symbol.for("IShaderModuleService"),IIconService:Symbol.for("IIconService"),IFontService:Symbol.for("IFontService"),IInteractionService:Symbol.for("IInteractionService"),IPickingService:Symbol.for("IPickingService"),IControlService:Symbol.for("IControlService"),IStyleAttributeService:Symbol.for("IStyleAttributeService"),ILayer:Symbol.for("ILayer"),ILayerPlugin:Symbol.for("ILayerPlugin"),INormalPass:Symbol.for("INormalPass"),IPostProcessor:Symbol.for("IPostProcessor"),IPostProcessingPass:Symbol.for("IPostProcessingPass"),IFactoryPostProcessingPass:Symbol.for("Factory<IPostProcessingPass>"),IFactoryNormalPass:Symbol.for("Factory<IFactoryNormalPass>"),IMultiPassRenderer:Symbol.for("IMultiPassRenderer"),SceneID:Symbol.for("SceneID"),MapConfig:Symbol.for("MapConfig")}},76915:function(ur,L,x){"use strict";var J=x(74691),E=null;function p(Ne){return E.indexOf(Ne)}var w=2,F=4,Q=64,Y=128,le=256,ne=512,be=8192,we=16384,Ie=32768,$t=null,Zt=131072,Xt=262144,Ft=524288,Lt=1048576,_t=2097152,pt=4194304,Cr=8388608,Gt=16777216,ar=null;function gt(Ne,Ae){return Ne=_clamp(Math.floor(Ne),0,255),Ae=_clamp(Math.floor(Ae),0,255),256*Ne+Ae}function Ye(Ne){var Ae=Ne.color,Be=Ne.radius,bt=Ne.tileX,ir=Ne.tileY,re=Ne.shape,Ee=Ne.opacity,ae=Ne.stroke,me=Ne.strokeWidth,Te=Ne.strokeOpacity,Qe=[],dt=[],Jt=[],Nr=[gt(Ae[0],Ae[1]),gt(Ae[2],Ae[3])],Fr=[gt(ae[0],ae[1]),gt(ae[2],ae[3])];return[[-1,-1],[1,-1],[1,1],[-1,1]].forEach(function(ln){var tr=_slicedToArray(ln,2),se=tr[0],ge=tr[1];Qe.push([].concat(Nr,[(se+1)*Cr+(ge+1)*_t+getShapeIndex(re)*Zt+Be,(bt+512)*Ft+(ir+512)*Q])),dt.push([].concat(Fr,[me,Te])),Jt.push([Ee,0,0,0])}),{packedBuffer:Qe,packedBuffer2:dt,packedBuffer3:Jt}}function Et(Ne,Ae){if(Ne===0&&!Ae)return 0;if(Ne===1&&Ae)return 4294967295;var Be=Ae?1:0,bt=Math.floor(Ne*127);return bt*ar+Be*Gt+bt*Zt+Be*$t+bt*ne+Be*le+bt*w+Be}},63515:function(ur,L,x){"use strict";x.d(L,{zP:function(){return ky},JE:function(){return kg},ns:function(){return Dy}});var J=x(67294),E=(0,J.createContext)({});function p(){return(0,J.useContext)(E)}var w=x(58881),F=x(96156),Q=x(28481),Y=x(6610),le=x(5991),ne=x(10379),be=x(46070),we=x(77608),Ie=x(6901),$t=x(26729);function Zt(i,f){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(i);f&&(u=u.filter(function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable})),o.push.apply(o,u)}return o}function Xt(i){for(var f=1;f<arguments.length;f++){var o=arguments[f]!=null?arguments[f]:{};f%2?Zt(Object(o),!0).forEach(function(u){(0,F.Z)(i,u,o[u])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):Zt(Object(o)).forEach(function(u){Object.defineProperty(i,u,Object.getOwnPropertyDescriptor(o,u))})}return i}function Ft(i){var f=Lt();return function(){var u=(0,we.Z)(i),l;if(f){var d=(0,we.Z)(this).constructor;l=Reflect.construct(u,arguments,d)}else l=u.apply(this,arguments);return(0,be.Z)(this,l)}}function Lt(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var _t;(function(i){i.TOPRIGHT="topright",i.TOPLEFT="topleft",i.BOTTOMRIGHT="bottomright",i.BOTTOMLEFT="bottomleft"})(_t||(_t={}));var pt=0,Cr=function(i){(0,ne.Z)(o,i);var f=Ft(o);function o(u){var l;return(0,Y.Z)(this,o),l=f.call(this),l.controlOption=void 0,l.container=void 0,l.sceneContainer=void 0,l.mapsService=void 0,l.renderService=void 0,l.layerService=void 0,l.controlService=void 0,l.isShow=void 0,l.controlOption=Xt(Xt({},l.getDefault()),u||{}),l}return(0,le.Z)(o,[{key:"getDefault",value:function(){return{position:_t.TOPRIGHT,name:"".concat(pt++)}}},{key:"setPosition",value:function(){var l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"bottomright",d=this.controlService;return d&&d.removeControl(this),this.controlOption.position=l,d&&d.addControl(this,this.sceneContainer),this}},{key:"addTo",value:function(l){this.mapsService=l.get(w.vK.IMapService),this.renderService=l.get(w.vK.IRendererService),this.layerService=l.get(w.vK.ILayerService),this.controlService=l.get(w.vK.IControlService),this.sceneContainer=l,this.isShow=!0,this.container=this.onAdd();var d=this.container,y=this.controlOption.position,A=this.controlService.controlCorners[y];return Ie.SO.addClass(d,"l7-control"),y.indexOf("bottom")!==-1?A.insertBefore(d,A.firstChild):A.appendChild(d),this}},{key:"onAdd",value:function(){throw new Error("Method not implemented.")}},{key:"onRemove",value:function(){throw new Error("Method not implemented.")}},{key:"hide",value:function(){var l=this.container;Ie.SO.addClass(l,"l7-control-hide"),this.isShow=!1}},{key:"show",value:function(){var l=this.container;Ie.SO.removeClass(l,"l7-control-hide"),this.isShow=!0}},{key:"remove",value:function(){if(!this.mapsService)return this;Ie.SO.remove(this.container),this.onRemove()}},{key:"_refocusOnMap",value:function(l){if(this.mapsService&&l&&l.screenX>0&&l.screenY>0){var d=this.mapsService.getContainer();d!==null&&d.focus()}}}]),o}($t.EventEmitter),Gt=x(63349);function ar(i){var f=gt();return function(){var u=(0,we.Z)(i),l;if(f){var d=(0,we.Z)(this).constructor;l=Reflect.construct(u,arguments,d)}else l=u.apply(this,arguments);return(0,be.Z)(this,l)}}function gt(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var Ye=function(i){(0,ne.Z)(o,i);var f=ar(o);function o(u){var l;return(0,Y.Z)(this,o),l=f.call(this,u),l.layerControlInputs=void 0,l.layers=void 0,l.lastZIndex=void 0,l.handlingClick=void 0,l.layersLink=void 0,l.baseLayersList=void 0,l.separator=void 0,l.overlaysList=void 0,l.form=void 0,l.layerControlInputs=[],l.layers=[],l.lastZIndex=0,l.handlingClick=!1,l.initLayers(),(0,Ie.Ev)(["checkDisabledLayers","onLayerChange","collapse","extend","expand","onInputClick"],(0,Gt.Z)(l)),l}return(0,le.Z)(o,[{key:"getDefault",value:function(){return{collapsed:!0,position:w.PositionType.TOPRIGHT,autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,name:"layers"}}},{key:"onAdd",value:function(){var l=this;return this.initLayout(),this.update(),this.mapsService.on("zoomend",this.checkDisabledLayers),this.layers.forEach(function(d){d.layer.on("remove",l.onLayerChange),d.layer.on("add",l.onLayerChange)}),this.container}},{key:"addVisualLayer",value:function(l,d){return this.addLayer(l,d,!0),this.mapsService?this.update():this}},{key:"expand",value:function(){var l=this.renderService.getViewportSize(),d=l.height;Ie.SO.addClass(this.container,"l7-control-layers-expanded"),this.form.style.height="null";var y=d-(this.container.offsetTop+50);return y<this.form.clientHeight?(Ie.SO.addClass(this.form,"l7-control-layers-scrollbar"),this.form.style.height=y+"px"):Ie.SO.removeClass(this.form,"l7-control-layers-scrollbar"),this.checkDisabledLayers(),this}},{key:"collapse",value:function(){return Ie.SO.removeClass(this.container,"l7-control-layers-expanded"),this}},{key:"onRemove",value:function(){var l=this;!this.mapsService||(this.mapsService.off("click",this.collapse),this.layers.forEach(function(d){d.layer.off("remove",l.onLayerChange),d.layer.off("add",l.onLayerChange)}))}},{key:"initLayout",value:function(){var l="l7-control-layers",d=this.container=Ie.SO.create("div",l),y=this.controlOption.collapsed;d.setAttribute("aria-haspopup","true");var A=this.form=Ie.SO.create("form",l+"-list");y&&(this.mapsService.on("click",this.collapse),d.addEventListener("mouseenter",this.expand),d.addEventListener("mouseleave",this.collapse)),this.layersLink=Ie.SO.create("a",l+"-toggle",d);var M=this.layersLink;M.title="Layers",y||this.expand(),this.baseLayersList=Ie.SO.create("div",l+"-base",A),this.separator=Ie.SO.create("div",l+"-separator",A),this.overlaysList=Ie.SO.create("div",l+"-overlays",A),d.appendChild(A)}},{key:"initLayers",value:function(){var l=this,d=this.controlOption,y=d.baseLayers,A=y===void 0?{}:y,M=d.overlayers,D=M===void 0?{}:M;Object.keys(A).forEach(function(ee,X){l.addLayer(A[ee],ee,!1)}),Object.keys(D).forEach(function(ee,X){l.addLayer(D[ee],ee,!0)})}},{key:"update",value:function(){if(!this.container)return this;Ie.SO.empty(this.baseLayersList),Ie.SO.empty(this.overlaysList),this.layerControlInputs=[];var l,d,y,A,M=0;for(y=0;y<this.layers.length;y++)A=this.layers[y],this.addItem(A),d=d||A.overlay,l=l||!A.overlay,M+=A.overlay?0:1;return this.controlOption.hideSingleBase&&(l=l&&M>1,this.baseLayersList.style.display=l?"":"none"),this.separator.style.display=d&&l?"":"none",this}},{key:"checkDisabledLayers",value:function(){for(var l=this.layerControlInputs,d,y,A=this.mapsService.getZoom(),M=l.length-1;M>=0;M--)if(d=l[M],y=this.layerService.getLayer(d.layerId),y&&y.inited){var D=y.getMinZoom(),ee=y.getMaxZoom();d.disabled=A<D||A>ee}}},{key:"addLayer",value:function(l,d,y){this.mapsService&&(l.on("add",this.onLayerChange),l.on("remove",this.onLayerChange)),this.layers.push({layer:l,name:d,overlay:y});var A=this.controlOption,M=A.sortLayers,D=A.sortFunction,ee=A.autoZIndex;M&&this.layers.sort(function(X,fe){return D(X.layer,fe.layer,X.name,fe.name)}),ee&&l.setZIndex&&(this.lastZIndex++,l.setZIndex(this.lastZIndex)),this.expandIfNotCollapsed()}},{key:"expandIfNotCollapsed",value:function(){return this.mapsService&&!this.controlOption.collapsed&&this.expand(),this}},{key:"onLayerChange",value:function(l){this.handlingClick||this.update();var d=this.layerService.getLayer(l.target.layerId),y=d!=null&&d.overlay?l.type==="add"?"overlayadd":"overlayremove":l.type==="add"?"baselayerchange":null;y&&this.emit(y,d)}},{key:"createRadioElement",value:function(l,d){var y='<input type="radio" class="l7-control-layers-selector" name="'+l+'"'+(d?' checked="checked"':"")+"/>",A=document.createElement("div");return A.innerHTML=y,A.firstChild}},{key:"addItem",value:function(l){var d=document.createElement("label"),y=this.layerService.getLayer(l.layer.id),A=y&&y.inited&&l.layer.isVisible(),M;l.overlay?(M=document.createElement("input"),M.type="checkbox",M.className="l7-control-layers-selector",M.defaultChecked=A):M=this.createRadioElement("l7-base-layers",A),this.layerControlInputs.push(M),M.layerId=l.layer.id,M.addEventListener("click",this.onInputClick);var D=document.createElement("span");D.innerHTML=" "+l.name;var ee=document.createElement("div");d.appendChild(ee),ee.appendChild(M),ee.appendChild(D);var X=l.overlay?this.overlaysList:this.baseLayersList;return X.appendChild(d),this.checkDisabledLayers(),d}},{key:"onInputClick",value:function(){var l=this.layerControlInputs,d,y,A=[],M=[];this.handlingClick=!0;for(var D=l.length-1;D>=0;D--)d=l[D],y=this.layerService.getLayer(d.layerId),d.checked?A.push(y):d.checked||M.push(y);M.forEach(function(ee){ee.hide()}),A.forEach(function(ee){ee.show()}),this.handlingClick=!1}}]),o}(Cr);function Et(i){var f=Ne();return function(){var u=(0,we.Z)(i),l;if(f){var d=(0,we.Z)(this).constructor;l=Reflect.construct(u,arguments,d)}else l=u.apply(this,arguments);return(0,be.Z)(this,l)}}function Ne(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var Ae=function(i){(0,ne.Z)(o,i);var f=Et(o);function o(){return(0,Y.Z)(this,o),f.apply(this,arguments)}return(0,le.Z)(o,[{key:"getDefault",value:function(){return{position:_t.BOTTOMLEFT,name:"logo"}}},{key:"onAdd",value:function(){var l="l7-control-logo",d=Ie.SO.create("div",l),y=Ie.SO.create("a","l7-ctrl-logo");return y.target="_blank",y.rel="noopener nofollow",y.href="https://antv.alipay.com/l7",y.setAttribute("aria-label","AntV logo"),y.setAttribute("rel","noopener nofollow"),d.appendChild(y),d}},{key:"onRemove",value:function(){return null}}]),o}(Cr);function Be(i){var f=bt();return function(){var u=(0,we.Z)(i),l;if(f){var d=(0,we.Z)(this).constructor;l=Reflect.construct(u,arguments,d)}else l=u.apply(this,arguments);return(0,be.Z)(this,l)}}function bt(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var ir=function(i){(0,ne.Z)(o,i);var f=Be(o);function o(u){var l;return(0,Y.Z)(this,o),l=f.call(this,u),l.mScale=void 0,l.iScale=void 0,(0,Ie.Ev)(["update"],(0,Gt.Z)(l)),l}return(0,le.Z)(o,[{key:"getDefault",value:function(){return{position:_t.BOTTOMLEFT,maxWidth:100,metric:!0,updateWhenIdle:!1,imperial:!1,name:"scale"}}},{key:"onAdd",value:function(){var l="l7-control-scale",d=Ie.SO.create("div",l);this.addScales(l+"-line",d);var y=this.controlOption.updateWhenIdle;return this.mapsService.on(y?"moveend":"mapmove",this.update),this.mapsService.on(y?"zoomend":"zoomchange",this.update),this.update(),d}},{key:"onRemove",value:function(){var l=this.controlOption.updateWhenIdle;this.mapsService.off(l?"zoomend":"zoomchange",this.update),this.mapsService.off(l?"moveend":"mapmove",this.update)}},{key:"update",value:function(){var l=this.mapsService,d=this.controlOption.maxWidth,y=l.getSize()[1]/2,A=l.containerToLngLat([0,y]),M=l.containerToLngLat([d,y]),D=(0,Ie.yM)([A.lng,A.lat],[M.lng,M.lat]);this.updateScales(D)}},{key:"updateScales",value:function(l){var d=this.controlOption,y=d.metric,A=d.imperial;y&&l&&this.updateMetric(l),A&&l&&this.updateImperial(l)}},{key:"updateMetric",value:function(l){var d=this.getRoundNum(l),y=d<1e3?d+" m":d/1e3+" km";this.updateScale(this.mScale,y,d/l)}},{key:"updateImperial",value:function(l){var d=l*3.2808399,y,A,M;d>5280?(y=d/5280,A=this.getRoundNum(y),this.updateScale(this.iScale,A+" mi",A/y)):(M=this.getRoundNum(d),this.updateScale(this.iScale,M+" ft",M/d))}},{key:"updateScale",value:function(l,d,y){var A=this.controlOption.maxWidth;l.style.width=Math.round(A*y)+"px",l.innerHTML=d}},{key:"getRoundNum",value:function(l){var d=Math.pow(10,(Math.floor(l)+"").length-1),y=l/d;return y=y>=10?10:y>=5?5:y>=3?3:y>=2?2:1,d*y}},{key:"addScales",value:function(l,d){var y=this.controlOption,A=y.metric,M=y.imperial;A&&(this.mScale=Ie.SO.create("div",l,d)),M&&(this.iScale=Ie.SO.create("div",l,d))}}]),o}(Cr);function re(i){var f=Ee();return function(){var u=(0,we.Z)(i),l;if(f){var d=(0,we.Z)(this).constructor;l=Reflect.construct(u,arguments,d)}else l=u.apply(this,arguments);return(0,be.Z)(this,l)}}function Ee(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var ae=function(i){(0,ne.Z)(o,i);var f=re(o);function o(u){var l;return(0,Y.Z)(this,o),l=f.call(this,u),l.disabled=void 0,l.zoomInButton=void 0,l.zoomOutButton=void 0,(0,Ie.Ev)(["updateDisabled","zoomIn","zoomOut"],(0,Gt.Z)(l)),l}return(0,le.Z)(o,[{key:"getDefault",value:function(){return{position:_t.TOPLEFT,zoomInText:"+",zoomInTitle:"Zoom in",zoomOutText:"&#x2212;",zoomOutTitle:"Zoom out",name:"zoom"}}},{key:"onAdd",value:function(){var l="l7-control-zoom",d=Ie.SO.create("div",l+" l7-bar");return this.zoomInButton=this.createButton(this.controlOption.zoomInText,this.controlOption.zoomInTitle,l+"-in",d,this.zoomIn),this.zoomOutButton=this.createButton(this.controlOption.zoomOutText,this.controlOption.zoomOutTitle,l+"-out",d,this.zoomOut),this.mapsService.on("zoomend",this.updateDisabled),this.mapsService.on("zoomchange",this.updateDisabled),this.updateDisabled(),d}},{key:"onRemove",value:function(){this.mapsService.off("zoomend",this.updateDisabled),this.mapsService.off("zoomchange",this.updateDisabled)}},{key:"disable",value:function(){return this.disabled=!0,this.updateDisabled(),this}},{key:"enable",value:function(){return this.disabled=!1,this.updateDisabled(),this}},{key:"zoomIn",value:function(){!this.disabled&&this.mapsService.getZoom()<this.mapsService.getMaxZoom()&&this.mapsService.zoomIn()}},{key:"zoomOut",value:function(){!this.disabled&&this.mapsService.getZoom()>this.mapsService.getMinZoom()&&this.mapsService.zoomOut()}},{key:"createButton",value:function(l,d,y,A,M){var D=Ie.SO.create("a",y,A);return D.innerHTML=l,D.title=d,D.href="javascript:void(0)",D.addEventListener("click",M),D}},{key:"updateDisabled",value:function(){var l=this.mapsService,d="l7-disabled";Ie.SO.removeClass(this.zoomInButton,d),Ie.SO.removeClass(this.zoomOutButton,d),(this.disabled||l.getZoom()<=l.getMinZoom())&&Ie.SO.addClass(this.zoomOutButton,d),(this.disabled||l.getZoom()>=l.getMaxZoom())&&Ie.SO.addClass(this.zoomInButton,d)}}]),o}(Cr);function me(i,f){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(i);f&&(u=u.filter(function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable})),o.push.apply(o,u)}return o}function Te(i){for(var f=1;f<arguments.length;f++){var o=arguments[f]!=null?arguments[f]:{};f%2?me(Object(o),!0).forEach(function(u){(0,F.Z)(i,u,o[u])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):me(Object(o)).forEach(function(u){Object.defineProperty(i,u,Object.getOwnPropertyDescriptor(o,u))})}return i}function Qe(i){var f=dt();return function(){var u=(0,we.Z)(i),l;if(f){var d=(0,we.Z)(this).constructor;l=Reflect.construct(u,arguments,d)}else l=u.apply(this,arguments);return(0,be.Z)(this,l)}}function dt(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var Jt=function(i){(0,ne.Z)(o,i);var f=Qe(o);function o(u){var l;return(0,Y.Z)(this,o),l=f.call(this),l.markerOption=void 0,l.defaultMarker=void 0,l.popup=void 0,l.mapsService=void 0,l.sceneSerive=void 0,l.lngLat=void 0,l.scene=void 0,l.added=!1,l.eventHandle=function(d){l.emit(d.type,{target:d,data:l.markerOption.extData,lngLat:l.lngLat})},l.markerOption=Te(Te({},l.getDefault()),u),(0,Ie.Ev)(["update","onMove","onUp","addDragHandler","onMapClick"],(0,Gt.Z)(l)),l.init(),l}return(0,le.Z)(o,[{key:"getDefault",value:function(){return{element:void 0,anchor:Ie.bV.BOTTOM,offsets:[0,0],color:"#5B8FF9",draggable:!1}}},{key:"addTo",value:function(l){this.scene=l,this.mapsService=l.get(w.vK.IMapService),this.sceneSerive=l.get(w.vK.ISceneService);var d=this.markerOption,y=d.element,A=d.draggable;return this.mapsService.getMarkerContainer().appendChild(y),this.registerMarkerEvent(y),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update),this.update(),this.added=!0,this.emit("added"),this}},{key:"remove",value:function(){this.mapsService&&(this.mapsService.off("click",this.onMapClick),this.mapsService.off("move",this.update),this.mapsService.off("moveend",this.update),this.mapsService.off("mousedown",this.addDragHandler),this.mapsService.off("touchstart",this.addDragHandler),this.mapsService.off("mouseup",this.onUp),this.mapsService.off("touchend",this.onUp)),this.unRegisterMarkerEvent(),this.removeAllListeners();var l=this.markerOption.element;return l&&Ie.SO.remove(l),this.popup&&this.popup.remove(),this}},{key:"setLnglat",value:function(l){return this.lngLat=l,Array.isArray(l)&&(this.lngLat={lng:l[0],lat:l[1]}),this.popup&&this.popup.setLnglat(this.lngLat),this.update(),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"getElement",value:function(){return this.markerOption.element}},{key:"setElement",value:function(l){var d=this;if(!this.added)return this.once("added",function(){d.setElement(l)}),this;var y=this.markerOption.element;return y&&Ie.SO.remove(y),this.markerOption.element=l,this.init(),this.mapsService.getMarkerContainer().appendChild(l),this.registerMarkerEvent(l),this.update(),this}},{key:"openPopup",value:function(){var l=this;if(!this.added)return this.once("added",function(){l.openPopup()}),this;var d=this.popup;return d?(d.isOpen()||d.addTo(this.scene),this):this}},{key:"closePopup",value:function(){var l=this;this.added||this.once("added",function(){l.closePopup()});var d=this.popup;return d&&d.remove(),this}},{key:"setPopup",value:function(l){return this.popup=l,this.lngLat&&this.popup.setLnglat(this.lngLat),this}},{key:"togglePopup",value:function(){var l=this.popup;if(l)l.isOpen()?l.remove():l.addTo(this.scene);else return this;return this}},{key:"getPopup",value:function(){return this.popup}},{key:"getOffset",value:function(){return this.markerOption.offsets}},{key:"setDraggable",value:function(l){throw new Error("Method not implemented.")}},{key:"isDraggable",value:function(){return this.markerOption.draggable}},{key:"getExtData",value:function(){return this.markerOption.extData}},{key:"setExtData",value:function(l){this.markerOption.extData=l}},{key:"update",value:function(){if(!!this.mapsService){var l=this.markerOption,d=l.element,y=l.anchor;this.updatePosition(),Ie.SO.setTransform(d,"".concat(Ie.rQ[y]))}}},{key:"onMapClick",value:function(l){var d=this.markerOption.element;this.popup&&d&&this.togglePopup()}},{key:"updatePosition",value:function(){if(!!this.mapsService){var l=this.markerOption,d=l.element,y=l.offsets,A=this.lngLat,M=A.lng,D=A.lat,ee=this.mapsService.getBounds(),X=this.mapsService.lngLatToContainer([M,D]);if(d){d.style.display="block";var fe=this.mapsService.getContainer(),Xe=0,it=0;if(fe&&(Xe=fe.scrollWidth,it=fe.scrollHeight),Math.abs(ee[0][0])>180||Math.abs(ee[1][0])>180){if(X.x>Xe){var Rt=this.mapsService.lngLatToContainer([M-360,D]);X.x=Rt.x}if(X.x<0){var xr=this.mapsService.lngLatToContainer([M+360,D]);X.x=xr.x}}(X.x>Xe||X.x<0||X.y>it||X.y<0)&&(d.style.display="none"),d.style.left=X.x+y[0]+"px",d.style.top=X.y-y[1]+"px"}}}},{key:"init",value:function(){var l=this,d=this.markerOption.element,y=this.markerOption,A=y.color,M=y.anchor;if(!d){this.defaultMarker=!0,d=Ie.SO.create("div"),this.markerOption.element=d;var D=document.createElementNS("http://www.w3.org/2000/svg","svg");D.setAttributeNS(null,"display","block"),D.setAttributeNS(null,"height","48px"),D.setAttributeNS(null,"width","48px"),D.setAttributeNS(null,"viewBox","0 0 1024 1024");var ee=document.createElementNS("http://www.w3.org/2000/svg","path");ee.setAttributeNS(null,"d","M512 490.666667C453.12 490.666667 405.333333 442.88 405.333333 384 405.333333 325.12 453.12 277.333333 512 277.333333 570.88 277.333333 618.666667 325.12 618.666667 384 618.666667 442.88 570.88 490.666667 512 490.666667M512 85.333333C346.88 85.333333 213.333333 218.88 213.333333 384 213.333333 608 512 938.666667 512 938.666667 512 938.666667 810.666667 608 810.666667 384 810.666667 218.88 677.12 85.333333 512 85.333333Z"),ee.setAttributeNS(null,"fill",A),D.appendChild(ee),d.appendChild(D)}Ie.SO.addClass(d,"l7-marker"),Object.keys(this.markerOption.style||{}).forEach(function(X){var fe,Xe,it=((fe=l.markerOption)===null||fe===void 0?void 0:fe.style)&&((Xe=l.markerOption)===null||Xe===void 0?void 0:Xe.style[X]);d&&(d.style[X]=it)}),d.addEventListener("click",function(X){l.onMapClick(X)}),d.addEventListener("click",this.eventHandle),(0,Ie.zi)(d,M,"marker")}},{key:"registerMarkerEvent",value:function(l){l.addEventListener("mousemove",this.eventHandle),l.addEventListener("click",this.eventHandle),l.addEventListener("mousedown",this.eventHandle),l.addEventListener("mouseup",this.eventHandle),l.addEventListener("dblclick",this.eventHandle),l.addEventListener("contextmenu",this.eventHandle),l.addEventListener("mouseover",this.eventHandle),l.addEventListener("mouseout",this.eventHandle)}},{key:"unRegisterMarkerEvent",value:function(){var l=this.getElement();l.removeEventListener("mousemove",this.eventHandle),l.removeEventListener("click",this.eventHandle),l.removeEventListener("mousedown",this.eventHandle),l.removeEventListener("mouseup",this.eventHandle),l.removeEventListener("dblclick",this.eventHandle),l.removeEventListener("contextmenu",this.eventHandle),l.removeEventListener("mouseover",this.eventHandle),l.removeEventListener("mouseout",this.eventHandle)}},{key:"addDragHandler",value:function(l){throw new Error("Method not implemented.")}},{key:"onUp",value:function(l){throw new Error("Method not implemented.")}}]),o}($t.EventEmitter),Nr=x(82492),Fr=x.n(Nr),ln=x(69848),tr=x.n(ln);function se(i,f){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(i);f&&(u=u.filter(function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable})),o.push.apply(o,u)}return o}function ge(i){for(var f=1;f<arguments.length;f++){var o=arguments[f]!=null?arguments[f]:{};f%2?se(Object(o),!0).forEach(function(u){(0,F.Z)(i,u,o[u])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):se(Object(o)).forEach(function(u){Object.defineProperty(i,u,Object.getOwnPropertyDescriptor(o,u))})}return i}function Re(i){var f=tt();return function(){var u=(0,we.Z)(i),l;if(f){var d=(0,we.Z)(this).constructor;l=Reflect.construct(u,arguments,d)}else l=u.apply(this,arguments);return(0,be.Z)(this,l)}}function tt(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var Mt=function(i){(0,ne.Z)(o,i);var f=Re(o);function o(u){var l,d;return(0,Y.Z)(this,o),d=f.call(this),d.markers=[],d.markerLayerOption=void 0,d.clusterIndex=void 0,d.points=[],d.clusterMarkers=[],d.mapsService=void 0,d.scene=void 0,d.zoom=void 0,d.bbox=void 0,d.markerLayerOption=Fr()(d.getDefault(),u),(0,Ie.Ev)(["update"],(0,Gt.Z)(d)),d.zoom=((l=d.markerLayerOption.clusterOption)===null||l===void 0?void 0:l.zoom)||-99,d}return(0,le.Z)(o,[{key:"getDefault",value:function(){return{cluster:!1,clusterOption:{radius:80,maxZoom:20,minZoom:0,zoom:-99,style:{},className:""}}}},{key:"addTo",value:function(l){return this.scene=l,this.mapsService=l.get(w.vK.IMapService),this.markerLayerOption.cluster&&(this.initCluster(),this.update(),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.addMarkers(),this}},{key:"addMarker",value:function(l){var d=this.markerLayerOption.cluster;d&&this.addPoint(l,this.markers.length),this.markers.push(l)}},{key:"removeMarker",value:function(l){this.markers.indexOf(l);var d=this.markers.indexOf(l);d>-1&&this.markers.splice(d,1)}},{key:"hide",value:function(){this.markers.map(function(l){l.getElement().style.opacity="0"})}},{key:"show",value:function(){this.markers.map(function(l){l.getElement().style.opacity="1"})}},{key:"getMarkers",value:function(){var l=this.markerLayerOption.cluster;return l?this.clusterMarkers:this.markers}},{key:"addMarkers",value:function(){var l=this;this.getMarkers().forEach(function(d){d.addTo(l.scene)})}},{key:"clear",value:function(){this.markers.forEach(function(l){l.remove()}),this.clusterMarkers.forEach(function(l){l.remove()}),this.mapsService.off("camerachange",this.update),this.markers=[],this.clusterMarkers=[]}},{key:"destroy",value:function(){this.clear(),this.removeAllListeners()}},{key:"addPoint",value:function(l,d){var y=l.getLnglat(),A=y.lng,M=y.lat,D={geometry:{type:"Point",coordinates:[A,M]},properties:ge(ge({},l.getExtData()),{},{marker_id:d})};this.points.push(D)}},{key:"initCluster",value:function(){if(!!this.markerLayerOption.cluster){var l=this.markerLayerOption.clusterOption,d=l.radius,y=l.minZoom,A=y===void 0?0:y,M=l.maxZoom;this.clusterIndex=new(tr())({radius:d,minZoom:A,maxZoom:M}),this.clusterIndex.load(this.points)}}},{key:"getClusterMarker",value:function(l,d){var y=this,A=l[0].concat(l[1]),M=this.clusterIndex.getClusters(A,d);this.clusterMarkers.forEach(function(D){D.remove()}),this.clusterMarkers=[],M.forEach(function(D){var ee,X=y.markerLayerOption.clusterOption,fe=X.field,Xe=X.method;if(D.properties&&(ee=D.properties)!==null&&ee!==void 0&&ee.cluster_id){var it,Rt=y.getLeaves((it=D.properties)===null||it===void 0?void 0:it.cluster_id);if(D.properties.clusterData=Rt,fe&&Xe){var xr=Rt==null?void 0:Rt.map(function(Gn){var Li=(0,F.Z)({},fe,Gn.properties[fe]);return Li}),Tr=Ie.a5.getColumn(xr,fe),jr=Ie.a5.getSatByColumn(Xe,Tr),dn="point_"+Xe;D.properties[dn]=jr.toFixed(2)}}var bn=y.clusterMarker(D);y.clusterMarkers.push(bn),bn.addTo(y.scene)})}},{key:"getLeaves",value:function(l){var d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Infinity,y=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;return l?this.clusterIndex.getLeaves(l,d,y):null}},{key:"clusterMarker",value:function(l){var d=this.markerLayerOption.clusterOption,y=d,A=y.element,M=A===void 0?this.generateElement.bind(this):A,D=new Jt({element:M(l)}).setLnglat({lng:l.geometry.coordinates[0],lat:l.geometry.coordinates[1]});return D}},{key:"normalMarker",value:function(l){var d=l.properties.marker_id;return this.markers[d]}},{key:"update",value:function(){var l=this.mapsService.getZoom(),d=this.mapsService.getBounds();(!this.bbox||Math.abs(l-this.zoom)>=1||!(0,Ie.oO)(this.bbox,d))&&(this.bbox=(0,Ie.yA)(d,.5),this.zoom=Math.floor(l),this.getClusterMarker(this.bbox,this.zoom))}},{key:"generateElement",value:function(l){var d=Ie.SO.create("div","l7-marker-cluster"),y=Ie.SO.create("div","",d),A=Ie.SO.create("span","",y),M=this.markerLayerOption.clusterOption,D=M.field,ee=M.method;l.properties.point_count=l.properties.point_count||1;var X=D&&ee?l.properties["point_"+ee]||l.properties[D]:l.properties.point_count;return A.textContent=X,d}}]),o}($t.EventEmitter);function Dt(i,f){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(i);f&&(u=u.filter(function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable})),o.push.apply(o,u)}return o}function S(i){for(var f=1;f<arguments.length;f++){var o=arguments[f]!=null?arguments[f]:{};f%2?Dt(Object(o),!0).forEach(function(u){(0,F.Z)(i,u,o[u])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):Dt(Object(o)).forEach(function(u){Object.defineProperty(i,u,Object.getOwnPropertyDescriptor(o,u))})}return i}function z(i){var f=pe();return function(){var u=(0,we.Z)(i),l;if(f){var d=(0,we.Z)(this).constructor;l=Reflect.construct(u,arguments,d)}else l=u.apply(this,arguments);return(0,be.Z)(this,l)}}function pe(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var Ue=function(i){(0,ne.Z)(o,i);var f=z(o);function o(u){var l;return(0,Y.Z)(this,o),l=f.call(this),l.popupOption=void 0,l.mapsService=void 0,l.sceneSerive=void 0,l.lngLat=void 0,l.content=void 0,l.closeButton=void 0,l.timeoutInstance=void 0,l.container=void 0,l.tip=void 0,l.scene=void 0,l.popupOption=S(S({},l.getdefault()),u),(0,Ie.Ev)(["update","onClickClose","remove"],(0,Gt.Z)(l)),l}return(0,le.Z)(o,[{key:"addTo",value:function(l){var d=this;return this.mapsService=l.get(w.vK.IMapService),this.sceneSerive=l.get(w.vK.ISceneService),this.mapsService.on("camerachange",this.update),this.scene=l,this.update(),this.popupOption.closeOnClick&&(this.timeoutInstance=setTimeout(function(){d.mapsService.on("click",d.onClickClose)},30)),this.emit("open"),this}},{key:"close",value:function(){this.remove()}},{key:"open",value:function(){this.addTo(this.scene)}},{key:"setHTML",value:function(l){var d=window.document.createDocumentFragment(),y=window.document.createElement("body"),A;for(y.innerHTML=l;A=y.firstChild,!!A;)d.appendChild(A);return this.setDOMContent(d)}},{key:"setLnglat",value:function(l){return this.lngLat=l,Array.isArray(l)&&(this.lngLat={lng:l[0],lat:l[1]}),this.mapsService&&this.mapsService.on("camerachange",this.update),this.update(),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"setText",value:function(l){return this.setDOMContent(window.document.createTextNode(l))}},{key:"setMaxWidth",value:function(l){return this.popupOption.maxWidth=l,this.update(),this}},{key:"setDOMContent",value:function(l){return this.createContent(),this.content.appendChild(l),this.update(),this}},{key:"remove",value:function(){return this.content&&this.removeDom(this.content),this.container&&(this.removeDom(this.container),delete this.container),this.mapsService&&(this.mapsService.off("camerachange",this.update),this.mapsService.off("click",this.onClickClose),delete this.mapsService),clearTimeout(this.timeoutInstance),this.emit("close"),this}},{key:"isOpen",value:function(){return!!this.mapsService}},{key:"createContent",value:function(){this.content&&Ie.SO.remove(this.content),this.content=Ie.SO.create("div","l7-popup-content",this.container),this.popupOption.closeButton&&(this.closeButton=Ie.SO.create("button","l7-popup-close-button",this.content),this.closeButton.setAttribute("aria-label","Close popup"),this.closeButton.innerHTML="&#215;",this.closeButton.addEventListener("click",this.onClickClose))}},{key:"creatDom",value:function(l,d,y){var A=window.document.createElement(l);return d!==void 0&&(A.className=d),y&&y.appendChild(A),A}},{key:"removeDom",value:function(l){l.parentNode&&l.parentNode.removeChild(l)}},{key:"getdefault",value:function(){return{closeButton:!0,closeOnClick:!0,maxWidth:"240px",offsets:[0,0],anchor:Ie.bV.BOTTOM,className:"",stopPropagation:!0}}},{key:"onClickClose",value:function(l){l.stopPropagation&&l.stopPropagation(),this.remove()}},{key:"update",value:function(){var l=this,d=this.lngLat,y=this.popupOption,A=y.className,M=y.maxWidth,D=y.anchor;if(!(!this.mapsService||!d||!this.content)){var ee=this.mapsService.getMarkerContainer();if(!this.container&&ee){this.container=this.creatDom("div","l7-popup",ee),this.tip=this.creatDom("div","l7-popup-tip",this.container),this.container.appendChild(this.content),A&&A.split(" ").forEach(function(fe){return l.container.classList.add(fe)});var X=this.popupOption.stopPropagation;X&&["mousemove","mousedown","mouseup","click","dblclick"].forEach(function(fe){l.container.addEventListener(fe,function(Xe){Xe.stopPropagation()})})}M&&this.container.style.maxWidth!==M&&(this.container.style.maxWidth=M),this.updatePosition(),Ie.SO.setTransform(this.container,"".concat(Ie.rQ[D])),(0,Ie.zi)(this.container,D,"popup")}}},{key:"updatePosition",value:function(){if(!!this.mapsService){var l=this.lngLat,d=l.lng,y=l.lat,A=this.popupOption.offsets,M=this.mapsService.lngLatToContainer([d,y]);this.container.style.left=M.x+A[0]+"px",this.container.style.top=M.y-A[1]+"px"}}}]),o}($t.EventEmitter);x(68982)(`/* @antv/l7-component */
.l7-marker-container {
  width: 100%;
  height: 100%;
  overflow: hidden;
  position: absolute;
 }

.l7-marker {
	position: absolute !important;
	top: 0;
	left: 0;
  z-index: 5;
  cursor: pointer;
}

.l7-marker-cluster {
  background-clip: padding-box;
  border-radius: 20px;
  background-color: rgba(181, 226, 140, 0.6);
  width: 40px;
  height: 40px;
}
.l7-marker-cluster div {
  width: 30px;
  height: 30px;
  margin-left: 5px;
  margin-top: 5px;
  text-align: center;
  border-radius: 15px;
  font: 12px "Helvetica Neue", Arial, Helvetica, sans-serif;
  background-color: rgba(110, 204, 57, 0.6);
}
.l7-marker-cluster span {
  line-height: 30px;
}

.l7-popup-anchor-bottom,
.l7-popup-anchor-bottom-left,
.l7-popup-anchor-bottom-right {
    -webkit-flex-direction: column-reverse;
    -webkit-box-orient: vertical;
    -webkit-box-direction: reverse;
        -ms-flex-direction: column-reverse;
            flex-direction: column-reverse;
}

.l7-popup-close-button {
  position: absolute;
  right: 0;
  top: 0;
  border: 0;
  border-radius: 0 3px 0 0;
  cursor: pointer;
  background-color: transparent;
}

.l7-popup-close-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
  position: relative;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  padding: 10px 10px 15px;
  pointer-events: auto;
}

	/* layers control */

.l7-control-layers {
	-webkit-box-shadow: 0 1px 5px rgba(0,0,0,0.4);
	        box-shadow: 0 1px 5px rgba(0,0,0,0.4);
	background: #fff;
	border-radius: 5px;
	}
.l7-popup-anchor-top,
.l7-popup-anchor-top-left,
.l7-popup-anchor-top-right {
    -webkit-flex-direction: column;
    -webkit-box-orient: vertical;
    -webkit-box-direction: normal;
        -ms-flex-direction: column;
            flex-direction: column;
}


.l7-popup-anchor-left {
    -webkit-flex-direction: row;
    -webkit-box-orient: horizontal;
    -webkit-box-direction: normal;
        -ms-flex-direction: row;
            flex-direction: row;
}

.l7-popup-anchor-right {
    -webkit-flex-direction: row-reverse;
    -webkit-box-orient: horizontal;
    -webkit-box-direction: reverse;
        -ms-flex-direction: row-reverse;
            flex-direction: row-reverse;
}
.l7-popup {
  position: absolute;
  top: 0;
  left: 0;
  display: -webkit-flex;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  will-change: transform;
  pointer-events: none;
  z-index: 5;
}
.l7-popup-tip {
  width: 0;
  height: 0;
  border: 10px solid transparent;
  z-index: 1;
}
.l7-popup-anchor-top .l7-popup-tip {
	-webkit-align-self: center;
	-ms-flex-item-align: center;
	    align-self: center;
	border-top: none;
	border-bottom-color: #fff;
}

.l7-popup-anchor-top-left .l7-popup-tip {
	-webkit-align-self: flex-start;
	-ms-flex-item-align: start;
	    align-self: flex-start;
	border-top: none;
	border-left: none;
	border-bottom-color: #fff;
}

.l7-popup-anchor-top-right .l7-popup-tip {
	-webkit-align-self: flex-end;
	-ms-flex-item-align: end;
	    align-self: flex-end;
	border-top: none;
	border-right: none;
	border-bottom-color: #fff;
}

.l7-popup-anchor-bottom .l7-popup-tip {
	-webkit-align-self: center;
	-ms-flex-item-align: center;
	    align-self: center;
	border-bottom: none;
	border-top-color: #fff;
}

.l7-popup-anchor-bottom-left .l7-popup-tip {
	-webkit-align-self: flex-start;
	-ms-flex-item-align: start;
	    align-self: flex-start;
	border-bottom: none;
	border-left: none;
	border-top-color: #fff;
}

.l7-popup-anchor-bottom-right .l7-popup-tip {
	-webkit-align-self: flex-end;
	-ms-flex-item-align: end;
	    align-self: flex-end;
	border-bottom: none;
	border-right: none;
	border-top-color: #fff;
}

.l7-popup-anchor-left .l7-popup-tip {
	-webkit-align-self: center;
	-ms-flex-item-align: center;
	    align-self: center;
	border-left: none;
	border-right-color: #fff;
}

.l7-popup-anchor-right .l7-popup-tip {
	-webkit-align-self: center;
	-ms-flex-item-align: center;
	    align-self: center;
	border-right: none;
	border-left-color: #fff;
}

.l7-popup-close-button {
	position: absolute;
	right: 0;
	top: 0;
	border: 0;
	padding: 0;
	font-size: 25px;
	line-height: 20px;
	border-radius: 0 3px 0 0;
	cursor: pointer;
	background-color: transparent;
}

.l7-popup-close-button:hover {
	background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
	position: relative;
	background: #fff;
	border-radius: 3px;
	-webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
	        box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
	padding: 10px 10px 15px;
	pointer-events: auto;
}

.l7-popup-anchor-top-left .l7-popup-content {
	border-top-left-radius: 0;
}

.l7-popup-anchor-top-right .l7-popup-content {
	border-top-right-radius: 0;
}

.l7-popup-anchor-bottom-left .l7-popup-content {
	border-bottom-left-radius: 0;
}

.l7-popup-anchor-bottom-right .l7-popup-content {
	border-bottom-right-radius: 0;
}

.l7-popup-track-pointer {
	display: none;
}

.l7-popup-track-pointer * {
	pointer-events: none;
	-webkit-user-select: none;
	   -moz-user-select: none;
	    -ms-user-select: none;
	        user-select: none;
}

.l7-map:hover .l7-popup-track-pointer {
	display: -webkit-box;
	display: -webkit-flex;
	display: -ms-flexbox;
	display: flex;
}

.l7-map:active .l7-popup-track-pointer {
	display: none;
}


.l7-popup-close-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
  position: relative;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  padding: 10px 10px 15px;
  pointer-events: auto;
}

/* general toolbar styles */

.l7-bar {
	-webkit-box-shadow: 0 1px 5px rgba(0,0,0,0.65);
	        box-shadow: 0 1px 5px rgba(0,0,0,0.65);
	border-radius: 4px;
	}
.l7-bar a,
.l7-bar a:hover {
	background-color: #fff;
	width: 30px;
	height: 30px;
  font-size: 20px;
	display: block;
	text-align: center;
	text-decoration: none;
	color: #8E9DAB;
	}
.l7-bar a,
.l7-control-layers-toggle {
	background-position: 50% 50%;
	background-repeat: no-repeat;
	display: block;
	}
.l7-bar a:hover {
	background-color: #f4f4f4;
	}
.l7-bar a:first-child {
	border-top-left-radius: 2px;
	border-top-right-radius: 2px;
	}
.l7-bar a:last-child {
	border-bottom-left-radius: 2px;
	border-bottom-right-radius: 2px;
	border-bottom: none;
	}
.l7-bar a.l7-disabled {
	cursor: default;
	background-color: #f4f4f4;
	color: #bbb;
	}


/* control positioning */

.l7-control-container {
	font: 12px/1.5 "Helvetica Neue", Arial, Helvetica, sans-serif;
}
.l7-control-hide {
	display: none;
}
.l7-control {
	position: relative;
	z-index: 800;
	pointer-events: visiblePainted; /* IE 9-10 doesn't have auto */
	pointer-events: auto;
	}
.l7-control {
	float: left;
	clear: both;
	}.l7-top,
  .l7-bottom {
    position: absolute;
    z-index: 1000;
    pointer-events: none;
    }
  .l7-top {
    top: 0;
    }
  .l7-right {
    right: 0;
    }
  .l7-bottom {
    bottom: 0;
    }
  .l7-left {
    left: 0;
    }

  .l7-control {
    float: left;
    clear: both;
    }
  .l7-right .l7-control {
    float: right;
    }
  .l7-top .l7-control {
    margin-top: 10px;
    }
  .l7-bottom .l7-control {
    margin-bottom: 10px;
    }
  .l7-left .l7-control {
    margin-left: 10px;
    }
  .l7-right .l7-control {
    margin-right: 10px;
    }

  /* attribution and scale controls */

.l7-control-container .l7-control-attribution {
	background: #fff;
	background: rgba(255, 255, 255, 0.7);
	margin: 0;
	}
.l7-control-attribution,
.l7-control-scale-line {
	padding: 0 5px;
  color: #333;
	}
.l7-control-attribution a {
	text-decoration: none;
	}
.l7-control-attribution a:hover {
	text-decoration: underline;
	}
.l7-container .l7-control-attribution,
.l7-container .l7-control-scale {
  font-size: 11px;
  padding: 5px 5px 2px 5px;
  background: rgba(255, 255, 255, 0.7);
	}
.l7-left .l7-control-scale {
	margin-left: 5px;
	}
.l7-bottom .l7-control-scale {
	margin-bottom: 5px;
	}
.l7-control-scale-line {
	border: 2px solid #000;
  border-top: none;
  color: #000;
	line-height: 1.1;
	padding: 2px 5px 1px;
	font-size: 11px;
	white-space: nowrap;
	overflow: hidden;
	-webkit-box-sizing: border-box;
	        box-sizing: border-box;

	background: #fff;
	}
.l7-control-scale-line:not(:first-child) {
	border-top: 2px solid #777;
	border-bottom: none;
	margin-top: -2px;
	}
.l7-control-scale-line:not(:first-child):not(:last-child) {
	border-bottom: 2px solid #777;
	}

.l7-touch .l7-control-attribution,
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
	-webkit-box-shadow: none;
	        box-shadow: none;
	}
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
	border: 2px solid rgba(0,0,0,0.2);
	background-clip: padding-box;
  }
  /*logo */

  .l7-ctrl-logo {
    background-size: 100% 100%;
    width: 89px;
    height: 16px;
    margin: 0 0 -3px -3px;
    display: -webkit-box;
    display: -webkit-flex;
    display: -ms-flexbox;
    display: flex;
    background-repeat: no-repeat;
    cursor: pointer;
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAALIAAAAgCAYAAAHBIxK2AAAABGdBTUEAALGPC/xhBQAAIJZJREFUeAHtfAl8Tkf3/9z7PNmDRFbZSawhQcRSaqva1xCqpataqrT2UkuUUiqlaKtafe1VS1pUiypB0dIgIkpKRPZIELI/2/zO98akN48nltL3838//84nNzNzzpkzc+eee+bMOXMfxijNaMJ7LOrGO/HdYfZ8fb12gD2JJINJdR8WNHVQnRtSn7hilpz0u2DMKaEcFhZmhdzLNbiPyNVlwPxcm4Qh93Fr0gO4Ol5hfqiz6Q14G+QzGpYzQ9nXrUl7X/fgbrXdG3skX7m26+bNW2fQqJ5XmCs6RQKd6EQwB0zgtKgsvCidGF+N8wV/SBLqSKnXzx2WKIHw1xNxq2xtrKsBXqgrbePt1rivJFmloa5OoD129NcVQwa9Phxwaflw3ifvHCus1YIVjW7fwEF66dIhdYO/XV7Qk+9HY/5F7RA+w0G5TdRxq7gw10FBPWwA+3r9jpkYGcoJ5/7YiFxMiYCjLspsekOeCiJ1AhJJNER+8rfTX/j4BNcUMNCLMmhF+wC3cE9RZmMd/0IQjeTtGdwJjURD5EajsRQN1EwEHjAkUVce2LLhnKf8xGId3ZhkX4uxmj7MMKqJz0ZmMr3MJNZBmphV8WDBOCCgo+2QiE7DF3005wvU75e8vMLs4+P3HwwN7do5MzOu2NcjpPHRX/csCqjt2wvtxEAy8xJ3o+7j3jjkcurpn2xtrT0EPiS0oQPKSOfi/ygqL9H/qNbls8EXuer4+65xUa149QnBvGYFgapAN21EZ+pnuH3rrrnKdNA/zCRmjoqGzu36RoL21q38BLAAjRgo6iir63g1QAOcOoU27DAgwKtpPzVMKU+qBWIuve3Jx0zw4j/eQ0CASeNnjUi5mrYH72ZxUfFV0emJ479/BvrM9KxDAgZZEjziTp1d8+pL415sEdJloIAhF7QCZmnQoCkuLkkXNPfkozU8b4wVb30P4i4ADNQ41P08mtSBogHc27Vx70CPEHeUgRNwgUOuTqBR8wwODraGSIkrKipKxqVuI300mntri1jz9OOs0IHeHUdvms2t0iG+vn5nxmnan5QeUff6GGWttpidSjvGbCSZJdAAGTMwtjWSH2G5XrOp3oEv9wuWxqdeUPchZkW8OGqcedmcdujgUcMOH/zltmgL2YW2Fu22fbMz6q2xM+IEvmvHiCGyRq7AK3QLe959+T6v46co0uVBisLk0/9SqIIhcnQiVBPqULJ4dPVd2ypLg6Dx8wxuhAGDHrCOHTtqUfZ2b6KsYYIOuUiXL1/dKW4SMJRxkbbpG9nv5ecVutlt+PSoNvw7VPg8V4X5wqf4YQVp9g+NDQZDITr2cm/8lNIGlbvp+edGD/946eqJqOKmoBJRhjyjrclk0qlZAqeumw8YOEwE6ILdgh0raN9pcHeWx9n3mViPh9IKnlmBVBWI4bfoePDAEcOGPz9WWUDBzMe1cUdft5CnUfb2DvFR8rsz2avrkOdmT18wJisz5zDaqthVWjwAtzRgtBF9VbSdVofXIPWmB2CCouYqUBUFH59QbwwEqg0XykAi96/VuCEetRrm59msEfA+nqEtAUeqNEt324JGJEsDxpMi26gnaCpUxqJk6bahkGFp3akrZO8IBurcVGponpGW+VOdQP++uIAznzE1/cBBvRRZTc+OP0miUBJ78OiyxNxE6uX+KSP3vDIZuEE/z9BgWZZtHHj1oxZbkS6uJFNqIn+SWSy1AubjFtLd171xoHrQooyFQJRB7+0eHBrk2cxNtBW5mgYwoYNFXg5r7CvoFXWxajQ3mjiTc84wVkB2kTWt5NYk3lZ02SCvzphDDVrNZOY2p3mdA0wrhQoGSm5ig6SRyTsqwSxUaMKk+t4tXJIy4/IsoP82yNu7pYusKwk2WdslZmScvGHOyNs1tJ5GNrjVaeT2W2xsLCnuv5J6woQq/QtbXoLCMJqYtbWj208pKbGK4aamgWJR19XlCvpFEdxn6SDOl0byAjXB/cp8rlM/PteZ83k1T92PTuAw0Ly8GychmosWLB/v7xFSW+AeJQ/0auyLiYFEBgQ0dYKdDRsJfFOvpe0V76fgCVrgkNQTao63hAONr2vjFtAFltoTTFLzB415Al7RFdNipHRviWlLbzCHhZ05HxfEy9e7T/zX8FV+XLk+96e8Tl0xOJZfOpjdKp4kzboZXgGrouDj1rTunHnTQl1caoZ/unLNlKnTx32sNxobR0ZGakQTDCY8tEtEkG+LfihDg+NC2ccjpBXoyMTqVaLjTaFLduxe219XqH+67HYGKU5D0pbN30X5+vl0a9m6mZOPTxvFUIayPRAbM1RpS1uztp0a/SD6e9hcYlKVqgi7QEg/DAyRsAUsKSlNLyvT56Bs8e2Ias4LZzfnfEowJyOOVocZDs9jt8YnMDvUZzblZ+jis1rwtqg/KMHgwEThCUOCUS64U/An6iiL9oIGcFjwqMOQQB0JdTyEXd/tfR/1rMzsWCrPBxwPCxJMfJMELVYq0KO+fNkXk6CHRV/qXPSLXA0XZejpqiRZ0IgcY7hzu+AS2TB3quInaNnU2vzSlNqcT/fhHSqAVJgawAunEXxCPU4W9MMlcRN0ryZMAl2XcOHm6YlnYgMAToIOuxks+YBBErGrAa0YtKDDDkeYAaBFErjSUl2uKOfm5v1GE9y1nOLe/4IO+b3YchfKw0wy3lZ6m2arxyr4KV4RURH54qtS/fGufEMZZ7Hja/Ko0ptsgYML0+kKGM+4wbTbmGQUtPfLMfBrWWc3gIZenX4aJmUp9OQdqunk4nv2QmzMus0rO730wtj0qu2DqnuQjCYbrOjYrINq5JuRe/CKQp3QtRMweivm0yur+FBQf9xk6WFQX99Tvw2GDO0390jssWXW1vKf6n4q7Dc1EOXledJwQxF7RV/EomQbptMXssJlNyT5YSe4dq1m/s907eik1WprNKjdur9sW/1AWt7535Ur6/zvN2/lpcds/37eM892mEgTXGHuHD1y4qLRYK0YvrJsMly5knKu0tg0csmObbvfC2/ZbETK9bOnW4TU7xtGEw0a2geZbKysz/Xu9txQvV6fX6VOrMTw/hVsdF8b/tbGgX1feqF1m7Bq5hda+/o+pVgXm9Ztmzk0ctTBlMyEi/fnaoZ9g3HH1xmv5GgwI/m3+oAZUOzkj4fx7rQBt7qdxnhJDiuj/YlBe9dG1pLNbF9D8c2dem2xVMA3NQhjBk6WMyVaelmZVaL0+vmcB/Tz/zVa+8lIPlWW2SLMQh559ZSNCE2sbCq/FBuLyrrbLJVHsYZMr/sdfpiKJOv1pOxtyISp0tQRtHXqhNWQZffSy5d/LBOwJ5H71mrcAnzSSA2Z84ObJPlCbiujSZubkRefZI5X61hL5pavbzMvY4kuTCuzm6nXE4+Ztwf/lBRmcW1zcSkwxsXF6bWmEnbQSPJsoqWMZumwUqYC7QCVi3Y6tMmnCZdYDItiJezj0v3MaLJmRmXX58w0zKJ3w3ww2IwE+fk7JSUll9b2Crl4NfPcJXOav1OH7fyfdSs6cS7zl18Y65GRd36Pmk/S+dwex0/tHTN54pxNJ0/I2tTsM5WccqDFQgn9rW4nyphg4J95ut9gZis7p6Ym3BI4L9eQ+sS/ntrbLXDIE8/fLKaHVP7goyN5whKyKKMHcsWboSasqsznORfSRYEaz3v29uZt4JiDxMC8QVJLjzntg+ow+dBe7BhRJ1MwQ/AVkRbwQbBj7OtTXgVu49qt79LDrW/OX4yrqjEJ/OIPVrwlfM2CB/rW6XQ3wd9SgjsM41SsC9pLt+H0AptK2fdRjFdYHHwdhY0QOsL1VZDimkIHfLLD8xThcmCF+p3SjOxc0WlV+Zervm2x68dN/QQ+MLC2DVSHqOOVw6ZFXDRgCXjUBQ1y7Py+3bO+HyQLO0bArGV2auRrkxRv1orPPgjXF6XVARxJz0vCPvz4vbkoT50899yTenvAD0ljLx0L8Gr2Et4C9XXnTkEiecNKv/xiU/q1nHNXlQmN2iYVlpWwL0qLmSR3ZNFgQCpCogXuLDMa45WrTH8AcCVpTL8Q7ChbVDhAgO6XmwwGj7AWoa9lZ+UcBt3ufZvn6Ar0bUSbP/+42cJQ7NhbNjj3ybpW2p0G3LtP966DUIYk0TbZDr4Kk9Ho7lXLw1+0g6qo6Wtz8+f9sfmARQzqPZNWiCCBJ/NLtrOz9SkoKPxDlmT1SiJIHiuH6oAeF5e1o9XRGjWqa6pXrxbcqlm3YY7Wtifu6WDeU1xHF59an1cDki9wm8nnU7h3AV0fergDNrsln0+BtKUoP0yizYJr/57DhuJ1wnY5/mziepTVr6e3R0hrsbPLyck7BrxIZO/eAi2uuwE4I3Aok5rIAtzPPbjtxQuXtgCOOtQTwkqrPvlqMmBd2vcfDGeSpfGCXrS7H96SujCnBy+oj6LComSoEoGvUA0A6EvZ8DLaO9nYsUOoSzNy57Oi4mJyBu2SpuRcj2rGvZievUsRgleBf5gk6cpabd62egFoaYtr6NFl8DaUoz96LzTAq0kDlNWppLhE2UTg9Tuf8MdG2sw4DRjQU9H7e3b/FE2vomLoU3nJjm92rYSEwoXZuX3EJvDZsWtdz/+sjGlqMJqCXx/90jzALlz4syQl5awi7aj/EwnxPfC1srJy7ti232Sb6jZHRT+VJvm909I3pjKWayxjYdODeLkO1hnC2OLC/mhQWsJO6UvInCtjHQWDB+XKK2tvF3Dq5JkvVR4t/tzwiHk6namuefunwruvEq9ft86RW4Ef9sqQcK2WXRkzYtKBgtsFGYCNHjHpt3enzd+cnpvwo8pHbKQd2Wg9M3qDhjz9tqd+O7tao2XZqP+TKf8Ga3vyzP630EdGRpY+OTnutuiv0iQDqDOxVgaaSDLpjqMuResukoXHpwTw7jT5XnQlfHBBOgPcgxIiEqu+jG4NuoYN63a4mHzio0vJvy7Blhcwa2srWW0NAFZVgh0uaTSKj0LQYFERZVmy+WP1Z2uno25vZyd/tX5FO5T79x72faoF+xm4J5m4geLOPl7PHPvl1CeyLF1T875nkpdckq7qdOwIqY4aEz35i+XEXCYJ30MXs7dnSghSzaSqMunN2n36dZsBfG7uzYt3r0vpaVm/AHbkxJ4xJYWpD80PbapK6bmnL8+dvURRJXsPbXu5W49OU6n/ItA/zEapKr4PA8fC7OVVS1EXgwe8sq9Nh4aJ6nYWdyrFmayLvQsrIwleF8n4Jk9ntlCvo00gZ6ujE6UHBujQAZw2ZY52Cv8fvj/wwahXJu6VGFdu2sh4rdTs+M6+fl7dSAI+kTS0yfkbCWEndbhJIzPdjRu3TgcGBijqbcHc6Km21iz+b7C22KTEaGxFi1slHDyLsrGgKHr5kvYCsW3btkpeynskGYSrmaQnvTufLubhyL6WDGwK0zH9ypvSKMHoQXmuoaztz0diJoHu9VfePp6el3BYeOGstVYJ0Ys/VSR81OjhPmQqKAvbg3hqZNOd9PTsZNAt/3Rhi+5dW/cmy6SzaGfv7HS817NDlUUWsFWfrU9LzkxMFfjHyadMe3MZ7HPzCwJjMnK/8JbNI6rib1GSQfxpoTT7TRs+mYzLSJJoWkTYsKqYWIIbTNzWuaZTA0iWOT4l+2zKxx99fpXCUKxXv+5hn6/akP7n5eRztbw9O5rToi7cnx5+0rWIvi/uSU4/M2BgZJ/ZAwb2KiO9HynaXLp0rIAkTZeff/tc7MFju2Qm0T7r8RPcnJa43MjL1+PtocUif8SrE2ZkpWWX0Tmbex4q5q/KNFLLO8mcHSTXRc7nRsmzSkILCOzWsJkAypLjBXE4U+mdtmSCGclC+AEbC8US0Wh+u5Jz7jraIWREYfRGuJG064n7AAvxCHHIMxorpLcac4q9lHesYjLRb06qrgtZMoVpuecqzCi0tZRg2wq4pXEiKCDwlnIRMMD9WFvrjGqrwhK9RRj5kp+bwLgS37NI8C/wgTOgSPLyV7ibxoa9Rp7kV8nrVo1E3qSjJSr/CuNlBUxHTswSZmLFkhWTtLSGUqSEjO7yXEN1DZW1FBuQrQllxzK5FVuTc5HtnnOIwlRf1X6Waa1GM24KoNGQT69SkpiGFtIyYwwrMK1jb1+9/U9bApV6/7fyxGYAwewzZ1IdiosNBvF2PzHmD8FIWfcoKPIV7ZZ7Q8rImmJGPWPpR0jqdMxEAs5IgEkWCUm6mf6YRITIOXIFUC6heCvIyguhPIR5s1PE9TYrMixlWkM9ZqRwC2jLkywKSm4tPc005KKeOxe+qb+oKhE9fAUOvLLi0ubYH6AVNpoaLU++lnWezs8/OLbw8D09GUp8HkB7wHCEEwVHjBkOxqvX7x906kgOzMvn89qZWLm7SbSXmXwnqLHLMdVmWKAq5eolSY2wtDyp8aIcFNSqekl+Uftjhy5IbduGV0tKulrCdMEGrcRupeYm/iLoLOXkMpJqe4fUN+hZHRM3keQ9Wip3IGiSEIupmLjooXwByeoUA2daCrSw4nx2Kucye86qhJUq7MUKSznt+SqSHcq0KAqY1okZxqySrlcQUIEvJ7e+RDocW2JdmR3T8K0UT2lOwk1viKQnh2oUuaIqrFt120ct4ySGwaALHDPuVb8ZM9+OxjlFOh95oGXzrsvpxk2e/jb7ERB6VL6PQw9hS79427lUqzOOGBGZj5i64IcPYUp1paHDXxzs+UH07NUCvnrVumlzZ334h0ajuZqWc+68gKtz+Bq//CSmq4kbrRL/PDbPyalGKPDJySm7n27V+wtJywozshMPqduYl4Ugw/oHDm455A8ryDjEhp3CkV+/HxEYGKC0/XDRyreXLVmVbKeyE8HTPOE0DNmONhS3Gu0f4NPTHP+gOj7JGRwx4icYzRU7kUlfSzMW9+PJJMTLS03MztqahXs1YuuK8tmAqFgp70FM74eXxpeHTvhkR3eKY2wic6K5YmRoWBE51UdI825tuV/7h8Uh1qQzFAf26vusy8zZE1eKdt6+Xl1ooovbt+795fVUXRuC03rzzyecisZBYwoCsvETRgbcupFfunrl1mwSHtIW7EpqduKF5My4VBIG9w3rt7L+g3qtggsRI3t91IvzNq7d/sKVK1drk8bOtaSZ16zc3pw0sdV332/sLYSYzofd7tdj+H/Aw1O2/S0DhX8wlWvFv7eI0jpJqs1gs33brv09ej6TT7wqFKulIbt7utalw5RKxJwO4+yCEGMDFdjILbFCkNFw6k7py0XP8qu0Fm8nl4UTcW1nY81ORHXjPaL2SZcFcxq2xNbUXsSstB0oiCbA5TkWCCMvYQbda9KotCuVkCbTQGYyNCFb3ESh72wmayOlRbePV6L5m5UAOh+sK8wNh4tzxaeLF99lY6KjunGuri7h0BZf/GfZBfhQfDyaNEnPSUgw70o5bm8yuZrDUcdSTXftYL4EaiT5tobZJqXknsq+p52e+wB28vT+cfQyPYtyxOA+nw/oPXwPyiKl5ibE+Xs06UJb9x/OJB4OdXd3aUMmkPX2XWsnNAvu8EGZJDWhZfi62izyouPDRh2v9cabr/iGt2o6UvCa9c7CqfQFo0Gy0ZyJyyg/uiZw/0SuNocelX9qbvwv8F5+suxzv6VLPo211J6EvRZWnCXL5jUb+sKAoaDBh5SYKzyT1JxzRzAvlQQZRNN+kn6Oepq3JXn8gar+JKZBRPQbffnSJ+qEpAgdCTjnt/UbGCt7jkq+lbZwVmQqGPlcaVJWhRBHPcXd6ciG29xDbOecNtIGCm3VkKJLnqiy0JfcbIvxxx7fOc7Gxkpx6G3ZEDNn1rsLEy5cOb6GIkIuPXt3eef5FwaO3LxpByNteTM9Pb7yGO7az7+fPTBR+Km2bIyZPWPa/Pi1m1b0b0FONnt7Oz/0g0Su6oLLSVd+GP/G9G9154uLtZL2lsnGPo6XFjyDB0wx33JCC/8NBoavKQKBogB8noskH89jxs5dOw78MC7h5/VkUjiSQD+1fvPKDi8+/+ZhX0/lawzl5bv70jZ1dHTQTJ0xfr5gv+/HQ4vXr/smC/GC9Ixz6QL+T+aPo5ExrvT0E/BwX7I0RoR9TSajFebgmWc7TgINjk6OG/POKVnLctKzE06SECtNK2+67nKLOipdIEEOp7jI73QKg+lKWE3aDB56N5wPuUvCpInpCazEEM7yS86wQloh7tBVXFLEbpa8REL8fjkdl2Y158NItDOp/XnZimXM/ZW3lJY+WSH2dwttRt5o+6+3r+6C4A/6Tkq6EjNp4uz44pIS05wZi94V4164ZNYSN1cXKyz54hyowFnK+0X0GJGccXpneKuwQRcvJB3YvXPfAgSX6CPVeBK2avUb1huy79COLecuHp1Dx5fgU+wCId70zapnhNdZaGPwb9mq2SgBRx45uK87p1Xgjh3NjrV0FmHm92YtnirGggfYp09XV5PRFIBNIeDGohstke/9edtrCNmifC0l/YdXXxz3Cxy76dfPVz4DC4L/sYQvkhFh+HT1h62EEP+45+dFEGJ8xp6enXhSfUsWBRkEM45KubIDe5qE+DsE9XSlNM2lbMv0YP4OxaJIzsm+ePd6DivMb8vu6GKYviyJFRq7Se/d+hq4KMa104PZLBLgDXRiRkPhbU5h7s03PNgx4J9UCvBsGqDnBh/YoO07PDUefEtLyzK7tI9Yh80dQtTr1m7JPHL4+HLg6GxB9f2Hy0M1CNtg5wx4VUnWaO1bNn12YJBfizf69hr+5Zujpqx5PnLUp43rtZvVtFHHCBFAdHFxDlu28v1w8JEljf6FIaN/FseJ8DGe4I9wvYAj37Z113XZVnsaZxUyM8+nkYJJw5Gjn386/JFos3Tl+3NQ1nMpDB/aGbmpxkfL329Wu46fcqiD7je7U9u+n0M72jr5nhDt/ldzH7fgIJOJ+0+aNjaw34AeihI6ezph7YiX3zpGk3sjI/fsWfN7q1KQQUibvNIF51kECfMysmuNlFPUjy2sHchWvhzAyXNM9aWshDTsQOmD0vrShwWKkI704vZFddkXRDuXhJgsELKYS9n7CxKkF1b8KNFr8WQS3Gw6g74JztRNeefNDwXXyeNnzSIBI88gl40GpkRyhg4aeeD69RvKQ8aSHbNrfS+Exvy8yn9OQ7Q1z2kCd+D8BDZnGdcTTqTmJCTjRKgky3nQntezc0+JNl7etRT7WqM1XcOuX9ZoKnlvBB1yrdb6CmhwqU2cjNzEs/A2vPj82Nj0tMz9oLWzt/Pfd3DbYNjntJmr06x5Ywf6ZEIRbuBHvz5lWplOp7jrnvRxZPD/byZ8IE0u3IZ16wbaTpw8Zgn6pjBiQq9uQ2Po6/SyjJwEiy/qfQW5/AYkvviyNIEEcgIFqstweou07GgXA4sZ6cxrlNP89X9MDe7sILM9JK4v60CrYyUlejZy0Z/SrL+oHr8EB7w4q7hr78ZZcLMJritXL16jXr5FGZsoQdOqTfNRM2ZNrGvU81pVfXUGWnoZlN2seqOl8PgH/dFWtm4noF07te33KX0GmIv+GjdpOIzs4SCUN2xZ9Q5lyrPbuuW7uT/tPXjLykq6bMmzAfr/pVQs3WmG8W785rMRlCkr//w50eWrKWPx9zyHuzenvZs/MItOl1a85cGvajjbpJNYdYpd97C3YkfH2fGeK0qkdDCg3x4JoI3fXknH6hMNRnFLx9igZTnSwQd28IgExw9fpO9PTVbQVOR6CkFzslvP0pI/+36scLwRp+9A88a4Vxbt2bV3WHz8hUb0uzm3yn9i4H6tVbgHmCQqykcuptBX2/6uYXFk37d4+413pn62Jvo/YPLm+Nfmt+/QZouzs5PiL066dHnrhHEz4xB8QLDnkTv6hxuQtyWAPESKXV9VV5JReyM193QWBNTXlT4Y4boaeGF9fL26og3cbF9vjsmRtdqcq9nxVX6R9NCCDKYf50jfv+3EO5gYHYbjzItATZg1OzVG5t3IFrWmjeGPpL9cCQ8HXYpGw3rQB38XUX2SCd8ilOmMrouXzAmBpgJvsnUNg/u/shBlnMC2dD7Wzy24HTaAzVuFxtSrFxhBk6fd+u1X8+rXaT2Jlcmt6ZzVHQMYPKEk0SecYEVnd/WCpZNzjZoKjII28FrgvK9tDftjly//dkfQIL+WF5dF9nDyrl37WLeYZ+b3j+g5kzaX9s2aN3kV+OLC4iud2vXfiMMqdYJdfk2NBfT/jfTc0P49unXrVKXQiVEWFhUXvT12xgHaK+jpxf3doNH7IUjWf0DPZwXNvh8OHkFZMsiKshRw8/yRBBmNl+VLZ0fb8ZayzH4krdyEnpQnudbiKRxMAbry9Y5gJwnfOzpfUpZF804fp46dOwlxvY5dnnZ64aVIRbOC39ovN8/GAW9ZsrpoSYhBU82dnczPkbpiI5iUcrK1ra2Nl2M1x7oHf/lueOd2/TeYmEnxAID2iSSDdQbZVp6ff7J214IPZ3YnnnLdunUiyNSJuMvfSC/fi8eOnepAp6EOnss5Rydc/kp0EDORfuXOZeyoqSeDmzSIQVtg8Q3K4IGvzkSZW9vd87sdgP+3Ejw05n3hFxroMgffU6f7KBs4uM8fy5euTjFKRkf6ks4FRJ61PJojL7hTePH99z5Kwsuael3R2gBbTPcMwiKVBeBkxh0KtGw7mQ/dhbeUynihvrU2sKEr2JPb1Km7h238a+ylp4zc6IRNXsdObV3JTswqKCw0kUeCNmLxiWp68zLOBpTeLm5LGydt377dXJycnazhewUd/K/YLZPmk8aOf80/LSW96Ntvf8jFRGodXA5iyRf88Es5xQZda0GbkZZVtGP77ntocaKXlRW3wQOv5ugot+vUyqluUGB18CGT5hZ+jwuOfRx0FbzVOcLQaz7Z0Q6eCsDRHzayiodCI58URwXVbR6l/Lghavw6hYGZsDr/rYSNLSKQcfS7AwiOSGWF4eJewRAmRVAD59MPOjPytwUZncAN5yyzhVacDSFlbDJIbO1qkzQXuP9Gql+/bTXj7WLbUq1t4V3H+kN3q5zWOnq5Jn05Jdm6GvMTExPJnC9PCDgYC2/X1Mp6o38j1xv3m0Q1LT5wu985DghlzGcxdqUaKzvSRpLJXtaFhdUpND8mLsZhKQcPuhSTxRL+UWFCkM3bPexZC/N2/9b/nYF/Z+AxZuD/AA8zEhkTLyOGAAAAAElFTkSuQmCC');
}


	/* layers control */

.l7-control-layers {
	-webkit-box-shadow: 0 1px 8px rgba(0,0,0,0.4);
	        box-shadow: 0 1px 8px rgba(0,0,0,0.4);
	background: #fff;
	border-radius: 2px;
	}
.l7-control-layers-toggle {
	background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAkCAYAAAGf7Ah0AAAABGdBTUEAALGPC/xhBQAABzdJREFUWAnVV3lslEUUn/l2F0tpwdAih1HEqCReDcphNCo1EkgFkXa5PNpuC0Fo2e7Wgko8KiaKWrvbK5672xYFpNtiRRuNiY0aURA14BGviBcVlaKltVa6+42/N9v5Mrtt05rwj/PHzjt+8743b+a9N8vYwKgMNlUQyemnMtAkaJajvb3dToQSGp8e6boopkr4VYgEMYwO0vhCTfMVzBcMf8bx086YyODcuM80zTqp9IWat+7evW8sMdIxIqqCLa6oiAaJpuEtcBqcc2HEWMZ0JclgZR/Nchf++ubrzKjJSguXS4tVjXvPjfb3/UAAacGTn/MOMb7QnjNpNqP/bKZ50Ai0tqYmCi0n4zbM+W+lBc7JBOa+QPhDwcTsxJXE2+32edKCL9h8hRDmRzpIOWydAylhrcMfDN+ugBRKSdP3KwPhsFJIPth02FISIYQwYsDYcVfWhy/Bon4JgumffMGmiGTwQ0B/sHml4q2ZFAD3WQIQVhx0IdFw8B189lolN+w8w5PnjPmlhJgtA8/vfn3iye7u3yGzDljDxZEG4097Cp3rSSjBtMHunp6vFR+HHoIxmbgTe1xHKssDHecLNFUjMzbqMs5ZlHF7ute17M84+TMHDzr+OvR9JwKdCms9yRkzJq6bPTsWXh05QOPUN+PUHyPWMPhm6UHd7vaUohWZPSRE8OqxpTyibQa/qcTlbEP0vwF7AWUAT3JM9dy69FfSNza+MU4awNE8iQtXSkJuGLleV852ov2h5jkwVof0mUs8aO4LhTuYYFOAjExId0wcFIPahpaLTkWiX9ECfHG/sLNi1i8+HODfgLFFRI96+INNi0cNTgTS1obKQh03aAuk9DeELzcj4pACYivvwvXrFK/PcQZiQWo+hmidpYMUjQC7EOB6xdNsGfAHwk/RDdOVw9Dm+NTUSWtWLDohDVQ37JkbiUT2DwMeVswZP+gtdM4x3HnLDhjcGM2XLWOISaenIGee9MCSgqgMht/H/q/SZYk0qviV3oKcj5XcioESyOoqIseFYDYloxnAGm/hcrcuk3JV2XBMl+pKqn6mENux11+w12m6jpqMMFn7rPPTHdwfCm8yTfG4tMaNu+GepPUFiqbM7T105ARSPQU+dY/LOC/N2gI65WEkyWUEtjmSppfkLvlRLaQ5VnZFDtGGzbheNRROKZmbu/AvUvh3tE4Wff2/0IUC+y2q+4VVoXBW1BSvkR7Rb8BW84lWJQBdlGozcs7GLy3Nd35OSqTxBqtfgkc1+sPjcqbDgEl6xK0dH5lv545LOCVL1/F+3CoY4eyY1+WcBiC2KYEHQBd5XDkyndE17xCm2Ug6BLcSwb3LigE1AlOYu6TS4HUwVEw0Df1osfBnLDwnpiFDCQPuvQ73Fkqxg8/hEVYLXt66MXbbzOK8bKre1hhkgDT0RDja3fEHytwZxCMLH0YWPkD0fxqjqUZDejDSV3z1LbexqPkEPJxKWLqtKOGbvPnZL460NlE/KgfkIZiRrfjShsQcG2QQDUwwXjcuZcID61Ys6ErUJ/LDOiCfLUzUjVQdEg0O4jn/ABEq0iuIjrEcwE0x/KGWNbjPj4BO00Gni0ZOoIPzLR5X9vMqqaQDqDzzENra4V5zp8sBZQcROYjsLvYUOPdbEVBKeiZ193QjCmwtZCM+ldS6EWYTH3wuNSV1i+pFCj/IAaWgGUfBq0N78qPM3DZcp9TxcTQeyzZm3ON2LatXpSlOP8BIB6qDLddHmHnFrBlpNZmZmdZbNXEB9XsRlZXFennqGHzoXW5DaId4iSoc/Q365EjnRjszPnYXZL9NDWUtGsqzCjAw7xprTypbn7fkaILcYqkInzzeX06C8emO8sKlS7stZQLxVMPes/+O9FVAvEpXob+utY6gZmfrtMjf/RUI+2odhF7wJbq+Gzf3zTj5CAwyaoEwozVoCzN1KKK00z7WUbZx9dIOklsO6CAZpu87i5gpHoJ8gtLh9vZixSO2KckV7qysf5Sc5uq2tjOix3rL0FW3IJuSNV0XM/iDs85LqxvqeKUD8n3LxUobt5WVuLJlS9IM4O9i09VRwWtxLWfpcix+hXjs8mZdjn19YuOiuKRgufzXqOuqQi2r8O+yAk/tl2Q/RMW7ETe8UdX1GJhHDM5qjDHJ5e7bs07qBp7ZsTe9t6/vUXykkLKEdLFbLgLJSUn3rrt1yXEdX/1C23jzVG+5Keg/B5r2wJD9g/NcaUAJq4MvXxxl/TWoATcoGc0Av4eUKnIXZlsvXpLHO0CS2KgOtGQgdeuwqWuUjGbUgrdszLHRXXDLF0oe54AS0kyPnc5Iz/2CmV7EeIzSwcjvsHQPXkUhld/kCP6Xu+DRNjg/SWHh+SnODF+aPeVh9XCydAPEsA4kAqsCzcuiTPiw7+maTj6SwGsVk/9gY9xbUpizR8MNS47aAd0C7s35CG8VdrxYyjl/FcdUgo73nY77X9D/Au9RDMh+aBoVAAAAAElFTkSuQmCC');
	width: 30px;
  height: 30px;
  background-size: 20px 20px;
	}

.l7-touch .l7-control-layers-toggle {
	width: 44px;
	height: 44px;
	}
.l7-control-layers .l7-control-layers-list,
.l7-control-layers-expanded .l7-control-layers-toggle {
	display: none;
	}
.l7-control-layers-expanded .l7-control-layers-list {
	display: block;
	position: relative;
	}
.l7-control-layers-expanded {
	padding: 6px 10px 6px 6px;
	color: #59626B;
	background: #fff;
	}
.l7-control-layers-scrollbar {
	overflow-y: scroll;
	overflow-x: hidden;
	padding-right: 5px;
	}
.l7-control-layers-selector {
	margin-top: 2px;
	position: relative;
	top: 1px;
	}
.l7-control-layers label {
  display: block;
  padding: 8px;
  }
  .l7-control-layers label input[type="radio"],
  .l7-control-layers label input[type="checkbox"] {
  width: 14px;
  height: 14px;
  margin: 0;
}
.l7-control-layers-separator {
	height: 0;
	border-top: 1px solid #D8D8D8;
	margin: 5px -10px 5px -6px;
}
.mapboxgl-ctrl-logo {
  display: none !important;
 }
 .amap-logo{
  display: none !important;
 }
`);var Je=x(92137),mt=x(87757),Ct=x.n(mt),H=x(86700),Ht=x(81550),Vt=x.n(Ht),_r=function(){function i(f,o){(0,Y.Z)(this,i),this.attribute=void 0,this.buffer=void 0;var u=o.buffer,l=o.offset,d=o.stride,y=o.normalized,A=o.size,M=o.divisor;this.buffer=u,this.attribute={buffer:u.get(),offset:l||0,stride:d||0,normalized:y||!1,divisor:M||0},A&&(this.attribute.size=A)}return(0,le.Z)(i,[{key:"get",value:function(){return this.attribute}},{key:"updateBuffer",value:function(o){this.buffer.subData(o)}},{key:"destroy",value:function(){this.buffer.destroy()}}]),i}(),Er,Ar,Pr,Ke,yt,lt,lr,qr,ut,It,Qt,gr,gn,Cn,vi=(Er={},(0,F.Z)(Er,w.gl.POINTS,"points"),(0,F.Z)(Er,w.gl.LINES,"lines"),(0,F.Z)(Er,w.gl.LINE_LOOP,"line loop"),(0,F.Z)(Er,w.gl.LINE_STRIP,"line strip"),(0,F.Z)(Er,w.gl.TRIANGLES,"triangles"),(0,F.Z)(Er,w.gl.TRIANGLE_FAN,"triangle fan"),(0,F.Z)(Er,w.gl.TRIANGLE_STRIP,"triangle strip"),Er),xi=(Ar={},(0,F.Z)(Ar,w.gl.STATIC_DRAW,"static"),(0,F.Z)(Ar,w.gl.DYNAMIC_DRAW,"dynamic"),(0,F.Z)(Ar,w.gl.STREAM_DRAW,"stream"),Ar),Ri=(Pr={},(0,F.Z)(Pr,w.gl.BYTE,"int8"),(0,F.Z)(Pr,w.gl.UNSIGNED_INT,"int16"),(0,F.Z)(Pr,w.gl.INT,"int32"),(0,F.Z)(Pr,w.gl.UNSIGNED_BYTE,"uint8"),(0,F.Z)(Pr,w.gl.UNSIGNED_SHORT,"uint16"),(0,F.Z)(Pr,w.gl.UNSIGNED_INT,"uint32"),(0,F.Z)(Pr,w.gl.FLOAT,"float"),Pr),Wi=(Ke={},(0,F.Z)(Ke,w.gl.ALPHA,"alpha"),(0,F.Z)(Ke,w.gl.LUMINANCE,"luminance"),(0,F.Z)(Ke,w.gl.LUMINANCE_ALPHA,"luminance alpha"),(0,F.Z)(Ke,w.gl.RGB,"rgb"),(0,F.Z)(Ke,w.gl.RGBA,"rgba"),(0,F.Z)(Ke,w.gl.RGBA4,"rgba4"),(0,F.Z)(Ke,w.gl.RGB5_A1,"rgb5 a1"),(0,F.Z)(Ke,w.gl.RGB565,"rgb565"),(0,F.Z)(Ke,w.gl.DEPTH_COMPONENT,"depth"),(0,F.Z)(Ke,w.gl.DEPTH_STENCIL,"depth stencil"),Ke),si=(yt={},(0,F.Z)(yt,w.gl.DONT_CARE,"dont care"),(0,F.Z)(yt,w.gl.NICEST,"nice"),(0,F.Z)(yt,w.gl.FASTEST,"fast"),yt),G=(lt={},(0,F.Z)(lt,w.gl.NEAREST,"nearest"),(0,F.Z)(lt,w.gl.LINEAR,"linear"),(0,F.Z)(lt,w.gl.LINEAR_MIPMAP_LINEAR,"mipmap"),(0,F.Z)(lt,w.gl.NEAREST_MIPMAP_LINEAR,"nearest mipmap linear"),(0,F.Z)(lt,w.gl.LINEAR_MIPMAP_NEAREST,"linear mipmap nearest"),(0,F.Z)(lt,w.gl.NEAREST_MIPMAP_NEAREST,"nearest mipmap nearest"),lt),I=(lr={},(0,F.Z)(lr,w.gl.REPEAT,"repeat"),(0,F.Z)(lr,w.gl.CLAMP_TO_EDGE,"clamp"),(0,F.Z)(lr,w.gl.MIRRORED_REPEAT,"mirror"),lr),Z=(qr={},(0,F.Z)(qr,w.gl.NONE,"none"),(0,F.Z)(qr,w.gl.BROWSER_DEFAULT_WEBGL,"browser"),qr),$=(ut={},(0,F.Z)(ut,w.gl.NEVER,"never"),(0,F.Z)(ut,w.gl.ALWAYS,"always"),(0,F.Z)(ut,w.gl.LESS,"less"),(0,F.Z)(ut,w.gl.LEQUAL,"lequal"),(0,F.Z)(ut,w.gl.GREATER,"greater"),(0,F.Z)(ut,w.gl.GEQUAL,"gequal"),(0,F.Z)(ut,w.gl.EQUAL,"equal"),(0,F.Z)(ut,w.gl.NOTEQUAL,"notequal"),ut),ie=(It={},(0,F.Z)(It,w.gl.FUNC_ADD,"add"),(0,F.Z)(It,w.gl.MIN_EXT,"min"),(0,F.Z)(It,w.gl.MAX_EXT,"max"),(0,F.Z)(It,w.gl.FUNC_SUBTRACT,"subtract"),(0,F.Z)(It,w.gl.FUNC_REVERSE_SUBTRACT,"reverse subtract"),It),Le=(Qt={},(0,F.Z)(Qt,w.gl.ZERO,"zero"),(0,F.Z)(Qt,w.gl.ONE,"one"),(0,F.Z)(Qt,w.gl.SRC_COLOR,"src color"),(0,F.Z)(Qt,w.gl.ONE_MINUS_SRC_COLOR,"one minus src color"),(0,F.Z)(Qt,w.gl.SRC_ALPHA,"src alpha"),(0,F.Z)(Qt,w.gl.ONE_MINUS_SRC_ALPHA,"one minus src alpha"),(0,F.Z)(Qt,w.gl.DST_COLOR,"dst color"),(0,F.Z)(Qt,w.gl.ONE_MINUS_DST_COLOR,"one minus dst color"),(0,F.Z)(Qt,w.gl.DST_ALPHA,"dst alpha"),(0,F.Z)(Qt,w.gl.ONE_MINUS_DST_ALPHA,"one minus dst alpha"),(0,F.Z)(Qt,w.gl.CONSTANT_COLOR,"constant color"),(0,F.Z)(Qt,w.gl.ONE_MINUS_CONSTANT_COLOR,"one minus constant color"),(0,F.Z)(Qt,w.gl.CONSTANT_ALPHA,"constant alpha"),(0,F.Z)(Qt,w.gl.ONE_MINUS_CONSTANT_ALPHA,"one minus constant alpha"),(0,F.Z)(Qt,w.gl.SRC_ALPHA_SATURATE,"src alpha saturate"),Qt),Ge=(gr={},(0,F.Z)(gr,w.gl.NEVER,"never"),(0,F.Z)(gr,w.gl.ALWAYS,"always"),(0,F.Z)(gr,w.gl.LESS,"less"),(0,F.Z)(gr,w.gl.LEQUAL,"lequal"),(0,F.Z)(gr,w.gl.GREATER,"greater"),(0,F.Z)(gr,w.gl.GEQUAL,"gequal"),(0,F.Z)(gr,w.gl.EQUAL,"equal"),(0,F.Z)(gr,w.gl.NOTEQUAL,"notequal"),gr),ue=(gn={},(0,F.Z)(gn,w.gl.ZERO,"zero"),(0,F.Z)(gn,w.gl.KEEP,"keep"),(0,F.Z)(gn,w.gl.REPLACE,"replace"),(0,F.Z)(gn,w.gl.INVERT,"invert"),(0,F.Z)(gn,w.gl.INCR,"increment"),(0,F.Z)(gn,w.gl.DECR,"decrement"),(0,F.Z)(gn,w.gl.INCR_WRAP,"increment wrap"),(0,F.Z)(gn,w.gl.DECR_WRAP,"decrement wrap"),gn),De=(Cn={},(0,F.Z)(Cn,w.gl.FRONT,"front"),(0,F.Z)(Cn,w.gl.BACK,"back"),Cn),wt=function(){function i(f,o){(0,Y.Z)(this,i),this.buffer=void 0;var u=o.data,l=o.usage,d=o.type;this.buffer=f.buffer({data:u,usage:xi[l||w.gl.STATIC_DRAW],type:Ri[d||w.gl.UNSIGNED_BYTE]})}return(0,le.Z)(i,[{key:"get",value:function(){return this.buffer}},{key:"destroy",value:function(){this.buffer.destroy()}},{key:"subData",value:function(o){var u=o.data,l=o.offset;this.buffer.subdata(u,l)}}]),i}(),Ir=function(){function i(f,o){(0,Y.Z)(this,i),this.elements=void 0;var u=o.data,l=o.usage,d=o.type,y=o.count;this.elements=f.elements({data:u,usage:xi[l||w.gl.STATIC_DRAW],type:Ri[d||w.gl.UNSIGNED_BYTE],count:y})}return(0,le.Z)(i,[{key:"get",value:function(){return this.elements}},{key:"subData",value:function(o){var u=o.data;this.elements.subdata(u)}},{key:"destroy",value:function(){}}]),i}(),Ur=function(){function i(f,o){(0,Y.Z)(this,i),this.framebuffer=void 0;var u=o.width,l=o.height,d=o.color,y=o.colors,A=o.depth,M=o.stencil,D={width:u,height:l};Array.isArray(y)&&(D.colors=y.map(function(ee){return ee.get()})),d&&typeof d!="boolean"&&(D.color=d.get()),this.framebuffer=f.framebuffer(D)}return(0,le.Z)(i,[{key:"get",value:function(){return this.framebuffer}},{key:"destroy",value:function(){this.framebuffer.destroy()}},{key:"resize",value:function(o){var u=o.width,l=o.height;this.framebuffer.resize(u,l)}}]),i}(),jt=x(90484),dr=x(36719),Hr=x.n(dr),_n=x(68630),vr=x.n(_n);function vn(i,f){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(i);f&&(u=u.filter(function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable})),o.push.apply(o,u)}return o}function $r(i){for(var f=1;f<arguments.length;f++){var o=arguments[f]!=null?arguments[f]:{};f%2?vn(Object(o),!0).forEach(function(u){(0,F.Z)(i,u,o[u])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):vn(Object(o)).forEach(function(u){Object.defineProperty(i,u,Object.getOwnPropertyDescriptor(o,u))})}return i}var cn=function(){function i(f,o){(0,Y.Z)(this,i),this.reGl=void 0,this.destroyed=!1,this.drawCommand=void 0,this.drawParams=void 0,this.options=void 0,this.uniforms={},this.reGl=f;var u=o.vs,l=o.fs,d=o.attributes,y=o.uniforms,A=o.primitive,M=o.count,D=o.elements,ee=o.depth,X=o.blend,fe=o.stencil,Xe=o.cull,it=o.instances,Rt={};this.options=o,y&&(this.uniforms=this.extractUniforms(y),Object.keys(y).forEach(function(jr){Rt[jr]=f.prop(jr)}));var xr={};Object.keys(d).forEach(function(jr){xr[jr]=d[jr].get()});var Tr={attributes:xr,frag:l,uniforms:Rt,vert:u,primitive:vi[A===void 0?w.gl.TRIANGLES:A]};it&&(Tr.instances=it),M&&(Tr.count=M),D&&(Tr.elements=D.get()),this.initDepthDrawParams({depth:ee},Tr),this.initBlendDrawParams({blend:X},Tr),this.initStencilDrawParams({stencil:fe},Tr),this.initCullDrawParams({cull:Xe},Tr),this.drawCommand=f(Tr),this.drawParams=Tr}return(0,le.Z)(i,[{key:"addUniforms",value:function(o){this.uniforms=$r($r({},this.uniforms),this.extractUniforms(o))}},{key:"draw",value:function(o){if(!(this.drawParams.attributes&&Object.keys(this.drawParams.attributes).length===0)){var u=$r($r({},this.uniforms),this.extractUniforms(o.uniforms||{})),l={};Object.keys(u).forEach(function(d){var y=(0,jt.Z)(u[d]);y==="boolean"||y==="number"||Array.isArray(u[d])||u[d].BYTES_PER_ELEMENT?l[d]=u[d]:l[d]=u[d].get()}),this.drawCommand(l)}}},{key:"destroy",value:function(){this.drawParams.elements.destroy(),this.options.attributes&&Object.values(this.options.attributes).forEach(function(o){o.destroy()}),this.destroyed=!0}},{key:"initDepthDrawParams",value:function(o,u){var l=o.depth;l&&(u.depth={enable:l.enable===void 0?!0:!!l.enable,mask:l.mask===void 0?!0:!!l.mask,func:$[l.func||w.gl.LESS],range:l.range||[0,1]})}},{key:"initBlendDrawParams",value:function(o,u){var l=o.blend;if(l){var d=l.enable,y=l.func,A=l.equation,M=l.color,D=M===void 0?[0,0,0,0]:M;u.blend={enable:!!d,func:{srcRGB:Le[y&&y.srcRGB||w.gl.SRC_ALPHA],srcAlpha:Le[y&&y.srcAlpha||w.gl.SRC_ALPHA],dstRGB:Le[y&&y.dstRGB||w.gl.ONE_MINUS_SRC_ALPHA],dstAlpha:Le[y&&y.dstAlpha||w.gl.ONE_MINUS_SRC_ALPHA]},equation:{rgb:ie[A&&A.rgb||w.gl.FUNC_ADD],alpha:ie[A&&A.alpha||w.gl.FUNC_ADD]},color:D}}}},{key:"initStencilDrawParams",value:function(o,u){var l=o.stencil;if(l){var d=l.enable,y=l.mask,A=y===void 0?-1:y,M=l.func,D=M===void 0?{cmp:w.gl.ALWAYS,ref:0,mask:-1}:M,ee=l.opFront,X=ee===void 0?{fail:w.gl.KEEP,zfail:w.gl.KEEP,zpass:w.gl.KEEP}:ee,fe=l.opBack,Xe=fe===void 0?{fail:w.gl.KEEP,zfail:w.gl.KEEP,zpass:w.gl.KEEP}:fe;u.stencil={enable:!!d,mask:A,func:$r($r({},D),{},{cmp:Ge[D.cmp]}),opFront:{fail:ue[X.fail],zfail:ue[X.zfail],zpass:ue[X.zpass]},opBack:{fail:ue[Xe.fail],zfail:ue[Xe.zfail],zpass:ue[Xe.zpass]}}}}},{key:"initCullDrawParams",value:function(o,u){var l=o.cull;if(l){var d=l.enable,y=l.face,A=y===void 0?w.gl.BACK:y;u.cull={enable:!!d,face:De[A]}}}},{key:"extractUniforms",value:function(o){var u=this,l={};return Object.keys(o).forEach(function(d){u.extractUniformsRecursively(d,o[d],l,"")}),l}},{key:"extractUniformsRecursively",value:function(o,u,l,d){var y=this;if(u===null||typeof u=="number"||typeof u=="boolean"||Array.isArray(u)&&typeof u[0]=="number"||Hr()(u)||u===""||"resize"in u){l["".concat(d&&d+".").concat(o)]=u;return}vr()(u)&&Object.keys(u).forEach(function(A){y.extractUniformsRecursively(A,u[A],l,"".concat(d&&d+".").concat(o))}),Array.isArray(u)&&u.forEach(function(A,M){Object.keys(A).forEach(function(D){y.extractUniformsRecursively(D,A[D],l,"".concat(d&&d+".").concat(o,"[").concat(M,"]"))})})}}]),i}(),pi=function(){function i(f,o){(0,Y.Z)(this,i),this.texture=void 0,this.width=void 0,this.height=void 0;var u=o.data,l=o.type,d=l===void 0?w.gl.UNSIGNED_BYTE:l,y=o.width,A=o.height,M=o.flipY,D=M===void 0?!1:M,ee=o.format,X=ee===void 0?w.gl.RGBA:ee,fe=o.mipmap,Xe=fe===void 0?!1:fe,it=o.wrapS,Rt=it===void 0?w.gl.CLAMP_TO_EDGE:it,xr=o.wrapT,Tr=xr===void 0?w.gl.CLAMP_TO_EDGE:xr,jr=o.aniso,dn=jr===void 0?0:jr,bn=o.alignment,Gn=bn===void 0?1:bn,Li=o.premultiplyAlpha,ti=Li===void 0?!1:Li,qi=o.mag,za=qi===void 0?w.gl.NEAREST:qi,Ua=o.min,di=Ua===void 0?w.gl.NEAREST:Ua,Ca=o.colorSpace,ao=Ca===void 0?w.gl.BROWSER_DEFAULT_WEBGL:Ca;this.width=y,this.height=A;var Wu={width:y,height:A,type:Ri[d],format:Wi[X],wrapS:I[Rt],wrapT:I[Tr],mag:G[za],min:G[di],alignment:Gn,flipY:D,colorSpace:Z[ao],premultiplyAlpha:ti,aniso:dn};u&&(Wu.data=u),typeof Xe=="number"?Wu.mipmap=si[Xe]:typeof Xe=="boolean"&&(Wu.mipmap=Xe),this.texture=f.texture(Wu)}return(0,le.Z)(i,[{key:"get",value:function(){return this.texture}},{key:"update",value:function(){var o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.texture(o)}},{key:"bind",value:function(){this.texture._texture.bind()}},{key:"resize",value:function(o){var u=o.width,l=o.height;this.texture.resize(u,l),this.width=u,this.height=l}},{key:"destroy",value:function(){this.texture.destroy()}}]),i}(),pn,_i,Xi,mi=(pn=(0,H.b2)(),pn(_i=(Xi=function(){function i(){var f=this;(0,Y.Z)(this,i),this.gl=void 0,this.$container=void 0,this.canvas=void 0,this.width=void 0,this.height=void 0,this.isDirty=void 0,this.createModel=function(o){return new cn(f.gl,o)},this.createAttribute=function(o){return new _r(f.gl,o)},this.createBuffer=function(o){return new wt(f.gl,o)},this.createElements=function(o){return new Ir(f.gl,o)},this.createTexture2D=function(o){return new pi(f.gl,o)},this.createFramebuffer=function(o){return new Ur(f.gl,o)},this.useFramebuffer=function(o,u){f.gl({framebuffer:o?o.get():null})(u)},this.clear=function(o){var u=o.color,l=o.depth,d=o.stencil,y=o.framebuffer,A=y===void 0?null:y,M={color:u,depth:l,stencil:d};M.framebuffer=A===null?A:A.get(),f.gl.clear(M)},this.viewport=function(o){var u=o.x,l=o.y,d=o.width,y=o.height;f.gl._gl.viewport(u,l,d,y),f.width=d,f.height=y,f.gl._refresh()},this.readPixels=function(o){var u=o.framebuffer,l=o.x,d=o.y,y=o.width,A=o.height,M={x:l,y:d,width:y,height:A};return u&&(M.framebuffer=u.get()),f.gl.read(M)},this.getViewportSize=function(){return{width:f.gl._gl.drawingBufferWidth,height:f.gl._gl.drawingBufferHeight}},this.getContainer=function(){var o;return(o=f.canvas)===null||o===void 0?void 0:o.parentElement},this.getCanvas=function(){return f.canvas},this.getGLContext=function(){return f.gl._gl},this.destroy=function(){f.gl.destroy()}}return(0,le.Z)(i,[{key:"init",value:function(){var f=(0,Je.Z)(Ct().mark(function u(l,d){var y=this;return Ct().wrap(function(M){for(;;)switch(M.prev=M.next){case 0:return this.canvas=l,M.next=3,new Promise(function(D,ee){Vt()({canvas:y.canvas,attributes:{alpha:!0,antialias:d.antialias,premultipliedAlpha:!0,preserveDrawingBuffer:d.preserveDrawingBuffer},extensions:["OES_element_index_uint","OES_standard_derivatives","angle_instanced_arrays"],optionalExtensions:["oes_texture_float_linear","OES_texture_float","EXT_texture_filter_anisotropic","EXT_blend_minmax","WEBGL_depth_texture"],profile:!0,onDone:function(fe,Xe){(fe||!Xe)&&ee(fe),D(Xe)}})});case 3:this.gl=M.sent;case 4:case"end":return M.stop()}},u,this)}));function o(u,l){return f.apply(this,arguments)}return o}()},{key:"setBaseState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!1,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setCustomLayerDefaults",value:function(){var o=this.getGLContext();o.disable(o.CULL_FACE)}},{key:"setDirty",value:function(o){this.isDirty=o}},{key:"getDirty",value:function(){return this.isDirty}}]),i}(),Xi))||_i);function Di(i,f){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(i);f&&(u=u.filter(function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable})),o.push.apply(o,u)}return o}function Pi(i){for(var f=1;f<arguments.length;f++){var o=arguments[f]!=null?arguments[f]:{};f%2?Di(Object(o),!0).forEach(function(u){(0,F.Z)(i,u,o[u])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):Di(Object(o)).forEach(function(u){Object.defineProperty(i,u,Object.getOwnPropertyDescriptor(o,u))})}return i}var po=function(){function i(f){(0,Y.Z)(this,i),this.sceneService=void 0,this.mapService=void 0,this.controlService=void 0,this.layerService=void 0,this.iconService=void 0,this.markerService=void 0,this.popupService=void 0,this.fontService=void 0,this.interactionService=void 0,this.container=void 0;var o=f.id,u=f.map,l=(0,w.Hp)();this.container=l,u.setContainer(l,o),l.bind(w.vK.IRendererService).to(mi).inSingletonScope(),this.sceneService=l.get(w.vK.ISceneService),this.mapService=l.get(w.vK.IMapService),this.iconService=l.get(w.vK.IIconService),this.fontService=l.get(w.vK.IFontService),this.controlService=l.get(w.vK.IControlService),this.layerService=l.get(w.vK.ILayerService),this.markerService=l.get(w.vK.IMarkerService),this.interactionService=l.get(w.vK.IInteractionService),this.popupService=l.get(w.vK.IPopupService),this.initComponent(o),this.sceneService.init(f),this.initControl()}return(0,le.Z)(i,[{key:"getServiceContainer",value:function(){return this.container}},{key:"getSize",value:function(){return this.mapService.getSize()}},{key:"getMinZoom",value:function(){return this.mapService.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.mapService.getMaxZoom()}},{key:"getType",value:function(){return this.mapService.getType()}},{key:"getMapContainer",value:function(){return this.mapService.getMapContainer()}},{key:"getMapCanvasContainer",value:function(){return this.mapService.getMapCanvasContainer()}},{key:"getMapService",value:function(){return this.mapService}},{key:"exportPng",value:function(o){return this.sceneService.exportPng(o)}},{key:"exportMap",value:function(o){return this.sceneService.exportPng(o)}},{key:"registerRenderService",value:function(o){var u=this;if(this.sceneService.loaded){var l=new o(this);l.init()}else this.on("loaded",function(){var d=new o(u);d.init()})}},{key:"map",get:function(){return this.mapService.map}},{key:"addLayer",value:function(o){var u=(0,w.e7)(this.container);o.setContainer(u),this.sceneService.addLayer(o)}},{key:"getLayers",value:function(){return this.layerService.getLayers()}},{key:"getLayer",value:function(o){return this.layerService.getLayer(o)}},{key:"getLayerByName",value:function(o){return this.layerService.getLayerByName(o)}},{key:"removeLayer",value:function(o){this.layerService.remove(o)}},{key:"removeAllLayer",value:function(){this.layerService.removeAllLayers()}},{key:"render",value:function(){this.sceneService.render()}},{key:"addIconFont",value:function(o,u){this.fontService.addIconFont(o,u)}},{key:"addIconFonts",value:function(o){var u=this;o.forEach(function(l){var d=(0,Q.Z)(l,2),y=d[0],A=d[1];u.fontService.addIconFont(y,A)})}},{key:"addFontFace",value:function(o,u){this.sceneService.addFontFace(o,u)}},{key:"addImage",value:function(o,u){this.iconService.addImage(o,u)}},{key:"hasImage",value:function(o){return this.iconService.hasImage(o)}},{key:"removeImage",value:function(o){this.iconService.removeImage(o)}},{key:"addIconFontGlyphs",value:function(o,u){this.fontService.addIconGlyphs(u)}},{key:"addControl",value:function(o){this.controlService.addControl(o,this.container)}},{key:"removeControl",value:function(o){this.controlService.removeControl(o)}},{key:"getControlByName",value:function(o){return this.controlService.getControlByName(o)}},{key:"addMarker",value:function(o){this.markerService.addMarker(o)}},{key:"addMarkerLayer",value:function(o){this.markerService.addMarkerLayer(o)}},{key:"removeMarkerLayer",value:function(o){this.markerService.removeMarkerLayer(o)}},{key:"removeAllMakers",value:function(){this.markerService.removeAllMarkers()}},{key:"addPopup",value:function(o){this.popupService.addPopup(o)}},{key:"on",value:function(o,u){w.SceneEventList.indexOf(o)===-1?this.mapService.on(o,u):this.sceneService.on(o,u)}},{key:"off",value:function(o,u){w.SceneEventList.indexOf(o)===-1?this.mapService.off(o,u):this.sceneService.off(o,u)}},{key:"getZoom",value:function(){return this.mapService.getZoom()}},{key:"getCenter",value:function(o){return this.mapService.getCenter(o)}},{key:"setCenter",value:function(o,u){return this.mapService.setCenter(o,u)}},{key:"getPitch",value:function(){return this.mapService.getPitch()}},{key:"setPitch",value:function(o){return this.mapService.setPitch(o)}},{key:"getRotation",value:function(){return this.mapService.getRotation()}},{key:"getBounds",value:function(){return this.mapService.getBounds()}},{key:"setRotation",value:function(o){this.mapService.setRotation(o)}},{key:"zoomIn",value:function(){this.mapService.zoomIn()}},{key:"zoomOut",value:function(){this.mapService.zoomOut()}},{key:"panTo",value:function(o){this.mapService.panTo(o)}},{key:"panBy",value:function(o){this.mapService.panBy(o)}},{key:"getContainer",value:function(){return this.mapService.getContainer()}},{key:"setZoom",value:function(o){this.mapService.setZoom(o)}},{key:"fitBounds",value:function(o,u){var l=this.sceneService.getSceneConfig(),d=l.fitBoundsOptions,y=l.animate;this.mapService.fitBounds(o,u||Pi(Pi({},d),{},{animate:y}))}},{key:"setZoomAndCenter",value:function(o,u){this.mapService.setZoomAndCenter(o,u)}},{key:"setMapStyle",value:function(o){this.mapService.setMapStyle(o)}},{key:"setMapStatus",value:function(o){this.mapService.setMapStatus(o)}},{key:"pixelToLngLat",value:function(o){return this.mapService.pixelToLngLat(o)}},{key:"lngLatToPixel",value:function(o){return this.mapService.lngLatToPixel(o)}},{key:"containerToLngLat",value:function(o){return this.mapService.containerToLngLat(o)}},{key:"lngLatToContainer",value:function(o){return this.mapService.lngLatToContainer(o)}},{key:"destroy",value:function(){this.sceneService.destroy()}},{key:"registerPostProcessingPass",value:function(o,u){this.container.bind(w.vK.IPostProcessingPass).to(o).whenTargetNamed(u)}},{key:"initComponent",value:function(o){this.controlService.init({container:Ie.SO.getContainer(o)},this.container),this.markerService.init(this.container),this.popupService.init(this.container)}},{key:"initControl",value:function(){var o=this.sceneService.getSceneConfig(),u=o.logoVisible,l=o.logoPosition;u&&this.addControl(new Ae({position:l}))}}]),i}(),ji=x(81253),Rn=x(55770),Dn=x(3473),li=x(13218),Vn=x.n(li),Na=x(23560),ps=x.n(Na),ki=x(46343),Ba=x(86387),xu=x.n(Ba),uu,_a,oo,Wa,Xa,Wo;function sa(i){return i.map(function(f){return typeof f=="string"&&(f=[f,{}]),f})}var Ya=(uu=(0,H.b2)(),_a=(0,H.f3)(w.vK.IGlobalConfigService),uu(oo=(Wa=(Wo=function(){function i(){(0,Y.Z)(this,i),(0,Rn.Z)(this,"configService",Xa,this),this.enabled=void 0}return(0,le.Z)(i,[{key:"apply",value:function(o,u){var l=this,d=u.rendererService,y=u.postProcessingPassFactory,A=u.normalPassFactory;o.hooks.init.tap("MultiPassRendererPlugin",function(){var M=o.getLayerConfig(),D=M.enableMultiPassRenderer,ee=M.passes,X=ee===void 0?[]:ee;l.enabled=!!D&&o.getLayerConfig().enableMultiPassRenderer!==!1,l.enabled&&(o.multiPassRenderer=l.createMultiPassRenderer(o,X,y,A),o.multiPassRenderer.setRenderFlag(!0))}),o.hooks.beforeRender.tap("MultiPassRendererPlugin",function(){})}},{key:"createMultiPassRenderer",value:function(o,u,l,d){var y=o.multiPassRenderer,A=o.getLayerConfig(),M=A.enablePicking,D=A.enableTAA;return M&&y.add(d("pixelPicking")),y}}]),i}(),Wo),Xa=(0,Dn.Z)(Wa.prototype,"configService",[_a],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Wa))||oo),Ta,xa=(Ta={},(0,F.Z)(Ta,w.BlendType.additive,{enable:!0,func:{srcRGB:w.gl.ONE,dstRGB:w.gl.ONE,srcAlpha:1,dstAlpha:1}}),(0,F.Z)(Ta,w.BlendType.none,{enable:!1}),(0,F.Z)(Ta,w.BlendType.normal,{enable:!0,func:{srcRGB:w.gl.SRC_ALPHA,dstRGB:w.gl.ONE_MINUS_SRC_ALPHA,srcAlpha:1,dstAlpha:1}}),(0,F.Z)(Ta,w.BlendType.subtractive,{enable:!0,func:{srcRGB:w.gl.ONE,dstRGB:w.gl.ONE,srcAlpha:w.gl.ZERO,dstAlpha:w.gl.ONE_MINUS_SRC_COLOR},equation:{rgb:w.gl.FUNC_SUBTRACT,alpha:w.gl.FUNC_SUBTRACT}}),(0,F.Z)(Ta,w.BlendType.max,{enable:!0,func:{srcRGB:w.gl.ONE,dstRGB:w.gl.ONE},equation:{rgb:w.gl.MAX_EXT}}),(0,F.Z)(Ta,w.BlendType.min,{enable:!0,func:{srcRGB:w.gl.ONE,dstRGB:w.gl.ONE},equation:{rgb:w.gl.MIN_EXT}}),Ta),ta={properties:{enablePicking:{type:"boolean"},enableHighlight:{type:"boolean"},highlightColor:{oneOf:[{type:"array",items:{type:"number",minimum:0,maximum:1}},{type:"string"}]}}},sl,rs,qa,La,fa,he,Pe,ct;function cr(i,f){var o;if(typeof Symbol=="undefined"||i[Symbol.iterator]==null){if(Array.isArray(i)||(o=tn(i))||f&&i&&typeof i.length=="number"){o&&(i=o);var u=0,l=function(){};return{s:l,n:function(){return u>=i.length?{done:!0}:{done:!1,value:i[u++]}},e:function(D){throw D},f:l}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var d=!0,y=!1,A;return{s:function(){o=i[Symbol.iterator]()},n:function(){var D=o.next();return d=D.done,D},e:function(D){y=!0,A=D},f:function(){try{!d&&o.return!=null&&o.return()}finally{if(y)throw A}}}}function tn(i,f){if(!!i){if(typeof i=="string")return kn(i,f);var o=Object.prototype.toString.call(i).slice(8,-1);if(o==="Object"&&i.constructor&&(o=i.constructor.name),o==="Map"||o==="Set")return Array.from(i);if(o==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return kn(i,f)}}function kn(i,f){(f==null||f>i.length)&&(f=i.length);for(var o=0,u=new Array(f);o<f;o++)u[o]=i[o];return u}function Zi(i,f){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(i);f&&(u=u.filter(function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable})),o.push.apply(o,u)}return o}function Yi(i){for(var f=1;f<arguments.length;f++){var o=arguments[f]!=null?arguments[f]:{};f%2?Zi(Object(o),!0).forEach(function(u){(0,F.Z)(i,u,o[u])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):Zi(Object(o)).forEach(function(u){Object.defineProperty(i,u,Object.getOwnPropertyDescriptor(o,u))})}return i}function Ka(i){var f=$a();return function(){var u=(0,we.Z)(i),l;if(f){var d=(0,we.Z)(this).constructor;l=Reflect.construct(u,arguments,d)}else l=u.apply(this,arguments);return(0,be.Z)(this,l)}}function $a(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var Xo=0,xs=(sl=(0,w.yT)(w.vK.ILogService),rs=(0,w.yT)(w.vK.IGlobalConfigService),qa=(0,w.yT)(w.vK.IShaderModuleService),La=(ct=function(i){(0,ne.Z)(o,i);var f=Ka(o);function o(){var u,l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return(0,Y.Z)(this,o),u=f.call(this),u.id="".concat(Xo++),u.name="".concat(Xo),u.type=void 0,u.visible=!0,u.zIndex=0,u.minZoom=void 0,u.maxZoom=void 0,u.inited=!1,u.layerModelNeedUpdate=!1,u.pickedFeatureID=null,u.selectedFeatureID=null,u.styleNeedUpdate=!1,u.dataState={dataSourceNeedUpdate:!1,dataMappingNeedUpdate:!1,filterNeedUpdate:!1,featureScaleNeedUpdate:!1,StyleAttrNeedUpdate:!1},u.hooks={init:new ki.oI,afterInit:new ki.oI,beforeRender:new ki.oI,beforeRenderData:new ki.gg,afterRender:new ki.ni,beforePickingEncode:new ki.ni,afterPickingEncode:new ki.ni,beforeHighlight:new ki.ni(["pickedColor"]),afterHighlight:new ki.ni,beforeSelect:new ki.ni(["pickedColor"]),afterSelect:new ki.ni,beforeDestroy:new ki.ni,afterDestroy:new ki.ni},u.models=[],u.multiPassRenderer=void 0,u.plugins=void 0,u.sourceOption=void 0,u.layerModel=void 0,(0,Rn.Z)(u,"logger",fa,(0,Gt.Z)(u)),(0,Rn.Z)(u,"configService",he,(0,Gt.Z)(u)),(0,Rn.Z)(u,"shaderModuleService",Pe,(0,Gt.Z)(u)),u.cameraService=void 0,u.coordinateService=void 0,u.iconService=void 0,u.fontService=void 0,u.pickingService=void 0,u.rendererService=void 0,u.layerService=void 0,u.interactionService=void 0,u.mapService=void 0,u.styleAttributeService=void 0,u.layerSource=void 0,u.postProcessingPassFactory=void 0,u.normalPassFactory=void 0,u.animateOptions={enable:!1},u.container=void 0,u.encodedData=void 0,u.configSchema=void 0,u.currentPickId=null,u.rawConfig=void 0,u.needUpdateConfig=void 0,u.pendingStyleAttributes=[],u.scaleOptions={},u.animateStartTime=void 0,u.aniamateStatus=!1,u.sourceEvent=function(){u.dataState.dataSourceNeedUpdate=!0;var d=u.getLayerConfig(),y=d.autoFit,A=d.fitBoundsOptions;y&&u.fitBounds(A),u.emit("dataUpdate"),u.reRender()},u.name=l.name||u.id,u.zIndex=l.zIndex||0,u.rawConfig=l,u}return(0,le.Z)(o,[{key:"getLayerConfig",value:function(){return this.configService.getLayerConfig(this.id)}},{key:"updateLayerConfig",value:function(l){if(!this.inited)this.needUpdateConfig=Yi(Yi({},this.needUpdateConfig),l);else{var d=this.container.get(w.vK.SceneID);this.configService.setLayerConfig(d,this.id,Yi(Yi(Yi({},this.configService.getLayerConfig(this.id)),this.needUpdateConfig),l)),this.needUpdateConfig={}}}},{key:"setContainer",value:function(l){this.container=l}},{key:"getContainer",value:function(){return this.container}},{key:"addPlugin",value:function(l){return this.plugins.push(l),this}},{key:"init",value:function(){var l=this,d=this.container.get(w.vK.SceneID),y=this.rawConfig.enableMultiPassRenderer,A=y===void 0?!1:y;this.configService.setLayerConfig(d,this.id,{enableMultiPassRenderer:A}),this.iconService=this.container.get(w.vK.IIconService),this.fontService=this.container.get(w.vK.IFontService),this.rendererService=this.container.get(w.vK.IRendererService),this.layerService=this.container.get(w.vK.ILayerService),this.interactionService=this.container.get(w.vK.IInteractionService),this.pickingService=this.container.get(w.vK.IPickingService),this.mapService=this.container.get(w.vK.IMapService),this.cameraService=this.container.get(w.vK.ICameraService),this.coordinateService=this.container.get(w.vK.ICoordinateSystemService),this.postProcessingPassFactory=this.container.get(w.vK.IFactoryPostProcessingPass),this.normalPassFactory=this.container.get(w.vK.IFactoryNormalPass),this.styleAttributeService=this.container.get(w.vK.IStyleAttributeService),this.multiPassRenderer=this.container.get(w.vK.IMultiPassRenderer),this.multiPassRenderer.setLayer(this),this.pendingStyleAttributes.forEach(function(X){var fe=X.attributeName,Xe=X.attributeField,it=X.attributeValues,Rt=X.updateOptions;l.styleAttributeService.updateStyleAttribute(fe,{scale:Yi({field:Xe},l.splitValuesAndCallbackInAttribute(it,l.getLayerConfig()[fe]))},Rt)}),this.pendingStyleAttributes=[],this.plugins=this.container.getAll(w.vK.ILayerPlugin);var M=cr(this.plugins),D;try{for(M.s();!(D=M.n()).done;){var ee=D.value;ee.apply(this,{rendererService:this.rendererService,mapService:this.mapService,styleAttributeService:this.styleAttributeService,normalPassFactory:this.normalPassFactory,postProcessingPassFactory:this.postProcessingPassFactory})}}catch(X){M.e(X)}finally{M.f()}return this.hooks.init.call(),this.hooks.afterInit.call(),this.emit("inited",{target:this,type:"inited"}),this.emit("add",{target:this,type:"add"}),this}},{key:"prepareBuildModel",value:function(){this.inited=!0,this.updateLayerConfig(Yi(Yi({},this.getDefaultConfig()),this.rawConfig));var l=this.getLayerConfig(),d=l.animateOption;d!=null&&d.enable&&(this.layerService.startAnimate(),this.aniamateStatus=!0)}},{key:"color",value:function(l,d,y){return this.updateStyleAttribute("color",l,d,y),this}},{key:"texture",value:function(l,d,y){return this.updateStyleAttribute("texture",l,d,y),this}},{key:"rotate",value:function(l,d,y){return this.updateStyleAttribute("rotate",l,d,y),this}},{key:"size",value:function(l,d,y){return this.updateStyleAttribute("size",l,d,y),this}},{key:"filter",value:function(l,d,y){return this.updateStyleAttribute("filter",l,d,y),this}},{key:"shape",value:function(l,d,y){return this.updateStyleAttribute("shape",l,d,y),this}},{key:"label",value:function(l,d,y){return this.pendingStyleAttributes.push({attributeName:"label",attributeField:l,attributeValues:d,updateOptions:y}),this}},{key:"animate",value:function(l){var d={};return Vn()(l)?(d.enable=!0,d=Yi(Yi({},d),l)):d.enable=l,this.updateLayerConfig({animateOption:d}),this}},{key:"source",value:function(l,d){return this.sourceOption={data:l,options:d},this}},{key:"setData",value:function(l,d){var y=this;return this.inited?this.layerSource.setData(l,d):this.on("inited",function(){y.layerSource.setData(l,d)}),this}},{key:"style",value:function(l){var d=this,y=l.passes,A=(0,ji.Z)(l,["passes"]);return y&&sa(y).forEach(function(M){var D=d.multiPassRenderer.getPostProcessor().getPostProcessingPassByName(M[0]);D&&D.updateOptions(M[1])}),this.rawConfig=Yi(Yi({},this.rawConfig),A),this.container&&(this.updateLayerConfig(this.rawConfig),this.styleNeedUpdate=!0),this}},{key:"scale",value:function(l,d){return Vn()(l)?this.scaleOptions=Yi(Yi({},this.scaleOptions),l):this.scaleOptions[l]=d,this}},{key:"render",value:function(){return this.renderModels(),this}},{key:"active",value:function(l){var d={};return d.enableHighlight=Vn()(l)?!0:l,Vn()(l)?(d.enableHighlight=!0,l.color&&(d.highlightColor=l.color)):d.enableHighlight=!!l,this.updateLayerConfig(d),this}},{key:"setActive",value:function(l,d){var y=this;if(Vn()(l)){var A=l.x,M=A===void 0?0:A,D=l.y,ee=D===void 0?0:D;this.updateLayerConfig({highlightColor:Vn()(d)?d.color:this.getLayerConfig().highlightColor}),this.pick({x:M,y:ee})}else this.updateLayerConfig({pickedFeatureID:l,highlightColor:Vn()(d)?d.color:this.getLayerConfig().highlightColor}),this.hooks.beforeSelect.call((0,Ie.Z6)(l)).then(function(){setTimeout(function(){y.reRender()},1)})}},{key:"select",value:function(l){var d={};return d.enableSelect=Vn()(l)?!0:l,Vn()(l)?(d.enableSelect=!0,l.color&&(d.selectColor=l.color)):d.enableSelect=!!l,this.updateLayerConfig(d),this}},{key:"setSelect",value:function(l,d){var y=this;if(Vn()(l)){var A=l.x,M=A===void 0?0:A,D=l.y,ee=D===void 0?0:D;this.updateLayerConfig({selectColor:Vn()(d)?d.color:this.getLayerConfig().selectColor}),this.pick({x:M,y:ee})}else this.updateLayerConfig({pickedFeatureID:l,selectColor:Vn()(d)?d.color:this.getLayerConfig().selectColor}),this.hooks.beforeSelect.call((0,Ie.Z6)(l)).then(function(){setTimeout(function(){y.reRender()},1)})}},{key:"setBlend",value:function(l){this.updateLayerConfig({blend:l}),this.layerModelNeedUpdate=!0,this.reRender()}},{key:"show",value:function(){return this.updateLayerConfig({visible:!0}),this.reRender(),this}},{key:"hide",value:function(){return this.updateLayerConfig({visible:!1}),this.reRender(),this}},{key:"setIndex",value:function(l){return this.zIndex=l,this.layerService.updateRenderOrder(),this}},{key:"setCurrentPickId",value:function(l){this.currentPickId=l}},{key:"getCurrentPickId",value:function(){return this.currentPickId}},{key:"setCurrentSelectedId",value:function(l){this.selectedFeatureID=l}},{key:"getCurrentSelectedId",value:function(){return this.selectedFeatureID}},{key:"isVisible",value:function(){var l=this.mapService.getZoom(),d=this.getLayerConfig(),y=d.visible,A=d.minZoom,M=A===void 0?-Infinity:A,D=d.maxZoom,ee=D===void 0?Infinity:D;return!!y&&l>=M&&l<=ee}},{key:"setMinZoom",value:function(l){return this.updateLayerConfig({minZoom:l}),this}},{key:"getMinZoom",value:function(){var l=this.getLayerConfig(),d=l.minZoom;return d}},{key:"getMaxZoom",value:function(){var l=this.getLayerConfig(),d=l.maxZoom;return d}},{key:"get",value:function(l){var d=this.getLayerConfig();return d[l]}},{key:"setMaxZoom",value:function(l){return this.updateLayerConfig({maxZoom:l}),this}},{key:"fitBounds",value:function(l){if(!this.inited)return this.updateLayerConfig({autoFit:!0}),this;var d=this.getSource(),y=d.extent,A=y.some(function(M){return Math.abs(M)===Infinity});return A?this:(this.mapService.fitBounds([[y[0],y[1]],[y[2],y[3]]],l),this)}},{key:"destroy",value:function(){this.hooks.beforeDestroy.call(),this.layerSource.off("update",this.sourceEvent),this.multiPassRenderer.destroy(),this.styleAttributeService.clearAllAttributes(),this.hooks.afterDestroy.call(),this.emit("remove",{target:this,type:"remove"}),this.removeAllListeners()}},{key:"clear",value:function(){this.styleAttributeService.clearAllAttributes()}},{key:"clearModels",value:function(){this.models.forEach(function(l){return l.destroy()}),this.layerModel.clearModels()}},{key:"isDirty",value:function(){return!!(this.styleAttributeService.getLayerStyleAttributes()||[]).filter(function(l){return l.needRescale||l.needRemapping||l.needRegenerateVertices}).length}},{key:"setSource",value:function(l){if(this.layerSource&&this.layerSource.off("update",this.sourceEvent),this.layerSource=l,this.inited&&this.layerSource.cluster){var d=this.mapService.getZoom();this.layerSource.updateClusterData(d)}this.layerSource.on("update",this.sourceEvent)}},{key:"getSource",value:function(){return this.layerSource}},{key:"getScaleOptions",value:function(){return this.scaleOptions}},{key:"setEncodedData",value:function(l){this.encodedData=l}},{key:"getEncodedData",value:function(){return this.encodedData}},{key:"getConfigSchemaForValidation",value:function(){return this.configSchema||(this.configSchema=xu()([ta,this.getConfigSchema()])),this.configSchema}},{key:"getLegendItems",value:function(l){var d=this.styleAttributeService.getLayerAttributeScale(l);if(d){if(d.ticks){var y=d.ticks().map(function(M){return(0,F.Z)({value:M},l,d(M))});return y}else if(d.invertExtent){var A=d.range().map(function(M){return(0,F.Z)({value:d.invertExtent(M)},l,M)});return A}}else return[]}},{key:"pick",value:function(l){var d=l.x,y=l.y;this.interactionService.triggerHover({x:d,y})}},{key:"boxSelect",value:function(l,d){this.pickingService.boxPickLayer(this,l,d)}},{key:"buildLayerModel",value:function(l){var d=l.moduleName,y=l.vertexShader,A=l.fragmentShader,M=l.triangulation,D=(0,ji.Z)(l,["moduleName","vertexShader","fragmentShader","triangulation"]);this.shaderModuleService.registerModule(d,{vs:y,fs:A});var ee=this.shaderModuleService.getModule(d),X=ee.vs,fe=ee.fs,Xe=ee.uniforms,it=this.rendererService.createModel,Rt=this.styleAttributeService.createAttributesAndIndices(this.encodedData,M),xr=Rt.attributes,Tr=Rt.elements;return it(Yi({attributes:xr,uniforms:Xe,fs:fe,vs:X,elements:Tr,blend:xa[w.BlendType.normal]},D))}},{key:"getTime",value:function(){return this.layerService.clock.getDelta()}},{key:"setAnimateStartTime",value:function(){this.animateStartTime=this.layerService.clock.getElapsedTime()}},{key:"stopAnimate",value:function(){this.aniamateStatus&&(this.layerService.stopAnimate(),this.aniamateStatus=!1,this.updateLayerConfig({animateOption:{enable:!1}}))}},{key:"getLayerAnimateTime",value:function(){return this.layerService.clock.getElapsedTime()-this.animateStartTime}},{key:"needPick",value:function(l){var d=this.getLayerConfig(),y=d.enableHighlight,A=y===void 0?!0:y,M=d.enableSelect,D=M===void 0?!0:M,ee=this.eventNames().indexOf(l)!==-1||this.eventNames().indexOf("un"+l)!==-1;return(l==="click"||l==="dblclick")&&D&&(ee=!0),l==="mousemove"&&(A||this.eventNames().indexOf("mouseenter")!==-1||this.eventNames().indexOf("unmousemove")!==-1||this.eventNames().indexOf("mouseout")!==-1)&&(ee=!0),this.isVisible()&&ee}},{key:"buildModels",value:function(){throw new Error("Method not implemented.")}},{key:"rebuildModels",value:function(){throw new Error("Method not implemented.")}},{key:"renderModels",value:function(){var l=this;return this.layerModelNeedUpdate&&this.layerModel&&(this.models=this.layerModel.buildModels(),this.hooks.beforeRender.call(),this.layerModelNeedUpdate=!1),this.models.forEach(function(d){d.draw({uniforms:l.layerModel.getUninforms()})}),this}},{key:"getConfigSchema",value:function(){throw new Error("Method not implemented.")}},{key:"getModelType",value:function(){throw new Error("Method not implemented.")}},{key:"getDefaultConfig",value:function(){return{}}},{key:"reRender",value:function(){this.inited&&this.layerService.renderLayers()}},{key:"splitValuesAndCallbackInAttribute",value:function(l,d){return{values:ps()(l)?void 0:l||d,callback:ps()(l)?l:void 0}}},{key:"updateStyleAttribute",value:function(l,d,y,A){this.inited?this.styleAttributeService.updateStyleAttribute(l,{scale:Yi({field:d},this.splitValuesAndCallbackInAttribute(y,this.getLayerConfig()[d]))},A):this.pendingStyleAttributes.push({attributeName:l,attributeField:d,attributeValues:y,updateOptions:A})}}]),o}($t.EventEmitter),ct),fa=(0,Dn.Z)(La.prototype,"logger",[sl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),he=(0,Dn.Z)(La.prototype,"configService",[rs],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Pe=(0,Dn.Z)(La.prototype,"shaderModuleService",[qa],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),La),Hl,Xu,Ro,Cs,so,Ps,Ra=(Hl=(0,w.yT)(w.vK.IGlobalConfigService),Xu=(0,w.yT)(w.vK.IShaderModuleService),Ro=(Ps=function(){function i(f){(0,Y.Z)(this,i),this.triangulation=void 0,this.layer=void 0,(0,Rn.Z)(this,"configService",Cs,this),(0,Rn.Z)(this,"shaderModuleService",so,this),this.rendererService=void 0,this.iconService=void 0,this.fontService=void 0,this.styleAttributeService=void 0,this.mapService=void 0,this.cameraService=void 0,this.layerService=void 0,this.layer=f,this.rendererService=f.getContainer().get(w.vK.IRendererService),this.styleAttributeService=f.getContainer().get(w.vK.IStyleAttributeService),this.mapService=f.getContainer().get(w.vK.IMapService),this.iconService=f.getContainer().get(w.vK.IIconService),this.fontService=f.getContainer().get(w.vK.IFontService),this.cameraService=f.getContainer().get(w.vK.ICameraService),this.layerService=f.getContainer().get(w.vK.ILayerService),this.registerBuiltinAttributes(),this.startModelAnimate()}return(0,le.Z)(i,[{key:"getBlend",value:function(){var o=this.layer.getLayerConfig(),u=o.blend,l=u===void 0?"normal":u;return xa[w.BlendType[l]]}},{key:"getDefaultStyle",value:function(){return{}}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"getAnimateUniforms",value:function(){return{}}},{key:"needUpdate",value:function(){return!1}},{key:"buildModels",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:function(){throw new Error("Method not implemented.")}},{key:"clearModels",value:function(){}},{key:"getAttribute",value:function(){throw new Error("Method not implemented.")}},{key:"render",value:function(){throw new Error("Method not implemented.")}},{key:"registerBuiltinAttributes",value:function(){throw new Error("Method not implemented.")}},{key:"animateOption2Array",value:function(o){return[o.enable?0:1,o.duration||4,o.interval||.2,o.trailLength||.1]}},{key:"startModelAnimate",value:function(){var o=this.layer.getLayerConfig(),u=o.animateOption;u.enable&&this.layer.setAnimateStartTime()}}]),i}(),Ps),Cs=(0,Dn.Z)(Ro.prototype,"configService",[Hl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),so=(0,Dn.Z)(Ro.prototype,"shaderModuleService",[Xu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ro),ci=x(85061),ul=x(9187),ba=x.n(ul),Nn=x(31437),Ws=Nn.create(),Wl=Nn.create(),uo=Nn.create(),je=Nn.create(),Pt=Nn.create();function yr(i,f,o,u,l){Nn.add(i,o,u),Nn.normalize(i,i),f=Nn.fromValues(-i[1],i[0]);var d=Nn.fromValues(-o[1],o[0]);return[l/Nn.dot(f,d),f]}function On(i,f){return Nn.set(i,-f[1],f[0])}function Gi(i,f,o){return Nn.sub(i,f,o),Nn.normalize(i,i),i}function Sa(i,f){return i[0]===f[0]&&i[1]===f[1]}function Za(i){for(var f=new Map,o=0;o<i.length;o++){var u=i[0].toString()+"-"+i[1].toString();f.get(u)?(i.splice(o,1),o++):f.set(u,u)}return i}var ra=function(){function i(){var f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(0,Y.Z)(this,i),this.complex=void 0,this.join=void 0,this.cap=void 0,this.miterLimit=void 0,this.thickness=void 0,this.normal=void 0,this.lastFlip=-1,this.miter=Nn.fromValues(0,0),this.started=!1,this.dash=!1,this.totalDistance=0,this.join=f.join||"miter",this.cap=f.cap||"butt",this.miterLimit=f.miterLimit||10,this.thickness=f.thickness||1,this.dash=f.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0}}return(0,le.Z)(i,[{key:"extrude_gaode2",value:function(o,u){var l=this.complex;if(o.length<=1)return l;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var d=o.length,y=l.startIndex,A=1;A<d;A++){var M=o[A-1],D=u[A-1],ee=o[A],X=u[A],fe=A<o.length-1?o[A+1]:null,Xe=A<u.length-1?u[A+1]:null,it=this.segment_gaode2(l,y,M,ee,fe,D,X,Xe);y+=it}if(this.dash)for(var Rt=0;Rt<l.positions.length/6;Rt++)l.positions[Rt*6+5]=this.totalDistance;return l.startIndex=l.positions.length/6,l}},{key:"extrude",value:function(o){var u=this.complex;if(o.length<=1)return u;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var l=o.length,d=u.startIndex,y=1;y<l;y++){var A=o[y-1],M=o[y],D=y<o.length-1?o[y+1]:null,ee=this.segment(u,d,A,M,D);d+=ee}if(this.dash)for(var X=0;X<u.positions.length/6;X++)u.positions[X*6+5]=this.totalDistance;return u.startIndex=u.positions.length/6,u}},{key:"segment_gaode2",value:function(o,u,l,d,y,A,M,D){var ee=0,X=o.indices,fe=o.positions,Xe=o.normals,it=this.cap==="square",Rt=this.join==="bevel",xr=(0,Ie.Z)([M[0],M[1]]),Tr=(0,Ie.Z)([A[0],A[1]]);Gi(uo,d,l);var jr=0;if(this.dash&&(jr=this.lineSegmentDistance(xr,Tr),this.totalDistance+=jr),this.normal||(this.normal=Nn.create(),On(this.normal,uo)),!this.started)if(this.started=!0,it){var dn=Nn.create(),bn=Nn.create();Nn.add(dn,this.normal,uo),Nn.add(bn,this.normal,uo),Xe.push(bn[0],bn[1],0),Xe.push(dn[0],dn[1],0),fe.push(l[0],l[1],0,this.totalDistance-jr,-this.thickness,0),fe.push(l[0],l[1],0,this.totalDistance-jr,this.thickness,0)}else this.extrusions(fe,Xe,l,this.normal,this.thickness,this.totalDistance-jr);if(X.push(u+0,u+1,u+2),y){Sa(d,y)&&Nn.add(y,d,Nn.normalize(y,Nn.subtract(y,d,l))),Gi(je,y,d);var ti=yr(Pt,Nn.create(),uo,je,this.thickness),qi=(0,Q.Z)(ti,2),za=qi[0],Ua=qi[1],di=Nn.dot(Pt,this.normal)<0?-1:1,Ca=Rt;if(!Ca&&this.join==="miter"){var ao=za;ao>this.miterLimit&&(Ca=!0)}Ca?(Xe.push(this.normal[0],this.normal[1],0),Xe.push(Ua[0],Ua[1],0),fe.push(d[0],d[1],0,this.totalDistance,-this.thickness*di,0),fe.push(d[0],d[1],0,this.totalDistance,this.thickness*di,0),X.push.apply(X,(0,ci.Z)(this.lastFlip!==-di?[u,u+2,u+3]:[u+2,u+1,u+3])),X.push(u+2,u+3,u+4),On(Ws,je),Nn.copy(this.normal,Ws),Xe.push(this.normal[0],this.normal[1],0),fe.push(d[0],d[1],0,this.totalDistance,-this.thickness*di,0),ee+=3):(this.extrusions(fe,Xe,d,Ua,za,this.totalDistance),X.push.apply(X,(0,ci.Z)(this.lastFlip===1?[u,u+2,u+3]:[u+2,u+1,u+3])),di=-1,Nn.copy(this.normal,Ua),ee+=2),this.lastFlip=di}else{if(On(this.normal,uo),it){var Gn=Nn.create(),Li=Nn.create();Nn.sub(Li,uo,this.normal),Nn.add(Gn,uo,this.normal),Xe.push(Li[0],Li[1],0),Xe.push(Gn[0],Gn[1],0),fe.push(d[0],d[1],0,this.totalDistance,this.thickness,0),fe.push(d[0],d[1],0,this.totalDistance,this.thickness,0)}else this.extrusions(fe,Xe,d,this.normal,this.thickness,this.totalDistance);X.push.apply(X,(0,ci.Z)(this.lastFlip===1?[u,u+2,u+3]:[u+2,u+1,u+3])),ee+=2}return ee}},{key:"segment",value:function(o,u,l,d,y){var A=0,M=o.indices,D=o.positions,ee=o.normals,X=this.cap==="square",fe=this.join==="bevel",Xe=(0,Ie.Z)([d[0],d[1]]),it=(0,Ie.Z)([l[0],l[1]]);Gi(uo,Xe,it);var Rt=0;if(this.dash&&(Rt=this.lineSegmentDistance(Xe,it),this.totalDistance+=Rt),this.normal||(this.normal=Nn.create(),On(this.normal,uo)),!this.started)if(this.started=!0,X){var xr=Nn.create(),Tr=Nn.create();Nn.add(xr,this.normal,uo),Nn.add(Tr,this.normal,uo),ee.push(Tr[0],Tr[1],0),ee.push(xr[0],xr[1],0),D.push(l[0],l[1],0,this.totalDistance-Rt,-this.thickness,0),D.push(l[0],l[1],0,this.totalDistance-Rt,this.thickness,0)}else this.extrusions(D,ee,l,this.normal,this.thickness,this.totalDistance-Rt);if(M.push(u+0,u+1,u+2),y){var bn=(0,Ie.Z)([y[0],y[1]]);Sa(Xe,bn)&&Nn.add(bn,Xe,Nn.normalize(bn,Nn.subtract(bn,Xe,it))),Gi(je,bn,Xe);var Gn=yr(Pt,Nn.create(),uo,je,this.thickness),Li=(0,Q.Z)(Gn,2),ti=Li[0],qi=Li[1],za=Nn.dot(Pt,this.normal)<0?-1:1,Ua=fe;if(!Ua&&this.join==="miter"){var di=ti;di>this.miterLimit&&(Ua=!0)}Ua?(ee.push(this.normal[0],this.normal[1],0),ee.push(qi[0],qi[1],0),D.push(d[0],d[1],0,this.totalDistance,-this.thickness*za,0),D.push(d[0],d[1],0,this.totalDistance,this.thickness*za,0),M.push.apply(M,(0,ci.Z)(this.lastFlip!==-za?[u,u+2,u+3]:[u+2,u+1,u+3])),M.push(u+2,u+3,u+4),On(Ws,je),Nn.copy(this.normal,Ws),ee.push(this.normal[0],this.normal[1],0),D.push(d[0],d[1],0,this.totalDistance,-this.thickness*za,0),A+=3):(this.extrusions(D,ee,d,qi,ti,this.totalDistance),M.push.apply(M,(0,ci.Z)(this.lastFlip===1?[u,u+2,u+3]:[u+2,u+1,u+3])),za=-1,Nn.copy(this.normal,qi),A+=2),this.lastFlip=za}else{if(On(this.normal,uo),X){var jr=Nn.create(),dn=Nn.create();Nn.sub(dn,uo,this.normal),Nn.add(jr,uo,this.normal),ee.push(dn[0],dn[1],0),ee.push(jr[0],jr[1],0),D.push(d[0],d[1],0,this.totalDistance,this.thickness,0),D.push(d[0],d[1],0,this.totalDistance,this.thickness,0)}else this.extrusions(D,ee,d,this.normal,this.thickness,this.totalDistance);M.push.apply(M,(0,ci.Z)(this.lastFlip===1?[u,u+2,u+3]:[u+2,u+1,u+3])),A+=2}return A}},{key:"extrusions",value:function(o,u,l,d,y,A){u.push(d[0],d[1],0),u.push(d[0],d[1],0),o.push(l[0],l[1],0,A,-y,0),o.push(l[0],l[1],0,A,y,0)}},{key:"lineSegmentDistance",value:function(o,u){var l=u[0]-o[0],d=u[1]-o[1];return Math.sqrt(l*l+d*d)}}]),i}(),Da=x(81763),Do=x.n(Da);function Co(i){if(Do()(i[0]))return i;if(Do()(i[0][0]))throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8");if(Do()(i[0][0][0])){var f=i,o=0,u=0,l=0;return f.forEach(function(d){d.forEach(function(y){o+=y[0],u+=y[1],l++})}),[o/l,u/l,0]}else throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8")}var bi=x(77160);function Yu(i){var f=i[0][0],o=i[0][i[0].length-1];f[0]===o[0]&&f[1]===o[1]&&(i[0]=i[0].slice(0,i[0].length-1));for(var u=i[0].length,l=ba().flatten(i),d=l.vertices,y=l.dimensions,A=[],M=[],D=0;D<d.length/y;D++)y===2?A.push(d[D*2],d[D*2+1],1):A.push(d[D*3],d[D*3+1],1);var ee=ba()(l.vertices,l.holes,l.dimensions);M.push.apply(M,(0,ci.Z)(ee));for(var X=function(it){var Rt=l.vertices.slice(it*y,(it+1)*y),xr=l.vertices.slice((it+1)*y,(it+2)*y);xr.length===0&&(xr=l.vertices.slice(0,y));var Tr=A.length/3;A.push(Rt[0],Rt[1],1,xr[0],xr[1],1,Rt[0],Rt[1],0,xr[0],xr[1],0),M.push.apply(M,(0,ci.Z)([0,2,1,2,3,1].map(function(jr){return jr+Tr})))},fe=0;fe<u;fe++)X(fe);return{positions:A,index:M}}function lu(i){var f=ba().flatten(i),o=ba()(f.vertices,f.holes,f.dimensions);return{positions:f.vertices,index:o}}function Yo(i){var f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,o=i[0][0],u=i[0][i[0].length-1];o[0]===u[0]&&o[1]===u[1]&&(i[0]=i[0].slice(0,i[0].length-1));for(var l=i[0].length,d=ba().flatten(i),y=d.vertices,A=d.dimensions,M=[],D=[],ee=[],X=0;X<y.length/A;X++)A===2?M.push(y[X*2],y[X*2+1],1,-1,-1):M.push(y[X*3],y[X*3+1],1,-1,-1),ee.push(0,0,1);var fe=ba()(d.vertices,d.holes,d.dimensions);D.push.apply(D,(0,ci.Z)(fe));for(var Xe=function(xr){var Tr=d.vertices.slice(xr*A,(xr+1)*A),jr=d.vertices.slice((xr+1)*A,(xr+2)*A);jr.length===0&&(jr=d.vertices.slice(0,A));var dn=M.length/5;M.push(Tr[0],Tr[1],1,0,0,jr[0],jr[1],1,.1,0,Tr[0],Tr[1],0,0,.8,jr[0],jr[1],0,.1,.8);var bn=ll([jr[0],jr[1],1],[Tr[0],Tr[1],0],[Tr[0],Tr[1],1],f);ee.push.apply(ee,(0,ci.Z)(bn).concat((0,ci.Z)(bn),(0,ci.Z)(bn),(0,ci.Z)(bn))),D.push.apply(D,(0,ci.Z)([1,2,0,3,2,1].map(function(Gn){return Gn+dn})))},it=0;it<l;it++)Xe(it);return{positions:M,index:D,normals:ee}}function ll(i,f,o){var u=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,l=bi.create(),d=bi.create(),y=bi.create();u&&(i=(0,Ie.vP)(i),f=(0,Ie.vP)(f),o=(0,Ie.vP)(o));var A=bi.fromValues.apply(bi,(0,ci.Z)(i)),M=bi.fromValues.apply(bi,(0,ci.Z)(f)),D=bi.fromValues.apply(bi,(0,ci.Z)(o));bi.sub(l,D,M),bi.sub(d,A,M),bi.cross(y,l,d);var ee=bi.create();return bi.normalize(ee,y),ee}var bo,bs;(function(i){i.CYLINDER="cylinder",i.SQUARECOLUMN="squareColumn",i.TRIANGLECOLUMN="triangleColumn",i.HEXAGONCOLUMN="hexagonColumn",i.PENTAGONCOLUMN="pentagonColumn"})(bs||(bs={}));var Po;(function(i){i.CIRCLE="circle",i.SQUARE="square",i.TRIANGLE="triangle",i.HEXAGON="hexagon",i.PENTAGON="pentagon"})(Po||(Po={}));function cu(i){for(var f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,o=Math.PI*2/i,u=[],l=0;l<i;l++)u.push(o*l+f*Math.PI/12);var d=u.map(function(y){var A=Math.sin(y+Math.PI/4),M=Math.cos(y+Math.PI/4);return[A,M,0]});return d}function Ms(){return cu(30)}function uc(){return cu(4)}function Kc(){return cu(3)}function Aa(){return cu(6,1)}function gf(){return cu(5)}var ku=(bo={},(0,F.Z)(bo,Po.CIRCLE,Ms),(0,F.Z)(bo,Po.HEXAGON,Aa),(0,F.Z)(bo,Po.TRIANGLE,Kc),(0,F.Z)(bo,Po.SQUARE,uc),(0,F.Z)(bo,Po.PENTAGON,gf),(0,F.Z)(bo,bs.CYLINDER,Ms),(0,F.Z)(bo,bs.HEXAGONCOLUMN,Aa),(0,F.Z)(bo,bs.TRIANGLECOLUMN,Kc),(0,F.Z)(bo,bs.SQUARECOLUMN,uc),(0,F.Z)(bo,bs.PENTAGONCOLUMN,gf),bo),Ml={};function Ic(i){var f=Co(i.coordinates);return{vertices:[].concat((0,ci.Z)(f),(0,ci.Z)(f),(0,ci.Z)(f),(0,ci.Z)(f)),indices:[0,1,2,2,3,0],size:f.length}}function lc(i){var f=i.shape,o=Oc(f,!1),u=o.positions,l=o.index,d=o.normals;return{vertices:u,indices:l,normals:d,size:5}}function eo(i){var f=Co(i.coordinates);return{vertices:(0,ci.Z)(f),indices:[0],size:f.length}}function cl(i){var f=i.coordinates,o=i.originCoordinates,u=i.version,l=new ra({dash:!0,join:"bevel"});if(u==="GAODE2.x"){var d=f;Array.isArray(d[0][0])||(d=[f]);var y=o;Array.isArray(y[0][0])||(y=[o]);for(var A=0;A<d.length;A++){var M=d[A],D=y[A];l.extrude_gaode2(M,D)}}else{var ee=f;Array.isArray(ee[0][0])||(ee=[f]),ee.forEach(function(fe){l.extrude(fe)})}var X=l.complex;return{vertices:X.positions,indices:X.indices,normals:X.normals,size:6}}function fl(i){var f=i.coordinates,o=ba().flatten(f),u=o.vertices,l=o.dimensions,d=o.holes;return{indices:ba()(u,d,l),vertices:u,size:l}}function ns(i){var f=i.coordinates,o=Yo(f,!0),u=o.positions,l=o.index,d=o.normals;return{vertices:u,indices:l,normals:d,size:5}}function cc(i){var f=i.shape,o=hl(f),u=o.positions,l=o.index;return{vertices:u,indices:l,size:3}}function Ku(i){var f=i.coordinates,o=[].concat((0,ci.Z)(f[0]),[0,0,1,f[1][0],f[0][1],0,1,1],(0,ci.Z)(f[1]),[0,1,0],(0,ci.Z)(f[0]),[0,0,1],(0,ci.Z)(f[1]),[0,1,0,f[0][0],f[1][1],0,0,0]),u=[0,1,2,3,4,5];return{vertices:o,indices:u,size:5}}function Xs(i){for(var f=30,o=i.coordinates,u=[],l=[],d=function(M){u.push(M,1,M,o[0][0],o[0][1],o[1][0],o[1][1],M,-1,M,o[0][0],o[0][1],o[1][0],o[1][1]),M!==f-1&&l.push.apply(l,(0,ci.Z)([0,1,2,1,3,2].map(function(D){return M*2+D})))},y=0;y<f;y++)d(y);return{vertices:u,indices:l,size:7}}function Ko(i){var f=i.coordinates;f.length===2&&f.push(0);var o=i.size,u=Ea(-1,1),l=Ea(1,1),d=Ea(-1,-1),y=Ea(1,-1),A=[].concat((0,ci.Z)(f),(0,ci.Z)(u),(0,ci.Z)(f),(0,ci.Z)(d),(0,ci.Z)(f),(0,ci.Z)(y),(0,ci.Z)(f),(0,ci.Z)(l)),M=[0,1,2,3,0,2];return{vertices:A,indices:M,size:5}}function Oc(i){var f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(Ml&&Ml[i])return Ml[i];var o=ku[i]?ku[i]():ku.cylinder(),u=Yo([o],f);return Ml[i]=u,u}function bu(i,f){for(var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,u=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,l=new Float32Array(i.length/o*3),d,y,A,M=vec3.create(),D=vec3.create(),ee=vec3.create(),X=0,fe=f.length;X<fe;X+=3){d=f[X+0]*3,y=f[X+1]*3,A=f[X+2]*3;var Xe=[i[d],i[d+1]],it=[i[y],i[y+1]],Rt=[i[A],i[A+1]];u&&(Xe=lngLatToMeters(Xe),it=lngLatToMeters(it),Rt=lngLatToMeters(Rt));var xr=Xe,Tr=_slicedToArray(xr,2),jr=Tr[0],dn=Tr[1],bn=vec3.fromValues(jr,dn,i[d+2]),Gn=it,Li=_slicedToArray(Gn,2),ti=Li[0],qi=Li[1],za=vec3.fromValues(ti,qi,i[y+2]),Ua=Rt,di=_slicedToArray(Ua,2),Ca=di[0],ao=di[1],Wu=vec3.fromValues(Ca,ao,i[A+2]);vec3.sub(M,Wu,za),vec3.sub(D,bn,za),vec3.cross(ee,M,D),l[d]+=M[0],l[d+1]+=M[1],l[d+2]+=M[2],l[y]+=M[0],l[y+1]+=M[1],l[y+2]+=M[2],l[A]+=M[0],l[A+1]+=M[1],l[A+2]+=M[2]}return $u(l),l}function $u(i){for(var f=0,o=i.length;f<o;f+=3){var u=vec3.fromValues(i[f],i[f+1],i[f+2]),l=vec3.create();vec3.normalize(l,u),i.set(l,f)}}function Of(i){var f=i[0][0],o=i[0][i[0].length-1];return f[0]===o[0]&&f[1]===o[1]}function hl(i){var f=["cylinder","triangleColumn","hexagonColumn","squareColumn"],o=ku[i]?ku[i]():ku.circle(),u=f.indexOf(i)===-1?lu([o]):Yu([o]);return u}function Ea(i,f){var o=(i+1)/2,u=(f+1)/2;return[o,u]}function Ju(i){var f=Xl();return function(){var u=(0,we.Z)(i),l;if(f){var d=(0,we.Z)(this).constructor;l=Reflect.construct(u,arguments,d)}else l=u.apply(this,arguments);return(0,be.Z)(this,l)}}function Xl(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var Yl=`uniform float u_opacity: 1.0;
uniform vec4 u_baseColor : [ 1.0, 0, 0, 1.0 ];
uniform vec4 u_brightColor : [ 1.0, 0, 0, 1.0 ];
uniform vec4 u_windowColor : [ 1.0, 0, 0, 1.0 ];
uniform float u_near : 0;
uniform float u_far : 1;
varying vec4 v_Color;
varying vec2 v_texCoord;
uniform float u_Zoom : 1;
uniform float u_time;

#pragma include "picking"

vec3 getWindowColor(float n, float hot, vec3 brightColor, vec3 darkColor) {
    float s = step(hot, n);
    vec3 color = mix(brightColor,vec3(0.9,0.9,1.0),n);

    return mix(darkColor, color, s);
}
float random (vec2 st) {
    return fract(sin(dot(st.xy, vec2(12.9898,78.233)))* 43758.5453123);
}

float LinearizeDepth()
{
    float z = gl_FragCoord.z * 2.0 - 1.0;
    return (2.0 * u_near * u_far) / (u_far + u_near - z * (u_far - u_near));
}

vec3 fog(vec3 color, vec3 fogColor, float depth){
    float fogFactor=clamp(depth,0.0,1.0);
    vec3 output_color=mix(fogColor,color,fogFactor);
    return output_color;
}

float sdRect(vec2 p, vec2 sz) {
  vec2 d = abs(p) - sz;
  float outside = length(max(d, 0.));
  float inside = min(max(d.x, d.y), 0.);
  return outside + inside;
}

void main() {
  gl_FragColor = v_Color;
  vec3 baseColor = u_baseColor.xyz;
  vec3 brightColor = u_brightColor.xyz;
  vec3 windowColor = u_windowColor.xyz;
  float targetColId = 5.;
  float depth = 1.0 - LinearizeDepth() / u_far * u_Zoom;
  vec3 fogColor = vec3(23.0/255.0,31.0/255.0,51.0/255.0);
  if(v_texCoord.x < 0.) { //\u9876\u90E8\u989C\u8272
       vec3 foggedColor = fog(baseColor.xyz + vec3(0.12*0.9,0.2*0.9,0.3*0.9),fogColor,depth);
       gl_FragColor = vec4( foggedColor, v_Color.w);
  }else { // \u4FA7\u9762\u989C\u8272
        vec2 st = v_texCoord;
        vec2  UvScale = v_texCoord;
        float tStep = min(0.08,max(0.05* (18.0-u_Zoom),0.02));
        float tStart = 0.25 * tStep;
        float tEnd = 0.75 * tStep;
        float u = mod(UvScale.x, tStep);
        float v = mod(UvScale.y, tStep);
        float ux = floor(UvScale.x/tStep);
        float uy = floor(UvScale.y/tStep);
        float n = random(vec2(ux,uy));
        float lightP = u_time;
        float head = 1.0- step(0.005,st.y);
        /*step3*/
        // \u5C06\u7A97\u6237\u989C\u8272\u548C\u5899\u9762\u989C\u8272\u533A\u522B\u5F00\u6765
        float sU = step(tStart, u) - step(tEnd, u);
        float sV = step(tStart, v) - step(tEnd, v);
        vec2 windowSize = vec2(abs(tEnd-tStart),abs(tEnd-tStart));
        float dist = sdRect(vec2(u,v), windowSize);
        float s = sU * sV;

        float curColId = floor(UvScale.x / tStep);
        float sCol = step(targetColId - 0.2, curColId) - step(targetColId + 0.2, curColId);

        float mLightP = mod(lightP, 2.);
        float sRow = step(mLightP - 0.2, st.y) - step(mLightP, st.y);
        if(ux == targetColId){
            n =0.;
        }
        float timeP = min(0.75, abs ( sin(u_time/3.0) ) );
        float hot = smoothstep(1.0,0.0,timeP);
        vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), s);
        //vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), 1.0);
        float sFinal = s * sCol * sRow;
        color += mix(baseColor, brightColor, sFinal*n);
        if (st.y<0.01){
        color = baseColor;
         }
        if(head ==1.0) { // \u9876\u90E8\u4EAE\u7EBF
            color = brightColor;
        }
        color = color * v_Color.rgb;

        vec3 foggedColor = fog(color,fogColor,depth);

        gl_FragColor = vec4(foggedColor,1.0);
  }
  gl_FragColor.a *= u_opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,Ys=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
uniform mat4 u_ModelMatrix;

attribute vec2 a_Uv;
varying vec2 v_texCoord;

varying vec4 v_Color;
uniform mat4 u_Mvp;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);
   v_texCoord = a_Uv;
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  setPickingColor(a_PickingColor);
}
`,Lc=function(i){(0,ne.Z)(o,i);var f=Ju(o);function o(){return(0,Y.Z)(this,o),f.apply(this,arguments)}return(0,le.Z)(o,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,y=d===void 0?1:d,A=l.baseColor,M=A===void 0?"rgb(16,16,16)":A,D=l.brightColor,ee=D===void 0?"rgb(255,176,38)":D,X=l.windowColor,fe=X===void 0?"rgb(30,60,89)":X,Xe=l.time,it=Xe===void 0?0:Xe;return{u_opacity:y,u_baseColor:(0,Ie.CI)(M),u_brightColor:(0,Ie.CI)(ee),u_windowColor:(0,Ie.CI)(fe),u_time:this.layer.getLayerAnimateTime()||it}}},{key:"initModels",value:function(){return this.startModelAnimate(),[this.layer.buildLayerModel({moduleName:"cityBuilding",vertexShader:Ys,fragmentShader:Yl,triangulation:ns})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"normal",type:w.AttributeType.Attribute,descriptor:{name:"a_Normal",buffer:{usage:w.gl.STATIC_DRAW,data:[],type:w.gl.FLOAT},size:3,update:function(d,y,A,M,D){return D}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:w.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:w.gl.DYNAMIC_DRAW,data:[],type:w.gl.FLOAT},size:1,update:function(d,y,A,M){var D=d.size,ee=D===void 0?10:D;return Array.isArray(ee)?[ee[0]]:[ee]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:w.AttributeType.Attribute,descriptor:{name:"a_Uv",buffer:{usage:w.gl.DYNAMIC_DRAW,data:[],type:w.gl.FLOAT},size:2,update:function(d,y,A,M){var D=d.size;return[A[3],A[4]]}}})}}]),o}(Ra);function Kl(i){var f=$l();return function(){var u=(0,we.Z)(i),l;if(f){var d=(0,we.Z)(this).constructor;l=Reflect.construct(u,arguments,d)}else l=u.apply(this,arguments);return(0,be.Z)(this,l)}}function $l(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var Qu=function(i){(0,ne.Z)(o,i);var f=Kl(o);function o(){var u;(0,Y.Z)(this,o);for(var l=arguments.length,d=new Array(l),y=0;y<l;y++)d[y]=arguments[y];return u=f.call.apply(f,[this].concat(d)),u.type="PolygonLayer",u}return(0,le.Z)(o,[{key:"buildModels",value:function(){this.layerModel=new Lc(this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"setLight",value:function(l){this.updateLayerConfig({time:l})}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){return"citybuilding"}}]),o}(xs);function Su(i){var f=Il();return function(){var u=(0,we.Z)(i),l;if(f){var d=(0,we.Z)(this).constructor;l=Reflect.construct(u,arguments,d)}else l=u.apply(this,arguments);return(0,be.Z)(this,l)}}function Il(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var Ol=`precision highp float;\r
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807\r
attribute vec3 a_Position;\r
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807\r
attribute vec3 a_Pos;\r
attribute float a_Size;\r
attribute vec4 a_Color;\r
uniform vec2 u_radius;\r
uniform float u_coverage: 0.9;\r
uniform float u_angle: 0;\r
uniform mat4 u_ModelMatrix;\r
uniform mat4 u_Mvp;\r
varying vec4 v_color;\r
\r
uniform vec2 u_SceneCenterMKT;\r
\r
#pragma include "projection"\r
#pragma include "project"\r
#pragma include "picking"\r
\r
void main() {\r
  v_color = a_Color;\r
\r
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));\r
  vec2 offset = a_Position.xy * u_radius * rotationMatrix * u_coverage ;\r
  // vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r
  // gl_Position = project_common_position_to_clipspace(project_pos);\r
\r
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\r
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT; // \u5C06\u7ECF\u7EAC\u5EA6\u8F6C\u6362\u4E3A\u9AD8\u5FB72.0\u9700\u8981\u7684\u5E73\u9762\u5750\u6807\r
    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));\r
    gl_Position = u_Mvp * (project_pos);\r
  } else {\r
     vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r
    gl_Position = project_common_position_to_clipspace(project_pos);\r
  }\r
\r
  setPickingColor(a_PickingColor);\r
}\r
`,pl=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,Rc=function(i){(0,ne.Z)(o,i);var f=Su(o);function o(){return(0,Y.Z)(this,o),f.apply(this,arguments)}return(0,le.Z)(o,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,y=l.coverage,A=l.angle;return{u_opacity:d||1,u_coverage:y||.9,u_angle:A||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"gridheatmap",vertexShader:Ol,fragmentShader:pl,triangulation:cc,depth:{enable:!1},primitive:w.gl.TRIANGLES,blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:w.AttributeType.Attribute,descriptor:{name:"a_Pos",buffer:{usage:w.gl.DYNAMIC_DRAW,data:[],type:w.gl.FLOAT},size:3,update:function(d,y){var A=d.version==="GAODE2.x"?d.originCoordinates:d.coordinates;return[A[0],A[1],0]}}})}}]),o}(Ra);function dl(i){var f=Ks();return function(){var u=(0,we.Z)(i),l;if(f){var d=(0,we.Z)(this).constructor;l=Reflect.construct(u,arguments,d)}else l=u.apply(this,arguments);return(0,be.Z)(this,l)}}function Ks(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var Ll=`precision highp float;
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807
attribute vec3 a_Position;
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807
attribute vec3 a_Pos;

attribute vec3 a_Normal;
attribute float a_Size;
attribute vec4 a_Color;
uniform vec2 u_radius;
uniform float u_coverage: 0.9;
uniform float u_angle: 0;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform vec2 u_SceneCenterMKT;

#pragma include "projection"
#pragma include "project"
#pragma include "light"
#pragma include "picking"


void main() {
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));
  // vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u5B9E\u9645\u7684\u7ECF\u7EAC\u5EA6
  // vec2 lnglat = (a_Pos.xy + offset); 
  // vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));
  // gl_Position = project_common_position_to_clipspace(project_pos);
  // float lightWeight = calc_lighting(project_pos);
  // v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // vec2 lnglat = (a_Pos.xy + offset); 
    // vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));

    // float lightWeight = calc_lighting(project_pos);
    // v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
  
    // gl_Position = u_Mvp * vec4(lnglat , a_Position.z * a_Size, 1.0);
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u7ECF\u7EAC\u5EA6
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT; // \u5C06\u7ECF\u7EAC\u5EA6\u8F6C\u6362\u4E3A\u9AD8\u5FB72.0\u9700\u8981\u7684\u5E73\u9762\u5750\u6807
    vec4 project_pos = project_position(vec4(customLnglat, a_Position.z * a_Size, 1.0));

    float lightWeight = calc_lighting(project_pos);
    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
  
    gl_Position = u_Mvp * vec4(customLnglat , a_Position.z * a_Size, 1.0);
  } else {
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u5B9E\u9645\u7684\u7ECF\u7EAC\u5EA6
    vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));
    
    float lightWeight = calc_lighting(project_pos);
    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
    
    gl_Position = project_common_position_to_clipspace(project_pos);
  }



  setPickingColor(a_PickingColor);
}
`,$c=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,Jc=function(i){(0,ne.Z)(o,i);var f=dl(o);function o(){return(0,Y.Z)(this,o),f.apply(this,arguments)}return(0,le.Z)(o,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,y=l.coverage,A=l.angle;return{u_opacity:d||1,u_coverage:y||1,u_angle:A||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"grid3dheatmap",vertexShader:Ll,fragmentShader:$c,triangulation:lc,depth:{enable:!0},blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:w.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:w.gl.DYNAMIC_DRAW,data:[],type:w.gl.FLOAT},size:1,update:function(d,y,A,M){var D=d.size;return Array.isArray(D)?[D[0]]:[D]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:w.AttributeType.Attribute,descriptor:{name:"a_Normal",buffer:{usage:w.gl.STATIC_DRAW,data:[],type:w.gl.FLOAT},size:3,update:function(d,y,A,M,D){return D}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:w.AttributeType.Attribute,descriptor:{name:"a_Pos",buffer:{usage:w.gl.DYNAMIC_DRAW,data:[],type:w.gl.FLOAT},size:3,update:function(d,y){var A=d.version==="GAODE2.x"?d.originCoordinates:d.coordinates;return[A[0],A[1],0]}}})}}]),o}(Ra),ma=x(85975);function Jl(i,f){for(var o=[],u=[],l=[],d=i+1,y=f+1,A=i/2,M=f/2,D=0;D<y;D++)for(var ee=D-M,X=0;X<d;X++){var fe=X-A;u.push(fe/A,-ee/M,0),l.push(X/i),l.push(1-D/f)}for(var Xe=0;Xe<f;Xe++)for(var it=0;it<i;it++){var Rt=it+d*Xe,xr=it+d*(Xe+1),Tr=it+1+d*(Xe+1),jr=it+1+d*Xe;o.push(Rt,xr,jr),o.push(xr,Tr,jr)}return{vertices:u,indices:o,uvs:l}}var fc,qu,Rl;function hc(i,f){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(i);f&&(u=u.filter(function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable})),o.push.apply(o,u)}return o}function Fu(i){for(var f=1;f<arguments.length;f++){var o=arguments[f]!=null?arguments[f]:{};f%2?hc(Object(o),!0).forEach(function(u){(0,F.Z)(i,u,o[u])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):hc(Object(o)).forEach(function(u){Object.defineProperty(i,u,Object.getOwnPropertyDescriptor(o,u))})}return i}function Dc(i){var f=Qc();return function(){var u=(0,we.Z)(i),l;if(f){var d=(0,we.Z)(this).constructor;l=Reflect.construct(u,arguments,d)}else l=u.apply(this,arguments);return(0,be.Z)(this,l)}}function Qc(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var qc=`uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_opacity;
varying vec2 v_texCoord;
varying float v_intensity;

void main(){
   
     float intensity = texture2D(u_texture, v_texCoord).r;
    vec4 color = texture2D(u_colorTexture,vec2(intensity, 0));
    gl_FragColor = color;
    // gl_FragColor.a = color.a * smoothstep(0.1,0.2,intensity)* u_opacity;
     gl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;
}
`,Dl=`precision highp float;
attribute vec3 a_Position;
attribute vec2 a_Uv;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
uniform mat4 u_ModelMatrix;
uniform mat4 u_InverseViewProjectionMatrix;
uniform mat4 u_ViewProjectionMatrixUncentered;
varying float v_intensity;


vec2 toBezier(float t, vec2 P0, vec2 P1, vec2 P2, vec2 P3) {
    float t2 = t * t;
    float one_minus_t = 1.0 - t;
    float one_minus_t2 = one_minus_t * one_minus_t;
    return (P0 * one_minus_t2 * one_minus_t + P1 * 3.0 * t * one_minus_t2 + P2 * 3.0 * t2 * one_minus_t + P3 * t2 * t);
}
vec2 toBezier(float t, vec4 p){
    return toBezier(t, vec2(0.0, 0.0), vec2(p.x, p.y), vec2(p.z, p.w), vec2(1.0, 1.0));
}
#pragma include "projection"
void main() {
  v_texCoord = a_Uv;

  vec2 pos = a_Uv * vec2(2.0) - vec2(1.0); // \u5C06\u539F\u672C 0 -> 1 \u7684 uv \u8F6C\u6362\u4E3A -1 -> 1 \u7684\u6807\u51C6\u5750\u6807\u7A7A\u95F4\uFF08NDC\uFF09

  vec4 p1 = vec4(pos, 0.0, 1.0); // x/y \u5E73\u9762\u4E0A\u7684\u70B9\uFF08z == 0\uFF09\u53EF\u4EE5\u8BA4\u4E3A\u662F\u4E09\u7EF4\u4E0A\u7684\u70B9\u88AB\u6295\u5F71\u5230\u5E73\u9762\u540E\u7684\u70B9
	vec4 p2 = vec4(pos, 1.0, 1.0); // \u5E73\u884C\u4E8Ex/y\u5E73\u9762\u3001z==1 \u7684\u5E73\u9762\u4E0A\u7684\u70B9

	vec4 inverseP1 = u_InverseViewProjectionMatrix * p1; // \u6839\u636E\u89C6\u56FE\u6295\u5F71\u77E9\u9635\u7684\u9006\u77E9\u9635\u5E73\u9762\u4E0A\u7684\u53CD\u7B97\u51FA\u4E09\u7EF4\u7A7A\u95F4\u4E2D\u7684\u70B9\uFF08p1\u5E73\u9762\u4E0A\u7684\u70B9\uFF09
	vec4 inverseP2 = u_InverseViewProjectionMatrix * p2;

  inverseP1 = inverseP1 / inverseP1.w; // \u5F52\u4E00\u5316\u64CD\u4F5C\uFF08\u5F52\u4E00\u5316\u540E\u4E3A\u4E16\u754C\u5750\u6807\uFF09
	inverseP2 = inverseP2 / inverseP2.w;

	float zPos = (0.0 - inverseP1.z) / (inverseP2.z - inverseP1.z); // ??
	vec4 position = inverseP1 + zPos * (inverseP2 - inverseP1);

  vec4 b= vec4(0.5000, 0.0, 1.0, 0.5000);
  float fh;

  v_intensity = texture2D(u_texture, v_texCoord).r;
  fh = toBezier(v_intensity, b).y;
  gl_Position = u_ViewProjectionMatrixUncentered * vec4(position.xy, fh * project_pixel(50.), 1.0);
 
}
`,kc=`uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_opacity;
varying vec2 v_texCoord;
varying float v_intensity;

void main(){
     float intensity = texture2D(u_texture, v_texCoord).r;
    vec4 color = texture2D(u_colorTexture,vec2(intensity, 0));
    gl_FragColor =color;
    gl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;

}
`,Fc=`precision highp float;
uniform float u_intensity;
varying float v_weight;
varying vec2 v_extrude;
#define GAUSS_COEF  0.3989422804014327
void main(){
    float d = -0.5 * 3.0 * 3.0 * dot(v_extrude, v_extrude);
    float val = v_weight * u_intensity * GAUSS_COEF * exp(d);
    gl_FragColor = vec4(val, 1., 1., 1.);
}
`,zc=`precision highp float;
attribute vec3 a_Position;
attribute float a_Size;
attribute vec2 a_Dir;
uniform float u_intensity;
uniform float u_radius;
varying vec2 v_extrude;
varying float v_weight;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

#define GAUSS_COEF  0.3989422804014327

#pragma include "projection"

void main(){
    v_weight = a_Size;
    float ZERO = 1.0 / 255.0 / 16.0;
    float extrude_x = a_Dir.x * 2.0 -1.0;
    float extrude_y = a_Dir.y * 2.0 -1.0;
    vec2 extrude_dir = normalize(vec2(extrude_x,extrude_y));
    float S = sqrt(-2.0 * log(ZERO / a_Size / u_intensity / GAUSS_COEF)) / 3.0;
    v_extrude = extrude_dir * S;

    vec2 offset = project_pixel(v_extrude * u_radius);
    vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));

    // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
        gl_Position = u_Mvp * (vec4(project_pos.xy + offset, 0.0, 1.0));
    } else {
        gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));
    }
}
`,vl=`precision highp float;
attribute vec3 a_Position;
attribute vec2 a_Uv;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
varying float v_intensity;
void main() {
  v_texCoord = a_Uv;
  v_intensity = texture2D(u_texture, v_texCoord).r;
  gl_Position = vec4(a_Position.xy, 0, 1.);
}
`,Nc=(fc=(0,H.b2)(),fc(qu=(Rl=function(i){(0,ne.Z)(o,i);var f=Dc(o);function o(){var u;(0,Y.Z)(this,o);for(var l=arguments.length,d=new Array(l),y=0;y<l;y++)d[y]=arguments[y];return u=f.call.apply(f,[this].concat(d)),u.texture=void 0,u.colorTexture=void 0,u.heatmapFramerBuffer=void 0,u.intensityModel=void 0,u.colorModel=void 0,u.shapeType=void 0,u}return(0,le.Z)(o,[{key:"render",value:function(){var l=this,d=this.rendererService,y=d.clear,A=d.useFramebuffer;A(this.heatmapFramerBuffer,function(){y({color:[0,0,0,0],depth:1,stencil:0,framebuffer:l.heatmapFramerBuffer}),l.drawIntensityMode()}),this.layer.styleNeedUpdate&&this.updateColorTexture(),this.shapeType==="heatmap"?this.drawColorMode():this.draw3DHeatMap()}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:function(){var l,d=this.rendererService,y=d.createFramebuffer,A=d.clear,M=d.getViewportSize,D=d.createTexture2D,ee=d.useFramebuffer,X=this.styleAttributeService.getLayerStyleAttribute("shape"),fe=(X==null||(l=X.scale)===null||l===void 0?void 0:l.field)||"heatmap";this.shapeType=fe,this.intensityModel=this.buildHeatMapIntensity(),this.colorModel=fe==="heatmap"?this.buildHeatmapColor():this.build3dHeatMap();var Xe=this.layer.getLayerConfig(),it=Xe.rampColors,Rt=(0,Ie.Cl)(it),xr=M(),Tr=xr.width,jr=xr.height;return this.heatmapFramerBuffer=y({color:D({width:Math.floor(Tr/4),height:Math.floor(jr/4),wrapS:w.gl.CLAMP_TO_EDGE,wrapT:w.gl.CLAMP_TO_EDGE,min:w.gl.LINEAR,mag:w.gl.LINEAR}),depth:!1}),this.updateColorTexture(),[this.intensityModel,this.colorModel]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"dir",type:w.AttributeType.Attribute,descriptor:{name:"a_Dir",buffer:{usage:w.gl.DYNAMIC_DRAW,data:[],type:w.gl.FLOAT},size:2,update:function(d,y,A,M){return[A[3],A[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:w.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:w.gl.DYNAMIC_DRAW,data:[],type:w.gl.FLOAT},size:1,update:function(d,y,A,M){var D=d.size,ee=D===void 0?1:D;return[ee]}}})}},{key:"buildHeatMapIntensity",value:function(){return this.layer.buildLayerModel({moduleName:"heatmapintensity",vertexShader:zc,fragmentShader:Fc,triangulation:Ko,depth:{enable:!1},blend:{enable:!0,func:{srcRGB:w.gl.ONE,srcAlpha:1,dstRGB:w.gl.ONE,dstAlpha:1}}})}},{key:"buildHeatmapColor",value:function(){this.shaderModuleService.registerModule("heatmapColor",{vs:vl,fs:kc});var l=this.shaderModuleService.getModule("heatmapColor"),d=l.vs,y=l.fs,A=l.uniforms,M=this.rendererService,D=M.createAttribute,ee=M.createElements,X=M.createBuffer,fe=M.createModel;return fe({vs:d,fs:y,attributes:{a_Position:D({buffer:X({data:[-1,1,0,1,1,0,-1,-1,0,1,-1,0],type:w.gl.FLOAT}),size:3}),a_Uv:D({buffer:X({data:[0,1,1,1,0,0,1,0],type:w.gl.FLOAT}),size:2})},uniforms:Fu({},A),depth:{enable:!1},blend:this.getBlend(),count:6,elements:ee({data:[0,2,1,2,3,1],type:w.gl.UNSIGNED_INT,count:6})})}},{key:"drawIntensityMode",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,y=l.intensity,A=y===void 0?10:y,M=l.radius,D=M===void 0?5:M;this.intensityModel.draw({uniforms:{u_opacity:d||1,u_radius:D,u_intensity:A}})}},{key:"drawColorMode",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity;this.colorModel.draw({uniforms:{u_opacity:d||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer}})}},{key:"draw3DHeatMap",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,y=ma.create();ma.invert(y,this.cameraService.getViewProjectionMatrixUncentered()),this.colorModel.draw({uniforms:{u_opacity:d||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer,u_ViewProjectionMatrixUncentered:this.cameraService.getViewProjectionMatrixUncentered(),u_InverseViewProjectionMatrix:(0,ci.Z)(y)}})}},{key:"build3dHeatMap",value:function(){var l=this.rendererService.getViewportSize,d=l(),y=d.width,A=d.height,M=Jl(y/4,A/4);this.shaderModuleService.registerModule("heatmap3dColor",{vs:Dl,fs:qc});var D=this.shaderModuleService.getModule("heatmap3dColor"),ee=D.vs,X=D.fs,fe=D.uniforms,Xe=this.rendererService,it=Xe.createAttribute,Rt=Xe.createElements,xr=Xe.createBuffer,Tr=Xe.createModel;return Tr({vs:ee,fs:X,attributes:{a_Position:it({buffer:xr({data:M.vertices,type:w.gl.FLOAT}),size:3}),a_Uv:it({buffer:xr({data:M.uvs,type:w.gl.FLOAT}),size:2})},primitive:w.gl.TRIANGLES,uniforms:Fu({},fe),depth:{enable:!0},blend:{enable:!0,func:{srcRGB:w.gl.SRC_ALPHA,srcAlpha:1,dstRGB:w.gl.ONE_MINUS_SRC_ALPHA,dstAlpha:1}},elements:Rt({data:M.indices,type:w.gl.UNSIGNED_INT,count:M.indices.length})})}},{key:"updateStyle",value:function(){this.updateColorTexture()}},{key:"updateColorTexture",value:function(){var l=this.rendererService.createTexture2D;this.texture&&this.texture.destroy();var d=this.layer.getLayerConfig(),y=d.rampColors,A=(0,Ie.Cl)(y);this.colorTexture=l({data:new Uint8Array(A.data),width:A.width,height:A.height,wrapS:w.gl.CLAMP_TO_EDGE,wrapT:w.gl.CLAMP_TO_EDGE,min:w.gl.NEAREST,mag:w.gl.NEAREST,flipY:!1})}}]),o}(Ra),Rl))||qu);function zu(i){var f=ka();return function(){var u=(0,we.Z)(i),l;if(f){var d=(0,we.Z)(this).constructor;l=Reflect.construct(u,arguments,d)}else l=u.apply(this,arguments);return(0,be.Z)(this,l)}}function ka(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var Ql=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,Nu=`precision highp float;
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807
attribute vec3 a_Position;
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807
attribute vec3 a_Pos;
attribute float a_Size;
attribute vec4 a_Color;
uniform vec2 u_radius;
uniform float u_coverage: 0.9;
uniform float u_angle: 0;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform vec2 u_SceneCenterMKT;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

void main() {
  v_color = a_Color;
    
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));
  vec2 lnglat = unProjectFlat(a_Pos.xy + offset);
 
  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xy, 0., 1.0));
    // gl_Position = u_Mvp * (vec4(a_Pos.xy + offset, 0., 1.0));
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT;
    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));
    gl_Position = u_Mvp * vec4(project_pos.xy, 0.0, 1.0);
  } else {
    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,el=function(i){(0,ne.Z)(o,i);var f=zu(o);function o(){return(0,Y.Z)(this,o),f.apply(this,arguments)}return(0,le.Z)(o,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,y=l.coverage,A=l.angle;return{u_opacity:d||1,u_coverage:y||.9,u_angle:A||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"hexagonheatmap",vertexShader:Nu,fragmentShader:Ql,triangulation:cc,depth:{enable:!1},primitive:w.gl.TRIANGLES,blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:w.AttributeType.Attribute,descriptor:{name:"a_Pos",buffer:{usage:w.gl.DYNAMIC_DRAW,data:[],type:w.gl.FLOAT},size:3,update:function(d,y){var A=d.version==="GAODE2.x"?d.originCoordinates:d.coordinates;return[A[0],A[1],0]}}})}}]),o}(Ra),Ni={heatmap:Nc,heatmap3d:Nc,grid:Rc,grid3d:Jc,hexagon:el},Pa=Ni;function Ma(i){var f=ql();return function(){var u=(0,we.Z)(i),l;if(f){var d=(0,we.Z)(this).constructor;l=Reflect.construct(u,arguments,d)}else l=u.apply(this,arguments);return(0,be.Z)(this,l)}}function ql(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var kl=function(i){(0,ne.Z)(o,i);var f=Ma(o);function o(){var u;(0,Y.Z)(this,o);for(var l=arguments.length,d=new Array(l),y=0;y<l;y++)d[y]=arguments[y];return u=f.call.apply(f,[this].concat(d)),u.type="HeatMapLayer",u}return(0,le.Z)(o,[{key:"buildModels",value:function(){var l=this.getModelType();this.layerModel=new Pa[l](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"renderModels",value:function(){var l=this,d=this.getModelType();return d==="heatmap"?(this.layerModel&&this.layerModel.render(),this):(this.layerModelNeedUpdate&&(this.models=this.layerModel.buildModels(),this.layerModelNeedUpdate=!1),this.models.forEach(function(y){return y.draw({uniforms:l.layerModel.getUninforms()})}),this)}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){var l,d=this.styleAttributeService.getLayerStyleAttribute("shape"),y=this.getLayerConfig(),A=y.shape3d,M=this.getSource(),D=M.data.type,ee=(d==null||(l=d.scale)===null||l===void 0?void 0:l.field)||"heatmap";return ee==="heatmap"||ee==="heatmap3d"?"heatmap":D==="hexagon"?(A==null?void 0:A.indexOf(ee))===-1?"hexagon":"grid3d":D==="grid"?(A==null?void 0:A.indexOf(ee))===-1?"grid":"grid3d":"heatmap"}}]),o}(xs);function ec(i){var f=yf();return function(){var u=(0,we.Z)(i),l;if(f){var d=(0,we.Z)(this).constructor;l=Reflect.construct(u,arguments,d)}else l=u.apply(this,arguments);return(0,be.Z)(this,l)}}function yf(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var _f=`precision mediump float;
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
void main() {
  vec4 color = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y));
  gl_FragColor = color;
  gl_FragColor.a *= u_opacity;
}
`,Fl=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,Bu=function(i){(0,ne.Z)(o,i);var f=ec(o);function o(){var u;(0,Y.Z)(this,o);for(var l=arguments.length,d=new Array(l),y=0;y<l;y++)d[y]=arguments[y];return u=f.call.apply(f,[this].concat(d)),u.texture=void 0,u}return(0,le.Z)(o,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity;return{u_opacity:d||1,u_texture:this.texture}}},{key:"initModels",value:function(){var l=this,d=this.layer.getSource(),y=this.rendererService.createTexture2D;return this.texture=y({height:0,width:0}),d.data.images.then(function(A){l.texture=y({data:A[0],width:A[0].width,height:A[0].height}),l.layerService.renderLayers()}),[this.layer.buildLayerModel({moduleName:"RasterImage",vertexShader:Fl,fragmentShader:_f,triangulation:Ku,primitive:w.gl.TRIANGLES,depth:{enable:!1},blend:this.getBlend()})]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:w.AttributeType.Attribute,descriptor:{name:"a_Uv",buffer:{usage:w.gl.DYNAMIC_DRAW,data:[],type:w.gl.FLOAT},size:2,update:function(d,y,A,M){return[A[3],A[4]]}}})}}]),o}(Ra),Uu={image:Bu},to=Uu;function ds(i){var f=ml();return function(){var u=(0,we.Z)(i),l;if(f){var d=(0,we.Z)(this).constructor;l=Reflect.construct(u,arguments,d)}else l=u.apply(this,arguments);return(0,be.Z)(this,l)}}function ml(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var lo=function(i){(0,ne.Z)(o,i);var f=ds(o);function o(){var u;(0,Y.Z)(this,o);for(var l=arguments.length,d=new Array(l),y=0;y<l;y++)d[y]=arguments[y];return u=f.call.apply(f,[this].concat(d)),u.type="ImageLayer",u}return(0,le.Z)(o,[{key:"buildModels",value:function(){var l=this.getModelType();this.layerModel=new to[l](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var l=this.getModelType(),d={image:{}};return d[l]}},{key:"getModelType",value:function(){return"image"}}]),o}(xs);function Tn(i){var f=Is();return function(){var u=(0,we.Z)(i),l;if(f){var d=(0,we.Z)(this).constructor;l=Reflect.construct(u,arguments,d)}else l=u.apply(this,arguments);return(0,be.Z)(this,l)}}function Is(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var tc=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
varying vec2 v_normal;
varying vec4 v_dash_array;
varying float v_distance_ratio;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

uniform float segmentNumber;
varying float v_segmentIndex;
varying float v_arcDistrance;
varying float v_pixelLen;
varying float v_a;
varying vec2 v_offset;
varying vec2 v_iconMapUV;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

void main() {
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v_segmentIndex/segmentNumber);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // gl_FragColor = v_color;
  
  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));
  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));
  gl_FragColor.a *= u_opacity;
  if(u_line_type == LineTypeDash) {
   float flag = 0.;
    float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;
  }

  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / segmentNumber));
    // float arcRadio = smoothstep( 0.0, 1.0, v_distance_ratio);
    // float arcRadio = v_segmentIndex / (segmentNumber - 1.0);
    float count = floor(v_arcDistrance/v_pixelLen);

    float u = 1.0 - fract(arcRadio * count + animateSpeed);

    if(u_aimate.x == Animate) {
      u = gl_FragColor.a/u_opacity;
    }
    float v = length(v_offset)/(v_a); // \u6A2A\u5411
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;

    vec4 pattern = texture2D(u_texture, uv);

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= u_opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
    // gl_FragColor = vec4(1.0 - fract(arcRadio * 20000.0), 0.0, 0.0, 1.0);
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, uv));
    // gl_FragColor = filterColor(texture2D(u_texture, uv));
    
  } else {
     gl_FragColor = filterColor(gl_FragColor);
  }
  // gl_FragColor = filterColor(gl_FragColor);

}`,gl=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
varying vec2 v_normal;

varying float v_distance_ratio;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
uniform float u_lineDir: 1.0;
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_segmentIndex;
varying float v_arcDistrance;
varying float v_pixelLen;
varying float v_a;
varying vec2 v_offset;
attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = 0.314;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}
vec2 interpolate (vec2 source, vec2 target, float t) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;
  

  vec2 source = a_Instance.rg;
  vec2 target =  a_Instance.ba;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  if(u_line_type == LineTypeDash) {
      v_distance_ratio = segmentIndex / segmentNumber;
      vec2 s = source;
      vec2 t = target;
      
      if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
        s = unProjCustomCoord(source);
        t = unProjCustomCoord(target);
      }
      float total_Distance = pixelDistance(s, t) / 2.0 * PI;
      // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
      v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
  
  if(u_aimate.x == Animate) {
      v_distance_ratio = segmentIndex / segmentNumber;
      if(u_lineDir != 1.0) {
        v_distance_ratio = 1.0 - v_distance_ratio;
      }
  }

  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio), 0.0, 1.0));
  v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));

  v_segmentIndex = a_Position.x + 1.0;
  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F

    v_arcDistrance = length(source - target);
    v_iconMapUV = a_iconMapUV;
    v_pixelLen = project_pixel(u_icon_step);
    v_a = project_pixel(a_Size);
    v_offset = offset + offset * sign(a_Position.y);
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,$s={solid:0,dash:1},Us=function(i){(0,ne.Z)(o,i);var f=Tn(o);function o(){var u;(0,Y.Z)(this,o);for(var l=arguments.length,d=new Array(l),y=0;y<l;y++)d[y]=arguments[y];return u=f.call.apply(f,[this].concat(d)),u.texture=void 0,u.updateTexture=function(){var A=u.rendererService.createTexture2D;if(u.texture){u.texture.update({data:u.iconService.getCanvas()}),u.layer.render();return}u.texture=A({data:u.iconService.getCanvas(),mag:w.gl.NEAREST,min:w.gl.NEAREST,premultiplyAlpha:!1,width:1024,height:u.iconService.canvasHeight||128})},u}return(0,le.Z)(o,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,y=l.sourceColor,A=l.targetColor,M=l.textureBlend,D=M===void 0?"normal":M,ee=l.lineType,X=ee===void 0?"solid":ee,fe=l.dashArray,Xe=fe===void 0?[10,5]:fe,it=l.forward,Rt=it===void 0?!0:it,xr=l.lineTexture,Tr=xr===void 0?!1:xr,jr=l.iconStep,dn=jr===void 0?100:jr;Xe.length===2&&Xe.push(0,0);var bn=0,Gn=[0,0,0,0],Li=[0,0,0,0];return y&&A&&(Gn=(0,Ie.CI)(y),Li=(0,Ie.CI)(A),bn=1),this.rendererService.getDirty()&&this.texture.bind(),{u_opacity:d===void 0?1:d,u_textureBlend:D==="normal"?0:1,segmentNumber:30,u_line_type:$s[X||"solid"],u_dash_array:Xe,u_blur:.9,u_lineDir:Rt?1:-1,u_texture:this.texture,u_line_texture:Tr?1:0,u_icon_step:dn,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:bn,u_sourceColor:Gn,u_targetColor:Li}}},{key:"getAnimateUniforms",value:function(){var l=this.layer.getLayerConfig(),d=l.animateOption;return{u_aimate:this.animateOption2Array(d),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){this.texture&&this.texture.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"arc2dline",vertexShader:gl,fragmentShader:tc,triangulation:Xs,depth:{enable:!1},blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){var l=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:w.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:w.gl.DYNAMIC_DRAW,data:[],type:w.gl.FLOAT},size:1,update:function(y,A,M,D){var ee=y.size,X=ee===void 0?1:ee;return Array.isArray(X)?[X[0]]:[X]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:w.AttributeType.Attribute,descriptor:{name:"a_Instance",buffer:{usage:w.gl.STATIC_DRAW,data:[],type:w.gl.FLOAT},size:4,update:function(y,A,M,D){return[M[3],M[4],M[5],M[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:w.AttributeType.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:w.gl.DYNAMIC_DRAW,data:[],type:w.gl.FLOAT},size:2,update:function(y,A,M,D){var ee=l.iconService.getIconMap(),X=y.texture,fe=ee[X]||{x:0,y:0},Xe=fe.x,it=fe.y;return[Xe,it]}}})}}]),o}(Ra);function yl(i){var f=Jr();return function(){var u=(0,we.Z)(i),l;if(f){var d=(0,we.Z)(this).constructor;l=Reflect.construct(u,arguments,d)}else l=u.apply(this,arguments);return(0,be.Z)(this,l)}}function Jr(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var Bc=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
varying vec2 v_normal;
varying vec4 v_dash_array;
varying float v_distance_ratio;
varying vec4 v_color;

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
varying float v_segmentIndex;
uniform float segmentNumber;
varying float v_arcDistrance;
varying float v_pixelLen;
varying float v_a;
varying vec2 v_offset;
varying vec2 v_iconMapUV;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

void main() {
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  // gl_FragColor = v_color;

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v_segmentIndex/segmentNumber);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));
  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));
  gl_FragColor.a *= u_opacity;
  if(u_line_type == LineTypeDash) {
   float flag = 0.;
    float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);

      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;
  }

  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    // float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / segmentNumber));
    float arcRadio = v_segmentIndex / (segmentNumber - 1.0);
    float count = floor(v_arcDistrance/v_pixelLen);

    float u = fract(arcRadio * count - animateSpeed * count);
 
    if(u_aimate.x == Animate) {
      u = gl_FragColor.a/u_opacity;
    }
    float v = length(v_offset)/(v_a); // \u6A2A\u5411

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= u_opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
    

    // gl_FragColor = filterColor(gl_FragColor + pattern);

  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }

  // gl_FragColor = filterColor(gl_FragColor);
}
`,pc=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
varying vec2 v_normal;
varying float v_distance_ratio;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_segmentIndex;
varying float v_arcDistrance;
varying float v_pixelLen;
varying float v_a;
varying vec2 v_offset;
attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

   if(u_line_type == LineTypeDash) {
    v_distance_ratio = segmentIndex / segmentNumber;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_aimate.x == Animate) {
      v_distance_ratio = segmentIndex / segmentNumber;
  }

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  
    v_arcDistrance = length(source - target);
    v_pixelLen = project_pixel(u_icon_step);

    vec2 projectOffset = project_pixel(offset);
    v_offset = projectOffset + projectOffset * sign(a_Position.y);
    v_a = project_pixel(a_Size);
    v_iconMapUV = a_iconMapUV;
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,tl={solid:0,dash:1},Js=function(i){(0,ne.Z)(o,i);var f=yl(o);function o(){var u;(0,Y.Z)(this,o);for(var l=arguments.length,d=new Array(l),y=0;y<l;y++)d[y]=arguments[y];return u=f.call.apply(f,[this].concat(d)),u.texture=void 0,u.updateTexture=function(){var A=u.rendererService.createTexture2D;if(u.texture){u.texture.update({data:u.iconService.getCanvas()}),u.layer.render();return}u.texture=A({data:u.iconService.getCanvas(),mag:w.gl.NEAREST,min:w.gl.NEAREST,premultiplyAlpha:!1,width:1024,height:u.iconService.canvasHeight||128})},u}return(0,le.Z)(o,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,y=l.sourceColor,A=l.targetColor,M=l.textureBlend,D=M===void 0?"normal":M,ee=l.lineType,X=ee===void 0?"solid":ee,fe=l.dashArray,Xe=fe===void 0?[10,5]:fe,it=l.lineTexture,Rt=it===void 0?!1:it,xr=l.iconStep,Tr=xr===void 0?100:xr;Xe.length===2&&Xe.push(0,0);var jr=0,dn=[0,0,0,0],bn=[0,0,0,0];return y&&A&&(dn=(0,Ie.CI)(y),bn=(0,Ie.CI)(A),jr=1),this.rendererService.getDirty()&&this.texture.bind(),{u_opacity:d===void 0?1:d,u_textureBlend:D==="normal"?0:1,segmentNumber:30,u_line_type:tl[X]||0,u_dash_array:Xe,u_texture:this.texture,u_line_texture:Rt?1:0,u_icon_step:Tr,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:jr,u_sourceColor:dn,u_targetColor:bn}}},{key:"getAnimateUniforms",value:function(){var l=this.layer.getLayerConfig(),d=l.animateOption;return{u_aimate:this.animateOption2Array(d),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){this.texture&&this.texture.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"arc3Dline",vertexShader:pc,fragmentShader:Bc,triangulation:Xs,blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){var l=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:w.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:w.gl.DYNAMIC_DRAW,data:[],type:w.gl.FLOAT},size:1,update:function(y,A,M,D){var ee=y.size,X=ee===void 0?1:ee;return Array.isArray(X)?[X[0]]:[X]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:w.AttributeType.Attribute,descriptor:{name:"a_Instance",buffer:{usage:w.gl.STATIC_DRAW,data:[],type:w.gl.FLOAT},size:4,update:function(y,A,M,D){return[M[3],M[4],M[5],M[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:w.AttributeType.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:w.gl.DYNAMIC_DRAW,data:[],type:w.gl.FLOAT},size:2,update:function(y,A,M,D){var ee=l.iconService.getIconMap(),X=y.texture,fe=ee[X]||{x:0,y:0},Xe=fe.x,it=fe.y;return[Xe,it]}}})}}]),o}(Ra);function Ss(i){var f=dc();return function(){var u=(0,we.Z)(i),l;if(f){var d=(0,we.Z)(this).constructor;l=Reflect.construct(u,arguments,d)}else l=u.apply(this,arguments);return(0,be.Z)(this,l)}}function dc(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var vc=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
varying vec2 v_normal;
varying vec4 v_dash_array;
varying float v_distance_ratio;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
uniform float segmentNumber;
varying float v_segmentIndex;
varying float v_arcDistrance;
varying float v_pixelLen;
varying vec2 v_offset;
varying float v_a;
varying vec2 v_iconMapUV;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

void main() {
  float animateSpeed = 0.0;
  // gl_FragColor = v_color;
  
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v_segmentIndex/segmentNumber);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));
  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));
  gl_FragColor.a *= u_opacity;
  if(u_line_type == LineTypeDash) {
   float flag = 0.;
    float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
      // float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / (segmentNumber - 1.0)));
      // float alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);
      float alpha =1.0 - fract( mod(1.0- smoothstep(0.0, 1.0, v_distance_ratio), u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      alpha = smoothstep(0., 1., alpha);
      // alpha = clamp(alpha, 0.1, 1.0);
      // if(alpha < 0.01) alpha = 0.0;
      gl_FragColor.a *= alpha;
  }

  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F
    float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / (segmentNumber - 1.0)));
    // float arcRadio = v_segmentIndex / (segmentNumber - 1.0);
    float count = floor(v_arcDistrance/v_pixelLen);
    // float u = fract(arcRadio * count);
    float u = fract(arcRadio * count - animateSpeed * count);
    // float u = fract(arcRadio * count - animateSpeed);
    if(u_aimate.x == Animate) {
      u = gl_FragColor.a;
    }

    float v = length(v_offset)/(v_a); // \u6A2A\u5411

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);
    

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= u_opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
    // gl_FragColor = filterColor(gl_FragColor + pattern);
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }

  // gl_FragColor = filterColor(gl_FragColor);
}`,Os=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
varying vec2 v_normal;

varying float v_distance_ratio;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_segmentIndex;
varying float v_arcDistrance;
varying float v_pixelLen;
varying vec2 v_offset;
varying float v_a;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
    return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
    vec2 x = mix(source, target, ratio);
    vec2 center = mix(source, target, 0.5);
    float dSourceCenter = distance(source, center);
    float dXCenter = distance(x, center);
    return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
     float vertex_height = paraboloid(source, target, segmentRatio);

    return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
    );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size)/ 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}
float getAngularDist (vec2 source, vec2 target) {
  vec2 delta = source - target;
  vec2 sin_half_delta = sin(delta / 2.0);
  float a =
    sin_half_delta.y * sin_half_delta.y +
    cos(source.y) * cos(target.y) *
    sin_half_delta.x * sin_half_delta.x;
  return 2.0 * atan(sqrt(a), sqrt(1.0 - a));
}

vec2 midPoint(vec2 source, vec2 target) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = 0.314;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  return mid;
}
float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}

vec2 interpolate (vec2 source, vec2 target, float angularDist, float t) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    vec2 mid = midPoint(source, target);
    vec3 x = vec3(source.x, mid.x, target.x);
    vec3 y = vec3(source.y, mid.y, target.y);
    return vec2(bezier3(x ,t), bezier3(y,t));
  }else {
    if(abs(angularDist - PI) < 0.001) {
      return (1.0 - t) * source + t * target;
    }
    float a = sin((1.0 - t) * angularDist) / sin(angularDist);
    float b = sin(t * angularDist) / sin(angularDist);
    vec2 sin_source = sin(source);
    vec2 cos_source = cos(source);
    vec2 sin_target = sin(target);
    vec2 cos_target = cos(target);
    float x = a * cos_source.y * cos_source.x + b * cos_target.y * cos_target.x;
    float y = a * cos_source.y * sin_source.x + b * cos_target.y * sin_target.x;
    float z = a * sin_source.y + b * sin_target.y;
    return vec2(atan(y, x), atan(z, sqrt(x * x + y * y)));
  }
}

void main() {
  v_color = a_Color;
  vec2 source = radians(a_Instance.rg);
  vec2 target = radians(a_Instance.ba);
  float angularDist = getAngularDist(source, target);
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  if(u_line_type == LineTypeDash) {
    v_distance_ratio = segmentIndex / segmentNumber;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    total_Distance = total_Distance*8.0;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba);
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
  if(u_aimate.x == Animate) {
      v_distance_ratio = segmentIndex / segmentNumber;
  }
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  v_distance_ratio = segmentIndex / segmentNumber;
  vec4 curr = project_position(vec4(degrees(interpolate(source, target, angularDist, segmentRatio)), 0.0, 1.0));
  vec4 next = project_position(vec4(degrees(interpolate(source, target, angularDist, nextSegmentRatio)), 0.0, 1.0));
  v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));
  //  vec4 project_pos = project_position(vec4(curr.xy, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));

  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  
    v_arcDistrance = length(source - target);
    v_pixelLen = project_pixel(u_icon_step)/8.0;

    v_a = project_pixel(a_Size);
    v_offset = offset + offset * sign(a_Position.y);
    v_iconMapUV = a_iconMapUV;
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + offset, curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));
  }
  setPickingColor(a_PickingColor);
}

`,ju={solid:0,dash:1},_l=function(i){(0,ne.Z)(o,i);var f=Ss(o);function o(){var u;(0,Y.Z)(this,o);for(var l=arguments.length,d=new Array(l),y=0;y<l;y++)d[y]=arguments[y];return u=f.call.apply(f,[this].concat(d)),u.texture=void 0,u.updateTexture=function(){var A=u.rendererService.createTexture2D;if(u.texture){u.texture.update({data:u.iconService.getCanvas()}),u.layer.render();return}u.texture=A({data:u.iconService.getCanvas(),mag:w.gl.NEAREST,min:w.gl.NEAREST,premultiplyAlpha:!1,width:1024,height:u.iconService.canvasHeight||128})},u}return(0,le.Z)(o,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,y=l.sourceColor,A=l.targetColor,M=l.textureBlend,D=M===void 0?"normal":M,ee=l.lineType,X=ee===void 0?"solid":ee,fe=l.dashArray,Xe=fe===void 0?[10,5]:fe,it=l.lineTexture,Rt=it===void 0?!1:it,xr=l.iconStep,Tr=xr===void 0?100:xr;Xe.length===2&&Xe.push(0,0),this.rendererService.getDirty()&&this.texture.bind();var jr=0,dn=[0,0,0,0],bn=[0,0,0,0];return y&&A&&(dn=(0,Ie.CI)(y),bn=(0,Ie.CI)(A),jr=1),{u_opacity:d===void 0?1:d,u_textureBlend:D==="normal"?0:1,segmentNumber:30,u_line_type:ju[X]||0,u_dash_array:Xe,u_texture:this.texture,u_line_texture:Rt?1:0,u_icon_step:Tr,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:jr,u_sourceColor:dn,u_targetColor:bn}}},{key:"getAnimateUniforms",value:function(){var l=this.layer.getLayerConfig(),d=l.animateOption;return{u_aimate:this.animateOption2Array(d),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){this.texture&&this.texture.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"arc2dline",vertexShader:Os,fragmentShader:vc,triangulation:Xs,depth:{enable:!1},blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){var l=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:w.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:w.gl.DYNAMIC_DRAW,data:[],type:w.gl.FLOAT},size:1,update:function(y,A,M,D){var ee=y.size,X=ee===void 0?1:ee;return Array.isArray(X)?[X[0]]:[X]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:w.AttributeType.Attribute,descriptor:{name:"a_Instance",buffer:{usage:w.gl.STATIC_DRAW,data:[],type:w.gl.FLOAT},size:4,update:function(y,A,M,D){return[M[3],M[4],M[5],M[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:w.AttributeType.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:w.gl.DYNAMIC_DRAW,data:[],type:w.gl.FLOAT},size:2,update:function(y,A,M,D){var ee=l.iconService.getIconMap(),X=y.texture,fe=ee[X]||{x:0,y:0},Xe=fe.x,it=fe.y;return[Xe,it]}}})}}]),o}(Ra);function zl(i){var f=ef();return function(){var u=(0,we.Z)(i),l;if(f){var d=(0,we.Z)(this).constructor;l=Reflect.construct(u,arguments,d)}else l=u.apply(this,arguments);return(0,be.Z)(this,l)}}function ef(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var Uc=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
uniform float u_blur : 0.99;
uniform float u_line_type: 0.0;
uniform float u_opacity : 1.0;
uniform float u_textureBlend;
varying vec4 v_color;
varying vec2 v_normal;

// line texture
uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

// dash
uniform float u_dash_offset : 0.0;
uniform float u_dash_ratio : 0.1;
varying float v_distance_ratio;
varying vec4 v_dash_array;
varying float v_side;

varying float v_distance;
varying vec2 v_offset;
varying float v_a;
varying float v_pixelLen;
varying vec2 v_iconMapUV;
varying float v_strokeWidth;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8
// [animate, duration, interval, trailLength],
void main() {
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  // gl_FragColor = v_color;

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v_distance_ratio);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // anti-alias
  // float blur = 1.0 - smoothstep(u_blur, 1., length(v_normal.xy));
  gl_FragColor.a *= u_opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + animateSpeed);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }
 // dash line
  if(u_line_type == LineTypeDash) {
    float flag = 0.;
    float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
    // gl_FragColor.a *=(1.0- step(v_dash_array.x, mod(v_distance_ratio, dashLength)));
  }

  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    float u = fract(mod(v_distance, v_pixelLen)/v_pixelLen - animateSpeed);
    float v = length(v_offset)/(v_a*2.0);
    v = max(smoothstep(0.95, 1.0, v), v);
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, vec2(u, v)));
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, uv));
     vec4 pattern = texture2D(u_texture, uv);

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= u_opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
  // gl_FragColor = filterColor(vec4(1.0, 0.0, 0.0, 1.0));
 
  // float r = max(smoothstep( 0.95, 1.0, v_strokeWidth/(v_a*2.0)), v_strokeWidth/(v_a*2.0));
  // if(rV < r || rV > 1.0 - r) {
  //   gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);
  // } 
  // float v = length(v_offset)/(v_a*2.0);
  // if(v > 0.9) {
  //   gl_FragColor = vec4(0.17647, 0.43921568, 0.2, 1.0);
  // } else if(v < 0.1) {
  //   gl_FragColor = vec4(0.17647, 0.43921568, 0.2, 1.0);
  // }

  // gl_FragColor = filterColor(gl_FragColor);
}
`,Eu=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

attribute vec2 a_iconMapUV;

// dash line
attribute float a_Total_Distance;
attribute float a_Distance;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
uniform float u_icon_step: 100;

#pragma include "projection"
#pragma include "picking"

varying vec4 v_color;
varying vec4 v_dash_array;
varying vec2 v_normal;
varying float v_distance_ratio;
varying float v_side;

varying float v_distance;
varying vec2 v_offset;
varying float v_size;
varying float v_a;
varying float v_pixelLen;
varying vec2 v_iconMapUV;
uniform float u_linearColor: 0;
// varying float v_strokeWidth;

void main() {
  
  v_iconMapUV = a_iconMapUV;
  v_distance = a_Distance;
  v_pixelLen = project_pixel(u_icon_step);

  if(u_line_type == LineTypeDash) {
    v_distance_ratio = a_Distance / a_Total_Distance;
    // v_distance_ratio = 0.01;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / a_Total_Distance;
  }
  if(u_aimate.x == Animate || u_linearColor == 1.0) {
      v_distance_ratio = a_Distance / a_Total_Distance;
  }
  v_normal = vec2(reverse_offset_normal(a_Normal) * sign(a_Miter));


  v_color = a_Color;
  v_a = project_pixel(a_Size.x);

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);

  vec2 offset = project_pixel(size.xy);
  // v_strokeWidth = project_pixel(2.0);

  v_offset = offset + offset * sign(a_Miter);

  v_side = a_Miter * a_Size.x;
  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xy + offset, a_Size.y, 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, a_Size.y / 10.0, 1.0)); // \u989D\u5916\u9664 10.0 \u662F\u4E3A\u4E86\u548Cgaode1.x\u7684\u9AD8\u5EA6\u517C\u5BB9
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,Qs={solid:0,dash:1},Fi=function(i){(0,ne.Z)(o,i);var f=zl(o);function o(){var u;(0,Y.Z)(this,o);for(var l=arguments.length,d=new Array(l),y=0;y<l;y++)d[y]=arguments[y];return u=f.call.apply(f,[this].concat(d)),u.texture=void 0,u.updateTexture=function(){var A=u.rendererService.createTexture2D;if(u.texture){u.texture.update({data:u.iconService.getCanvas()}),u.layer.render();return}u.texture=A({data:u.iconService.getCanvas(),mag:w.gl.NEAREST,min:w.gl.NEAREST,premultiplyAlpha:!1,width:1024,height:u.iconService.canvasHeight||128})},u}return(0,le.Z)(o,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,y=l.sourceColor,A=l.targetColor,M=l.textureBlend,D=M===void 0?"normal":M,ee=l.lineType,X=ee===void 0?"solid":ee,fe=l.dashArray,Xe=fe===void 0?[10,5,0,0]:fe,it=l.lineTexture,Rt=it===void 0?!1:it,xr=l.iconStep,Tr=xr===void 0?100:xr;Xe.length===2&&Xe.push(0,0),this.rendererService.getDirty()&&this.texture.bind();var jr=0,dn=[0,0,0,0],bn=[0,0,0,0];return y&&A&&(dn=(0,Ie.CI)(y),bn=(0,Ie.CI)(A),jr=1),{u_opacity:d===void 0?1:d,u_textureBlend:D==="normal"?0:1,u_line_type:Qs[X],u_dash_array:Xe,u_texture:this.texture,u_line_texture:Rt?1:0,u_icon_step:Tr,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:jr,u_sourceColor:dn,u_targetColor:bn}}},{key:"getAnimateUniforms",value:function(){var l=this.layer.getLayerConfig(),d=l.animateOption;return{u_aimate:this.animateOption2Array(d),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){this.texture&&this.texture.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"line",vertexShader:Eu,fragmentShader:Uc,triangulation:cl,primitive:w.gl.TRIANGLES,blend:this.getBlend(),depth:{enable:!1}})]}},{key:"registerBuiltinAttributes",value:function(){var l=this,d=this.layer.getLayerConfig(),y=d.lineType,A=y===void 0?"solid":y;this.styleAttributeService.registerStyleAttribute({name:"distance",type:w.AttributeType.Attribute,descriptor:{name:"a_Distance",buffer:{usage:w.gl.STATIC_DRAW,data:[],type:w.gl.FLOAT},size:1,update:function(D,ee,X,fe){return[X[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:w.AttributeType.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:w.gl.STATIC_DRAW,data:[],type:w.gl.FLOAT},size:1,update:function(D,ee,X,fe){return[X[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:w.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:w.gl.DYNAMIC_DRAW,data:[],type:w.gl.FLOAT},size:2,update:function(D,ee,X,fe){var Xe=D.size,it=Xe===void 0?1:Xe;return Array.isArray(it)?[it[0],it[1]]:[it,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:w.AttributeType.Attribute,descriptor:{name:"a_Normal",buffer:{usage:w.gl.STATIC_DRAW,data:[],type:w.gl.FLOAT},size:3,update:function(D,ee,X,fe,Xe){return Xe}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:w.AttributeType.Attribute,descriptor:{name:"a_Miter",buffer:{usage:w.gl.STATIC_DRAW,data:[],type:w.gl.FLOAT},size:1,update:function(D,ee,X,fe){return[X[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:w.AttributeType.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:w.gl.DYNAMIC_DRAW,data:[],type:w.gl.FLOAT},size:2,update:function(D,ee,X,fe){var Xe=l.iconService.getIconMap(),it=D.texture,Rt=Xe[it]||{x:0,y:0},xr=Rt.x,Tr=Rt.y;return[xr,Tr]}}})}},{key:"loadImage",value:function(l){return new Promise(function(d,y){if(l instanceof HTMLImageElement){d(l);return}var A=new Image;A.crossOrigin="anonymous",A.onload=function(){d(A)},A.onerror=function(){y(new Error("Could not load image at "+l))},A.src=l instanceof File?URL.createObjectURL(l):l})}}]),o}(Ra),Zu={arc:Us,arc3d:Js,greatcircle:_l,line:Fi},is=Zu;function Mo(i){var f=xl();return function(){var u=(0,we.Z)(i),l;if(f){var d=(0,we.Z)(this).constructor;l=Reflect.construct(u,arguments,d)}else l=u.apply(this,arguments);return(0,be.Z)(this,l)}}function xl(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var rl=function(i){(0,ne.Z)(o,i);var f=Mo(o);function o(){var u;(0,Y.Z)(this,o);for(var l=arguments.length,d=new Array(l),y=0;y<l;y++)d[y]=arguments[y];return u=f.call.apply(f,[this].concat(d)),u.type="LineLayer",u}return(0,le.Z)(o,[{key:"buildModels",value:function(){var l=this.getModelType();this.layerModel=new is[l](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var l=this.getModelType(),d={line:{},arc3d:{blend:"additive"},arc:{blend:"additive"},greatcircle:{blend:"additive"}};return d[l]}},{key:"getModelType",value:function(){var l,d=this.styleAttributeService.getLayerStyleAttribute("shape"),y=d==null||(l=d.scale)===null||l===void 0?void 0:l.field;return y||"line"}}]),o}(xs);function fu(i){var f=vs();return function(){var u=(0,we.Z)(i),l;if(f){var d=(0,we.Z)(this).constructor;l=Reflect.construct(u,arguments,d)}else l=u.apply(this,arguments);return(0,be.Z)(this,l)}}function vs(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var nl=`varying vec4 v_color;
uniform float u_opacity: 1.0;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,Un=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec3 a_Position;
attribute vec3 a_Pos;
attribute vec4 a_Color;
attribute vec3 a_Size;
attribute vec3 a_Normal;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform vec2 u_offsets;
varying vec4 v_color;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  vec3 size = a_Size * a_Position;

  vec2 offset = project_pixel(size.xy);

  vec4 project_pos = project_position(vec4(a_Pos.xy, 0., 1.0));

  vec4 pos = vec4(project_pos.xy + offset, project_pixel(size.z), 1.0);

  float lightWeight = calc_lighting(pos);
  v_color =vec4(a_Color.rgb * lightWeight, a_Color.w);

  // gl_Position = project_common_position_to_clipspace(pos);

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * pos;
  } else {
    gl_Position = project_common_position_to_clipspace(pos);
  }
  setPickingColor(a_PickingColor);
}
`,Mn=function(i){(0,ne.Z)(o,i);var f=fu(o);function o(){return(0,Y.Z)(this,o),f.apply(this,arguments)}return(0,le.Z)(o,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,y=l.offsets;return{u_opacity:d||1,u_offsets:y||[0,0]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"pointExtrude2",vertexShader:Un,fragmentShader:nl,triangulation:lc,blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:w.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:w.gl.DYNAMIC_DRAW,data:[],type:w.gl.FLOAT},size:3,update:function(d,y,A,M){var D=d.size;if(D){var ee=[];return Array.isArray(D)&&(ee=D.length===2?[D[0],D[0],D[1]]:D),Array.isArray(D)||(ee=[D]),ee}else return[2,2,2]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:w.AttributeType.Attribute,descriptor:{name:"a_Normal",buffer:{usage:w.gl.STATIC_DRAW,data:[],type:w.gl.FLOAT},size:3,update:function(d,y,A,M,D){return D}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:w.AttributeType.Attribute,descriptor:{name:"a_Pos",buffer:{usage:w.gl.DYNAMIC_DRAW,data:[],type:w.gl.FLOAT},size:3,update:function(d,y){var A=Co(d.coordinates);return[A[0],A[1],0]}}})}}]),o}(Ra);function rc(i){var f=as();return function(){var u=(0,we.Z)(i),l;if(f){var d=(0,we.Z)(this).constructor;l=Reflect.construct(u,arguments,d)}else l=u.apply(this,arguments);return(0,be.Z)(this,l)}}function as(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var vo=`#define Animate 0.0

uniform float u_blur : 0;
uniform float u_opacity : 1;
uniform float u_stroke_width : 1;
uniform vec4 u_stroke_color : [0, 0, 0, 0];
uniform float u_stroke_opacity : 1;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;
uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

#pragma include "sdf_2d"
#pragma include "picking"

void main() {
  int shape = int(floor(v_data.w + 0.5));

  lowp float antialiasblur = v_data.z;
  float antialiased_blur = -max(u_blur, antialiasblur);
  float r = v_radius / (v_radius + u_stroke_width);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  if (shape == 0) {
    outer_df = sdCircle(v_data.xy, 1.0);
    inner_df = sdCircle(v_data.xy, r);
  } else if (shape == 1) {
    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);
    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);
  } else if (shape == 2) {
    outer_df = sdBox(v_data.xy, vec2(1.));
    inner_df = sdBox(v_data.xy, vec2(r));
  } else if (shape == 3) {
    outer_df = sdPentagon(v_data.xy, 0.8);
    inner_df = sdPentagon(v_data.xy, r * 0.8);
  } else if (shape == 4) {
    outer_df = sdHexagon(v_data.xy, 0.8);
    inner_df = sdHexagon(v_data.xy, r * 0.8);
  } else if (shape == 5) {
    outer_df = sdOctogon(v_data.xy, 1.0);
    inner_df = sdOctogon(v_data.xy, r);
  } else if (shape == 6) {
    outer_df = sdHexagram(v_data.xy, 0.52);
    inner_df = sdHexagram(v_data.xy, r * 0.52);
  } else if (shape == 7) {
    outer_df = sdRhombus(v_data.xy, vec2(1.0));
    inner_df = sdRhombus(v_data.xy, vec2(r));
  } else if (shape == 8) {
    outer_df = sdVesica(v_data.xy, 1.1, 0.8);
    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);
  }

  float opacity_t = smoothstep(0.0, antialiased_blur, outer_df);
  float color_t = u_stroke_width < 0.01 ? 0.0 : smoothstep(
    antialiased_blur,
    0.0,
    inner_df
  );
  vec4 strokeColor = u_stroke_color == vec4(0) ? v_color : u_stroke_color;
  float PI = 3.14159;
  float N_RINGS = 3.0;
  float FREQ = 1.0;

  // gl_FragColor = v_color * color_t;
  // gl_FragColor = mix(vec4(v_color.rgb, v_color.a * u_opacity), strokeColor * u_stroke_opacity, color_t);
  gl_FragColor = mix(vec4(v_color.rgb, v_color.a * u_opacity), strokeColor * u_stroke_opacity, color_t);
  gl_FragColor.a = gl_FragColor.a * opacity_t;
  if(u_aimate.x == Animate) {
    float d = length(v_data.xy);
    float intensity = clamp(cos(d * PI), 0.0, 1.0) * clamp(cos(2.0 * PI * (d * 2.0 * u_aimate.z - u_aimate.y * u_time)), 0.0, 1.0);
    gl_FragColor = vec4(gl_FragColor.xyz, intensity);
  }

  gl_FragColor = filterColor(gl_FragColor);
}
`,ko=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec2 a_Extrude;
attribute float a_Size;
attribute float a_Shape;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

uniform float u_stroke_width : 2;
uniform vec2 u_offsets;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

#pragma include "projection"
#pragma include "picking"

void main() {
  vec2 extrude = a_Extrude;
  float shape_type = a_Shape;
  float newSize = setPickingSize(a_Size);

  // unpack color(vec2)
  v_color = a_Color;

  // radius(16-bit)
  v_radius = newSize;

  // TODO: billboard
  // anti-alias
  float antialiasblur = 1.0 / u_DevicePixelRatio / (newSize + u_stroke_width);

  // construct point coords
  v_data = vec4(extrude, antialiasblur,shape_type);

  vec2 offset = project_pixel(extrude * (newSize + u_stroke_width) + u_offsets);
  vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(project_pos.xy + offset, 0.0, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));
  }

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

  setPickingColor(a_PickingColor);
}
`,hu=function(i){(0,ne.Z)(o,i);var f=rc(o);function o(){return(0,Y.Z)(this,o),f.apply(this,arguments)}return(0,le.Z)(o,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,y=d===void 0?1:d,A=l.stroke,M=A===void 0?"rgb(0,0,0,0)":A,D=l.strokeWidth,ee=D===void 0?1:D,X=l.strokeOpacity,fe=X===void 0?1:X,Xe=l.offsets,it=Xe===void 0?[0,0]:Xe;return{u_opacity:y,u_stroke_width:ee,u_stroke_color:(0,Ie.CI)(M),u_stroke_opacity:fe,u_offsets:[-it[0],it[1]]}}},{key:"getAnimateUniforms",value:function(){var l=this.layer.getLayerConfig(),d=l.animateOption;return{u_aimate:this.animateOption2Array(d),u_time:this.layer.getLayerAnimateTime()}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),Ic)}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"pointfill",vertexShader:ko,fragmentShader:vo,triangulation:Ic,depth:{enable:!1},blend:this.getBlend()})]}},{key:"animateOption2Array",value:function(l){return[l.enable?0:1,l.speed||1,l.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var l=this;this.styleAttributeService.registerStyleAttribute({name:"extrude",type:w.AttributeType.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:w.gl.DYNAMIC_DRAW,data:[],type:w.gl.FLOAT},size:2,update:function(y,A,M,D){var ee=[1,1,-1,1,-1,-1,1,-1],X=D%4*2;return[ee[X],ee[X+1]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:w.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:w.gl.DYNAMIC_DRAW,data:[],type:w.gl.FLOAT},size:1,update:function(y,A,M,D){var ee=y.size,X=ee===void 0?5:ee;return Array.isArray(X)?[X[0]]:[X]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:w.AttributeType.Attribute,descriptor:{name:"a_Shape",buffer:{usage:w.gl.DYNAMIC_DRAW,data:[],type:w.gl.FLOAT},size:1,update:function(y,A,M,D){var ee=y.shape,X=ee===void 0?2:ee,fe=l.layer.getLayerConfig().shape2d,Xe=fe.indexOf(X);return[Xe]}}})}}]),o}(Ra);function js(i){var f=Nl();return function(){var u=(0,we.Z)(i),l;if(f){var d=(0,we.Z)(this).constructor;l=Reflect.construct(u,arguments,d)}else l=u.apply(this,arguments);return(0,be.Z)(this,l)}}function Nl(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var Ki=`
uniform sampler2D u_texture;
varying vec4 v_color;
varying vec2 v_uv;
uniform vec2 u_textSize;
uniform float u_stroke_width : 1;
uniform vec4 u_stroke_color : [1, 1, 1, 1];
uniform float u_stroke_opacity : 1;
uniform float u_opacity : 1;

varying float v_size;
#pragma include "picking"
void main(){
      vec2 pos= v_uv / u_textSize + gl_PointCoord / u_textSize * 64.;
      vec4 textureColor=texture2D(u_texture,pos);
      if(all(lessThan(v_color, vec4(1.0+0.00001))) && all(greaterThan(v_color, vec4(1.0-0.00001))) || v_color==vec4(1.0)){
            gl_FragColor= textureColor;
      }else {
            gl_FragColor= step(0.01, textureColor.z) * v_color;
      }
      gl_FragColor.a =gl_FragColor.a * u_opacity;
      gl_FragColor = filterColor(gl_FragColor);
}
`,So=`precision highp float;
attribute vec3 a_Position;
attribute vec4 a_Color;
attribute vec2 a_Uv;
attribute float a_Size;
varying vec4 v_color;
varying vec2 v_uv;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_stroke_width : 1;
uniform vec2 u_offsets;
varying float v_size;

#pragma include "projection"
#pragma include "picking"

void main() {
   v_color = a_Color;
   v_uv = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   v_size = a_Size;
   vec2 offset = project_pixel(u_offsets);

  //  gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));

    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0);
    } else {
      gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));
    }
   gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;

  setPickingColor(a_PickingColor);

}
`,tf=function(i){(0,ne.Z)(o,i);var f=js(o);function o(){var u;(0,Y.Z)(this,o);for(var l=arguments.length,d=new Array(l),y=0;y<l;y++)d[y]=arguments[y];return u=f.call.apply(f,[this].concat(d)),u.texture=void 0,u}return(0,le.Z)(o,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity;return{u_opacity:d||1,u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128]}}},{key:"initModels",value:function(){var l=this;return this.initIconFontGlyphs(),this.registerBuiltinAttributes(),this.updateTexture(),this.iconService.on("imageUpdate",function(){l.updateTexture(),l.layer.render()}),[this.layer.buildLayerModel({moduleName:"pointiconImage",vertexShader:So,fragmentShader:Ki,triangulation:eo,primitive:w.gl.POINTS,depth:{enable:!1},blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){var l=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:w.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:w.gl.DYNAMIC_DRAW,data:[],type:w.gl.FLOAT},size:1,update:function(y,A,M,D){var ee=y.size;return Array.isArray(ee)?[ee[0]]:[ee]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:w.AttributeType.Attribute,descriptor:{name:"a_Uv",buffer:{usage:w.gl.DYNAMIC_DRAW,data:[],type:w.gl.FLOAT},size:2,update:function(y,A,M,D){var ee=l.fontService.mapping,X=y.shape,fe=l.fontService.getGlyph(X),Xe=ee[fe],it=Xe.x,Rt=Xe.y;return[it,Rt]}}})}},{key:"updateTexture",value:function(){var l=this.rendererService.createTexture2D,d=this.fontService.canvas;this.texture=l({data:d,mag:w.gl.LINEAR,min:w.gl.LINEAR,width:d.width,height:d.height})}},{key:"initIconFontGlyphs",value:function(){var l=this,d=this.layer.getLayerConfig(),y=d.fontWeight,A=y===void 0?"normal":y,M=d.fontFamily,D=M===void 0?"sans-serif":M,ee=this.layer.getEncodedData(),X=[];ee.forEach(function(fe){var Xe=fe.shape,it=Xe===void 0?"":Xe;it=it.toString();var Rt=l.fontService.getGlyph(it);X.indexOf(Rt)===-1&&X.push(Rt)}),this.fontService.setFontOptions({characterSet:X,fontWeight:A,fontFamily:D,fontSize:48})}}]),o}(Ra);function bl(i){var f=mc();return function(){var u=(0,we.Z)(i),l;if(f){var d=(0,we.Z)(this).constructor;l=Reflect.construct(u,arguments,d)}else l=u.apply(this,arguments);return(0,be.Z)(this,l)}}function mc(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var wu=`
uniform sampler2D u_texture;
varying vec4 v_color;
varying vec2 v_uv;
uniform vec2 u_textSize;
uniform float u_stroke_width : 1;
uniform vec4 u_stroke_color : [1, 1, 1, 1];
uniform float u_stroke_opacity : 1;
uniform float u_opacity : 1;

varying float v_size;
#pragma include "picking"
void main(){
      vec2 pos= v_uv / u_textSize + gl_PointCoord / u_textSize * 64.;
      vec4 textureColor=texture2D(u_texture,pos);
      if(all(lessThan(v_color, vec4(1.0+0.00001))) && all(greaterThan(v_color, vec4(1.0-0.00001))) || v_color==vec4(1.0)){
            gl_FragColor= textureColor;
      }else {
            gl_FragColor= step(0.01, textureColor.z) * v_color;
      }
      gl_FragColor.a =gl_FragColor.a * u_opacity;
      gl_FragColor = filterColor(gl_FragColor);
}
`,Es=`precision highp float;
attribute vec3 a_Position;
attribute vec4 a_Color;
attribute vec2 a_Uv;
attribute float a_Size;
varying vec4 v_color;
varying vec2 v_uv;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_stroke_width : 1;
uniform vec2 u_offsets;
varying float v_size;

#pragma include "projection"
#pragma include "picking"

void main() {
   v_color = a_Color;
   v_uv = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   v_size = a_Size;
   vec2 offset = project_pixel(u_offsets);

  //  gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));

    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0);
    } else {
      gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));
    }
   gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;

  setPickingColor(a_PickingColor);

}
`,il=function(i){(0,ne.Z)(o,i);var f=bl(o);function o(){var u;(0,Y.Z)(this,o);for(var l=arguments.length,d=new Array(l),y=0;y<l;y++)d[y]=arguments[y];return u=f.call.apply(f,[this].concat(d)),u.texture=void 0,u.updateTexture=function(){var A=u.rendererService.createTexture2D;if(u.texture){u.texture.update({data:u.iconService.getCanvas()}),u.layer.render();return}u.texture=A({data:u.iconService.getCanvas(),mag:w.gl.NEAREST,min:w.gl.NEAREST,premultiplyAlpha:!1,width:1024,height:u.iconService.canvasHeight||128})},u}return(0,le.Z)(o,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,y=l.offsets,A=y===void 0?[0,0]:y;return this.rendererService.getDirty()&&this.texture.bind(),{u_opacity:d||1,u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128],u_offsets:[-A[0],A[1]]}}},{key:"initModels",value:function(){return this.registerBuiltinAttributes(),this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){this.texture&&this.texture.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"pointImage",vertexShader:Es,fragmentShader:wu,triangulation:eo,primitive:w.gl.POINTS,depth:{enable:!1},blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){var l=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:w.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:w.gl.DYNAMIC_DRAW,data:[],type:w.gl.FLOAT},size:1,update:function(y,A,M,D){var ee=y.size,X=ee===void 0?5:ee;return Array.isArray(X)?[X[0]]:[X]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:w.AttributeType.Attribute,descriptor:{name:"a_Uv",buffer:{usage:w.gl.DYNAMIC_DRAW,data:[],type:w.gl.FLOAT},size:2,update:function(y,A,M,D){var ee=l.iconService.getIconMap(),X=y.shape,fe=ee[X]||{x:0,y:0},Xe=fe.x,it=fe.y;return[Xe,it]}}})}}]),o}(Ra);function Tu(i){var f=gc();return function(){var u=(0,we.Z)(i),l;if(f){var d=(0,we.Z)(this).constructor;l=Reflect.construct(u,arguments,d)}else l=u.apply(this,arguments);return(0,be.Z)(this,l)}}function gc(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var nc=`
uniform float u_opacity : 1;
uniform vec2 u_offsets;
varying vec4 v_color;

#pragma include "picking"
void main() {
  gl_FragColor = v_color;
  gl_FragColor.a =gl_FragColor.a * u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,yc=`
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute float a_Size;
attribute vec4 a_Color;
varying vec4 v_color;

uniform vec2 u_offsets;

#pragma include "projection"
#pragma include "picking"
#pragma include "project"
void main() {
  v_color = a_Color;
  // vec2 offset = project_pixel(u_offsets);
  // vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
  // gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));\\
  // 
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    vec2 offset = project_pixel((u_offsets));
    gl_Position = u_Mvp * vec4(a_Position.xy + offset, a_Position.z, 1.0);
  } else { // else
    vec2 offset = project_pixel(u_offsets);
    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));
  }

  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
  setPickingColor(a_PickingColor);
}
`;function jc(i){var f=i.coordinates;return{vertices:(0,ci.Z)(f),indices:[0],size:f.length}}var Bl=function(i){(0,ne.Z)(o,i);var f=Tu(o);function o(){return(0,Y.Z)(this,o),f.apply(this,arguments)}return(0,le.Z)(o,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,y=d===void 0?1:d,A=l.stroke,M=A===void 0?"rgb(0,0,0,0)":A,D=l.strokeWidth,ee=D===void 0?1:D,X=l.offsets,fe=X===void 0?[0,0]:X;return{u_opacity:y,u_stroke_width:ee,u_stroke_color:(0,Ie.CI)(M),u_offsets:[-fe[0],fe[1]]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"normalpoint",vertexShader:yc,fragmentShader:nc,triangulation:jc,depth:{enable:!1},primitive:w.gl.POINTS,blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:w.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:w.gl.DYNAMIC_DRAW,data:[],type:w.gl.FLOAT},size:1,update:function(d,y,A,M){var D=d.size,ee=D===void 0?1:D;return Array.isArray(ee)?[ee[0]]:[ee]}}})}},{key:"defaultStyleOptions",value:function(){return{blend:w.BlendType.additive}}}]),o}(Ra),qs=x(98333);function _c(i,f){var o;if(typeof Symbol=="undefined"||i[Symbol.iterator]==null){if(Array.isArray(i)||(o=al(i))||f&&i&&typeof i.length=="number"){o&&(i=o);var u=0,l=function(){};return{s:l,n:function(){return u>=i.length?{done:!0}:{done:!1,value:i[u++]}},e:function(D){throw D},f:l}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var d=!0,y=!1,A;return{s:function(){o=i[Symbol.iterator]()},n:function(){var D=o.next();return d=D.done,D},e:function(D){y=!0,A=D},f:function(){try{!d&&o.return!=null&&o.return()}finally{if(y)throw A}}}}function al(i,f){if(!!i){if(typeof i=="string")return Au(i,f);var o=Object.prototype.toString.call(i).slice(8,-1);if(o==="Object"&&i.constructor&&(o=i.constructor.name),o==="Map"||o==="Set")return Array.from(i);if(o==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return Au(i,f)}}function Au(i,f){(f==null||f>i.length)&&(f=i.length);for(var o=0,u=new Array(f);o<f;o++)u[o]=i[o];return u}var Ul=function(){function i(f,o,u){(0,Y.Z)(this,i),this.boxCells=[],this.xCellCount=void 0,this.yCellCount=void 0,this.boxKeys=void 0,this.bboxes=void 0,this.width=void 0,this.height=void 0,this.xScale=void 0,this.yScale=void 0,this.boxUid=void 0;var l=this.boxCells;this.xCellCount=Math.ceil(f/u),this.yCellCount=Math.ceil(o/u);for(var d=0;d<this.xCellCount*this.yCellCount;d++)l.push([]);this.boxKeys=[],this.bboxes=[],this.width=f,this.height=o,this.xScale=this.xCellCount/f,this.yScale=this.yCellCount/o,this.boxUid=0}return(0,le.Z)(i,[{key:"insert",value:function(o,u,l,d,y){this.forEachCell(u,l,d,y,this.insertBoxCell,this.boxUid++),this.boxKeys.push(o),this.bboxes.push(u),this.bboxes.push(l),this.bboxes.push(d),this.bboxes.push(y)}},{key:"query",value:function(o,u,l,d,y){return this.queryHitTest(o,u,l,d,!1,y)}},{key:"hitTest",value:function(o,u,l,d,y){return this.queryHitTest(o,u,l,d,!0,y)}},{key:"insertBoxCell",value:function(o,u,l,d,y,A){this.boxCells[y].push(A)}},{key:"queryHitTest",value:function(o,u,l,d,y,A){if(l<0||o>this.width||d<0||u>this.height)return y?!1:[];var M=[];if(o<=0&&u<=0&&this.width<=l&&this.height<=d){if(y)return!0;for(var D=0;D<this.boxKeys.length;D++)M.push({key:this.boxKeys[D],x1:this.bboxes[D*4],y1:this.bboxes[D*4+1],x2:this.bboxes[D*4+2],y2:this.bboxes[D*4+3]});return A?M.filter(A):M}var ee={hitTest:y,seenUids:{box:{},circle:{}}};return this.forEachCell(o,u,l,d,this.queryCell,M,ee,A),y?M.length>0:M}},{key:"queryCell",value:function(o,u,l,d,y,A,M,D){var ee=M.seenUids,X=this.boxCells[y];if(X!==null){var fe=this.bboxes,Xe=_c(X),it;try{for(Xe.s();!(it=Xe.n()).done;){var Rt=it.value;if(!ee.box[Rt]){ee.box[Rt]=!0;var xr=Rt*4;if(o<=fe[xr+2]&&u<=fe[xr+3]&&l>=fe[xr+0]&&d>=fe[xr+1]&&(!D||D(this.boxKeys[Rt]))){if(M.hitTest)return A.push(!0),!0;A.push({key:this.boxKeys[Rt],x1:fe[xr],y1:fe[xr+1],x2:fe[xr+2],y2:fe[xr+3]})}}}}catch(Tr){Xe.e(Tr)}finally{Xe.f()}}return!1}},{key:"forEachCell",value:function(o,u,l,d,y,A,M,D){for(var ee=this.convertToXCellCoord(o),X=this.convertToYCellCoord(u),fe=this.convertToXCellCoord(l),Xe=this.convertToYCellCoord(d),it=ee;it<=fe;it++)for(var Rt=X;Rt<=Xe;Rt++){var xr=this.xCellCount*Rt+it;if(y.call(this,o,u,l,d,xr,A,M,D))return}}},{key:"convertToXCellCoord",value:function(o){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(o*this.xScale)))}},{key:"convertToYCellCoord",value:function(o){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(o*this.yScale)))}}]),i}(),pu=Ul,eu=function(){function i(f,o){(0,Y.Z)(this,i),this.width=void 0,this.height=void 0,this.grid=void 0,this.viewportPadding=100,this.screenRightBoundary=void 0,this.screenBottomBoundary=void 0,this.gridRightBoundary=void 0,this.gridBottomBoundary=void 0,this.width=f,this.height=o,this.viewportPadding=Math.max(f,o),this.grid=new pu(f+this.viewportPadding,o+this.viewportPadding,25),this.screenRightBoundary=f+this.viewportPadding,this.screenBottomBoundary=o+this.viewportPadding,this.gridRightBoundary=f+2*this.viewportPadding,this.gridBottomBoundary=o+2*this.viewportPadding}return(0,le.Z)(i,[{key:"placeCollisionBox",value:function(o){var u=o.x1+o.anchorPointX+this.viewportPadding,l=o.y1+o.anchorPointY+this.viewportPadding,d=o.x2+o.anchorPointX+this.viewportPadding,y=o.y2+o.anchorPointY+this.viewportPadding;return!this.isInsideGrid(u,l,d,y)||this.grid.hitTest(u,l,d,y)?{box:[]}:{box:[u,l,d,y]}}},{key:"insertCollisionBox",value:function(o,u){var l={featureIndex:u};this.grid.insert(l,o[0],o[1],o[2],o[3])}},{key:"project",value:function(o,u,l){var d=qs.al(u,l,0,1),y=qs.Ue(),A=ma.fromValues.apply(ma,(0,ci.Z)(o));return qs.fF(y,d,A),{x:(y[0]/y[3]+1)/2*this.width+this.viewportPadding,y:(-y[1]/y[3]+1)/2*this.height+this.viewportPadding}}},{key:"isInsideGrid",value:function(o,u,l,d){return l>=0&&o<this.gridRightBoundary&&d>=0&&u<this.gridBottomBoundary}}]),i}();function xc(i,f){var o;if(typeof Symbol=="undefined"||i[Symbol.iterator]==null){if(Array.isArray(i)||(o=bc(i))||f&&i&&typeof i.length=="number"){o&&(i=o);var u=0,l=function(){};return{s:l,n:function(){return u>=i.length?{done:!0}:{done:!1,value:i[u++]}},e:function(D){throw D},f:l}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var d=!0,y=!1,A;return{s:function(){o=i[Symbol.iterator]()},n:function(){var D=o.next();return d=D.done,D},e:function(D){y=!0,A=D},f:function(){try{!d&&o.return!=null&&o.return()}finally{if(y)throw A}}}}function bc(i,f){if(!!i){if(typeof i=="string")return Zc(i,f);var o=Object.prototype.toString.call(i).slice(8,-1);if(o==="Object"&&i.constructor&&(o=i.constructor.name),o==="Map"||o==="Set")return Array.from(i);if(o==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return Zc(i,f)}}function Zc(i,f){(f==null||f>i.length)&&(f=i.length);for(var o=0,u=new Array(f);o<f;o++)u[o]=i[o];return u}function Sc(i){var f=.5,o=.5;switch(i){case"right":case"top-right":case"bottom-right":f=1;break;case"left":case"top-left":case"bottom-left":f=0;break;default:f=.5}switch(i){case"bottom":case"bottom-right":case"bottom-left":o=1;break;case"top":case"top-right":case"top-left":o=0;break;default:o=.5}return{horizontalAlign:f,verticalAlign:o}}function n(i,f,o,u,l){if(!!l){var d=i[u],y=d.glyph;if(y)for(var A=f[y].advance*d.scale,M=(i[u].x+A)*l,D=o;D<=u;D++)i[D].x-=M}}function s(i,f,o,u,l,d,y){var A=(f-o)*l,M=(-u*y+.5)*d,D=xc(i),ee;try{for(D.s();!(ee=D.n()).done;){var X=ee.value;X.x+=A,X.y+=M}}catch(fe){D.e(fe)}finally{D.f()}}function a(i,f,o,u,l,d,y){var A=-8,M=0,D=A,ee=0,X=i.positionedGlyphs,fe=d==="right"?1:d==="left"?0:.5,Xe=X.length;o.forEach(function(jr){if(jr.split("").forEach(function(bn){var Gn=f[bn],Li=0;Gn&&(X.push({glyph:bn,x:M,y:D+Li,vertical:!1,scale:1,metrics:Gn}),M+=Gn.advance+y)}),X.length!==Xe){var dn=M-y;ee=Math.max(dn,ee),n(X,f,Xe,X.length-1,fe)}M=0,D+=u});var it=Sc(l),Rt=it.horizontalAlign,xr=it.verticalAlign;s(X,fe,Rt,xr,ee,u,o.length);var Tr=D-A;i.top+=-xr*Tr,i.bottom=i.top+Tr,i.left+=-Rt*ee,i.right=i.left+ee}function h(i,f,o,u,l,d,y){var A=-8,M=0,D=A,ee=0,X=i.positionedGlyphs,fe=d==="right"?1:d==="left"?0:.5,Xe=X.length;o.forEach(function(jr){var dn=f[jr],bn=0;if(dn&&(X.push({glyph:jr,x:M,y:D+bn,vertical:!1,scale:1,metrics:dn}),M+=dn.advance+y),X.length!==Xe){var Gn=M-y;ee=Math.max(Gn,ee),n(X,f,Xe,X.length-1,fe)}M=0,D+=u});var it=Sc(l),Rt=it.horizontalAlign,xr=it.verticalAlign;s(X,fe,Rt,xr,ee,u,o.length);var Tr=D-A;i.top+=-xr*Tr,i.bottom=i.top+Tr,i.left+=-Rt*ee,i.right=i.left+ee}function g(i,f,o,u,l,d){var y=arguments.length>6&&arguments[6]!==void 0?arguments[6]:[0,0],A=arguments.length>7?arguments[7]:void 0,M=i.split(`
`),D=[],ee={positionedGlyphs:D,top:y[1],bottom:y[1],left:y[0],right:y[0],lineCount:M.length,text:i};return A?h(ee,f,M,o,u,l,d):a(ee,f,M,o,u,l,d),D.length?ee:!1}function b(i){var f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0],o=arguments.length>2?arguments[2]:void 0,u=i.positionedGlyphs,l=u===void 0?[]:u,d=[],y=xc(l),A;try{for(y.s();!(A=y.n()).done;){var M=A.value,D=M.metrics,ee=4,X=D.advance*M.scale/2,fe=o?[M.x+X,M.y]:[0,0],Xe=o?[0,0]:[M.x+X+f[0],M.y+f[1]],it=(0-ee)*M.scale-X+Xe[0],Rt=(0-ee)*M.scale+Xe[1],xr=it+D.width*M.scale,Tr=Rt+D.height*M.scale,jr={x:it,y:Rt},dn={x:xr,y:Rt},bn={x:it,y:Tr},Gn={x:xr,y:Tr};d.push({tl:jr,tr:dn,bl:bn,br:Gn,tex:D,glyphOffset:fe})}}catch(Li){y.e(Li)}finally{y.f()}return d}function T(i,f){var o;if(typeof Symbol=="undefined"||i[Symbol.iterator]==null){if(Array.isArray(i)||(o=R(i))||f&&i&&typeof i.length=="number"){o&&(i=o);var u=0,l=function(){};return{s:l,n:function(){return u>=i.length?{done:!0}:{done:!1,value:i[u++]}},e:function(D){throw D},f:l}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var d=!0,y=!1,A;return{s:function(){o=i[Symbol.iterator]()},n:function(){var D=o.next();return d=D.done,D},e:function(D){y=!0,A=D},f:function(){try{!d&&o.return!=null&&o.return()}finally{if(y)throw A}}}}function R(i,f){if(!!i){if(typeof i=="string")return V(i,f);var o=Object.prototype.toString.call(i).slice(8,-1);if(o==="Object"&&i.constructor&&(o=i.constructor.name),o==="Map"||o==="Set")return Array.from(i);if(o==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return V(i,f)}}function V(i,f){(f==null||f>i.length)&&(f=i.length);for(var o=0,u=new Array(f);o<f;o++)u[o]=i[o];return u}function te(i){var f=de();return function(){var u=(0,we.Z)(i),l;if(f){var d=(0,we.Z)(this).constructor;l=Reflect.construct(u,arguments,d)}else l=u.apply(this,arguments);return(0,be.Z)(this,l)}}function de(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var ye=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 48.0
uniform sampler2D u_sdf_map;
uniform float u_gamma_scale : 0.5;
// uniform float u_font_size : 24.0;
uniform float u_opacity : 1.0;
uniform float u_stroke_opacity: 1.0;
uniform vec4 u_stroke : [0, 0, 0, 1];
uniform float u_strokeWidth : 2.0;
uniform float u_halo_blur : 0.5;
uniform float u_DevicePixelRatio;

varying vec4 v_color;
varying vec2 v_uv;
varying float v_gamma_scale;
varying float v_fontScale;

#pragma include "picking"
void main() {
  // get sdf from atlas
  float dist = texture2D(u_sdf_map, v_uv).a;

  // float fontScale = u_font_size / FONT_SIZE;

  lowp float buff = (6.0 - u_strokeWidth / v_fontScale) / SDF_PX;
  highp float gamma = (u_halo_blur * 1.19 / SDF_PX + EDGE_GAMMA) / (v_fontScale * u_gamma_scale) / 1.0;

  highp float gamma_scaled = gamma * v_gamma_scale;

  highp float alpha = smoothstep(buff - gamma_scaled, buff + gamma_scaled, dist);
  gl_FragColor = mix(vec4(v_color.rgb, v_color.a * u_opacity), vec4(u_stroke.rgb, u_stroke.a * u_opacity), smoothstep(0., 0.5, 1. - dist));
  gl_FragColor.a= gl_FragColor.a * alpha;
  gl_FragColor = filterColor(gl_FragColor);
}
`,xe=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 24.0
attribute vec3 a_Position;
attribute vec2 a_tex;
attribute vec2 a_textOffsets;
attribute vec4 a_Color;
attribute float a_Size;
attribute float a_Rotate;

uniform vec2 u_sdf_map_size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec2 v_uv;
varying float v_gamma_scale;
varying vec4 v_color;
varying float v_fontScale;

#pragma include "projection"
#pragma include "picking"

void main() {
  v_color = a_Color;
  v_uv = a_tex / u_sdf_map_size;

  // \u6587\u672C\u7F29\u653E\u6BD4\u4F8B
  float fontScale = a_Size / FONT_SIZE;
  v_fontScale = fontScale;

  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // vec4 projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  highp float angle_sin = sin(a_Rotate);
  highp float angle_cos = cos(a_Rotate);
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);
  
  // gl_Position = vec4(projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);

  vec4 projected_position;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
   projected_position  = u_Mvp * (vec4(a_Position.xyz, 1.0));
  } else { // else
   projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  gl_Position = vec4(projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);
  v_gamma_scale = gl_Position.w;
  setPickingColor(a_PickingColor);

}
`;function He(i){var f=this,o=i.id,u=[],l=[];if(!f.glyphInfoMap||!f.glyphInfoMap[o])return{vertices:[],indices:[],size:7};var d=f.glyphInfoMap[o].centroid,y=d.length===2?[d[0],d[1],0]:d;return f.glyphInfoMap[o].glyphQuads.forEach(function(A,M){u.push.apply(u,(0,ci.Z)(y).concat([A.tex.x,A.tex.y+A.tex.height,A.tl.x,A.tl.y],(0,ci.Z)(y),[A.tex.x+A.tex.width,A.tex.y+A.tex.height,A.tr.x,A.tr.y],(0,ci.Z)(y),[A.tex.x+A.tex.width,A.tex.y,A.br.x,A.br.y],(0,ci.Z)(y),[A.tex.x,A.tex.y,A.bl.x,A.bl.y])),l.push(0+M*4,1+M*4,2+M*4,2+M*4,3+M*4,0+M*4)}),{vertices:u,indices:l,size:7}}var Ze=function(i){(0,ne.Z)(o,i);var f=te(o);function o(){var u;(0,Y.Z)(this,o);for(var l=arguments.length,d=new Array(l),y=0;y<l;y++)d[y]=arguments[y];return u=f.call.apply(f,[this].concat(d)),u.glyphInfo=void 0,u.glyphInfoMap={},u.texture=void 0,u.currentZoom=-1,u.extent=void 0,u.textureHeight=0,u.textCount=0,u.preTextStyle={},u.buildModels=function(){return u.initGlyph(),u.updateTexture(),u.filterGlyphs(),[u.layer.buildLayerModel({moduleName:"pointText",vertexShader:xe,fragmentShader:ye,triangulation:He.bind((0,Gt.Z)(u)),depth:{enable:!1},blend:u.getBlend()})]},u}return(0,le.Z)(o,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,y=d===void 0?1:d,A=l.stroke,M=A===void 0?"#fff":A,D=l.strokeWidth,ee=D===void 0?0:D,X=l.strokeOpacity,fe=X===void 0?1:X,Xe=l.textAnchor,it=Xe===void 0?"center":Xe,Rt=l.textAllowOverlap,xr=Rt===void 0?!1:Rt,Tr=l.halo,jr=Tr===void 0?.5:Tr,dn=l.gamma,bn=dn===void 0?2:dn,Gn=this.fontService,Li=Gn.canvas,ti=Gn.mapping;return Object.keys(ti).length!==this.textCount&&(this.updateTexture(),this.textCount=Object.keys(ti).length),this.preTextStyle={textAnchor:it,textAllowOverlap:xr},{u_opacity:y,u_stroke_opacity:fe,u_sdf_map:this.texture,u_stroke:(0,Ie.CI)(M),u_halo_blur:jr,u_gamma_scale:bn,u_sdf_map_size:[Li.width,Li.height],u_strokeWidth:ee}}},{key:"initModels",value:function(){this.layer.on("remapping",this.buildModels),this.extent=this.textExtent();var l=this.layer.getLayerConfig(),d=l.textAnchor,y=d===void 0?"center":d,A=l.textAllowOverlap,M=A===void 0?!0:A;return this.preTextStyle={textAnchor:y,textAllowOverlap:M},this.buildModels()}},{key:"needUpdate",value:function(){var l=this.layer.getLayerConfig(),d=l.textAllowOverlap,y=d===void 0?!1:d,A=this.mapService.getZoom(),M=this.mapService.getBounds(),D=(0,Ie.oO)(this.extent,M);return!y&&(Math.abs(this.currentZoom-A)>1||!D)||y!==this.preTextStyle.textAllowOverlap?(this.reBuildModel(),!0):!1}},{key:"clearModels",value:function(){this.layer.off("remapping",this.buildModels)}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"rotate",type:w.AttributeType.Attribute,descriptor:{name:"a_Rotate",buffer:{usage:w.gl.DYNAMIC_DRAW,data:[],type:w.gl.FLOAT},size:1,update:function(d,y,A,M){var D=d.rotate,ee=D===void 0?0:D;return Array.isArray(ee)?[ee[0]]:[ee]}}}),this.styleAttributeService.registerStyleAttribute({name:"textOffsets",type:w.AttributeType.Attribute,descriptor:{name:"a_textOffsets",buffer:{usage:w.gl.STATIC_DRAW,data:[],type:w.gl.FLOAT},size:2,update:function(d,y,A,M){return[A[5],A[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:w.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:w.gl.DYNAMIC_DRAW,data:[],type:w.gl.FLOAT},size:1,update:function(d,y,A,M){var D=d.size,ee=D===void 0?12:D;return Array.isArray(ee)?[ee[0]]:[ee]}}}),this.styleAttributeService.registerStyleAttribute({name:"textUv",type:w.AttributeType.Attribute,descriptor:{name:"a_tex",buffer:{usage:w.gl.DYNAMIC_DRAW,data:[],type:w.gl.FLOAT},size:2,update:function(d,y,A,M){return[A[3],A[4]]}}})}},{key:"textExtent",value:function(){var l=this.mapService.getBounds();return(0,Ie.yA)(l,.5)}},{key:"initTextFont",value:function(){var l=this.layer.getLayerConfig(),d=l.fontWeight,y=d===void 0?"400":d,A=l.fontFamily,M=A===void 0?"sans-serif":A,D=this.layer.getEncodedData(),ee=[];D.forEach(function(X){var fe=X.shape,Xe=fe===void 0?"":fe;Xe=Xe.toString();var it=T(Xe),Rt;try{for(it.s();!(Rt=it.n()).done;){var xr=Rt.value;ee.indexOf(xr)===-1&&ee.push(xr)}}catch(Tr){it.e(Tr)}finally{it.f()}}),this.fontService.setFontOptions({characterSet:ee,fontWeight:y,fontFamily:M,iconfont:!1})}},{key:"initIconFontTex",value:function(){var l=this.layer.getLayerConfig(),d=l.fontWeight,y=d===void 0?"400":d,A=l.fontFamily,M=A===void 0?"sans-serif":A,D=this.layer.getEncodedData(),ee=[];D.forEach(function(X){var fe=X.shape,Xe=fe===void 0?"":fe;Xe=Xe.toString(),ee.indexOf(Xe)===-1&&ee.push(Xe)}),this.fontService.setFontOptions({characterSet:ee,fontWeight:y,fontFamily:M,iconfont:!0})}},{key:"generateGlyphLayout",value:function(l){var d=this,y=this.fontService.mapping,A=this.layer.getLayerConfig(),M=A.spacing,D=M===void 0?2:M,ee=A.textAnchor,X=ee===void 0?"center":ee,fe=A.textOffset,Xe=this.layer.getEncodedData();this.glyphInfo=Xe.map(function(it){var Rt=it.shape,xr=Rt===void 0?"":Rt,Tr=it.id,jr=it.size,dn=jr===void 0?1:jr,bn=g(xr.toString(),y,dn,X,"center",D,fe,l),Gn=b(bn,fe,!1);return it.shaping=bn,it.glyphQuads=Gn,it.centroid=Co(it.coordinates),it.originCentroid=it.version==="GAODE2.x"?Co(it.originCoordinates):it.originCentroid=it.centroid,d.glyphInfoMap[Tr]={shaping:bn,glyphQuads:Gn,centroid:Co(it.coordinates)},it})}},{key:"filterGlyphs",value:function(){var l=this,d=this.layer.getLayerConfig(),y=d.padding,A=y===void 0?[4,4]:y,M=d.textAllowOverlap,D=M===void 0?!1:M;if(!D){this.glyphInfoMap={},this.currentZoom=this.mapService.getZoom(),this.extent=this.textExtent();var ee=this.rendererService.getViewportSize(),X=ee.width,fe=ee.height,Xe=new eu(X,fe),it=this.glyphInfo.filter(function(Rt){var xr=Rt.shaping,Tr=Rt.id,jr=Tr===void 0?0:Tr,dn=Rt.version==="GAODE2.x"?Rt.originCentroid:Rt.centroid,bn=Rt.size,Gn=bn/24,Li=l.mapService.lngLatToContainer(dn),ti=Xe.placeCollisionBox({x1:xr.left*Gn-A[0],x2:xr.right*Gn+A[0],y1:xr.top*Gn-A[1],y2:xr.bottom*Gn+A[1],anchorPointX:Li.x,anchorPointY:Li.y}),qi=ti.box;return qi&&qi.length?(Xe.insertCollisionBox(qi,jr),!0):!1});it.forEach(function(Rt){l.glyphInfoMap[Rt.id]=Rt})}}},{key:"initGlyph",value:function(){var l=this.layer.getLayerConfig(),d=l.iconfont,y=d===void 0?!1:d;y?this.initIconFontTex():this.initTextFont(),this.generateGlyphLayout(y)}},{key:"updateTexture",value:function(){var l=this.rendererService.createTexture2D,d=this.fontService.canvas;this.textureHeight=d.height,this.texture&&this.texture.destroy(),this.texture=l({data:d,mag:w.gl.LINEAR,min:w.gl.LINEAR,width:d.width,height:d.height})}},{key:"reBuildModel",value:function(){this.filterGlyphs(),this.layer.models=[this.layer.buildLayerModel({moduleName:"pointText",vertexShader:xe,fragmentShader:ye,triangulation:He.bind(this),depth:{enable:!1},blend:this.getBlend()})]}}]),o}(Ra),nt={fill:hu,image:il,normal:Bl,extrude:Mn,text:Ze,icon:tf},ze=nt;function rt(i){var f=ht();return function(){var u=(0,we.Z)(i),l;if(f){var d=(0,we.Z)(this).constructor;l=Reflect.construct(u,arguments,d)}else l=u.apply(this,arguments);return(0,be.Z)(this,l)}}function ht(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var Nt=function(i){(0,ne.Z)(o,i);var f=rt(o);function o(){var u;(0,Y.Z)(this,o);for(var l=arguments.length,d=new Array(l),y=0;y<l;y++)d[y]=arguments[y];return u=f.call.apply(f,[this].concat(d)),u.type="PointLayer",u}return(0,le.Z)(o,[{key:"buildModels",value:function(){var l=this.getModelType();this.layerModel=new ze[l](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var l=this.getModelType(),d={normal:{blend:"additive"},fill:{blend:"normal"},extrude:{},image:{},icon:{},text:{blend:"normal"}};return d[l]}},{key:"getModelType",value:function(){var l=this.getEncodedData(),d=this.getLayerConfig(),y=d.shape2d,A=d.shape3d,M=this.iconService.getIconMap(),D=l.find(function(X){return X.hasOwnProperty("shape")});if(D){var ee=D.shape;return ee==="dot"?"normal":(y==null?void 0:y.indexOf(ee))!==-1?"fill":(A==null?void 0:A.indexOf(ee))!==-1?"extrude":M.hasOwnProperty(ee)?"image":this.fontService.getGlyph(ee)!==""?"icon":"text"}else return"normal"}}]),o}(xs);function or(i){var f=rr();return function(){var u=(0,we.Z)(i),l;if(f){var d=(0,we.Z)(this).constructor;l=Reflect.construct(u,arguments,d)}else l=u.apply(this,arguments);return(0,be.Z)(this,l)}}function rr(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var sr=`uniform float u_opacity: 1.0;
varying vec4 v_Color;

#pragma include "picking"

void main() {
  gl_FragColor = v_Color;
  gl_FragColor.a *= u_opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,Lr=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  setPickingColor(a_PickingColor);
}
`,rn=function(i){(0,ne.Z)(o,i);var f=or(o);function o(){return(0,Y.Z)(this,o),f.apply(this,arguments)}return(0,le.Z)(o,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,y=d===void 0?1:d;return{u_opacity:y}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"polygonExtrude",vertexShader:Lr,fragmentShader:sr,triangulation:ns})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"normal",type:w.AttributeType.Attribute,descriptor:{name:"a_Normal",buffer:{usage:w.gl.STATIC_DRAW,data:[],type:w.gl.FLOAT},size:3,update:function(d,y,A,M,D){return D}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:w.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:w.gl.DYNAMIC_DRAW,data:[],type:w.gl.FLOAT},size:1,update:function(d,y,A,M){var D=d.size,ee=D===void 0?10:D;return Array.isArray(ee)?[ee[0]]:[ee]}}})}}]),o}(Ra);function Qr(i){var f=xn();return function(){var u=(0,we.Z)(i),l;if(f){var d=(0,we.Z)(this).constructor;l=Reflect.construct(u,arguments,d)}else l=u.apply(this,arguments);return(0,be.Z)(this,l)}}function xn(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var jn=`uniform float u_opacity: 1.0;
varying vec4 v_Color;

#pragma include "picking"

void main() {
  gl_FragColor = v_Color;
  gl_FragColor.a *= u_opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,Xn=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;

#pragma include "projection"
#pragma include "picking"

void main() {
  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  setPickingColor(a_PickingColor);
}

`,Wn=function(i){(0,ne.Z)(o,i);var f=Qr(o);function o(){return(0,Y.Z)(this,o),f.apply(this,arguments)}return(0,le.Z)(o,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,y=d===void 0?1:d;return{u_opacity:y}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"polygon",vertexShader:Xn,fragmentShader:jn,triangulation:fl,blend:this.getBlend(),depth:{enable:!1}})]}},{key:"registerBuiltinAttributes",value:function(){}}]),o}(Ra),$i={fill:Wn,line:Fi,extrude:rn,text:Ze,point_fill:hu,point_image:il,point_normal:Bl,point_extrude:Mn},Sn=$i;function oi(i){var f=Si();return function(){var u=(0,we.Z)(i),l;if(f){var d=(0,we.Z)(this).constructor;l=Reflect.construct(u,arguments,d)}else l=u.apply(this,arguments);return(0,be.Z)(this,l)}}function Si(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var ai=function(i){(0,ne.Z)(o,i);var f=oi(o);function o(){var u;(0,Y.Z)(this,o);for(var l=arguments.length,d=new Array(l),y=0;y<l;y++)d[y]=arguments[y];return u=f.call.apply(f,[this].concat(d)),u.type="PolygonLayer",u}return(0,le.Z)(o,[{key:"buildModels",value:function(){var l=this.getModelType();this.layerModel=new Sn[l](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){var l,d=this.styleAttributeService.getLayerStyleAttribute("shape"),y=d==null||(l=d.scale)===null||l===void 0?void 0:l.field;return y==="fill"?"fill":y==="extrude"?"extrude":y==="line"?"line":this.getPointModelType()}},{key:"getPointModelType",value:function(){var l=this.getEncodedData(),d=this.getLayerConfig(),y=d.shape2d,A=d.shape3d,M=this.iconService.getIconMap(),D=l.find(function(X){return X.hasOwnProperty("shape")});if(D){var ee=D.shape;return ee==="dot"?"point_normal":(y==null?void 0:y.indexOf(ee))!==-1?"point_fill":(A==null?void 0:A.indexOf(ee))!==-1?"point_extrude":M.hasOwnProperty(ee)?"point_image":"text"}else return"fill"}}]),o}(xs);function ii(i){var f=Ei();return function(){var u=(0,we.Z)(i),l;if(f){var d=(0,we.Z)(this).constructor;l=Reflect.construct(u,arguments,d)}else l=u.apply(this,arguments);return(0,be.Z)(this,l)}}function Ei(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var ri=`precision mediump float;
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_min;
uniform float u_max;
uniform vec2 u_domain;
uniform float u_noDataValue;
uniform bool u_clampLow: true;
uniform bool u_clampHigh: true;
varying vec2 v_texCoord;

void main() {

  float value = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y)).r;
  if (value == u_noDataValue)
    gl_FragColor = vec4(0.0, 0, 0, 0.0);
  else if ((!u_clampLow && value < u_domain[0]) || (!u_clampHigh && value > u_domain[1]))
    gl_FragColor = vec4(0, 0, 0, 0);
  else {
    float normalisedValue =(value - u_domain[0]) / (u_domain[1] -u_domain[0]);
    vec4 color = texture2D(u_colorTexture,vec2(normalisedValue, 0));
    gl_FragColor = color;
    gl_FragColor.a =  gl_FragColor.a * u_opacity ;
  }


}
`,Qn=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));

   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,mo=function(i){(0,ne.Z)(o,i);var f=ii(o);function o(){var u;(0,Y.Z)(this,o);for(var l=arguments.length,d=new Array(l),y=0;y<l;y++)d[y]=arguments[y];return u=f.call.apply(f,[this].concat(d)),u.texture=void 0,u.colorTexture=void 0,u}return(0,le.Z)(o,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,y=d===void 0?1:d,A=l.clampLow,M=A===void 0?!0:A,D=l.clampHigh,ee=D===void 0?!0:D,X=l.noDataValue,fe=X===void 0?-9999999:X,Xe=l.domain,it=Xe===void 0?[0,1]:Xe;return this.updateColorTexure(),{u_opacity:y||1,u_texture:this.texture,u_domain:it,u_clampLow:M,u_clampHigh:typeof ee!="undefined"?ee:M,u_noDataValue:fe,u_colorTexture:this.colorTexture}}},{key:"initModels",value:function(){var l=this.layer.getSource(),d=this.rendererService.createTexture2D,y=l.data.dataArray[0];this.texture=d({data:y.data,width:y.width,height:y.height,format:w.gl.LUMINANCE,type:w.gl.FLOAT});var A=this.layer.getLayerConfig(),M=A.rampColors,D=(0,Ie.Cl)(M);return this.colorTexture=d({data:D.data,width:D.width,height:D.height,flipY:!1}),[this.layer.buildLayerModel({moduleName:"RasterImageData",vertexShader:Qn,fragmentShader:ri,triangulation:Ku,primitive:w.gl.TRIANGLES,depth:{enable:!1},blend:this.getBlend()})]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:w.AttributeType.Attribute,descriptor:{name:"a_Uv",buffer:{usage:w.gl.DYNAMIC_DRAW,data:[],type:w.gl.FLOAT},size:2,update:function(d,y,A,M){return[A[3],A[4]]}}})}},{key:"updateColorTexure",value:function(){var l=this.rendererService.createTexture2D,d=this.layer.getLayerConfig(),y=d.rampColors,A=(0,Ie.Cl)(y);this.colorTexture=l({data:A.data,width:A.width,height:A.height,flipY:!1})}}]),o}(Ra),Ja={raster:mo,raster3d:mo},os=Ja;function Fo(i){var f=Qa();return function(){var u=(0,we.Z)(i),l;if(f){var d=(0,we.Z)(this).constructor;l=Reflect.construct(u,arguments,d)}else l=u.apply(this,arguments);return(0,be.Z)(this,l)}}function Qa(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var ro=function(i){(0,ne.Z)(o,i);var f=Fo(o);function o(){var u;(0,Y.Z)(this,o);for(var l=arguments.length,d=new Array(l),y=0;y<l;y++)d[y]=arguments[y];return u=f.call.apply(f,[this].concat(d)),u.type="RasterLayer",u}return(0,le.Z)(o,[{key:"buildModels",value:function(){var l=this.getModelType();this.layerModel=new os[l](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var l=this.getModelType(),d={raster:{},raster3d:{}};return d[l]}},{key:"getModelType",value:function(){return"raster"}}]),o}(xs),ms=x(50361),zo=x.n(ms),Cu,ss,Zs,Vs,Sl,El,Ls,Vu,jl,du,wl,tu;function no(i,f){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(i);f&&(u=u.filter(function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable})),o.push.apply(o,u)}return o}function Pu(i){for(var f=1;f<arguments.length;f++){var o=arguments[f]!=null?arguments[f]:{};f%2?no(Object(o),!0).forEach(function(u){(0,F.Z)(i,u,o[u])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):no(Object(o)).forEach(function(u){Object.defineProperty(i,u,Object.getOwnPropertyDescriptor(o,u))})}return i}var vu=(Cu=(0,H.b2)(),ss=(0,H.f3)(w.vK.IGlobalConfigService),Zs=(0,H.f3)(w.vK.ILogService),Vs=(0,H.f3)(w.vK.IMapService),Sl=(0,H.f3)(w.vK.IFontService),Cu(El=(Ls=(tu=function(){function i(){(0,Y.Z)(this,i),(0,Rn.Z)(this,"configService",Vu,this),(0,Rn.Z)(this,"logger",jl,this),(0,Rn.Z)(this,"mapService",du,this),(0,Rn.Z)(this,"fontService",wl,this)}return(0,le.Z)(i,[{key:"apply",value:function(o,u){var l=this,d=u.styleAttributeService;o.hooks.init.tap("DataMappingPlugin",function(){l.generateMaping(o,{styleAttributeService:d})}),o.hooks.beforeRenderData.tap("DataMappingPlugin",function(){return o.dataState.dataMappingNeedUpdate=!1,l.generateMaping(o,{styleAttributeService:d}),!0}),o.hooks.beforeRender.tap("DataMappingPlugin",function(){if(!o.layerModelNeedUpdate){var y=d.getLayerStyleAttributes()||[],A=d.getLayerStyleAttribute("filter"),M=o.getSource().data.dataArray,D=y.filter(function(X){return X.needRemapping}),ee=M;A!=null&&A.needRemapping&&A!==null&&A!==void 0&&A.scale&&(ee=M.filter(function(X){return l.applyAttributeMapping(A,X)[0]})),D.length&&(A!=null&&A.needRemapping?(o.setEncodedData(l.mapping(y,ee)),A.needRemapping=!1):o.setEncodedData(l.mapping(D,ee,o.getEncodedData())),l.logger.debug("remapping finished"),o.emit("remapping",null))}})}},{key:"generateMaping",value:function(o,u){var l=this,d=u.styleAttributeService,y=d.getLayerStyleAttributes()||[],A=d.getLayerStyleAttribute("filter"),M=o.getSource().data.dataArray,D=M;A!=null&&A.scale&&(D=M.filter(function(ee){return l.applyAttributeMapping(A,ee)[0]})),o.setEncodedData(this.mapping(y,D))}},{key:"mapping",value:function(o,u,l){var d=this,y=u.map(function(A,M){var D=l?l[M]:{},ee=Pu({id:A._id,coordinates:A.coordinates},D);return o.filter(function(X){return X.scale!==void 0}).forEach(function(X){var fe=d.applyAttributeMapping(X,A);X.needRemapping=!1,X.name==="color"&&(fe=fe.map(function(Xe){return(0,Ie.CI)(Xe)})),ee[X.name]=Array.isArray(fe)&&fe.length===1?fe[0]:fe,X.name==="shape"&&(ee.shape=d.fontService.getIconFontKey(ee[X.name]))}),ee});return y.length>0&&this.mapService.version==="GAODE2.x"&&(typeof y[0].coordinates[0]=="number"?y.map(function(A){A.version="GAODE2.x",A.originCoordinates=zo()(A.coordinates),A.coordinates=d.mapService.lngLatToCoord(A.coordinates)}):y.map(function(A){A.version="GAODE2.x",A.originCoordinates=zo()(A.coordinates),A.coordinates=d.mapService.lngLatToCoords(A.coordinates)})),y}},{key:"applyAttributeMapping",value:function(o,u){var l;if(!o.scale)return[];var d=(o==null||(l=o.scale)===null||l===void 0?void 0:l.scalers)||[],y=[];return d.forEach(function(A){var M,D=A.field;(u.hasOwnProperty(D)||((M=o.scale)===null||M===void 0?void 0:M.type)==="variable")&&y.push(u[D])}),o.mapping?o.mapping(y):[]}}]),i}(),tu),Vu=(0,Dn.Z)(Ls.prototype,"configService",[ss],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jl=(0,Dn.Z)(Ls.prototype,"logger",[Zs],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),du=(0,Dn.Z)(Ls.prototype,"mapService",[Vs],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wl=(0,Dn.Z)(Ls.prototype,"fontService",[Sl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ls))||El),ws={},Ji={},No=function(f){return Ji[f]},go=function(f,o){Ji[f]=o},Mu=function(f){return ws[f]},ru=function(f,o){ws[f]=o},mu={},Gu={},Iu=34,Gs=10,nu=13;function Tl(i){return new Function("d","return {"+i.map(function(f,o){return JSON.stringify(f)+": d["+o+'] || ""'}).join(",")+"}")}function rf(i,f){var o=Tl(i);return function(u,l){return f(o(u),l,i)}}function gu(i){var f=Object.create(null),o=[];return i.forEach(function(u){for(var l in u)l in f||o.push(f[l]=l)}),o}function ga(i,f){var o=i+"",u=o.length;return u<f?new Array(f-u+1).join(0)+o:o}function dh(i){return i<0?"-"+ga(-i,6):i>9999?"+"+ga(i,6):ga(i,4)}function Hf(i){var f=i.getUTCHours(),o=i.getUTCMinutes(),u=i.getUTCSeconds(),l=i.getUTCMilliseconds();return isNaN(i)?"Invalid Date":dh(i.getUTCFullYear(),4)+"-"+ga(i.getUTCMonth()+1,2)+"-"+ga(i.getUTCDate(),2)+(l?"T"+ga(f,2)+":"+ga(o,2)+":"+ga(u,2)+"."+ga(l,3)+"Z":u?"T"+ga(f,2)+":"+ga(o,2)+":"+ga(u,2)+"Z":o||f?"T"+ga(f,2)+":"+ga(o,2)+"Z":"")}function Wf(i){var f=new RegExp('["'+i+`
\r]`),o=i.charCodeAt(0);function u(X,fe){var Xe,it,Rt=l(X,function(xr,Tr){if(Xe)return Xe(xr,Tr-1);it=xr,Xe=fe?rf(xr,fe):Tl(xr)});return Rt.columns=it||[],Rt}function l(X,fe){var Xe=[],it=X.length,Rt=0,xr=0,Tr,jr=it<=0,dn=!1;X.charCodeAt(it-1)===Gs&&--it,X.charCodeAt(it-1)===nu&&--it;function bn(){if(jr)return Gu;if(dn)return dn=!1,mu;var Li,ti=Rt,qi;if(X.charCodeAt(ti)===Iu){for(;Rt++<it&&X.charCodeAt(Rt)!==Iu||X.charCodeAt(++Rt)===Iu;);return(Li=Rt)>=it?jr=!0:(qi=X.charCodeAt(Rt++))===Gs?dn=!0:qi===nu&&(dn=!0,X.charCodeAt(Rt)===Gs&&++Rt),X.slice(ti+1,Li-1).replace(/""/g,'"')}for(;Rt<it;){if((qi=X.charCodeAt(Li=Rt++))===Gs)dn=!0;else if(qi===nu)dn=!0,X.charCodeAt(Rt)===Gs&&++Rt;else if(qi!==o)continue;return X.slice(ti,Li)}return jr=!0,X.slice(ti,it)}for(;(Tr=bn())!==Gu;){for(var Gn=[];Tr!==mu&&Tr!==Gu;)Gn.push(Tr),Tr=bn();fe&&(Gn=fe(Gn,xr++))==null||Xe.push(Gn)}return Xe}function d(X,fe){return X.map(function(Xe){return fe.map(function(it){return ee(Xe[it])}).join(i)})}function y(X,fe){return fe==null&&(fe=gu(X)),[fe.map(ee).join(i)].concat(d(X,fe)).join(`
`)}function A(X,fe){return fe==null&&(fe=gu(X)),d(X,fe).join(`
`)}function M(X){return X.map(D).join(`
`)}function D(X){return X.map(ee).join(i)}function ee(X){return X==null?"":X instanceof Date?Hf(X):f.test(X+="")?'"'+X.replace(/"/g,'""')+'"':X}return{parse:u,parseRows:l,format:y,formatBody:A,formatRows:M,formatRow:D,formatValue:ee}}var Zl=Wf(","),Lf=Zl.parse,vh=Zl.parseRows,ic=Zl.format,Rf=Zl.formatBody,xf=Zl.formatRows,Xf=Zl.formatRow,Vl=Zl.formatValue,Vc=x(6563),Df=x.n(Vc);function Yf(i,f){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(i);f&&(u=u.filter(function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable})),o.push.apply(o,u)}return o}function Kf(i){for(var f=1;f<arguments.length;f++){var o=arguments[f]!=null?arguments[f]:{};f%2?Yf(Object(o),!0).forEach(function(u){(0,F.Z)(i,u,o[u])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):Yf(Object(o)).forEach(function(u){Object.defineProperty(i,u,Object.getOwnPropertyDescriptor(o,u))})}return i}function $f(i,f){var o=f.x,u=f.y,l=f.x1,d=f.y1,y=f.coordinates,A=[];return i.forEach(function(M,D){var ee=[];if(o&&u&&(ee=[parseFloat(M[o]),parseFloat(M[u])]),o&&u&&l&&d){var X=[parseFloat(M[o]),parseFloat(M[u])],fe=[parseFloat(M[l]),parseFloat(M[d])];ee=[X,fe]}if(y){var Xe="Polygon";Array.isArray(y[0])||(Xe="Point"),Array.isArray(y[0])&&!Array.isArray(y[0][0])&&(Xe="LineString");var it={type:Xe,coordinates:(0,ci.Z)(M[y])};Df()(it,!0),ee=it.coordinates}var Rt=Kf(Kf({},M),{},{_id:D,coordinates:ee});A.push(Rt)}),{dataArray:A}}function Jf(i,f){var o=Lf(i);return $f(o,f)}var Qf=x(40271);function mh(i){if(!i)throw new Error("coord is required");if(!Array.isArray(i)){if(i.type==="Feature"&&i.geometry!==null&&i.geometry.type==="Point")return i.geometry.coordinates;if(i.type==="Point")return i.coordinates}if(Array.isArray(i)&&i.length>=2&&!Array.isArray(i[0])&&!Array.isArray(i[1]))return i;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function kf(i){if(Array.isArray(i))return i;if(i.type==="Feature"){if(i.geometry!==null)return i.geometry.coordinates}else if(i.coordinates)return i.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function gh(i){if(i.length>1&&isNumber(i[0])&&isNumber(i[1]))return!0;if(Array.isArray(i[0])&&i[0].length)return gh(i[0]);throw new Error("coordinates must only contain numbers")}function Ou(i,f,o){if(!f||!o)throw new Error("type and name required");if(!i||i.type!==f)throw new Error("Invalid input to "+o+": must be a "+f+", given "+i.type)}function bf(i,f,o){if(!i)throw new Error("No feature passed");if(!o)throw new Error(".featureOf() requires a name");if(!i||i.type!=="Feature"||!i.geometry)throw new Error("Invalid input to "+o+", Feature with geometry required");if(!i.geometry||i.geometry.type!==f)throw new Error("Invalid input to "+o+": must be a "+f+", given "+i.geometry.type)}function yo(i,f,o){if(!i)throw new Error("No featureCollection passed");if(!o)throw new Error(".collectionOf() requires a name");if(!i||i.type!=="FeatureCollection")throw new Error("Invalid input to "+o+", FeatureCollection required");for(var u=0,l=i.features;u<l.length;u++){var d=l[u];if(!d||d.type!=="Feature"||!d.geometry)throw new Error("Invalid input to "+o+", Feature with geometry required");if(!d.geometry||d.geometry.type!==f)throw new Error("Invalid input to "+o+": must be a "+f+", given "+d.geometry.type)}}function nf(i){return i.type==="Feature"?i.geometry:i}function Ff(i,f){return i.type==="FeatureCollection"?"FeatureCollection":i.type==="GeometryCollection"?"GeometryCollection":i.type==="Feature"&&i.geometry!==null?i.geometry.type:i.type}function Al(i,f,o){if(i!==null)for(var u,l,d,y,A,M,D,ee=0,X=0,fe,Xe=i.type,it=Xe==="FeatureCollection",Rt=Xe==="Feature",xr=it?i.features.length:1,Tr=0;Tr<xr;Tr++){D=it?i.features[Tr].geometry:Rt?i.geometry:i,fe=D?D.type==="GeometryCollection":!1,A=fe?D.geometries.length:1;for(var jr=0;jr<A;jr++){var dn=0,bn=0;if(y=fe?D.geometries[jr]:D,y!==null){M=y.coordinates;var Gn=y.type;switch(ee=o&&(Gn==="Polygon"||Gn==="MultiPolygon")?1:0,Gn){case null:break;case"Point":if(f(M,X,Tr,dn,bn)===!1)return!1;X++,dn++;break;case"LineString":case"MultiPoint":for(u=0;u<M.length;u++){if(f(M[u],X,Tr,dn,bn)===!1)return!1;X++,Gn==="MultiPoint"&&dn++}Gn==="LineString"&&dn++;break;case"Polygon":case"MultiLineString":for(u=0;u<M.length;u++){for(l=0;l<M[u].length-ee;l++){if(f(M[u][l],X,Tr,dn,bn)===!1)return!1;X++}Gn==="MultiLineString"&&dn++,Gn==="Polygon"&&bn++}Gn==="Polygon"&&dn++;break;case"MultiPolygon":for(u=0;u<M.length;u++){for(bn=0,l=0;l<M[u].length;l++){for(d=0;d<M[u][l].length-ee;d++){if(f(M[u][l][d],X,Tr,dn,bn)===!1)return!1;X++}bn++}dn++}break;case"GeometryCollection":for(u=0;u<y.geometries.length;u++)if(Al(y.geometries[u],f,o)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function Gc(i,f,o,u){var l=o;return Al(i,function(d,y,A,M,D){y===0&&o===void 0?l=d:l=f(l,d,y,A,M,D)},u),l}function ac(i,f){var o;switch(i.type){case"FeatureCollection":for(o=0;o<i.features.length&&f(i.features[o].properties,o)!==!1;o++);break;case"Feature":f(i.properties,0);break}}function N(i,f,o){var u=o;return ac(i,function(l,d){d===0&&o===void 0?u=l:u=f(u,l,d)}),u}function U(i,f){if(i.type==="Feature")f(i,0);else if(i.type==="FeatureCollection")for(var o=0;o<i.features.length&&f(i.features[o],o)!==!1;o++);}function P(i,f,o){var u=o;return U(i,function(l,d){d===0&&o===void 0?u=l:u=f(u,l,d)}),u}function O(i){var f=[];return Al(i,function(o){f.push(o)}),f}function q(i,f){var o,u,l,d,y,A,M,D,ee,X,fe=0,Xe=i.type==="FeatureCollection",it=i.type==="Feature",Rt=Xe?i.features.length:1;for(o=0;o<Rt;o++){for(A=Xe?i.features[o].geometry:it?i.geometry:i,D=Xe?i.features[o].properties:it?i.properties:{},ee=Xe?i.features[o].bbox:it?i.bbox:void 0,X=Xe?i.features[o].id:it?i.id:void 0,M=A?A.type==="GeometryCollection":!1,y=M?A.geometries.length:1,l=0;l<y;l++){if(d=M?A.geometries[l]:A,d===null){if(f(null,fe,D,ee,X)===!1)return!1;continue}switch(d.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(f(d,fe,D,ee,X)===!1)return!1;break}case"GeometryCollection":{for(u=0;u<d.geometries.length;u++)if(f(d.geometries[u],fe,D,ee,X)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}fe++}}function ve(i,f,o){var u=o;return q(i,function(l,d,y,A,M){d===0&&o===void 0?u=l:u=f(u,l,d,y,A,M)}),u}function $e(i,f){q(i,function(o,u,l,d,y){var A=o===null?null:o.type;switch(A){case null:case"Point":case"LineString":case"Polygon":return f((0,Qf.zL)(o,l,{bbox:d,id:y}),u,0)===!1?!1:void 0}var M;switch(A){case"MultiPoint":M="Point";break;case"MultiLineString":M="LineString";break;case"MultiPolygon":M="Polygon";break}for(var D=0;D<o.coordinates.length;D++){var ee=o.coordinates[D],X={type:M,coordinates:ee};if(f((0,Qf.zL)(X,l),u,D)===!1)return!1}})}function xt(i,f,o){var u=o;return $e(i,function(l,d,y){d===0&&y===0&&o===void 0?u=l:u=f(u,l,d,y)}),u}function vt(i,f){$e(i,function(o,u,l){var d=0;if(!!o.geometry){var y=o.geometry.type;if(!(y==="Point"||y==="MultiPoint")){var A,M=0,D=0,ee=0;if(Al(o,function(X,fe,Xe,it,Rt){if(A===void 0||u>M||it>D||Rt>ee){A=X,M=u,D=it,ee=Rt,d=0;return}var xr=lineString([A,X],o.properties);if(f(xr,u,l,Rt,d)===!1)return!1;d++,A=X})===!1)return!1}}})}function mr(i,f,o){var u=o,l=!1;return vt(i,function(d,y,A,M,D){l===!1&&o===void 0?u=d:u=f(u,d,y,A,M,D),l=!0}),u}function Br(i,f){if(!i)throw new Error("geojson is required");$e(i,function(o,u,l){if(o.geometry!==null){var d=o.geometry.type,y=o.geometry.coordinates;switch(d){case"LineString":if(f(o,u,l,0,0)===!1)return!1;break;case"Polygon":for(var A=0;A<y.length;A++)if(f(lineString(y[A],o.properties),u,l,A)===!1)return!1;break}}})}function In(i,f,o){var u=o;return Br(i,function(l,d,y,A){d===0&&o===void 0?u=l:u=f(u,l,d,y,A)}),u}function Bn(i,f){if(f=f||{},!isObject(f))throw new Error("options is invalid");var o=f.featureIndex||0,u=f.multiFeatureIndex||0,l=f.geometryIndex||0,d=f.segmentIndex||0,y=f.properties,A;switch(i.type){case"FeatureCollection":o<0&&(o=i.features.length+o),y=y||i.features[o].properties,A=i.features[o].geometry;break;case"Feature":y=y||i.properties,A=i.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":A=i;break;default:throw new Error("geojson is invalid")}if(A===null)return null;var M=A.coordinates;switch(A.type){case"Point":case"MultiPoint":return null;case"LineString":return d<0&&(d=M.length+d-1),lineString([M[d],M[d+1]],y,f);case"Polygon":return l<0&&(l=M.length+l),d<0&&(d=M[l].length+d-1),lineString([M[l][d],M[l][d+1]],y,f);case"MultiLineString":return u<0&&(u=M.length+u),d<0&&(d=M[u].length+d-1),lineString([M[u][d],M[u][d+1]],y,f);case"MultiPolygon":return u<0&&(u=M.length+u),l<0&&(l=M[u].length+l),d<0&&(d=M[u][l].length-d-1),lineString([M[u][l][d],M[u][l][d+1]],y,f)}throw new Error("geojson is invalid")}function fi(i,f){if(f=f||{},!isObject(f))throw new Error("options is invalid");var o=f.featureIndex||0,u=f.multiFeatureIndex||0,l=f.geometryIndex||0,d=f.coordIndex||0,y=f.properties,A;switch(i.type){case"FeatureCollection":o<0&&(o=i.features.length+o),y=y||i.features[o].properties,A=i.features[o].geometry;break;case"Feature":y=y||i.properties,A=i.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":A=i;break;default:throw new Error("geojson is invalid")}if(A===null)return null;var M=A.coordinates;switch(A.type){case"Point":return point(M,y,f);case"MultiPoint":return u<0&&(u=M.length+u),point(M[u],y,f);case"LineString":return d<0&&(d=M.length+d),point(M[d],y,f);case"Polygon":return l<0&&(l=M.length+l),d<0&&(d=M[l].length+d),point(M[l][d],y,f);case"MultiLineString":return u<0&&(u=M.length+u),d<0&&(d=M[u].length+d),point(M[u][d],y,f);case"MultiPolygon":return u<0&&(u=M.length+u),l<0&&(l=M[u].length+l),d<0&&(d=M[u][l].length-d),point(M[u][l][d],y,f)}throw new Error("geojson is invalid")}function Ci(i,f){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(i);f&&(u=u.filter(function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable})),o.push.apply(o,u)}return o}function wi(i){for(var f=1;f<arguments.length;f++){var o=arguments[f]!=null?arguments[f]:{};f%2?Ci(Object(o),!0).forEach(function(u){(0,F.Z)(i,u,o[u])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):Ci(Object(o)).forEach(function(u){Object.defineProperty(i,u,Object.getOwnPropertyDescriptor(o,u))})}return i}function ha(i,f){var o=[],u={};if(i.features=i.features.filter(function(d){var y=d.geometry;return d!=null&&y&&y.type&&y.coordinates&&y.coordinates.length>0}),Df()(i,!0),i.features.length===0)return{dataArray:[],featureKeys:u};var l=0;return $e(i,function(d,y){var A=kf(d),M=y,D=wi(wi({},d.properties),{},{coordinates:A,_id:M});o.push(D)}),{dataArray:o,featureKeys:u}}function Ti(i,f){var o=f.extent,u=new Promise(function(d){Va(i,function(y){d(y)})}),l={images:u,_id:1,dataArray:[{_id:0,coordinates:[[o[0],o[1]],[o[2],o[3]]]}]};return l}function Va(i,f){var o=i,u=[];if(typeof o=="string")(0,Ie.gJ)({url:o},function(y,A){u.push(A),f(u)});else{var l=o.length,d=0;o.forEach(function(y){(0,Ie.gJ)({url:y},function(A,M){d++,u.push(M),d===l&&f(u)})})}return Ti}function Bo(i,f){var o=f.extent,u=f.width,l=f.height,d=f.min,y=f.max,A={_id:1,dataArray:[{_id:1,data:Array.from(i),width:u,height:l,min:d,max:y,coordinates:[[o[0],o[1]],[o[2],o[3]]]}]};return A}var Uo=x(30236),us=x.n(Uo),co=x(47037),ya=x.n(co);function pa(i,f){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(i);f&&(u=u.filter(function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable})),o.push.apply(o,u)}return o}function _o(i){for(var f=1;f<arguments.length;f++){var o=arguments[f]!=null?arguments[f]:{};f%2?pa(Object(o),!0).forEach(function(u){(0,F.Z)(i,u,o[u])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):pa(Object(o)).forEach(function(u){Object.defineProperty(i,u,Object.getOwnPropertyDescriptor(o,u))})}return i}function fo(i,f){var o=f.radius,u=o===void 0?40:o,l=f.maxZoom,d=l===void 0?18:l,y=f.minZoom,A=y===void 0?0:y,M=f.zoom,D=M===void 0?2:M;if(i.pointIndex){var ee=i.pointIndex.getClusters(i.extent,Math.floor(D));return i.dataArray=Ga(ee),i}var X=new(tr())({radius:u,minZoom:A,maxZoom:d}),fe={type:"FeatureCollection",features:[]};return fe.features=i.dataArray.map(function(Xe){return{type:"Feature",geometry:{type:"Point",coordinates:Xe.coordinates},properties:_o({},Xe)}}),X.load(fe.features),X}function Ga(i){return i.map(function(f,o){return _o({coordinates:f.geometry.coordinates,_id:o+1},f.properties)})}function $o(i){if(i.length===0)throw new Error("max requires at least one data point");for(var f=i[0],o=1;o<i.length;o++)i[o]>f&&(f=i[o]);return f}function Jo(i){if(i.length===0)throw new Error("min requires at least one data point");for(var f=i[0],o=1;o<i.length;o++)i[o]<f&&(f=i[o]);return f}function oc(i){if(i.length===0)return 0;for(var f=i[0],o=0,u,l=1;l<i.length;l++)u=f+i[l]*1,Math.abs(f)>=Math.abs(i[l])?o+=f-u+i[l]:o+=i[l]-u+f,f=u;return f+o*1}function Gl(i){if(i.length===0)throw new Error("mean requires at least one data point");return oc(i)/i.length}var gs={min:Jo,max:$o,mean:Gl,sum:oc};function iu(i,f){return i.map(function(o){return o[f]*1})}function jo(i,f){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(i);f&&(u=u.filter(function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable})),o.push.apply(o,u)}return o}function Lu(i){for(var f=1;f<arguments.length;f++){var o=arguments[f]!=null?arguments[f]:{};f%2?jo(Object(o),!0).forEach(function(u){(0,F.Z)(i,u,o[u])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):jo(Object(o)).forEach(function(u){Object.defineProperty(i,u,Object.getOwnPropertyDescriptor(o,u))})}return i}function Uh(i){var f=vp();return function(){var u=(0,we.Z)(i),l;if(f){var d=(0,we.Z)(this).constructor;l=Reflect.construct(u,arguments,d)}else l=u.apply(this,arguments);return(0,be.Z)(this,l)}}function vp(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}function mp(i,f){if(Array.isArray(f))return f}var jh=function(i){(0,ne.Z)(o,i);var f=Uh(o);function o(u,l){var d;return(0,Y.Z)(this,o),d=f.call(this),d.data=void 0,d.extent=void 0,d.hooks={init:new ki.ni},d.parser={type:"geojson"},d.transforms=[],d.cluster=!1,d.clusterOptions={enable:!1,radius:40,maxZoom:20,zoom:-99,method:"count"},d.mapService=void 0,d.invalidExtent=!1,d.originData=void 0,d.rawData=void 0,d.cfg={},d.clusterIndex=void 0,d.originData=u,d.initCfg(l),d.hooks.init.tap("parser",function(){d.excuteParser()}),d.hooks.init.tap("cluster",function(){d.initCluster()}),d.hooks.init.tap("transform",function(){d.executeTrans()}),d.init(),d}return(0,le.Z)(o,[{key:"setData",value:function(l,d){this.rawData=l,this.originData=l,this.initCfg(d),this.init(),this.emit("update")}},{key:"getClusters",value:function(l){return this.clusterIndex.getClusters(this.caculClusterExtent(2),l)}},{key:"getClustersLeaves",value:function(l){return this.clusterIndex.getLeaves(l,Infinity)}},{key:"updateClusterData",value:function(l){var d=this,y=this.clusterOptions,A=y.method,M=A===void 0?"sum":A,D=y.field,ee=this.clusterIndex.getClusters(this.caculClusterExtent(2),Math.floor(l));this.clusterOptions.zoom=l,ee.forEach(function(X){X.id||(X.properties.point_count=1)}),(D||ps()(M))&&(ee=ee.map(function(X){var fe=X.id;if(fe){var Xe=d.clusterIndex.getLeaves(fe,Infinity),it=Xe.map(function(Tr){return Tr.properties}),Rt;if(ya()(M)&&D){var xr=iu(it,D);Rt=gs[M](xr)}ps()(M)&&(Rt=M(it)),X.properties.stat=Rt}else X.properties.point_count=1;return X})),this.data=No("geojson")({type:"FeatureCollection",features:ee}),this.executeTrans()}},{key:"getFeatureById",value:function(l){var d=this.parser.type,y=d===void 0?"geojson":d;if(y==="geojson"&&!this.cluster){var A=l<this.originData.features.length?this.originData.features[l]:"null",M=zo()(A);if(this.transforms.length!==0){var D=this.data.dataArray.find(function(ee){return ee._id===l});M.properties=D}return M}else return l<this.data.dataArray.length?this.data.dataArray[l]:"null"}},{key:"getFeatureId",value:function(l,d){var y=this.data.dataArray.find(function(A){return A[l]===name});return y==null?void 0:y._id}},{key:"destroy",value:function(){this.removeAllListeners(),this.originData=null,this.clusterIndex=null,this.data=null}},{key:"caculClusterExtent",value:function(l){var d=[[-Infinity,-Infinity],[Infinity,Infinity]];return this.invalidExtent||(d=(0,Ie.yA)((0,Ie.ds)(this.extent),l)),d[0].concat(d[1])}},{key:"initCfg",value:function(l){this.cfg=us()(this.cfg,l,mp);var d=this.cfg;d&&(d.parser&&(this.parser=d.parser),d.transforms&&(this.transforms=d.transforms),this.cluster=d.cluster||!1,d.clusterOptions&&(this.cluster=!0,this.clusterOptions=Lu(Lu({},this.clusterOptions),d.clusterOptions)))}},{key:"excuteParser",value:function(){var l=this.parser,d=l.type||"geojson",y=No(d);this.data=y(this.originData,l),this.extent=(0,Ie.We)(this.data.dataArray),this.invalidExtent=this.extent[0]===this.extent[2]||this.extent[1]===this.extent[3]}},{key:"executeTrans",value:function(){var l=this,d=this.transforms;d.forEach(function(y){var A=y.type,M=Mu(A)(l.data,y);Object.assign(l.data,M)})}},{key:"initCluster",value:function(){if(!!this.cluster){var l=this.clusterOptions||{};this.clusterIndex=fo(this.data,l)}}},{key:"init",value:function(){this.hooks.init.call(this)}}]),o}($t.EventEmitter);function au(i,f){var o=f.callback;return o&&(i.dataArray=i.dataArray.filter(o)),i}function yh(i,f){var o;if(typeof Symbol=="undefined"||i[Symbol.iterator]==null){if(Array.isArray(i)||(o=Zh(i))||f&&i&&typeof i.length=="number"){o&&(i=o);var u=0,l=function(){};return{s:l,n:function(){return u>=i.length?{done:!0}:{done:!1,value:i[u++]}},e:function(D){throw D},f:l}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var d=!0,y=!1,A;return{s:function(){o=i[Symbol.iterator]()},n:function(){var D=o.next();return d=D.done,D},e:function(D){y=!0,A=D},f:function(){try{!d&&o.return!=null&&o.return()}finally{if(y)throw A}}}}function Zh(i,f){if(!!i){if(typeof i=="string")return _h(i,f);var o=Object.prototype.toString.call(i).slice(8,-1);if(o==="Object"&&i.constructor&&(o=i.constructor.name),o==="Map"||o==="Set")return Array.from(i);if(o==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return _h(i,f)}}function _h(i,f){(f==null||f>i.length)&&(f=i.length);for(var o=0,u=new Array(f);o<f;o++)u[o]=i[o];return u}var xh=6378e3;function Vh(i,f){var o=i.dataArray,u=f.size,l=u===void 0?10:u,d=l/(2*Math.PI*xh)*(256<<20)/2,y=gp(o,l),A=y.gridHash,M=y.gridOffset,D=yp(A,M,f);return{yOffset:d,xOffset:d,radius:d,type:"grid",dataArray:D}}function gp(i,f){var o=Infinity,u=-Infinity,l,d=yh(i),y;try{for(d.s();!(y=d.n()).done;){var A=y.value;l=A.coordinates[1],Number.isFinite(l)&&(o=l<o?l:o,u=l>u?l:u)}}catch(dn){d.e(dn)}finally{d.f()}var M=(o+u)/2,D=Gh(f,M);if(D.xOffset<=0||D.yOffset<=0)return{gridHash:{},gridOffset:D};var ee={},X=yh(i),fe;try{for(X.s();!(fe=X.n()).done;){var Xe=fe.value,it=Xe.coordinates[1],Rt=Xe.coordinates[0];if(Number.isFinite(it)&&Number.isFinite(Rt)){var xr=Math.floor((it+90)/D.yOffset),Tr=Math.floor((Rt+180)/D.xOffset),jr="".concat(xr,"-").concat(Tr);ee[jr]=ee[jr]||{count:0,points:[]},ee[jr].count+=1,ee[jr].points.push(Xe)}}}catch(dn){X.e(dn)}finally{X.f()}return{gridHash:ee,gridOffset:D}}function Gh(i,f){var o=Hh(i),u=bh(f,i);return{yOffset:o,xOffset:u}}function Hh(i){return i/xh*(180/Math.PI)}function bh(i,f){return f/xh*(180/Math.PI)/Math.cos(i*Math.PI/180)}function yp(i,f,o){return Object.keys(i).reduce(function(u,l,d){var y=l.split("-"),A=parseInt(y[0],10),M=parseInt(y[1],10),D={};if(o.field&&o.method){var ee=Ie.a5.getColumn(i[l].points,o.field);D[o.method]=Ie.a5.statMap[o.method](ee)}return Object.assign(D,{_id:d,coordinates:(0,Ie.Z)([-180+f.xOffset*(M+.5),-90+f.yOffset*(A+.5)]),rawData:i[l].points,count:i[l].count}),u.push(D),u},[])}var Sf=Math.PI/3,Ef=[0,Sf,2*Sf,3*Sf,4*Sf,5*Sf];function Wh(i){return i[0]}function j(i){return i[1]}function Se(){var i=0,f=0,o=1,u=1,l=Wh,d=j,y,A,M;function D(X){var fe={},Xe=[],it,Rt=X.length;for(it=0;it<Rt;++it)if(!(isNaN(Tr=+l.call(null,xr=X[it],it,X))||isNaN(jr=+d.call(null,xr,it,X)))){var xr,Tr,jr,dn=Math.round(jr=jr/M),bn=Math.round(Tr=Tr/A-(dn&1)/2),Gn=jr-dn;if(Math.abs(Gn)*3>1){var Li=Tr-bn,ti=bn+(Tr<bn?-1:1)/2,qi=dn+(jr<dn?-1:1),za=Tr-ti,Ua=jr-qi;Li*Li+Gn*Gn>za*za+Ua*Ua&&(bn=ti+(dn&1?1:-1)/2,dn=qi)}var di=bn+"-"+dn,Ca=fe[di];Ca?Ca.push(xr):(Xe.push(Ca=fe[di]=[xr]),Ca.x=(bn+(dn&1)/2)*A,Ca.y=dn*M)}return Xe}function ee(X){var fe=0,Xe=0;return Ef.map(function(it){var Rt=Math.sin(it)*X,xr=-Math.cos(it)*X,Tr=Rt-fe,jr=xr-Xe;return fe=Rt,Xe=xr,[Tr,jr]})}return D.hexagon=function(X){return"m"+ee(X==null?y:+X).join("l")+"z"},D.centers=function(){for(var X=[],fe=Math.round(f/M),Xe=Math.round(i/A),it=fe*M;it<u+y;it+=M,++fe)for(var Rt=Xe*A+(fe&1)*A/2;Rt<o+A/2;Rt+=A)X.push([Rt,it]);return X},D.mesh=function(){var X=ee(y).slice(0,4).join("l");return D.centers().map(function(fe){return"M"+fe+"m"+X}).join("")},D.x=function(X){return arguments.length?(l=X,D):l},D.y=function(X){return arguments.length?(d=X,D):d},D.radius=function(X){return arguments.length?(y=+X,A=y*2*Math.sin(Sf),M=y*1.5,D):y},D.size=function(X){return arguments.length?(i=f=0,o=+X[0],u=+X[1],D):[o-i,u-f]},D.extent=function(X){return arguments.length?(i=+X[0][0],f=+X[0][1],o=+X[1][0],u=+X[1][1],D):[[i,f],[o,u]]},D.radius(1)}function ke(i,f){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(i);f&&(u=u.filter(function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable})),o.push.apply(o,u)}return o}function qt(i){for(var f=1;f<arguments.length;f++){var o=arguments[f]!=null?arguments[f]:{};f%2?ke(Object(o),!0).forEach(function(u){(0,F.Z)(i,u,o[u])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):ke(Object(o)).forEach(function(u){Object.defineProperty(i,u,Object.getOwnPropertyDescriptor(o,u))})}return i}var wr=6378e3;function Yt(i,f){var o=i.dataArray,u=f.size,l=u===void 0?10:u,d=f.method,y=d===void 0?"sum":d,A=l/(2*Math.PI*wr)*(256<<20)/2,M=o.map(function(fe){var Xe=(0,Ie.Z)(fe.coordinates),it=(0,Q.Z)(Xe,2),Rt=it[0],xr=it[1];return qt(qt({},fe),{},{coordinates:[Rt,xr]})}),D=Se().radius(A).x(function(fe){return fe.coordinates[0]}).y(function(fe){return fe.coordinates[1]}),ee=D(M),X={dataArray:ee.map(function(fe,Xe){var it;if(f.field&&y){var Rt=Ie.a5.getColumn(fe,f.field);fe[y]=Ie.a5.statMap[y](Rt)}return it={},(0,F.Z)(it,f.method,fe[y]),(0,F.Z)(it,"count",fe.length),(0,F.Z)(it,"rawData",fe),(0,F.Z)(it,"coordinates",[fe.x,fe.y]),(0,F.Z)(it,"_id",Xe),it}),radius:A,xOffset:A,yOffset:A,type:"hexagon"};return X}function pr(i,f){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(i);f&&(u=u.filter(function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable})),o.push.apply(o,u)}return o}function Zr(i){for(var f=1;f<arguments.length;f++){var o=arguments[f]!=null?arguments[f]:{};f%2?pr(Object(o),!0).forEach(function(u){(0,F.Z)(i,u,o[u])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):pr(Object(o)).forEach(function(u){Object.defineProperty(i,u,Object.getOwnPropertyDescriptor(o,u))})}return i}function Wr(i,f){var o=f.sourceField,u=f.targetField,l=f.data,d={};return l.forEach(function(y){d[y[o]]=y}),i.dataArray=i.dataArray.map(function(y){var A=y[u];return Zr(Zr({},y),d[A])}),i}function en(i,f){var o=f.callback;return o&&(i.dataArray=i.dataArray.map(o)),i}var Kr=x(4771),an=jh;go("geojson",ha),go("image",Ti),go("csv",Jf),go("json",$f),go("raster",Bo),ru("cluster",fo),ru("filter",au),ru("join",Wr),ru("map",en),ru("grid",Vh),ru("hexagon",Yt);var fn,Vr,on,zt=(fn=(0,H.b2)(),fn(Vr=(on=function(){function i(){(0,Y.Z)(this,i),this.mapService=void 0}return(0,le.Z)(i,[{key:"apply",value:function(o){var u=this;this.mapService=o.getContainer().get(w.vK.IMapService),o.hooks.init.tap("DataSourcePlugin",function(){var l=o.getSource();if(!l){var d=o.sourceOption,y=d.data,A=d.options;o.setSource(new an(y,A))}u.updateClusterData(o)}),o.hooks.beforeRenderData.tap("DataSourcePlugin",function(){var l=u.updateClusterData(o),d=o.dataState.dataSourceNeedUpdate;return o.dataState.dataSourceNeedUpdate=!1,l||d})}},{key:"updateClusterData",value:function(o){var u=o.getSource(),l=u.cluster,d=u.clusterOptions,y=d.zoom,A=y===void 0?0:y,M=d.maxZoom,D=M===void 0?16:M,ee=this.mapService.getZoom()-1,X=o.dataState.dataSourceNeedUpdate;return l&&(X||Math.abs(A-ee)>1)&&D>A?(u.updateClusterData(Math.floor(ee)),!0):!1}}]),i}(),on))||Vr),fr=x(44908),Gr=x.n(fr),mn=x(14293),Dr=x.n(mn);function En(i,f){return i<f?-1:i>f?1:i>=f?0:NaN}function zr(i){return i.length===1&&(i=sn(i)),{left:function(f,o,u,l){for(u==null&&(u=0),l==null&&(l=f.length);u<l;){var d=u+l>>>1;i(f[d],o)<0?u=d+1:l=d}return u},right:function(f,o,u,l){for(u==null&&(u=0),l==null&&(l=f.length);u<l;){var d=u+l>>>1;i(f[d],o)>0?l=d:u=d+1}return u}}}function sn(i){return function(f,o){return En(i(f),o)}}var Rr=zr(En),nn=Rr.right,Kn=Rr.left,Yn=nn;function un(i,f){var o=i.length,u=-1,l,d,y;if(f==null){for(;++u<o;)if((l=i[u])!=null&&l>=l)for(d=y=l;++u<o;)(l=i[u])!=null&&(d>l&&(d=l),y<l&&(y=l))}else for(;++u<o;)if((l=f(i[u],u,i))!=null&&l>=l)for(d=y=l;++u<o;)(l=f(i[u],u,i))!=null&&(d>l&&(d=l),y<l&&(y=l));return[d,y]}var kr=Array.prototype,Or=kr.slice,ui=kr.map,qn=Math.sqrt(50),Ln=Math.sqrt(10),Bi=Math.sqrt(2);function Ai(i,f,o){var u,l=-1,d,y,A;if(f=+f,i=+i,o=+o,i===f&&o>0)return[i];if((u=f<i)&&(d=i,i=f,f=d),(A=Mi(i,f,o))===0||!isFinite(A))return[];if(A>0)for(i=Math.ceil(i/A),f=Math.floor(f/A),y=new Array(d=Math.ceil(f-i+1));++l<d;)y[l]=(i+l)*A;else for(i=Math.floor(i*A),f=Math.ceil(f*A),y=new Array(d=Math.ceil(i-f+1));++l<d;)y[l]=(i-l)/A;return u&&y.reverse(),y}function Mi(i,f,o){var u=(f-i)/Math.max(0,o),l=Math.floor(Math.log(u)/Math.LN10),d=u/Math.pow(10,l);return l>=0?(d>=qn?10:d>=Ln?5:d>=Bi?2:1)*Math.pow(10,l):-Math.pow(10,-l)/(d>=qn?10:d>=Ln?5:d>=Bi?2:1)}function na(i,f,o){var u=Math.abs(f-i)/Math.max(0,o),l=Math.pow(10,Math.floor(Math.log(u)/Math.LN10)),d=u/l;return d>=qn?l*=10:d>=Ln?l*=5:d>=Bi&&(l*=2),f<i?-l:l}function Qo(){var i=identity,f=extent,o=sturges;function u(l){var d,y=l.length,A,M=new Array(y);for(d=0;d<y;++d)M[d]=i(l[d],d,l);var D=f(M),ee=D[0],X=D[1],fe=o(M,ee,X);Array.isArray(fe)||(fe=tickStep(ee,X,fe),fe=range(Math.ceil(ee/fe)*fe,X,fe));for(var Xe=fe.length;fe[0]<=ee;)fe.shift(),--Xe;for(;fe[Xe-1]>X;)fe.pop(),--Xe;var it=new Array(Xe+1),Rt;for(d=0;d<=Xe;++d)Rt=it[d]=[],Rt.x0=d>0?fe[d-1]:ee,Rt.x1=d<Xe?fe[d]:X;for(d=0;d<y;++d)A=M[d],ee<=A&&A<=X&&it[bisect(fe,A,0,Xe)].push(l[d]);return it}return u.value=function(l){return arguments.length?(i=typeof l=="function"?l:constant(l),u):i},u.domain=function(l){return arguments.length?(f=typeof l=="function"?l:constant([l[0],l[1]]),u):f},u.thresholds=function(l){return arguments.length?(o=typeof l=="function"?l:Array.isArray(l)?constant(slice.call(l)):constant(l),u):o},u}function Rs(i,f,o){return i=map.call(i,number).sort(ascending),Math.ceil((o-f)/(2*(quantile(i,.75)-quantile(i,.25))*Math.pow(i.length,-1/3)))}function Qi(i){return i===null?NaN:+i}function Eo(i,f,o){if(o==null&&(o=Qi),!!(u=i.length)){if((f=+f)<=0||u<2)return+o(i[0],0,i);if(f>=1)return+o(i[u-1],u-1,i);var u,l=(u-1)*f,d=Math.floor(l),y=+o(i[d],d,i),A=+o(i[d+1],d+1,i);return y+(A-y)*(l-d)}}var ua="$";function wo(){}wo.prototype=qo.prototype={constructor:wo,has:function(i){return ua+i in this},get:function(i){return this[ua+i]},set:function(i,f){return this[ua+i]=f,this},remove:function(i){var f=ua+i;return f in this&&delete this[f]},clear:function(){for(var i in this)i[0]===ua&&delete this[i]},keys:function(){var i=[];for(var f in this)f[0]===ua&&i.push(f.slice(1));return i},values:function(){var i=[];for(var f in this)f[0]===ua&&i.push(this[f]);return i},entries:function(){var i=[];for(var f in this)f[0]===ua&&i.push({key:f.slice(1),value:this[f]});return i},size:function(){var i=0;for(var f in this)f[0]===ua&&++i;return i},empty:function(){for(var i in this)if(i[0]===ua)return!1;return!0},each:function(i){for(var f in this)f[0]===ua&&i(this[f],f.slice(1),this)}};function qo(i,f){var o=new wo;if(i instanceof wo)i.each(function(A,M){o.set(M,A)});else if(Array.isArray(i)){var u=-1,l=i.length,d;if(f==null)for(;++u<l;)o.set(u,i[u]);else for(;++u<l;)o.set(f(d=i[u],u,i),d)}else if(i)for(var y in i)o.set(y,i[y]);return o}var es=qo;function Ds(){var i=[],f=[],o,u,l;function d(A,M,D,ee){if(M>=i.length)return o!=null&&A.sort(o),u!=null?u(A):A;for(var X=-1,fe=A.length,Xe=i[M++],it,Rt,xr=map(),Tr,jr=D();++X<fe;)(Tr=xr.get(it=Xe(Rt=A[X])+""))?Tr.push(Rt):xr.set(it,[Rt]);return xr.each(function(dn,bn){ee(jr,bn,d(dn,M,D,ee))}),jr}function y(A,M){if(++M>i.length)return A;var D,ee=f[M-1];return u!=null&&M>=i.length?D=A.entries():(D=[],A.each(function(X,fe){D.push({key:fe,values:y(X,M)})})),ee!=null?D.sort(function(X,fe){return ee(X.key,fe.key)}):D}return l={object:function(A){return d(A,0,ks,Zo)},map:function(A){return d(A,0,Ii,Fs)},entries:function(A){return y(d(A,0,Ii,Fs),0)},key:function(A){return i.push(A),l},sortKeys:function(A){return f[i.length-1]=A,l},sortValues:function(A){return o=A,l},rollup:function(A){return u=A,l}}}function ks(){return{}}function Zo(i,f,o){i[f]=o}function Ii(){return map()}function Fs(i,f,o){i.set(f,o)}function la(){}var $n=es.prototype;la.prototype=Hi.prototype={constructor:la,has:$n.has,add:function(i){return i+="",this[ua+i]=i,this},remove:$n.remove,clear:$n.clear,values:$n.keys,size:$n.size,empty:$n.empty,each:$n.each};function Hi(i,f){var o=new la;if(i instanceof la)i.each(function(d){o.add(d)});else if(i){var u=-1,l=i.length;if(f==null)for(;++u<l;)o.add(i[u]);else for(;++u<l;)o.add(f(i[u],u,i))}return o}var ia=null,Io=Array.prototype,yu=Io.map,_u=Io.slice;function Fe(i,f){switch(arguments.length){case 0:break;case 1:this.range(i);break;default:this.range(f).domain(i);break}return this}function er(i,f){switch(arguments.length){case 0:break;case 1:this.interpolator(i);break;default:this.interpolator(f).domain(i);break}return this}var Wt={name:"implicit"};function An(){var i=es(),f=[],o=[],u=Wt;function l(d){var y=d+"",A=i.get(y);if(!A){if(u!==Wt)return u;i.set(y,A=f.push(d))}return o[(A-1)%o.length]}return l.domain=function(d){if(!arguments.length)return f.slice();f=[],i=es();for(var y=-1,A=d.length,M,D;++y<A;)i.has(D=(M=d[y])+"")||i.set(D,f.push(M));return l},l.range=function(d){return arguments.length?(o=_u.call(d),l):o.slice()},l.unknown=function(d){return arguments.length?(u=d,l):u},l.copy=function(){return An(f,o).unknown(u)},Fe.apply(l,arguments),l}function Vi(){var i=ordinal().unknown(void 0),f=i.domain,o=i.range,u=[0,1],l,d,y=!1,A=0,M=0,D=.5;delete i.unknown;function ee(){var X=f().length,fe=u[1]<u[0],Xe=u[fe-0],it=u[1-fe];l=(it-Xe)/Math.max(1,X-A+M*2),y&&(l=Math.floor(l)),Xe+=(it-Xe-l*(X-A))*D,d=l*(1-A),y&&(Xe=Math.round(Xe),d=Math.round(d));var Rt=sequence(X).map(function(xr){return Xe+l*xr});return o(fe?Rt.reverse():Rt)}return i.domain=function(X){return arguments.length?(f(X),ee()):f()},i.range=function(X){return arguments.length?(u=[+X[0],+X[1]],ee()):u.slice()},i.rangeRound=function(X){return u=[+X[0],+X[1]],y=!0,ee()},i.bandwidth=function(){return d},i.step=function(){return l},i.round=function(X){return arguments.length?(y=!!X,ee()):y},i.padding=function(X){return arguments.length?(A=Math.min(1,M=+X),ee()):A},i.paddingInner=function(X){return arguments.length?(A=Math.min(1,X),ee()):A},i.paddingOuter=function(X){return arguments.length?(M=+X,ee()):M},i.align=function(X){return arguments.length?(D=Math.max(0,Math.min(1,X)),ee()):D},i.copy=function(){return Vi(f(),u).round(y).paddingInner(A).paddingOuter(M).align(D)},initRange.apply(ee(),arguments)}function Oe(i){var f=i.copy;return i.padding=i.paddingOuter,delete i.paddingInner,delete i.paddingOuter,i.copy=function(){return Oe(f())},i}function _e(){return Oe(Vi.apply(null,arguments).paddingInner(1))}var at=x(26257),Ot=x(73626);function kt(i,f){return i=+i,f=+f,function(o){return Math.round(i*(1-o)+f*o)}}function ft(i){return function(){return i}}function ot(i){return+i}var St=[0,1];function Me(i){return i}function qe(i,f){return(f-=i=+i)?function(o){return(o-i)/f}:ft(isNaN(f)?NaN:.5)}function Ce(i){var f=i[0],o=i[i.length-1],u;return f>o&&(u=f,f=o,o=u),function(l){return Math.max(f,Math.min(o,l))}}function At(i,f,o){var u=i[0],l=i[1],d=f[0],y=f[1];return l<u?(u=qe(l,u),d=o(y,d)):(u=qe(u,l),d=o(d,y)),function(A){return d(u(A))}}function Bt(i,f,o){var u=Math.min(i.length,f.length)-1,l=new Array(u),d=new Array(u),y=-1;for(i[u]<i[0]&&(i=i.slice().reverse(),f=f.slice().reverse());++y<u;)l[y]=qe(i[y],i[y+1]),d[y]=o(f[y],f[y+1]);return function(A){var M=Yn(i,A,1,u)-1;return d[M](l[M](A))}}function Sr(i,f){return f.domain(i.domain()).range(i.range()).interpolate(i.interpolate()).clamp(i.clamp()).unknown(i.unknown())}function Kt(){var i=St,f=St,o=at.Z,u,l,d,y=Me,A,M,D;function ee(){return A=Math.min(i.length,f.length)>2?Bt:At,M=D=null,X}function X(fe){return isNaN(fe=+fe)?d:(M||(M=A(i.map(u),f,o)))(u(y(fe)))}return X.invert=function(fe){return y(l((D||(D=A(f,i.map(u),Ot.Z)))(fe)))},X.domain=function(fe){return arguments.length?(i=yu.call(fe,ot),y===Me||(y=Ce(i)),ee()):i.slice()},X.range=function(fe){return arguments.length?(f=_u.call(fe),ee()):f.slice()},X.rangeRound=function(fe){return f=_u.call(fe),o=kt,ee()},X.clamp=function(fe){return arguments.length?(y=fe?Ce(i):Me,X):y!==Me},X.interpolate=function(fe){return arguments.length?(o=fe,ee()):o},X.unknown=function(fe){return arguments.length?(d=fe,X):d},function(fe,Xe){return u=fe,l=Xe,ee()}}function br(i,f){return Kt()(i,f)}var Xr=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Fn(i){if(!(f=Xr.exec(i)))throw new Error("invalid format: "+i);var f;return new Oi({fill:f[1],align:f[2],sign:f[3],symbol:f[4],zero:f[5],width:f[6],comma:f[7],precision:f[8]&&f[8].slice(1),trim:f[9],type:f[10]})}Fn.prototype=Oi.prototype;function Oi(i){this.fill=i.fill===void 0?" ":i.fill+"",this.align=i.align===void 0?">":i.align+"",this.sign=i.sign===void 0?"-":i.sign+"",this.symbol=i.symbol===void 0?"":i.symbol+"",this.zero=!!i.zero,this.width=i.width===void 0?void 0:+i.width,this.comma=!!i.comma,this.precision=i.precision===void 0?void 0:+i.precision,this.trim=!!i.trim,this.type=i.type===void 0?"":i.type+""}Oi.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function zn(i){return Math.abs(i=Math.round(i))>=1e21?i.toLocaleString("en").replace(/,/g,""):i.toString(10)}function ni(i,f){if((o=(i=f?i.toExponential(f-1):i.toExponential()).indexOf("e"))<0)return null;var o,u=i.slice(0,o);return[u.length>1?u[0]+u.slice(2):u,+i.slice(o+1)]}function gi(i){return i=ni(Math.abs(i)),i?i[1]:NaN}function da(i,f){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(gi(f)/3)))*3-gi(Math.abs(i)))}function Vo(i,f){return function(o,u){for(var l=o.length,d=[],y=0,A=i[0],M=0;l>0&&A>0&&(M+A+1>u&&(A=Math.max(1,u-M)),d.push(o.substring(l-=A,l+A)),!((M+=A+1)>u));)A=i[y=(y+1)%i.length];return d.reverse().join(f)}}function Ru(i){return function(f){return f.replace(/[0-9]/g,function(o){return i[+o]})}}function qf(i){e:for(var f=i.length,o=1,u=-1,l;o<f;++o)switch(i[o]){case".":u=l=o;break;case"0":u===0&&(u=o),l=o;break;default:if(!+i[o])break e;u>0&&(u=0);break}return u>0?i.slice(0,u)+i.slice(l+1):i}var Hu;function Sh(i,f){var o=ni(i,f);if(!o)return i+"";var u=o[0],l=o[1],d=l-(Hu=Math.max(-8,Math.min(8,Math.floor(l/3)))*3)+1,y=u.length;return d===y?u:d>y?u+new Array(d-y+1).join("0"):d>0?u.slice(0,d)+"."+u.slice(d):"0."+new Array(1-d).join("0")+ni(i,Math.max(0,f+d-1))[0]}function ol(i,f){var o=ni(i,f);if(!o)return i+"";var u=o[0],l=o[1];return l<0?"0."+new Array(-l).join("0")+u:u.length>l+1?u.slice(0,l+1)+"."+u.slice(l+1):u+new Array(l-u.length+2).join("0")}var wf={"%":function(i,f){return(i*100).toFixed(f)},b:function(i){return Math.round(i).toString(2)},c:function(i){return i+""},d:zn,e:function(i,f){return i.toExponential(f)},f:function(i,f){return i.toFixed(f)},g:function(i,f){return i.toPrecision(f)},o:function(i){return Math.round(i).toString(8)},p:function(i,f){return ol(i*100,f)},r:ol,s:Sh,X:function(i){return Math.round(i).toString(16).toUpperCase()},x:function(i){return Math.round(i).toString(16)}};function Tf(i){return i}var Xh=Array.prototype.map,zf=["y","z","a","f","p","n","\xB5","m","","k","M","G","T","P","E","Z","Y"];function Up(i){var f=i.grouping===void 0||i.thousands===void 0?Tf:Vo(Xh.call(i.grouping,Number),i.thousands+""),o=i.currency===void 0?"":i.currency[0]+"",u=i.currency===void 0?"":i.currency[1]+"",l=i.decimal===void 0?".":i.decimal+"",d=i.numerals===void 0?Tf:Ru(Xh.call(i.numerals,String)),y=i.percent===void 0?"%":i.percent+"",A=i.minus===void 0?"-":i.minus+"",M=i.nan===void 0?"NaN":i.nan+"";function D(X){X=Fn(X);var fe=X.fill,Xe=X.align,it=X.sign,Rt=X.symbol,xr=X.zero,Tr=X.width,jr=X.comma,dn=X.precision,bn=X.trim,Gn=X.type;Gn==="n"?(jr=!0,Gn="g"):wf[Gn]||(dn===void 0&&(dn=12),bn=!0,Gn="g"),(xr||fe==="0"&&Xe==="=")&&(xr=!0,fe="0",Xe="=");var Li=Rt==="$"?o:Rt==="#"&&/[boxX]/.test(Gn)?"0"+Gn.toLowerCase():"",ti=Rt==="$"?u:/[%p]/.test(Gn)?y:"",qi=wf[Gn],za=/[defgprs%]/.test(Gn);dn=dn===void 0?6:/[gprs]/.test(Gn)?Math.max(1,Math.min(21,dn)):Math.max(0,Math.min(20,dn));function Ua(di){var Ca=Li,ao=ti,Wu,fp,hp;if(Gn==="c")ao=qi(di)+ao,di="";else{di=+di;var pp=di<0||1/di<0;if(di=isNaN(di)?M:qi(Math.abs(di),dn),bn&&(di=qf(di)),pp&&+di==0&&it!=="+"&&(pp=!1),Ca=(pp?it==="("?it:A:it==="-"||it==="("?"":it)+Ca,ao=(Gn==="s"?zf[8+Hu/3]:"")+ao+(pp&&it==="("?")":""),za){for(Wu=-1,fp=di.length;++Wu<fp;)if(hp=di.charCodeAt(Wu),48>hp||hp>57){ao=(hp===46?l+di.slice(Wu+1):di.slice(Wu))+ao,di=di.slice(0,Wu);break}}}jr&&!xr&&(di=f(di,Infinity));var dp=Ca.length+di.length+ao.length,mf=dp<Tr?new Array(Tr-dp+1).join(fe):"";switch(jr&&xr&&(di=f(mf+di,mf.length?Tr-ao.length:Infinity),mf=""),Xe){case"<":di=Ca+di+ao+mf;break;case"=":di=Ca+mf+di+ao;break;case"^":di=mf.slice(0,dp=mf.length>>1)+Ca+di+ao+mf.slice(dp);break;default:di=mf+Ca+di+ao;break}return d(di)}return Ua.toString=function(){return X+""},Ua}function ee(X,fe){var Xe=D((X=Fn(X),X.type="f",X)),it=Math.max(-8,Math.min(8,Math.floor(gi(fe)/3)))*3,Rt=Math.pow(10,-it),xr=zf[8+it/3];return function(Tr){return Xe(Rt*Tr)+xr}}return{format:D,formatPrefix:ee}}var Go,io,_p;jp({decimal:".",thousands:",",grouping:[3],currency:["$",""],minus:"-"});function jp(i){return Go=Up(i),io=Go.format,_p=Go.formatPrefix,Go}function Zp(i,f){return i=Math.abs(i),f=Math.abs(f)-i,Math.max(0,gi(f)-gi(i))+1}function Vp(i){return Math.max(0,-gi(Math.abs(i)))}function Gp(i,f,o,u){var l=na(i,f,o),d;switch(u=Fn(u==null?",f":u),u.type){case"s":{var y=Math.max(Math.abs(i),Math.abs(f));return u.precision==null&&!isNaN(d=da(l,y))&&(u.precision=d),_p(u,y)}case"":case"e":case"g":case"p":case"r":{u.precision==null&&!isNaN(d=Zp(l,Math.max(Math.abs(i),Math.abs(f))))&&(u.precision=d-(u.type==="e"));break}case"f":case"%":{u.precision==null&&!isNaN(d=Vp(l))&&(u.precision=d-(u.type==="%")*2);break}}return io(u)}function eh(i){var f=i.domain;return i.ticks=function(o){var u=f();return Ai(u[0],u[u.length-1],o==null?10:o)},i.tickFormat=function(o,u){var l=f();return Gp(l[0],l[l.length-1],o==null?10:o,u)},i.nice=function(o){o==null&&(o=10);var u=f(),l=0,d=u.length-1,y=u[l],A=u[d],M;return A<y&&(M=y,y=A,A=M,M=l,l=d,d=M),M=Mi(y,A,o),M>0?(y=Math.floor(y/M)*M,A=Math.ceil(A/M)*M,M=Mi(y,A,o)):M<0&&(y=Math.ceil(y*M)/M,A=Math.floor(A*M)/M,M=Mi(y,A,o)),M>0?(u[l]=Math.floor(y/M)*M,u[d]=Math.ceil(A/M)*M,f(u)):M<0&&(u[l]=Math.ceil(y*M)/M,u[d]=Math.floor(A*M)/M,f(u)),i},i}function Af(){var i=br(Me,Me);return i.copy=function(){return Sr(i,Af())},Fe.apply(i,arguments),eh(i)}function Cf(i){var f;function o(u){return isNaN(u=+u)?f:u}return o.invert=o,o.domain=o.range=function(u){return arguments.length?(i=yu.call(u,ot),o):i.slice()},o.unknown=function(u){return arguments.length?(f=u,o):f},o.copy=function(){return Cf(i).unknown(f)},i=arguments.length?yu.call(i,ot):[0,1],eh(o)}function xp(i,f){i=i.slice();var o=0,u=i.length-1,l=i[o],d=i[u],y;return d<l&&(y=o,o=u,u=y,y=l,l=d,d=y),i[o]=f.floor(l),i[u]=f.ceil(d),i}function ls(i){return Math.log(i)}function th(i){return Math.exp(i)}function af(i){return-Math.log(-i)}function Yh(i){return-Math.exp(-i)}function Kh(i){return isFinite(i)?+("1e"+i):i<0?0:i}function bp(i){return i===10?Kh:i===Math.E?Math.exp:function(f){return Math.pow(i,f)}}function rh(i){return i===Math.E?Math.log:i===10&&Math.log10||i===2&&Math.log2||(i=Math.log(i),function(f){return Math.log(f)/i})}function Hc(i){return function(f){return-i(-f)}}function Hp(i){var f=i(ls,th),o=f.domain,u=10,l,d;function y(){return l=rh(u),d=bp(u),o()[0]<0?(l=Hc(l),d=Hc(d),i(af,Yh)):i(ls,th),f}return f.base=function(A){return arguments.length?(u=+A,y()):u},f.domain=function(A){return arguments.length?(o(A),y()):o()},f.ticks=function(A){var M=o(),D=M[0],ee=M[M.length-1],X;(X=ee<D)&&(fe=D,D=ee,ee=fe);var fe=l(D),Xe=l(ee),it,Rt,xr,Tr=A==null?10:+A,jr=[];if(!(u%1)&&Xe-fe<Tr){if(fe=Math.round(fe)-1,Xe=Math.round(Xe)+1,D>0){for(;fe<Xe;++fe)for(Rt=1,it=d(fe);Rt<u;++Rt)if(xr=it*Rt,!(xr<D)){if(xr>ee)break;jr.push(xr)}}else for(;fe<Xe;++fe)for(Rt=u-1,it=d(fe);Rt>=1;--Rt)if(xr=it*Rt,!(xr<D)){if(xr>ee)break;jr.push(xr)}}else jr=Ai(fe,Xe,Math.min(Xe-fe,Tr)).map(d);return X?jr.reverse():jr},f.tickFormat=function(A,M){if(M==null&&(M=u===10?".0e":","),typeof M!="function"&&(M=io(M)),A===Infinity)return M;A==null&&(A=10);var D=Math.max(1,u*A/f.ticks().length);return function(ee){var X=ee/d(Math.round(l(ee)));return X*u<u-.5&&(X*=u),X<=D?M(ee):""}},f.nice=function(){return o(xp(o(),{floor:function(A){return d(Math.floor(l(A)))},ceil:function(A){return d(Math.ceil(l(A)))}}))},f}function Sp(){var i=Hp(Kt()).domain([1,10]);return i.copy=function(){return Sr(i,Sp()).base(i.base())},Fe.apply(i,arguments),i}function Wp(i){return function(f){return Math.sign(f)*Math.log1p(Math.abs(f/i))}}function Ts(i){return function(f){return Math.sign(f)*Math.expm1(Math.abs(f))*i}}function Pf(i){var f=1,o=i(Wp(f),Ts(f));return o.constant=function(u){return arguments.length?i(Wp(f=+u),Ts(f)):f},linearish(o)}function Xp(){var i=Pf(transformer());return i.copy=function(){return copy(i,Xp()).constant(i.constant())},initRange.apply(i,arguments)}function e(i){return function(f){return f<0?-Math.pow(-f,i):Math.pow(f,i)}}function t(i){return i<0?-Math.sqrt(-i):Math.sqrt(i)}function r(i){return i<0?-i*i:i*i}function c(i){var f=i(Me,Me),o=1;function u(){return o===1?i(Me,Me):o===.5?i(t,r):i(e(o),e(1/o))}return f.exponent=function(l){return arguments.length?(o=+l,u()):o},eh(f)}function v(){var i=c(Kt());return i.copy=function(){return Sr(i,v()).exponent(i.exponent())},Fe.apply(i,arguments),i}function m(){return v.apply(null,arguments).exponent(.5)}function _(){var i=[],f=[],o=[],u;function l(){var y=0,A=Math.max(1,f.length);for(o=new Array(A-1);++y<A;)o[y-1]=Eo(i,y/A);return d}function d(y){return isNaN(y=+y)?u:f[Yn(o,y)]}return d.invertExtent=function(y){var A=f.indexOf(y);return A<0?[NaN,NaN]:[A>0?o[A-1]:i[0],A<o.length?o[A]:i[i.length-1]]},d.domain=function(y){if(!arguments.length)return i.slice();i=[];for(var A=0,M=y.length,D;A<M;++A)D=y[A],D!=null&&!isNaN(D=+D)&&i.push(D);return i.sort(En),l()},d.range=function(y){return arguments.length?(f=_u.call(y),l()):f.slice()},d.unknown=function(y){return arguments.length?(u=y,d):u},d.quantiles=function(){return o.slice()},d.copy=function(){return _().domain(i).range(f).unknown(u)},Fe.apply(d,arguments)}function C(){var i=0,f=1,o=1,u=[.5],l=[0,1],d;function y(M){return M<=M?l[Yn(u,M,0,o)]:d}function A(){var M=-1;for(u=new Array(o);++M<o;)u[M]=((M+1)*f-(M-o)*i)/(o+1);return y}return y.domain=function(M){return arguments.length?(i=+M[0],f=+M[1],A()):[i,f]},y.range=function(M){return arguments.length?(o=(l=_u.call(M)).length-1,A()):l.slice()},y.invertExtent=function(M){var D=l.indexOf(M);return D<0?[NaN,NaN]:D<1?[i,u[0]]:D>=o?[u[o-1],f]:[u[D-1],u[D]]},y.unknown=function(M){return arguments.length&&(d=M),y},y.thresholds=function(){return u.slice()},y.copy=function(){return C().domain([i,f]).range(l).unknown(d)},Fe.apply(eh(y),arguments)}function k(){var i=[.5],f=[0,1],o,u=1;function l(d){return d<=d?f[Yn(i,d,0,u)]:o}return l.domain=function(d){return arguments.length?(i=_u.call(d),u=Math.min(i.length,f.length-1),l):i.slice()},l.range=function(d){return arguments.length?(f=_u.call(d),u=Math.min(i.length,f.length-1),l):f.slice()},l.invertExtent=function(d){var y=f.indexOf(d);return[i[y-1],i[y]]},l.unknown=function(d){return arguments.length?(o=d,l):o},l.copy=function(){return k().domain(i).range(f).unknown(o)},Fe.apply(l,arguments)}var B=new Date,W=new Date;function K(i,f,o,u){function l(d){return i(d=arguments.length===0?new Date:new Date(+d)),d}return l.floor=function(d){return i(d=new Date(+d)),d},l.ceil=function(d){return i(d=new Date(d-1)),f(d,1),i(d),d},l.round=function(d){var y=l(d),A=l.ceil(d);return d-y<A-d?y:A},l.offset=function(d,y){return f(d=new Date(+d),y==null?1:Math.floor(y)),d},l.range=function(d,y,A){var M=[],D;if(d=l.ceil(d),A=A==null?1:Math.floor(A),!(d<y)||!(A>0))return M;do M.push(D=new Date(+d)),f(d,A),i(d);while(D<d&&d<y);return M},l.filter=function(d){return K(function(y){if(y>=y)for(;i(y),!d(y);)y.setTime(y-1)},function(y,A){if(y>=y)if(A<0)for(;++A<=0;)for(;f(y,-1),!d(y););else for(;--A>=0;)for(;f(y,1),!d(y););})},o&&(l.count=function(d,y){return B.setTime(+d),W.setTime(+y),i(B),i(W),Math.floor(o(B,W))},l.every=function(d){return d=Math.floor(d),!isFinite(d)||!(d>0)?null:d>1?l.filter(u?function(y){return u(y)%d==0}:function(y){return l.count(0,y)%d==0}):l}),l}var oe=K(function(i){i.setMonth(0,1),i.setHours(0,0,0,0)},function(i,f){i.setFullYear(i.getFullYear()+f)},function(i,f){return f.getFullYear()-i.getFullYear()},function(i){return i.getFullYear()});oe.every=function(i){return!isFinite(i=Math.floor(i))||!(i>0)?null:K(function(f){f.setFullYear(Math.floor(f.getFullYear()/i)*i),f.setMonth(0,1),f.setHours(0,0,0,0)},function(f,o){f.setFullYear(f.getFullYear()+o*i)})};var ce=oe,Ve=oe.range,We=K(function(i){i.setDate(1),i.setHours(0,0,0,0)},function(i,f){i.setMonth(i.getMonth()+f)},function(i,f){return f.getMonth()-i.getMonth()+(f.getFullYear()-i.getFullYear())*12},function(i){return i.getMonth()}),st=We,et=We.range,Tt=1e3,Ut=6e4,nr=36e5,hr=864e5,Mr=6048e5;function Yr(i){return K(function(f){f.setDate(f.getDate()-(f.getDay()+7-i)%7),f.setHours(0,0,0,0)},function(f,o){f.setDate(f.getDate()+o*7)},function(f,o){return(o-f-(o.getTimezoneOffset()-f.getTimezoneOffset())*Ut)/Mr})}var hn=Yr(0),Hn=Yr(1),wn=Yr(2),Jn=Yr(3),yn=Yr(4),Ui=Yr(5),hi=Yr(6),Zn=hn.range,ea=Hn.range,zi=wn.range,ca=Jn.range,ei=yn.range,wa=Ui.range,To=hi.range,Oo=K(function(i){i.setHours(0,0,0,0)},function(i,f){i.setDate(i.getDate()+f)},function(i,f){return(f-i-(f.getTimezoneOffset()-i.getTimezoneOffset())*Ut)/hr},function(i){return i.getDate()-1}),xo=Oo,Ao=Oo.range,Lo=K(function(i){i.setTime(i-i.getMilliseconds()-i.getSeconds()*Tt-i.getMinutes()*Ut)},function(i,f){i.setTime(+i+f*nr)},function(i,f){return(f-i)/nr},function(i){return i.getHours()}),As=Lo,zs=Lo.range,ou=K(function(i){i.setTime(i-i.getMilliseconds()-i.getSeconds()*Tt)},function(i,f){i.setTime(+i+f*Ut)},function(i,f){return(f-i)/Ut},function(i){return i.getMinutes()}),Ns=ou,Du=ou.range,Ho=K(function(i){i.setTime(i-i.getMilliseconds())},function(i,f){i.setTime(+i+f*Tt)},function(i,f){return(f-i)/Tt},function(i){return i.getUTCSeconds()}),Bs=Ho,aa=Ho.range,Ia=K(function(){},function(i,f){i.setTime(+i+f)},function(i,f){return f-i});Ia.every=function(i){return i=Math.floor(i),!isFinite(i)||!(i>0)?null:i>1?K(function(f){f.setTime(Math.floor(f/i)*i)},function(f,o){f.setTime(+f+o*i)},function(f,o){return(o-f)/i}):Ia};var Fa=Ia,va=Ia.range;function ys(i){return K(function(f){f.setUTCDate(f.getUTCDate()-(f.getUTCDay()+7-i)%7),f.setUTCHours(0,0,0,0)},function(f,o){f.setUTCDate(f.getUTCDate()+o*7)},function(f,o){return(o-f)/Mr})}var Hs=ys(0),Ha=ys(1),cs=ys(2),su=ys(3),oa=ys(4),Wc=ys(5),Cl=ys(6),of=Hs.range,fs=Ha.range,sf=cs.range,Ec=su.range,Eh=oa.range,nh=Wc.range,wh=Cl.range,Xc=K(function(i){i.setUTCHours(0,0,0,0)},function(i,f){i.setUTCDate(i.getUTCDate()+f)},function(i,f){return(f-i)/hr},function(i){return i.getUTCDate()-1}),Nf=Xc,Ep=Xc.range,Mf=K(function(i){i.setUTCMonth(0,1),i.setUTCHours(0,0,0,0)},function(i,f){i.setUTCFullYear(i.getUTCFullYear()+f)},function(i,f){return f.getUTCFullYear()-i.getUTCFullYear()},function(i){return i.getUTCFullYear()});Mf.every=function(i){return!isFinite(i=Math.floor(i))||!(i>0)?null:K(function(f){f.setUTCFullYear(Math.floor(f.getUTCFullYear()/i)*i),f.setUTCMonth(0,1),f.setUTCHours(0,0,0,0)},function(f,o){f.setUTCFullYear(f.getUTCFullYear()+o*i)})};var uf=Mf,wp=Mf.range;function ih(i){if(0<=i.y&&i.y<100){var f=new Date(-1,i.m,i.d,i.H,i.M,i.S,i.L);return f.setFullYear(i.y),f}return new Date(i.y,i.m,i.d,i.H,i.M,i.S,i.L)}function wc(i){if(0<=i.y&&i.y<100){var f=new Date(Date.UTC(-1,i.m,i.d,i.H,i.M,i.S,i.L));return f.setUTCFullYear(i.y),f}return new Date(Date.UTC(i.y,i.m,i.d,i.H,i.M,i.S,i.L))}function lf(i,f,o){return{y:i,m:f,d:o,H:0,M:0,S:0,L:0}}function ah(i){var f=i.dateTime,o=i.date,u=i.time,l=i.periods,d=i.days,y=i.shortDays,A=i.months,M=i.shortMonths,D=If(l),ee=ff(l),X=If(d),fe=ff(d),Xe=If(y),it=ff(y),Rt=If(A),xr=ff(A),Tr=If(M),jr=ff(M),dn={a:pp,A:dp,b:mf,B:Jy,c:null,d:hf,e:hf,f:np,g:rd,G:op,H:Ap,I:$p,j:rp,L:Ac,m:Ih,M:ip,p:Qy,q:qy,Q:kp,s:sp,S:ap,u:Cp,U:Jp,V:Qp,w:qp,W:ed,x:null,X:null,y:td,Y:Pl,Z:nd,"%":Dp},bn={a:e0,A:t0,b:r0,B:n0,c:null,d:Cc,e:Cc,f:ch,g:Op,G:ld,H:Md,I:id,j:jf,L:Zf,m:fh,M:hh,p:i0,q:a0,Q:kp,s:sp,S:ad,u:od,U:sd,V:Mp,w:Ip,W:pf,x:null,X:null,y:ud,Y:Lp,Z:Rp,"%":Dp},Gn={a:Ua,A:di,b:Ca,B:ao,c:Wu,d:ep,e:ep,f:Mh,g:sh,G:Bf,H:tp,I:tp,j:Yp,L:Cd,m:uh,M:Kp,p:za,q:Ph,Q:Tc,s:Pd,S:Tp,u:Ch,U:Qh,V:oh,w:Ah,W:qh,x:fp,X:hp,y:sh,Y:Bf,Z:Uf,"%":ts};dn.x=Li(o,dn),dn.X=Li(u,dn),dn.c=Li(f,dn),bn.x=Li(o,bn),bn.X=Li(u,bn),bn.c=Li(f,bn);function Li(yi,ja){return function(ho){var Pn=[],sc=-1,hs=0,Pc=yi.length,Mc,Bh,Rm;for(ho instanceof Date||(ho=new Date(+ho));++sc<Pc;)yi.charCodeAt(sc)===37&&(Pn.push(yi.slice(hs,sc)),(Bh=cf[Mc=yi.charAt(++sc)])!=null?Mc=yi.charAt(++sc):Bh=Mc==="e"?" ":"0",(Rm=ja[Mc])&&(Mc=Rm(ho,Bh)),Pn.push(Mc),hs=sc+1);return Pn.push(yi.slice(hs,sc)),Pn.join("")}}function ti(yi,ja){return function(ho){var Pn=lf(1900,void 0,1),sc=qi(Pn,yi,ho+="",0),hs,Pc;if(sc!=ho.length)return null;if("Q"in Pn)return new Date(Pn.Q);if("s"in Pn)return new Date(Pn.s*1e3+("L"in Pn?Pn.L:0));if(ja&&!("Z"in Pn)&&(Pn.Z=0),"p"in Pn&&(Pn.H=Pn.H%12+Pn.p*12),Pn.m===void 0&&(Pn.m="q"in Pn?Pn.q:0),"V"in Pn){if(Pn.V<1||Pn.V>53)return null;"w"in Pn||(Pn.w=1),"Z"in Pn?(hs=wc(lf(Pn.y,0,1)),Pc=hs.getUTCDay(),hs=Pc>4||Pc===0?Ha.ceil(hs):Ha(hs),hs=Nf.offset(hs,(Pn.V-1)*7),Pn.y=hs.getUTCFullYear(),Pn.m=hs.getUTCMonth(),Pn.d=hs.getUTCDate()+(Pn.w+6)%7):(hs=ih(lf(Pn.y,0,1)),Pc=hs.getDay(),hs=Pc>4||Pc===0?Hn.ceil(hs):Hn(hs),hs=xo.offset(hs,(Pn.V-1)*7),Pn.y=hs.getFullYear(),Pn.m=hs.getMonth(),Pn.d=hs.getDate()+(Pn.w+6)%7)}else("W"in Pn||"U"in Pn)&&("w"in Pn||(Pn.w="u"in Pn?Pn.u%7:"W"in Pn?1:0),Pc="Z"in Pn?wc(lf(Pn.y,0,1)).getUTCDay():ih(lf(Pn.y,0,1)).getDay(),Pn.m=0,Pn.d="W"in Pn?(Pn.w+6)%7+Pn.W*7-(Pc+5)%7:Pn.w+Pn.U*7-(Pc+6)%7);return"Z"in Pn?(Pn.H+=Pn.Z/100|0,Pn.M+=Pn.Z%100,wc(Pn)):ih(Pn)}}function qi(yi,ja,ho,Pn){for(var sc=0,hs=ja.length,Pc=ho.length,Mc,Bh;sc<hs;){if(Pn>=Pc)return-1;if(Mc=ja.charCodeAt(sc++),Mc===37){if(Mc=ja.charAt(sc++),Bh=Gn[Mc in cf?ja.charAt(sc++):Mc],!Bh||(Pn=Bh(yi,ho,Pn))<0)return-1}else if(Mc!=ho.charCodeAt(Pn++))return-1}return Pn}function za(yi,ja,ho){var Pn=D.exec(ja.slice(ho));return Pn?(yi.p=ee[Pn[0].toLowerCase()],ho+Pn[0].length):-1}function Ua(yi,ja,ho){var Pn=Xe.exec(ja.slice(ho));return Pn?(yi.w=it[Pn[0].toLowerCase()],ho+Pn[0].length):-1}function di(yi,ja,ho){var Pn=X.exec(ja.slice(ho));return Pn?(yi.w=fe[Pn[0].toLowerCase()],ho+Pn[0].length):-1}function Ca(yi,ja,ho){var Pn=Tr.exec(ja.slice(ho));return Pn?(yi.m=jr[Pn[0].toLowerCase()],ho+Pn[0].length):-1}function ao(yi,ja,ho){var Pn=Rt.exec(ja.slice(ho));return Pn?(yi.m=xr[Pn[0].toLowerCase()],ho+Pn[0].length):-1}function Wu(yi,ja,ho){return qi(yi,f,ja,ho)}function fp(yi,ja,ho){return qi(yi,o,ja,ho)}function hp(yi,ja,ho){return qi(yi,u,ja,ho)}function pp(yi){return y[yi.getDay()]}function dp(yi){return d[yi.getDay()]}function mf(yi){return M[yi.getMonth()]}function Jy(yi){return A[yi.getMonth()]}function Qy(yi){return l[+(yi.getHours()>=12)]}function qy(yi){return 1+~~(yi.getMonth()/3)}function e0(yi){return y[yi.getUTCDay()]}function t0(yi){return d[yi.getUTCDay()]}function r0(yi){return M[yi.getUTCMonth()]}function n0(yi){return A[yi.getUTCMonth()]}function i0(yi){return l[+(yi.getUTCHours()>=12)]}function a0(yi){return 1+~~(yi.getUTCMonth()/3)}return{format:function(yi){var ja=Li(yi+="",dn);return ja.toString=function(){return yi},ja},parse:function(yi){var ja=ti(yi+="",!1);return ja.toString=function(){return yi},ja},utcFormat:function(yi){var ja=Li(yi+="",bn);return ja.toString=function(){return yi},ja},utcParse:function(yi){var ja=ti(yi+="",!0);return ja.toString=function(){return yi},ja}}}var cf={"-":"",_:" ","0":"0"},_s=/^\s*\d+/,$h=/^%/,Jh=/[\\^$*+?|[\]().{}]/g;function Oa(i,f,o){var u=i<0?"-":"",l=(u?-i:i)+"",d=l.length;return u+(d<o?new Array(o-d+1).join(f)+l:l)}function Th(i){return i.replace(Jh,"\\$&")}function If(i){return new RegExp("^(?:"+i.map(Th).join("|")+")","i")}function ff(i){for(var f={},o=-1,u=i.length;++o<u;)f[i[o].toLowerCase()]=o;return f}function Ah(i,f,o){var u=_s.exec(f.slice(o,o+1));return u?(i.w=+u[0],o+u[0].length):-1}function Ch(i,f,o){var u=_s.exec(f.slice(o,o+1));return u?(i.u=+u[0],o+u[0].length):-1}function Qh(i,f,o){var u=_s.exec(f.slice(o,o+2));return u?(i.U=+u[0],o+u[0].length):-1}function oh(i,f,o){var u=_s.exec(f.slice(o,o+2));return u?(i.V=+u[0],o+u[0].length):-1}function qh(i,f,o){var u=_s.exec(f.slice(o,o+2));return u?(i.W=+u[0],o+u[0].length):-1}function Bf(i,f,o){var u=_s.exec(f.slice(o,o+4));return u?(i.y=+u[0],o+u[0].length):-1}function sh(i,f,o){var u=_s.exec(f.slice(o,o+2));return u?(i.y=+u[0]+(+u[0]>68?1900:2e3),o+u[0].length):-1}function Uf(i,f,o){var u=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(f.slice(o,o+6));return u?(i.Z=u[1]?0:-(u[2]+(u[3]||"00")),o+u[0].length):-1}function Ph(i,f,o){var u=_s.exec(f.slice(o,o+1));return u?(i.q=u[0]*3-3,o+u[0].length):-1}function uh(i,f,o){var u=_s.exec(f.slice(o,o+2));return u?(i.m=u[0]-1,o+u[0].length):-1}function ep(i,f,o){var u=_s.exec(f.slice(o,o+2));return u?(i.d=+u[0],o+u[0].length):-1}function Yp(i,f,o){var u=_s.exec(f.slice(o,o+3));return u?(i.m=0,i.d=+u[0],o+u[0].length):-1}function tp(i,f,o){var u=_s.exec(f.slice(o,o+2));return u?(i.H=+u[0],o+u[0].length):-1}function Kp(i,f,o){var u=_s.exec(f.slice(o,o+2));return u?(i.M=+u[0],o+u[0].length):-1}function Tp(i,f,o){var u=_s.exec(f.slice(o,o+2));return u?(i.S=+u[0],o+u[0].length):-1}function Cd(i,f,o){var u=_s.exec(f.slice(o,o+3));return u?(i.L=+u[0],o+u[0].length):-1}function Mh(i,f,o){var u=_s.exec(f.slice(o,o+6));return u?(i.L=Math.floor(u[0]/1e3),o+u[0].length):-1}function ts(i,f,o){var u=$h.exec(f.slice(o,o+1));return u?o+u[0].length:-1}function Tc(i,f,o){var u=_s.exec(f.slice(o));return u?(i.Q=+u[0],o+u[0].length):-1}function Pd(i,f,o){var u=_s.exec(f.slice(o));return u?(i.s=+u[0],o+u[0].length):-1}function hf(i,f){return Oa(i.getDate(),f,2)}function Ap(i,f){return Oa(i.getHours(),f,2)}function $p(i,f){return Oa(i.getHours()%12||12,f,2)}function rp(i,f){return Oa(1+xo.count(ce(i),i),f,3)}function Ac(i,f){return Oa(i.getMilliseconds(),f,3)}function np(i,f){return Ac(i,f)+"000"}function Ih(i,f){return Oa(i.getMonth()+1,f,2)}function ip(i,f){return Oa(i.getMinutes(),f,2)}function ap(i,f){return Oa(i.getSeconds(),f,2)}function Cp(i){var f=i.getDay();return f===0?7:f}function Jp(i,f){return Oa(hn.count(ce(i)-1,i),f,2)}function lh(i){var f=i.getDay();return f>=4||f===0?yn(i):yn.ceil(i)}function Qp(i,f){return i=lh(i),Oa(yn.count(ce(i),i)+(ce(i).getDay()===4),f,2)}function qp(i){return i.getDay()}function ed(i,f){return Oa(Hn.count(ce(i)-1,i),f,2)}function td(i,f){return Oa(i.getFullYear()%100,f,2)}function rd(i,f){return i=lh(i),Oa(i.getFullYear()%100,f,2)}function Pl(i,f){return Oa(i.getFullYear()%1e4,f,4)}function op(i,f){var o=i.getDay();return i=o>=4||o===0?yn(i):yn.ceil(i),Oa(i.getFullYear()%1e4,f,4)}function nd(i){var f=i.getTimezoneOffset();return(f>0?"-":(f*=-1,"+"))+Oa(f/60|0,"0",2)+Oa(f%60,"0",2)}function Cc(i,f){return Oa(i.getUTCDate(),f,2)}function Md(i,f){return Oa(i.getUTCHours(),f,2)}function id(i,f){return Oa(i.getUTCHours()%12||12,f,2)}function jf(i,f){return Oa(1+Nf.count(uf(i),i),f,3)}function Zf(i,f){return Oa(i.getUTCMilliseconds(),f,3)}function ch(i,f){return Zf(i,f)+"000"}function fh(i,f){return Oa(i.getUTCMonth()+1,f,2)}function hh(i,f){return Oa(i.getUTCMinutes(),f,2)}function ad(i,f){return Oa(i.getUTCSeconds(),f,2)}function od(i){var f=i.getUTCDay();return f===0?7:f}function sd(i,f){return Oa(Hs.count(uf(i)-1,i),f,2)}function Pp(i){var f=i.getUTCDay();return f>=4||f===0?oa(i):oa.ceil(i)}function Mp(i,f){return i=Pp(i),Oa(oa.count(uf(i),i)+(uf(i).getUTCDay()===4),f,2)}function Ip(i){return i.getUTCDay()}function pf(i,f){return Oa(Ha.count(uf(i)-1,i),f,2)}function ud(i,f){return Oa(i.getUTCFullYear()%100,f,2)}function Op(i,f){return i=Pp(i),Oa(i.getUTCFullYear()%100,f,2)}function Lp(i,f){return Oa(i.getUTCFullYear()%1e4,f,4)}function ld(i,f){var o=i.getUTCDay();return i=o>=4||o===0?oa(i):oa.ceil(i),Oa(i.getUTCFullYear()%1e4,f,4)}function Rp(){return"+0000"}function Dp(){return"%"}function kp(i){return+i}function sp(i){return Math.floor(+i/1e3)}var Vf,ph,cd,up,Id;fd({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function fd(i){return Vf=ah(i),ph=Vf.format,cd=Vf.parse,up=Vf.utcFormat,Id=Vf.utcParse,Vf}var Oh=1e3,Lh=Oh*60,Rh=Lh*60,Dh=Rh*24,Od=Dh*7,hd=Dh*30,Fp=Dh*365;function Ld(i){return new Date(i)}function Yc(i){return i instanceof Date?+i:+new Date(+i)}function kh(i,f,o,u,l,d,y,A,M){var D=br(Me,Me),ee=D.invert,X=D.domain,fe=M(".%L"),Xe=M(":%S"),it=M("%I:%M"),Rt=M("%I %p"),xr=M("%a %d"),Tr=M("%b %d"),jr=M("%B"),dn=M("%Y"),bn=[[y,1,Oh],[y,5,5*Oh],[y,15,15*Oh],[y,30,30*Oh],[d,1,Lh],[d,5,5*Lh],[d,15,15*Lh],[d,30,30*Lh],[l,1,Rh],[l,3,3*Rh],[l,6,6*Rh],[l,12,12*Rh],[u,1,Dh],[u,2,2*Dh],[o,1,Od],[f,1,hd],[f,3,3*hd],[i,1,Fp]];function Gn(ti){return(y(ti)<ti?fe:d(ti)<ti?Xe:l(ti)<ti?it:u(ti)<ti?Rt:f(ti)<ti?o(ti)<ti?xr:Tr:i(ti)<ti?jr:dn)(ti)}function Li(ti,qi,za,Ua){if(ti==null&&(ti=10),typeof ti=="number"){var di=Math.abs(za-qi)/ti,Ca=zr(function(ao){return ao[2]}).right(bn,di);Ca===bn.length?(Ua=na(qi/Fp,za/Fp,ti),ti=i):Ca?(Ca=bn[di/bn[Ca-1][2]<bn[Ca][2]/di?Ca-1:Ca],Ua=Ca[1],ti=Ca[0]):(Ua=Math.max(na(qi,za,ti),1),ti=A)}return Ua==null?ti:ti.every(Ua)}return D.invert=function(ti){return new Date(ee(ti))},D.domain=function(ti){return arguments.length?X(yu.call(ti,Yc)):X().map(Ld)},D.ticks=function(ti,qi){var za=X(),Ua=za[0],di=za[za.length-1],Ca=di<Ua,ao;return Ca&&(ao=Ua,Ua=di,di=ao),ao=Li(ti,Ua,di,qi),ao=ao?ao.range(Ua,di+1):[],Ca?ao.reverse():ao},D.tickFormat=function(ti,qi){return qi==null?Gn:M(qi)},D.nice=function(ti,qi){var za=X();return(ti=Li(ti,za[0],za[za.length-1],qi))?X(xp(za,ti)):D},D.copy=function(){return Sr(D,kh(i,f,o,u,l,d,y,A,M))},D}function pd(){return Fe.apply(kh(ce,st,hn,xo,As,Ns,Bs,Fa,ph).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function lp(){return initRange.apply(calendar(utcYear,utcMonth,utcWeek,utcDay,utcHour,utcMinute,utcSecond,utcMillisecond,utcFormat).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function Fh(){var i=0,f=1,o,u,l,d,y=identity,A=!1,M;function D(ee){return isNaN(ee=+ee)?M:y(l===0?.5:(ee=(d(ee)-o)*l,A?Math.max(0,Math.min(1,ee)):ee))}return D.domain=function(ee){return arguments.length?(o=d(i=+ee[0]),u=d(f=+ee[1]),l=o===u?0:1/(u-o),D):[i,f]},D.clamp=function(ee){return arguments.length?(A=!!ee,D):A},D.interpolator=function(ee){return arguments.length?(y=ee,D):y},D.unknown=function(ee){return arguments.length?(M=ee,D):M},function(ee){return d=ee,o=ee(i),u=ee(f),l=o===u?0:1/(u-o),D}}function dd(i,f){return f.domain(i.domain()).interpolator(i.interpolator()).clamp(i.clamp()).unknown(i.unknown())}function Dm(){var i=linearish(Fh()(identity));return i.copy=function(){return dd(i,Dm())},initInterpolator.apply(i,arguments)}function km(){var i=loggish(Fh()).domain([1,10]);return i.copy=function(){return dd(i,km()).base(i.base())},initInterpolator.apply(i,arguments)}function Fm(){var i=symlogish(Fh());return i.copy=function(){return dd(i,Fm()).constant(i.constant())},initInterpolator.apply(i,arguments)}function jd(){var i=powish(Fh());return i.copy=function(){return dd(i,jd()).exponent(i.exponent())},initInterpolator.apply(i,arguments)}function o0(){return jd.apply(null,arguments).exponent(.5)}function zm(){var i=[],f=identity;function o(u){if(!isNaN(u=+u))return f((bisect(i,u)-1)/(i.length-1))}return o.domain=function(u){if(!arguments.length)return i.slice();i=[];for(var l=0,d=u.length,y;l<d;++l)y=u[l],y!=null&&!isNaN(y=+y)&&i.push(y);return i.sort(ascending),o},o.interpolator=function(u){return arguments.length?(f=u,o):f},o.copy=function(){return zm(f).domain(i)},initInterpolator.apply(o,arguments)}function vd(){var i=0,f=.5,o=1,u,l,d,y,A,M=identity,D,ee=!1,X;function fe(Xe){return isNaN(Xe=+Xe)?X:(Xe=.5+((Xe=+D(Xe))-l)*(Xe<l?y:A),M(ee?Math.max(0,Math.min(1,Xe)):Xe))}return fe.domain=function(Xe){return arguments.length?(u=D(i=+Xe[0]),l=D(f=+Xe[1]),d=D(o=+Xe[2]),y=u===l?0:.5/(l-u),A=l===d?0:.5/(d-l),fe):[i,f,o]},fe.clamp=function(Xe){return arguments.length?(ee=!!Xe,fe):ee},fe.interpolator=function(Xe){return arguments.length?(M=Xe,fe):M},fe.unknown=function(Xe){return arguments.length?(X=Xe,fe):X},function(Xe){return D=Xe,u=Xe(i),l=Xe(f),d=Xe(o),y=u===l?0:.5/(l-u),A=l===d?0:.5/(d-l),fe}}function Nm(){var i=linearish(vd()(identity));return i.copy=function(){return copy(i,Nm())},initInterpolator.apply(i,arguments)}function Bm(){var i=loggish(vd()).domain([.1,1,10]);return i.copy=function(){return copy(i,Bm()).base(i.base())},initInterpolator.apply(i,arguments)}function Um(){var i=symlogish(vd());return i.copy=function(){return copy(i,Um()).constant(i.constant())},initInterpolator.apply(i,arguments)}function Zd(){var i=powish(vd());return i.copy=function(){return copy(i,Zd()).exponent(i.exponent())},initInterpolator.apply(i,arguments)}function s0(){return Zd.apply(null,arguments).exponent(.5)}var df,Vd,Gd,Hd,Wd,md,Xd,Yd,Kd,jm=/^(?:(?!0000)[0-9]{4}([-/.]+)(?:(?:0?[1-9]|1[0-2])\1(?:0?[1-9]|1[0-9]|2[0-8])|(?:0?[13-9]|1[0-2])\1(?:29|30)|(?:0?[13578]|1[02])\1(?:31))|(?:[0-9]{2}(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)([-/.]?)0?2\2(?:29))(\s+([01]|([01][0-9]|2[0-3])):([0-9]|[0-5][0-9]):([0-9]|[0-5][0-9]))?$/,Zm=(df={},(0,F.Z)(df,w.ScaleTypes.LINEAR,Af),(0,F.Z)(df,w.ScaleTypes.POWER,v),(0,F.Z)(df,w.ScaleTypes.LOG,Sp),(0,F.Z)(df,w.ScaleTypes.IDENTITY,Cf),(0,F.Z)(df,w.ScaleTypes.TIME,pd),(0,F.Z)(df,w.ScaleTypes.QUANTILE,_),(0,F.Z)(df,w.ScaleTypes.QUANTIZE,C),(0,F.Z)(df,w.ScaleTypes.THRESHOLD,k),(0,F.Z)(df,w.ScaleTypes.CAT,An),df),Vm=(Vd=(0,H.b2)(),Gd=(0,H.f3)(w.vK.IGlobalConfigService),Hd=(0,H.f3)(w.vK.ILogService),Vd(Wd=(md=(Kd=function(){function i(){(0,Y.Z)(this,i),(0,Rn.Z)(this,"configService",Xd,this),(0,Rn.Z)(this,"logger",Yd,this),this.scaleCache={},this.scaleOptions={}}return(0,le.Z)(i,[{key:"apply",value:function(o,u){var l=this,d=u.styleAttributeService;o.hooks.init.tap("FeatureScalePlugin",function(){l.scaleOptions=o.getScaleOptions();var y=d.getLayerStyleAttributes(),A=o.getSource().data.dataArray;A.length!==0&&l.caculateScalesForAttributes(y||[],A)}),o.hooks.beforeRenderData.tap("FeatureScalePlugin",function(){l.scaleOptions=o.getScaleOptions();var y=d.getLayerStyleAttributes(),A=o.getSource().data.dataArray;return l.caculateScalesForAttributes(y||[],A),o.layerModelNeedUpdate=!0,!0}),o.hooks.beforeRender.tap("FeatureScalePlugin",function(){if(!o.layerModelNeedUpdate){l.scaleOptions=o.getScaleOptions();var y=d.getLayerStyleAttributes();if(y){var A=o.getSource().data.dataArray;if(A.length===0)return;var M=y.filter(function(D){return D.needRescale});M.length&&(l.caculateScalesForAttributes(M,A),l.logger.debug("rescale finished"))}}})}},{key:"isNumber",value:function(o){return!isNaN(parseFloat(o))&&isFinite(o)}},{key:"caculateScalesForAttributes",value:function(o,u){var l=this;this.scaleCache={},o.forEach(function(d){if(d.scale){var y=d.scale,A=d.name;y.names=l.parseFields(d.scale.field||[]);var M=[];y.names.forEach(function(D){M.push(l.getOrCreateScale(D,d,u))}),M.some(function(D){return D.type===w.StyleScaleType.VARIABLE})?(y.type=w.StyleScaleType.VARIABLE,M.forEach(function(D){if(!y.callback){var ee;if(y.values&&y.values!=="text"){var X;if(((X=D.option)===null||X===void 0?void 0:X.type)==="linear"&&y.values.length>2){var fe=D.scale.ticks(y.values.length);A==="color"&&D.scale.domain(fe)}D.scale.range(y.values)}else((ee=D.option)===null||ee===void 0?void 0:ee.type)==="cat"&&D.scale.range(D.option.domain)}})):(y.type=w.StyleScaleType.CONSTANT,y.defaultValues=M.map(function(D,ee){return D.scale(y.names[ee])})),y.scalers=M.map(function(D){return{field:D.field,func:D.scale,option:D.option}}),d.needRescale=!1}})}},{key:"getOrCreateScale",value:function(o,u,l){var d,y=[o,u.name].join("_"),A=(d=u.scale)===null||d===void 0?void 0:d.values,M=this.createScale(o,u.name,A,l);return M}},{key:"parseFields",value:function(o){return Array.isArray(o)?o:ya()(o)?o.split("*"):[o]}},{key:"createScale",value:function(o,u,l,d){var y,A,M=this.scaleOptions[u]&&((y=this.scaleOptions[u])===null||y===void 0?void 0:y.field)===o?this.scaleOptions[u]:this.scaleOptions[o],D={field:o,scale:void 0,type:w.StyleScaleType.VARIABLE,option:M};if(!d||!d.length)return M&&M.type?D.scale=this.createDefaultScale(M):(D.scale=An([o]),D.type=w.StyleScaleType.CONSTANT),D;var ee=(A=d.find(function(Xe){return!Dr()(Xe[o])}))===null||A===void 0?void 0:A[o];if(this.isNumber(o)||Dr()(ee)&&!M)D.scale=An([o]),D.type=w.StyleScaleType.CONSTANT;else{var X=M&&M.type||this.getDefaultType(ee);l==="text"&&(X=w.ScaleTypes.CAT);var fe=this.createDefaultScaleConfig(X,o,d);Object.assign(fe,M),D.scale=this.createDefaultScale(fe),D.option=fe}return D}},{key:"getDefaultType",value:function(o){var u=w.ScaleTypes.LINEAR;return typeof o=="string"&&(u=jm.test(o)?w.ScaleTypes.TIME:w.ScaleTypes.CAT),u}},{key:"createDefaultScaleConfig",value:function(o,u,l){var d={type:o},y=(l==null?void 0:l.map(function(A){return A[u]}))||[];return o!==w.ScaleTypes.CAT&&o!==w.ScaleTypes.QUANTILE?d.domain=un(y):o===w.ScaleTypes.CAT?d.domain=Gr()(y):o===w.ScaleTypes.QUANTILE&&(d.domain=y),d}},{key:"createDefaultScale",value:function(o){var u=o.type,l=o.domain,d=Zm[u]();return l&&d.domain(l),d}}]),i}(),Kd),Xd=(0,Dn.Z)(md.prototype,"configService",[Gd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Yd=(0,Dn.Z)(md.prototype,"logger",[Hd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),md))||Wd),$d,Jd,Qd,qd,gd,ev,tv,rv;function nv(i,f){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(i);f&&(u=u.filter(function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable})),o.push.apply(o,u)}return o}function Gm(i){for(var f=1;f<arguments.length;f++){var o=arguments[f]!=null?arguments[f]:{};f%2?nv(Object(o),!0).forEach(function(u){(0,F.Z)(i,u,o[u])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):nv(Object(o)).forEach(function(u){Object.defineProperty(i,u,Object.getOwnPropertyDescriptor(o,u))})}return i}var Hm=($d=(0,H.b2)(),Jd=(0,H.f3)(w.vK.ICameraService),Qd=(0,H.f3)(w.vK.IRendererService),$d(qd=(gd=(rv=function(){function i(){(0,Y.Z)(this,i),(0,Rn.Z)(this,"cameraService",ev,this),(0,Rn.Z)(this,"rendererService",tv,this)}return(0,le.Z)(i,[{key:"apply",value:function(o){o.hooks.beforeRender.tap("LayerAnimateStylePlugin",function(){o.models.forEach(function(u){u.addUniforms(Gm({},o.layerModel.getAnimateUniforms()))})})}}]),i}(),rv),ev=(0,Dn.Z)(gd.prototype,"cameraService",[Jd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tv=(0,Dn.Z)(gd.prototype,"rendererService",[Qd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gd))||qd),iv,av,Wm=(iv=(0,H.b2)(),iv(av=function(){function i(){(0,Y.Z)(this,i)}return(0,le.Z)(i,[{key:"apply",value:function(o){o.hooks.init.tap("LayerModelPlugin",function(){o.prepareBuildModel(),o.buildModels(),o.styleNeedUpdate=!1}),o.hooks.beforeRenderData.tap("DataSourcePlugin",function(){return o.prepareBuildModel(),o.clearModels(),o.buildModels(),o.layerModelNeedUpdate=!1,!1})}}]),i}())||av),ov,sv,Xm=(ov=(0,H.b2)(),ov(sv=function(){function i(){(0,Y.Z)(this,i)}return(0,le.Z)(i,[{key:"apply",value:function(o){o.hooks.afterInit.tap("LayerStylePlugin",function(){o.updateLayerConfig({});var u=o.getLayerConfig(),l=u.autoFit,d=u.fitBoundsOptions;l&&setTimeout(function(){o.fitBounds(d)},100)})}}]),i}())||sv),uv,lv;function cv(i,f){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(i);f&&(u=u.filter(function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable})),o.push.apply(o,u)}return o}function zp(i){for(var f=1;f<arguments.length;f++){var o=arguments[f]!=null?arguments[f]:{};f%2?cv(Object(o),!0).forEach(function(u){(0,F.Z)(i,u,o[u])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):cv(Object(o)).forEach(function(u){Object.defineProperty(i,u,Object.getOwnPropertyDescriptor(o,u))})}return i}var fv={directional:{lights:"u_DirectionalLights",num:"u_NumOfDirectionalLights"},spot:{lights:"u_SpotLights",num:"u_NumOfSpotLights"}},Ym={type:"directional",direction:[1,10.5,12],ambient:[.2,.2,.2],diffuse:[.6,.6,.6],specular:[.1,.1,.1]},Km={direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0]},$m={position:[0,0,0],direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0],constant:1,linear:0,quadratic:0,angle:14,exponent:40,blur:5},u0=null;function Jm(i){var f={u_DirectionalLights:new Array(3).fill(zp({},Km)),u_NumOfDirectionalLights:0,u_SpotLights:new Array(3).fill(zp({},$m)),u_NumOfSpotLights:0};return(!i||!i.length)&&(i=[Ym]),i.forEach(function(o,u){var l=o.type,d=l===void 0?"directional":l,y=(0,ji.Z)(o,["type"]),A=fv[d].lights,M=fv[d].num,D=f[M];f[A][D]=zp(zp({},f[A][D]),y),f[M]++}),f}var Qm=(uv=(0,H.b2)(),uv(lv=function(){function i(){(0,Y.Z)(this,i)}return(0,le.Z)(i,[{key:"apply",value:function(o){o.hooks.beforeRender.tap("LightingPlugin",function(){var u=o.getLayerConfig(),l=u.enableLighting;l&&o.models.forEach(function(d){return d.addUniforms(zp({},Jm()))})})}}]),i}())||lv),hv,pv,yd={NONE:0,ENCODE:1,HIGHLIGHT:2},qm=(hv=(0,H.b2)(),hv(pv=function(){function i(){(0,Y.Z)(this,i)}return(0,le.Z)(i,[{key:"apply",value:function(o,u){var l=u.rendererService,d=u.styleAttributeService;o.hooks.init.tap("PixelPickingPlugin",function(){var y=o.getLayerConfig(),A=y.enablePicking;d.registerStyleAttribute({name:"pickingColor",type:w.AttributeType.Attribute,descriptor:{name:"a_PickingColor",buffer:{data:[],type:w.gl.FLOAT},size:3,update:function(D,ee){var X=D.id;return A?(0,Ie.Z6)(X):[0,0,0]}}})}),o.hooks.beforePickingEncode.tap("PixelPickingPlugin",function(){var y=o.getLayerConfig(),A=y.enablePicking;A&&o.isVisible()&&o.models.forEach(function(M){return M.addUniforms({u_PickingStage:yd.ENCODE})})}),o.hooks.afterPickingEncode.tap("PixelPickingPlugin",function(){var y=o.getLayerConfig(),A=y.enablePicking;A&&o.isVisible()&&o.models.forEach(function(M){return M.addUniforms({u_PickingStage:yd.HIGHLIGHT})})}),o.hooks.beforeHighlight.tap("PixelPickingPlugin",function(y){var A=o.getLayerConfig(),M=A.highlightColor,D=typeof M=="string"?(0,Ie.CI)(M):M||[1,0,0,1];o.updateLayerConfig({pickedFeatureID:(0,Ie.W0)(new Uint8Array(y))}),o.models.forEach(function(ee){return ee.addUniforms({u_PickingStage:yd.HIGHLIGHT,u_PickingColor:y,u_HighlightColor:D.map(function(X){return X*255})})})}),o.hooks.beforeSelect.tap("PixelPickingPlugin",function(y){var A=o.getLayerConfig(),M=A.selectColor,D=typeof M=="string"?(0,Ie.CI)(M):M||[1,0,0,1];o.updateLayerConfig({pickedFeatureID:(0,Ie.W0)(new Uint8Array(y))}),o.models.forEach(function(ee){return ee.addUniforms({u_PickingStage:yd.HIGHLIGHT,u_PickingColor:y,u_HighlightColor:D.map(function(X){return X*255})})})})}}]),i}())||pv),dv,vv,mv,Rd,gv,yv,eg=(dv=(0,H.b2)(),vv=(0,H.f3)(w.vK.ILogService),dv(mv=(Rd=(yv=function(){function i(){(0,Y.Z)(this,i),(0,Rn.Z)(this,"logger",gv,this)}return(0,le.Z)(i,[{key:"apply",value:function(o,u){var l=this,d=u.styleAttributeService;o.hooks.init.tap("RegisterStyleAttributePlugin",function(){l.registerBuiltinAttributes(d)})}},{key:"registerBuiltinAttributes",value:function(o){o.registerStyleAttribute({name:"position",type:w.AttributeType.Attribute,descriptor:{name:"a_Position",buffer:{data:[],type:w.gl.FLOAT},size:3,update:function(l,d,y){return y.length===2?[y[0],y[1],0]:[y[0],y[1],y[2]]}}}),o.registerStyleAttribute({name:"filter",type:w.AttributeType.Attribute,descriptor:{name:"filter",buffer:{usage:w.gl.DYNAMIC_DRAW,data:[],type:w.gl.FLOAT},size:1,update:function(l,d){var y=l.filter;return y?[1]:[0]}}}),o.registerStyleAttribute({name:"color",type:w.AttributeType.Attribute,descriptor:{name:"a_Color",buffer:{usage:w.gl.DYNAMIC_DRAW,data:[],type:w.gl.FLOAT},size:4,update:function(l,d){var y=l.color;return!y||!y.length?[1,1,1,1]:y}}})}}]),i}(),yv),gv=(0,Dn.Z)(Rd.prototype,"logger",[vv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Rd))||mv),_v,xv,bv,Sv,Ev,wv,cp,Tv,Av,Cv,Pv,Mv,tg=(_v=(0,H.b2)(),xv=(0,H.f3)(w.vK.ICameraService),bv=(0,H.f3)(w.vK.ICoordinateSystemService),Sv=(0,H.f3)(w.vK.IRendererService),Ev=(0,H.f3)(w.vK.IMapService),_v(wv=(cp=(Mv=function(){function i(){(0,Y.Z)(this,i),(0,Rn.Z)(this,"cameraService",Tv,this),(0,Rn.Z)(this,"coordinateSystemService",Av,this),(0,Rn.Z)(this,"rendererService",Cv,this),(0,Rn.Z)(this,"mapService",Pv,this)}return(0,le.Z)(i,[{key:"apply",value:function(o){var u=this,l=this.mapService.version,d=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],y=[0,0];o.hooks.beforeRender.tap("ShaderUniformPlugin",function(){u.coordinateSystemService.refresh(),l==="GAODE2.x"&&(d=u.mapService.map.customCoords.getMVPMatrix(),y=u.mapService.getCustomCoordCenter());var A=u.rendererService.getViewportSize(),M=A.width,D=A.height;o.models.forEach(function(ee){var X;ee.addUniforms((X={},(0,F.Z)(X,w.CameraUniform.ProjectionMatrix,u.cameraService.getProjectionMatrix()),(0,F.Z)(X,w.CameraUniform.ViewMatrix,u.cameraService.getViewMatrix()),(0,F.Z)(X,w.CameraUniform.ViewProjectionMatrix,u.cameraService.getViewProjectionMatrix()),(0,F.Z)(X,w.CameraUniform.Zoom,u.cameraService.getZoom()),(0,F.Z)(X,w.CameraUniform.ZoomScale,u.cameraService.getZoomScale()),(0,F.Z)(X,w.CameraUniform.FocalDistance,u.cameraService.getFocalDistance()),(0,F.Z)(X,w.CameraUniform.CameraPosition,u.cameraService.getCameraPosition()),(0,F.Z)(X,w.CoordinateUniform.CoordinateSystem,u.coordinateSystemService.getCoordinateSystem()),(0,F.Z)(X,w.CoordinateUniform.ViewportCenter,u.coordinateSystemService.getViewportCenter()),(0,F.Z)(X,w.CoordinateUniform.ViewportCenterProjection,u.coordinateSystemService.getViewportCenterProjection()),(0,F.Z)(X,w.CoordinateUniform.PixelsPerDegree,u.coordinateSystemService.getPixelsPerDegree()),(0,F.Z)(X,w.CoordinateUniform.PixelsPerDegree2,u.coordinateSystemService.getPixelsPerDegree2()),(0,F.Z)(X,w.CoordinateUniform.PixelsPerMeter,u.coordinateSystemService.getPixelsPerMeter()),(0,F.Z)(X,w.CoordinateUniform.Mvp,d),(0,F.Z)(X,"u_SceneCenterMKT",y),(0,F.Z)(X,"u_ViewportSize",[M,D]),(0,F.Z)(X,"u_DevicePixelRatio",window.devicePixelRatio),(0,F.Z)(X,"u_ModelMatrix",[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),(0,F.Z)(X,"u_PickingBuffer",o.getLayerConfig().pickingBuffer||0),X))})})}}]),i}(),Mv),Tv=(0,Dn.Z)(cp.prototype,"cameraService",[xv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Av=(0,Dn.Z)(cp.prototype,"coordinateSystemService",[bv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Cv=(0,Dn.Z)(cp.prototype,"rendererService",[Sv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Pv=(0,Dn.Z)(cp.prototype,"mapService",[Ev],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cp))||wv),Iv,Ov,rg=(Iv=(0,H.b2)(),Iv(Ov=function(){function i(){(0,Y.Z)(this,i)}return(0,le.Z)(i,[{key:"apply",value:function(o){o.hooks.beforeRender.tap("UpdateModelPlugin",function(){o.layerModel&&o.layerModel.needUpdate()})}}]),i}())||Ov),Lv,Rv,Dv,Dd,kv,Fv,ng=(Lv=(0,H.b2)(),Rv=(0,H.f3)(w.vK.ILogService),Lv(Dv=(Dd=(Fv=function(){function i(){(0,Y.Z)(this,i),(0,Rn.Z)(this,"logger",kv,this)}return(0,le.Z)(i,[{key:"apply",value:function(o,u){var l=this,d=u.styleAttributeService;o.hooks.init.tap("UpdateStyleAttributePlugin",function(){l.initStyleAttribute(o,{styleAttributeService:d})}),o.hooks.beforeRender.tap("UpdateStyleAttributePlugin",function(){o.layerModelNeedUpdate||l.updateStyleAtrribute(o,{styleAttributeService:d})})}},{key:"updateStyleAtrribute",value:function(o,u){var l=this,d=u.styleAttributeService,y=d.getLayerStyleAttributes()||[],A=d.getLayerStyleAttribute("filter"),M=d.getLayerStyleAttribute("shape");if(A&&A.needRegenerateVertices||M&&M.needRegenerateVertices){o.layerModelNeedUpdate=!0,y.forEach(function(D){return D.needRegenerateVertices=!1});return}y.filter(function(D){return D.needRegenerateVertices}).forEach(function(D){d.updateAttributeByFeatureRange(D.name,o.getEncodedData(),D.featureRange.startIndex,D.featureRange.endIndex),D.needRegenerateVertices=!1,l.logger.debug("regenerate vertex attributes: ".concat(D.name," finished"))})}},{key:"initStyleAttribute",value:function(o,u){var l=this,d=u.styleAttributeService,y=d.getLayerStyleAttributes()||[];y.filter(function(A){return A.needRegenerateVertices}).forEach(function(A){d.updateAttributeByFeatureRange(A.name,o.getEncodedData(),A.featureRange.startIndex,A.featureRange.endIndex),A.needRegenerateVertices=!1,l.logger.debug("init vertex attributes: ".concat(A.name," finished"))})}}]),i}(),Fv),kv=(0,Dn.Z)(Dd.prototype,"logger",[Rv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Dd))||Dv);w.nC.bind(w.vK.ILayerPlugin).to(zt).inRequestScope(),w.nC.bind(w.vK.ILayerPlugin).to(eg).inRequestScope(),w.nC.bind(w.vK.ILayerPlugin).to(Vm).inRequestScope(),w.nC.bind(w.vK.ILayerPlugin).to(vu).inRequestScope(),w.nC.bind(w.vK.ILayerPlugin).to(Xm).inRequestScope(),w.nC.bind(w.vK.ILayerPlugin).to(ng).inRequestScope(),w.nC.bind(w.vK.ILayerPlugin).to(rg).inRequestScope(),w.nC.bind(w.vK.ILayerPlugin).to(Ya).inRequestScope(),w.nC.bind(w.vK.ILayerPlugin).to(tg).inRequestScope(),w.nC.bind(w.vK.ILayerPlugin).to(Hm).inRequestScope(),w.nC.bind(w.vK.ILayerPlugin).to(Qm).inRequestScope(),w.nC.bind(w.vK.ILayerPlugin).to(qm).inRequestScope(),w.nC.bind(w.vK.ILayerPlugin).to(Wm).inRequestScope();var l0="2.4.2";function zv(i,f){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(i);f&&(u=u.filter(function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable})),o.push.apply(o,u)}return o}function c0(i){for(var f=1;f<arguments.length;f++){var o=arguments[f]!=null?arguments[f]:{};f%2?zv(Object(o),!0).forEach(function(u){ig(i,u,o[u])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):zv(Object(o)).forEach(function(u){Object.defineProperty(i,u,Object.getOwnPropertyDescriptor(o,u))})}return i}function ig(i,f,o){return f in i?Object.defineProperty(i,f,{value:o,enumerable:!0,configurable:!0,writable:!0}):i[f]=o,i}function f0(i,f){return ug(i)||sg(i,f)||og(i,f)||ag()}function ag(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function og(i,f){if(!!i){if(typeof i=="string")return Nv(i,f);var o=Object.prototype.toString.call(i).slice(8,-1);if(o==="Object"&&i.constructor&&(o=i.constructor.name),o==="Map"||o==="Set")return Array.from(i);if(o==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return Nv(i,f)}}function Nv(i,f){(f==null||f>i.length)&&(f=i.length);for(var o=0,u=new Array(f);o<f;o++)u[o]=i[o];return u}function sg(i,f){var o=i==null?null:typeof Symbol!="undefined"&&i[Symbol.iterator]||i["@@iterator"];if(o!=null){var u=[],l=!0,d=!1,y,A;try{for(o=o.call(i);!(l=(y=o.next()).done)&&(u.push(y.value),!(f&&u.length===f));l=!0);}catch(M){d=!0,A=M}finally{try{!l&&o.return!=null&&o.return()}finally{if(d)throw A}}return u}}function ug(i){if(Array.isArray(i))return i}var h0=null,p0=null,Bv,Uv,_d,jv,Zv,Vv;function Gv(i,f){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(i);f&&(u=u.filter(function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable})),o.push.apply(o,u)}return o}function Hv(i){for(var f=1;f<arguments.length;f++){var o=arguments[f]!=null?arguments[f]:{};f%2?Gv(Object(o),!0).forEach(function(u){(0,F.Z)(i,u,o[u])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):Gv(Object(o)).forEach(function(u){Object.defineProperty(i,u,Object.getOwnPropertyDescriptor(o,u))})}return i}var lg=(Bv=(0,w.yT)(w.vK.ILogService),Uv=(0,w.yT)(w.vK.IGlobalConfigService),_d=(Vv=function(){function i(f){(0,Y.Z)(this,i),(0,Rn.Z)(this,"logger",jv,this),(0,Rn.Z)(this,"configService",Zv,this),this.config=void 0,this.config=f}return(0,le.Z)(i,[{key:"setContainer",value:function(o,u){o.bind(w.vK.MapConfig).toConstantValue(Hv(Hv({},this.config),{},{id:u})),o.bind(w.vK.IMapService).to(this.getServiceConstructor()).inSingletonScope()}},{key:"getServiceConstructor",value:function(){throw new Error("Method not implemented.")}}]),i}(),Vv),jv=(0,Dn.Z)(_d.prototype,"logger",[Bv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Zv=(0,Dn.Z)(_d.prototype,"configService",[Uv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_d),cg=x(6158),fg=x.n(cg),kd;(function(i){i["GAODE1.x"]="GAODE1.x",i["GAODE2.x"]="GAODE2.x",i.MAPBOX="MAPBOX",i.L7MAP="L7MAP"})(kd||(kd={}));function Np(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function xd(i,f){var o=qs.fF([],f,i);return qs.bA(o,o,1/o[3]),o}function d0(i,f){var o=i%f;return o<0?f+o:o}function v0(i,f,o){return o*f+(1-o)*i}function zh(i,f){if(!i)throw new Error(f||"viewport-mercator-project: assertion failed.")}var vf=Math.PI,Wv=vf/4,Gf=vf/180,Xv=180/vf,Fd=512,zd=4003e4,hg=1.5;function Yv(i){return Math.pow(2,i)}function pg(i){return Math.log2(i)}function bd(i,f){var o=(0,Q.Z)(i,2),u=o[0],l=o[1];zh(Number.isFinite(u)&&Number.isFinite(f)),zh(Number.isFinite(l)&&l>=-90&&l<=90,"invalid latitude"),f*=Fd;var d=u*Gf,y=l*Gf,A=f*(d+vf)/(2*vf),M=f*(vf-Math.log(Math.tan(Wv+y*.5)))/(2*vf);return[A,M]}function Nd(i,f){var o=(0,Q.Z)(i,2),u=o[0],l=o[1];f*=Fd;var d=u/f*(2*vf)-vf,y=2*(Math.atan(Math.exp(vf-l/f*(2*vf)))-Wv);return[d*Xv,y*Xv]}function m0(i){var f=i.latitude;assert(Number.isFinite(f));var o=Math.cos(f*Gf);return pg(zd*o)-9}function Kv(i){var f=i.latitude,o=i.longitude,u=i.zoom,l=i.scale,d=i.highPrecision,y=d===void 0?!1:d;l=l!==void 0?l:Yv(u),zh(Number.isFinite(f)&&Number.isFinite(o)&&Number.isFinite(l));var A={},M=Fd*l,D=Math.cos(f*Gf),ee=M/360,X=ee/D,fe=M/zd/D;if(A.pixelsPerMeter=[fe,-fe,fe],A.metersPerPixel=[1/fe,-1/fe,1/fe],A.pixelsPerDegree=[ee,-X,fe],A.degreesPerPixel=[1/ee,-1/X,1/fe],y){var Xe=Gf*Math.tan(f*Gf)/D,it=ee*Xe/2,Rt=M/zd*Xe,xr=Rt/X*fe;A.pixelsPerDegree2=[0,-it,Rt],A.pixelsPerMeter2=[xr,0,xr]}return A}function g0(i,f){var o=_slicedToArray(i,3),u=o[0],l=o[1],d=o[2],y=_slicedToArray(f,3),A=y[0],M=y[1],D=y[2],ee=1,X=Kv({longitude:u,latitude:l,scale:ee,highPrecision:!0}),fe=X.pixelsPerMeter,Xe=X.pixelsPerMeter2,it=bd(i,ee);it[0]+=A*(fe[0]+Xe[0]*M),it[1]+=M*(fe[1]+Xe[1]*M);var Rt=Nd(it,ee),xr=(d||0)+(D||0);return Number.isFinite(d)||Number.isFinite(D)?[Rt[0],Rt[1],xr]:Rt}function dg(i){var f=i.height,o=i.pitch,u=i.bearing,l=i.altitude,d=i.center,y=d===void 0?null:d,A=i.flipY,M=A===void 0?!1:A,D=Np();return ma.translate(D,D,[0,0,-l]),ma.scale(D,D,[1,1,1/f]),ma.rotateX(D,D,-o*Gf),ma.rotateZ(D,D,u*Gf),M&&ma.scale(D,D,[1,-1,1]),y&&ma.translate(D,D,bi.negate([],y)),D}function vg(i){var f=i.width,o=i.height,u=i.altitude,l=u===void 0?hg:u,d=i.pitch,y=d===void 0?0:d,A=i.nearZMultiplier,M=A===void 0?1:A,D=i.farZMultiplier,ee=D===void 0?1:D,X=y*Gf,fe=Math.atan(.5/l),Xe=Math.sin(fe)*l/Math.sin(Math.PI/2-X-fe),it=Math.cos(Math.PI/2-X)*Xe+l;return{fov:2*Math.atan(o/2/l),aspect:f/o,focalDistance:l,near:M,far:it*ee}}function mg(i){var f=i.width,o=i.height,u=i.pitch,l=i.altitude,d=i.nearZMultiplier,y=i.farZMultiplier,A=vg({width:f,height:o,altitude:l,pitch:u,nearZMultiplier:d,farZMultiplier:y}),M=A.fov,D=A.aspect,ee=A.near,X=A.far,fe=ma.perspective([],M,D,ee,X);return fe}function gg(i,f){var o=(0,Q.Z)(i,3),u=o[0],l=o[1],d=o[2],y=d===void 0?0:d;return zh(Number.isFinite(u)&&Number.isFinite(l)&&Number.isFinite(y)),xd(f,[u,l,y,1])}function $v(i,f){var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,u=(0,Q.Z)(i,3),l=u[0],d=u[1],y=u[2];if(zh(Number.isFinite(l)&&Number.isFinite(d),"invalid pixel coordinate"),Number.isFinite(y)){var A=xd(f,[l,d,y,1]);return A}var M=xd(f,[l,d,0,1]),D=xd(f,[l,d,1,1]),ee=M[2],X=D[2],fe=ee===X?0:((o||0)-ee)/(X-ee);return Nn.lerp([],M,D,fe)}var Jv=Np(),yg=function(){function i(){var f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},o=f.width,u=f.height,l=f.viewMatrix,d=l===void 0?Jv:l,y=f.projectionMatrix,A=y===void 0?Jv:y;(0,Y.Z)(this,i),this.width=o||1,this.height=u||1,this.scale=1,this.pixelsPerMeter=1,this.viewMatrix=d,this.projectionMatrix=A;var M=Np();ma.multiply(M,M,this.projectionMatrix),ma.multiply(M,M,this.viewMatrix),this.viewProjectionMatrix=M;var D=Np();ma.scale(D,D,[this.width/2,-this.height/2,1]),ma.translate(D,D,[1,-1,0]),ma.multiply(D,D,this.viewProjectionMatrix);var ee=ma.invert(Np(),D);if(!ee)throw new Error("Pixel project matrix not invertible");this.pixelProjectionMatrix=D,this.pixelUnprojectionMatrix=ee,this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}return(0,le.Z)(i,[{key:"equals",value:function(o){return o instanceof i?o.width===this.width&&o.height===this.height&&ma.equals(o.projectionMatrix,this.projectionMatrix)&&ma.equals(o.viewMatrix,this.viewMatrix):!1}},{key:"project",value:function(o){var u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},l=u.topLeft,d=l===void 0?!0:l,y=this.projectPosition(o),A=gg(y,this.pixelProjectionMatrix),M=(0,Q.Z)(A,2),D=M[0],ee=M[1],X=d?ee:this.height-ee;return o.length===2?[D,X]:[D,X,A[2]]}},{key:"unproject",value:function(o){var u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},l=u.topLeft,d=l===void 0?!0:l,y=u.targetZ,A=(0,Q.Z)(o,3),M=A[0],D=A[1],ee=A[2],X=d?D:this.height-D,fe=y&&y*this.pixelsPerMeter,Xe=$v([M,X,ee],this.pixelUnprojectionMatrix,fe),it=this.unprojectPosition(Xe),Rt=(0,Q.Z)(it,3),xr=Rt[0],Tr=Rt[1],jr=Rt[2];return Number.isFinite(ee)?[xr,Tr,jr]:Number.isFinite(y)?[xr,Tr,y]:[xr,Tr]}},{key:"projectPosition",value:function(o){var u=this.projectFlat(o),l=(0,Q.Z)(u,2),d=l[0],y=l[1],A=(o[2]||0)*this.pixelsPerMeter;return[d,y,A]}},{key:"unprojectPosition",value:function(o){var u=this.unprojectFlat(o),l=(0,Q.Z)(u,2),d=l[0],y=l[1],A=(o[2]||0)/this.pixelsPerMeter;return[d,y,A]}},{key:"projectFlat",value:function(o){var u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return o}},{key:"unprojectFlat",value:function(o){var u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return o}}]),i}();function _g(i){var f=i.width,o=i.height,u=i.bounds,l=i.minExtent,d=l===void 0?0:l,y=i.maxZoom,A=y===void 0?24:y,M=i.padding,D=M===void 0?0:M,ee=i.offset,X=ee===void 0?[0,0]:ee,fe=(0,Q.Z)(u,2),Xe=(0,Q.Z)(fe[0],2),it=Xe[0],Rt=Xe[1],xr=(0,Q.Z)(fe[1],2),Tr=xr[0],jr=xr[1];if(Number.isFinite(D)){var dn=D;D={top:dn,bottom:dn,left:dn,right:dn}}else zh(Number.isFinite(D.top)&&Number.isFinite(D.bottom)&&Number.isFinite(D.left)&&Number.isFinite(D.right));var bn=new Qv({width:f,height:o,longitude:0,latitude:0,zoom:0}),Gn=bn.project([it,jr]),Li=bn.project([Tr,Rt]),ti=[Math.max(Math.abs(Li[0]-Gn[0]),d),Math.max(Math.abs(Li[1]-Gn[1]),d)],qi=[f-D.left-D.right-Math.abs(X[0])*2,o-D.top-D.bottom-Math.abs(X[1])*2];zh(qi[0]>0&&qi[1]>0);var za=qi[0]/ti[0],Ua=qi[1]/ti[1],di=(D.right-D.left)/2/za,Ca=(D.bottom-D.top)/2/Ua,ao=[(Li[0]+Gn[0])/2+di,(Li[1]+Gn[1])/2+Ca],Wu=bn.unproject(ao),fp=bn.zoom+Math.log2(Math.abs(Math.min(za,Ua)));return{longitude:Wu[0],latitude:Wu[1],zoom:Math.min(fp,A)}}var Qv=function(i){(0,ne.Z)(f,i);function f(){var o,u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},l=u.width,d=u.height,y=u.latitude,A=y===void 0?0:y,M=u.longitude,D=M===void 0?0:M,ee=u.zoom,X=ee===void 0?0:ee,fe=u.pitch,Xe=fe===void 0?0:fe,it=u.bearing,Rt=it===void 0?0:it,xr=u.altitude,Tr=xr===void 0?1.5:xr,jr=u.nearZMultiplier,dn=u.farZMultiplier;(0,Y.Z)(this,f),l=l||1,d=d||1;var bn=Yv(X);Tr=Math.max(.75,Tr);var Gn=bd([D,A],bn);Gn[2]=0;var Li=mg({width:l,height:d,pitch:Xe,bearing:Rt,altitude:Tr,nearZMultiplier:jr||1/d,farZMultiplier:dn||1.01}),ti=dg({height:d,center:Gn,pitch:Xe,bearing:Rt,altitude:Tr,flipY:!0});return o=(0,be.Z)(this,(0,we.Z)(f).call(this,{width:l,height:d,viewMatrix:ti,projectionMatrix:Li})),o.latitude=A,o.longitude=D,o.zoom=X,o.pitch=Xe,o.bearing=Rt,o.altitude=Tr,o.scale=bn,o.center=Gn,o.pixelsPerMeter=Kv((0,Gt.Z)((0,Gt.Z)(o))).pixelsPerMeter[2],Object.freeze((0,Gt.Z)((0,Gt.Z)(o))),o}return(0,le.Z)(f,[{key:"projectFlat",value:function(u){var l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return bd(u,l)}},{key:"unprojectFlat",value:function(u){var l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return Nd(u,l)}},{key:"getMapCenterByLngLatPosition",value:function(u){var l=u.lngLat,d=u.pos,y=$v(d,this.pixelUnprojectionMatrix),A=bd(l,this.scale),M=Nn.add([],A,Nn.negate([],y)),D=Nn.add([],this.center,M);return Nd(D,this.scale)}},{key:"getLocationAtPoint",value:function(u){var l=u.lngLat,d=u.pos;return this.getMapCenterByLngLatPosition({lngLat:l,pos:d})}},{key:"fitBounds",value:function(u){var l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},d=this.width,y=this.height,A=_g(Object.assign({width:d,height:y,bounds:u},l)),M=A.longitude,D=A.latitude,ee=A.zoom;return new f({width:d,height:y,longitude:M,latitude:D,zoom:ee})}}]),f}(yg),xg=function(){function i(){(0,Y.Z)(this,i),this.viewport=void 0}return(0,le.Z)(i,[{key:"syncWithMapCamera",value:function(o){var u=o.center,l=o.zoom,d=o.pitch,y=o.bearing,A=o.viewportHeight,M=o.viewportWidth;this.viewport=new Qv({width:M,height:A,longitude:u&&u[0],latitude:u&&u[1],zoom:l,pitch:d,bearing:y})}},{key:"getZoom",value:function(){return this.viewport.zoom}},{key:"getZoomScale",value:function(){return Math.pow(2,this.getZoom())}},{key:"getCenter",value:function(){return[this.viewport.longitude,this.viewport.latitude]}},{key:"getProjectionMatrix",value:function(){return this.viewport.projectionMatrix}},{key:"getViewMatrix",value:function(){return this.viewport.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.viewMatrixUncentered}},{key:"getViewProjectionMatrix",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(o,u){return this.viewport.projectFlat(o,u)}}]),i}(),qv={light:"mapbox://styles/zcxduo/ck2ypyb1r3q9o1co1766dex29",dark:"mapbox://styles/zcxduo/ck241p6413s0b1cpayzldv7x7",normal:"mapbox://styles/mapbox/streets-v11",blank:{version:8,sources:{},layers:[{id:"background",type:"background",layout:{visibility:"none"}}]}},em,tm,rm,nm,im,am,om,Nh,sm,um,lm,cm,fm,hm;function pm(i,f){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(i);f&&(u=u.filter(function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable})),o.push.apply(o,u)}return o}function bg(i){for(var f=1;f<arguments.length;f++){var o=arguments[f]!=null?arguments[f]:{};f%2?pm(Object(o),!0).forEach(function(u){(0,F.Z)(i,u,o[u])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):pm(Object(o)).forEach(function(u){Object.defineProperty(i,u,Object.getOwnPropertyDescriptor(o,u))})}return i}x(68982)(`/* @antv/l7-maps */
.mapboxgl-map{font:12px/20px Helvetica Neue,Arial,Helvetica,sans-serif;overflow:hidden;position:relative;-webkit-tap-highlight-color:rgba(0,0,0,0)}.mapboxgl-canvas{position:absolute;left:0;top:0}.mapboxgl-map:-webkit-full-screen{width:100%;height:100%}.mapboxgl-canary{background-color:salmon}.mapboxgl-canvas-container.mapboxgl-interactive,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass{cursor:-webkit-grab;cursor:grab;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-canvas-container.mapboxgl-interactive.mapboxgl-track-pointer{cursor:pointer}.mapboxgl-canvas-container.mapboxgl-interactive:active,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass:active{cursor:-webkit-grabbing;cursor:grabbing}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate .mapboxgl-canvas{-ms-touch-action:pan-x pan-y;touch-action:pan-x pan-y}.mapboxgl-canvas-container.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:pinch-zoom;touch-action:pinch-zoom}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:none;touch-action:none}.mapboxgl-ctrl-bottom-left,.mapboxgl-ctrl-bottom-right,.mapboxgl-ctrl-top-left,.mapboxgl-ctrl-top-right{position:absolute;pointer-events:none;z-index:2}.mapboxgl-ctrl-top-left{top:0;left:0}.mapboxgl-ctrl-top-right{top:0;right:0}.mapboxgl-ctrl-bottom-left{bottom:0;left:0}.mapboxgl-ctrl-bottom-right{right:0;bottom:0}.mapboxgl-ctrl{clear:both;pointer-events:auto;-webkit-transform:translate(0);transform:translate(0)}.mapboxgl-ctrl-top-left .mapboxgl-ctrl{margin:10px 0 0 10px;float:left}.mapboxgl-ctrl-top-right .mapboxgl-ctrl{margin:10px 10px 0 0;float:right}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl{margin:0 0 10px 10px;float:left}.mapboxgl-ctrl-bottom-right .mapboxgl-ctrl{margin:0 10px 10px 0;float:right}.mapboxgl-ctrl-group{border-radius:4px;background:#fff}.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 2px rgba(0,0,0,.1);box-shadow:0 0 0 2px rgba(0,0,0,.1)}@media (-ms-high-contrast:active){.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 0 2px ButtonText;box-shadow:0 0 0 2px ButtonText}}.mapboxgl-ctrl-group button{width:29px;height:29px;display:block;padding:0;outline:none;border:0;-webkit-box-sizing:border-box;box-sizing:border-box;background-color:transparent;cursor:pointer}.mapboxgl-ctrl-group button+button{border-top:1px solid #ddd}.mapboxgl-ctrl button .mapboxgl-ctrl-icon{display:block;width:100%;height:100%;background-repeat:no-repeat;background-position:50%}@media (-ms-high-contrast:active){.mapboxgl-ctrl-icon{background-color:transparent}.mapboxgl-ctrl-group button+button{border-top:1px solid ButtonText}}.mapboxgl-ctrl button::-moz-focus-inner{border:0;padding:0}.mapboxgl-ctrl-attrib-button:focus,.mapboxgl-ctrl-group button:focus{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl button:disabled{cursor:not-allowed}.mapboxgl-ctrl button:disabled .mapboxgl-ctrl-icon{opacity:.25}.mapboxgl-ctrl button:not(:disabled):hover{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-group button:focus:focus-visible{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl-group button:focus:not(:focus-visible){-webkit-box-shadow:none;box-shadow:none}.mapboxgl-ctrl-group button:focus:first-child{border-radius:4px 4px 0 0}.mapboxgl-ctrl-group button:focus:last-child{border-radius:0 0 4px 4px}.mapboxgl-ctrl-group button:focus:only-child{border-radius:inherit}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23999'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23aaa'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-waiting .mapboxgl-ctrl-icon{-webkit-animation:mapboxgl-spin 2s linear infinite;animation:mapboxgl-spin 2s linear infinite}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23999'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23666'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}}@-webkit-keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg)}to{-webkit-transform:rotate(1turn)}}@keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}a.mapboxgl-ctrl-logo{width:88px;height:23px;margin:0 0 -4px -4px;display:block;background-repeat:no-repeat;cursor:pointer;overflow:hidden;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg opacity='.3' stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg opacity='.9' fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}a.mapboxgl-ctrl-logo.mapboxgl-compact{width:23px}@media (-ms-high-contrast:active){a.mapboxgl-ctrl-logo{background-color:transparent;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){a.mapboxgl-ctrl-logo{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23fff' stroke-width='3' fill='%23fff'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/svg%3E")}}.mapboxgl-ctrl.mapboxgl-ctrl-attrib{padding:0 5px;background-color:hsla(0,0%,100%,.5);margin:0}@media screen{.mapboxgl-ctrl-attrib.mapboxgl-compact{min-height:20px;padding:2px 24px 2px 0;margin:10px;position:relative;background-color:#fff;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 28px 2px 8px;visibility:visible}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show,.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 8px 2px 28px;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-inner{display:none}.mapboxgl-ctrl-attrib-button{display:none;cursor:pointer;position:absolute;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E");background-color:hsla(0,0%,100%,.5);width:24px;height:24px;-webkit-box-sizing:border-box;box-sizing:border-box;border-radius:12px;outline:none;top:0;right:0;border:0}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl-attrib-button,.mapboxgl-ctrl-top-left .mapboxgl-ctrl-attrib-button{left:0}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-inner,.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-button{display:block}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-button{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-bottom-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;right:0}.mapboxgl-ctrl-top-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;right:0}.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;left:0}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;left:0}}@media screen and (-ms-high-contrast:active){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd' fill='%23fff'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}@media screen and (-ms-high-contrast:black-on-white){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}.mapboxgl-ctrl-attrib a{color:rgba(0,0,0,.75);text-decoration:none}.mapboxgl-ctrl-attrib a:hover{color:inherit;text-decoration:underline}.mapboxgl-ctrl-attrib .mapbox-improve-map{font-weight:700;margin-left:2px}.mapboxgl-attrib-empty{display:none}.mapboxgl-ctrl-scale{background-color:hsla(0,0%,100%,.75);font-size:10px;border:2px solid #333;border-top:#333;padding:0 5px;color:#333;-webkit-box-sizing:border-box;box-sizing:border-box}.mapboxgl-popup{position:absolute;top:0;left:0;display:-webkit-flex;display:-webkit-box;display:-ms-flexbox;display:flex;will-change:transform;pointer-events:none}.mapboxgl-popup-anchor-top,.mapboxgl-popup-anchor-top-left,.mapboxgl-popup-anchor-top-right{-webkit-flex-direction:column;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}.mapboxgl-popup-anchor-bottom,.mapboxgl-popup-anchor-bottom-left,.mapboxgl-popup-anchor-bottom-right{-webkit-flex-direction:column-reverse;-webkit-box-orient:vertical;-webkit-box-direction:reverse;-ms-flex-direction:column-reverse;flex-direction:column-reverse}.mapboxgl-popup-anchor-left{-webkit-flex-direction:row;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row}.mapboxgl-popup-anchor-right{-webkit-flex-direction:row-reverse;-webkit-box-orient:horizontal;-webkit-box-direction:reverse;-ms-flex-direction:row-reverse;flex-direction:row-reverse}.mapboxgl-popup-tip{width:0;height:0;border:10px solid transparent;z-index:1}.mapboxgl-popup-anchor-top .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-top:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-top:none;border-left:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-top:none;border-right:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-bottom .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-bottom:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-bottom:none;border-left:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-bottom:none;border-right:none;border-top-color:#fff}.mapboxgl-popup-anchor-left .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-left:none;border-right-color:#fff}.mapboxgl-popup-anchor-right .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-right:none;border-left-color:#fff}.mapboxgl-popup-close-button{position:absolute;right:0;top:0;border:0;border-radius:0 3px 0 0;cursor:pointer;background-color:transparent}.mapboxgl-popup-close-button:hover{background-color:rgba(0,0,0,.05)}.mapboxgl-popup-content{position:relative;background:#fff;border-radius:3px;-webkit-box-shadow:0 1px 2px rgba(0,0,0,.1);box-shadow:0 1px 2px rgba(0,0,0,.1);padding:10px 10px 15px;pointer-events:auto}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-content{border-top-left-radius:0}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-content{border-top-right-radius:0}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-content{border-bottom-left-radius:0}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-content{border-bottom-right-radius:0}.mapboxgl-popup-track-pointer{display:none}.mapboxgl-popup-track-pointer *{pointer-events:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-map:hover .mapboxgl-popup-track-pointer{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex}.mapboxgl-map:active .mapboxgl-popup-track-pointer{display:none}.mapboxgl-marker{position:absolute;top:0;left:0;will-change:transform}.mapboxgl-user-location-dot,.mapboxgl-user-location-dot:before{background-color:#1da1f2;width:15px;height:15px;border-radius:50%}.mapboxgl-user-location-dot:before{content:"";position:absolute;-webkit-animation:mapboxgl-user-location-dot-pulse 2s infinite;animation:mapboxgl-user-location-dot-pulse 2s infinite}.mapboxgl-user-location-dot:after{border-radius:50%;border:2px solid #fff;content:"";height:19px;left:-2px;position:absolute;top:-2px;width:19px;-webkit-box-sizing:border-box;box-sizing:border-box;-webkit-box-shadow:0 0 3px rgba(0,0,0,.35);box-shadow:0 0 3px rgba(0,0,0,.35)}@-webkit-keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);opacity:0}to{-webkit-transform:scale(1);opacity:0}}@keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);transform:scale(3);opacity:0}to{-webkit-transform:scale(1);transform:scale(1);opacity:0}}.mapboxgl-user-location-dot-stale{background-color:#aaa}.mapboxgl-user-location-dot-stale:after{display:none}.mapboxgl-user-location-accuracy-circle{background-color:rgba(29,161,242,.2);width:1px;height:1px;border-radius:100%}.mapboxgl-crosshair,.mapboxgl-crosshair .mapboxgl-interactive,.mapboxgl-crosshair .mapboxgl-interactive:active{cursor:crosshair}.mapboxgl-boxzoom{position:absolute;top:0;left:0;width:0;height:0;background:#fff;border:2px dotted #202020;opacity:.5}@media print{.mapbox-improve-map{display:none}}`),window.mapboxgl=fg();var dm={mapmove:"move",camerachange:"move",zoomchange:"zoom",dragging:"drag"},Sg=0,Eg=12,vm="pk.eyJ1IjoibHp4dWUiLCJhIjoiY2tvaWZuM2s4MWZuYjJ1dHI5ZGduYTlrdiJ9.DQCfMRbZzx0VSwecQ69McA",wg=(em=(0,H.b2)(),tm=(0,H.f3)(w.vK.MapConfig),rm=(0,H.f3)(w.vK.IGlobalConfigService),nm=(0,H.f3)(w.vK.ILogService),im=(0,H.f3)(w.vK.ICoordinateSystemService),am=(0,H.f3)(w.vK.IEventEmitter),em(om=(Nh=(hm=function(){function i(){var f=this;(0,Y.Z)(this,i),this.version=kd.MAPBOX,this.map=void 0,(0,Rn.Z)(this,"config",sm,this),(0,Rn.Z)(this,"configService",um,this),(0,Rn.Z)(this,"logger",lm,this),(0,Rn.Z)(this,"coordinateSystemService",cm,this),(0,Rn.Z)(this,"eventEmitter",fm,this),this.viewport=void 0,this.markerContainer=void 0,this.cameraChangedCallback=void 0,this.$mapContainer=void 0,this.handleCameraChanged=function(){var o=f.map.getCenter().wrap(),u=o.lat,l=o.lng;f.viewport.syncWithMapCamera({bearing:f.map.getBearing(),center:[l,u],viewportHeight:f.map.transform.height,pitch:f.map.getPitch(),viewportWidth:f.map.transform.width,zoom:f.map.getZoom(),cameraHeight:0});var d=f.config.offsetZoom,y=d===void 0?Eg:d;f.viewport.getZoom()>y?f.coordinateSystemService.setCoordinateSystem(w.CoordinateSystem.LNGLAT_OFFSET):f.coordinateSystemService.setCoordinateSystem(w.CoordinateSystem.LNGLAT),f.cameraChangedCallback(f.viewport)}}return(0,le.Z)(i,[{key:"addMarkerContainer",value:function(){var o=this.map.getCanvasContainer();this.markerContainer=Ie.SO.create("div","l7-marker-container",o),this.markerContainer.setAttribute("tabindex","-1")}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"on",value:function(o,u){w.MapServiceEvent.indexOf(o)!==-1?this.eventEmitter.on(o,u):this.map.on(dm[o]||o,u)}},{key:"off",value:function(o,u){this.map.off(dm[o]||o,u)}},{key:"getContainer",value:function(){return this.map.getContainer()}},{key:"getMapCanvasContainer",value:function(){return this.map.getCanvasContainer()}},{key:"getSize",value:function(){var o=this.map.transform;return[o.width,o.height]}},{key:"getType",value:function(){return"mapbox"}},{key:"getZoom",value:function(){return this.map.getZoom()}},{key:"setZoom",value:function(o){return this.map.setZoom(o)}},{key:"getCenter",value:function(){return this.map.getCenter()}},{key:"setCenter",value:function(o){this.map.setCenter(o)}},{key:"getPitch",value:function(){return this.map.getPitch()}},{key:"getRotation",value:function(){return this.map.getBearing()}},{key:"getBounds",value:function(){return this.map.getBounds().toArray()}},{key:"getMinZoom",value:function(){return this.map.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.map.getMaxZoom()}},{key:"setRotation",value:function(o){this.map.setBearing(o)}},{key:"zoomIn",value:function(o,u){this.map.zoomIn(o,u)}},{key:"zoomOut",value:function(o,u){this.map.zoomOut(o,u)}},{key:"setPitch",value:function(o){return this.map.setPitch(o)}},{key:"panTo",value:function(o){this.map.panTo(o)}},{key:"panBy",value:function(o){this.panTo(o)}},{key:"fitBounds",value:function(o,u){this.map.fitBounds(o,u)}},{key:"setMaxZoom",value:function(o){this.map.setMaxZoom(o)}},{key:"setMinZoom",value:function(o){this.map.setMinZoom(o)}},{key:"setMapStatus",value:function(o){o.doubleClickZoom===!0&&this.map.doubleClickZoom.enable(),o.doubleClickZoom===!1&&this.map.doubleClickZoom.disable(),o.dragEnable===!1&&this.map.dragPan.disable(),o.dragEnable===!0&&this.map.dragPan.enable(),o.rotateEnable===!1&&this.map.dragRotate.disable(),o.rotateEnable===!0&&this.map.dragRotate.enable(),o.keyboardEnable===!1&&this.map.keyboard.disable(),o.keyboardEnable===!0&&this.map.keyboard.enable(),o.zoomEnable===!1&&this.map.scrollZoom.disable(),o.zoomEnable===!0&&this.map.scrollZoom.enable()}},{key:"setZoomAndCenter",value:function(o,u){this.map.flyTo({zoom:o,center:u})}},{key:"setMapStyle",value:function(o){this.map.setStyle(this.getMapStyle(o))}},{key:"pixelToLngLat",value:function(o){return this.map.unproject(o)}},{key:"lngLatToPixel",value:function(o){return this.map.project(o)}},{key:"containerToLngLat",value:function(o){return this.map.unproject(o)}},{key:"lngLatToContainer",value:function(o){return this.map.project(o)}},{key:"lngLatToMercator",value:function(o,u){var l=window.mapboxgl.MercatorCoordinate.fromLngLat(o,u),d=l.x,y=d===void 0?0:d,A=l.y,M=A===void 0?0:A,D=l.z,ee=D===void 0?0:D;return{x:y,y:M,z:ee}}},{key:"getModelMatrix",value:function(o,u,l){var d=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[1,1,1],y=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{x:0,y:0,z:0},A=window.mapboxgl.MercatorCoordinate.fromLngLat(o,u),M=A.meterInMercatorCoordinateUnits(),D=ma.create();return ma.translate(D,D,bi.fromValues(A.x-y.x,A.y-y.y,A.z||0-y.z)),ma.scale(D,D,bi.fromValues(M*d[0],-M*d[1],M*d[2])),ma.rotateX(D,D,l[0]),ma.rotateY(D,D,l[1]),ma.rotateZ(D,D,l[2]),D}},{key:"init",value:function(){var f=(0,Je.Z)(Ct().mark(function u(){var l,d,y,A,M,D,ee,X,fe,Xe,it,Rt,xr;return Ct().wrap(function(jr){for(;;)switch(jr.prev=jr.next){case 0:l=this.config,d=l.id,y=d===void 0?"map":d,A=l.attributionControl,M=A===void 0?!1:A,D=l.style,ee=D===void 0?"light":D,X=l.token,fe=X===void 0?vm:X,Xe=l.rotation,it=Xe===void 0?0:Xe,Rt=l.mapInstance,xr=(0,ji.Z)(l,["id","attributionControl","style","token","rotation","mapInstance"]),this.viewport=new xg,!Rt&&!window.mapboxgl&&this.logger.error(this.configService.getSceneWarninfo("SDK")),fe===vm&&ee!=="blank"&&!window.mapboxgl.accessToken&&!Rt&&this.logger.warn(this.configService.getSceneWarninfo("MapToken")),!Rt&&!window.mapboxgl.accessToken&&(window.mapboxgl.accessToken=fe),Rt?(this.map=Rt,this.$mapContainer=this.map.getContainer()):(this.$mapContainer=this.creatAmapContainer(y),this.map=new window.mapboxgl.Map(bg({container:this.$mapContainer,style:this.getMapStyle(ee),attributionControl:M,bearing:it},xr))),this.map.on("load",this.handleCameraChanged),this.map.on("move",this.handleCameraChanged),this.handleCameraChanged();case 9:case"end":return jr.stop()}},u,this)}));function o(){return f.apply(this,arguments)}return o}()},{key:"destroy",value:function(){this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}},{key:"emit",value:function(o){for(var u,l=arguments.length,d=new Array(l>1?l-1:0),y=1;y<l;y++)d[y-1]=arguments[y];(u=this.eventEmitter).emit.apply(u,[o].concat(d))}},{key:"once",value:function(o){for(var u,l=arguments.length,d=new Array(l>1?l-1:0),y=1;y<l;y++)d[y-1]=arguments[y];(u=this.eventEmitter).once.apply(u,[o].concat(d))}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"exportMap",value:function(o){var u=this.map.getCanvas(),l=o==="jpg"?u==null?void 0:u.toDataURL("image/jpeg"):u==null?void 0:u.toDataURL("image/png");return l}},{key:"onCameraChanged",value:function(o){this.cameraChangedCallback=o}},{key:"creatAmapContainer",value:function(o){var u=o;typeof o=="string"&&(u=document.getElementById(o));var l=document.createElement("div");return l.style.cssText+=`
      position: absolute;
      top: 0;
      height: 100%;
      width: 100%;
    `,l.id="l7_mapbox_div"+Sg++,u.appendChild(l),l}},{key:"getMapStyle",value:function(o){return typeof o!="string"?o:qv[o]?qv[o]:o}}]),i}(),hm),sm=(0,Dn.Z)(Nh.prototype,"config",[tm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),um=(0,Dn.Z)(Nh.prototype,"configService",[rm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lm=(0,Dn.Z)(Nh.prototype,"logger",[nm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cm=(0,Dn.Z)(Nh.prototype,"coordinateSystemService",[im],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fm=(0,Dn.Z)(Nh.prototype,"eventEmitter",[am],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Nh))||om);function Tg(i){var f=Ag();return function(){var u=(0,we.Z)(i),l;if(f){var d=(0,we.Z)(this).constructor;l=Reflect.construct(u,arguments,d)}else l=u.apply(this,arguments);return(0,be.Z)(this,l)}}function Ag(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}x(68982)(`/* @antv/l7-maps */
.mapboxgl-ctrl-logo {
 display: none !important;
}
`);var Cg=function(i){(0,ne.Z)(o,i);var f=Tg(o);function o(){return(0,Y.Z)(this,o),f.apply(this,arguments)}return(0,le.Z)(o,[{key:"getServiceConstructor",value:function(){return wg}}]),o}(lg);function mm(i,f){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(i);f&&(u=u.filter(function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable})),o.push.apply(o,u)}return o}function gm(i){for(var f=1;f<arguments.length;f++){var o=arguments[f]!=null?arguments[f]:{};f%2?mm(Object(o),!0).forEach(function(u){Pg(i,u,o[u])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):mm(Object(o)).forEach(function(u){Object.defineProperty(i,u,Object.getOwnPropertyDescriptor(o,u))})}return i}function Pg(i,f,o){return f in i?Object.defineProperty(i,f,{value:o,enumerable:!0,configurable:!0,writable:!0}):i[f]=o,i}function Mg(i,f){return Rg(i)||Lg(i,f)||Og(i,f)||Ig()}function Ig(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Og(i,f){if(!!i){if(typeof i=="string")return ym(i,f);var o=Object.prototype.toString.call(i).slice(8,-1);if(o==="Object"&&i.constructor&&(o=i.constructor.name),o==="Map"||o==="Set")return Array.from(i);if(o==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return ym(i,f)}}function ym(i,f){(f==null||f>i.length)&&(f=i.length);for(var o=0,u=new Array(f);o<f;o++)u[o]=i[o];return u}function Lg(i,f){var o=i==null?null:typeof Symbol!="undefined"&&i[Symbol.iterator]||i["@@iterator"];if(o!=null){var u=[],l=!0,d=!1,y,A;try{for(o=o.call(i);!(l=(y=o.next()).done)&&(u.push(y.value),!(f&&u.length===f));l=!0);}catch(M){d=!0,A=M}finally{try{!l&&o.return!=null&&o.return()}finally{if(d)throw A}}return u}}function Rg(i){if(Array.isArray(i))return i}var Dg=J.memo(function(i){var f=i.style,o=i.className,u=i.map,l=i.option,d=i.onSceneLoaded,y=(0,J.createRef)(),A=(0,J.useState)(),M=Mg(A,2),D=M[0],ee=M[1];return(0,J.useEffect)(function(){var X=new po(gm(gm({id:y.current},l),{},{map:new Cg(u)}));return X.on("loaded",function(){ee(X),d&&d(X)}),function(){X.destroy()}},[]),(0,J.useEffect)(function(){D&&u.style&&D.setMapStyle(u.style)},[JSON.stringify(u.style)]),(0,J.useEffect)(function(){D&&u.zoom&&D.setZoom(u.zoom)},[u.zoom]),(0,J.useEffect)(function(){D&&u.center&&D.setCenter(u.center)},[JSON.stringify(u.center)]),(0,J.useEffect)(function(){D&&u.pitch!==void 0&&D.setPitch(u.pitch||0)},[u.pitch]),(0,J.useEffect)(function(){D&&u.rotation&&D.setRotation(u.rotation)},[u.rotation]),J.createElement(E.Provider,{value:D},(0,J.createElement)("div",{ref:y,style:f,className:o},D&&i.children))}),kg=Dg;function _m(i,f){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(i);f&&(u=u.filter(function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable})),o.push.apply(o,u)}return o}function y0(i){for(var f=1;f<arguments.length;f++){var o=arguments[f]!=null?arguments[f]:{};f%2?_m(Object(o),!0).forEach(function(u){Fg(i,u,o[u])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):_m(Object(o)).forEach(function(u){Object.defineProperty(i,u,Object.getOwnPropertyDescriptor(o,u))})}return i}function Fg(i,f,o){return f in i?Object.defineProperty(i,f,{value:o,enumerable:!0,configurable:!0,writable:!0}):i[f]=o,i}function _0(i,f){return Ug(i)||Bg(i,f)||Ng(i,f)||zg()}function zg(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Ng(i,f){if(!!i){if(typeof i=="string")return xm(i,f);var o=Object.prototype.toString.call(i).slice(8,-1);if(o==="Object"&&i.constructor&&(o=i.constructor.name),o==="Map"||o==="Set")return Array.from(i);if(o==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return xm(i,f)}}function xm(i,f){(f==null||f>i.length)&&(f=i.length);for(var o=0,u=new Array(f);o<f;o++)u[o]=i[o];return u}function Bg(i,f){var o=i==null?null:typeof Symbol!="undefined"&&i[Symbol.iterator]||i["@@iterator"];if(o!=null){var u=[],l=!0,d=!1,y,A;try{for(o=o.call(i);!(l=(y=o.next()).done)&&(u.push(y.value),!(f&&u.length===f));l=!0);}catch(M){d=!0,A=M}finally{try{!l&&o.return!=null&&o.return()}finally{if(d)throw A}}return u}}function Ug(i){if(Array.isArray(i))return i}var x0=null,b0=null;function bm(i,f){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(i);f&&(u=u.filter(function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable})),o.push.apply(o,u)}return o}function S0(i){for(var f=1;f<arguments.length;f++){var o=arguments[f]!=null?arguments[f]:{};f%2?bm(Object(o),!0).forEach(function(u){jg(i,u,o[u])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):bm(Object(o)).forEach(function(u){Object.defineProperty(i,u,Object.getOwnPropertyDescriptor(o,u))})}return i}function jg(i,f,o){return f in i?Object.defineProperty(i,f,{value:o,enumerable:!0,configurable:!0,writable:!0}):i[f]=o,i}function E0(i,f){return Hg(i)||Gg(i,f)||Vg(i,f)||Zg()}function Zg(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Vg(i,f){if(!!i){if(typeof i=="string")return Sm(i,f);var o=Object.prototype.toString.call(i).slice(8,-1);if(o==="Object"&&i.constructor&&(o=i.constructor.name),o==="Map"||o==="Set")return Array.from(i);if(o==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return Sm(i,f)}}function Sm(i,f){(f==null||f>i.length)&&(f=i.length);for(var o=0,u=new Array(f);o<f;o++)u[o]=i[o];return u}function Gg(i,f){var o=i==null?null:typeof Symbol!="undefined"&&i[Symbol.iterator]||i["@@iterator"];if(o!=null){var u=[],l=!0,d=!1,y,A;try{for(o=o.call(i);!(l=(y=o.next()).done)&&(u.push(y.value),!(f&&u.length===f));l=!0);}catch(M){d=!0,A=M}finally{try{!l&&o.return!=null&&o.return()}finally{if(d)throw A}}return u}}function Hg(i){if(Array.isArray(i))return i}var w0=null,T0=null;function A0(i,f){return Kg(i)||Yg(i,f)||Xg(i,f)||Wg()}function Wg(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Xg(i,f){if(!!i){if(typeof i=="string")return Em(i,f);var o=Object.prototype.toString.call(i).slice(8,-1);if(o==="Object"&&i.constructor&&(o=i.constructor.name),o==="Map"||o==="Set")return Array.from(i);if(o==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return Em(i,f)}}function Em(i,f){(f==null||f>i.length)&&(f=i.length);for(var o=0,u=new Array(f);o<f;o++)u[o]=i[o];return u}function Yg(i,f){var o=i==null?null:typeof Symbol!="undefined"&&i[Symbol.iterator]||i["@@iterator"];if(o!=null){var u=[],l=!0,d=!1,y,A;try{for(o=o.call(i);!(l=(y=o.next()).done)&&(u.push(y.value),!(f&&u.length===f));l=!0);}catch(M){d=!0,A=M}finally{try{!l&&o.return!=null&&o.return()}finally{if(d)throw A}}return u}}function Kg(i){if(Array.isArray(i))return i}var C0=null,P0=null;function wm(i,f){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(i);f&&(u=u.filter(function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable})),o.push.apply(o,u)}return o}function M0(i){for(var f=1;f<arguments.length;f++){var o=arguments[f]!=null?arguments[f]:{};f%2?wm(Object(o),!0).forEach(function(u){$g(i,u,o[u])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):wm(Object(o)).forEach(function(u){Object.defineProperty(i,u,Object.getOwnPropertyDescriptor(o,u))})}return i}function $g(i,f,o){return f in i?Object.defineProperty(i,f,{value:o,enumerable:!0,configurable:!0,writable:!0}):i[f]=o,i}function I0(i,f){if(i==null)return{};var o=Jg(i,f),u,l;if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(i);for(l=0;l<d.length;l++)u=d[l],!(f.indexOf(u)>=0)&&(!Object.prototype.propertyIsEnumerable.call(i,u)||(o[u]=i[u]))}return o}function Jg(i,f){if(i==null)return{};var o={},u=Object.keys(i),l,d;for(d=0;d<u.length;d++)l=u[d],!(f.indexOf(l)>=0)&&(o[l]=i[l]);return o}var O0=null,Tm=x(73935);function Qg(i,f){return ry(i)||ty(i,f)||ey(i,f)||qg()}function qg(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function ey(i,f){if(!!i){if(typeof i=="string")return Am(i,f);var o=Object.prototype.toString.call(i).slice(8,-1);if(o==="Object"&&i.constructor&&(o=i.constructor.name),o==="Map"||o==="Set")return Array.from(i);if(o==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return Am(i,f)}}function Am(i,f){(f==null||f>i.length)&&(f=i.length);for(var o=0,u=new Array(f);o<f;o++)u[o]=i[o];return u}function ty(i,f){var o=i==null?null:typeof Symbol!="undefined"&&i[Symbol.iterator]||i["@@iterator"];if(o!=null){var u=[],l=!0,d=!1,y,A;try{for(o=o.call(i);!(l=(y=o.next()).done)&&(u.push(y.value),!(f&&u.length===f));l=!0);}catch(M){d=!0,A=M}finally{try{!l&&o.return!=null&&o.return()}finally{if(d)throw A}}return u}}function ry(i){if(Array.isArray(i))return i}var ny=J.useEffect,iy=J.useState;function L0(i){var f=i.className,o=i.style,u=i.children,l=i.position,d=useSceneValue(),y=iy(function(){return document.createElement("div")}),A=Qg(y,1),M=A[0];return ny(function(){var D=new Control({position:l});return D.onAdd=function(){if(f&&(M.className=f),o){var ee=Object.keys(o).map(function(X){return"".concat(X,":").concat(o[X])}).join(";");M.style.cssText=ee}return M},d.addControl(D),function(){d.removeControl(D)}},[]),createPortal(u,M)}var Cm=(0,J.createContext)({});function R0(){return useContext(Cm)}var ay=J.useEffect,oy=J.memo(function(f){var o=f.layer,u=f.active;return ay(function(){o.active(u.option)},[JSON.stringify(u)]),null}),sy=J.useEffect,uy=J.memo(function(f){var o=f.layer,u=f.animate;return sy(function(){o.animate(u)},[JSON.stringify(u)]),null}),ly=J.useEffect,cy=J.memo(function(f){var o=f.layer,u=f.color;return ly(function(){u.field?o.color(u.field,u.values):o.color(u.values)},[u.field,u.scale,JSON.stringify(u.values),JSON.stringify(u.options)]),null}),fy=J.useEffect,hy=J.memo(function(f){var o=f.layer,u=f.filter;return fy(function(){u.field&&o.filter(u.field,u.values)},[u.field,u.values,JSON.stringify(u.values),JSON.stringify(u.options)]),null}),py=J.useEffect,dy=J.memo(function(f){var o=f.layer,u=f.scale;return py(function(){o.scale(u.values)},[u.values]),null}),vy=J.useEffect,my=J.memo(function(f){var o=f.layer,u=f.select;return vy(function(){o.select(u.option)},[JSON.stringify(u)]),null}),gy=J.useEffect,yy=J.memo(function(f){var o=f.layer,u=f.shape;return gy(function(){u.field?o.shape(u.field,u.values):o.shape(u.values)},[u.field,JSON.stringify(u.values),JSON.stringify(u.options)]),null}),_y=J.useEffect,xy=J.memo(function(f){var o=f.layer,u=f.size;return _y(function(){u.field?o.size(u.field,u.values):o.size(u.values)},[u.field,u.scale,JSON.stringify(u.values),JSON.stringify(u.options)]),null}),by=["data"];function Sy(i,f){if(i==null)return{};var o=Ey(i,f),u,l;if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(i);for(l=0;l<d.length;l++)u=d[l],!(f.indexOf(u)>=0)&&(!Object.prototype.propertyIsEnumerable.call(i,u)||(o[u]=i[u]))}return o}function Ey(i,f){if(i==null)return{};var o={},u=Object.keys(i),l,d;for(d=0;d<u.length;d++)l=u[d],!(f.indexOf(l)>=0)&&(o[l]=i[l]);return o}var wy=J.useEffect,Ty=J.memo(function(f){var o=f.layer,u=f.source,l=u.data,d=Sy(u,by);return wy(function(){o.inited?o.setData(l,d):o.source(l,d),d.autoFit&&o.fitBounds(d&&d.fitBoundsOptions)},[l,JSON.stringify(d)]),null}),Ay=J.useEffect,Cy=J.memo(function(f){var o=f.layer,u=f.style;return Ay(function(){o.style(u)},Object.keys(u).map(function(l){return u[l]})),null});function Py(i,f){return Ly(i)||Oy(i,f)||Iy(i,f)||My()}function My(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Iy(i,f){if(!!i){if(typeof i=="string")return Pm(i,f);var o=Object.prototype.toString.call(i).slice(8,-1);if(o==="Object"&&i.constructor&&(o=i.constructor.name),o==="Map"||o==="Set")return Array.from(i);if(o==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return Pm(i,f)}}function Pm(i,f){(f==null||f>i.length)&&(f=i.length);for(var o=0,u=new Array(f);o<f;o++)u[o]=i[o];return u}function Oy(i,f){var o=i==null?null:typeof Symbol!="undefined"&&i[Symbol.iterator]||i["@@iterator"];if(o!=null){var u=[],l=!0,d=!1,y,A;try{for(o=o.call(i);!(l=(y=o.next()).done)&&(u.push(y.value),!(f&&u.length===f));l=!0);}catch(M){d=!0,A=M}finally{try{!l&&o.return!=null&&o.return()}finally{if(d)throw A}}return u}}function Ly(i){if(Array.isArray(i))return i}var Bp=J.useEffect,Ry=J.useState;function Mm(i,f){var o=f.source,u=f.color,l=f.shape,d=f.style,y=f.size,A=f.scale,M=f.active,D=f.select,ee=f.filter,X=f.animate,fe=f.options,Xe=f.onLayerLoaded,it=p(),Rt=Ry(function(){var jr;switch(i){case"polygonLayer":jr=new ai(fe);break;case"lineLayer":jr=new rl(fe);break;case"pointLayer":jr=new Nt(fe);break;case"heatmapLayer":jr=new kl(fe);break;case"rasterLayer":jr=new ro(fe);break;case"imageLayer":jr=new lo(fe);break;case"citybuildingLayer":jr=new Qu(fe);break;default:jr=new ai(fe)}return jr.on("inited",function(){Xe&&Xe(jr,it)}),jr}),xr=Py(Rt,1),Tr=xr[0];return Bp(function(){return it.addLayer(Tr),function(){it.removeLayer(Tr)}},[]),Bp(function(){Tr.inited&&fe&&Tr.updateLayerConfig(fe)},[fe==null?void 0:fe.minZoom,fe==null?void 0:fe.maxZoom,fe==null?void 0:fe.visible]),Bp(function(){Tr.inited&&(fe==null?void 0:fe.zIndex)&&Tr.setIndex(fe.zIndex)},[fe==null?void 0:fe.zIndex]),Bp(function(){Tr.inited&&(fe==null?void 0:fe.blend)&&Tr.setBlend(fe.blend)},[fe==null?void 0:fe.blend]),Bp(function(){it.render()}),J.createElement(Cm.Provider,{value:Tr},J.createElement(Ty,{layer:Tr,source:o}),A&&J.createElement(dy,{layer:Tr,scale:A}),u&&J.createElement(cy,{layer:Tr,color:u}),y&&J.createElement(xy,{layer:Tr,size:y}),l&&J.createElement(yy,{layer:Tr,shape:l}),d&&J.createElement(Cy,{layer:Tr,style:d}),M&&J.createElement(oy,{layer:Tr,active:M}),D&&J.createElement(my,{layer:Tr,select:D}),ee&&J.createElement(hy,{layer:Tr,filter:ee}),X&&J.createElement(uy,{layer:Tr,animate:X}),f.children)}var D0=null,k0=null,Dy=J.memo(function(f){return Mm("pointLayer",f)}),ky=J.memo(function(f){return Mm("heatmapLayer",f)}),F0=null,z0=null,N0=null,B0=J.useEffect,U0=null,j0=null;function Sd(i){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Sd=function(o){return typeof o}:Sd=function(o){return o&&typeof Symbol=="function"&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},Sd(i)}function Im(i,f){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(i);f&&(u=u.filter(function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable})),o.push.apply(o,u)}return o}function Ed(i){for(var f=1;f<arguments.length;f++){var o=arguments[f]!=null?arguments[f]:{};f%2?Im(Object(o),!0).forEach(function(u){Fy(i,u,o[u])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):Im(Object(o)).forEach(function(u){Object.defineProperty(i,u,Object.getOwnPropertyDescriptor(o,u))})}return i}function Fy(i,f,o){return f in i?Object.defineProperty(i,f,{value:o,enumerable:!0,configurable:!0,writable:!0}):i[f]=o,i}function zy(i,f){if(!(i instanceof f))throw new TypeError("Cannot call a class as a function")}function Om(i,f){for(var o=0;o<f.length;o++){var u=f[o];u.enumerable=u.enumerable||!1,u.configurable=!0,"value"in u&&(u.writable=!0),Object.defineProperty(i,u.key,u)}}function Ny(i,f,o){return f&&Om(i.prototype,f),o&&Om(i,o),i}function By(i,f){if(typeof f!="function"&&f!==null)throw new TypeError("Super expression must either be null or a function");i.prototype=Object.create(f&&f.prototype,{constructor:{value:i,writable:!0,configurable:!0}}),f&&Bd(i,f)}function Bd(i,f){return Bd=Object.setPrototypeOf||function(u,l){return u.__proto__=l,u},Bd(i,f)}function Uy(i){var f=Vy();return function(){var u=wd(i),l;if(f){var d=wd(this).constructor;l=Reflect.construct(u,arguments,d)}else l=u.apply(this,arguments);return jy(this,l)}}function jy(i,f){return f&&(Sd(f)==="object"||typeof f=="function")?f:Zy(i)}function Zy(i){if(i===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return i}function Vy(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}function wd(i){return wd=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)},wd(i)}var Z0=function(i){By(o,i);var f=Uy(o);function o(u){var l;return zy(this,o),l=f.call(this,u),l.el=void 0,l.scene=void 0,l.popup=void 0,l.el=document.createElement("div"),l}return Ny(o,[{key:"componentDidMount",value:function(){var l,d=this.props,y=d.lnglat,A=d.children,M=d.option,D=d.lngLat,ee=new Ue(Ed(Ed({},M),{},{stopPropagation:(l=this.props.option)===null||l===void 0?void 0:l.stopPropagation}));y&&ee.setLnglat(y),D&&ee.setLnglat(D),A&&ee.setDOMContent(this.el),this.popup=ee,this.scene.addPopup(ee)}},{key:"componentDidUpdate",value:function(l){var d,y,A,M,D,ee,X=Array.isArray(l.lnglat)?l.lnglat:[l==null||(d=l.lnglat)===null||d===void 0?void 0:d.lng,l==null||(y=l.lnglat)===null||y===void 0?void 0:y.lat],fe=Array.isArray(this.props.lnglat)?this.props.lnglat:[(A=this.props)===null||A===void 0||(M=A.lnglat)===null||M===void 0?void 0:M.lng,(D=this.props)===null||D===void 0||(ee=D.lnglat)===null||ee===void 0?void 0:ee.lat],Xe=X.toString()!==fe.toString();if(Xe){var it;this.popup.remove(),this.popup=new Ue(Ed(Ed({},this.props.option),{},{stopPropagation:(it=this.props.option)===null||it===void 0?void 0:it.stopPropagation})),this.popup.setLnglat(this.props.lnglat),this.popup.setDOMContent(this.el),this.scene.addPopup(this.popup)}}},{key:"componentWillUnmount",value:function(){this.popup.remove()}},{key:"render",value:function(){var l=this;return J.createElement(E.Consumer,{},function(d){return d&&(l.scene=d),(0,Tm.createPortal)(l.props.children,l.el)})}}]),o}(J.PureComponent);function Td(i){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Td=function(o){return typeof o}:Td=function(o){return o&&typeof Symbol=="function"&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},Td(i)}function Gy(i,f){if(!(i instanceof f))throw new TypeError("Cannot call a class as a function")}function Lm(i,f){for(var o=0;o<f.length;o++){var u=f[o];u.enumerable=u.enumerable||!1,u.configurable=!0,"value"in u&&(u.writable=!0),Object.defineProperty(i,u.key,u)}}function Hy(i,f,o){return f&&Lm(i.prototype,f),o&&Lm(i,o),i}function Wy(i,f){if(typeof f!="function"&&f!==null)throw new TypeError("Super expression must either be null or a function");i.prototype=Object.create(f&&f.prototype,{constructor:{value:i,writable:!0,configurable:!0}}),f&&Ud(i,f)}function Ud(i,f){return Ud=Object.setPrototypeOf||function(u,l){return u.__proto__=l,u},Ud(i,f)}function Xy(i){var f=$y();return function(){var u=Ad(i),l;if(f){var d=Ad(this).constructor;l=Reflect.construct(u,arguments,d)}else l=u.apply(this,arguments);return Yy(this,l)}}function Yy(i,f){return f&&(Td(f)==="object"||typeof f=="function")?f:Ky(i)}function Ky(i){if(i===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return i}function $y(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}function Ad(i){return Ad=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)},Ad(i)}var V0=function(i){Wy(o,i);var f=Xy(o);function o(u){var l;return Gy(this,o),l=f.call(this,u),l.el=void 0,l.scene=void 0,l.marker=void 0,l.el=document.createElement("div"),l}return Hy(o,[{key:"componentDidMount",value:function(){var l=this.props,d=l.lnglat,y=l.children,A=l.option,M=l.onMarkerLoaded,D=new Jt(A);d&&D.setLnglat(d),y&&D.setElement(this.el),this.marker=D,M&&M(D),this.scene.addMarker(D)}},{key:"componentDidUpdate",value:function(l){var d,y=(l==null?void 0:l.lnglat.toString())!==((d=this.props)===null||d===void 0?void 0:d.lnglat.toString());y&&this.marker.setLnglat(this.props.lnglat)}},{key:"componentWillUnmount",value:function(){this.marker&&this.marker.remove()}},{key:"render",value:function(){var l=this;return J.createElement(E.Consumer,{},function(d){return d&&(l.scene=d),(0,Tm.createPortal)(l.props.children,l.el)})}}]),o}(J.PureComponent),G0=J.useEffect,H0=null,W0=null,X0=J.useEffect,Y0=null},4771:function(){},6563:function(ur,L,x){var J=x(31795);ur.exports=E;function E(le,ne){switch(le&&le.type||null){case"FeatureCollection":return le.features=le.features.map(p(E,ne)),le;case"GeometryCollection":return le.geometries=le.geometries.map(p(E,ne)),le;case"Feature":return le.geometry=E(le.geometry,ne),le;case"Polygon":case"MultiPolygon":return w(le,ne);default:return le}}function p(le,ne){return function(be){return le(be,ne)}}function w(le,ne){return le.type==="Polygon"?le.coordinates=F(le.coordinates,ne):le.type==="MultiPolygon"&&(le.coordinates=le.coordinates.map(p(F,ne))),le}function F(le,ne){ne=!!ne,le[0]=Q(le[0],ne);for(var be=1;be<le.length;be++)le[be]=Q(le[be],!ne);return le}function Q(le,ne){return Y(le)===ne?le:le.reverse()}function Y(le){return J.ring(le)>=0}},6901:function(ur,L,x){"use strict";x.d(L,{SO:function(){return J},z6:function(){return Pr},a5:function(){return E},Z:function(){return Ct},rQ:function(){return Qt},bV:function(){return It},zi:function(){return gr},ds:function(){return Ar},Ev:function(){return Ke},oO:function(){return Er},W0:function(){return lr},Z6:function(){return qr},We:function(){return tt},Cl:function(){return ut},gJ:function(){return se},vP:function(){return z},yM:function(){return Ht},yA:function(){return _r},CI:function(){return lt}});var J={};x.r(J),x.d(J,{DPR:function(){return Ye},addClass:function(){return $t},create:function(){return we},empty:function(){return _t},getClass:function(){return Lt},getContainer:function(){return Y},getViewPortScale:function(){return gt},hasClass:function(){return Xt},printCanvas:function(){return ar},remove:function(){return Ie},removeClass:function(){return Zt},setClass:function(){return Ft},setTransform:function(){return Cr},splitWords:function(){return ne},triggerResize:function(){return Gt},trim:function(){return le}});var E={};x.r(E),x.d(E,{getColumn:function(){return si},getSatByColumn:function(){return G},max:function(){return gn},mean:function(){return xi},min:function(){return Cn},mode:function(){return Ri},statMap:function(){return Wi},sum:function(){return vi}});function p(I){var Z=131,$=137,ie=0;I+="x";for(var Le=Math.floor(9007199254740991/$),Ge=0;Ge<I.length;Ge++)ie>Le&&(ie=Math.floor(ie/$)),ie=ie*Z+I.charCodeAt(Ge);return ie}function w(I){I=I.toString();for(var Z=5381,$=I.length;$;)Z=Z*33^I.charCodeAt(--$);return Z>>>0}var F=x(28481),Q=window.document.documentElement.style;function Y(I){var Z=I;return typeof I=="string"&&(Z=document.getElementById(I)),Z}function le(I){return I.trim?I.trim():I.replace(/^\s+|\s+$/g,"")}function ne(I){return le(I).split(/\s+/)}function be(I){if(!Q)return I[0];for(var Z in I)if(I[Z]&&I[Z]in Q)return I[Z];return I[0]}function we(I,Z,$){var ie=document.createElement(I);return ie.className=Z||"",$&&$.appendChild(ie),ie}function Ie(I){var Z=I.parentNode;Z&&Z.removeChild(I)}function $t(I,Z){if(I.classList!==void 0)for(var $=ne(Z),ie=0,Le=$.length;ie<Le;ie++)I.classList.add($[ie]);else if(!Xt(I,Z)){var Ge=Lt(I);Ft(I,(Ge?Ge+" ":"")+Z)}}function Zt(I,Z){I.classList!==void 0?I.classList.remove(Z):Ft(I,le((" "+Lt(I)+" ").replace(" "+Z+" "," ")))}function Xt(I,Z){if(I.classList!==void 0)return I.classList.contains(Z);var $=Lt(I);return $.length>0&&new RegExp("(^|\\s)"+Z+"(\\s|$)").test($)}function Ft(I,Z){I instanceof HTMLElement?I.className=Z:I.className.baseVal=Z}function Lt(I){return I instanceof SVGElement&&(I=I.correspondingElement),I.className.baseVal===void 0?I.className:I.className.baseVal}function _t(I){for(;I&&I.firstChild;)I.removeChild(I.firstChild)}var pt=be(["transform","WebkitTransform"]);function Cr(I,Z){I.style[pt]=Z}function Gt(){if(typeof Event=="function")window.dispatchEvent(new Event("resize"));else{var I=window.document.createEvent("UIEvents");I.initUIEvent("resize",!0,!1,window,0),window.dispatchEvent(I)}}function ar(I){var Z=["padding: "+(I.height/2-8)+"px "+I.width/2+"px;","line-height: "+I.height+"px;","background-image: url("+I.toDataURL()+");"];console.log(`%c
`,Z.join(""))}function gt(){var I,Z=document.querySelector('meta[name="viewport"]');if(!Z)return 1;var $=(I=Z.content)===null||I===void 0?void 0:I.split(","),ie=$.find(function(Le){var Ge=Le.split("="),ue=(0,F.Z)(Ge,2),De=ue[0],wt=ue[1];return De==="initial-scale"});return ie?ie.split("=")[1]*1:1}var Ye=gt()<1?1:window.devicePixelRatio,Et=x(6610),Ne=x(5991),Ae=x(10379),Be=x(46070),bt=x(77608),ir=x(14665);function re(I){return Function.toString.call(I).indexOf("[native code]")!==-1}var Ee=x(51814);function ae(I,Z,$){return(0,Ee.Z)()?ae=Reflect.construct:ae=function(Le,Ge,ue){var De=[null];De.push.apply(De,Ge);var wt=Function.bind.apply(Le,De),Ir=new wt;return ue&&(0,ir.Z)(Ir,ue.prototype),Ir},ae.apply(null,arguments)}function me(I){var Z=typeof Map=="function"?new Map:void 0;return me=function(ie){if(ie===null||!re(ie))return ie;if(typeof ie!="function")throw new TypeError("Super expression must either be null or a function");if(typeof Z!="undefined"){if(Z.has(ie))return Z.get(ie);Z.set(ie,Le)}function Le(){return ae(ie,arguments,(0,bt.Z)(this).constructor)}return Le.prototype=Object.create(ie.prototype,{constructor:{value:Le,enumerable:!1,writable:!0,configurable:!0}}),(0,ir.Z)(Le,ie)},me(I)}function Te(I){var Z=Qe();return function(){var ie=(0,bt.Z)(I),Le;if(Z){var Ge=(0,bt.Z)(this).constructor;Le=Reflect.construct(ie,arguments,Ge)}else Le=ie.apply(this,arguments);return(0,Be.Z)(this,Le)}}function Qe(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(I){return!1}}var dt=function(I){(0,Ae.Z)($,I);var Z=Te($);function $(ie,Le,Ge){var ue;return(0,Et.Z)(this,$),ue=Z.call(this,ie),ue.status=void 0,ue.url=void 0,ue.status=Le,ue.url=Ge,ue.name=ue.constructor.name,ue.message=ie,ue}return(0,Ne.Z)($,[{key:"toString",value:function(){return"".concat(this.name,": ").concat(this.message," (").concat(this.status,"): ").concat(this.url)}}]),$}(me(Error));function Jt(I){var Z=new XMLHttpRequest;Z.open("GET",I.url,!0);for(var $ in I.headers)I.headers.hasOwnProperty($)&&Z.setRequestHeader($,I.headers[$]);return Z.withCredentials=I.credentials==="include",Z}var Nr=function(Z,$){var ie=Jt(Z);return ie.setRequestHeader("Accept","application/json"),ie.onerror=function(){$(new Error(ie.statusText))},ie.onload=function(){if(ie.status>=200&&ie.status<300&&ie.response){var Le;try{Le=JSON.parse(ie.response)}catch(Ge){return $(Ge)}$(null,Le)}else ie.status===401?$(new dt("".concat(ie.statusText),ie.status,Z.url)):$(new dt(ie.statusText,ie.status,Z.url))},ie.send(),ie},Fr=function(Z,$){var ie=Jt(Z);return ie.responseType="arraybuffer",ie.onerror=function(){$(new Error(ie.statusText))},ie.onload=function(){var Le=ie.response;if(Le.byteLength===0&&ie.status===200)return $(new Error("http status 200 returned without content."));ie.status>=200&&ie.status<300&&ie.response?$(null,{data:Le,cacheControl:ie.getResponseHeader("Cache-Control"),expires:ie.getResponseHeader("Expires")}):$(new dt(ie.statusText,ie.status,Z.url))},ie.send(),ie};function ln(I){var Z=window.document.createElement("a");return Z.href=I,Z.protocol===window.document.location.protocol&&Z.host===window.document.location.host}var tr="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=",se=function(Z,$){return Fr(Z,function(ie,Le){if(ie)$(ie);else if(Le){var Ge=new window.Image;Ge.crossOrigin="anonymous";var ue=window.URL||window.webkitURL;Ge.onload=function(){$(null,Ge),ue.revokeObjectURL(Ge.src)};var De=new window.Blob([new Uint8Array(Le.data)],{type:"image/png"});Ge.src=Le.data.byteLength?ue.createObjectURL(De):tr}})},ge=x(40271),Re=2*Math.PI*6378137/2;function tt(I){var Z=[Infinity,Infinity,-Infinity,-Infinity];return I.forEach(function($){var ie=$.coordinates;Mt(Z,ie)}),Z}function Mt(I,Z){return Array.isArray(Z[0])?Z.forEach(function($){Mt(I,$)}):(I[0]>Z[0]&&(I[0]=Z[0]),I[1]>Z[1]&&(I[1]=Z[1]),I[2]<Z[0]&&(I[2]=Z[0]),I[3]<Z[1]&&(I[3]=Z[1])),I}function Dt(I,Z){return S(I,Z)}function S(I,Z){return Array.isArray(I[0])?I.map(function($){return S($,Z)}):Z(I)}function z(I){var Z=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,$=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{enable:!0,decimal:1};I=mt(I,Z);var ie=I[0],Le=I[1],Ge=ie*Re/180,ue=Math.log(Math.tan((90+Le)*Math.PI/360))/(Math.PI/180);return ue=ue*Re/180,$.enable&&(Ge=Number(Ge.toFixed($.decimal)),ue=Number(ue.toFixed($.decimal))),I.length===3?[Ge,ue,I[2]]:[Ge,ue]}function pe(I){var Z=arguments.length>1&&arguments[1]!==void 0?arguments[1]:6,$=I[0],ie=I[1],Le=$/Re*180,Ge=ie/Re*180;return Ge=180/Math.PI*(2*Math.atan(Math.exp(Ge*Math.PI/180))-Math.PI/2),Z!=null&&(Le=Number(Le.toFixed(Z)),Ge=Number(Ge.toFixed(Z))),I.length===3?[Le,Ge,I[2]]:[Le,Ge]}function Ue(I){if(I==null)throw new Error("lng is required");return(I>180||I<-180)&&(I=I%360,I>180&&(I=-360+I),I<-180&&(I=360+I),I===0&&(I=0)),I}function Je(I){if(I==null)throw new Error("lat is required");return(I>90||I<-90)&&(I=I%180,I>90&&(I=-180+I),I<-90&&(I=180+I),I===0&&(I=0)),I}function mt(I,Z){if(Z===!1)return I;var $=Ue(I[0]),ie=Je(I[1]);return ie>85&&(ie=85),ie<-85&&(ie=-85),I.length===3?[$,ie,I[2]]:[$,ie]}function Ct(I){var Z=85.0511287798,$=Math.max(Math.min(Z,I[1]),-Z),ie=256<<20,Le=Math.PI/180,Ge=I[0]*Le,ue=$*Le;ue=Math.log(Math.tan(Math.PI/4+ue/2));var De=.5/Math.PI,wt=.5,Ir=-.5/Math.PI;return Le=.5,Ge=ie*(De*Ge+wt),ue=ie*(Ir*ue+Le),[Math.floor(Ge),Math.floor(ue)]}function H(I){var Z=.5/Math.PI,$=.5,ie=-.5/Math.PI,Le=.5,Ge=256<<20,ue=_slicedToArray(I,2),De=ue[0],wt=ue[1];De=(De/Ge-$)/Z,wt=(wt/Ge-Le)/ie,wt=(Math.atan(Math.pow(Math.E,wt))-Math.PI/4)*2,Le=Math.PI/180;var Ir=wt/Le,Ur=De/Le;return[Ur,Ir]}function Ht(I,Z,$){var ie=(0,ge.Ht)(Z[1]-I[1]),Le=(0,ge.Ht)(Z[0]-I[0]),Ge=(0,ge.Ht)(I[1]),ue=(0,ge.Ht)(Z[1]),De=Math.pow(Math.sin(ie/2),2)+Math.pow(Math.sin(Le/2),2)*Math.cos(Ge)*Math.cos(ue);return(0,ge.DL)(2*Math.atan2(Math.sqrt(De),Math.sqrt(1-De)),$="meters")}function Vt(I){var Z=Math.PI/180,$=85.0511287798,ie=6378137,Le=Math.max(Math.min($,I[1]),-$),Ge=Math.sin(Le*Z),ue=ie*I[0]*Z,De=ie*Math.log((1+Ge)/(1-Ge))/2;return[ue,De]}function _r(I,Z){var $=Math.abs(I[1][1]-I[0][1])*Z,ie=Math.abs(I[1][0]-I[0][0])*Z;return[[I[0][0]-ie,I[0][1]-$],[I[1][0]+ie,I[1][1]+$]]}function Er(I,Z){return I[0][0]<=Z[0][0]&&I[0][1]<=Z[0][1]&&I[1][0]>=Z[1][0]&&I[1][1]>=Z[1][1]}function Ar(I){return[[I[0],I[1]],[I[2],I[3]]]}var Pr=function(){function I(){var Z=arguments.length>0&&arguments[0]!==void 0?arguments[0]:50,$=arguments.length>1?arguments[1]:void 0;(0,Et.Z)(this,I),this.limit=void 0,this.cache=void 0,this.destroy=void 0,this.order=void 0,this.limit=Z,this.destroy=$||this.defaultDestroy,this.order=[],this.clear()}return(0,Ne.Z)(I,[{key:"clear",value:function(){var $=this;this.order.forEach(function(ie){$.delete(ie)}),this.cache={},this.order=[]}},{key:"get",value:function($){var ie=this.cache[$];return ie&&(this.deleteOrder($),this.appendOrder($)),ie}},{key:"set",value:function($,ie){this.cache[$]?(this.delete($),this.cache[$]=ie,this.appendOrder($)):(Object.keys(this.cache).length===this.limit&&this.delete(this.order[0]),this.cache[$]=ie,this.appendOrder($))}},{key:"delete",value:function($){var ie=this.cache[$];ie&&(this.deleteCache($),this.deleteOrder($),this.destroy(ie,$))}},{key:"deleteCache",value:function($){delete this.cache[$]}},{key:"deleteOrder",value:function($){var ie=this.order.findIndex(function(Le){return Le===$});ie>=0&&this.order.splice(ie,1)}},{key:"appendOrder",value:function($){this.order.push($)}},{key:"defaultDestroy",value:function($,ie){return null}}]),I}();function Ke(I,Z){I.forEach(function($){!Z[$]||(Z[$]=Z[$].bind(Z))})}var yt=x(2650);function lt(I){var Z=yt.ZP(I),$=[0,0,0,0];return Z!=null&&($[0]=Z.r/255,$[1]=Z.g/255,$[2]=Z.b/255,$[3]=Z.opacity),$}function lr(I){var Z=I&&I[0],$=I&&I[1],ie=I&&I[2],Le=Z+$*256+ie*65536-1;return Le}function qr(I){return[I+1&255,I+1>>8&255,I+1>>8>>8&255]}function ut(I){var Z=document.createElement("canvas"),$=Z.getContext("2d");Z.width=256,Z.height=1;for(var ie=$.createLinearGradient(0,0,256,1),Le=null,Ge=I.positions[0],ue=I.positions[I.positions.length-1],De=0;De<I.colors.length;++De){var wt=(I.positions[De]-Ge)/(ue-Ge);ie.addColorStop(wt,I.colors[De])}return $.fillStyle=ie,$.fillRect(0,0,256,1),Le=new Uint8ClampedArray($.getImageData(0,0,256,1).data),new ImageData(Le,256,1)}var It;(function(I){I.CENTER="center",I.TOP="top",I["TOP-LEFT"]="top-left",I["TOP-RIGHT"]="top-right",I.BOTTOM="bottom",I["BOTTOM-LEFT"]="bottom-left",I.LEFT="left",I.RIGHT="right"})(It||(It={}));var Qt={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function gr(I,Z,$){var ie=I.classList;for(var Le in Qt)Qt.hasOwnProperty(Le)&&ie.remove("l7-".concat($,"-anchor-").concat(Le));ie.add("l7-".concat($,"-anchor-").concat(Z))}function gn(I){if(I.length===0)throw new Error("max requires at least one data point");for(var Z=I[0],$=1;$<I.length;$++)I[$]>Z&&(Z=I[$]);return Z*1}function Cn(I){if(I.length===0)throw new Error("min requires at least one data point");for(var Z=I[0],$=1;$<I.length;$++)I[$]<Z&&(Z=I[$]);return Z*1}function vi(I){if(I.length===0)return 0;for(var Z=I[0]*1,$=1;$<I.length;$++)Z+=I[$]*1;return Z}function xi(I){if(I.length===0)throw new Error("mean requires at least one data point");return vi(I)/I.length}function Ri(I){if(I.length===0)throw new Error("mean requires at least one data point");if(I.length<3)return I[0];I.sort();for(var Z=I[0],$=NaN,ie=0,Le=1,Ge=1;Ge<I.length+1;Ge++)I[Ge]!==Z?(Le>ie&&(ie=Le,$=Z),Le=1,Z=I[Ge]):Le++;return $*1}var Wi={min:Cn,max:gn,mean:xi,sum:vi,mode:Ri};function si(I,Z){return I.map(function($){return $[Z]})}function G(I,Z){return Wi[I](Z)}},3473:function(ur,L,x){"use strict";x.d(L,{Z:function(){return J}});function J(E,p,w,F,Q){var Y={};return Object.keys(F).forEach(function(le){Y[le]=F[le]}),Y.enumerable=!!Y.enumerable,Y.configurable=!!Y.configurable,("value"in Y||Y.initializer)&&(Y.writable=!0),Y=w.slice().reverse().reduce(function(le,ne){return ne(E,p,le)||le},Y),Q&&Y.initializer!==void 0&&(Y.value=Y.initializer?Y.initializer.call(Q):void 0,Y.initializer=void 0),Y.initializer===void 0&&(Object.defineProperty(E,p,Y),Y=null),Y}},66213:function(ur,L,x){"use strict";x.d(L,{Z:function(){return p}});var J=x(77608);function E(w,F){for(;!Object.prototype.hasOwnProperty.call(w,F)&&(w=(0,J.Z)(w),w!==null););return w}function p(w,F,Q){return typeof Reflect!="undefined"&&Reflect.get?p=Reflect.get:p=function(le,ne,be){var we=E(le,ne);if(!!we){var Ie=Object.getOwnPropertyDescriptor(we,ne);return Ie.get?Ie.get.call(be):Ie.value}},p(w,F,Q||w)}},55770:function(ur,L,x){"use strict";x.d(L,{Z:function(){return J}});function J(E,p,w,F){!w||Object.defineProperty(E,p,{enumerable:w.enumerable,configurable:w.configurable,writable:w.writable,value:w.initializer?w.initializer.call(F):void 0})}},31795:function(ur,L,x){var J=x(75752);ur.exports.geometry=E,ur.exports.ring=w;function E(Q){var Y=0,le;switch(Q.type){case"Polygon":return p(Q.coordinates);case"MultiPolygon":for(le=0;le<Q.coordinates.length;le++)Y+=p(Q.coordinates[le]);return Y;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(le=0;le<Q.geometries.length;le++)Y+=E(Q.geometries[le]);return Y}}function p(Q){var Y=0;if(Q&&Q.length>0){Y+=Math.abs(w(Q[0]));for(var le=1;le<Q.length;le++)Y-=Math.abs(w(Q[le]))}return Y}function w(Q){var Y,le,ne,be,we,Ie,$t,Zt=0,Xt=Q.length;if(Xt>2){for($t=0;$t<Xt;$t++)$t===Xt-2?(be=Xt-2,we=Xt-1,Ie=0):$t===Xt-1?(be=Xt-1,we=0,Ie=1):(be=$t,we=$t+1,Ie=$t+2),Y=Q[be],le=Q[we],ne=Q[Ie],Zt+=(F(ne[0])-F(Y[0]))*Math.sin(F(le[1]));Zt=Zt*J.RADIUS*J.RADIUS/2}return Zt}function F(Q){return Q*Math.PI/180}},49296:function(ur){"use strict";ur.exports=x,ur.exports.default=x;var L=1e20;function x(F,Q,Y,le,ne,be){this.fontSize=F||24,this.buffer=Q===void 0?3:Q,this.cutoff=le||.25,this.fontFamily=ne||"sans-serif",this.fontWeight=be||"normal",this.radius=Y||8;var we=this.size=this.fontSize+this.buffer*2,Ie=we+this.buffer*2;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=we,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textAlign="left",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(Ie*Ie),this.gridInner=new Float64Array(Ie*Ie),this.f=new Float64Array(Ie),this.z=new Float64Array(Ie+1),this.v=new Uint16Array(Ie),this.useMetrics=this.ctx.measureText("A").actualBoundingBoxLeft!==void 0,this.middle=Math.round(we/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function J(F,Q,Y,le,ne,be,we){be.fill(L,0,Q*Y),we.fill(0,0,Q*Y);for(var Ie=(Q-le)/2,$t=0;$t<ne;$t++)for(var Zt=0;Zt<le;Zt++){var Xt=($t+Ie)*Q+Zt+Ie,Ft=F.data[4*($t*le+Zt)+3]/255;if(Ft===1)be[Xt]=0,we[Xt]=L;else if(Ft===0)be[Xt]=L,we[Xt]=0;else{var Lt=Math.max(0,.5-Ft),_t=Math.max(0,Ft-.5);be[Xt]=Lt*Lt,we[Xt]=_t*_t}}}function E(F,Q,Y,le,ne,be,we){for(var Ie=0;Ie<Q*Y;Ie++){var $t=Math.sqrt(le[Ie])-Math.sqrt(ne[Ie]);F[Ie]=Math.round(255-255*($t/be+we))}}x.prototype._draw=function(F,Q){var Y=this.ctx.measureText(F),le=Y.width,ne=2*this.buffer,be,we,Ie,$t,Zt,Xt,Ft,Lt;Q&&this.useMetrics?(Zt=Math.floor(Y.actualBoundingBoxAscent),Lt=this.buffer+Math.ceil(Y.actualBoundingBoxAscent),Xt=this.buffer,Ft=this.buffer,we=Math.min(this.size,Math.ceil(Y.actualBoundingBoxRight-Y.actualBoundingBoxLeft)),$t=Math.min(this.size-Xt,Math.ceil(Y.actualBoundingBoxAscent+Y.actualBoundingBoxDescent)),be=we+ne,Ie=$t+ne,this.ctx.textBaseline="alphabetic"):(be=we=this.size,Ie=$t=this.size,Zt=19*this.fontSize/24,Xt=Ft=0,Lt=this.middle,this.ctx.textBaseline="middle");var _t;we&&$t&&(this.ctx.clearRect(Ft,Xt,we,$t),this.ctx.fillText(F,this.buffer,Lt),_t=this.ctx.getImageData(Ft,Xt,we,$t));var pt=new Uint8ClampedArray(be*Ie);return J(_t,be,Ie,we,$t,this.gridOuter,this.gridInner),p(this.gridOuter,be,Ie,this.f,this.v,this.z),p(this.gridInner,be,Ie,this.f,this.v,this.z),E(pt,be,Ie,this.gridOuter,this.gridInner,this.radius,this.cutoff),{data:pt,metrics:{width:we,height:$t,sdfWidth:be,sdfHeight:Ie,top:Zt,left:0,advance:le}}},x.prototype.draw=function(F){return this._draw(F,!1).data},x.prototype.drawWithMetrics=function(F){return this._draw(F,!0)};function p(F,Q,Y,le,ne,be){for(var we=0;we<Q;we++)w(F,we,Q,Y,le,ne,be);for(var Ie=0;Ie<Y;Ie++)w(F,Ie*Q,1,Q,le,ne,be)}function w(F,Q,Y,le,ne,be,we){var Ie,$t,Zt,Xt;for(be[0]=0,we[0]=-L,we[1]=L,Ie=0;Ie<le;Ie++)ne[Ie]=F[Q+Ie*Y];for(Ie=1,$t=0,Zt=0;Ie<le;Ie++){do Xt=be[$t],Zt=(ne[Ie]-ne[Xt]+Ie*Ie-Xt*Xt)/(Ie-Xt)/2;while(Zt<=we[$t]&&--$t>-1);$t++,be[$t]=Ie,we[$t]=Zt,we[$t+1]=L}for(Ie=0,$t=0;Ie<le;Ie++){for(;we[$t+1]<Ie;)$t++;Xt=be[$t],F[Q+Ie*Y]=ne[Xt]+(Ie-Xt)*(Ie-Xt)}}},40271:function(ur,L,x){"use strict";x.d(L,{zL:function(){return F},DL:function(){return pt},Ht:function(){return Ye}});var J=63710088e-1,E={centimeters:J*100,centimetres:J*100,degrees:J/111325,feet:J*3.28084,inches:J*39.37,kilometers:J/1e3,kilometres:J/1e3,meters:J,metres:J,miles:J/1609.344,millimeters:J*1e3,millimetres:J*1e3,nauticalmiles:J/1852,radians:1,yards:J*1.0936},p={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/J,yards:1.0936133},w={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function F(re,Ee,ae){ae===void 0&&(ae={});var me={type:"Feature"};return(ae.id===0||ae.id)&&(me.id=ae.id),ae.bbox&&(me.bbox=ae.bbox),me.properties=Ee||{},me.geometry=re,me}function Q(re,Ee,ae){switch(ae===void 0&&(ae={}),re){case"Point":return Y(Ee).geometry;case"LineString":return we(Ee).geometry;case"Polygon":return ne(Ee).geometry;case"MultiPoint":return Xt(Ee).geometry;case"MultiLineString":return Zt(Ee).geometry;case"MultiPolygon":return Ft(Ee).geometry;default:throw new Error(re+" is invalid")}}function Y(re,Ee,ae){if(ae===void 0&&(ae={}),!re)throw new Error("coordinates is required");if(!Array.isArray(re))throw new Error("coordinates must be an Array");if(re.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Ae(re[0])||!Ae(re[1]))throw new Error("coordinates must contain numbers");var me={type:"Point",coordinates:re};return F(me,Ee,ae)}function le(re,Ee,ae){return ae===void 0&&(ae={}),$t(re.map(function(me){return Y(me,Ee)}),ae)}function ne(re,Ee,ae){ae===void 0&&(ae={});for(var me=0,Te=re;me<Te.length;me++){var Qe=Te[me];if(Qe.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var dt=0;dt<Qe[Qe.length-1].length;dt++)if(Qe[Qe.length-1][dt]!==Qe[0][dt])throw new Error("First and last Position are not equivalent.")}var Jt={type:"Polygon",coordinates:re};return F(Jt,Ee,ae)}function be(re,Ee,ae){return ae===void 0&&(ae={}),$t(re.map(function(me){return ne(me,Ee)}),ae)}function we(re,Ee,ae){if(ae===void 0&&(ae={}),re.length<2)throw new Error("coordinates must be an array of two or more positions");var me={type:"LineString",coordinates:re};return F(me,Ee,ae)}function Ie(re,Ee,ae){return ae===void 0&&(ae={}),$t(re.map(function(me){return we(me,Ee)}),ae)}function $t(re,Ee){Ee===void 0&&(Ee={});var ae={type:"FeatureCollection"};return Ee.id&&(ae.id=Ee.id),Ee.bbox&&(ae.bbox=Ee.bbox),ae.features=re,ae}function Zt(re,Ee,ae){ae===void 0&&(ae={});var me={type:"MultiLineString",coordinates:re};return F(me,Ee,ae)}function Xt(re,Ee,ae){ae===void 0&&(ae={});var me={type:"MultiPoint",coordinates:re};return F(me,Ee,ae)}function Ft(re,Ee,ae){ae===void 0&&(ae={});var me={type:"MultiPolygon",coordinates:re};return F(me,Ee,ae)}function Lt(re,Ee,ae){ae===void 0&&(ae={});var me={type:"GeometryCollection",geometries:re};return F(me,Ee,ae)}function _t(re,Ee){if(Ee===void 0&&(Ee=0),Ee&&!(Ee>=0))throw new Error("precision must be a positive number");var ae=Math.pow(10,Ee||0);return Math.round(re*ae)/ae}function pt(re,Ee){Ee===void 0&&(Ee="kilometers");var ae=E[Ee];if(!ae)throw new Error(Ee+" units is invalid");return re*ae}function Cr(re,Ee){Ee===void 0&&(Ee="kilometers");var ae=E[Ee];if(!ae)throw new Error(Ee+" units is invalid");return re/ae}function Gt(re,Ee){return gt(Cr(re,Ee))}function ar(re){var Ee=re%360;return Ee<0&&(Ee+=360),Ee}function gt(re){var Ee=re%(2*Math.PI);return Ee*180/Math.PI}function Ye(re){var Ee=re%360;return Ee*Math.PI/180}function Et(re,Ee,ae){if(Ee===void 0&&(Ee="kilometers"),ae===void 0&&(ae="kilometers"),!(re>=0))throw new Error("length must be a positive number");return pt(Cr(re,Ee),ae)}function Ne(re,Ee,ae){if(Ee===void 0&&(Ee="meters"),ae===void 0&&(ae="kilometers"),!(re>=0))throw new Error("area must be a positive number");var me=w[Ee];if(!me)throw new Error("invalid original units");var Te=w[ae];if(!Te)throw new Error("invalid final units");return re/me*Te}function Ae(re){return!isNaN(re)&&re!==null&&!Array.isArray(re)}function Be(re){return!!re&&re.constructor===Object}function bt(re){if(!re)throw new Error("bbox is required");if(!Array.isArray(re))throw new Error("bbox must be an Array");if(re.length!==4&&re.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");re.forEach(function(Ee){if(!Ae(Ee))throw new Error("bbox must only contain numbers")})}function ir(re){if(!re)throw new Error("id is required");if(["string","number"].indexOf(typeof re)===-1)throw new Error("id must be a number or a string")}},17781:function(ur){ur.exports={"ant-pro-grid-content":"ant-pro-grid-content",wide:"wide"}},48583:function(ur,L,x){"use strict";var J=x(27418);/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
 * @license  MIT
 */function E(Ae,Be){if(Ae===Be)return 0;for(var bt=Ae.length,ir=Be.length,re=0,Ee=Math.min(bt,ir);re<Ee;++re)if(Ae[re]!==Be[re]){bt=Ae[re],ir=Be[re];break}return bt<ir?-1:ir<bt?1:0}function p(Ae){return x.g.Buffer&&typeof x.g.Buffer.isBuffer=="function"?x.g.Buffer.isBuffer(Ae):!!(Ae!=null&&Ae._isBuffer)}var w=x(30069),F=Object.prototype.hasOwnProperty,Q=Array.prototype.slice,Y=function(){return function(){}.name==="foo"}();function le(Ae){return Object.prototype.toString.call(Ae)}function ne(Ae){return p(Ae)||typeof x.g.ArrayBuffer!="function"?!1:typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(Ae):Ae?!!(Ae instanceof DataView||Ae.buffer&&Ae.buffer instanceof ArrayBuffer):!1}var be=ur.exports=Lt,we=/\s*function\s+([^\(\s]*)\s*/;function Ie(Ae){if(!!w.isFunction(Ae)){if(Y)return Ae.name;var Be=Ae.toString(),bt=Be.match(we);return bt&&bt[1]}}be.AssertionError=function(Be){this.name="AssertionError",this.actual=Be.actual,this.expected=Be.expected,this.operator=Be.operator,Be.message?(this.message=Be.message,this.generatedMessage=!1):(this.message=Xt(this),this.generatedMessage=!0);var bt=Be.stackStartFunction||Ft;if(Error.captureStackTrace)Error.captureStackTrace(this,bt);else{var ir=new Error;if(ir.stack){var re=ir.stack,Ee=Ie(bt),ae=re.indexOf(`
`+Ee);if(ae>=0){var me=re.indexOf(`
`,ae+1);re=re.substring(me+1)}this.stack=re}}},w.inherits(be.AssertionError,Error);function $t(Ae,Be){return typeof Ae=="string"?Ae.length<Be?Ae:Ae.slice(0,Be):Ae}function Zt(Ae){if(Y||!w.isFunction(Ae))return w.inspect(Ae);var Be=Ie(Ae),bt=Be?": "+Be:"";return"[Function"+bt+"]"}function Xt(Ae){return $t(Zt(Ae.actual),128)+" "+Ae.operator+" "+$t(Zt(Ae.expected),128)}function Ft(Ae,Be,bt,ir,re){throw new be.AssertionError({message:bt,actual:Ae,expected:Be,operator:ir,stackStartFunction:re})}be.fail=Ft;function Lt(Ae,Be){Ae||Ft(Ae,!0,Be,"==",be.ok)}be.ok=Lt,be.equal=function(Be,bt,ir){Be!=bt&&Ft(Be,bt,ir,"==",be.equal)},be.notEqual=function(Be,bt,ir){Be==bt&&Ft(Be,bt,ir,"!=",be.notEqual)},be.deepEqual=function(Be,bt,ir){_t(Be,bt,!1)||Ft(Be,bt,ir,"deepEqual",be.deepEqual)},be.deepStrictEqual=function(Be,bt,ir){_t(Be,bt,!0)||Ft(Be,bt,ir,"deepStrictEqual",be.deepStrictEqual)};function _t(Ae,Be,bt,ir){if(Ae===Be)return!0;if(p(Ae)&&p(Be))return E(Ae,Be)===0;if(w.isDate(Ae)&&w.isDate(Be))return Ae.getTime()===Be.getTime();if(w.isRegExp(Ae)&&w.isRegExp(Be))return Ae.source===Be.source&&Ae.global===Be.global&&Ae.multiline===Be.multiline&&Ae.lastIndex===Be.lastIndex&&Ae.ignoreCase===Be.ignoreCase;if((Ae===null||typeof Ae!="object")&&(Be===null||typeof Be!="object"))return bt?Ae===Be:Ae==Be;if(ne(Ae)&&ne(Be)&&le(Ae)===le(Be)&&!(Ae instanceof Float32Array||Ae instanceof Float64Array))return E(new Uint8Array(Ae.buffer),new Uint8Array(Be.buffer))===0;if(p(Ae)!==p(Be))return!1;ir=ir||{actual:[],expected:[]};var re=ir.actual.indexOf(Ae);return re!==-1&&re===ir.expected.indexOf(Be)?!0:(ir.actual.push(Ae),ir.expected.push(Be),Cr(Ae,Be,bt,ir))}function pt(Ae){return Object.prototype.toString.call(Ae)=="[object Arguments]"}function Cr(Ae,Be,bt,ir){if(Ae==null||Be===null||Be===void 0)return!1;if(w.isPrimitive(Ae)||w.isPrimitive(Be))return Ae===Be;if(bt&&Object.getPrototypeOf(Ae)!==Object.getPrototypeOf(Be))return!1;var re=pt(Ae),Ee=pt(Be);if(re&&!Ee||!re&&Ee)return!1;if(re)return Ae=Q.call(Ae),Be=Q.call(Be),_t(Ae,Be,bt);var ae=Ne(Ae),me=Ne(Be),Te,Qe;if(ae.length!==me.length)return!1;for(ae.sort(),me.sort(),Qe=ae.length-1;Qe>=0;Qe--)if(ae[Qe]!==me[Qe])return!1;for(Qe=ae.length-1;Qe>=0;Qe--)if(Te=ae[Qe],!_t(Ae[Te],Be[Te],bt,ir))return!1;return!0}be.notDeepEqual=function(Be,bt,ir){_t(Be,bt,!1)&&Ft(Be,bt,ir,"notDeepEqual",be.notDeepEqual)},be.notDeepStrictEqual=Gt;function Gt(Ae,Be,bt){_t(Ae,Be,!0)&&Ft(Ae,Be,bt,"notDeepStrictEqual",Gt)}be.strictEqual=function(Be,bt,ir){Be!==bt&&Ft(Be,bt,ir,"===",be.strictEqual)},be.notStrictEqual=function(Be,bt,ir){Be===bt&&Ft(Be,bt,ir,"!==",be.notStrictEqual)};function ar(Ae,Be){if(!Ae||!Be)return!1;if(Object.prototype.toString.call(Be)=="[object RegExp]")return Be.test(Ae);try{if(Ae instanceof Be)return!0}catch(bt){}return Error.isPrototypeOf(Be)?!1:Be.call({},Ae)===!0}function gt(Ae){var Be;try{Ae()}catch(bt){Be=bt}return Be}function Ye(Ae,Be,bt,ir){var re;if(typeof Be!="function")throw new TypeError('"block" argument must be a function');typeof bt=="string"&&(ir=bt,bt=null),re=gt(Be),ir=(bt&&bt.name?" ("+bt.name+").":".")+(ir?" "+ir:"."),Ae&&!re&&Ft(re,bt,"Missing expected exception"+ir);var Ee=typeof ir=="string",ae=!Ae&&w.isError(re),me=!Ae&&re&&!bt;if((ae&&Ee&&ar(re,bt)||me)&&Ft(re,bt,"Got unwanted exception"+ir),Ae&&re&&bt&&!ar(re,bt)||!Ae&&re)throw re}be.throws=function(Ae,Be,bt){Ye(!0,Ae,Be,bt)},be.doesNotThrow=function(Ae,Be,bt){Ye(!1,Ae,Be,bt)},be.ifError=function(Ae){if(Ae)throw Ae};function Et(Ae,Be){Ae||Ft(Ae,!0,Be,"==",Et)}be.strict=J(Et,be,{equal:be.strictEqual,deepEqual:be.deepStrictEqual,notEqual:be.notStrictEqual,notDeepEqual:be.notDeepStrictEqual}),be.strict.strict=be.strict;var Ne=Object.keys||function(Ae){var Be=[];for(var bt in Ae)F.call(Ae,bt)&&Be.push(bt);return Be}},16076:function(ur){typeof Object.create=="function"?ur.exports=function(x,J){x.super_=J,x.prototype=Object.create(J.prototype,{constructor:{value:x,enumerable:!1,writable:!0,configurable:!0}})}:ur.exports=function(x,J){x.super_=J;var E=function(){};E.prototype=J.prototype,x.prototype=new E,x.prototype.constructor=x}},52014:function(ur){ur.exports=function(x){return x&&typeof x=="object"&&typeof x.copy=="function"&&typeof x.fill=="function"&&typeof x.readUInt8=="function"}},30069:function(ur,L,x){var J=x(34155),E=/%[sdj%]/g;L.format=function(me){if(!Cr(me)){for(var Te=[],Qe=0;Qe<arguments.length;Qe++)Te.push(F(arguments[Qe]));return Te.join(" ")}for(var Qe=1,dt=arguments,Jt=dt.length,Nr=String(me).replace(E,function(ln){if(ln==="%%")return"%";if(Qe>=Jt)return ln;switch(ln){case"%s":return String(dt[Qe++]);case"%d":return Number(dt[Qe++]);case"%j":try{return JSON.stringify(dt[Qe++])}catch(tr){return"[Circular]"}default:return ln}}),Fr=dt[Qe];Qe<Jt;Fr=dt[++Qe])Lt(Fr)||!Ye(Fr)?Nr+=" "+Fr:Nr+=" "+F(Fr);return Nr},L.deprecate=function(me,Te){if(ar(x.g.process))return function(){return L.deprecate(me,Te).apply(this,arguments)};if(J.noDeprecation===!0)return me;var Qe=!1;function dt(){if(!Qe){if(J.throwDeprecation)throw new Error(Te);J.traceDeprecation?console.trace(Te):console.error(Te),Qe=!0}return me.apply(this,arguments)}return dt};var p={},w;L.debuglog=function(me){if(ar(w)&&(w={NODE_ENV:"production"}.NODE_DEBUG||""),me=me.toUpperCase(),!p[me])if(new RegExp("\\b"+me+"\\b","i").test(w)){var Te=J.pid;p[me]=function(){var Qe=L.format.apply(L,arguments);console.error("%s %d: %s",me,Te,Qe)}}else p[me]=function(){};return p[me]};function F(me,Te){var Qe={seen:[],stylize:Y};return arguments.length>=3&&(Qe.depth=arguments[2]),arguments.length>=4&&(Qe.colors=arguments[3]),Ft(Te)?Qe.showHidden=Te:Te&&L._extend(Qe,Te),ar(Qe.showHidden)&&(Qe.showHidden=!1),ar(Qe.depth)&&(Qe.depth=2),ar(Qe.colors)&&(Qe.colors=!1),ar(Qe.customInspect)&&(Qe.customInspect=!0),Qe.colors&&(Qe.stylize=Q),ne(Qe,me,Qe.depth)}L.inspect=F,F.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},F.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"};function Q(me,Te){var Qe=F.styles[Te];return Qe?"["+F.colors[Qe][0]+"m"+me+"["+F.colors[Qe][1]+"m":me}function Y(me,Te){return me}function le(me){var Te={};return me.forEach(function(Qe,dt){Te[Qe]=!0}),Te}function ne(me,Te,Qe){if(me.customInspect&&Te&&Ae(Te.inspect)&&Te.inspect!==L.inspect&&!(Te.constructor&&Te.constructor.prototype===Te)){var dt=Te.inspect(Qe,me);return Cr(dt)||(dt=ne(me,dt,Qe)),dt}var Jt=be(me,Te);if(Jt)return Jt;var Nr=Object.keys(Te),Fr=le(Nr);if(me.showHidden&&(Nr=Object.getOwnPropertyNames(Te)),Ne(Te)&&(Nr.indexOf("message")>=0||Nr.indexOf("description")>=0))return we(Te);if(Nr.length===0){if(Ae(Te)){var ln=Te.name?": "+Te.name:"";return me.stylize("[Function"+ln+"]","special")}if(gt(Te))return me.stylize(RegExp.prototype.toString.call(Te),"regexp");if(Et(Te))return me.stylize(Date.prototype.toString.call(Te),"date");if(Ne(Te))return we(Te)}var tr="",se=!1,ge=["{","}"];if(Xt(Te)&&(se=!0,ge=["[","]"]),Ae(Te)){var Re=Te.name?": "+Te.name:"";tr=" [Function"+Re+"]"}if(gt(Te)&&(tr=" "+RegExp.prototype.toString.call(Te)),Et(Te)&&(tr=" "+Date.prototype.toUTCString.call(Te)),Ne(Te)&&(tr=" "+we(Te)),Nr.length===0&&(!se||Te.length==0))return ge[0]+tr+ge[1];if(Qe<0)return gt(Te)?me.stylize(RegExp.prototype.toString.call(Te),"regexp"):me.stylize("[Object]","special");me.seen.push(Te);var tt;return se?tt=Ie(me,Te,Qe,Fr,Nr):tt=Nr.map(function(Mt){return $t(me,Te,Qe,Fr,Mt,se)}),me.seen.pop(),Zt(tt,tr,ge)}function be(me,Te){if(ar(Te))return me.stylize("undefined","undefined");if(Cr(Te)){var Qe="'"+JSON.stringify(Te).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return me.stylize(Qe,"string")}if(pt(Te))return me.stylize(""+Te,"number");if(Ft(Te))return me.stylize(""+Te,"boolean");if(Lt(Te))return me.stylize("null","null")}function we(me){return"["+Error.prototype.toString.call(me)+"]"}function Ie(me,Te,Qe,dt,Jt){for(var Nr=[],Fr=0,ln=Te.length;Fr<ln;++Fr)ae(Te,String(Fr))?Nr.push($t(me,Te,Qe,dt,String(Fr),!0)):Nr.push("");return Jt.forEach(function(tr){tr.match(/^\d+$/)||Nr.push($t(me,Te,Qe,dt,tr,!0))}),Nr}function $t(me,Te,Qe,dt,Jt,Nr){var Fr,ln,tr;if(tr=Object.getOwnPropertyDescriptor(Te,Jt)||{value:Te[Jt]},tr.get?tr.set?ln=me.stylize("[Getter/Setter]","special"):ln=me.stylize("[Getter]","special"):tr.set&&(ln=me.stylize("[Setter]","special")),ae(dt,Jt)||(Fr="["+Jt+"]"),ln||(me.seen.indexOf(tr.value)<0?(Lt(Qe)?ln=ne(me,tr.value,null):ln=ne(me,tr.value,Qe-1),ln.indexOf(`
`)>-1&&(Nr?ln=ln.split(`
`).map(function(se){return"  "+se}).join(`
`).substr(2):ln=`
`+ln.split(`
`).map(function(se){return"   "+se}).join(`
`))):ln=me.stylize("[Circular]","special")),ar(Fr)){if(Nr&&Jt.match(/^\d+$/))return ln;Fr=JSON.stringify(""+Jt),Fr.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(Fr=Fr.substr(1,Fr.length-2),Fr=me.stylize(Fr,"name")):(Fr=Fr.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),Fr=me.stylize(Fr,"string"))}return Fr+": "+ln}function Zt(me,Te,Qe){var dt=0,Jt=me.reduce(function(Nr,Fr){return dt++,Fr.indexOf(`
`)>=0&&dt++,Nr+Fr.replace(/\u001b\[\d\d?m/g,"").length+1},0);return Jt>60?Qe[0]+(Te===""?"":Te+`
 `)+" "+me.join(`,
  `)+" "+Qe[1]:Qe[0]+Te+" "+me.join(", ")+" "+Qe[1]}function Xt(me){return Array.isArray(me)}L.isArray=Xt;function Ft(me){return typeof me=="boolean"}L.isBoolean=Ft;function Lt(me){return me===null}L.isNull=Lt;function _t(me){return me==null}L.isNullOrUndefined=_t;function pt(me){return typeof me=="number"}L.isNumber=pt;function Cr(me){return typeof me=="string"}L.isString=Cr;function Gt(me){return typeof me=="symbol"}L.isSymbol=Gt;function ar(me){return me===void 0}L.isUndefined=ar;function gt(me){return Ye(me)&&bt(me)==="[object RegExp]"}L.isRegExp=gt;function Ye(me){return typeof me=="object"&&me!==null}L.isObject=Ye;function Et(me){return Ye(me)&&bt(me)==="[object Date]"}L.isDate=Et;function Ne(me){return Ye(me)&&(bt(me)==="[object Error]"||me instanceof Error)}L.isError=Ne;function Ae(me){return typeof me=="function"}L.isFunction=Ae;function Be(me){return me===null||typeof me=="boolean"||typeof me=="number"||typeof me=="string"||typeof me=="symbol"||typeof me=="undefined"}L.isPrimitive=Be,L.isBuffer=x(52014);function bt(me){return Object.prototype.toString.call(me)}function ir(me){return me<10?"0"+me.toString(10):me.toString(10)}var re=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function Ee(){var me=new Date,Te=[ir(me.getHours()),ir(me.getMinutes()),ir(me.getSeconds())].join(":");return[me.getDate(),re[me.getMonth()],Te].join(" ")}L.log=function(){console.log("%s - %s",Ee(),L.format.apply(L,arguments))},L.inherits=x(16076),L._extend=function(me,Te){if(!Te||!Ye(Te))return me;for(var Qe=Object.keys(Te),dt=Qe.length;dt--;)me[Qe[dt]]=Te[Qe[dt]];return me};function ae(me,Te){return Object.prototype.hasOwnProperty.call(me,Te)}},9187:function(ur){"use strict";ur.exports=L,ur.exports.default=L;function L(re,Ee,ae){ae=ae||2;var me=Ee&&Ee.length,Te=me?Ee[0]*ae:re.length,Qe=x(re,0,Te,ae,!0),dt=[];if(!Qe||Qe.next===Qe.prev)return dt;var Jt,Nr,Fr,ln,tr,se,ge;if(me&&(Qe=Y(re,Ee,Qe,ae)),re.length>80*ae){Jt=Fr=re[0],Nr=ln=re[1];for(var Re=ae;Re<Te;Re+=ae)tr=re[Re],se=re[Re+1],tr<Jt&&(Jt=tr),se<Nr&&(Nr=se),tr>Fr&&(Fr=tr),se>ln&&(ln=se);ge=Math.max(Fr-Jt,ln-Nr),ge=ge!==0?1/ge:0}return E(Qe,dt,ae,Jt,Nr,ge),dt}function x(re,Ee,ae,me,Te){var Qe,dt;if(Te===ir(re,Ee,ae,me)>0)for(Qe=Ee;Qe<ae;Qe+=me)dt=Ae(Qe,re[Qe],re[Qe+1],dt);else for(Qe=ae-me;Qe>=Ee;Qe-=me)dt=Ae(Qe,re[Qe],re[Qe+1],dt);return dt&&pt(dt,dt.next)&&(Be(dt),dt=dt.next),dt}function J(re,Ee){if(!re)return re;Ee||(Ee=re);var ae=re,me;do if(me=!1,!ae.steiner&&(pt(ae,ae.next)||_t(ae.prev,ae,ae.next)===0)){if(Be(ae),ae=Ee=ae.prev,ae===ae.next)break;me=!0}else ae=ae.next;while(me||ae!==Ee);return Ee}function E(re,Ee,ae,me,Te,Qe,dt){if(!!re){!dt&&Qe&&Ie(re,me,Te,Qe);for(var Jt=re,Nr,Fr;re.prev!==re.next;){if(Nr=re.prev,Fr=re.next,Qe?w(re,me,Te,Qe):p(re)){Ee.push(Nr.i/ae),Ee.push(re.i/ae),Ee.push(Fr.i/ae),Be(re),re=Fr.next,Jt=Fr.next;continue}if(re=Fr,re===Jt){dt?dt===1?(re=F(J(re),Ee,ae),E(re,Ee,ae,me,Te,Qe,2)):dt===2&&Q(re,Ee,ae,me,Te,Qe):E(J(re),Ee,ae,me,Te,Qe,1);break}}}}function p(re){var Ee=re.prev,ae=re,me=re.next;if(_t(Ee,ae,me)>=0)return!1;for(var Te=re.next.next;Te!==re.prev;){if(Ft(Ee.x,Ee.y,ae.x,ae.y,me.x,me.y,Te.x,Te.y)&&_t(Te.prev,Te,Te.next)>=0)return!1;Te=Te.next}return!0}function w(re,Ee,ae,me){var Te=re.prev,Qe=re,dt=re.next;if(_t(Te,Qe,dt)>=0)return!1;for(var Jt=Te.x<Qe.x?Te.x<dt.x?Te.x:dt.x:Qe.x<dt.x?Qe.x:dt.x,Nr=Te.y<Qe.y?Te.y<dt.y?Te.y:dt.y:Qe.y<dt.y?Qe.y:dt.y,Fr=Te.x>Qe.x?Te.x>dt.x?Te.x:dt.x:Qe.x>dt.x?Qe.x:dt.x,ln=Te.y>Qe.y?Te.y>dt.y?Te.y:dt.y:Qe.y>dt.y?Qe.y:dt.y,tr=Zt(Jt,Nr,Ee,ae,me),se=Zt(Fr,ln,Ee,ae,me),ge=re.prevZ,Re=re.nextZ;ge&&ge.z>=tr&&Re&&Re.z<=se;){if(ge!==re.prev&&ge!==re.next&&Ft(Te.x,Te.y,Qe.x,Qe.y,dt.x,dt.y,ge.x,ge.y)&&_t(ge.prev,ge,ge.next)>=0||(ge=ge.prevZ,Re!==re.prev&&Re!==re.next&&Ft(Te.x,Te.y,Qe.x,Qe.y,dt.x,dt.y,Re.x,Re.y)&&_t(Re.prev,Re,Re.next)>=0))return!1;Re=Re.nextZ}for(;ge&&ge.z>=tr;){if(ge!==re.prev&&ge!==re.next&&Ft(Te.x,Te.y,Qe.x,Qe.y,dt.x,dt.y,ge.x,ge.y)&&_t(ge.prev,ge,ge.next)>=0)return!1;ge=ge.prevZ}for(;Re&&Re.z<=se;){if(Re!==re.prev&&Re!==re.next&&Ft(Te.x,Te.y,Qe.x,Qe.y,dt.x,dt.y,Re.x,Re.y)&&_t(Re.prev,Re,Re.next)>=0)return!1;Re=Re.nextZ}return!0}function F(re,Ee,ae){var me=re;do{var Te=me.prev,Qe=me.next.next;!pt(Te,Qe)&&Cr(Te,me,me.next,Qe)&&Ye(Te,Qe)&&Ye(Qe,Te)&&(Ee.push(Te.i/ae),Ee.push(me.i/ae),Ee.push(Qe.i/ae),Be(me),Be(me.next),me=re=Qe),me=me.next}while(me!==re);return J(me)}function Q(re,Ee,ae,me,Te,Qe){var dt=re;do{for(var Jt=dt.next.next;Jt!==dt.prev;){if(dt.i!==Jt.i&&Lt(dt,Jt)){var Nr=Ne(dt,Jt);dt=J(dt,dt.next),Nr=J(Nr,Nr.next),E(dt,Ee,ae,me,Te,Qe),E(Nr,Ee,ae,me,Te,Qe);return}Jt=Jt.next}dt=dt.next}while(dt!==re)}function Y(re,Ee,ae,me){var Te=[],Qe,dt,Jt,Nr,Fr;for(Qe=0,dt=Ee.length;Qe<dt;Qe++)Jt=Ee[Qe]*me,Nr=Qe<dt-1?Ee[Qe+1]*me:re.length,Fr=x(re,Jt,Nr,me,!1),Fr===Fr.next&&(Fr.steiner=!0),Te.push(Xt(Fr));for(Te.sort(le),Qe=0;Qe<Te.length;Qe++)ae=ne(Te[Qe],ae),ae=J(ae,ae.next);return ae}function le(re,Ee){return re.x-Ee.x}function ne(re,Ee){var ae=be(re,Ee);if(!ae)return Ee;var me=Ne(ae,re),Te=J(ae,ae.next);return J(me,me.next),Ee===ae?Te:Ee}function be(re,Ee){var ae=Ee,me=re.x,Te=re.y,Qe=-Infinity,dt;do{if(Te<=ae.y&&Te>=ae.next.y&&ae.next.y!==ae.y){var Jt=ae.x+(Te-ae.y)*(ae.next.x-ae.x)/(ae.next.y-ae.y);if(Jt<=me&&Jt>Qe){if(Qe=Jt,Jt===me){if(Te===ae.y)return ae;if(Te===ae.next.y)return ae.next}dt=ae.x<ae.next.x?ae:ae.next}}ae=ae.next}while(ae!==Ee);if(!dt)return null;if(me===Qe)return dt;var Nr=dt,Fr=dt.x,ln=dt.y,tr=Infinity,se;ae=dt;do me>=ae.x&&ae.x>=Fr&&me!==ae.x&&Ft(Te<ln?me:Qe,Te,Fr,ln,Te<ln?Qe:me,Te,ae.x,ae.y)&&(se=Math.abs(Te-ae.y)/(me-ae.x),Ye(ae,re)&&(se<tr||se===tr&&(ae.x>dt.x||ae.x===dt.x&&we(dt,ae)))&&(dt=ae,tr=se)),ae=ae.next;while(ae!==Nr);return dt}function we(re,Ee){return _t(re.prev,re,Ee.prev)<0&&_t(Ee.next,re,re.next)<0}function Ie(re,Ee,ae,me){var Te=re;do Te.z===null&&(Te.z=Zt(Te.x,Te.y,Ee,ae,me)),Te.prevZ=Te.prev,Te.nextZ=Te.next,Te=Te.next;while(Te!==re);Te.prevZ.nextZ=null,Te.prevZ=null,$t(Te)}function $t(re){var Ee,ae,me,Te,Qe,dt,Jt,Nr,Fr=1;do{for(ae=re,re=null,Qe=null,dt=0;ae;){for(dt++,me=ae,Jt=0,Ee=0;Ee<Fr&&(Jt++,me=me.nextZ,!!me);Ee++);for(Nr=Fr;Jt>0||Nr>0&&me;)Jt!==0&&(Nr===0||!me||ae.z<=me.z)?(Te=ae,ae=ae.nextZ,Jt--):(Te=me,me=me.nextZ,Nr--),Qe?Qe.nextZ=Te:re=Te,Te.prevZ=Qe,Qe=Te;ae=me}Qe.nextZ=null,Fr*=2}while(dt>1);return re}function Zt(re,Ee,ae,me,Te){return re=32767*(re-ae)*Te,Ee=32767*(Ee-me)*Te,re=(re|re<<8)&16711935,re=(re|re<<4)&252645135,re=(re|re<<2)&858993459,re=(re|re<<1)&1431655765,Ee=(Ee|Ee<<8)&16711935,Ee=(Ee|Ee<<4)&252645135,Ee=(Ee|Ee<<2)&858993459,Ee=(Ee|Ee<<1)&1431655765,re|Ee<<1}function Xt(re){var Ee=re,ae=re;do(Ee.x<ae.x||Ee.x===ae.x&&Ee.y<ae.y)&&(ae=Ee),Ee=Ee.next;while(Ee!==re);return ae}function Ft(re,Ee,ae,me,Te,Qe,dt,Jt){return(Te-dt)*(Ee-Jt)-(re-dt)*(Qe-Jt)>=0&&(re-dt)*(me-Jt)-(ae-dt)*(Ee-Jt)>=0&&(ae-dt)*(Qe-Jt)-(Te-dt)*(me-Jt)>=0}function Lt(re,Ee){return re.next.i!==Ee.i&&re.prev.i!==Ee.i&&!gt(re,Ee)&&(Ye(re,Ee)&&Ye(Ee,re)&&Et(re,Ee)&&(_t(re.prev,re,Ee.prev)||_t(re,Ee.prev,Ee))||pt(re,Ee)&&_t(re.prev,re,re.next)>0&&_t(Ee.prev,Ee,Ee.next)>0)}function _t(re,Ee,ae){return(Ee.y-re.y)*(ae.x-Ee.x)-(Ee.x-re.x)*(ae.y-Ee.y)}function pt(re,Ee){return re.x===Ee.x&&re.y===Ee.y}function Cr(re,Ee,ae,me){var Te=ar(_t(re,Ee,ae)),Qe=ar(_t(re,Ee,me)),dt=ar(_t(ae,me,re)),Jt=ar(_t(ae,me,Ee));return!!(Te!==Qe&&dt!==Jt||Te===0&&Gt(re,ae,Ee)||Qe===0&&Gt(re,me,Ee)||dt===0&&Gt(ae,re,me)||Jt===0&&Gt(ae,Ee,me))}function Gt(re,Ee,ae){return Ee.x<=Math.max(re.x,ae.x)&&Ee.x>=Math.min(re.x,ae.x)&&Ee.y<=Math.max(re.y,ae.y)&&Ee.y>=Math.min(re.y,ae.y)}function ar(re){return re>0?1:re<0?-1:0}function gt(re,Ee){var ae=re;do{if(ae.i!==re.i&&ae.next.i!==re.i&&ae.i!==Ee.i&&ae.next.i!==Ee.i&&Cr(ae,ae.next,re,Ee))return!0;ae=ae.next}while(ae!==re);return!1}function Ye(re,Ee){return _t(re.prev,re,re.next)<0?_t(re,Ee,re.next)>=0&&_t(re,re.prev,Ee)>=0:_t(re,Ee,re.prev)<0||_t(re,re.next,Ee)<0}function Et(re,Ee){var ae=re,me=!1,Te=(re.x+Ee.x)/2,Qe=(re.y+Ee.y)/2;do ae.y>Qe!=ae.next.y>Qe&&ae.next.y!==ae.y&&Te<(ae.next.x-ae.x)*(Qe-ae.y)/(ae.next.y-ae.y)+ae.x&&(me=!me),ae=ae.next;while(ae!==re);return me}function Ne(re,Ee){var ae=new bt(re.i,re.x,re.y),me=new bt(Ee.i,Ee.x,Ee.y),Te=re.next,Qe=Ee.prev;return re.next=Ee,Ee.prev=re,ae.next=Te,Te.prev=ae,me.next=ae,ae.prev=me,Qe.next=me,me.prev=Qe,me}function Ae(re,Ee,ae,me){var Te=new bt(re,Ee,ae);return me?(Te.next=me.next,Te.prev=me,me.next.prev=Te,me.next=Te):(Te.prev=Te,Te.next=Te),Te}function Be(re){re.next.prev=re.prev,re.prev.next=re.next,re.prevZ&&(re.prevZ.nextZ=re.nextZ),re.nextZ&&(re.nextZ.prevZ=re.prevZ)}function bt(re,Ee,ae){this.i=re,this.x=Ee,this.y=ae,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}L.deviation=function(re,Ee,ae,me){var Te=Ee&&Ee.length,Qe=Te?Ee[0]*ae:re.length,dt=Math.abs(ir(re,0,Qe,ae));if(Te)for(var Jt=0,Nr=Ee.length;Jt<Nr;Jt++){var Fr=Ee[Jt]*ae,ln=Jt<Nr-1?Ee[Jt+1]*ae:re.length;dt-=Math.abs(ir(re,Fr,ln,ae))}var tr=0;for(Jt=0;Jt<me.length;Jt+=3){var se=me[Jt]*ae,ge=me[Jt+1]*ae,Re=me[Jt+2]*ae;tr+=Math.abs((re[se]-re[Re])*(re[ge+1]-re[se+1])-(re[se]-re[ge])*(re[Re+1]-re[se+1]))}return dt===0&&tr===0?0:Math.abs((tr-dt)/dt)};function ir(re,Ee,ae,me){for(var Te=0,Qe=Ee,dt=ae-me;Qe<ae;Qe+=me)Te+=(re[dt]-re[Qe])*(re[Qe+1]+re[dt+1]),dt=Qe;return Te}L.flatten=function(re){for(var Ee=re[0][0].length,ae={vertices:[],holes:[],dimensions:Ee},me=0,Te=0;Te<re.length;Te++){for(var Qe=0;Qe<re[Te].length;Qe++)for(var dt=0;dt<Ee;dt++)ae.vertices.push(re[Te][Qe][dt]);Te>0&&(me+=re[Te-1].length,ae.holes.push(me))}return ae}},67709:function(ur){function L(J){var E=J.target||J.srcElement;E.__resizeRAF__&&cancelAnimationFrame(E.__resizeRAF__),E.__resizeRAF__=requestAnimationFrame(function(){var p=E.__resizeTrigger__,w=p&&p.__resizeListeners__;w&&w.forEach(function(F){F.call(p,J)})})}var x=function(E,p){var w=this,F=w.document,Q,Y=F.attachEvent;typeof navigator!="undefined"&&(Q=navigator.userAgent.match(/Trident/)||navigator.userAgent.match(/Edge/));function le(){this.contentDocument.defaultView.__resizeTrigger__=this.__resizeElement__,this.contentDocument.defaultView.addEventListener("resize",L)}if(!E.__resizeListeners__)if(E.__resizeListeners__=[],Y)E.__resizeTrigger__=E,E.attachEvent("onresize",L);else{getComputedStyle(E).position==="static"&&(E.style.position="relative");var ne=E.__resizeTrigger__=F.createElement("object");ne.setAttribute("style","position: absolute; top: 0; left: 0; height: 100%; width: 100%; pointer-events: none; z-index: -1; opacity: 0;"),ne.setAttribute("class","resize-sensor"),ne.setAttribute("tabindex","-1"),ne.setAttribute("title",""),ne.__resizeElement__=E,ne.onload=le,ne.type="text/html",Q&&E.appendChild(ne),ne.data="about:blank",Q||E.appendChild(ne)}E.__resizeListeners__.push(p)};ur.exports=typeof window=="undefined"?x:x.bind(window),ur.exports.unbind=function(J,E){var p=document.attachEvent,w=J.__resizeListeners__||[];if(E){var F=w.indexOf(E);F!==-1&&w.splice(F,1)}else w=J.__resizeListeners__=[];if(!w.length){if(p)J.detachEvent("onresize",L);else if(J.__resizeTrigger__){var Q=J.__resizeTrigger__.contentDocument,Y=Q&&Q.defaultView;Y&&(Y.removeEventListener("resize",L),delete Y.__resizeTrigger__),J.__resizeTrigger__=!J.removeChild(J.__resizeTrigger__)}delete J.__resizeListeners__}}},26729:function(ur){"use strict";var L=Object.prototype.hasOwnProperty,x="~";function J(){}Object.create&&(J.prototype=Object.create(null),new J().__proto__||(x=!1));function E(Q,Y,le){this.fn=Q,this.context=Y,this.once=le||!1}function p(Q,Y,le,ne,be){if(typeof le!="function")throw new TypeError("The listener must be a function");var we=new E(le,ne||Q,be),Ie=x?x+Y:Y;return Q._events[Ie]?Q._events[Ie].fn?Q._events[Ie]=[Q._events[Ie],we]:Q._events[Ie].push(we):(Q._events[Ie]=we,Q._eventsCount++),Q}function w(Q,Y){--Q._eventsCount==0?Q._events=new J:delete Q._events[Y]}function F(){this._events=new J,this._eventsCount=0}F.prototype.eventNames=function(){var Y=[],le,ne;if(this._eventsCount===0)return Y;for(ne in le=this._events)L.call(le,ne)&&Y.push(x?ne.slice(1):ne);return Object.getOwnPropertySymbols?Y.concat(Object.getOwnPropertySymbols(le)):Y},F.prototype.listeners=function(Y){var le=x?x+Y:Y,ne=this._events[le];if(!ne)return[];if(ne.fn)return[ne.fn];for(var be=0,we=ne.length,Ie=new Array(we);be<we;be++)Ie[be]=ne[be].fn;return Ie},F.prototype.listenerCount=function(Y){var le=x?x+Y:Y,ne=this._events[le];return ne?ne.fn?1:ne.length:0},F.prototype.emit=function(Y,le,ne,be,we,Ie){var $t=x?x+Y:Y;if(!this._events[$t])return!1;var Zt=this._events[$t],Xt=arguments.length,Ft,Lt;if(Zt.fn){switch(Zt.once&&this.removeListener(Y,Zt.fn,void 0,!0),Xt){case 1:return Zt.fn.call(Zt.context),!0;case 2:return Zt.fn.call(Zt.context,le),!0;case 3:return Zt.fn.call(Zt.context,le,ne),!0;case 4:return Zt.fn.call(Zt.context,le,ne,be),!0;case 5:return Zt.fn.call(Zt.context,le,ne,be,we),!0;case 6:return Zt.fn.call(Zt.context,le,ne,be,we,Ie),!0}for(Lt=1,Ft=new Array(Xt-1);Lt<Xt;Lt++)Ft[Lt-1]=arguments[Lt];Zt.fn.apply(Zt.context,Ft)}else{var _t=Zt.length,pt;for(Lt=0;Lt<_t;Lt++)switch(Zt[Lt].once&&this.removeListener(Y,Zt[Lt].fn,void 0,!0),Xt){case 1:Zt[Lt].fn.call(Zt[Lt].context);break;case 2:Zt[Lt].fn.call(Zt[Lt].context,le);break;case 3:Zt[Lt].fn.call(Zt[Lt].context,le,ne);break;case 4:Zt[Lt].fn.call(Zt[Lt].context,le,ne,be);break;default:if(!Ft)for(pt=1,Ft=new Array(Xt-1);pt<Xt;pt++)Ft[pt-1]=arguments[pt];Zt[Lt].fn.apply(Zt[Lt].context,Ft)}}return!0},F.prototype.on=function(Y,le,ne){return p(this,Y,le,ne,!1)},F.prototype.once=function(Y,le,ne){return p(this,Y,le,ne,!0)},F.prototype.removeListener=function(Y,le,ne,be){var we=x?x+Y:Y;if(!this._events[we])return this;if(!le)return w(this,we),this;var Ie=this._events[we];if(Ie.fn)Ie.fn===le&&(!be||Ie.once)&&(!ne||Ie.context===ne)&&w(this,we);else{for(var $t=0,Zt=[],Xt=Ie.length;$t<Xt;$t++)(Ie[$t].fn!==le||be&&!Ie[$t].once||ne&&Ie[$t].context!==ne)&&Zt.push(Ie[$t]);Zt.length?this._events[we]=Zt.length===1?Zt[0]:Zt:w(this,we)}return this},F.prototype.removeAllListeners=function(Y){var le;return Y?(le=x?x+Y:Y,this._events[le]&&w(this,le)):(this._events=new J,this._eventsCount=0),this},F.prototype.off=F.prototype.removeListener,F.prototype.addListener=F.prototype.on,F.prefixed=x,F.EventEmitter=F,ur.exports=F},85975:function(ur,L,x){"use strict";x.r(L),x.d(L,{create:function(){return E},clone:function(){return p},copy:function(){return w},fromValues:function(){return F},set:function(){return Q},identity:function(){return Y},transpose:function(){return le},invert:function(){return ne},adjoint:function(){return be},determinant:function(){return we},multiply:function(){return Ie},translate:function(){return $t},scale:function(){return Zt},rotate:function(){return Xt},rotateX:function(){return Ft},rotateY:function(){return Lt},rotateZ:function(){return _t},fromTranslation:function(){return pt},fromScaling:function(){return Cr},fromRotation:function(){return Gt},fromXRotation:function(){return ar},fromYRotation:function(){return gt},fromZRotation:function(){return Ye},fromRotationTranslation:function(){return Et},fromQuat2:function(){return Ne},getTranslation:function(){return Ae},getScaling:function(){return Be},getRotation:function(){return bt},fromRotationTranslationScale:function(){return ir},fromRotationTranslationScaleOrigin:function(){return re},fromQuat:function(){return Ee},frustum:function(){return ae},perspective:function(){return me},perspectiveFromFieldOfView:function(){return Te},ortho:function(){return Qe},lookAt:function(){return dt},targetTo:function(){return Jt},str:function(){return Nr},frob:function(){return Fr},add:function(){return ln},subtract:function(){return tr},multiplyScalar:function(){return se},multiplyScalarAndAdd:function(){return ge},exactEquals:function(){return Re},equals:function(){return tt},mul:function(){return Mt},sub:function(){return Dt}});var J=x(49685);function E(){var S=new J.WT(16);return J.WT!=Float32Array&&(S[1]=0,S[2]=0,S[3]=0,S[4]=0,S[6]=0,S[7]=0,S[8]=0,S[9]=0,S[11]=0,S[12]=0,S[13]=0,S[14]=0),S[0]=1,S[5]=1,S[10]=1,S[15]=1,S}function p(S){var z=new J.WT(16);return z[0]=S[0],z[1]=S[1],z[2]=S[2],z[3]=S[3],z[4]=S[4],z[5]=S[5],z[6]=S[6],z[7]=S[7],z[8]=S[8],z[9]=S[9],z[10]=S[10],z[11]=S[11],z[12]=S[12],z[13]=S[13],z[14]=S[14],z[15]=S[15],z}function w(S,z){return S[0]=z[0],S[1]=z[1],S[2]=z[2],S[3]=z[3],S[4]=z[4],S[5]=z[5],S[6]=z[6],S[7]=z[7],S[8]=z[8],S[9]=z[9],S[10]=z[10],S[11]=z[11],S[12]=z[12],S[13]=z[13],S[14]=z[14],S[15]=z[15],S}function F(S,z,pe,Ue,Je,mt,Ct,H,Ht,Vt,_r,Er,Ar,Pr,Ke,yt){var lt=new J.WT(16);return lt[0]=S,lt[1]=z,lt[2]=pe,lt[3]=Ue,lt[4]=Je,lt[5]=mt,lt[6]=Ct,lt[7]=H,lt[8]=Ht,lt[9]=Vt,lt[10]=_r,lt[11]=Er,lt[12]=Ar,lt[13]=Pr,lt[14]=Ke,lt[15]=yt,lt}function Q(S,z,pe,Ue,Je,mt,Ct,H,Ht,Vt,_r,Er,Ar,Pr,Ke,yt,lt){return S[0]=z,S[1]=pe,S[2]=Ue,S[3]=Je,S[4]=mt,S[5]=Ct,S[6]=H,S[7]=Ht,S[8]=Vt,S[9]=_r,S[10]=Er,S[11]=Ar,S[12]=Pr,S[13]=Ke,S[14]=yt,S[15]=lt,S}function Y(S){return S[0]=1,S[1]=0,S[2]=0,S[3]=0,S[4]=0,S[5]=1,S[6]=0,S[7]=0,S[8]=0,S[9]=0,S[10]=1,S[11]=0,S[12]=0,S[13]=0,S[14]=0,S[15]=1,S}function le(S,z){if(S===z){var pe=z[1],Ue=z[2],Je=z[3],mt=z[6],Ct=z[7],H=z[11];S[1]=z[4],S[2]=z[8],S[3]=z[12],S[4]=pe,S[6]=z[9],S[7]=z[13],S[8]=Ue,S[9]=mt,S[11]=z[14],S[12]=Je,S[13]=Ct,S[14]=H}else S[0]=z[0],S[1]=z[4],S[2]=z[8],S[3]=z[12],S[4]=z[1],S[5]=z[5],S[6]=z[9],S[7]=z[13],S[8]=z[2],S[9]=z[6],S[10]=z[10],S[11]=z[14],S[12]=z[3],S[13]=z[7],S[14]=z[11],S[15]=z[15];return S}function ne(S,z){var pe=z[0],Ue=z[1],Je=z[2],mt=z[3],Ct=z[4],H=z[5],Ht=z[6],Vt=z[7],_r=z[8],Er=z[9],Ar=z[10],Pr=z[11],Ke=z[12],yt=z[13],lt=z[14],lr=z[15],qr=pe*H-Ue*Ct,ut=pe*Ht-Je*Ct,It=pe*Vt-mt*Ct,Qt=Ue*Ht-Je*H,gr=Ue*Vt-mt*H,gn=Je*Vt-mt*Ht,Cn=_r*yt-Er*Ke,vi=_r*lt-Ar*Ke,xi=_r*lr-Pr*Ke,Ri=Er*lt-Ar*yt,Wi=Er*lr-Pr*yt,si=Ar*lr-Pr*lt,G=qr*si-ut*Wi+It*Ri+Qt*xi-gr*vi+gn*Cn;return G?(G=1/G,S[0]=(H*si-Ht*Wi+Vt*Ri)*G,S[1]=(Je*Wi-Ue*si-mt*Ri)*G,S[2]=(yt*gn-lt*gr+lr*Qt)*G,S[3]=(Ar*gr-Er*gn-Pr*Qt)*G,S[4]=(Ht*xi-Ct*si-Vt*vi)*G,S[5]=(pe*si-Je*xi+mt*vi)*G,S[6]=(lt*It-Ke*gn-lr*ut)*G,S[7]=(_r*gn-Ar*It+Pr*ut)*G,S[8]=(Ct*Wi-H*xi+Vt*Cn)*G,S[9]=(Ue*xi-pe*Wi-mt*Cn)*G,S[10]=(Ke*gr-yt*It+lr*qr)*G,S[11]=(Er*It-_r*gr-Pr*qr)*G,S[12]=(H*vi-Ct*Ri-Ht*Cn)*G,S[13]=(pe*Ri-Ue*vi+Je*Cn)*G,S[14]=(yt*ut-Ke*Qt-lt*qr)*G,S[15]=(_r*Qt-Er*ut+Ar*qr)*G,S):null}function be(S,z){var pe=z[0],Ue=z[1],Je=z[2],mt=z[3],Ct=z[4],H=z[5],Ht=z[6],Vt=z[7],_r=z[8],Er=z[9],Ar=z[10],Pr=z[11],Ke=z[12],yt=z[13],lt=z[14],lr=z[15];return S[0]=H*(Ar*lr-Pr*lt)-Er*(Ht*lr-Vt*lt)+yt*(Ht*Pr-Vt*Ar),S[1]=-(Ue*(Ar*lr-Pr*lt)-Er*(Je*lr-mt*lt)+yt*(Je*Pr-mt*Ar)),S[2]=Ue*(Ht*lr-Vt*lt)-H*(Je*lr-mt*lt)+yt*(Je*Vt-mt*Ht),S[3]=-(Ue*(Ht*Pr-Vt*Ar)-H*(Je*Pr-mt*Ar)+Er*(Je*Vt-mt*Ht)),S[4]=-(Ct*(Ar*lr-Pr*lt)-_r*(Ht*lr-Vt*lt)+Ke*(Ht*Pr-Vt*Ar)),S[5]=pe*(Ar*lr-Pr*lt)-_r*(Je*lr-mt*lt)+Ke*(Je*Pr-mt*Ar),S[6]=-(pe*(Ht*lr-Vt*lt)-Ct*(Je*lr-mt*lt)+Ke*(Je*Vt-mt*Ht)),S[7]=pe*(Ht*Pr-Vt*Ar)-Ct*(Je*Pr-mt*Ar)+_r*(Je*Vt-mt*Ht),S[8]=Ct*(Er*lr-Pr*yt)-_r*(H*lr-Vt*yt)+Ke*(H*Pr-Vt*Er),S[9]=-(pe*(Er*lr-Pr*yt)-_r*(Ue*lr-mt*yt)+Ke*(Ue*Pr-mt*Er)),S[10]=pe*(H*lr-Vt*yt)-Ct*(Ue*lr-mt*yt)+Ke*(Ue*Vt-mt*H),S[11]=-(pe*(H*Pr-Vt*Er)-Ct*(Ue*Pr-mt*Er)+_r*(Ue*Vt-mt*H)),S[12]=-(Ct*(Er*lt-Ar*yt)-_r*(H*lt-Ht*yt)+Ke*(H*Ar-Ht*Er)),S[13]=pe*(Er*lt-Ar*yt)-_r*(Ue*lt-Je*yt)+Ke*(Ue*Ar-Je*Er),S[14]=-(pe*(H*lt-Ht*yt)-Ct*(Ue*lt-Je*yt)+Ke*(Ue*Ht-Je*H)),S[15]=pe*(H*Ar-Ht*Er)-Ct*(Ue*Ar-Je*Er)+_r*(Ue*Ht-Je*H),S}function we(S){var z=S[0],pe=S[1],Ue=S[2],Je=S[3],mt=S[4],Ct=S[5],H=S[6],Ht=S[7],Vt=S[8],_r=S[9],Er=S[10],Ar=S[11],Pr=S[12],Ke=S[13],yt=S[14],lt=S[15],lr=z*Ct-pe*mt,qr=z*H-Ue*mt,ut=z*Ht-Je*mt,It=pe*H-Ue*Ct,Qt=pe*Ht-Je*Ct,gr=Ue*Ht-Je*H,gn=Vt*Ke-_r*Pr,Cn=Vt*yt-Er*Pr,vi=Vt*lt-Ar*Pr,xi=_r*yt-Er*Ke,Ri=_r*lt-Ar*Ke,Wi=Er*lt-Ar*yt;return lr*Wi-qr*Ri+ut*xi+It*vi-Qt*Cn+gr*gn}function Ie(S,z,pe){var Ue=z[0],Je=z[1],mt=z[2],Ct=z[3],H=z[4],Ht=z[5],Vt=z[6],_r=z[7],Er=z[8],Ar=z[9],Pr=z[10],Ke=z[11],yt=z[12],lt=z[13],lr=z[14],qr=z[15],ut=pe[0],It=pe[1],Qt=pe[2],gr=pe[3];return S[0]=ut*Ue+It*H+Qt*Er+gr*yt,S[1]=ut*Je+It*Ht+Qt*Ar+gr*lt,S[2]=ut*mt+It*Vt+Qt*Pr+gr*lr,S[3]=ut*Ct+It*_r+Qt*Ke+gr*qr,ut=pe[4],It=pe[5],Qt=pe[6],gr=pe[7],S[4]=ut*Ue+It*H+Qt*Er+gr*yt,S[5]=ut*Je+It*Ht+Qt*Ar+gr*lt,S[6]=ut*mt+It*Vt+Qt*Pr+gr*lr,S[7]=ut*Ct+It*_r+Qt*Ke+gr*qr,ut=pe[8],It=pe[9],Qt=pe[10],gr=pe[11],S[8]=ut*Ue+It*H+Qt*Er+gr*yt,S[9]=ut*Je+It*Ht+Qt*Ar+gr*lt,S[10]=ut*mt+It*Vt+Qt*Pr+gr*lr,S[11]=ut*Ct+It*_r+Qt*Ke+gr*qr,ut=pe[12],It=pe[13],Qt=pe[14],gr=pe[15],S[12]=ut*Ue+It*H+Qt*Er+gr*yt,S[13]=ut*Je+It*Ht+Qt*Ar+gr*lt,S[14]=ut*mt+It*Vt+Qt*Pr+gr*lr,S[15]=ut*Ct+It*_r+Qt*Ke+gr*qr,S}function $t(S,z,pe){var Ue=pe[0],Je=pe[1],mt=pe[2],Ct,H,Ht,Vt,_r,Er,Ar,Pr,Ke,yt,lt,lr;return z===S?(S[12]=z[0]*Ue+z[4]*Je+z[8]*mt+z[12],S[13]=z[1]*Ue+z[5]*Je+z[9]*mt+z[13],S[14]=z[2]*Ue+z[6]*Je+z[10]*mt+z[14],S[15]=z[3]*Ue+z[7]*Je+z[11]*mt+z[15]):(Ct=z[0],H=z[1],Ht=z[2],Vt=z[3],_r=z[4],Er=z[5],Ar=z[6],Pr=z[7],Ke=z[8],yt=z[9],lt=z[10],lr=z[11],S[0]=Ct,S[1]=H,S[2]=Ht,S[3]=Vt,S[4]=_r,S[5]=Er,S[6]=Ar,S[7]=Pr,S[8]=Ke,S[9]=yt,S[10]=lt,S[11]=lr,S[12]=Ct*Ue+_r*Je+Ke*mt+z[12],S[13]=H*Ue+Er*Je+yt*mt+z[13],S[14]=Ht*Ue+Ar*Je+lt*mt+z[14],S[15]=Vt*Ue+Pr*Je+lr*mt+z[15]),S}function Zt(S,z,pe){var Ue=pe[0],Je=pe[1],mt=pe[2];return S[0]=z[0]*Ue,S[1]=z[1]*Ue,S[2]=z[2]*Ue,S[3]=z[3]*Ue,S[4]=z[4]*Je,S[5]=z[5]*Je,S[6]=z[6]*Je,S[7]=z[7]*Je,S[8]=z[8]*mt,S[9]=z[9]*mt,S[10]=z[10]*mt,S[11]=z[11]*mt,S[12]=z[12],S[13]=z[13],S[14]=z[14],S[15]=z[15],S}function Xt(S,z,pe,Ue){var Je=Ue[0],mt=Ue[1],Ct=Ue[2],H=Math.hypot(Je,mt,Ct),Ht,Vt,_r,Er,Ar,Pr,Ke,yt,lt,lr,qr,ut,It,Qt,gr,gn,Cn,vi,xi,Ri,Wi,si,G,I;return H<J.Ib?null:(H=1/H,Je*=H,mt*=H,Ct*=H,Ht=Math.sin(pe),Vt=Math.cos(pe),_r=1-Vt,Er=z[0],Ar=z[1],Pr=z[2],Ke=z[3],yt=z[4],lt=z[5],lr=z[6],qr=z[7],ut=z[8],It=z[9],Qt=z[10],gr=z[11],gn=Je*Je*_r+Vt,Cn=mt*Je*_r+Ct*Ht,vi=Ct*Je*_r-mt*Ht,xi=Je*mt*_r-Ct*Ht,Ri=mt*mt*_r+Vt,Wi=Ct*mt*_r+Je*Ht,si=Je*Ct*_r+mt*Ht,G=mt*Ct*_r-Je*Ht,I=Ct*Ct*_r+Vt,S[0]=Er*gn+yt*Cn+ut*vi,S[1]=Ar*gn+lt*Cn+It*vi,S[2]=Pr*gn+lr*Cn+Qt*vi,S[3]=Ke*gn+qr*Cn+gr*vi,S[4]=Er*xi+yt*Ri+ut*Wi,S[5]=Ar*xi+lt*Ri+It*Wi,S[6]=Pr*xi+lr*Ri+Qt*Wi,S[7]=Ke*xi+qr*Ri+gr*Wi,S[8]=Er*si+yt*G+ut*I,S[9]=Ar*si+lt*G+It*I,S[10]=Pr*si+lr*G+Qt*I,S[11]=Ke*si+qr*G+gr*I,z!==S&&(S[12]=z[12],S[13]=z[13],S[14]=z[14],S[15]=z[15]),S)}function Ft(S,z,pe){var Ue=Math.sin(pe),Je=Math.cos(pe),mt=z[4],Ct=z[5],H=z[6],Ht=z[7],Vt=z[8],_r=z[9],Er=z[10],Ar=z[11];return z!==S&&(S[0]=z[0],S[1]=z[1],S[2]=z[2],S[3]=z[3],S[12]=z[12],S[13]=z[13],S[14]=z[14],S[15]=z[15]),S[4]=mt*Je+Vt*Ue,S[5]=Ct*Je+_r*Ue,S[6]=H*Je+Er*Ue,S[7]=Ht*Je+Ar*Ue,S[8]=Vt*Je-mt*Ue,S[9]=_r*Je-Ct*Ue,S[10]=Er*Je-H*Ue,S[11]=Ar*Je-Ht*Ue,S}function Lt(S,z,pe){var Ue=Math.sin(pe),Je=Math.cos(pe),mt=z[0],Ct=z[1],H=z[2],Ht=z[3],Vt=z[8],_r=z[9],Er=z[10],Ar=z[11];return z!==S&&(S[4]=z[4],S[5]=z[5],S[6]=z[6],S[7]=z[7],S[12]=z[12],S[13]=z[13],S[14]=z[14],S[15]=z[15]),S[0]=mt*Je-Vt*Ue,S[1]=Ct*Je-_r*Ue,S[2]=H*Je-Er*Ue,S[3]=Ht*Je-Ar*Ue,S[8]=mt*Ue+Vt*Je,S[9]=Ct*Ue+_r*Je,S[10]=H*Ue+Er*Je,S[11]=Ht*Ue+Ar*Je,S}function _t(S,z,pe){var Ue=Math.sin(pe),Je=Math.cos(pe),mt=z[0],Ct=z[1],H=z[2],Ht=z[3],Vt=z[4],_r=z[5],Er=z[6],Ar=z[7];return z!==S&&(S[8]=z[8],S[9]=z[9],S[10]=z[10],S[11]=z[11],S[12]=z[12],S[13]=z[13],S[14]=z[14],S[15]=z[15]),S[0]=mt*Je+Vt*Ue,S[1]=Ct*Je+_r*Ue,S[2]=H*Je+Er*Ue,S[3]=Ht*Je+Ar*Ue,S[4]=Vt*Je-mt*Ue,S[5]=_r*Je-Ct*Ue,S[6]=Er*Je-H*Ue,S[7]=Ar*Je-Ht*Ue,S}function pt(S,z){return S[0]=1,S[1]=0,S[2]=0,S[3]=0,S[4]=0,S[5]=1,S[6]=0,S[7]=0,S[8]=0,S[9]=0,S[10]=1,S[11]=0,S[12]=z[0],S[13]=z[1],S[14]=z[2],S[15]=1,S}function Cr(S,z){return S[0]=z[0],S[1]=0,S[2]=0,S[3]=0,S[4]=0,S[5]=z[1],S[6]=0,S[7]=0,S[8]=0,S[9]=0,S[10]=z[2],S[11]=0,S[12]=0,S[13]=0,S[14]=0,S[15]=1,S}function Gt(S,z,pe){var Ue=pe[0],Je=pe[1],mt=pe[2],Ct=Math.hypot(Ue,Je,mt),H,Ht,Vt;return Ct<J.Ib?null:(Ct=1/Ct,Ue*=Ct,Je*=Ct,mt*=Ct,H=Math.sin(z),Ht=Math.cos(z),Vt=1-Ht,S[0]=Ue*Ue*Vt+Ht,S[1]=Je*Ue*Vt+mt*H,S[2]=mt*Ue*Vt-Je*H,S[3]=0,S[4]=Ue*Je*Vt-mt*H,S[5]=Je*Je*Vt+Ht,S[6]=mt*Je*Vt+Ue*H,S[7]=0,S[8]=Ue*mt*Vt+Je*H,S[9]=Je*mt*Vt-Ue*H,S[10]=mt*mt*Vt+Ht,S[11]=0,S[12]=0,S[13]=0,S[14]=0,S[15]=1,S)}function ar(S,z){var pe=Math.sin(z),Ue=Math.cos(z);return S[0]=1,S[1]=0,S[2]=0,S[3]=0,S[4]=0,S[5]=Ue,S[6]=pe,S[7]=0,S[8]=0,S[9]=-pe,S[10]=Ue,S[11]=0,S[12]=0,S[13]=0,S[14]=0,S[15]=1,S}function gt(S,z){var pe=Math.sin(z),Ue=Math.cos(z);return S[0]=Ue,S[1]=0,S[2]=-pe,S[3]=0,S[4]=0,S[5]=1,S[6]=0,S[7]=0,S[8]=pe,S[9]=0,S[10]=Ue,S[11]=0,S[12]=0,S[13]=0,S[14]=0,S[15]=1,S}function Ye(S,z){var pe=Math.sin(z),Ue=Math.cos(z);return S[0]=Ue,S[1]=pe,S[2]=0,S[3]=0,S[4]=-pe,S[5]=Ue,S[6]=0,S[7]=0,S[8]=0,S[9]=0,S[10]=1,S[11]=0,S[12]=0,S[13]=0,S[14]=0,S[15]=1,S}function Et(S,z,pe){var Ue=z[0],Je=z[1],mt=z[2],Ct=z[3],H=Ue+Ue,Ht=Je+Je,Vt=mt+mt,_r=Ue*H,Er=Ue*Ht,Ar=Ue*Vt,Pr=Je*Ht,Ke=Je*Vt,yt=mt*Vt,lt=Ct*H,lr=Ct*Ht,qr=Ct*Vt;return S[0]=1-(Pr+yt),S[1]=Er+qr,S[2]=Ar-lr,S[3]=0,S[4]=Er-qr,S[5]=1-(_r+yt),S[6]=Ke+lt,S[7]=0,S[8]=Ar+lr,S[9]=Ke-lt,S[10]=1-(_r+Pr),S[11]=0,S[12]=pe[0],S[13]=pe[1],S[14]=pe[2],S[15]=1,S}function Ne(S,z){var pe=new J.WT(3),Ue=-z[0],Je=-z[1],mt=-z[2],Ct=z[3],H=z[4],Ht=z[5],Vt=z[6],_r=z[7],Er=Ue*Ue+Je*Je+mt*mt+Ct*Ct;return Er>0?(pe[0]=(H*Ct+_r*Ue+Ht*mt-Vt*Je)*2/Er,pe[1]=(Ht*Ct+_r*Je+Vt*Ue-H*mt)*2/Er,pe[2]=(Vt*Ct+_r*mt+H*Je-Ht*Ue)*2/Er):(pe[0]=(H*Ct+_r*Ue+Ht*mt-Vt*Je)*2,pe[1]=(Ht*Ct+_r*Je+Vt*Ue-H*mt)*2,pe[2]=(Vt*Ct+_r*mt+H*Je-Ht*Ue)*2),Et(S,z,pe),S}function Ae(S,z){return S[0]=z[12],S[1]=z[13],S[2]=z[14],S}function Be(S,z){var pe=z[0],Ue=z[1],Je=z[2],mt=z[4],Ct=z[5],H=z[6],Ht=z[8],Vt=z[9],_r=z[10];return S[0]=Math.hypot(pe,Ue,Je),S[1]=Math.hypot(mt,Ct,H),S[2]=Math.hypot(Ht,Vt,_r),S}function bt(S,z){var pe=new J.WT(3);Be(pe,z);var Ue=1/pe[0],Je=1/pe[1],mt=1/pe[2],Ct=z[0]*Ue,H=z[1]*Je,Ht=z[2]*mt,Vt=z[4]*Ue,_r=z[5]*Je,Er=z[6]*mt,Ar=z[8]*Ue,Pr=z[9]*Je,Ke=z[10]*mt,yt=Ct+_r+Ke,lt=0;return yt>0?(lt=Math.sqrt(yt+1)*2,S[3]=.25*lt,S[0]=(Er-Pr)/lt,S[1]=(Ar-Ht)/lt,S[2]=(H-Vt)/lt):Ct>_r&&Ct>Ke?(lt=Math.sqrt(1+Ct-_r-Ke)*2,S[3]=(Er-Pr)/lt,S[0]=.25*lt,S[1]=(H+Vt)/lt,S[2]=(Ar+Ht)/lt):_r>Ke?(lt=Math.sqrt(1+_r-Ct-Ke)*2,S[3]=(Ar-Ht)/lt,S[0]=(H+Vt)/lt,S[1]=.25*lt,S[2]=(Er+Pr)/lt):(lt=Math.sqrt(1+Ke-Ct-_r)*2,S[3]=(H-Vt)/lt,S[0]=(Ar+Ht)/lt,S[1]=(Er+Pr)/lt,S[2]=.25*lt),S}function ir(S,z,pe,Ue){var Je=z[0],mt=z[1],Ct=z[2],H=z[3],Ht=Je+Je,Vt=mt+mt,_r=Ct+Ct,Er=Je*Ht,Ar=Je*Vt,Pr=Je*_r,Ke=mt*Vt,yt=mt*_r,lt=Ct*_r,lr=H*Ht,qr=H*Vt,ut=H*_r,It=Ue[0],Qt=Ue[1],gr=Ue[2];return S[0]=(1-(Ke+lt))*It,S[1]=(Ar+ut)*It,S[2]=(Pr-qr)*It,S[3]=0,S[4]=(Ar-ut)*Qt,S[5]=(1-(Er+lt))*Qt,S[6]=(yt+lr)*Qt,S[7]=0,S[8]=(Pr+qr)*gr,S[9]=(yt-lr)*gr,S[10]=(1-(Er+Ke))*gr,S[11]=0,S[12]=pe[0],S[13]=pe[1],S[14]=pe[2],S[15]=1,S}function re(S,z,pe,Ue,Je){var mt=z[0],Ct=z[1],H=z[2],Ht=z[3],Vt=mt+mt,_r=Ct+Ct,Er=H+H,Ar=mt*Vt,Pr=mt*_r,Ke=mt*Er,yt=Ct*_r,lt=Ct*Er,lr=H*Er,qr=Ht*Vt,ut=Ht*_r,It=Ht*Er,Qt=Ue[0],gr=Ue[1],gn=Ue[2],Cn=Je[0],vi=Je[1],xi=Je[2],Ri=(1-(yt+lr))*Qt,Wi=(Pr+It)*Qt,si=(Ke-ut)*Qt,G=(Pr-It)*gr,I=(1-(Ar+lr))*gr,Z=(lt+qr)*gr,$=(Ke+ut)*gn,ie=(lt-qr)*gn,Le=(1-(Ar+yt))*gn;return S[0]=Ri,S[1]=Wi,S[2]=si,S[3]=0,S[4]=G,S[5]=I,S[6]=Z,S[7]=0,S[8]=$,S[9]=ie,S[10]=Le,S[11]=0,S[12]=pe[0]+Cn-(Ri*Cn+G*vi+$*xi),S[13]=pe[1]+vi-(Wi*Cn+I*vi+ie*xi),S[14]=pe[2]+xi-(si*Cn+Z*vi+Le*xi),S[15]=1,S}function Ee(S,z){var pe=z[0],Ue=z[1],Je=z[2],mt=z[3],Ct=pe+pe,H=Ue+Ue,Ht=Je+Je,Vt=pe*Ct,_r=Ue*Ct,Er=Ue*H,Ar=Je*Ct,Pr=Je*H,Ke=Je*Ht,yt=mt*Ct,lt=mt*H,lr=mt*Ht;return S[0]=1-Er-Ke,S[1]=_r+lr,S[2]=Ar-lt,S[3]=0,S[4]=_r-lr,S[5]=1-Vt-Ke,S[6]=Pr+yt,S[7]=0,S[8]=Ar+lt,S[9]=Pr-yt,S[10]=1-Vt-Er,S[11]=0,S[12]=0,S[13]=0,S[14]=0,S[15]=1,S}function ae(S,z,pe,Ue,Je,mt,Ct){var H=1/(pe-z),Ht=1/(Je-Ue),Vt=1/(mt-Ct);return S[0]=mt*2*H,S[1]=0,S[2]=0,S[3]=0,S[4]=0,S[5]=mt*2*Ht,S[6]=0,S[7]=0,S[8]=(pe+z)*H,S[9]=(Je+Ue)*Ht,S[10]=(Ct+mt)*Vt,S[11]=-1,S[12]=0,S[13]=0,S[14]=Ct*mt*2*Vt,S[15]=0,S}function me(S,z,pe,Ue,Je){var mt=1/Math.tan(z/2),Ct;return S[0]=mt/pe,S[1]=0,S[2]=0,S[3]=0,S[4]=0,S[5]=mt,S[6]=0,S[7]=0,S[8]=0,S[9]=0,S[11]=-1,S[12]=0,S[13]=0,S[15]=0,Je!=null&&Je!==Infinity?(Ct=1/(Ue-Je),S[10]=(Je+Ue)*Ct,S[14]=2*Je*Ue*Ct):(S[10]=-1,S[14]=-2*Ue),S}function Te(S,z,pe,Ue){var Je=Math.tan(z.upDegrees*Math.PI/180),mt=Math.tan(z.downDegrees*Math.PI/180),Ct=Math.tan(z.leftDegrees*Math.PI/180),H=Math.tan(z.rightDegrees*Math.PI/180),Ht=2/(Ct+H),Vt=2/(Je+mt);return S[0]=Ht,S[1]=0,S[2]=0,S[3]=0,S[4]=0,S[5]=Vt,S[6]=0,S[7]=0,S[8]=-((Ct-H)*Ht*.5),S[9]=(Je-mt)*Vt*.5,S[10]=Ue/(pe-Ue),S[11]=-1,S[12]=0,S[13]=0,S[14]=Ue*pe/(pe-Ue),S[15]=0,S}function Qe(S,z,pe,Ue,Je,mt,Ct){var H=1/(z-pe),Ht=1/(Ue-Je),Vt=1/(mt-Ct);return S[0]=-2*H,S[1]=0,S[2]=0,S[3]=0,S[4]=0,S[5]=-2*Ht,S[6]=0,S[7]=0,S[8]=0,S[9]=0,S[10]=2*Vt,S[11]=0,S[12]=(z+pe)*H,S[13]=(Je+Ue)*Ht,S[14]=(Ct+mt)*Vt,S[15]=1,S}function dt(S,z,pe,Ue){var Je,mt,Ct,H,Ht,Vt,_r,Er,Ar,Pr,Ke=z[0],yt=z[1],lt=z[2],lr=Ue[0],qr=Ue[1],ut=Ue[2],It=pe[0],Qt=pe[1],gr=pe[2];return Math.abs(Ke-It)<J.Ib&&Math.abs(yt-Qt)<J.Ib&&Math.abs(lt-gr)<J.Ib?Y(S):(_r=Ke-It,Er=yt-Qt,Ar=lt-gr,Pr=1/Math.hypot(_r,Er,Ar),_r*=Pr,Er*=Pr,Ar*=Pr,Je=qr*Ar-ut*Er,mt=ut*_r-lr*Ar,Ct=lr*Er-qr*_r,Pr=Math.hypot(Je,mt,Ct),Pr?(Pr=1/Pr,Je*=Pr,mt*=Pr,Ct*=Pr):(Je=0,mt=0,Ct=0),H=Er*Ct-Ar*mt,Ht=Ar*Je-_r*Ct,Vt=_r*mt-Er*Je,Pr=Math.hypot(H,Ht,Vt),Pr?(Pr=1/Pr,H*=Pr,Ht*=Pr,Vt*=Pr):(H=0,Ht=0,Vt=0),S[0]=Je,S[1]=H,S[2]=_r,S[3]=0,S[4]=mt,S[5]=Ht,S[6]=Er,S[7]=0,S[8]=Ct,S[9]=Vt,S[10]=Ar,S[11]=0,S[12]=-(Je*Ke+mt*yt+Ct*lt),S[13]=-(H*Ke+Ht*yt+Vt*lt),S[14]=-(_r*Ke+Er*yt+Ar*lt),S[15]=1,S)}function Jt(S,z,pe,Ue){var Je=z[0],mt=z[1],Ct=z[2],H=Ue[0],Ht=Ue[1],Vt=Ue[2],_r=Je-pe[0],Er=mt-pe[1],Ar=Ct-pe[2],Pr=_r*_r+Er*Er+Ar*Ar;Pr>0&&(Pr=1/Math.sqrt(Pr),_r*=Pr,Er*=Pr,Ar*=Pr);var Ke=Ht*Ar-Vt*Er,yt=Vt*_r-H*Ar,lt=H*Er-Ht*_r;return Pr=Ke*Ke+yt*yt+lt*lt,Pr>0&&(Pr=1/Math.sqrt(Pr),Ke*=Pr,yt*=Pr,lt*=Pr),S[0]=Ke,S[1]=yt,S[2]=lt,S[3]=0,S[4]=Er*lt-Ar*yt,S[5]=Ar*Ke-_r*lt,S[6]=_r*yt-Er*Ke,S[7]=0,S[8]=_r,S[9]=Er,S[10]=Ar,S[11]=0,S[12]=Je,S[13]=mt,S[14]=Ct,S[15]=1,S}function Nr(S){return"mat4("+S[0]+", "+S[1]+", "+S[2]+", "+S[3]+", "+S[4]+", "+S[5]+", "+S[6]+", "+S[7]+", "+S[8]+", "+S[9]+", "+S[10]+", "+S[11]+", "+S[12]+", "+S[13]+", "+S[14]+", "+S[15]+")"}function Fr(S){return Math.hypot(S[0],S[1],S[2],S[3],S[4],S[5],S[6],S[7],S[8],S[9],S[10],S[11],S[12],S[13],S[14],S[15])}function ln(S,z,pe){return S[0]=z[0]+pe[0],S[1]=z[1]+pe[1],S[2]=z[2]+pe[2],S[3]=z[3]+pe[3],S[4]=z[4]+pe[4],S[5]=z[5]+pe[5],S[6]=z[6]+pe[6],S[7]=z[7]+pe[7],S[8]=z[8]+pe[8],S[9]=z[9]+pe[9],S[10]=z[10]+pe[10],S[11]=z[11]+pe[11],S[12]=z[12]+pe[12],S[13]=z[13]+pe[13],S[14]=z[14]+pe[14],S[15]=z[15]+pe[15],S}function tr(S,z,pe){return S[0]=z[0]-pe[0],S[1]=z[1]-pe[1],S[2]=z[2]-pe[2],S[3]=z[3]-pe[3],S[4]=z[4]-pe[4],S[5]=z[5]-pe[5],S[6]=z[6]-pe[6],S[7]=z[7]-pe[7],S[8]=z[8]-pe[8],S[9]=z[9]-pe[9],S[10]=z[10]-pe[10],S[11]=z[11]-pe[11],S[12]=z[12]-pe[12],S[13]=z[13]-pe[13],S[14]=z[14]-pe[14],S[15]=z[15]-pe[15],S}function se(S,z,pe){return S[0]=z[0]*pe,S[1]=z[1]*pe,S[2]=z[2]*pe,S[3]=z[3]*pe,S[4]=z[4]*pe,S[5]=z[5]*pe,S[6]=z[6]*pe,S[7]=z[7]*pe,S[8]=z[8]*pe,S[9]=z[9]*pe,S[10]=z[10]*pe,S[11]=z[11]*pe,S[12]=z[12]*pe,S[13]=z[13]*pe,S[14]=z[14]*pe,S[15]=z[15]*pe,S}function ge(S,z,pe,Ue){return S[0]=z[0]+pe[0]*Ue,S[1]=z[1]+pe[1]*Ue,S[2]=z[2]+pe[2]*Ue,S[3]=z[3]+pe[3]*Ue,S[4]=z[4]+pe[4]*Ue,S[5]=z[5]+pe[5]*Ue,S[6]=z[6]+pe[6]*Ue,S[7]=z[7]+pe[7]*Ue,S[8]=z[8]+pe[8]*Ue,S[9]=z[9]+pe[9]*Ue,S[10]=z[10]+pe[10]*Ue,S[11]=z[11]+pe[11]*Ue,S[12]=z[12]+pe[12]*Ue,S[13]=z[13]+pe[13]*Ue,S[14]=z[14]+pe[14]*Ue,S[15]=z[15]+pe[15]*Ue,S}function Re(S,z){return S[0]===z[0]&&S[1]===z[1]&&S[2]===z[2]&&S[3]===z[3]&&S[4]===z[4]&&S[5]===z[5]&&S[6]===z[6]&&S[7]===z[7]&&S[8]===z[8]&&S[9]===z[9]&&S[10]===z[10]&&S[11]===z[11]&&S[12]===z[12]&&S[13]===z[13]&&S[14]===z[14]&&S[15]===z[15]}function tt(S,z){var pe=S[0],Ue=S[1],Je=S[2],mt=S[3],Ct=S[4],H=S[5],Ht=S[6],Vt=S[7],_r=S[8],Er=S[9],Ar=S[10],Pr=S[11],Ke=S[12],yt=S[13],lt=S[14],lr=S[15],qr=z[0],ut=z[1],It=z[2],Qt=z[3],gr=z[4],gn=z[5],Cn=z[6],vi=z[7],xi=z[8],Ri=z[9],Wi=z[10],si=z[11],G=z[12],I=z[13],Z=z[14],$=z[15];return Math.abs(pe-qr)<=J.Ib*Math.max(1,Math.abs(pe),Math.abs(qr))&&Math.abs(Ue-ut)<=J.Ib*Math.max(1,Math.abs(Ue),Math.abs(ut))&&Math.abs(Je-It)<=J.Ib*Math.max(1,Math.abs(Je),Math.abs(It))&&Math.abs(mt-Qt)<=J.Ib*Math.max(1,Math.abs(mt),Math.abs(Qt))&&Math.abs(Ct-gr)<=J.Ib*Math.max(1,Math.abs(Ct),Math.abs(gr))&&Math.abs(H-gn)<=J.Ib*Math.max(1,Math.abs(H),Math.abs(gn))&&Math.abs(Ht-Cn)<=J.Ib*Math.max(1,Math.abs(Ht),Math.abs(Cn))&&Math.abs(Vt-vi)<=J.Ib*Math.max(1,Math.abs(Vt),Math.abs(vi))&&Math.abs(_r-xi)<=J.Ib*Math.max(1,Math.abs(_r),Math.abs(xi))&&Math.abs(Er-Ri)<=J.Ib*Math.max(1,Math.abs(Er),Math.abs(Ri))&&Math.abs(Ar-Wi)<=J.Ib*Math.max(1,Math.abs(Ar),Math.abs(Wi))&&Math.abs(Pr-si)<=J.Ib*Math.max(1,Math.abs(Pr),Math.abs(si))&&Math.abs(Ke-G)<=J.Ib*Math.max(1,Math.abs(Ke),Math.abs(G))&&Math.abs(yt-I)<=J.Ib*Math.max(1,Math.abs(yt),Math.abs(I))&&Math.abs(lt-Z)<=J.Ib*Math.max(1,Math.abs(lt),Math.abs(Z))&&Math.abs(lr-$)<=J.Ib*Math.max(1,Math.abs(lr),Math.abs($))}var Mt=Ie,Dt=tr},98333:function(ur,L,x){"use strict";x.d(L,{Ue:function(){return E},al:function(){return w},bA:function(){return Ft},fF:function(){return bt}});var J=x(49685);function E(){var se=new J.WT(4);return J.WT!=Float32Array&&(se[0]=0,se[1]=0,se[2]=0,se[3]=0),se}function p(se){var ge=new glMatrix.ARRAY_TYPE(4);return ge[0]=se[0],ge[1]=se[1],ge[2]=se[2],ge[3]=se[3],ge}function w(se,ge,Re,tt){var Mt=new J.WT(4);return Mt[0]=se,Mt[1]=ge,Mt[2]=Re,Mt[3]=tt,Mt}function F(se,ge){return se[0]=ge[0],se[1]=ge[1],se[2]=ge[2],se[3]=ge[3],se}function Q(se,ge,Re,tt,Mt){return se[0]=ge,se[1]=Re,se[2]=tt,se[3]=Mt,se}function Y(se,ge,Re){return se[0]=ge[0]+Re[0],se[1]=ge[1]+Re[1],se[2]=ge[2]+Re[2],se[3]=ge[3]+Re[3],se}function le(se,ge,Re){return se[0]=ge[0]-Re[0],se[1]=ge[1]-Re[1],se[2]=ge[2]-Re[2],se[3]=ge[3]-Re[3],se}function ne(se,ge,Re){return se[0]=ge[0]*Re[0],se[1]=ge[1]*Re[1],se[2]=ge[2]*Re[2],se[3]=ge[3]*Re[3],se}function be(se,ge,Re){return se[0]=ge[0]/Re[0],se[1]=ge[1]/Re[1],se[2]=ge[2]/Re[2],se[3]=ge[3]/Re[3],se}function we(se,ge){return se[0]=Math.ceil(ge[0]),se[1]=Math.ceil(ge[1]),se[2]=Math.ceil(ge[2]),se[3]=Math.ceil(ge[3]),se}function Ie(se,ge){return se[0]=Math.floor(ge[0]),se[1]=Math.floor(ge[1]),se[2]=Math.floor(ge[2]),se[3]=Math.floor(ge[3]),se}function $t(se,ge,Re){return se[0]=Math.min(ge[0],Re[0]),se[1]=Math.min(ge[1],Re[1]),se[2]=Math.min(ge[2],Re[2]),se[3]=Math.min(ge[3],Re[3]),se}function Zt(se,ge,Re){return se[0]=Math.max(ge[0],Re[0]),se[1]=Math.max(ge[1],Re[1]),se[2]=Math.max(ge[2],Re[2]),se[3]=Math.max(ge[3],Re[3]),se}function Xt(se,ge){return se[0]=Math.round(ge[0]),se[1]=Math.round(ge[1]),se[2]=Math.round(ge[2]),se[3]=Math.round(ge[3]),se}function Ft(se,ge,Re){return se[0]=ge[0]*Re,se[1]=ge[1]*Re,se[2]=ge[2]*Re,se[3]=ge[3]*Re,se}function Lt(se,ge,Re,tt){return se[0]=ge[0]+Re[0]*tt,se[1]=ge[1]+Re[1]*tt,se[2]=ge[2]+Re[2]*tt,se[3]=ge[3]+Re[3]*tt,se}function _t(se,ge){var Re=ge[0]-se[0],tt=ge[1]-se[1],Mt=ge[2]-se[2],Dt=ge[3]-se[3];return Math.hypot(Re,tt,Mt,Dt)}function pt(se,ge){var Re=ge[0]-se[0],tt=ge[1]-se[1],Mt=ge[2]-se[2],Dt=ge[3]-se[3];return Re*Re+tt*tt+Mt*Mt+Dt*Dt}function Cr(se){var ge=se[0],Re=se[1],tt=se[2],Mt=se[3];return Math.hypot(ge,Re,tt,Mt)}function Gt(se){var ge=se[0],Re=se[1],tt=se[2],Mt=se[3];return ge*ge+Re*Re+tt*tt+Mt*Mt}function ar(se,ge){return se[0]=-ge[0],se[1]=-ge[1],se[2]=-ge[2],se[3]=-ge[3],se}function gt(se,ge){return se[0]=1/ge[0],se[1]=1/ge[1],se[2]=1/ge[2],se[3]=1/ge[3],se}function Ye(se,ge){var Re=ge[0],tt=ge[1],Mt=ge[2],Dt=ge[3],S=Re*Re+tt*tt+Mt*Mt+Dt*Dt;return S>0&&(S=1/Math.sqrt(S)),se[0]=Re*S,se[1]=tt*S,se[2]=Mt*S,se[3]=Dt*S,se}function Et(se,ge){return se[0]*ge[0]+se[1]*ge[1]+se[2]*ge[2]+se[3]*ge[3]}function Ne(se,ge,Re,tt){var Mt=Re[0]*tt[1]-Re[1]*tt[0],Dt=Re[0]*tt[2]-Re[2]*tt[0],S=Re[0]*tt[3]-Re[3]*tt[0],z=Re[1]*tt[2]-Re[2]*tt[1],pe=Re[1]*tt[3]-Re[3]*tt[1],Ue=Re[2]*tt[3]-Re[3]*tt[2],Je=ge[0],mt=ge[1],Ct=ge[2],H=ge[3];return se[0]=mt*Ue-Ct*pe+H*z,se[1]=-(Je*Ue)+Ct*S-H*Dt,se[2]=Je*pe-mt*S+H*Mt,se[3]=-(Je*z)+mt*Dt-Ct*Mt,se}function Ae(se,ge,Re,tt){var Mt=ge[0],Dt=ge[1],S=ge[2],z=ge[3];return se[0]=Mt+tt*(Re[0]-Mt),se[1]=Dt+tt*(Re[1]-Dt),se[2]=S+tt*(Re[2]-S),se[3]=z+tt*(Re[3]-z),se}function Be(se,ge){ge=ge||1;var Re,tt,Mt,Dt,S,z;do Re=glMatrix.RANDOM()*2-1,tt=glMatrix.RANDOM()*2-1,S=Re*Re+tt*tt;while(S>=1);do Mt=glMatrix.RANDOM()*2-1,Dt=glMatrix.RANDOM()*2-1,z=Mt*Mt+Dt*Dt;while(z>=1);var pe=Math.sqrt((1-S)/z);return se[0]=ge*Re,se[1]=ge*tt,se[2]=ge*Mt*pe,se[3]=ge*Dt*pe,se}function bt(se,ge,Re){var tt=ge[0],Mt=ge[1],Dt=ge[2],S=ge[3];return se[0]=Re[0]*tt+Re[4]*Mt+Re[8]*Dt+Re[12]*S,se[1]=Re[1]*tt+Re[5]*Mt+Re[9]*Dt+Re[13]*S,se[2]=Re[2]*tt+Re[6]*Mt+Re[10]*Dt+Re[14]*S,se[3]=Re[3]*tt+Re[7]*Mt+Re[11]*Dt+Re[15]*S,se}function ir(se,ge,Re){var tt=ge[0],Mt=ge[1],Dt=ge[2],S=Re[0],z=Re[1],pe=Re[2],Ue=Re[3],Je=Ue*tt+z*Dt-pe*Mt,mt=Ue*Mt+pe*tt-S*Dt,Ct=Ue*Dt+S*Mt-z*tt,H=-S*tt-z*Mt-pe*Dt;return se[0]=Je*Ue+H*-S+mt*-pe-Ct*-z,se[1]=mt*Ue+H*-z+Ct*-S-Je*-pe,se[2]=Ct*Ue+H*-pe+Je*-z-mt*-S,se[3]=ge[3],se}function re(se){return se[0]=0,se[1]=0,se[2]=0,se[3]=0,se}function Ee(se){return"vec4("+se[0]+", "+se[1]+", "+se[2]+", "+se[3]+")"}function ae(se,ge){return se[0]===ge[0]&&se[1]===ge[1]&&se[2]===ge[2]&&se[3]===ge[3]}function me(se,ge){var Re=se[0],tt=se[1],Mt=se[2],Dt=se[3],S=ge[0],z=ge[1],pe=ge[2],Ue=ge[3];return Math.abs(Re-S)<=glMatrix.EPSILON*Math.max(1,Math.abs(Re),Math.abs(S))&&Math.abs(tt-z)<=glMatrix.EPSILON*Math.max(1,Math.abs(tt),Math.abs(z))&&Math.abs(Mt-pe)<=glMatrix.EPSILON*Math.max(1,Math.abs(Mt),Math.abs(pe))&&Math.abs(Dt-Ue)<=glMatrix.EPSILON*Math.max(1,Math.abs(Dt),Math.abs(Ue))}var Te=null,Qe=null,dt=null,Jt=null,Nr=null,Fr=null,ln=null,tr=function(){var se=E();return function(ge,Re,tt,Mt,Dt,S){var z,pe;for(Re||(Re=4),tt||(tt=0),Mt?pe=Math.min(Mt*Re+tt,ge.length):pe=ge.length,z=tt;z<pe;z+=Re)se[0]=ge[z],se[1]=ge[z+1],se[2]=ge[z+2],se[3]=ge[z+3],Dt(se,se,S),ge[z]=se[0],ge[z+1]=se[1],ge[z+2]=se[2],ge[z+3]=se[3];return ge}}()},50840:function(ur,L,x){var J;/*! Hammer.JS - v2.0.7 - 2016-04-22
* http://hammerjs.github.io/
*
* Copyright (c) 2016 Jorik Tangelder;
* Licensed under the MIT license */(function(E,p,w,F){"use strict";var Q=["","webkit","Moz","MS","ms","o"],Y=p.createElement("div"),le="function",ne=Math.round,be=Math.abs,we=Date.now;function Ie(he,Pe,ct){return setTimeout(Cr(he,ct),Pe)}function $t(he,Pe,ct){return Array.isArray(he)?(Zt(he,ct[Pe],ct),!0):!1}function Zt(he,Pe,ct){var cr;if(!!he)if(he.forEach)he.forEach(Pe,ct);else if(he.length!==F)for(cr=0;cr<he.length;)Pe.call(ct,he[cr],cr,he),cr++;else for(cr in he)he.hasOwnProperty(cr)&&Pe.call(ct,he[cr],cr,he)}function Xt(he,Pe,ct){var cr="DEPRECATED METHOD: "+Pe+`
`+ct+` AT 
`;return function(){var tn=new Error("get-stack-trace"),kn=tn&&tn.stack?tn.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",Zi=E.console&&(E.console.warn||E.console.log);return Zi&&Zi.call(E.console,cr,kn),he.apply(this,arguments)}}var Ft;typeof Object.assign!="function"?Ft=function(Pe){if(Pe===F||Pe===null)throw new TypeError("Cannot convert undefined or null to object");for(var ct=Object(Pe),cr=1;cr<arguments.length;cr++){var tn=arguments[cr];if(tn!==F&&tn!==null)for(var kn in tn)tn.hasOwnProperty(kn)&&(ct[kn]=tn[kn])}return ct}:Ft=Object.assign;var Lt=Xt(function(Pe,ct,cr){for(var tn=Object.keys(ct),kn=0;kn<tn.length;)(!cr||cr&&Pe[tn[kn]]===F)&&(Pe[tn[kn]]=ct[tn[kn]]),kn++;return Pe},"extend","Use `assign`."),_t=Xt(function(Pe,ct){return Lt(Pe,ct,!0)},"merge","Use `assign`.");function pt(he,Pe,ct){var cr=Pe.prototype,tn;tn=he.prototype=Object.create(cr),tn.constructor=he,tn._super=cr,ct&&Ft(tn,ct)}function Cr(he,Pe){return function(){return he.apply(Pe,arguments)}}function Gt(he,Pe){return typeof he==le?he.apply(Pe&&Pe[0]||F,Pe):he}function ar(he,Pe){return he===F?Pe:he}function gt(he,Pe,ct){Zt(Ae(Pe),function(cr){he.addEventListener(cr,ct,!1)})}function Ye(he,Pe,ct){Zt(Ae(Pe),function(cr){he.removeEventListener(cr,ct,!1)})}function Et(he,Pe){for(;he;){if(he==Pe)return!0;he=he.parentNode}return!1}function Ne(he,Pe){return he.indexOf(Pe)>-1}function Ae(he){return he.trim().split(/\s+/g)}function Be(he,Pe,ct){if(he.indexOf&&!ct)return he.indexOf(Pe);for(var cr=0;cr<he.length;){if(ct&&he[cr][ct]==Pe||!ct&&he[cr]===Pe)return cr;cr++}return-1}function bt(he){return Array.prototype.slice.call(he,0)}function ir(he,Pe,ct){for(var cr=[],tn=[],kn=0;kn<he.length;){var Zi=Pe?he[kn][Pe]:he[kn];Be(tn,Zi)<0&&cr.push(he[kn]),tn[kn]=Zi,kn++}return ct&&(Pe?cr=cr.sort(function(Ka,$a){return Ka[Pe]>$a[Pe]}):cr=cr.sort()),cr}function re(he,Pe){for(var ct,cr,tn=Pe[0].toUpperCase()+Pe.slice(1),kn=0;kn<Q.length;){if(ct=Q[kn],cr=ct?ct+tn:Pe,cr in he)return cr;kn++}return F}var Ee=1;function ae(){return Ee++}function me(he){var Pe=he.ownerDocument||he;return Pe.defaultView||Pe.parentWindow||E}var Te=/mobile|tablet|ip(ad|hone|od)|android/i,Qe="ontouchstart"in E,dt=re(E,"PointerEvent")!==F,Jt=Qe&&Te.test(navigator.userAgent),Nr="touch",Fr="pen",ln="mouse",tr="kinect",se=25,ge=1,Re=2,tt=4,Mt=8,Dt=1,S=2,z=4,pe=8,Ue=16,Je=S|z,mt=pe|Ue,Ct=Je|mt,H=["x","y"],Ht=["clientX","clientY"];function Vt(he,Pe){var ct=this;this.manager=he,this.callback=Pe,this.element=he.element,this.target=he.options.inputTarget,this.domHandler=function(cr){Gt(he.options.enable,[he])&&ct.handler(cr)},this.init()}Vt.prototype={handler:function(){},init:function(){this.evEl&&gt(this.element,this.evEl,this.domHandler),this.evTarget&&gt(this.target,this.evTarget,this.domHandler),this.evWin&&gt(me(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&Ye(this.element,this.evEl,this.domHandler),this.evTarget&&Ye(this.target,this.evTarget,this.domHandler),this.evWin&&Ye(me(this.element),this.evWin,this.domHandler)}};function _r(he){var Pe,ct=he.options.inputClass;return ct?Pe=ct:dt?Pe=I:Jt?Pe=wt:Qe?Pe=dr:Pe=xi,new Pe(he,Er)}function Er(he,Pe,ct){var cr=ct.pointers.length,tn=ct.changedPointers.length,kn=Pe&ge&&cr-tn==0,Zi=Pe&(tt|Mt)&&cr-tn==0;ct.isFirst=!!kn,ct.isFinal=!!Zi,kn&&(he.session={}),ct.eventType=Pe,Ar(he,ct),he.emit("hammer.input",ct),he.recognize(ct),he.session.prevInput=ct}function Ar(he,Pe){var ct=he.session,cr=Pe.pointers,tn=cr.length;ct.firstInput||(ct.firstInput=yt(Pe)),tn>1&&!ct.firstMultiple?ct.firstMultiple=yt(Pe):tn===1&&(ct.firstMultiple=!1);var kn=ct.firstInput,Zi=ct.firstMultiple,Yi=Zi?Zi.center:kn.center,Ka=Pe.center=lt(cr);Pe.timeStamp=we(),Pe.deltaTime=Pe.timeStamp-kn.timeStamp,Pe.angle=It(Yi,Ka),Pe.distance=ut(Yi,Ka),Pr(ct,Pe),Pe.offsetDirection=qr(Pe.deltaX,Pe.deltaY);var $a=lr(Pe.deltaTime,Pe.deltaX,Pe.deltaY);Pe.overallVelocityX=$a.x,Pe.overallVelocityY=$a.y,Pe.overallVelocity=be($a.x)>be($a.y)?$a.x:$a.y,Pe.scale=Zi?gr(Zi.pointers,cr):1,Pe.rotation=Zi?Qt(Zi.pointers,cr):0,Pe.maxPointers=ct.prevInput?Pe.pointers.length>ct.prevInput.maxPointers?Pe.pointers.length:ct.prevInput.maxPointers:Pe.pointers.length,Ke(ct,Pe);var Xo=he.element;Et(Pe.srcEvent.target,Xo)&&(Xo=Pe.srcEvent.target),Pe.target=Xo}function Pr(he,Pe){var ct=Pe.center,cr=he.offsetDelta||{},tn=he.prevDelta||{},kn=he.prevInput||{};(Pe.eventType===ge||kn.eventType===tt)&&(tn=he.prevDelta={x:kn.deltaX||0,y:kn.deltaY||0},cr=he.offsetDelta={x:ct.x,y:ct.y}),Pe.deltaX=tn.x+(ct.x-cr.x),Pe.deltaY=tn.y+(ct.y-cr.y)}function Ke(he,Pe){var ct=he.lastInterval||Pe,cr=Pe.timeStamp-ct.timeStamp,tn,kn,Zi,Yi;if(Pe.eventType!=Mt&&(cr>se||ct.velocity===F)){var Ka=Pe.deltaX-ct.deltaX,$a=Pe.deltaY-ct.deltaY,Xo=lr(cr,Ka,$a);kn=Xo.x,Zi=Xo.y,tn=be(Xo.x)>be(Xo.y)?Xo.x:Xo.y,Yi=qr(Ka,$a),he.lastInterval=Pe}else tn=ct.velocity,kn=ct.velocityX,Zi=ct.velocityY,Yi=ct.direction;Pe.velocity=tn,Pe.velocityX=kn,Pe.velocityY=Zi,Pe.direction=Yi}function yt(he){for(var Pe=[],ct=0;ct<he.pointers.length;)Pe[ct]={clientX:ne(he.pointers[ct].clientX),clientY:ne(he.pointers[ct].clientY)},ct++;return{timeStamp:we(),pointers:Pe,center:lt(Pe),deltaX:he.deltaX,deltaY:he.deltaY}}function lt(he){var Pe=he.length;if(Pe===1)return{x:ne(he[0].clientX),y:ne(he[0].clientY)};for(var ct=0,cr=0,tn=0;tn<Pe;)ct+=he[tn].clientX,cr+=he[tn].clientY,tn++;return{x:ne(ct/Pe),y:ne(cr/Pe)}}function lr(he,Pe,ct){return{x:Pe/he||0,y:ct/he||0}}function qr(he,Pe){return he===Pe?Dt:be(he)>=be(Pe)?he<0?S:z:Pe<0?pe:Ue}function ut(he,Pe,ct){ct||(ct=H);var cr=Pe[ct[0]]-he[ct[0]],tn=Pe[ct[1]]-he[ct[1]];return Math.sqrt(cr*cr+tn*tn)}function It(he,Pe,ct){ct||(ct=H);var cr=Pe[ct[0]]-he[ct[0]],tn=Pe[ct[1]]-he[ct[1]];return Math.atan2(tn,cr)*180/Math.PI}function Qt(he,Pe){return It(Pe[1],Pe[0],Ht)+It(he[1],he[0],Ht)}function gr(he,Pe){return ut(Pe[0],Pe[1],Ht)/ut(he[0],he[1],Ht)}var gn={mousedown:ge,mousemove:Re,mouseup:tt},Cn="mousedown",vi="mousemove mouseup";function xi(){this.evEl=Cn,this.evWin=vi,this.pressed=!1,Vt.apply(this,arguments)}pt(xi,Vt,{handler:function(Pe){var ct=gn[Pe.type];ct&ge&&Pe.button===0&&(this.pressed=!0),ct&Re&&Pe.which!==1&&(ct=tt),!!this.pressed&&(ct&tt&&(this.pressed=!1),this.callback(this.manager,ct,{pointers:[Pe],changedPointers:[Pe],pointerType:ln,srcEvent:Pe}))}});var Ri={pointerdown:ge,pointermove:Re,pointerup:tt,pointercancel:Mt,pointerout:Mt},Wi={2:Nr,3:Fr,4:ln,5:tr},si="pointerdown",G="pointermove pointerup pointercancel";E.MSPointerEvent&&!E.PointerEvent&&(si="MSPointerDown",G="MSPointerMove MSPointerUp MSPointerCancel");function I(){this.evEl=si,this.evWin=G,Vt.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}pt(I,Vt,{handler:function(Pe){var ct=this.store,cr=!1,tn=Pe.type.toLowerCase().replace("ms",""),kn=Ri[tn],Zi=Wi[Pe.pointerType]||Pe.pointerType,Yi=Zi==Nr,Ka=Be(ct,Pe.pointerId,"pointerId");kn&ge&&(Pe.button===0||Yi)?Ka<0&&(ct.push(Pe),Ka=ct.length-1):kn&(tt|Mt)&&(cr=!0),!(Ka<0)&&(ct[Ka]=Pe,this.callback(this.manager,kn,{pointers:ct,changedPointers:[Pe],pointerType:Zi,srcEvent:Pe}),cr&&ct.splice(Ka,1))}});var Z={touchstart:ge,touchmove:Re,touchend:tt,touchcancel:Mt},$="touchstart",ie="touchstart touchmove touchend touchcancel";function Le(){this.evTarget=$,this.evWin=ie,this.started=!1,Vt.apply(this,arguments)}pt(Le,Vt,{handler:function(Pe){var ct=Z[Pe.type];if(ct===ge&&(this.started=!0),!!this.started){var cr=Ge.call(this,Pe,ct);ct&(tt|Mt)&&cr[0].length-cr[1].length==0&&(this.started=!1),this.callback(this.manager,ct,{pointers:cr[0],changedPointers:cr[1],pointerType:Nr,srcEvent:Pe})}}});function Ge(he,Pe){var ct=bt(he.touches),cr=bt(he.changedTouches);return Pe&(tt|Mt)&&(ct=ir(ct.concat(cr),"identifier",!0)),[ct,cr]}var ue={touchstart:ge,touchmove:Re,touchend:tt,touchcancel:Mt},De="touchstart touchmove touchend touchcancel";function wt(){this.evTarget=De,this.targetIds={},Vt.apply(this,arguments)}pt(wt,Vt,{handler:function(Pe){var ct=ue[Pe.type],cr=Ir.call(this,Pe,ct);!cr||this.callback(this.manager,ct,{pointers:cr[0],changedPointers:cr[1],pointerType:Nr,srcEvent:Pe})}});function Ir(he,Pe){var ct=bt(he.touches),cr=this.targetIds;if(Pe&(ge|Re)&&ct.length===1)return cr[ct[0].identifier]=!0,[ct,ct];var tn,kn,Zi=bt(he.changedTouches),Yi=[],Ka=this.target;if(kn=ct.filter(function($a){return Et($a.target,Ka)}),Pe===ge)for(tn=0;tn<kn.length;)cr[kn[tn].identifier]=!0,tn++;for(tn=0;tn<Zi.length;)cr[Zi[tn].identifier]&&Yi.push(Zi[tn]),Pe&(tt|Mt)&&delete cr[Zi[tn].identifier],tn++;if(!!Yi.length)return[ir(kn.concat(Yi),"identifier",!0),Yi]}var Ur=2500,jt=25;function dr(){Vt.apply(this,arguments);var he=Cr(this.handler,this);this.touch=new wt(this.manager,he),this.mouse=new xi(this.manager,he),this.primaryTouch=null,this.lastTouches=[]}pt(dr,Vt,{handler:function(Pe,ct,cr){var tn=cr.pointerType==Nr,kn=cr.pointerType==ln;if(!(kn&&cr.sourceCapabilities&&cr.sourceCapabilities.firesTouchEvents)){if(tn)Hr.call(this,ct,cr);else if(kn&&vr.call(this,cr))return;this.callback(Pe,ct,cr)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function Hr(he,Pe){he&ge?(this.primaryTouch=Pe.changedPointers[0].identifier,_n.call(this,Pe)):he&(tt|Mt)&&_n.call(this,Pe)}function _n(he){var Pe=he.changedPointers[0];if(Pe.identifier===this.primaryTouch){var ct={x:Pe.clientX,y:Pe.clientY};this.lastTouches.push(ct);var cr=this.lastTouches,tn=function(){var kn=cr.indexOf(ct);kn>-1&&cr.splice(kn,1)};setTimeout(tn,Ur)}}function vr(he){for(var Pe=he.srcEvent.clientX,ct=he.srcEvent.clientY,cr=0;cr<this.lastTouches.length;cr++){var tn=this.lastTouches[cr],kn=Math.abs(Pe-tn.x),Zi=Math.abs(ct-tn.y);if(kn<=jt&&Zi<=jt)return!0}return!1}var vn=re(Y.style,"touchAction"),$r=vn!==F,cn="compute",pi="auto",pn="manipulation",_i="none",Xi="pan-x",mi="pan-y",Di=ji();function Pi(he,Pe){this.manager=he,this.set(Pe)}Pi.prototype={set:function(he){he==cn&&(he=this.compute()),$r&&this.manager.element.style&&Di[he]&&(this.manager.element.style[vn]=he),this.actions=he.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var he=[];return Zt(this.manager.recognizers,function(Pe){Gt(Pe.options.enable,[Pe])&&(he=he.concat(Pe.getTouchAction()))}),po(he.join(" "))},preventDefaults:function(he){var Pe=he.srcEvent,ct=he.offsetDirection;if(this.manager.session.prevented){Pe.preventDefault();return}var cr=this.actions,tn=Ne(cr,_i)&&!Di[_i],kn=Ne(cr,mi)&&!Di[mi],Zi=Ne(cr,Xi)&&!Di[Xi];if(tn){var Yi=he.pointers.length===1,Ka=he.distance<2,$a=he.deltaTime<250;if(Yi&&Ka&&$a)return}if(!(Zi&&kn)&&(tn||kn&&ct&Je||Zi&&ct&mt))return this.preventSrc(Pe)},preventSrc:function(he){this.manager.session.prevented=!0,he.preventDefault()}};function po(he){if(Ne(he,_i))return _i;var Pe=Ne(he,Xi),ct=Ne(he,mi);return Pe&&ct?_i:Pe||ct?Pe?Xi:mi:Ne(he,pn)?pn:pi}function ji(){if(!$r)return!1;var he={},Pe=E.CSS&&E.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(ct){he[ct]=Pe?E.CSS.supports("touch-action",ct):!0}),he}var Rn=1,Dn=2,li=4,Vn=8,Na=Vn,ps=16,ki=32;function Ba(he){this.options=Ft({},this.defaults,he||{}),this.id=ae(),this.manager=null,this.options.enable=ar(this.options.enable,!0),this.state=Rn,this.simultaneous={},this.requireFail=[]}Ba.prototype={defaults:{},set:function(he){return Ft(this.options,he),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(he){if($t(he,"recognizeWith",this))return this;var Pe=this.simultaneous;return he=_a(he,this),Pe[he.id]||(Pe[he.id]=he,he.recognizeWith(this)),this},dropRecognizeWith:function(he){return $t(he,"dropRecognizeWith",this)?this:(he=_a(he,this),delete this.simultaneous[he.id],this)},requireFailure:function(he){if($t(he,"requireFailure",this))return this;var Pe=this.requireFail;return he=_a(he,this),Be(Pe,he)===-1&&(Pe.push(he),he.requireFailure(this)),this},dropRequireFailure:function(he){if($t(he,"dropRequireFailure",this))return this;he=_a(he,this);var Pe=Be(this.requireFail,he);return Pe>-1&&this.requireFail.splice(Pe,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(he){return!!this.simultaneous[he.id]},emit:function(he){var Pe=this,ct=this.state;function cr(tn){Pe.manager.emit(tn,he)}ct<Vn&&cr(Pe.options.event+xu(ct)),cr(Pe.options.event),he.additionalEvent&&cr(he.additionalEvent),ct>=Vn&&cr(Pe.options.event+xu(ct))},tryEmit:function(he){if(this.canEmit())return this.emit(he);this.state=ki},canEmit:function(){for(var he=0;he<this.requireFail.length;){if(!(this.requireFail[he].state&(ki|Rn)))return!1;he++}return!0},recognize:function(he){var Pe=Ft({},he);if(!Gt(this.options.enable,[this,Pe])){this.reset(),this.state=ki;return}this.state&(Na|ps|ki)&&(this.state=Rn),this.state=this.process(Pe),this.state&(Dn|li|Vn|ps)&&this.tryEmit(Pe)},process:function(he){},getTouchAction:function(){},reset:function(){}};function xu(he){return he&ps?"cancel":he&Vn?"end":he&li?"move":he&Dn?"start":""}function uu(he){return he==Ue?"down":he==pe?"up":he==S?"left":he==z?"right":""}function _a(he,Pe){var ct=Pe.manager;return ct?ct.get(he):he}function oo(){Ba.apply(this,arguments)}pt(oo,Ba,{defaults:{pointers:1},attrTest:function(he){var Pe=this.options.pointers;return Pe===0||he.pointers.length===Pe},process:function(he){var Pe=this.state,ct=he.eventType,cr=Pe&(Dn|li),tn=this.attrTest(he);return cr&&(ct&Mt||!tn)?Pe|ps:cr||tn?ct&tt?Pe|Vn:Pe&Dn?Pe|li:Dn:ki}});function Wa(){oo.apply(this,arguments),this.pX=null,this.pY=null}pt(Wa,oo,{defaults:{event:"pan",threshold:10,pointers:1,direction:Ct},getTouchAction:function(){var he=this.options.direction,Pe=[];return he&Je&&Pe.push(mi),he&mt&&Pe.push(Xi),Pe},directionTest:function(he){var Pe=this.options,ct=!0,cr=he.distance,tn=he.direction,kn=he.deltaX,Zi=he.deltaY;return tn&Pe.direction||(Pe.direction&Je?(tn=kn===0?Dt:kn<0?S:z,ct=kn!=this.pX,cr=Math.abs(he.deltaX)):(tn=Zi===0?Dt:Zi<0?pe:Ue,ct=Zi!=this.pY,cr=Math.abs(he.deltaY))),he.direction=tn,ct&&cr>Pe.threshold&&tn&Pe.direction},attrTest:function(he){return oo.prototype.attrTest.call(this,he)&&(this.state&Dn||!(this.state&Dn)&&this.directionTest(he))},emit:function(he){this.pX=he.deltaX,this.pY=he.deltaY;var Pe=uu(he.direction);Pe&&(he.additionalEvent=this.options.event+Pe),this._super.emit.call(this,he)}});function Xa(){oo.apply(this,arguments)}pt(Xa,oo,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[_i]},attrTest:function(he){return this._super.attrTest.call(this,he)&&(Math.abs(he.scale-1)>this.options.threshold||this.state&Dn)},emit:function(he){if(he.scale!==1){var Pe=he.scale<1?"in":"out";he.additionalEvent=this.options.event+Pe}this._super.emit.call(this,he)}});function Wo(){Ba.apply(this,arguments),this._timer=null,this._input=null}pt(Wo,Ba,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[pi]},process:function(he){var Pe=this.options,ct=he.pointers.length===Pe.pointers,cr=he.distance<Pe.threshold,tn=he.deltaTime>Pe.time;if(this._input=he,!cr||!ct||he.eventType&(tt|Mt)&&!tn)this.reset();else if(he.eventType&ge)this.reset(),this._timer=Ie(function(){this.state=Na,this.tryEmit()},Pe.time,this);else if(he.eventType&tt)return Na;return ki},reset:function(){clearTimeout(this._timer)},emit:function(he){this.state===Na&&(he&&he.eventType&tt?this.manager.emit(this.options.event+"up",he):(this._input.timeStamp=we(),this.manager.emit(this.options.event,this._input)))}});function sa(){oo.apply(this,arguments)}pt(sa,oo,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[_i]},attrTest:function(he){return this._super.attrTest.call(this,he)&&(Math.abs(he.rotation)>this.options.threshold||this.state&Dn)}});function Ya(){oo.apply(this,arguments)}pt(Ya,oo,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:Je|mt,pointers:1},getTouchAction:function(){return Wa.prototype.getTouchAction.call(this)},attrTest:function(he){var Pe=this.options.direction,ct;return Pe&(Je|mt)?ct=he.overallVelocity:Pe&Je?ct=he.overallVelocityX:Pe&mt&&(ct=he.overallVelocityY),this._super.attrTest.call(this,he)&&Pe&he.offsetDirection&&he.distance>this.options.threshold&&he.maxPointers==this.options.pointers&&be(ct)>this.options.velocity&&he.eventType&tt},emit:function(he){var Pe=uu(he.offsetDirection);Pe&&this.manager.emit(this.options.event+Pe,he),this.manager.emit(this.options.event,he)}});function Ta(){Ba.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}pt(Ta,Ba,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[pn]},process:function(he){var Pe=this.options,ct=he.pointers.length===Pe.pointers,cr=he.distance<Pe.threshold,tn=he.deltaTime<Pe.time;if(this.reset(),he.eventType&ge&&this.count===0)return this.failTimeout();if(cr&&tn&&ct){if(he.eventType!=tt)return this.failTimeout();var kn=this.pTime?he.timeStamp-this.pTime<Pe.interval:!0,Zi=!this.pCenter||ut(this.pCenter,he.center)<Pe.posThreshold;this.pTime=he.timeStamp,this.pCenter=he.center,!Zi||!kn?this.count=1:this.count+=1,this._input=he;var Yi=this.count%Pe.taps;if(Yi===0)return this.hasRequireFailures()?(this._timer=Ie(function(){this.state=Na,this.tryEmit()},Pe.interval,this),Dn):Na}return ki},failTimeout:function(){return this._timer=Ie(function(){this.state=ki},this.options.interval,this),ki},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==Na&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function xa(he,Pe){return Pe=Pe||{},Pe.recognizers=ar(Pe.recognizers,xa.defaults.preset),new rs(he,Pe)}xa.VERSION="2.0.7",xa.defaults={domEvents:!1,touchAction:cn,enable:!0,inputTarget:null,inputClass:null,preset:[[sa,{enable:!1}],[Xa,{enable:!1},["rotate"]],[Ya,{direction:Je}],[Wa,{direction:Je},["swipe"]],[Ta],[Ta,{event:"doubletap",taps:2},["tap"]],[Wo]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var ta=1,sl=2;function rs(he,Pe){this.options=Ft({},xa.defaults,Pe||{}),this.options.inputTarget=this.options.inputTarget||he,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=he,this.input=_r(this),this.touchAction=new Pi(this,this.options.touchAction),qa(this,!0),Zt(this.options.recognizers,function(ct){var cr=this.add(new ct[0](ct[1]));ct[2]&&cr.recognizeWith(ct[2]),ct[3]&&cr.requireFailure(ct[3])},this)}rs.prototype={set:function(he){return Ft(this.options,he),he.touchAction&&this.touchAction.update(),he.inputTarget&&(this.input.destroy(),this.input.target=he.inputTarget,this.input.init()),this},stop:function(he){this.session.stopped=he?sl:ta},recognize:function(he){var Pe=this.session;if(!Pe.stopped){this.touchAction.preventDefaults(he);var ct,cr=this.recognizers,tn=Pe.curRecognizer;(!tn||tn&&tn.state&Na)&&(tn=Pe.curRecognizer=null);for(var kn=0;kn<cr.length;)ct=cr[kn],Pe.stopped!==sl&&(!tn||ct==tn||ct.canRecognizeWith(tn))?ct.recognize(he):ct.reset(),!tn&&ct.state&(Dn|li|Vn)&&(tn=Pe.curRecognizer=ct),kn++}},get:function(he){if(he instanceof Ba)return he;for(var Pe=this.recognizers,ct=0;ct<Pe.length;ct++)if(Pe[ct].options.event==he)return Pe[ct];return null},add:function(he){if($t(he,"add",this))return this;var Pe=this.get(he.options.event);return Pe&&this.remove(Pe),this.recognizers.push(he),he.manager=this,this.touchAction.update(),he},remove:function(he){if($t(he,"remove",this))return this;if(he=this.get(he),he){var Pe=this.recognizers,ct=Be(Pe,he);ct!==-1&&(Pe.splice(ct,1),this.touchAction.update())}return this},on:function(he,Pe){if(he!==F&&Pe!==F){var ct=this.handlers;return Zt(Ae(he),function(cr){ct[cr]=ct[cr]||[],ct[cr].push(Pe)}),this}},off:function(he,Pe){if(he!==F){var ct=this.handlers;return Zt(Ae(he),function(cr){Pe?ct[cr]&&ct[cr].splice(Be(ct[cr],Pe),1):delete ct[cr]}),this}},emit:function(he,Pe){this.options.domEvents&&La(he,Pe);var ct=this.handlers[he]&&this.handlers[he].slice();if(!(!ct||!ct.length)){Pe.type=he,Pe.preventDefault=function(){Pe.srcEvent.preventDefault()};for(var cr=0;cr<ct.length;)ct[cr](Pe),cr++}},destroy:function(){this.element&&qa(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function qa(he,Pe){var ct=he.element;if(!!ct.style){var cr;Zt(he.options.cssProps,function(tn,kn){cr=re(ct.style,kn),Pe?(he.oldCssProps[cr]=ct.style[cr],ct.style[cr]=tn):ct.style[cr]=he.oldCssProps[cr]||""}),Pe||(he.oldCssProps={})}}function La(he,Pe){var ct=p.createEvent("Event");ct.initEvent(he,!0,!0),ct.gesture=Pe,Pe.target.dispatchEvent(ct)}Ft(xa,{INPUT_START:ge,INPUT_MOVE:Re,INPUT_END:tt,INPUT_CANCEL:Mt,STATE_POSSIBLE:Rn,STATE_BEGAN:Dn,STATE_CHANGED:li,STATE_ENDED:Vn,STATE_RECOGNIZED:Na,STATE_CANCELLED:ps,STATE_FAILED:ki,DIRECTION_NONE:Dt,DIRECTION_LEFT:S,DIRECTION_RIGHT:z,DIRECTION_UP:pe,DIRECTION_DOWN:Ue,DIRECTION_HORIZONTAL:Je,DIRECTION_VERTICAL:mt,DIRECTION_ALL:Ct,Manager:rs,Input:Vt,TouchAction:Pi,TouchInput:wt,MouseInput:xi,PointerEventInput:I,TouchMouseInput:dr,SingleTouchInput:Le,Recognizer:Ba,AttrRecognizer:oo,Tap:Ta,Pan:Wa,Swipe:Ya,Pinch:Xa,Rotate:sa,Press:Wo,on:gt,off:Ye,each:Zt,merge:_t,extend:Lt,assign:Ft,inherit:pt,bindFn:Cr,prefixed:re});var fa=typeof E!="undefined"?E:typeof self!="undefined"?self:{};fa.Hammer=xa,J=function(){return xa}.call(L,x,L,ur),J!==F&&(ur.exports=J)})(window,document,"Hammer")},7375:function(ur,L){"use strict";Object.defineProperty(L,"__esModule",{value:!0});var x=Symbol.for("INJECTION");function J(Q,Y,le,ne){function be(){return ne&&!Reflect.hasMetadata(x,this,Y)&&Reflect.defineMetadata(x,le(),this,Y),Reflect.hasMetadata(x,this,Y)?Reflect.getMetadata(x,this,Y):le()}function we(Ie){Reflect.defineMetadata(x,Ie,this,Y)}Object.defineProperty(Q,Y,{configurable:!0,enumerable:!0,get:be,set:we})}function E(Q,Y){return function(le){return function(ne,be){var we=function(){return Q.get(le)};J(ne,be,we,Y)}}}L.makePropertyInjectDecorator=E;function p(Q,Y){return function(le,ne){return function(be,we){var Ie=function(){return Q.getNamed(le,ne)};J(be,we,Ie,Y)}}}L.makePropertyInjectNamedDecorator=p;function w(Q,Y){return function(le,ne,be){return function(we,Ie){var $t=function(){return Q.getTagged(le,ne,be)};J(we,Ie,$t,Y)}}}L.makePropertyInjectTaggedDecorator=w;function F(Q,Y){return function(le){return function(ne,be){var we=function(){return Q.getAll(le)};J(ne,be,we,Y)}}}L.makePropertyMultiInjectDecorator=F},84879:function(ur,L,x){"use strict";var J;J={value:!0};var E=x(7375);function p(w,F){F===void 0&&(F=!0);var Q=E.makePropertyInjectDecorator(w,F),Y=E.makePropertyInjectNamedDecorator(w,F),le=E.makePropertyInjectTaggedDecorator(w,F),ne=E.makePropertyMultiInjectDecorator(w,F);return{lazyInject:Q,lazyInjectNamed:Y,lazyInjectTagged:le,lazyMultiInject:ne}}L.Z=p},99934:function(ur,L,x){"use strict";Object.defineProperty(L,"__esModule",{value:!0}),L.tagProperty=L.tagParameter=L.decorate=void 0;var J=x(16674),E=x(6867);function p(ne,be,we,Ie){var $t=E.TAGGED;F($t,ne,be,Ie,we)}L.tagParameter=p;function w(ne,be,we){var Ie=E.TAGGED_PROP;F(Ie,ne.constructor,be,we)}L.tagProperty=w;function F(ne,be,we,Ie,$t){var Zt={},Xt=typeof $t=="number",Ft=$t!==void 0&&Xt?$t.toString():we;if(Xt&&we!==void 0)throw new Error(J.INVALID_DECORATOR_OPERATION);Reflect.hasOwnMetadata(ne,be)&&(Zt=Reflect.getMetadata(ne,be));var Lt=Zt[Ft];if(!Array.isArray(Lt))Lt=[];else for(var _t=0,pt=Lt;_t<pt.length;_t++){var Cr=pt[_t];if(Cr.key===Ie.key)throw new Error(J.DUPLICATED_METADATA+" "+Cr.key.toString())}Lt.push(Ie),Zt[Ft]=Lt,Reflect.defineMetadata(ne,Zt,be)}function Q(ne,be){Reflect.decorate(ne,be)}function Y(ne,be){return function(we,Ie){be(we,Ie,ne)}}function le(ne,be,we){typeof we=="number"?Q([Y(we,ne)],be):typeof we=="string"?Reflect.decorate([ne],be,we):Q([ne],be)}L.decorate=le},5744:function(ur,L,x){"use strict";Object.defineProperty(L,"__esModule",{value:!0}),L.inject=L.LazyServiceIdentifer=void 0;var J=x(16674),E=x(6867),p=x(47738),w=x(99934),F=function(){function Y(le){this._cb=le}return Y.prototype.unwrap=function(){return this._cb()},Y}();L.LazyServiceIdentifer=F;function Q(Y){return function(le,ne,be){if(Y===void 0)throw new Error(J.UNDEFINED_INJECT_ANNOTATION(le.name));var we=new p.Metadata(E.INJECT_TAG,Y);typeof be=="number"?w.tagParameter(le,ne,be,we):w.tagProperty(le,ne,we)}}L.inject=Q},64315:function(ur,L,x){"use strict";Object.defineProperty(L,"__esModule",{value:!0}),L.injectable=void 0;var J=x(16674),E=x(6867);function p(){return function(w){if(Reflect.hasOwnMetadata(E.PARAM_TYPES,w))throw new Error(J.DUPLICATED_INJECTABLE_DECORATOR);var F=Reflect.getMetadata(E.DESIGN_PARAM_TYPES,w)||[];return Reflect.defineMetadata(E.PARAM_TYPES,F,w),w}}L.injectable=p},71693:function(ur,L,x){"use strict";Object.defineProperty(L,"__esModule",{value:!0}),L.multiInject=void 0;var J=x(6867),E=x(47738),p=x(99934);function w(F){return function(Q,Y,le){var ne=new E.Metadata(J.MULTI_INJECT_TAG,F);typeof le=="number"?p.tagParameter(Q,Y,le,ne):p.tagProperty(Q,Y,ne)}}L.multiInject=w},38085:function(ur,L,x){"use strict";Object.defineProperty(L,"__esModule",{value:!0}),L.named=void 0;var J=x(6867),E=x(47738),p=x(99934);function w(F){return function(Q,Y,le){var ne=new E.Metadata(J.NAMED_TAG,F);typeof le=="number"?p.tagParameter(Q,Y,le,ne):p.tagProperty(Q,Y,ne)}}L.named=w},6515:function(ur,L,x){"use strict";Object.defineProperty(L,"__esModule",{value:!0}),L.optional=void 0;var J=x(6867),E=x(47738),p=x(99934);function w(){return function(F,Q,Y){var le=new E.Metadata(J.OPTIONAL_TAG,!0);typeof Y=="number"?p.tagParameter(F,Q,Y,le):p.tagProperty(F,Q,le)}}L.optional=w},7014:function(ur,L,x){"use strict";Object.defineProperty(L,"__esModule",{value:!0}),L.postConstruct=void 0;var J=x(16674),E=x(6867),p=x(47738);function w(){return function(F,Q,Y){var le=new p.Metadata(E.POST_CONSTRUCT,Q);if(Reflect.hasOwnMetadata(E.POST_CONSTRUCT,F.constructor))throw new Error(J.MULTIPLE_POST_CONSTRUCT_METHODS);Reflect.defineMetadata(E.POST_CONSTRUCT,le,F.constructor)}}L.postConstruct=w},32052:function(ur,L,x){"use strict";Object.defineProperty(L,"__esModule",{value:!0}),L.tagged=void 0;var J=x(47738),E=x(99934);function p(w,F){return function(Q,Y,le){var ne=new J.Metadata(w,F);typeof le=="number"?E.tagParameter(Q,Y,le,ne):E.tagProperty(Q,Y,ne)}}L.tagged=p},55638:function(ur,L,x){"use strict";Object.defineProperty(L,"__esModule",{value:!0}),L.targetName=void 0;var J=x(6867),E=x(47738),p=x(99934);function w(F){return function(Q,Y,le){var ne=new E.Metadata(J.NAME_TAG,F);p.tagParameter(Q,Y,le,ne)}}L.targetName=w},86757:function(ur,L,x){"use strict";Object.defineProperty(L,"__esModule",{value:!0}),L.unmanaged=void 0;var J=x(6867),E=x(47738),p=x(99934);function w(){return function(F,Q,Y){var le=new E.Metadata(J.UNMANAGED_TAG,!0);p.tagParameter(F,Q,Y,le)}}L.unmanaged=w},44290:function(ur,L,x){"use strict";Object.defineProperty(L,"__esModule",{value:!0}),L.Binding=void 0;var J=x(28421),E=x(37791),p=function(){function w(F,Q){this.id=E.id(),this.activated=!1,this.serviceIdentifier=F,this.scope=Q,this.type=J.BindingTypeEnum.Invalid,this.constraint=function(Y){return!0},this.implementationType=null,this.cache=null,this.factory=null,this.provider=null,this.onActivation=null,this.dynamicValue=null}return w.prototype.clone=function(){var F=new w(this.serviceIdentifier,this.scope);return F.activated=F.scope===J.BindingScopeEnum.Singleton?this.activated:!1,F.implementationType=this.implementationType,F.dynamicValue=this.dynamicValue,F.scope=this.scope,F.type=this.type,F.factory=this.factory,F.provider=this.provider,F.constraint=this.constraint,F.onActivation=this.onActivation,F.cache=this.cache,F},w}();L.Binding=p},23184:function(ur,L){"use strict";Object.defineProperty(L,"__esModule",{value:!0}),L.BindingCount=void 0;var x={MultipleBindingsAvailable:2,NoBindingsAvailable:0,OnlyOneBindingAvailable:1};L.BindingCount=x},16674:function(ur,L){"use strict";Object.defineProperty(L,"__esModule",{value:!0}),L.STACK_OVERFLOW=L.CIRCULAR_DEPENDENCY_IN_FACTORY=L.POST_CONSTRUCT_ERROR=L.MULTIPLE_POST_CONSTRUCT_METHODS=L.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK=L.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE=L.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE=L.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT=L.ARGUMENTS_LENGTH_MISMATCH=L.INVALID_DECORATOR_OPERATION=L.INVALID_TO_SELF_VALUE=L.INVALID_FUNCTION_BINDING=L.INVALID_MIDDLEWARE_RETURN=L.NO_MORE_SNAPSHOTS_AVAILABLE=L.INVALID_BINDING_TYPE=L.NOT_IMPLEMENTED=L.CIRCULAR_DEPENDENCY=L.UNDEFINED_INJECT_ANNOTATION=L.MISSING_INJECT_ANNOTATION=L.MISSING_INJECTABLE_ANNOTATION=L.NOT_REGISTERED=L.CANNOT_UNBIND=L.AMBIGUOUS_MATCH=L.KEY_NOT_FOUND=L.NULL_ARGUMENT=L.DUPLICATED_METADATA=L.DUPLICATED_INJECTABLE_DECORATOR=void 0,L.DUPLICATED_INJECTABLE_DECORATOR="Cannot apply @injectable decorator multiple times.",L.DUPLICATED_METADATA="Metadata key was used more than once in a parameter:",L.NULL_ARGUMENT="NULL argument",L.KEY_NOT_FOUND="Key Not Found",L.AMBIGUOUS_MATCH="Ambiguous match found for serviceIdentifier:",L.CANNOT_UNBIND="Could not unbind serviceIdentifier:",L.NOT_REGISTERED="No matching bindings found for serviceIdentifier:",L.MISSING_INJECTABLE_ANNOTATION="Missing required @injectable annotation in:",L.MISSING_INJECT_ANNOTATION="Missing required @inject or @multiInject annotation in:";var x=function(w){return"@inject called with undefined this could mean that the class "+w+" has a circular dependency problem. You can use a LazyServiceIdentifer to  overcome this limitation."};L.UNDEFINED_INJECT_ANNOTATION=x,L.CIRCULAR_DEPENDENCY="Circular dependency found:",L.NOT_IMPLEMENTED="Sorry, this feature is not fully implemented yet.",L.INVALID_BINDING_TYPE="Invalid binding type:",L.NO_MORE_SNAPSHOTS_AVAILABLE="No snapshot available to restore.",L.INVALID_MIDDLEWARE_RETURN="Invalid return type in middleware. Middleware must return!",L.INVALID_FUNCTION_BINDING="Value provided to function binding must be a function!",L.INVALID_TO_SELF_VALUE="The toSelf function can only be applied when a constructor is used as service identifier",L.INVALID_DECORATOR_OPERATION="The @inject @multiInject @tagged and @named decorators must be applied to the parameters of a class constructor or a class property.";var J=function(){for(var w=[],F=0;F<arguments.length;F++)w[F]=arguments[F];return"The number of constructor arguments in the derived class "+(w[0]+" must be >= than the number of constructor arguments of its base class.")};L.ARGUMENTS_LENGTH_MISMATCH=J,L.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT="Invalid Container constructor argument. Container options must be an object.",L.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE="Invalid Container option. Default scope must be a string ('singleton' or 'transient').",L.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE="Invalid Container option. Auto bind injectable must be a boolean",L.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK="Invalid Container option. Skip base check must be a boolean",L.MULTIPLE_POST_CONSTRUCT_METHODS="Cannot apply @postConstruct decorator multiple times in the same class";var E=function(){for(var w=[],F=0;F<arguments.length;F++)w[F]=arguments[F];return"@postConstruct error in class "+w[0]+": "+w[1]};L.POST_CONSTRUCT_ERROR=E;var p=function(){for(var w=[],F=0;F<arguments.length;F++)w[F]=arguments[F];return"It looks like there is a circular dependency "+("in one of the '"+w[0]+"' bindings. Please investigate bindings with")+("service identifier '"+w[1]+"'.")};L.CIRCULAR_DEPENDENCY_IN_FACTORY=p,L.STACK_OVERFLOW="Maximum call stack size exceeded"},28421:function(ur,L){"use strict";Object.defineProperty(L,"__esModule",{value:!0}),L.TargetTypeEnum=L.BindingTypeEnum=L.BindingScopeEnum=void 0;var x={Request:"Request",Singleton:"Singleton",Transient:"Transient"};L.BindingScopeEnum=x;var J={ConstantValue:"ConstantValue",Constructor:"Constructor",DynamicValue:"DynamicValue",Factory:"Factory",Function:"Function",Instance:"Instance",Invalid:"Invalid",Provider:"Provider"};L.BindingTypeEnum=J;var E={ClassProperty:"ClassProperty",ConstructorArgument:"ConstructorArgument",Variable:"Variable"};L.TargetTypeEnum=E},6867:function(ur,L){"use strict";Object.defineProperty(L,"__esModule",{value:!0}),L.NON_CUSTOM_TAG_KEYS=L.POST_CONSTRUCT=L.DESIGN_PARAM_TYPES=L.PARAM_TYPES=L.TAGGED_PROP=L.TAGGED=L.MULTI_INJECT_TAG=L.INJECT_TAG=L.OPTIONAL_TAG=L.UNMANAGED_TAG=L.NAME_TAG=L.NAMED_TAG=void 0,L.NAMED_TAG="named",L.NAME_TAG="name",L.UNMANAGED_TAG="unmanaged",L.OPTIONAL_TAG="optional",L.INJECT_TAG="inject",L.MULTI_INJECT_TAG="multi_inject",L.TAGGED="inversify:tagged",L.TAGGED_PROP="inversify:tagged_props",L.PARAM_TYPES="inversify:paramtypes",L.DESIGN_PARAM_TYPES="design:paramtypes",L.POST_CONSTRUCT="post_construct";function x(){return[L.INJECT_TAG,L.MULTI_INJECT_TAG,L.NAME_TAG,L.UNMANAGED_TAG,L.NAMED_TAG,L.OPTIONAL_TAG]}L.NON_CUSTOM_TAG_KEYS=x()},51389:function(ur,L,x){"use strict";var J=this&&this.__awaiter||function(Lt,_t,pt,Cr){function Gt(ar){return ar instanceof pt?ar:new pt(function(gt){gt(ar)})}return new(pt||(pt=Promise))(function(ar,gt){function Ye(Ae){try{Ne(Cr.next(Ae))}catch(Be){gt(Be)}}function Et(Ae){try{Ne(Cr.throw(Ae))}catch(Be){gt(Be)}}function Ne(Ae){Ae.done?ar(Ae.value):Gt(Ae.value).then(Ye,Et)}Ne((Cr=Cr.apply(Lt,_t||[])).next())})},E=this&&this.__generator||function(Lt,_t){var pt={label:0,sent:function(){if(ar[0]&1)throw ar[1];return ar[1]},trys:[],ops:[]},Cr,Gt,ar,gt;return gt={next:Ye(0),throw:Ye(1),return:Ye(2)},typeof Symbol=="function"&&(gt[Symbol.iterator]=function(){return this}),gt;function Ye(Ne){return function(Ae){return Et([Ne,Ae])}}function Et(Ne){if(Cr)throw new TypeError("Generator is already executing.");for(;pt;)try{if(Cr=1,Gt&&(ar=Ne[0]&2?Gt.return:Ne[0]?Gt.throw||((ar=Gt.return)&&ar.call(Gt),0):Gt.next)&&!(ar=ar.call(Gt,Ne[1])).done)return ar;switch(Gt=0,ar&&(Ne=[Ne[0]&2,ar.value]),Ne[0]){case 0:case 1:ar=Ne;break;case 4:return pt.label++,{value:Ne[1],done:!1};case 5:pt.label++,Gt=Ne[1],Ne=[0];continue;case 7:Ne=pt.ops.pop(),pt.trys.pop();continue;default:if(ar=pt.trys,!(ar=ar.length>0&&ar[ar.length-1])&&(Ne[0]===6||Ne[0]===2)){pt=0;continue}if(Ne[0]===3&&(!ar||Ne[1]>ar[0]&&Ne[1]<ar[3])){pt.label=Ne[1];break}if(Ne[0]===6&&pt.label<ar[1]){pt.label=ar[1],ar=Ne;break}if(ar&&pt.label<ar[2]){pt.label=ar[2],pt.ops.push(Ne);break}ar[2]&&pt.ops.pop(),pt.trys.pop();continue}Ne=_t.call(Lt,pt)}catch(Ae){Ne=[6,Ae],Gt=0}finally{Cr=ar=0}if(Ne[0]&5)throw Ne[1];return{value:Ne[0]?Ne[1]:void 0,done:!0}}},p=this&&this.__spreadArray||function(Lt,_t){for(var pt=0,Cr=_t.length,Gt=Lt.length;pt<Cr;pt++,Gt++)Lt[Gt]=_t[pt];return Lt};Object.defineProperty(L,"__esModule",{value:!0}),L.Container=void 0;var w=x(44290),F=x(16674),Q=x(28421),Y=x(6867),le=x(51377),ne=x(86311),be=x(31927),we=x(15451),Ie=x(37791),$t=x(55800),Zt=x(85700),Xt=x(80175),Ft=function(){function Lt(_t){this._appliedMiddleware=[];var pt=_t||{};if(typeof pt!="object")throw new Error(""+F.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT);if(pt.defaultScope===void 0)pt.defaultScope=Q.BindingScopeEnum.Transient;else if(pt.defaultScope!==Q.BindingScopeEnum.Singleton&&pt.defaultScope!==Q.BindingScopeEnum.Transient&&pt.defaultScope!==Q.BindingScopeEnum.Request)throw new Error(""+F.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE);if(pt.autoBindInjectable===void 0)pt.autoBindInjectable=!1;else if(typeof pt.autoBindInjectable!="boolean")throw new Error(""+F.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE);if(pt.skipBaseClassChecks===void 0)pt.skipBaseClassChecks=!1;else if(typeof pt.skipBaseClassChecks!="boolean")throw new Error(""+F.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK);this.options={autoBindInjectable:pt.autoBindInjectable,defaultScope:pt.defaultScope,skipBaseClassChecks:pt.skipBaseClassChecks},this.id=Ie.id(),this._bindingDictionary=new Xt.Lookup,this._snapshots=[],this._middleware=null,this.parent=null,this._metadataReader=new le.MetadataReader}return Lt.merge=function(_t,pt){for(var Cr=[],Gt=2;Gt<arguments.length;Gt++)Cr[Gt-2]=arguments[Gt];var ar=new Lt,gt=p([_t,pt],Cr).map(function(Ne){return ne.getBindingDictionary(Ne)}),Ye=ne.getBindingDictionary(ar);function Et(Ne,Ae){Ne.traverse(function(Be,bt){bt.forEach(function(ir){Ae.add(ir.serviceIdentifier,ir.clone())})})}return gt.forEach(function(Ne){Et(Ne,Ye)}),ar},Lt.prototype.load=function(){for(var _t=[],pt=0;pt<arguments.length;pt++)_t[pt]=arguments[pt];for(var Cr=this._getContainerModuleHelpersFactory(),Gt=0,ar=_t;Gt<ar.length;Gt++){var gt=ar[Gt],Ye=Cr(gt.id);gt.registry(Ye.bindFunction,Ye.unbindFunction,Ye.isboundFunction,Ye.rebindFunction)}},Lt.prototype.loadAsync=function(){for(var _t=[],pt=0;pt<arguments.length;pt++)_t[pt]=arguments[pt];return J(this,void 0,void 0,function(){var Cr,Gt,ar,gt,Ye;return E(this,function(Et){switch(Et.label){case 0:Cr=this._getContainerModuleHelpersFactory(),Gt=0,ar=_t,Et.label=1;case 1:return Gt<ar.length?(gt=ar[Gt],Ye=Cr(gt.id),[4,gt.registry(Ye.bindFunction,Ye.unbindFunction,Ye.isboundFunction,Ye.rebindFunction)]):[3,4];case 2:Et.sent(),Et.label=3;case 3:return Gt++,[3,1];case 4:return[2]}})})},Lt.prototype.unload=function(){for(var _t=this,pt=[],Cr=0;Cr<arguments.length;Cr++)pt[Cr]=arguments[Cr];var Gt=function(ar){return function(gt){return gt.moduleId===ar}};pt.forEach(function(ar){var gt=Gt(ar.id);_t._bindingDictionary.removeByCondition(gt)})},Lt.prototype.bind=function(_t){var pt=this.options.defaultScope||Q.BindingScopeEnum.Transient,Cr=new w.Binding(_t,pt);return this._bindingDictionary.add(_t,Cr),new we.BindingToSyntax(Cr)},Lt.prototype.rebind=function(_t){return this.unbind(_t),this.bind(_t)},Lt.prototype.unbind=function(_t){try{this._bindingDictionary.remove(_t)}catch(pt){throw new Error(F.CANNOT_UNBIND+" "+$t.getServiceIdentifierAsString(_t))}},Lt.prototype.unbindAll=function(){this._bindingDictionary=new Xt.Lookup},Lt.prototype.isBound=function(_t){var pt=this._bindingDictionary.hasKey(_t);return!pt&&this.parent&&(pt=this.parent.isBound(_t)),pt},Lt.prototype.isBoundNamed=function(_t,pt){return this.isBoundTagged(_t,Y.NAMED_TAG,pt)},Lt.prototype.isBoundTagged=function(_t,pt,Cr){var Gt=!1;if(this._bindingDictionary.hasKey(_t)){var ar=this._bindingDictionary.get(_t),gt=ne.createMockRequest(this,_t,pt,Cr);Gt=ar.some(function(Ye){return Ye.constraint(gt)})}return!Gt&&this.parent&&(Gt=this.parent.isBoundTagged(_t,pt,Cr)),Gt},Lt.prototype.snapshot=function(){this._snapshots.push(Zt.ContainerSnapshot.of(this._bindingDictionary.clone(),this._middleware))},Lt.prototype.restore=function(){var _t=this._snapshots.pop();if(_t===void 0)throw new Error(F.NO_MORE_SNAPSHOTS_AVAILABLE);this._bindingDictionary=_t.bindings,this._middleware=_t.middleware},Lt.prototype.createChild=function(_t){var pt=new Lt(_t||this.options);return pt.parent=this,pt},Lt.prototype.applyMiddleware=function(){for(var _t=[],pt=0;pt<arguments.length;pt++)_t[pt]=arguments[pt];this._appliedMiddleware=this._appliedMiddleware.concat(_t);var Cr=this._middleware?this._middleware:this._planAndResolve();this._middleware=_t.reduce(function(Gt,ar){return ar(Gt)},Cr)},Lt.prototype.applyCustomMetadataReader=function(_t){this._metadataReader=_t},Lt.prototype.get=function(_t){return this._get(!1,!1,Q.TargetTypeEnum.Variable,_t)},Lt.prototype.getTagged=function(_t,pt,Cr){return this._get(!1,!1,Q.TargetTypeEnum.Variable,_t,pt,Cr)},Lt.prototype.getNamed=function(_t,pt){return this.getTagged(_t,Y.NAMED_TAG,pt)},Lt.prototype.getAll=function(_t){return this._get(!0,!0,Q.TargetTypeEnum.Variable,_t)},Lt.prototype.getAllTagged=function(_t,pt,Cr){return this._get(!1,!0,Q.TargetTypeEnum.Variable,_t,pt,Cr)},Lt.prototype.getAllNamed=function(_t,pt){return this.getAllTagged(_t,Y.NAMED_TAG,pt)},Lt.prototype.resolve=function(_t){var pt=this.createChild();return pt.bind(_t).toSelf(),this._appliedMiddleware.forEach(function(Cr){pt.applyMiddleware(Cr)}),pt.get(_t)},Lt.prototype._getContainerModuleHelpersFactory=function(){var _t=this,pt=function(Ye,Et){Ye._binding.moduleId=Et},Cr=function(Ye){return function(Et){var Ne=_t.bind.bind(_t),Ae=Ne(Et);return pt(Ae,Ye),Ae}},Gt=function(Ye){return function(Et){var Ne=_t.unbind.bind(_t);Ne(Et)}},ar=function(Ye){return function(Et){var Ne=_t.isBound.bind(_t);return Ne(Et)}},gt=function(Ye){return function(Et){var Ne=_t.rebind.bind(_t),Ae=Ne(Et);return pt(Ae,Ye),Ae}};return function(Ye){return{bindFunction:Cr(Ye),isboundFunction:ar(Ye),rebindFunction:gt(Ye),unbindFunction:Gt(Ye)}}},Lt.prototype._get=function(_t,pt,Cr,Gt,ar,gt){var Ye=null,Et={avoidConstraints:_t,contextInterceptor:function(Ne){return Ne},isMultiInject:pt,key:ar,serviceIdentifier:Gt,targetType:Cr,value:gt};if(this._middleware){if(Ye=this._middleware(Et),Ye==null)throw new Error(F.INVALID_MIDDLEWARE_RETURN)}else Ye=this._planAndResolve()(Et);return Ye},Lt.prototype._planAndResolve=function(){var _t=this;return function(pt){var Cr=ne.plan(_t._metadataReader,_t,pt.isMultiInject,pt.targetType,pt.serviceIdentifier,pt.key,pt.value,pt.avoidConstraints);Cr=pt.contextInterceptor(Cr);var Gt=be.resolve(Cr);return Gt}},Lt}();L.Container=Ft},33244:function(ur,L,x){"use strict";Object.defineProperty(L,"__esModule",{value:!0}),L.AsyncContainerModule=L.ContainerModule=void 0;var J=x(37791),E=function(){function w(F){this.id=J.id(),this.registry=F}return w}();L.ContainerModule=E;var p=function(){function w(F){this.id=J.id(),this.registry=F}return w}();L.AsyncContainerModule=p},85700:function(ur,L){"use strict";Object.defineProperty(L,"__esModule",{value:!0}),L.ContainerSnapshot=void 0;var x=function(){function J(){}return J.of=function(E,p){var w=new J;return w.bindings=E,w.middleware=p,w},J}();L.ContainerSnapshot=x},80175:function(ur,L,x){"use strict";Object.defineProperty(L,"__esModule",{value:!0}),L.Lookup=void 0;var J=x(16674),E=function(){function p(){this._map=new Map}return p.prototype.getMap=function(){return this._map},p.prototype.add=function(w,F){if(w==null)throw new Error(J.NULL_ARGUMENT);if(F==null)throw new Error(J.NULL_ARGUMENT);var Q=this._map.get(w);Q!==void 0?(Q.push(F),this._map.set(w,Q)):this._map.set(w,[F])},p.prototype.get=function(w){if(w==null)throw new Error(J.NULL_ARGUMENT);var F=this._map.get(w);if(F!==void 0)return F;throw new Error(J.KEY_NOT_FOUND)},p.prototype.remove=function(w){if(w==null)throw new Error(J.NULL_ARGUMENT);if(!this._map.delete(w))throw new Error(J.KEY_NOT_FOUND)},p.prototype.removeByCondition=function(w){var F=this;this._map.forEach(function(Q,Y){var le=Q.filter(function(ne){return!w(ne)});le.length>0?F._map.set(Y,le):F._map.delete(Y)})},p.prototype.hasKey=function(w){if(w==null)throw new Error(J.NULL_ARGUMENT);return this._map.has(w)},p.prototype.clone=function(){var w=new p;return this._map.forEach(function(F,Q){F.forEach(function(Y){return w.add(Q,Y.clone())})}),w},p.prototype.traverse=function(w){this._map.forEach(function(F,Q){w(Q,F)})},p}();L.Lookup=E},86700:function(ur,L,x){"use strict";var J;J={value:!0},J=J=J=J=J=J=L.GW=J=J=L.zY=J=J=J=J=J=L.f3=J=J=L.b2=J=J=J=J=J=L.W2=J=void 0;var E=x(6867);J=E;var p=x(51389);Object.defineProperty(L,"W2",{enumerable:!0,get:function(){return p.Container}});var w=x(28421);J={enumerable:!0,get:function(){return w.BindingScopeEnum}},J={enumerable:!0,get:function(){return w.BindingTypeEnum}},J={enumerable:!0,get:function(){return w.TargetTypeEnum}};var F=x(33244);J={enumerable:!0,get:function(){return F.AsyncContainerModule}},J={enumerable:!0,get:function(){return F.ContainerModule}};var Q=x(64315);Object.defineProperty(L,"b2",{enumerable:!0,get:function(){return Q.injectable}});var Y=x(32052);J={enumerable:!0,get:function(){return Y.tagged}};var le=x(38085);J={enumerable:!0,get:function(){return le.named}};var ne=x(5744);Object.defineProperty(L,"f3",{enumerable:!0,get:function(){return ne.inject}}),J={enumerable:!0,get:function(){return ne.LazyServiceIdentifer}};var be=x(6515);J={enumerable:!0,get:function(){return be.optional}};var we=x(86757);J={enumerable:!0,get:function(){return we.unmanaged}};var Ie=x(71693);J={enumerable:!0,get:function(){return Ie.multiInject}};var $t=x(55638);J={enumerable:!0,get:function(){return $t.targetName}};var Zt=x(7014);Object.defineProperty(L,"zY",{enumerable:!0,get:function(){return Zt.postConstruct}});var Xt=x(51377);J={enumerable:!0,get:function(){return Xt.MetadataReader}};var Ft=x(37791);J={enumerable:!0,get:function(){return Ft.id}};var Lt=x(99934);Object.defineProperty(L,"GW",{enumerable:!0,get:function(){return Lt.decorate}});var _t=x(80758);J={enumerable:!0,get:function(){return _t.traverseAncerstors}},J={enumerable:!0,get:function(){return _t.taggedConstraint}},J={enumerable:!0,get:function(){return _t.namedConstraint}},J={enumerable:!0,get:function(){return _t.typeConstraint}};var pt=x(55800);J={enumerable:!0,get:function(){return pt.getServiceIdentifierAsString}};var Cr=x(70600);J={enumerable:!0,get:function(){return Cr.multiBindToService}}},95228:function(ur,L,x){"use strict";Object.defineProperty(L,"__esModule",{value:!0}),L.Context=void 0;var J=x(37791),E=function(){function p(w){this.id=J.id(),this.container=w}return p.prototype.addPlan=function(w){this.plan=w},p.prototype.setCurrentRequest=function(w){this.currentRequest=w},p}();L.Context=E},47738:function(ur,L,x){"use strict";Object.defineProperty(L,"__esModule",{value:!0}),L.Metadata=void 0;var J=x(6867),E=function(){function p(w,F){this.key=w,this.value=F}return p.prototype.toString=function(){return this.key===J.NAMED_TAG?"named: "+this.value.toString()+" ":"tagged: { key:"+this.key.toString()+", value: "+this.value+" }"},p}();L.Metadata=E},51377:function(ur,L,x){"use strict";Object.defineProperty(L,"__esModule",{value:!0}),L.MetadataReader=void 0;var J=x(6867),E=function(){function p(){}return p.prototype.getConstructorMetadata=function(w){var F=Reflect.getMetadata(J.PARAM_TYPES,w),Q=Reflect.getMetadata(J.TAGGED,w);return{compilerGeneratedMetadata:F,userGeneratedMetadata:Q||{}}},p.prototype.getPropertiesMetadata=function(w){var F=Reflect.getMetadata(J.TAGGED_PROP,w)||[];return F},p}();L.MetadataReader=E},55314:function(ur,L){"use strict";Object.defineProperty(L,"__esModule",{value:!0}),L.Plan=void 0;var x=function(){function J(E,p){this.parentContext=E,this.rootRequest=p}return J}();L.Plan=x},86311:function(ur,L,x){"use strict";Object.defineProperty(L,"__esModule",{value:!0}),L.getBindingDictionary=L.createMockRequest=L.plan=void 0;var J=x(23184),E=x(16674),p=x(28421),w=x(6867),F=x(85265),Q=x(55800),Y=x(95228),le=x(47738),ne=x(55314),be=x(6e3),we=x(6748),Ie=x(18924);function $t(Gt){return Gt._bindingDictionary}L.getBindingDictionary=$t;function Zt(Gt,ar,gt,Ye,Et,Ne){var Ae=Gt?w.MULTI_INJECT_TAG:w.INJECT_TAG,Be=new le.Metadata(Ae,gt),bt=new Ie.Target(ar,Ye,gt,Be);if(Et!==void 0){var ir=new le.Metadata(Et,Ne);bt.metadata.push(ir)}return bt}function Xt(Gt,ar,gt,Ye,Et){var Ne=_t(gt.container,Et.serviceIdentifier),Ae=[];return Ne.length===J.BindingCount.NoBindingsAvailable&&gt.container.options.autoBindInjectable&&typeof Et.serviceIdentifier=="function"&&Gt.getConstructorMetadata(Et.serviceIdentifier).compilerGeneratedMetadata&&(gt.container.bind(Et.serviceIdentifier).toSelf(),Ne=_t(gt.container,Et.serviceIdentifier)),ar?Ae=Ne:Ae=Ne.filter(function(Be){var bt=new we.Request(Be.serviceIdentifier,gt,Ye,Be,Et);return Be.constraint(bt)}),Ft(Et.serviceIdentifier,Ae,Et,gt.container),Ae}function Ft(Gt,ar,gt,Ye){switch(ar.length){case J.BindingCount.NoBindingsAvailable:if(gt.isOptional())return ar;var Et=Q.getServiceIdentifierAsString(Gt),Ne=E.NOT_REGISTERED;throw Ne+=Q.listMetadataForTarget(Et,gt),Ne+=Q.listRegisteredBindingsForServiceIdentifier(Ye,Et,_t),new Error(Ne);case J.BindingCount.OnlyOneBindingAvailable:if(!gt.isArray())return ar;case J.BindingCount.MultipleBindingsAvailable:default:if(gt.isArray())return ar;var Et=Q.getServiceIdentifierAsString(Gt),Ne=E.AMBIGUOUS_MATCH+" "+Et;throw Ne+=Q.listRegisteredBindingsForServiceIdentifier(Ye,Et,_t),new Error(Ne)}}function Lt(Gt,ar,gt,Ye,Et,Ne){var Ae,Be;if(Et===null){Ae=Xt(Gt,ar,Ye,null,Ne),Be=new we.Request(gt,Ye,null,Ae,Ne);var bt=new ne.Plan(Ye,Be);Ye.addPlan(bt)}else Ae=Xt(Gt,ar,Ye,Et,Ne),Be=Et.addChildRequest(Ne.serviceIdentifier,Ae,Ne);Ae.forEach(function(ir){var re=null;if(Ne.isArray())re=Be.addChildRequest(ir.serviceIdentifier,ir,Ne);else{if(ir.cache)return;re=Be}if(ir.type===p.BindingTypeEnum.Instance&&ir.implementationType!==null){var Ee=be.getDependencies(Gt,ir.implementationType);if(!Ye.container.options.skipBaseClassChecks){var ae=be.getBaseClassDependencyCount(Gt,ir.implementationType);if(Ee.length<ae){var me=E.ARGUMENTS_LENGTH_MISMATCH(be.getFunctionName(ir.implementationType));throw new Error(me)}}Ee.forEach(function(Te){Lt(Gt,!1,Te.serviceIdentifier,Ye,re,Te)})}})}function _t(Gt,ar){var gt=[],Ye=$t(Gt);return Ye.hasKey(ar)?gt=Ye.get(ar):Gt.parent!==null&&(gt=_t(Gt.parent,ar)),gt}function pt(Gt,ar,gt,Ye,Et,Ne,Ae,Be){Be===void 0&&(Be=!1);var bt=new Y.Context(ar),ir=Zt(gt,Ye,Et,"",Ne,Ae);try{return Lt(Gt,Be,Et,bt,null,ir),bt}catch(re){throw F.isStackOverflowExeption(re)&&bt.plan&&Q.circularDependencyToException(bt.plan.rootRequest),re}}L.plan=pt;function Cr(Gt,ar,gt,Ye){var Et=new Ie.Target(p.TargetTypeEnum.Variable,"",ar,new le.Metadata(gt,Ye)),Ne=new Y.Context(Gt),Ae=new we.Request(ar,Ne,null,[],Et);return Ae}L.createMockRequest=Cr},88460:function(ur,L){"use strict";Object.defineProperty(L,"__esModule",{value:!0}),L.QueryableString=void 0;var x=function(){function J(E){this.str=E}return J.prototype.startsWith=function(E){return this.str.indexOf(E)===0},J.prototype.endsWith=function(E){var p="",w=E.split("").reverse().join("");return p=this.str.split("").reverse().join(""),this.startsWith.call({str:p},w)},J.prototype.contains=function(E){return this.str.indexOf(E)!==-1},J.prototype.equals=function(E){return this.str===E},J.prototype.value=function(){return this.str},J}();L.QueryableString=x},6e3:function(ur,L,x){"use strict";var J=this&&this.__spreadArray||function(Xt,Ft){for(var Lt=0,_t=Ft.length,pt=Xt.length;Lt<_t;Lt++,pt++)Xt[pt]=Ft[Lt];return Xt};Object.defineProperty(L,"__esModule",{value:!0}),L.getFunctionName=L.getBaseClassDependencyCount=L.getDependencies=void 0;var E=x(5744),p=x(16674),w=x(28421),F=x(6867),Q=x(55800);Object.defineProperty(L,"getFunctionName",{enumerable:!0,get:function(){return Q.getFunctionName}});var Y=x(18924);function le(Xt,Ft){var Lt=Q.getFunctionName(Ft),_t=ne(Xt,Lt,Ft,!1);return _t}L.getDependencies=le;function ne(Xt,Ft,Lt,_t){var pt=Xt.getConstructorMetadata(Lt),Cr=pt.compilerGeneratedMetadata;if(Cr===void 0){var Gt=p.MISSING_INJECTABLE_ANNOTATION+" "+Ft+".";throw new Error(Gt)}var ar=pt.userGeneratedMetadata,gt=Object.keys(ar),Ye=Lt.length===0&&gt.length>0,Et=gt.length>Lt.length,Ne=Ye||Et?gt.length:Lt.length,Ae=we(_t,Ft,Cr,ar,Ne),Be=Ie(Xt,Lt),bt=J(J([],Ae),Be);return bt}function be(Xt,Ft,Lt,_t,pt){var Cr=pt[Xt.toString()]||[],Gt=Zt(Cr),ar=Gt.unmanaged!==!0,gt=_t[Xt],Ye=Gt.inject||Gt.multiInject;if(gt=Ye||gt,gt instanceof E.LazyServiceIdentifer&&(gt=gt.unwrap()),ar){var Et=gt===Object,Ne=gt===Function,Ae=gt===void 0,Be=Et||Ne||Ae;if(!Ft&&Be){var bt=p.MISSING_INJECT_ANNOTATION+" argument "+Xt+" in class "+Lt+".";throw new Error(bt)}var ir=new Y.Target(w.TargetTypeEnum.ConstructorArgument,Gt.targetName,gt);return ir.metadata=Cr,ir}return null}function we(Xt,Ft,Lt,_t,pt){for(var Cr=[],Gt=0;Gt<pt;Gt++){var ar=Gt,gt=be(ar,Xt,Ft,Lt,_t);gt!==null&&Cr.push(gt)}return Cr}function Ie(Xt,Ft){for(var Lt=Xt.getPropertiesMetadata(Ft),_t=[],pt=Object.keys(Lt),Cr=0,Gt=pt;Cr<Gt.length;Cr++){var ar=Gt[Cr],gt=Lt[ar],Ye=Zt(Lt[ar]),Et=Ye.targetName||ar,Ne=Ye.inject||Ye.multiInject,Ae=new Y.Target(w.TargetTypeEnum.ClassProperty,Et,Ne);Ae.metadata=gt,_t.push(Ae)}var Be=Object.getPrototypeOf(Ft.prototype).constructor;if(Be!==Object){var bt=Ie(Xt,Be);_t=J(J([],_t),bt)}return _t}function $t(Xt,Ft){var Lt=Object.getPrototypeOf(Ft.prototype).constructor;if(Lt!==Object){var _t=Q.getFunctionName(Lt),pt=ne(Xt,_t,Lt,!0),Cr=pt.map(function(gt){return gt.metadata.filter(function(Ye){return Ye.key===F.UNMANAGED_TAG})}),Gt=[].concat.apply([],Cr).length,ar=pt.length-Gt;return ar>0?ar:$t(Xt,Lt)}else return 0}L.getBaseClassDependencyCount=$t;function Zt(Xt){var Ft={};return Xt.forEach(function(Lt){Ft[Lt.key.toString()]=Lt.value}),{inject:Ft[F.INJECT_TAG],multiInject:Ft[F.MULTI_INJECT_TAG],targetName:Ft[F.NAME_TAG],unmanaged:Ft[F.UNMANAGED_TAG]}}},6748:function(ur,L,x){"use strict";Object.defineProperty(L,"__esModule",{value:!0}),L.Request=void 0;var J=x(37791),E=function(){function p(w,F,Q,Y,le){this.id=J.id(),this.serviceIdentifier=w,this.parentContext=F,this.parentRequest=Q,this.target=le,this.childRequests=[],this.bindings=Array.isArray(Y)?Y:[Y],this.requestScope=Q===null?new Map:null}return p.prototype.addChildRequest=function(w,F,Q){var Y=new p(w,this.parentContext,this,F,Q);return this.childRequests.push(Y),Y},p}();L.Request=E},18924:function(ur,L,x){"use strict";Object.defineProperty(L,"__esModule",{value:!0}),L.Target=void 0;var J=x(6867),E=x(37791),p=x(47738),w=x(88460),F=function(){function Q(Y,le,ne,be){this.id=E.id(),this.type=Y,this.serviceIdentifier=ne,this.name=new w.QueryableString(le||""),this.metadata=new Array;var we=null;typeof be=="string"?we=new p.Metadata(J.NAMED_TAG,be):be instanceof p.Metadata&&(we=be),we!==null&&this.metadata.push(we)}return Q.prototype.hasTag=function(Y){for(var le=0,ne=this.metadata;le<ne.length;le++){var be=ne[le];if(be.key===Y)return!0}return!1},Q.prototype.isArray=function(){return this.hasTag(J.MULTI_INJECT_TAG)},Q.prototype.matchesArray=function(Y){return this.matchesTag(J.MULTI_INJECT_TAG)(Y)},Q.prototype.isNamed=function(){return this.hasTag(J.NAMED_TAG)},Q.prototype.isTagged=function(){return this.metadata.some(function(Y){return J.NON_CUSTOM_TAG_KEYS.every(function(le){return Y.key!==le})})},Q.prototype.isOptional=function(){return this.matchesTag(J.OPTIONAL_TAG)(!0)},Q.prototype.getNamedTag=function(){return this.isNamed()?this.metadata.filter(function(Y){return Y.key===J.NAMED_TAG})[0]:null},Q.prototype.getCustomTags=function(){return this.isTagged()?this.metadata.filter(function(Y){return J.NON_CUSTOM_TAG_KEYS.every(function(le){return Y.key!==le})}):null},Q.prototype.matchesNamedTag=function(Y){return this.matchesTag(J.NAMED_TAG)(Y)},Q.prototype.matchesTag=function(Y){var le=this;return function(ne){for(var be=0,we=le.metadata;be<we.length;be++){var Ie=we[be];if(Ie.key===Y&&Ie.value===ne)return!0}return!1}},Q}();L.Target=F},52279:function(ur,L,x){"use strict";var J=this&&this.__spreadArray||function(ne,be){for(var we=0,Ie=be.length,$t=ne.length;we<Ie;we++,$t++)ne[$t]=be[we];return ne};Object.defineProperty(L,"__esModule",{value:!0}),L.resolveInstance=void 0;var E=x(16674),p=x(28421),w=x(6867);function F(ne,be,we){var Ie=be.filter(function(Zt){return Zt.target!==null&&Zt.target.type===p.TargetTypeEnum.ClassProperty}),$t=Ie.map(we);return Ie.forEach(function(Zt,Xt){var Ft="";Ft=Zt.target.name.value();var Lt=$t[Xt];ne[Ft]=Lt}),ne}function Q(ne,be){return new(ne.bind.apply(ne,J([void 0],be)))}function Y(ne,be){if(Reflect.hasMetadata(w.POST_CONSTRUCT,ne)){var we=Reflect.getMetadata(w.POST_CONSTRUCT,ne);try{be[we.value]()}catch(Ie){throw new Error(E.POST_CONSTRUCT_ERROR(ne.name,Ie.message))}}}function le(ne,be,we){var Ie=null;if(be.length>0){var $t=be.filter(function(Xt){return Xt.target!==null&&Xt.target.type===p.TargetTypeEnum.ConstructorArgument}),Zt=$t.map(we);Ie=Q(ne,Zt),Ie=F(Ie,be,we)}else Ie=new ne;return Y(ne,Ie),Ie}L.resolveInstance=le},31927:function(ur,L,x){"use strict";Object.defineProperty(L,"__esModule",{value:!0}),L.resolve=void 0;var J=x(16674),E=x(28421),p=x(85265),w=x(55800),F=x(52279),Q=function(ne,be,we){try{return we()}catch(Ie){throw p.isStackOverflowExeption(Ie)?new Error(J.CIRCULAR_DEPENDENCY_IN_FACTORY(ne,be.toString())):Ie}},Y=function(ne){return function(be){be.parentContext.setCurrentRequest(be);var we=be.bindings,Ie=be.childRequests,$t=be.target&&be.target.isArray(),Zt=!be.parentRequest||!be.parentRequest.target||!be.target||!be.parentRequest.target.matchesArray(be.target.serviceIdentifier);if($t&&Zt)return Ie.map(function(Cr){var Gt=Y(ne);return Gt(Cr)});var Xt=null;if(be.target.isOptional()&&we.length===0)return;var Ft=we[0],Lt=Ft.scope===E.BindingScopeEnum.Singleton,_t=Ft.scope===E.BindingScopeEnum.Request;if(Lt&&Ft.activated)return Ft.cache;if(_t&&ne!==null&&ne.has(Ft.id))return ne.get(Ft.id);if(Ft.type===E.BindingTypeEnum.ConstantValue)Xt=Ft.cache,Ft.activated=!0;else if(Ft.type===E.BindingTypeEnum.Function)Xt=Ft.cache,Ft.activated=!0;else if(Ft.type===E.BindingTypeEnum.Constructor)Xt=Ft.implementationType;else if(Ft.type===E.BindingTypeEnum.DynamicValue&&Ft.dynamicValue!==null)Xt=Q("toDynamicValue",Ft.serviceIdentifier,function(){return Ft.dynamicValue(be.parentContext)});else if(Ft.type===E.BindingTypeEnum.Factory&&Ft.factory!==null)Xt=Q("toFactory",Ft.serviceIdentifier,function(){return Ft.factory(be.parentContext)});else if(Ft.type===E.BindingTypeEnum.Provider&&Ft.provider!==null)Xt=Q("toProvider",Ft.serviceIdentifier,function(){return Ft.provider(be.parentContext)});else if(Ft.type===E.BindingTypeEnum.Instance&&Ft.implementationType!==null)Xt=F.resolveInstance(Ft.implementationType,Ie,Y(ne));else{var pt=w.getServiceIdentifierAsString(be.serviceIdentifier);throw new Error(J.INVALID_BINDING_TYPE+" "+pt)}return typeof Ft.onActivation=="function"&&(Xt=Ft.onActivation(be.parentContext,Xt)),Lt&&(Ft.cache=Xt,Ft.activated=!0),_t&&ne!==null&&!ne.has(Ft.id)&&ne.set(Ft.id,Xt),Xt}};function le(ne){var be=Y(ne.plan.rootRequest.requestScope);return be(ne.plan.rootRequest)}L.resolve=le},83366:function(ur,L,x){"use strict";Object.defineProperty(L,"__esModule",{value:!0}),L.BindingInSyntax=void 0;var J=x(28421),E=x(71325),p=function(){function w(F){this._binding=F}return w.prototype.inRequestScope=function(){return this._binding.scope=J.BindingScopeEnum.Request,new E.BindingWhenOnSyntax(this._binding)},w.prototype.inSingletonScope=function(){return this._binding.scope=J.BindingScopeEnum.Singleton,new E.BindingWhenOnSyntax(this._binding)},w.prototype.inTransientScope=function(){return this._binding.scope=J.BindingScopeEnum.Transient,new E.BindingWhenOnSyntax(this._binding)},w}();L.BindingInSyntax=p},74889:function(ur,L,x){"use strict";Object.defineProperty(L,"__esModule",{value:!0}),L.BindingInWhenOnSyntax=void 0;var J=x(83366),E=x(51811),p=x(98370),w=function(){function F(Q){this._binding=Q,this._bindingWhenSyntax=new p.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new E.BindingOnSyntax(this._binding),this._bindingInSyntax=new J.BindingInSyntax(Q)}return F.prototype.inRequestScope=function(){return this._bindingInSyntax.inRequestScope()},F.prototype.inSingletonScope=function(){return this._bindingInSyntax.inSingletonScope()},F.prototype.inTransientScope=function(){return this._bindingInSyntax.inTransientScope()},F.prototype.when=function(Q){return this._bindingWhenSyntax.when(Q)},F.prototype.whenTargetNamed=function(Q){return this._bindingWhenSyntax.whenTargetNamed(Q)},F.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},F.prototype.whenTargetTagged=function(Q,Y){return this._bindingWhenSyntax.whenTargetTagged(Q,Y)},F.prototype.whenInjectedInto=function(Q){return this._bindingWhenSyntax.whenInjectedInto(Q)},F.prototype.whenParentNamed=function(Q){return this._bindingWhenSyntax.whenParentNamed(Q)},F.prototype.whenParentTagged=function(Q,Y){return this._bindingWhenSyntax.whenParentTagged(Q,Y)},F.prototype.whenAnyAncestorIs=function(Q){return this._bindingWhenSyntax.whenAnyAncestorIs(Q)},F.prototype.whenNoAncestorIs=function(Q){return this._bindingWhenSyntax.whenNoAncestorIs(Q)},F.prototype.whenAnyAncestorNamed=function(Q){return this._bindingWhenSyntax.whenAnyAncestorNamed(Q)},F.prototype.whenAnyAncestorTagged=function(Q,Y){return this._bindingWhenSyntax.whenAnyAncestorTagged(Q,Y)},F.prototype.whenNoAncestorNamed=function(Q){return this._bindingWhenSyntax.whenNoAncestorNamed(Q)},F.prototype.whenNoAncestorTagged=function(Q,Y){return this._bindingWhenSyntax.whenNoAncestorTagged(Q,Y)},F.prototype.whenAnyAncestorMatches=function(Q){return this._bindingWhenSyntax.whenAnyAncestorMatches(Q)},F.prototype.whenNoAncestorMatches=function(Q){return this._bindingWhenSyntax.whenNoAncestorMatches(Q)},F.prototype.onActivation=function(Q){return this._bindingOnSyntax.onActivation(Q)},F}();L.BindingInWhenOnSyntax=w},51811:function(ur,L,x){"use strict";Object.defineProperty(L,"__esModule",{value:!0}),L.BindingOnSyntax=void 0;var J=x(98370),E=function(){function p(w){this._binding=w}return p.prototype.onActivation=function(w){return this._binding.onActivation=w,new J.BindingWhenSyntax(this._binding)},p}();L.BindingOnSyntax=E},15451:function(ur,L,x){"use strict";Object.defineProperty(L,"__esModule",{value:!0}),L.BindingToSyntax=void 0;var J=x(16674),E=x(28421),p=x(74889),w=x(71325),F=function(){function Q(Y){this._binding=Y}return Q.prototype.to=function(Y){return this._binding.type=E.BindingTypeEnum.Instance,this._binding.implementationType=Y,new p.BindingInWhenOnSyntax(this._binding)},Q.prototype.toSelf=function(){if(typeof this._binding.serviceIdentifier!="function")throw new Error(""+J.INVALID_TO_SELF_VALUE);var Y=this._binding.serviceIdentifier;return this.to(Y)},Q.prototype.toConstantValue=function(Y){return this._binding.type=E.BindingTypeEnum.ConstantValue,this._binding.cache=Y,this._binding.dynamicValue=null,this._binding.implementationType=null,this._binding.scope=E.BindingScopeEnum.Singleton,new w.BindingWhenOnSyntax(this._binding)},Q.prototype.toDynamicValue=function(Y){return this._binding.type=E.BindingTypeEnum.DynamicValue,this._binding.cache=null,this._binding.dynamicValue=Y,this._binding.implementationType=null,new p.BindingInWhenOnSyntax(this._binding)},Q.prototype.toConstructor=function(Y){return this._binding.type=E.BindingTypeEnum.Constructor,this._binding.implementationType=Y,this._binding.scope=E.BindingScopeEnum.Singleton,new w.BindingWhenOnSyntax(this._binding)},Q.prototype.toFactory=function(Y){return this._binding.type=E.BindingTypeEnum.Factory,this._binding.factory=Y,this._binding.scope=E.BindingScopeEnum.Singleton,new w.BindingWhenOnSyntax(this._binding)},Q.prototype.toFunction=function(Y){if(typeof Y!="function")throw new Error(J.INVALID_FUNCTION_BINDING);var le=this.toConstantValue(Y);return this._binding.type=E.BindingTypeEnum.Function,this._binding.scope=E.BindingScopeEnum.Singleton,le},Q.prototype.toAutoFactory=function(Y){return this._binding.type=E.BindingTypeEnum.Factory,this._binding.factory=function(le){var ne=function(){return le.container.get(Y)};return ne},this._binding.scope=E.BindingScopeEnum.Singleton,new w.BindingWhenOnSyntax(this._binding)},Q.prototype.toProvider=function(Y){return this._binding.type=E.BindingTypeEnum.Provider,this._binding.provider=Y,this._binding.scope=E.BindingScopeEnum.Singleton,new w.BindingWhenOnSyntax(this._binding)},Q.prototype.toService=function(Y){this.toDynamicValue(function(le){return le.container.get(Y)})},Q}();L.BindingToSyntax=F},71325:function(ur,L,x){"use strict";Object.defineProperty(L,"__esModule",{value:!0}),L.BindingWhenOnSyntax=void 0;var J=x(51811),E=x(98370),p=function(){function w(F){this._binding=F,this._bindingWhenSyntax=new E.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new J.BindingOnSyntax(this._binding)}return w.prototype.when=function(F){return this._bindingWhenSyntax.when(F)},w.prototype.whenTargetNamed=function(F){return this._bindingWhenSyntax.whenTargetNamed(F)},w.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},w.prototype.whenTargetTagged=function(F,Q){return this._bindingWhenSyntax.whenTargetTagged(F,Q)},w.prototype.whenInjectedInto=function(F){return this._bindingWhenSyntax.whenInjectedInto(F)},w.prototype.whenParentNamed=function(F){return this._bindingWhenSyntax.whenParentNamed(F)},w.prototype.whenParentTagged=function(F,Q){return this._bindingWhenSyntax.whenParentTagged(F,Q)},w.prototype.whenAnyAncestorIs=function(F){return this._bindingWhenSyntax.whenAnyAncestorIs(F)},w.prototype.whenNoAncestorIs=function(F){return this._bindingWhenSyntax.whenNoAncestorIs(F)},w.prototype.whenAnyAncestorNamed=function(F){return this._bindingWhenSyntax.whenAnyAncestorNamed(F)},w.prototype.whenAnyAncestorTagged=function(F,Q){return this._bindingWhenSyntax.whenAnyAncestorTagged(F,Q)},w.prototype.whenNoAncestorNamed=function(F){return this._bindingWhenSyntax.whenNoAncestorNamed(F)},w.prototype.whenNoAncestorTagged=function(F,Q){return this._bindingWhenSyntax.whenNoAncestorTagged(F,Q)},w.prototype.whenAnyAncestorMatches=function(F){return this._bindingWhenSyntax.whenAnyAncestorMatches(F)},w.prototype.whenNoAncestorMatches=function(F){return this._bindingWhenSyntax.whenNoAncestorMatches(F)},w.prototype.onActivation=function(F){return this._bindingOnSyntax.onActivation(F)},w}();L.BindingWhenOnSyntax=p},98370:function(ur,L,x){"use strict";Object.defineProperty(L,"__esModule",{value:!0}),L.BindingWhenSyntax=void 0;var J=x(51811),E=x(80758),p=function(){function w(F){this._binding=F}return w.prototype.when=function(F){return this._binding.constraint=F,new J.BindingOnSyntax(this._binding)},w.prototype.whenTargetNamed=function(F){return this._binding.constraint=E.namedConstraint(F),new J.BindingOnSyntax(this._binding)},w.prototype.whenTargetIsDefault=function(){return this._binding.constraint=function(F){var Q=F.target!==null&&!F.target.isNamed()&&!F.target.isTagged();return Q},new J.BindingOnSyntax(this._binding)},w.prototype.whenTargetTagged=function(F,Q){return this._binding.constraint=E.taggedConstraint(F)(Q),new J.BindingOnSyntax(this._binding)},w.prototype.whenInjectedInto=function(F){return this._binding.constraint=function(Q){return E.typeConstraint(F)(Q.parentRequest)},new J.BindingOnSyntax(this._binding)},w.prototype.whenParentNamed=function(F){return this._binding.constraint=function(Q){return E.namedConstraint(F)(Q.parentRequest)},new J.BindingOnSyntax(this._binding)},w.prototype.whenParentTagged=function(F,Q){return this._binding.constraint=function(Y){return E.taggedConstraint(F)(Q)(Y.parentRequest)},new J.BindingOnSyntax(this._binding)},w.prototype.whenAnyAncestorIs=function(F){return this._binding.constraint=function(Q){return E.traverseAncerstors(Q,E.typeConstraint(F))},new J.BindingOnSyntax(this._binding)},w.prototype.whenNoAncestorIs=function(F){return this._binding.constraint=function(Q){return!E.traverseAncerstors(Q,E.typeConstraint(F))},new J.BindingOnSyntax(this._binding)},w.prototype.whenAnyAncestorNamed=function(F){return this._binding.constraint=function(Q){return E.traverseAncerstors(Q,E.namedConstraint(F))},new J.BindingOnSyntax(this._binding)},w.prototype.whenNoAncestorNamed=function(F){return this._binding.constraint=function(Q){return!E.traverseAncerstors(Q,E.namedConstraint(F))},new J.BindingOnSyntax(this._binding)},w.prototype.whenAnyAncestorTagged=function(F,Q){return this._binding.constraint=function(Y){return E.traverseAncerstors(Y,E.taggedConstraint(F)(Q))},new J.BindingOnSyntax(this._binding)},w.prototype.whenNoAncestorTagged=function(F,Q){return this._binding.constraint=function(Y){return!E.traverseAncerstors(Y,E.taggedConstraint(F)(Q))},new J.BindingOnSyntax(this._binding)},w.prototype.whenAnyAncestorMatches=function(F){return this._binding.constraint=function(Q){return E.traverseAncerstors(Q,F)},new J.BindingOnSyntax(this._binding)},w.prototype.whenNoAncestorMatches=function(F){return this._binding.constraint=function(Q){return!E.traverseAncerstors(Q,F)},new J.BindingOnSyntax(this._binding)},w}();L.BindingWhenSyntax=p},80758:function(ur,L,x){"use strict";Object.defineProperty(L,"__esModule",{value:!0}),L.typeConstraint=L.namedConstraint=L.taggedConstraint=L.traverseAncerstors=void 0;var J=x(6867),E=x(47738),p=function(Y,le){var ne=Y.parentRequest;return ne!==null?le(ne)?!0:p(ne,le):!1};L.traverseAncerstors=p;var w=function(Y){return function(le){var ne=function(be){return be!==null&&be.target!==null&&be.target.matchesTag(Y)(le)};return ne.metaData=new E.Metadata(Y,le),ne}};L.taggedConstraint=w;var F=w(J.NAMED_TAG);L.namedConstraint=F;var Q=function(Y){return function(le){var ne=null;if(le!==null)if(ne=le.bindings[0],typeof Y=="string"){var be=ne.serviceIdentifier;return be===Y}else{var we=le.bindings[0].implementationType;return Y===we}return!1}};L.typeConstraint=Q},70600:function(ur,L){"use strict";Object.defineProperty(L,"__esModule",{value:!0}),L.multiBindToService=void 0;var x=function(J){return function(E){return function(){for(var p=[],w=0;w<arguments.length;w++)p[w]=arguments[w];return p.forEach(function(F){return J.bind(F).toService(E)})}}};L.multiBindToService=x},85265:function(ur,L,x){"use strict";Object.defineProperty(L,"__esModule",{value:!0}),L.isStackOverflowExeption=void 0;var J=x(16674);function E(p){return p instanceof RangeError||p.message===J.STACK_OVERFLOW}L.isStackOverflowExeption=E},37791:function(ur,L){"use strict";Object.defineProperty(L,"__esModule",{value:!0}),L.id=void 0;var x=0;function J(){return x++}L.id=J},55800:function(ur,L,x){"use strict";Object.defineProperty(L,"__esModule",{value:!0}),L.circularDependencyToException=L.listMetadataForTarget=L.listRegisteredBindingsForServiceIdentifier=L.getServiceIdentifierAsString=L.getFunctionName=void 0;var J=x(16674);function E(ne){if(typeof ne=="function"){var be=ne;return be.name}else{if(typeof ne=="symbol")return ne.toString();var be=ne;return be}}L.getServiceIdentifierAsString=E;function p(ne,be,we){var Ie="",$t=we(ne,be);return $t.length!==0&&(Ie=`
Registered bindings:`,$t.forEach(function(Zt){var Xt="Object";Zt.implementationType!==null&&(Xt=le(Zt.implementationType)),Ie=Ie+`
 `+Xt,Zt.constraint.metaData&&(Ie=Ie+" - "+Zt.constraint.metaData)})),Ie}L.listRegisteredBindingsForServiceIdentifier=p;function w(ne,be){return ne.parentRequest===null?!1:ne.parentRequest.serviceIdentifier===be?!0:w(ne.parentRequest,be)}function F(ne){function be(Ie,$t){$t===void 0&&($t=[]);var Zt=E(Ie.serviceIdentifier);return $t.push(Zt),Ie.parentRequest!==null?be(Ie.parentRequest,$t):$t}var we=be(ne);return we.reverse().join(" --> ")}function Q(ne){ne.childRequests.forEach(function(be){if(w(be,be.serviceIdentifier)){var we=F(be);throw new Error(J.CIRCULAR_DEPENDENCY+" "+we)}else Q(be)})}L.circularDependencyToException=Q;function Y(ne,be){if(be.isTagged()||be.isNamed()){var we="",Ie=be.getNamedTag(),$t=be.getCustomTags();return Ie!==null&&(we+=Ie.toString()+`
`),$t!==null&&$t.forEach(function(Zt){we+=Zt.toString()+`
`})," "+ne+`
 `+ne+" - "+we}else return" "+ne}L.listMetadataForTarget=Y;function le(ne){if(ne.name)return ne.name;var be=ne.toString(),we=be.match(/^function\s*([^\s(]+)/);return we?we[1]:"Anonymous function: "+be}L.getFunctionName=le},68982:function(ur){ur.exports=L;function L(x,J){J||(J=document);var E=J.head||J.getElementsByTagName("head")[0];if(!E){E=J.createElement("head");var p=J.body||J.getElementsByTagName("body")[0];p?p.parentNode.insertBefore(E,p):J.documentElement.appendChild(E)}var w=J.createElement("style");return w.type="text/css",w.styleSheet?w.styleSheet.cssText=x:w.appendChild(J.createTextNode(x)),E.appendChild(w),w}},53778:function(ur){var L=Array.isArray;ur.exports=L},59722:function(ur){function L(x){return x==null}ur.exports=L},8146:function(ur){var L="[object Object]";function x(we){var Ie=!1;if(we!=null&&typeof we.toString!="function")try{Ie=!!(we+"")}catch($t){}return Ie}function J(we,Ie){return function($t){return we(Ie($t))}}var E=Function.prototype,p=Object.prototype,w=E.toString,F=p.hasOwnProperty,Q=w.call(Object),Y=p.toString,le=J(Object.getPrototypeOf,Object);function ne(we){return!!we&&typeof we=="object"}function be(we){if(!ne(we)||Y.call(we)!=L||x(we))return!1;var Ie=le(we);if(Ie===null)return!0;var $t=F.call(Ie,"constructor")&&Ie.constructor;return typeof $t=="function"&&$t instanceof $t&&w.call($t)==Q}ur.exports=be},38554:function(ur,L,x){ur=x.nmd(ur);var J=200,E="__lodash_hash_undefined__",p=800,w=16,F=9007199254740991,Q="[object Arguments]",Y="[object Array]",le="[object AsyncFunction]",ne="[object Boolean]",be="[object Date]",we="[object Error]",Ie="[object Function]",$t="[object GeneratorFunction]",Zt="[object Map]",Xt="[object Number]",Ft="[object Null]",Lt="[object Object]",_t="[object Proxy]",pt="[object RegExp]",Cr="[object Set]",Gt="[object String]",ar="[object Undefined]",gt="[object WeakMap]",Ye="[object ArrayBuffer]",Et="[object DataView]",Ne="[object Float32Array]",Ae="[object Float64Array]",Be="[object Int8Array]",bt="[object Int16Array]",ir="[object Int32Array]",re="[object Uint8Array]",Ee="[object Uint8ClampedArray]",ae="[object Uint16Array]",me="[object Uint32Array]",Te=/[\\^$.*+?()[\]{}|]/g,Qe=/^\[object .+?Constructor\]$/,dt=/^(?:0|[1-9]\d*)$/,Jt={};Jt[Ne]=Jt[Ae]=Jt[Be]=Jt[bt]=Jt[ir]=Jt[re]=Jt[Ee]=Jt[ae]=Jt[me]=!0,Jt[Q]=Jt[Y]=Jt[Ye]=Jt[ne]=Jt[Et]=Jt[be]=Jt[we]=Jt[Ie]=Jt[Zt]=Jt[Xt]=Jt[Lt]=Jt[pt]=Jt[Cr]=Jt[Gt]=Jt[gt]=!1;var Nr=typeof x.g=="object"&&x.g&&x.g.Object===Object&&x.g,Fr=typeof self=="object"&&self&&self.Object===Object&&self,ln=Nr||Fr||Function("return this")(),tr=L&&!L.nodeType&&L,se=tr&&!0&&ur&&!ur.nodeType&&ur,ge=se&&se.exports===tr,Re=ge&&Nr.process,tt=function(){try{var je=se&&se.require&&se.require("util").types;return je||Re&&Re.binding&&Re.binding("util")}catch(Pt){}}(),Mt=tt&&tt.isTypedArray;function Dt(je,Pt,yr){switch(yr.length){case 0:return je.call(Pt);case 1:return je.call(Pt,yr[0]);case 2:return je.call(Pt,yr[0],yr[1]);case 3:return je.call(Pt,yr[0],yr[1],yr[2])}return je.apply(Pt,yr)}function S(je,Pt){for(var yr=-1,On=Array(je);++yr<je;)On[yr]=Pt(yr);return On}function z(je){return function(Pt){return je(Pt)}}function pe(je,Pt){return je==null?void 0:je[Pt]}function Ue(je,Pt){return function(yr){return je(Pt(yr))}}var Je=Array.prototype,mt=Function.prototype,Ct=Object.prototype,H=ln["__core-js_shared__"],Ht=mt.toString,Vt=Ct.hasOwnProperty,_r=function(){var je=/[^.]+$/.exec(H&&H.keys&&H.keys.IE_PROTO||"");return je?"Symbol(src)_1."+je:""}(),Er=Ct.toString,Ar=Ht.call(Object),Pr=RegExp("^"+Ht.call(Vt).replace(Te,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Ke=ge?ln.Buffer:void 0,yt=ln.Symbol,lt=ln.Uint8Array,lr=Ke?Ke.allocUnsafe:void 0,qr=Ue(Object.getPrototypeOf,Object),ut=Object.create,It=Ct.propertyIsEnumerable,Qt=Je.splice,gr=yt?yt.toStringTag:void 0,gn=function(){try{var je=xa(Object,"defineProperty");return je({},"",{}),je}catch(Pt){}}(),Cn=Ke?Ke.isBuffer:void 0,vi=Math.max,xi=Date.now,Ri=xa(ln,"Map"),Wi=xa(Object,"create"),si=function(){function je(){}return function(Pt){if(!so(Pt))return{};if(ut)return ut(Pt);je.prototype=Pt;var yr=new je;return je.prototype=void 0,yr}}();function G(je){var Pt=-1,yr=je==null?0:je.length;for(this.clear();++Pt<yr;){var On=je[Pt];this.set(On[0],On[1])}}function I(){this.__data__=Wi?Wi(null):{},this.size=0}function Z(je){var Pt=this.has(je)&&delete this.__data__[je];return this.size-=Pt?1:0,Pt}function $(je){var Pt=this.__data__;if(Wi){var yr=Pt[je];return yr===E?void 0:yr}return Vt.call(Pt,je)?Pt[je]:void 0}function ie(je){var Pt=this.__data__;return Wi?Pt[je]!==void 0:Vt.call(Pt,je)}function Le(je,Pt){var yr=this.__data__;return this.size+=this.has(je)?0:1,yr[je]=Wi&&Pt===void 0?E:Pt,this}G.prototype.clear=I,G.prototype.delete=Z,G.prototype.get=$,G.prototype.has=ie,G.prototype.set=Le;function Ge(je){var Pt=-1,yr=je==null?0:je.length;for(this.clear();++Pt<yr;){var On=je[Pt];this.set(On[0],On[1])}}function ue(){this.__data__=[],this.size=0}function De(je){var Pt=this.__data__,yr=po(Pt,je);if(yr<0)return!1;var On=Pt.length-1;return yr==On?Pt.pop():Qt.call(Pt,yr,1),--this.size,!0}function wt(je){var Pt=this.__data__,yr=po(Pt,je);return yr<0?void 0:Pt[yr][1]}function Ir(je){return po(this.__data__,je)>-1}function Ur(je,Pt){var yr=this.__data__,On=po(yr,je);return On<0?(++this.size,yr.push([je,Pt])):yr[On][1]=Pt,this}Ge.prototype.clear=ue,Ge.prototype.delete=De,Ge.prototype.get=wt,Ge.prototype.has=Ir,Ge.prototype.set=Ur;function jt(je){var Pt=-1,yr=je==null?0:je.length;for(this.clear();++Pt<yr;){var On=je[Pt];this.set(On[0],On[1])}}function dr(){this.size=0,this.__data__={hash:new G,map:new(Ri||Ge),string:new G}}function Hr(je){var Pt=Ta(this,je).delete(je);return this.size-=Pt?1:0,Pt}function _n(je){return Ta(this,je).get(je)}function vr(je){return Ta(this,je).has(je)}function vn(je,Pt){var yr=Ta(this,je),On=yr.size;return yr.set(je,Pt),this.size+=yr.size==On?0:1,this}jt.prototype.clear=dr,jt.prototype.delete=Hr,jt.prototype.get=_n,jt.prototype.has=vr,jt.prototype.set=vn;function $r(je){var Pt=this.__data__=new Ge(je);this.size=Pt.size}function cn(){this.__data__=new Ge,this.size=0}function pi(je){var Pt=this.__data__,yr=Pt.delete(je);return this.size=Pt.size,yr}function pn(je){return this.__data__.get(je)}function _i(je){return this.__data__.has(je)}function Xi(je,Pt){var yr=this.__data__;if(yr instanceof Ge){var On=yr.__data__;if(!Ri||On.length<J-1)return On.push([je,Pt]),this.size=++yr.size,this;yr=this.__data__=new jt(On)}return yr.set(je,Pt),this.size=yr.size,this}$r.prototype.clear=cn,$r.prototype.delete=pi,$r.prototype.get=pn,$r.prototype.has=_i,$r.prototype.set=Xi;function mi(je,Pt){var yr=Xo(je),On=!yr&&$a(je),Gi=!yr&&!On&&Xu(je),Sa=!yr&&!On&&!Gi&&ci(je),Za=yr||On||Gi||Sa,ra=Za?S(je.length,String):[],Da=ra.length;for(var Do in je)(Pt||Vt.call(je,Do))&&!(Za&&(Do=="length"||Gi&&(Do=="offset"||Do=="parent")||Sa&&(Do=="buffer"||Do=="byteLength"||Do=="byteOffset")||rs(Do,Da)))&&ra.push(Do);return ra}function Di(je,Pt,yr){(yr!==void 0&&!Ka(je[Pt],yr)||yr===void 0&&!(Pt in je))&&ji(je,Pt,yr)}function Pi(je,Pt,yr){var On=je[Pt];(!(Vt.call(je,Pt)&&Ka(On,yr))||yr===void 0&&!(Pt in je))&&ji(je,Pt,yr)}function po(je,Pt){for(var yr=je.length;yr--;)if(Ka(je[yr][0],Pt))return yr;return-1}function ji(je,Pt,yr){Pt=="__proto__"&&gn?gn(je,Pt,{configurable:!0,enumerable:!0,value:yr,writable:!0}):je[Pt]=yr}var Rn=Ya();function Dn(je){return je==null?je===void 0?ar:Ft:gr&&gr in Object(je)?ta(je):ct(je)}function li(je){return Ps(je)&&Dn(je)==Q}function Vn(je){if(!so(je)||fa(je))return!1;var Pt=Ro(je)?Pr:Qe;return Pt.test(Yi(je))}function Na(je){return Ps(je)&&Cs(je.length)&&!!Jt[Dn(je)]}function ps(je){if(!so(je))return Pe(je);var Pt=he(je),yr=[];for(var On in je)On=="constructor"&&(Pt||!Vt.call(je,On))||yr.push(On);return yr}function ki(je,Pt,yr,On,Gi){je!==Pt&&Rn(Pt,function(Sa,Za){if(Gi||(Gi=new $r),so(Sa))Ba(je,Pt,Za,yr,ki,On,Gi);else{var ra=On?On(tn(je,Za),Sa,Za+"",je,Pt,Gi):void 0;ra===void 0&&(ra=Sa),Di(je,Za,ra)}},ba)}function Ba(je,Pt,yr,On,Gi,Sa,Za){var ra=tn(je,yr),Da=tn(Pt,yr),Do=Za.get(Da);if(Do){Di(je,yr,Do);return}var Co=Sa?Sa(ra,Da,yr+"",je,Pt,Za):void 0,bi=Co===void 0;if(bi){var Yu=Xo(Da),lu=!Yu&&Xu(Da),Yo=!Yu&&!lu&&ci(Da);Co=Da,Yu||lu||Yo?Xo(ra)?Co=ra:Hl(ra)?Co=Xa(ra):lu?(bi=!1,Co=_a(Da,!0)):Yo?(bi=!1,Co=Wa(Da,!0)):Co=[]:Ra(Da)||$a(Da)?(Co=ra,$a(ra)?Co=ul(ra):(!so(ra)||Ro(ra))&&(Co=sl(Da))):bi=!1}bi&&(Za.set(Da,Co),Gi(Co,Da,On,Sa,Za),Za.delete(Da)),Di(je,yr,Co)}function xu(je,Pt){return kn(cr(je,Pt,Wl),je+"")}var uu=gn?function(je,Pt){return gn(je,"toString",{configurable:!0,enumerable:!1,value:Ws(Pt),writable:!0})}:Wl;function _a(je,Pt){if(Pt)return je.slice();var yr=je.length,On=lr?lr(yr):new je.constructor(yr);return je.copy(On),On}function oo(je){var Pt=new je.constructor(je.byteLength);return new lt(Pt).set(new lt(je)),Pt}function Wa(je,Pt){var yr=Pt?oo(je.buffer):je.buffer;return new je.constructor(yr,je.byteOffset,je.length)}function Xa(je,Pt){var yr=-1,On=je.length;for(Pt||(Pt=Array(On));++yr<On;)Pt[yr]=je[yr];return Pt}function Wo(je,Pt,yr,On){var Gi=!yr;yr||(yr={});for(var Sa=-1,Za=Pt.length;++Sa<Za;){var ra=Pt[Sa],Da=On?On(yr[ra],je[ra],ra,yr,je):void 0;Da===void 0&&(Da=je[ra]),Gi?ji(yr,ra,Da):Pi(yr,ra,Da)}return yr}function sa(je){return xu(function(Pt,yr){var On=-1,Gi=yr.length,Sa=Gi>1?yr[Gi-1]:void 0,Za=Gi>2?yr[2]:void 0;for(Sa=je.length>3&&typeof Sa=="function"?(Gi--,Sa):void 0,Za&&qa(yr[0],yr[1],Za)&&(Sa=Gi<3?void 0:Sa,Gi=1),Pt=Object(Pt);++On<Gi;){var ra=yr[On];ra&&je(Pt,ra,On,Sa)}return Pt})}function Ya(je){return function(Pt,yr,On){for(var Gi=-1,Sa=Object(Pt),Za=On(Pt),ra=Za.length;ra--;){var Da=Za[je?ra:++Gi];if(yr(Sa[Da],Da,Sa)===!1)break}return Pt}}function Ta(je,Pt){var yr=je.__data__;return La(Pt)?yr[typeof Pt=="string"?"string":"hash"]:yr.map}function xa(je,Pt){var yr=pe(je,Pt);return Vn(yr)?yr:void 0}function ta(je){var Pt=Vt.call(je,gr),yr=je[gr];try{je[gr]=void 0;var On=!0}catch(Sa){}var Gi=Er.call(je);return On&&(Pt?je[gr]=yr:delete je[gr]),Gi}function sl(je){return typeof je.constructor=="function"&&!he(je)?si(qr(je)):{}}function rs(je,Pt){var yr=typeof je;return Pt=Pt==null?F:Pt,!!Pt&&(yr=="number"||yr!="symbol"&&dt.test(je))&&je>-1&&je%1==0&&je<Pt}function qa(je,Pt,yr){if(!so(yr))return!1;var On=typeof Pt;return(On=="number"?xs(yr)&&rs(Pt,yr.length):On=="string"&&Pt in yr)?Ka(yr[Pt],je):!1}function La(je){var Pt=typeof je;return Pt=="string"||Pt=="number"||Pt=="symbol"||Pt=="boolean"?je!=="__proto__":je===null}function fa(je){return!!_r&&_r in je}function he(je){var Pt=je&&je.constructor,yr=typeof Pt=="function"&&Pt.prototype||Ct;return je===yr}function Pe(je){var Pt=[];if(je!=null)for(var yr in Object(je))Pt.push(yr);return Pt}function ct(je){return Er.call(je)}function cr(je,Pt,yr){return Pt=vi(Pt===void 0?je.length-1:Pt,0),function(){for(var On=arguments,Gi=-1,Sa=vi(On.length-Pt,0),Za=Array(Sa);++Gi<Sa;)Za[Gi]=On[Pt+Gi];Gi=-1;for(var ra=Array(Pt+1);++Gi<Pt;)ra[Gi]=On[Gi];return ra[Pt]=yr(Za),Dt(je,this,ra)}}function tn(je,Pt){if(!(Pt==="constructor"&&typeof je[Pt]=="function")&&Pt!="__proto__")return je[Pt]}var kn=Zi(uu);function Zi(je){var Pt=0,yr=0;return function(){var On=xi(),Gi=w-(On-yr);if(yr=On,Gi>0){if(++Pt>=p)return arguments[0]}else Pt=0;return je.apply(void 0,arguments)}}function Yi(je){if(je!=null){try{return Ht.call(je)}catch(Pt){}try{return je+""}catch(Pt){}}return""}function Ka(je,Pt){return je===Pt||je!==je&&Pt!==Pt}var $a=li(function(){return arguments}())?li:function(je){return Ps(je)&&Vt.call(je,"callee")&&!It.call(je,"callee")},Xo=Array.isArray;function xs(je){return je!=null&&Cs(je.length)&&!Ro(je)}function Hl(je){return Ps(je)&&xs(je)}var Xu=Cn||uo;function Ro(je){if(!so(je))return!1;var Pt=Dn(je);return Pt==Ie||Pt==$t||Pt==le||Pt==_t}function Cs(je){return typeof je=="number"&&je>-1&&je%1==0&&je<=F}function so(je){var Pt=typeof je;return je!=null&&(Pt=="object"||Pt=="function")}function Ps(je){return je!=null&&typeof je=="object"}function Ra(je){if(!Ps(je)||Dn(je)!=Lt)return!1;var Pt=qr(je);if(Pt===null)return!0;var yr=Vt.call(Pt,"constructor")&&Pt.constructor;return typeof yr=="function"&&yr instanceof yr&&Ht.call(yr)==Ar}var ci=Mt?z(Mt):Na;function ul(je){return Wo(je,ba(je))}function ba(je){return xs(je)?mi(je,!0):ps(je)}var Nn=sa(function(je,Pt,yr,On){ki(je,Pt,yr,On)});function Ws(je){return function(){return je}}function Wl(je){return je}function uo(){return!1}ur.exports=Nn},97644:function(ur,L,x){var J=200,E="__lodash_hash_undefined__",p=1/0,w="[object Function]",F="[object GeneratorFunction]",Q=/[\\^$.*+?()[\]{}|]/g,Y=/^\[object .+?Constructor\]$/,le=typeof x.g=="object"&&x.g&&x.g.Object===Object&&x.g,ne=typeof self=="object"&&self&&self.Object===Object&&self,be=le||ne||Function("return this")();function we(ut,It){var Qt=ut?ut.length:0;return!!Qt&&Zt(ut,It,0)>-1}function Ie(ut,It,Qt){for(var gr=-1,gn=ut?ut.length:0;++gr<gn;)if(Qt(It,ut[gr]))return!0;return!1}function $t(ut,It,Qt,gr){for(var gn=ut.length,Cn=Qt+(gr?1:-1);gr?Cn--:++Cn<gn;)if(It(ut[Cn],Cn,ut))return Cn;return-1}function Zt(ut,It,Qt){if(It!==It)return $t(ut,Xt,Qt);for(var gr=Qt-1,gn=ut.length;++gr<gn;)if(ut[gr]===It)return gr;return-1}function Xt(ut){return ut!==ut}function Ft(ut,It){return ut.has(It)}function Lt(ut,It){return ut==null?void 0:ut[It]}function _t(ut){var It=!1;if(ut!=null&&typeof ut.toString!="function")try{It=!!(ut+"")}catch(Qt){}return It}function pt(ut){var It=-1,Qt=Array(ut.size);return ut.forEach(function(gr){Qt[++It]=gr}),Qt}var Cr=Array.prototype,Gt=Function.prototype,ar=Object.prototype,gt=be["__core-js_shared__"],Ye=function(){var ut=/[^.]+$/.exec(gt&&gt.keys&&gt.keys.IE_PROTO||"");return ut?"Symbol(src)_1."+ut:""}(),Et=Gt.toString,Ne=ar.hasOwnProperty,Ae=ar.toString,Be=RegExp("^"+Et.call(Ne).replace(Q,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),bt=Cr.splice,ir=_r(be,"Map"),re=_r(be,"Set"),Ee=_r(Object,"create");function ae(ut){var It=-1,Qt=ut?ut.length:0;for(this.clear();++It<Qt;){var gr=ut[It];this.set(gr[0],gr[1])}}function me(){this.__data__=Ee?Ee(null):{}}function Te(ut){return this.has(ut)&&delete this.__data__[ut]}function Qe(ut){var It=this.__data__;if(Ee){var Qt=It[ut];return Qt===E?void 0:Qt}return Ne.call(It,ut)?It[ut]:void 0}function dt(ut){var It=this.__data__;return Ee?It[ut]!==void 0:Ne.call(It,ut)}function Jt(ut,It){var Qt=this.__data__;return Qt[ut]=Ee&&It===void 0?E:It,this}ae.prototype.clear=me,ae.prototype.delete=Te,ae.prototype.get=Qe,ae.prototype.has=dt,ae.prototype.set=Jt;function Nr(ut){var It=-1,Qt=ut?ut.length:0;for(this.clear();++It<Qt;){var gr=ut[It];this.set(gr[0],gr[1])}}function Fr(){this.__data__=[]}function ln(ut){var It=this.__data__,Qt=mt(It,ut);if(Qt<0)return!1;var gr=It.length-1;return Qt==gr?It.pop():bt.call(It,Qt,1),!0}function tr(ut){var It=this.__data__,Qt=mt(It,ut);return Qt<0?void 0:It[Qt][1]}function se(ut){return mt(this.__data__,ut)>-1}function ge(ut,It){var Qt=this.__data__,gr=mt(Qt,ut);return gr<0?Qt.push([ut,It]):Qt[gr][1]=It,this}Nr.prototype.clear=Fr,Nr.prototype.delete=ln,Nr.prototype.get=tr,Nr.prototype.has=se,Nr.prototype.set=ge;function Re(ut){var It=-1,Qt=ut?ut.length:0;for(this.clear();++It<Qt;){var gr=ut[It];this.set(gr[0],gr[1])}}function tt(){this.__data__={hash:new ae,map:new(ir||Nr),string:new ae}}function Mt(ut){return Vt(this,ut).delete(ut)}function Dt(ut){return Vt(this,ut).get(ut)}function S(ut){return Vt(this,ut).has(ut)}function z(ut,It){return Vt(this,ut).set(ut,It),this}Re.prototype.clear=tt,Re.prototype.delete=Mt,Re.prototype.get=Dt,Re.prototype.has=S,Re.prototype.set=z;function pe(ut){var It=-1,Qt=ut?ut.length:0;for(this.__data__=new Re;++It<Qt;)this.add(ut[It])}function Ue(ut){return this.__data__.set(ut,E),this}function Je(ut){return this.__data__.has(ut)}pe.prototype.add=pe.prototype.push=Ue,pe.prototype.has=Je;function mt(ut,It){for(var Qt=ut.length;Qt--;)if(yt(ut[Qt][0],It))return Qt;return-1}function Ct(ut){if(!lr(ut)||Ar(ut))return!1;var It=lt(ut)||_t(ut)?Be:Y;return It.test(Pr(ut))}function H(ut,It,Qt){var gr=-1,gn=we,Cn=ut.length,vi=!0,xi=[],Ri=xi;if(Qt)vi=!1,gn=Ie;else if(Cn>=J){var Wi=It?null:Ht(ut);if(Wi)return pt(Wi);vi=!1,gn=Ft,Ri=new pe}else Ri=It?[]:xi;e:for(;++gr<Cn;){var si=ut[gr],G=It?It(si):si;if(si=Qt||si!==0?si:0,vi&&G===G){for(var I=Ri.length;I--;)if(Ri[I]===G)continue e;It&&Ri.push(G),xi.push(si)}else gn(Ri,G,Qt)||(Ri!==xi&&Ri.push(G),xi.push(si))}return xi}var Ht=re&&1/pt(new re([,-0]))[1]==p?function(ut){return new re(ut)}:qr;function Vt(ut,It){var Qt=ut.__data__;return Er(It)?Qt[typeof It=="string"?"string":"hash"]:Qt.map}function _r(ut,It){var Qt=Lt(ut,It);return Ct(Qt)?Qt:void 0}function Er(ut){var It=typeof ut;return It=="string"||It=="number"||It=="symbol"||It=="boolean"?ut!=="__proto__":ut===null}function Ar(ut){return!!Ye&&Ye in ut}function Pr(ut){if(ut!=null){try{return Et.call(ut)}catch(It){}try{return ut+""}catch(It){}}return""}function Ke(ut){return ut&&ut.length?H(ut):[]}function yt(ut,It){return ut===It||ut!==ut&&It!==It}function lt(ut){var It=lr(ut)?Ae.call(ut):"";return It==w||It==F}function lr(ut){var It=typeof ut;return!!ut&&(It=="object"||It=="function")}function qr(){}ur.exports=Ke},49029:function(ur){var L=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g;function x(J){return J.match(L)||[]}ur.exports=x},29750:function(ur){function L(x,J,E){return x===x&&(E!==void 0&&(x=x<=E?x:E),J!==void 0&&(x=x>=J?x:J)),x}ur.exports=L},18674:function(ur){function L(x){return function(J){return x==null?void 0:x[J]}}ur.exports=L},98805:function(ur,L,x){var J=x(40180),E=x(62689),p=x(83140),w=x(79833);function F(Q){return function(Y){Y=w(Y);var le=E(Y)?p(Y):void 0,ne=le?le[0]:Y.charAt(0),be=le?J(le,1).join(""):Y.slice(1);return ne[Q]()+be}}ur.exports=F},35393:function(ur,L,x){var J=x(62663),E=x(53816),p=x(58748),w="['\u2019]",F=RegExp(w,"g");function Q(Y){return function(le){return J(p(E(le).replace(F,"")),Y,"")}}ur.exports=Q},69389:function(ur,L,x){var J=x(18674),E={\u00C0:"A",\u00C1:"A",\u00C2:"A",\u00C3:"A",\u00C4:"A",\u00C5:"A",\u00E0:"a",\u00E1:"a",\u00E2:"a",\u00E3:"a",\u00E4:"a",\u00E5:"a",\u00C7:"C",\u00E7:"c",\u00D0:"D",\u00F0:"d",\u00C8:"E",\u00C9:"E",\u00CA:"E",\u00CB:"E",\u00E8:"e",\u00E9:"e",\u00EA:"e",\u00EB:"e",\u00CC:"I",\u00CD:"I",\u00CE:"I",\u00CF:"I",\u00EC:"i",\u00ED:"i",\u00EE:"i",\u00EF:"i",\u00D1:"N",\u00F1:"n",\u00D2:"O",\u00D3:"O",\u00D4:"O",\u00D5:"O",\u00D6:"O",\u00D8:"O",\u00F2:"o",\u00F3:"o",\u00F4:"o",\u00F5:"o",\u00F6:"o",\u00F8:"o",\u00D9:"U",\u00DA:"U",\u00DB:"U",\u00DC:"U",\u00F9:"u",\u00FA:"u",\u00FB:"u",\u00FC:"u",\u00DD:"Y",\u00FD:"y",\u00FF:"y",\u00C6:"Ae",\u00E6:"ae",\u00DE:"Th",\u00FE:"th",\u00DF:"ss",\u0100:"A",\u0102:"A",\u0104:"A",\u0101:"a",\u0103:"a",\u0105:"a",\u0106:"C",\u0108:"C",\u010A:"C",\u010C:"C",\u0107:"c",\u0109:"c",\u010B:"c",\u010D:"c",\u010E:"D",\u0110:"D",\u010F:"d",\u0111:"d",\u0112:"E",\u0114:"E",\u0116:"E",\u0118:"E",\u011A:"E",\u0113:"e",\u0115:"e",\u0117:"e",\u0119:"e",\u011B:"e",\u011C:"G",\u011E:"G",\u0120:"G",\u0122:"G",\u011D:"g",\u011F:"g",\u0121:"g",\u0123:"g",\u0124:"H",\u0126:"H",\u0125:"h",\u0127:"h",\u0128:"I",\u012A:"I",\u012C:"I",\u012E:"I",\u0130:"I",\u0129:"i",\u012B:"i",\u012D:"i",\u012F:"i",\u0131:"i",\u0134:"J",\u0135:"j",\u0136:"K",\u0137:"k",\u0138:"k",\u0139:"L",\u013B:"L",\u013D:"L",\u013F:"L",\u0141:"L",\u013A:"l",\u013C:"l",\u013E:"l",\u0140:"l",\u0142:"l",\u0143:"N",\u0145:"N",\u0147:"N",\u014A:"N",\u0144:"n",\u0146:"n",\u0148:"n",\u014B:"n",\u014C:"O",\u014E:"O",\u0150:"O",\u014D:"o",\u014F:"o",\u0151:"o",\u0154:"R",\u0156:"R",\u0158:"R",\u0155:"r",\u0157:"r",\u0159:"r",\u015A:"S",\u015C:"S",\u015E:"S",\u0160:"S",\u015B:"s",\u015D:"s",\u015F:"s",\u0161:"s",\u0162:"T",\u0164:"T",\u0166:"T",\u0163:"t",\u0165:"t",\u0167:"t",\u0168:"U",\u016A:"U",\u016C:"U",\u016E:"U",\u0170:"U",\u0172:"U",\u0169:"u",\u016B:"u",\u016D:"u",\u016F:"u",\u0171:"u",\u0173:"u",\u0174:"W",\u0175:"w",\u0176:"Y",\u0177:"y",\u0178:"Y",\u0179:"Z",\u017B:"Z",\u017D:"Z",\u017A:"z",\u017C:"z",\u017E:"z",\u0132:"IJ",\u0133:"ij",\u0152:"Oe",\u0153:"oe",\u0149:"'n",\u017F:"s"},p=J(E);ur.exports=p},93157:function(ur){var L=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/;function x(J){return L.test(J)}ur.exports=x},2757:function(ur){var L="\\ud800-\\udfff",x="\\u0300-\\u036f",J="\\ufe20-\\ufe2f",E="\\u20d0-\\u20ff",p=x+J+E,w="\\u2700-\\u27bf",F="a-z\\xdf-\\xf6\\xf8-\\xff",Q="\\xac\\xb1\\xd7\\xf7",Y="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",le="\\u2000-\\u206f",ne=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",be="A-Z\\xc0-\\xd6\\xd8-\\xde",we="\\ufe0e\\ufe0f",Ie=Q+Y+le+ne,$t="['\u2019]",Zt="["+Ie+"]",Xt="["+p+"]",Ft="\\d+",Lt="["+w+"]",_t="["+F+"]",pt="[^"+L+Ie+Ft+w+F+be+"]",Cr="\\ud83c[\\udffb-\\udfff]",Gt="(?:"+Xt+"|"+Cr+")",ar="[^"+L+"]",gt="(?:\\ud83c[\\udde6-\\uddff]){2}",Ye="[\\ud800-\\udbff][\\udc00-\\udfff]",Et="["+be+"]",Ne="\\u200d",Ae="(?:"+_t+"|"+pt+")",Be="(?:"+Et+"|"+pt+")",bt="(?:"+$t+"(?:d|ll|m|re|s|t|ve))?",ir="(?:"+$t+"(?:D|LL|M|RE|S|T|VE))?",re=Gt+"?",Ee="["+we+"]?",ae="(?:"+Ne+"(?:"+[ar,gt,Ye].join("|")+")"+Ee+re+")*",me="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",Te="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",Qe=Ee+re+ae,dt="(?:"+[Lt,gt,Ye].join("|")+")"+Qe,Jt=RegExp([Et+"?"+_t+"+"+bt+"(?="+[Zt,Et,"$"].join("|")+")",Be+"+"+ir+"(?="+[Zt,Et+Ae,"$"].join("|")+")",Et+"?"+Ae+"+"+bt,Et+"+"+ir,Te,me,Ft,dt].join("|"),"g");function Nr(Fr){return Fr.match(Jt)||[]}ur.exports=Nr},68929:function(ur,L,x){var J=x(48403),E=x(35393),p=E(function(w,F,Q){return F=F.toLowerCase(),w+(Q?J(F):F)});ur.exports=p},48403:function(ur,L,x){var J=x(79833),E=x(11700);function p(w){return E(J(w).toLowerCase())}ur.exports=p},74691:function(ur,L,x){var J=x(29750),E=x(14841);function p(w,F,Q){return Q===void 0&&(Q=F,F=void 0),Q!==void 0&&(Q=E(Q),Q=Q===Q?Q:0),F!==void 0&&(F=E(F),F=F===F?F:0),J(E(w),F,Q)}ur.exports=p},53816:function(ur,L,x){var J=x(69389),E=x(79833),p=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,w="\\u0300-\\u036f",F="\\ufe20-\\ufe2f",Q="\\u20d0-\\u20ff",Y=w+F+Q,le="["+Y+"]",ne=RegExp(le,"g");function be(we){return we=E(we),we&&we.replace(p,J).replace(ne,"")}ur.exports=be},14293:function(ur){function L(x){return x==null}ur.exports=L},81763:function(ur,L,x){var J=x(44239),E=x(37005),p="[object Number]";function w(F){return typeof F=="number"||E(F)&&J(F)==p}ur.exports=w},30236:function(ur,L,x){var J=x(42980),E=x(21463),p=E(function(w,F,Q,Y){J(w,F,Q,Y)});ur.exports=p},44908:function(ur,L,x){var J=x(45652);function E(p){return p&&p.length?J(p):[]}ur.exports=E},11700:function(ur,L,x){var J=x(98805),E=J("toUpperCase");ur.exports=E},58748:function(ur,L,x){var J=x(49029),E=x(93157),p=x(79833),w=x(2757);function F(Q,Y,le){return Q=p(Q),Y=le?void 0:Y,Y===void 0?E(Q)?w(Q):J(Q):Q.match(Y)||[]}ur.exports=F},6158:function(ur){(function(L,x){ur.exports=x()})(this,function(){"use strict";var L,x,J;function E(p,w){if(!L)L=w;else if(!x)x=w;else{var F="var sharedChunk = {}; ("+L+")(sharedChunk); ("+x+")(sharedChunk);",Q={};L(Q),J=w(Q),typeof window!="undefined"&&(J.workerUrl=window.URL.createObjectURL(new Blob([F],{type:"text/javascript"})))}}return E(["exports"],function(p){"use strict";function w(e,t){return e(t={exports:{}},t.exports),t.exports}var F=Q;function Q(e,t,r,c){this.cx=3*e,this.bx=3*(r-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(c-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=c,this.p2x=r,this.p2y=c}Q.prototype.sampleCurveX=function(e){return((this.ax*e+this.bx)*e+this.cx)*e},Q.prototype.sampleCurveY=function(e){return((this.ay*e+this.by)*e+this.cy)*e},Q.prototype.sampleCurveDerivativeX=function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},Q.prototype.solveCurveX=function(e,t){var r,c,v,m,_;for(t===void 0&&(t=1e-6),v=e,_=0;_<8;_++){if(m=this.sampleCurveX(v)-e,Math.abs(m)<t)return v;var C=this.sampleCurveDerivativeX(v);if(Math.abs(C)<1e-6)break;v-=m/C}if((v=e)<(r=0))return r;if(v>(c=1))return c;for(;r<c;){if(m=this.sampleCurveX(v),Math.abs(m-e)<t)return v;e>m?r=v:c=v,v=.5*(c-r)+r}return v},Q.prototype.solve=function(e,t){return this.sampleCurveY(this.solveCurveX(e,t))};var Y=le;function le(e,t){this.x=e,this.y=t}le.prototype={clone:function(){return new le(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,t){return this.clone()._rotateAround(e,t)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var t=e.x-this.x,r=e.y-this.y;return t*t+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,t){return Math.atan2(this.x*t-this.y*e,this.x*e+this.y*t)},_matMult:function(e){var t=e[2]*this.x+e[3]*this.y;return this.x=e[0]*this.x+e[1]*this.y,this.y=t,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var t=Math.cos(e),r=Math.sin(e),c=r*this.x+t*this.y;return this.x=t*this.x-r*this.y,this.y=c,this},_rotateAround:function(e,t){var r=Math.cos(e),c=Math.sin(e),v=t.y+c*(this.x-t.x)+r*(this.y-t.y);return this.x=t.x+r*(this.x-t.x)-c*(this.y-t.y),this.y=v,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},le.convert=function(e){return e instanceof le?e:Array.isArray(e)?new le(e[0],e[1]):e};var ne=typeof self!="undefined"?self:{},be=Math.pow(2,53)-1;function we(e,t,r,c){var v=new F(e,t,r,c);return function(m){return v.solve(m)}}var Ie=we(.25,.1,.25,1);function $t(e,t,r){return Math.min(r,Math.max(t,e))}function Zt(e,t,r){var c=r-t,v=((e-t)%c+c)%c+t;return v===t?r:v}function Xt(e){for(var t=[],r=arguments.length-1;r-- >0;)t[r]=arguments[r+1];for(var c=0,v=t;c<v.length;c+=1){var m=v[c];for(var _ in m)e[_]=m[_]}return e}var Ft=1;function Lt(){return Ft++}function _t(){return function e(t){return t?(t^16*Math.random()>>t/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,e)}()}function pt(e){return!!e&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(e)}function Cr(e,t){e.forEach(function(r){t[r]&&(t[r]=t[r].bind(t))})}function Gt(e,t){return e.indexOf(t,e.length-t.length)!==-1}function ar(e,t,r){var c={};for(var v in e)c[v]=t.call(r||this,e[v],v,e);return c}function gt(e,t,r){var c={};for(var v in e)t.call(r||this,e[v],v,e)&&(c[v]=e[v]);return c}function Ye(e){return Array.isArray(e)?e.map(Ye):typeof e=="object"&&e?ar(e,Ye):e}var Et={};function Ne(e){Et[e]||(typeof console!="undefined"&&console.warn(e),Et[e]=!0)}function Ae(e,t,r){return(r.y-e.y)*(t.x-e.x)>(t.y-e.y)*(r.x-e.x)}function Be(e){for(var t=0,r=0,c=e.length,v=c-1,m=void 0,_=void 0;r<c;v=r++)t+=((_=e[v]).x-(m=e[r]).x)*(m.y+_.y);return t}function bt(){return typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope}function ir(e){var t={};if(e.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,function(c,v,m,_){var C=m||_;return t[v]=!C||C.toLowerCase(),""}),t["max-age"]){var r=parseInt(t["max-age"],10);isNaN(r)?delete t["max-age"]:t["max-age"]=r}return t}var re=null;function Ee(e){if(re==null){var t=e.navigator?e.navigator.userAgent:null;re=!!e.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return re}function ae(e){try{var t=ne[e];return t.setItem("_mapbox_test_",1),t.removeItem("_mapbox_test_"),!0}catch(r){return!1}}var me,Te,Qe,dt,Jt=ne.performance&&ne.performance.now?ne.performance.now.bind(ne.performance):Date.now.bind(Date),Nr=ne.requestAnimationFrame||ne.mozRequestAnimationFrame||ne.webkitRequestAnimationFrame||ne.msRequestAnimationFrame,Fr=ne.cancelAnimationFrame||ne.mozCancelAnimationFrame||ne.webkitCancelAnimationFrame||ne.msCancelAnimationFrame,ln={now:Jt,frame:function(e){var t=Nr(e);return{cancel:function(){return Fr(t)}}},getImageData:function(e,t){t===void 0&&(t=0);var r=ne.document.createElement("canvas"),c=r.getContext("2d");if(!c)throw new Error("failed to create canvas 2d context");return r.width=e.width,r.height=e.height,c.drawImage(e,0,0,e.width,e.height),c.getImageData(-t,-t,e.width+2*t,e.height+2*t)},resolveURL:function(e){return me||(me=ne.document.createElement("a")),me.href=e,me.href},hardwareConcurrency:ne.navigator&&ne.navigator.hardwareConcurrency||4,get devicePixelRatio(){return ne.devicePixelRatio},get prefersReducedMotion(){return!!ne.matchMedia&&(Te==null&&(Te=ne.matchMedia("(prefers-reduced-motion: reduce)")),Te.matches)}},tr={API_URL:"https://api.mapbox.com",get EVENTS_URL(){return this.API_URL?this.API_URL.indexOf("https://api.mapbox.cn")===0?"https://events.mapbox.cn/events/v2":this.API_URL.indexOf("https://api.mapbox.com")===0?"https://events.mapbox.com/events/v2":null:null},FEEDBACK_URL:"https://apps.mapbox.com/feedback",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},se={supported:!1,testSupport:function(e){!ge&&dt&&(Re?tt(e):Qe=e)}},ge=!1,Re=!1;function tt(e){var t=e.createTexture();e.bindTexture(e.TEXTURE_2D,t);try{if(e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,dt),e.isContextLost())return;se.supported=!0}catch(r){}e.deleteTexture(t),ge=!0}ne.document&&((dt=ne.document.createElement("img")).onload=function(){Qe&&tt(Qe),Qe=null,Re=!0},dt.onerror=function(){ge=!0,Qe=null},dt.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");var Mt="01",Dt=function(e,t){this._transformRequestFn=e,this._customAccessToken=t,this._createSkuToken()};function S(e){return e.indexOf("mapbox:")===0}Dt.prototype._createSkuToken=function(){var e=function(){for(var t="",r=0;r<10;r++)t+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Mt,t].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=e.token,this._skuTokenExpiresAt=e.tokenExpiresAt},Dt.prototype._isSkuTokenExpired=function(){return Date.now()>this._skuTokenExpiresAt},Dt.prototype.transformRequest=function(e,t){return this._transformRequestFn&&this._transformRequestFn(e,t)||{url:e}},Dt.prototype.normalizeStyleURL=function(e,t){if(!S(e))return e;var r=Je(e);return r.path="/styles/v1"+r.path,this._makeAPIURL(r,this._customAccessToken||t)},Dt.prototype.normalizeGlyphsURL=function(e,t){if(!S(e))return e;var r=Je(e);return r.path="/fonts/v1"+r.path,this._makeAPIURL(r,this._customAccessToken||t)},Dt.prototype.normalizeSourceURL=function(e,t){if(!S(e))return e;var r=Je(e);return r.path="/v4/"+r.authority+".json",r.params.push("secure"),this._makeAPIURL(r,this._customAccessToken||t)},Dt.prototype.normalizeSpriteURL=function(e,t,r,c){var v=Je(e);return S(e)?(v.path="/styles/v1"+v.path+"/sprite"+t+r,this._makeAPIURL(v,this._customAccessToken||c)):(v.path+=""+t+r,mt(v))},Dt.prototype.normalizeTileURL=function(e,t){if(this._isSkuTokenExpired()&&this._createSkuToken(),e&&!S(e))return e;var r=Je(e);r.path=r.path.replace(/(\.(png|jpg)\d*)(?=$)/,(ln.devicePixelRatio>=2||t===512?"@2x":"")+(se.supported?".webp":"$1")),r.path=r.path.replace(/^.+\/v4\//,"/"),r.path="/v4"+r.path;var c=this._customAccessToken||function(v){for(var m=0,_=v;m<_.length;m+=1){var C=_[m].match(/^access_token=(.*)$/);if(C)return C[1]}return null}(r.params)||tr.ACCESS_TOKEN;return tr.REQUIRE_ACCESS_TOKEN&&c&&this._skuToken&&r.params.push("sku="+this._skuToken),this._makeAPIURL(r,c)},Dt.prototype.canonicalizeTileURL=function(e,t){var r=Je(e);if(!r.path.match(/(^\/v4\/)/)||!r.path.match(/\.[\w]+$/))return e;var c="mapbox://tiles/";c+=r.path.replace("/v4/","");var v=r.params;return t&&(v=v.filter(function(m){return!m.match(/^access_token=/)})),v.length&&(c+="?"+v.join("&")),c},Dt.prototype.canonicalizeTileset=function(e,t){for(var r=!!t&&S(t),c=[],v=0,m=e.tiles||[];v<m.length;v+=1){var _=m[v];pe(_)?c.push(this.canonicalizeTileURL(_,r)):c.push(_)}return c},Dt.prototype._makeAPIURL=function(e,t){var r="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",c=Je(tr.API_URL);if(e.protocol=c.protocol,e.authority=c.authority,e.protocol==="http"){var v=e.params.indexOf("secure");v>=0&&e.params.splice(v,1)}if(c.path!=="/"&&(e.path=""+c.path+e.path),!tr.REQUIRE_ACCESS_TOKEN)return mt(e);if(!(t=t||tr.ACCESS_TOKEN))throw new Error("An API access token is required to use Mapbox GL. "+r);if(t[0]==="s")throw new Error("Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). "+r);return e.params=e.params.filter(function(m){return m.indexOf("access_token")===-1}),e.params.push("access_token="+t),mt(e)};var z=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;function pe(e){return z.test(e)}var Ue=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Je(e){var t=e.match(Ue);if(!t)throw new Error("Unable to parse URL object");return{protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}function mt(e){var t=e.params.length?"?"+e.params.join("&"):"";return e.protocol+"://"+e.authority+e.path+t}function Ct(e){if(!e)return null;var t=e.split(".");if(!t||t.length!==3)return null;try{return JSON.parse(decodeURIComponent(ne.atob(t[1]).split("").map(function(r){return"%"+("00"+r.charCodeAt(0).toString(16)).slice(-2)}).join("")))}catch(r){return null}}var H=function(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null};H.prototype.getStorageKey=function(e){var t,r=Ct(tr.ACCESS_TOKEN);return t=r&&r.u?ne.btoa(encodeURIComponent(r.u).replace(/%([0-9A-F]{2})/g,function(c,v){return String.fromCharCode(Number("0x"+v))})):tr.ACCESS_TOKEN||"",e?"mapbox.eventData."+e+":"+t:"mapbox.eventData:"+t},H.prototype.fetchEventData=function(){var e=ae("localStorage"),t=this.getStorageKey(),r=this.getStorageKey("uuid");if(e)try{var c=ne.localStorage.getItem(t);c&&(this.eventData=JSON.parse(c));var v=ne.localStorage.getItem(r);v&&(this.anonId=v)}catch(m){Ne("Unable to read from LocalStorage")}},H.prototype.saveEventData=function(){var e=ae("localStorage"),t=this.getStorageKey(),r=this.getStorageKey("uuid");if(e)try{ne.localStorage.setItem(r,this.anonId),Object.keys(this.eventData).length>=1&&ne.localStorage.setItem(t,JSON.stringify(this.eventData))}catch(c){Ne("Unable to write to LocalStorage")}},H.prototype.processRequests=function(e){},H.prototype.postEvent=function(e,t,r,c){var v=this;if(tr.EVENTS_URL){var m=Je(tr.EVENTS_URL);m.params.push("access_token="+(c||tr.ACCESS_TOKEN||""));var _={event:this.type,created:new Date(e).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"1.13.1",skuId:Mt,userId:this.anonId},C=t?Xt(_,t):_,k={url:mt(m),headers:{"Content-Type":"text/plain"},body:JSON.stringify([C])};this.pendingRequest=si(k,function(B){v.pendingRequest=null,r(B),v.saveEventData(),v.processRequests(c)})}},H.prototype.queueRequest=function(e,t){this.queue.push(e),this.processRequests(t)};var Ht,Vt,_r=function(e){function t(){e.call(this,"map.load"),this.success={},this.skuToken=""}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.postMapLoadEvent=function(r,c,v,m){this.skuToken=v,(tr.EVENTS_URL&&m||tr.ACCESS_TOKEN&&Array.isArray(r)&&r.some(function(_){return S(_)||pe(_)}))&&this.queueRequest({id:c,timestamp:Date.now()},m)},t.prototype.processRequests=function(r){var c=this;if(!this.pendingRequest&&this.queue.length!==0){var v=this.queue.shift(),m=v.id,_=v.timestamp;m&&this.success[m]||(this.anonId||this.fetchEventData(),pt(this.anonId)||(this.anonId=_t()),this.postEvent(_,{skuToken:this.skuToken},function(C){C||m&&(c.success[m]=!0)},r))}},t}(H),Er=new(function(e){function t(r){e.call(this,"appUserTurnstile"),this._customAccessToken=r}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.postTurnstileEvent=function(r,c){tr.EVENTS_URL&&tr.ACCESS_TOKEN&&Array.isArray(r)&&r.some(function(v){return S(v)||pe(v)})&&this.queueRequest(Date.now(),c)},t.prototype.processRequests=function(r){var c=this;if(!this.pendingRequest&&this.queue.length!==0){this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();var v=Ct(tr.ACCESS_TOKEN),m=v?v.u:tr.ACCESS_TOKEN,_=m!==this.eventData.tokenU;pt(this.anonId)||(this.anonId=_t(),_=!0);var C=this.queue.shift();if(this.eventData.lastSuccess){var k=new Date(this.eventData.lastSuccess),B=new Date(C),W=(C-this.eventData.lastSuccess)/864e5;_=_||W>=1||W<-1||k.getDate()!==B.getDate()}else _=!0;if(!_)return this.processRequests();this.postEvent(C,{"enabled.telemetry":!1},function(K){K||(c.eventData.lastSuccess=C,c.eventData.tokenU=m)},r)}},t}(H)),Ar=Er.postTurnstileEvent.bind(Er),Pr=new _r,Ke=Pr.postMapLoadEvent.bind(Pr),yt=500,lt=50;function lr(){ne.caches&&!Ht&&(Ht=ne.caches.open("mapbox-tiles"))}function qr(e){var t=e.indexOf("?");return t<0?e:e.slice(0,t)}var ut,It=1/0;function Qt(){return ut==null&&(ut=ne.OffscreenCanvas&&new ne.OffscreenCanvas(1,1).getContext("2d")&&typeof ne.createImageBitmap=="function"),ut}var gr={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(gr);var gn=function(e){function t(r,c,v){c===401&&pe(v)&&(r+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),e.call(this,r),this.status=c,this.url=v,this.name=this.constructor.name,this.message=r}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.toString=function(){return this.name+": "+this.message+" ("+this.status+"): "+this.url},t}(Error),Cn=bt()?function(){return self.worker&&self.worker.referrer}:function(){return(ne.location.protocol==="blob:"?ne.parent:ne).location.href},vi,xi,Ri=function(e,t){if(!(/^file:/.test(r=e.url)||/^file:/.test(Cn())&&!/^\w+:/.test(r))){if(ne.fetch&&ne.Request&&ne.AbortController&&ne.Request.prototype.hasOwnProperty("signal"))return function(c,v){var m,_=new ne.AbortController,C=new ne.Request(c.url,{method:c.method||"GET",body:c.body,credentials:c.credentials,headers:c.headers,referrer:Cn(),signal:_.signal}),k=!1,B=!1,W=(m=C.url).indexOf("sku=")>0&&pe(m);c.type==="json"&&C.headers.set("Accept","application/json");var K=function(ce,Ve,We){if(!B){if(ce&&ce.message!=="SecurityError"&&Ne(ce),Ve&&We)return oe(Ve);var st=Date.now();ne.fetch(C).then(function(et){if(et.ok){var Tt=W?et.clone():null;return oe(et,Tt,st)}return v(new gn(et.statusText,et.status,c.url))}).catch(function(et){et.code!==20&&v(new Error(et.message))})}},oe=function(ce,Ve,We){(c.type==="arrayBuffer"?ce.arrayBuffer():c.type==="json"?ce.json():ce.text()).then(function(st){B||(Ve&&We&&function(et,Tt,Ut){if(lr(),Ht){var nr={status:Tt.status,statusText:Tt.statusText,headers:new ne.Headers};Tt.headers.forEach(function(Mr,Yr){return nr.headers.set(Yr,Mr)});var hr=ir(Tt.headers.get("Cache-Control")||"");hr["no-store"]||(hr["max-age"]&&nr.headers.set("Expires",new Date(Ut+1e3*hr["max-age"]).toUTCString()),new Date(nr.headers.get("Expires")).getTime()-Ut<42e4||function(Mr,Yr){if(Vt===void 0)try{new Response(new ReadableStream),Vt=!0}catch(hn){Vt=!1}Vt?Yr(Mr.body):Mr.blob().then(Yr)}(Tt,function(Mr){var Yr=new ne.Response(Mr,nr);lr(),Ht&&Ht.then(function(hn){return hn.put(qr(et.url),Yr)}).catch(function(hn){return Ne(hn.message)})}))}}(C,Ve,We),k=!0,v(null,st,ce.headers.get("Cache-Control"),ce.headers.get("Expires")))}).catch(function(st){B||v(new Error(st.message))})};return W?function(ce,Ve){if(lr(),!Ht)return Ve(null);var We=qr(ce.url);Ht.then(function(st){st.match(We).then(function(et){var Tt=function(Ut){if(!Ut)return!1;var nr=new Date(Ut.headers.get("Expires")||0),hr=ir(Ut.headers.get("Cache-Control")||"");return nr>Date.now()&&!hr["no-cache"]}(et);st.delete(We),Tt&&st.put(We,et.clone()),Ve(null,et,Tt)}).catch(Ve)}).catch(Ve)}(C,K):K(null,null),{cancel:function(){B=!0,k||_.abort()}}}(e,t);if(bt()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",e,t,void 0,!0)}var r;return function(c,v){var m=new ne.XMLHttpRequest;for(var _ in m.open(c.method||"GET",c.url,!0),c.type==="arrayBuffer"&&(m.responseType="arraybuffer"),c.headers)m.setRequestHeader(_,c.headers[_]);return c.type==="json"&&(m.responseType="text",m.setRequestHeader("Accept","application/json")),m.withCredentials=c.credentials==="include",m.onerror=function(){v(new Error(m.statusText))},m.onload=function(){if((m.status>=200&&m.status<300||m.status===0)&&m.response!==null){var C=m.response;if(c.type==="json")try{C=JSON.parse(m.response)}catch(k){return v(k)}v(null,C,m.getResponseHeader("Cache-Control"),m.getResponseHeader("Expires"))}else v(new gn(m.statusText,m.status,c.url))},m.send(c.body),{cancel:function(){return m.abort()}}}(e,t)},Wi=function(e,t){return Ri(Xt(e,{type:"arrayBuffer"}),t)},si=function(e,t){return Ri(Xt(e,{method:"POST"}),t)},G="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";vi=[],xi=0;var I=function(e,t){if(se.supported&&(e.headers||(e.headers={}),e.headers.accept="image/webp,*/*"),xi>=tr.MAX_PARALLEL_IMAGE_REQUESTS){var r={requestParameters:e,callback:t,cancelled:!1,cancel:function(){this.cancelled=!0}};return vi.push(r),r}xi++;var c=!1,v=function(){if(!c)for(c=!0,xi--;vi.length&&xi<tr.MAX_PARALLEL_IMAGE_REQUESTS;){var _=vi.shift();_.cancelled||(_.cancel=I(_.requestParameters,_.callback).cancel)}},m=Wi(e,function(_,C,k,B){v(),_?t(_):C&&(Qt()?function(W,K){var oe=new ne.Blob([new Uint8Array(W)],{type:"image/png"});ne.createImageBitmap(oe).then(function(ce){K(null,ce)}).catch(function(ce){K(new Error("Could not load image because of "+ce.message+". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))})}(C,t):function(W,K,oe,ce){var Ve=new ne.Image,We=ne.URL;Ve.onload=function(){K(null,Ve),We.revokeObjectURL(Ve.src),Ve.onload=null,ne.requestAnimationFrame(function(){Ve.src=G})},Ve.onerror=function(){return K(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var st=new ne.Blob([new Uint8Array(W)],{type:"image/png"});Ve.cacheControl=oe,Ve.expires=ce,Ve.src=W.byteLength?We.createObjectURL(st):G}(C,t,k,B))});return{cancel:function(){m.cancel(),v()}}};function Z(e,t,r){r[e]&&r[e].indexOf(t)!==-1||(r[e]=r[e]||[],r[e].push(t))}function $(e,t,r){if(r&&r[e]){var c=r[e].indexOf(t);c!==-1&&r[e].splice(c,1)}}var ie=function(e,t){t===void 0&&(t={}),Xt(this,t),this.type=e},Le=function(e){function t(r,c){c===void 0&&(c={}),e.call(this,"error",Xt({error:r},c))}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t}(ie),Ge=function(){};Ge.prototype.on=function(e,t){return this._listeners=this._listeners||{},Z(e,t,this._listeners),this},Ge.prototype.off=function(e,t){return $(e,t,this._listeners),$(e,t,this._oneTimeListeners),this},Ge.prototype.once=function(e,t){return this._oneTimeListeners=this._oneTimeListeners||{},Z(e,t,this._oneTimeListeners),this},Ge.prototype.fire=function(e,t){typeof e=="string"&&(e=new ie(e,t||{}));var r=e.type;if(this.listens(r)){e.target=this;for(var c=0,v=this._listeners&&this._listeners[r]?this._listeners[r].slice():[];c<v.length;c+=1)v[c].call(this,e);for(var m=0,_=this._oneTimeListeners&&this._oneTimeListeners[r]?this._oneTimeListeners[r].slice():[];m<_.length;m+=1){var C=_[m];$(r,C,this._oneTimeListeners),C.call(this,e)}var k=this._eventedParent;k&&(Xt(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),k.fire(e))}else e instanceof Le&&console.error(e.error);return this},Ge.prototype.listens=function(e){return this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e)},Ge.prototype.setEventedParent=function(e,t){return this._eventedParent=e,this._eventedParentData=t,this};var ue={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}},De=function(e,t,r,c){this.message=(e?e+": ":"")+r,c&&(this.identifier=c),t!=null&&t.__line__&&(this.line=t.__line__)};function wt(e){var t=e.value;return t?[new De(e.key,t,"constants have been deprecated as of v8")]:[]}function Ir(e){for(var t=[],r=arguments.length-1;r-- >0;)t[r]=arguments[r+1];for(var c=0,v=t;c<v.length;c+=1){var m=v[c];for(var _ in m)e[_]=m[_]}return e}function Ur(e){return e instanceof Number||e instanceof String||e instanceof Boolean?e.valueOf():e}function jt(e){if(Array.isArray(e))return e.map(jt);if(e instanceof Object&&!(e instanceof Number||e instanceof String||e instanceof Boolean)){var t={};for(var r in e)t[r]=jt(e[r]);return t}return Ur(e)}var dr=function(e){function t(r,c){e.call(this,c),this.message=c,this.key=r}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t}(Error),Hr=function(e,t){t===void 0&&(t=[]),this.parent=e,this.bindings={};for(var r=0,c=t;r<c.length;r+=1){var v=c[r];this.bindings[v[0]]=v[1]}};Hr.prototype.concat=function(e){return new Hr(this,e)},Hr.prototype.get=function(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(e+" not found in scope.")},Hr.prototype.has=function(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)};var _n={kind:"null"},vr={kind:"number"},vn={kind:"string"},$r={kind:"boolean"},cn={kind:"color"},pi={kind:"object"},pn={kind:"value"},_i={kind:"collator"},Xi={kind:"formatted"},mi={kind:"resolvedImage"};function Di(e,t){return{kind:"array",itemType:e,N:t}}function Pi(e){if(e.kind==="array"){var t=Pi(e.itemType);return typeof e.N=="number"?"array<"+t+", "+e.N+">":e.itemType.kind==="value"?"array":"array<"+t+">"}return e.kind}var po=[_n,vr,vn,$r,cn,Xi,pi,Di(pn),mi];function ji(e,t){if(t.kind==="error")return null;if(e.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!ji(e.itemType,t.itemType))&&(typeof e.N!="number"||e.N===t.N))return null}else{if(e.kind===t.kind)return null;if(e.kind==="value"){for(var r=0,c=po;r<c.length;r+=1)if(!ji(c[r],t))return null}}return"Expected "+Pi(e)+" but found "+Pi(t)+" instead."}function Rn(e,t){return t.some(function(r){return r.kind===e.kind})}function Dn(e,t){return t.some(function(r){return r==="null"?e===null:r==="array"?Array.isArray(e):r==="object"?e&&!Array.isArray(e)&&typeof e=="object":r===typeof e})}var li=w(function(e,t){var r={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function c(C){return(C=Math.round(C))<0?0:C>255?255:C}function v(C){return c(C[C.length-1]==="%"?parseFloat(C)/100*255:parseInt(C))}function m(C){return(k=C[C.length-1]==="%"?parseFloat(C)/100:parseFloat(C))<0?0:k>1?1:k;var k}function _(C,k,B){return B<0?B+=1:B>1&&(B-=1),6*B<1?C+(k-C)*B*6:2*B<1?k:3*B<2?C+(k-C)*(2/3-B)*6:C}try{t.parseCSSColor=function(C){var k,B=C.replace(/ /g,"").toLowerCase();if(B in r)return r[B].slice();if(B[0]==="#")return B.length===4?(k=parseInt(B.substr(1),16))>=0&&k<=4095?[(3840&k)>>4|(3840&k)>>8,240&k|(240&k)>>4,15&k|(15&k)<<4,1]:null:B.length===7&&(k=parseInt(B.substr(1),16))>=0&&k<=16777215?[(16711680&k)>>16,(65280&k)>>8,255&k,1]:null;var W=B.indexOf("("),K=B.indexOf(")");if(W!==-1&&K+1===B.length){var oe=B.substr(0,W),ce=B.substr(W+1,K-(W+1)).split(","),Ve=1;switch(oe){case"rgba":if(ce.length!==4)return null;Ve=m(ce.pop());case"rgb":return ce.length!==3?null:[v(ce[0]),v(ce[1]),v(ce[2]),Ve];case"hsla":if(ce.length!==4)return null;Ve=m(ce.pop());case"hsl":if(ce.length!==3)return null;var We=(parseFloat(ce[0])%360+360)%360/360,st=m(ce[1]),et=m(ce[2]),Tt=et<=.5?et*(st+1):et+st-et*st,Ut=2*et-Tt;return[c(255*_(Ut,Tt,We+1/3)),c(255*_(Ut,Tt,We)),c(255*_(Ut,Tt,We-1/3)),Ve];default:return null}}return null}}catch(C){}}).parseCSSColor,Vn=function(e,t,r,c){c===void 0&&(c=1),this.r=e,this.g=t,this.b=r,this.a=c};Vn.parse=function(e){if(e){if(e instanceof Vn)return e;if(typeof e=="string"){var t=li(e);if(t)return new Vn(t[0]/255*t[3],t[1]/255*t[3],t[2]/255*t[3],t[3])}}},Vn.prototype.toString=function(){var e=this.toArray(),t=e[1],r=e[2],c=e[3];return"rgba("+Math.round(e[0])+","+Math.round(t)+","+Math.round(r)+","+c+")"},Vn.prototype.toArray=function(){var e=this.a;return e===0?[0,0,0,0]:[255*this.r/e,255*this.g/e,255*this.b/e,e]},Vn.black=new Vn(0,0,0,1),Vn.white=new Vn(1,1,1,1),Vn.transparent=new Vn(0,0,0,0),Vn.red=new Vn(1,0,0,1);var Na=function(e,t,r){this.sensitivity=e?t?"variant":"case":t?"accent":"base",this.locale=r,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})};Na.prototype.compare=function(e,t){return this.collator.compare(e,t)},Na.prototype.resolvedLocale=function(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale};var ps=function(e,t,r,c,v){this.text=e,this.image=t,this.scale=r,this.fontStack=c,this.textColor=v},ki=function(e){this.sections=e};ki.fromString=function(e){return new ki([new ps(e,null,null,null,null)])},ki.prototype.isEmpty=function(){return this.sections.length===0||!this.sections.some(function(e){return e.text.length!==0||e.image&&e.image.name.length!==0})},ki.factory=function(e){return e instanceof ki?e:ki.fromString(e)},ki.prototype.toString=function(){return this.sections.length===0?"":this.sections.map(function(e){return e.text}).join("")},ki.prototype.serialize=function(){for(var e=["format"],t=0,r=this.sections;t<r.length;t+=1){var c=r[t];if(c.image)e.push(["image",c.image.name]);else{e.push(c.text);var v={};c.fontStack&&(v["text-font"]=["literal",c.fontStack.split(",")]),c.scale&&(v["font-scale"]=c.scale),c.textColor&&(v["text-color"]=["rgba"].concat(c.textColor.toArray())),e.push(v)}}return e};var Ba=function(e){this.name=e.name,this.available=e.available};function xu(e,t,r,c){return typeof e=="number"&&e>=0&&e<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof r=="number"&&r>=0&&r<=255?c===void 0||typeof c=="number"&&c>=0&&c<=1?null:"Invalid rgba value ["+[e,t,r,c].join(", ")+"]: 'a' must be between 0 and 1.":"Invalid rgba value ["+(typeof c=="number"?[e,t,r,c]:[e,t,r]).join(", ")+"]: 'r', 'g', and 'b' must be between 0 and 255."}function uu(e){if(e===null||typeof e=="string"||typeof e=="boolean"||typeof e=="number"||e instanceof Vn||e instanceof Na||e instanceof ki||e instanceof Ba)return!0;if(Array.isArray(e)){for(var t=0,r=e;t<r.length;t+=1)if(!uu(r[t]))return!1;return!0}if(typeof e=="object"){for(var c in e)if(!uu(e[c]))return!1;return!0}return!1}function _a(e){if(e===null)return _n;if(typeof e=="string")return vn;if(typeof e=="boolean")return $r;if(typeof e=="number")return vr;if(e instanceof Vn)return cn;if(e instanceof Na)return _i;if(e instanceof ki)return Xi;if(e instanceof Ba)return mi;if(Array.isArray(e)){for(var t,r=e.length,c=0,v=e;c<v.length;c+=1){var m=_a(v[c]);if(t){if(t===m)continue;t=pn;break}t=m}return Di(t||pn,r)}return pi}function oo(e){var t=typeof e;return e===null?"":t==="string"||t==="number"||t==="boolean"?String(e):e instanceof Vn||e instanceof ki||e instanceof Ba?e.toString():JSON.stringify(e)}Ba.prototype.toString=function(){return this.name},Ba.fromString=function(e){return e?new Ba({name:e,available:!1}):null},Ba.prototype.serialize=function(){return["image",this.name]};var Wa=function(e,t){this.type=e,this.value=t};Wa.parse=function(e,t){if(e.length!==2)return t.error("'literal' expression requires exactly one argument, but found "+(e.length-1)+" instead.");if(!uu(e[1]))return t.error("invalid value");var r=e[1],c=_a(r),v=t.expectedType;return c.kind!=="array"||c.N!==0||!v||v.kind!=="array"||typeof v.N=="number"&&v.N!==0||(c=v),new Wa(c,r)},Wa.prototype.evaluate=function(){return this.value},Wa.prototype.eachChild=function(){},Wa.prototype.outputDefined=function(){return!0},Wa.prototype.serialize=function(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Vn?["rgba"].concat(this.value.toArray()):this.value instanceof ki?this.value.serialize():this.value};var Xa=function(e){this.name="ExpressionEvaluationError",this.message=e};Xa.prototype.toJSON=function(){return this.message};var Wo={string:vn,number:vr,boolean:$r,object:pi},sa=function(e,t){this.type=e,this.args=t};sa.parse=function(e,t){if(e.length<2)return t.error("Expected at least one argument.");var r,c=1,v=e[0];if(v==="array"){var m,_;if(e.length>2){var C=e[1];if(typeof C!="string"||!(C in Wo)||C==="object")return t.error('The item type argument of "array" must be one of string, number, boolean',1);m=Wo[C],c++}else m=pn;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return t.error('The length argument to "array" must be a positive integer literal',2);_=e[2],c++}r=Di(m,_)}else r=Wo[v];for(var k=[];c<e.length;c++){var B=t.parse(e[c],c,pn);if(!B)return null;k.push(B)}return new sa(r,k)},sa.prototype.evaluate=function(e){for(var t=0;t<this.args.length;t++){var r=this.args[t].evaluate(e);if(!ji(this.type,_a(r)))return r;if(t===this.args.length-1)throw new Xa("Expected value to be of type "+Pi(this.type)+", but found "+Pi(_a(r))+" instead.")}return null},sa.prototype.eachChild=function(e){this.args.forEach(e)},sa.prototype.outputDefined=function(){return this.args.every(function(e){return e.outputDefined()})},sa.prototype.serialize=function(){var e=this.type,t=[e.kind];if(e.kind==="array"){var r=e.itemType;if(r.kind==="string"||r.kind==="number"||r.kind==="boolean"){t.push(r.kind);var c=e.N;(typeof c=="number"||this.args.length>1)&&t.push(c)}}return t.concat(this.args.map(function(v){return v.serialize()}))};var Ya=function(e){this.type=Xi,this.sections=e};Ya.parse=function(e,t){if(e.length<2)return t.error("Expected at least one argument.");var r=e[1];if(!Array.isArray(r)&&typeof r=="object")return t.error("First argument must be an image or text section.");for(var c=[],v=!1,m=1;m<=e.length-1;++m){var _=e[m];if(v&&typeof _=="object"&&!Array.isArray(_)){v=!1;var C=null;if(_["font-scale"]&&!(C=t.parse(_["font-scale"],1,vr)))return null;var k=null;if(_["text-font"]&&!(k=t.parse(_["text-font"],1,Di(vn))))return null;var B=null;if(_["text-color"]&&!(B=t.parse(_["text-color"],1,cn)))return null;var W=c[c.length-1];W.scale=C,W.font=k,W.textColor=B}else{var K=t.parse(e[m],1,pn);if(!K)return null;var oe=K.type.kind;if(oe!=="string"&&oe!=="value"&&oe!=="null"&&oe!=="resolvedImage")return t.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");v=!0,c.push({content:K,scale:null,font:null,textColor:null})}}return new Ya(c)},Ya.prototype.evaluate=function(e){return new ki(this.sections.map(function(t){var r=t.content.evaluate(e);return _a(r)===mi?new ps("",r,null,null,null):new ps(oo(r),null,t.scale?t.scale.evaluate(e):null,t.font?t.font.evaluate(e).join(","):null,t.textColor?t.textColor.evaluate(e):null)}))},Ya.prototype.eachChild=function(e){for(var t=0,r=this.sections;t<r.length;t+=1){var c=r[t];e(c.content),c.scale&&e(c.scale),c.font&&e(c.font),c.textColor&&e(c.textColor)}},Ya.prototype.outputDefined=function(){return!1},Ya.prototype.serialize=function(){for(var e=["format"],t=0,r=this.sections;t<r.length;t+=1){var c=r[t];e.push(c.content.serialize());var v={};c.scale&&(v["font-scale"]=c.scale.serialize()),c.font&&(v["text-font"]=c.font.serialize()),c.textColor&&(v["text-color"]=c.textColor.serialize()),e.push(v)}return e};var Ta=function(e){this.type=mi,this.input=e};Ta.parse=function(e,t){if(e.length!==2)return t.error("Expected two arguments.");var r=t.parse(e[1],1,vn);return r?new Ta(r):t.error("No image name provided.")},Ta.prototype.evaluate=function(e){var t=this.input.evaluate(e),r=Ba.fromString(t);return r&&e.availableImages&&(r.available=e.availableImages.indexOf(t)>-1),r},Ta.prototype.eachChild=function(e){e(this.input)},Ta.prototype.outputDefined=function(){return!1},Ta.prototype.serialize=function(){return["image",this.input.serialize()]};var xa={"to-boolean":$r,"to-color":cn,"to-number":vr,"to-string":vn},ta=function(e,t){this.type=e,this.args=t};ta.parse=function(e,t){if(e.length<2)return t.error("Expected at least one argument.");var r=e[0];if((r==="to-boolean"||r==="to-string")&&e.length!==2)return t.error("Expected one argument.");for(var c=xa[r],v=[],m=1;m<e.length;m++){var _=t.parse(e[m],m,pn);if(!_)return null;v.push(_)}return new ta(c,v)},ta.prototype.evaluate=function(e){if(this.type.kind==="boolean")return Boolean(this.args[0].evaluate(e));if(this.type.kind==="color"){for(var t,r,c=0,v=this.args;c<v.length;c+=1){if(r=null,(t=v[c].evaluate(e))instanceof Vn)return t;if(typeof t=="string"){var m=e.parseColor(t);if(m)return m}else if(Array.isArray(t)&&!(r=t.length<3||t.length>4?"Invalid rbga value "+JSON.stringify(t)+": expected an array containing either three or four numeric values.":xu(t[0],t[1],t[2],t[3])))return new Vn(t[0]/255,t[1]/255,t[2]/255,t[3])}throw new Xa(r||"Could not parse color from value '"+(typeof t=="string"?t:String(JSON.stringify(t)))+"'")}if(this.type.kind==="number"){for(var _=null,C=0,k=this.args;C<k.length;C+=1){if((_=k[C].evaluate(e))===null)return 0;var B=Number(_);if(!isNaN(B))return B}throw new Xa("Could not convert "+JSON.stringify(_)+" to number.")}return this.type.kind==="formatted"?ki.fromString(oo(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?Ba.fromString(oo(this.args[0].evaluate(e))):oo(this.args[0].evaluate(e))},ta.prototype.eachChild=function(e){this.args.forEach(e)},ta.prototype.outputDefined=function(){return this.args.every(function(e){return e.outputDefined()})},ta.prototype.serialize=function(){if(this.type.kind==="formatted")return new Ya([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Ta(this.args[0]).serialize();var e=["to-"+this.type.kind];return this.eachChild(function(t){e.push(t.serialize())}),e};var sl=["Unknown","Point","LineString","Polygon"],rs=function(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null};rs.prototype.id=function(){return this.feature&&"id"in this.feature?this.feature.id:null},rs.prototype.geometryType=function(){return this.feature?typeof this.feature.type=="number"?sl[this.feature.type]:this.feature.type:null},rs.prototype.geometry=function(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null},rs.prototype.canonicalID=function(){return this.canonical},rs.prototype.properties=function(){return this.feature&&this.feature.properties||{}},rs.prototype.parseColor=function(e){var t=this._parseColorCache[e];return t||(t=this._parseColorCache[e]=Vn.parse(e)),t};var qa=function(e,t,r,c){this.name=e,this.type=t,this._evaluate=r,this.args=c};qa.prototype.evaluate=function(e){return this._evaluate(e,this.args)},qa.prototype.eachChild=function(e){this.args.forEach(e)},qa.prototype.outputDefined=function(){return!1},qa.prototype.serialize=function(){return[this.name].concat(this.args.map(function(e){return e.serialize()}))},qa.parse=function(e,t){var r,c=e[0],v=qa.definitions[c];if(!v)return t.error('Unknown expression "'+c+'". If you wanted a literal array, use ["literal", [...]].',0);for(var m=Array.isArray(v)?v[0]:v.type,_=Array.isArray(v)?[[v[1],v[2]]]:v.overloads,C=_.filter(function(Jn){var yn=Jn[0];return!Array.isArray(yn)||yn.length===e.length-1}),k=null,B=0,W=C;B<W.length;B+=1){var K=W[B],oe=K[0],ce=K[1];k=new ci(t.registry,t.path,null,t.scope);for(var Ve=[],We=!1,st=1;st<e.length;st++){var et=e[st],Tt=Array.isArray(oe)?oe[st-1]:oe.type,Ut=k.parse(et,1+Ve.length,Tt);if(!Ut){We=!0;break}Ve.push(Ut)}if(!We)if(Array.isArray(oe)&&oe.length!==Ve.length)k.error("Expected "+oe.length+" arguments, but found "+Ve.length+" instead.");else{for(var nr=0;nr<Ve.length;nr++){var hr=Array.isArray(oe)?oe[nr]:oe.type,Mr=Ve[nr];k.concat(nr+1).checkSubtype(hr,Mr.type)}if(k.errors.length===0)return new qa(c,m,ce,Ve)}}if(C.length===1)(r=t.errors).push.apply(r,k.errors);else{for(var Yr=(C.length?C:_).map(function(Jn){var yn;return yn=Jn[0],Array.isArray(yn)?"("+yn.map(Pi).join(", ")+")":"("+Pi(yn.type)+"...)"}).join(" | "),hn=[],Hn=1;Hn<e.length;Hn++){var wn=t.parse(e[Hn],1+hn.length);if(!wn)return null;hn.push(Pi(wn.type))}t.error("Expected arguments of type "+Yr+", but found ("+hn.join(", ")+") instead.")}return null},qa.register=function(e,t){for(var r in qa.definitions=t,t)e[r]=qa};var La=function(e,t,r){this.type=_i,this.locale=r,this.caseSensitive=e,this.diacriticSensitive=t};function fa(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.max(e[2],t[0]),e[3]=Math.max(e[3],t[1])}function he(e,t){return!(e[0]<=t[0]||e[2]>=t[2]||e[1]<=t[1]||e[3]>=t[3])}function Pe(e,t){var r=(180+e[0])/360,c=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e[1]*Math.PI/360)))/360,v=Math.pow(2,t.z);return[Math.round(r*v*8192),Math.round(c*v*8192)]}function ct(e,t,r){return t[1]>e[1]!=r[1]>e[1]&&e[0]<(r[0]-t[0])*(e[1]-t[1])/(r[1]-t[1])+t[0]}function cr(e,t){for(var r,c,v,m,_,C,k,B=!1,W=0,K=t.length;W<K;W++)for(var oe=t[W],ce=0,Ve=oe.length;ce<Ve-1;ce++){if((m=(r=e)[0]-(c=oe[ce])[0])*(k=r[1]-(v=oe[ce+1])[1])-(C=r[0]-v[0])*(_=r[1]-c[1])==0&&m*C<=0&&_*k<=0)return!1;ct(e,oe[ce],oe[ce+1])&&(B=!B)}return B}function tn(e,t){for(var r=0;r<t.length;r++)if(cr(e,t[r]))return!0;return!1}function kn(e,t,r,c){var v=c[0]-r[0],m=c[1]-r[1],_=(e[0]-r[0])*m-v*(e[1]-r[1]),C=(t[0]-r[0])*m-v*(t[1]-r[1]);return _>0&&C<0||_<0&&C>0}function Zi(e,t,r){for(var c=0,v=r;c<v.length;c+=1)for(var m=v[c],_=0;_<m.length-1;++_)if((K=[(W=m[_+1])[0]-(B=m[_])[0],W[1]-B[1]])[0]*(oe=[(k=t)[0]-(C=e)[0],k[1]-C[1]])[1]-K[1]*oe[0]!=0&&kn(C,k,B,W)&&kn(B,W,C,k))return!0;var C,k,B,W,K,oe;return!1}function Yi(e,t){for(var r=0;r<e.length;++r)if(!cr(e[r],t))return!1;for(var c=0;c<e.length-1;++c)if(Zi(e[c],e[c+1],t))return!1;return!0}function Ka(e,t){for(var r=0;r<t.length;r++)if(Yi(e,t[r]))return!0;return!1}function $a(e,t,r){for(var c=[],v=0;v<e.length;v++){for(var m=[],_=0;_<e[v].length;_++){var C=Pe(e[v][_],r);fa(t,C),m.push(C)}c.push(m)}return c}function Xo(e,t,r){for(var c=[],v=0;v<e.length;v++){var m=$a(e[v],t,r);c.push(m)}return c}function xs(e,t,r,c){if(e[0]<r[0]||e[0]>r[2]){var v=.5*c,m=e[0]-r[0]>v?-c:r[0]-e[0]>v?c:0;m===0&&(m=e[0]-r[2]>v?-c:r[2]-e[0]>v?c:0),e[0]+=m}fa(t,e)}function Hl(e,t,r,c){for(var v=8192*Math.pow(2,c.z),m=[8192*c.x,8192*c.y],_=[],C=0,k=e;C<k.length;C+=1)for(var B=0,W=k[C];B<W.length;B+=1){var K=W[B],oe=[K.x+m[0],K.y+m[1]];xs(oe,t,r,v),_.push(oe)}return _}function Xu(e,t,r,c){for(var v,m=8192*Math.pow(2,c.z),_=[8192*c.x,8192*c.y],C=[],k=0,B=e;k<B.length;k+=1){for(var W=[],K=0,oe=B[k];K<oe.length;K+=1){var ce=oe[K],Ve=[ce.x+_[0],ce.y+_[1]];fa(t,Ve),W.push(Ve)}C.push(W)}if(t[2]-t[0]<=m/2){(v=t)[0]=v[1]=1/0,v[2]=v[3]=-1/0;for(var We=0,st=C;We<st.length;We+=1)for(var et=0,Tt=st[We];et<Tt.length;et+=1)xs(Tt[et],t,r,m)}return C}La.parse=function(e,t){if(e.length!==2)return t.error("Expected one argument.");var r=e[1];if(typeof r!="object"||Array.isArray(r))return t.error("Collator options argument must be an object.");var c=t.parse(r["case-sensitive"]!==void 0&&r["case-sensitive"],1,$r);if(!c)return null;var v=t.parse(r["diacritic-sensitive"]!==void 0&&r["diacritic-sensitive"],1,$r);if(!v)return null;var m=null;return r.locale&&!(m=t.parse(r.locale,1,vn))?null:new La(c,v,m)},La.prototype.evaluate=function(e){return new Na(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)},La.prototype.eachChild=function(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)},La.prototype.outputDefined=function(){return!1},La.prototype.serialize=function(){var e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]};var Ro=function(e,t){this.type=$r,this.geojson=e,this.geometries=t};function Cs(e){if(e instanceof qa&&(e.name==="get"&&e.args.length===1||e.name==="feature-state"||e.name==="has"&&e.args.length===1||e.name==="properties"||e.name==="geometry-type"||e.name==="id"||/^filter-/.test(e.name))||e instanceof Ro)return!1;var t=!0;return e.eachChild(function(r){t&&!Cs(r)&&(t=!1)}),t}function so(e){if(e instanceof qa&&e.name==="feature-state")return!1;var t=!0;return e.eachChild(function(r){t&&!so(r)&&(t=!1)}),t}function Ps(e,t){if(e instanceof qa&&t.indexOf(e.name)>=0)return!1;var r=!0;return e.eachChild(function(c){r&&!Ps(c,t)&&(r=!1)}),r}Ro.parse=function(e,t){if(e.length!==2)return t.error("'within' expression requires exactly one argument, but found "+(e.length-1)+" instead.");if(uu(e[1])){var r=e[1];if(r.type==="FeatureCollection")for(var c=0;c<r.features.length;++c){var v=r.features[c].geometry.type;if(v==="Polygon"||v==="MultiPolygon")return new Ro(r,r.features[c].geometry)}else if(r.type==="Feature"){var m=r.geometry.type;if(m==="Polygon"||m==="MultiPolygon")return new Ro(r,r.geometry)}else if(r.type==="Polygon"||r.type==="MultiPolygon")return new Ro(r,r)}return t.error("'within' expression requires valid geojson object that contains polygon geometry type.")},Ro.prototype.evaluate=function(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(t,r){var c=[1/0,1/0,-1/0,-1/0],v=[1/0,1/0,-1/0,-1/0],m=t.canonicalID();if(r.type==="Polygon"){var _=$a(r.coordinates,v,m),C=Hl(t.geometry(),c,v,m);if(!he(c,v))return!1;for(var k=0,B=C;k<B.length;k+=1)if(!cr(B[k],_))return!1}if(r.type==="MultiPolygon"){var W=Xo(r.coordinates,v,m),K=Hl(t.geometry(),c,v,m);if(!he(c,v))return!1;for(var oe=0,ce=K;oe<ce.length;oe+=1)if(!tn(ce[oe],W))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(t,r){var c=[1/0,1/0,-1/0,-1/0],v=[1/0,1/0,-1/0,-1/0],m=t.canonicalID();if(r.type==="Polygon"){var _=$a(r.coordinates,v,m),C=Xu(t.geometry(),c,v,m);if(!he(c,v))return!1;for(var k=0,B=C;k<B.length;k+=1)if(!Yi(B[k],_))return!1}if(r.type==="MultiPolygon"){var W=Xo(r.coordinates,v,m),K=Xu(t.geometry(),c,v,m);if(!he(c,v))return!1;for(var oe=0,ce=K;oe<ce.length;oe+=1)if(!Ka(ce[oe],W))return!1}return!0}(e,this.geometries)}return!1},Ro.prototype.eachChild=function(){},Ro.prototype.outputDefined=function(){return!0},Ro.prototype.serialize=function(){return["within",this.geojson]};var Ra=function(e,t){this.type=t.type,this.name=e,this.boundExpression=t};Ra.parse=function(e,t){if(e.length!==2||typeof e[1]!="string")return t.error("'var' expression requires exactly one string literal argument.");var r=e[1];return t.scope.has(r)?new Ra(r,t.scope.get(r)):t.error('Unknown variable "'+r+'". Make sure "'+r+'" has been bound in an enclosing "let" expression before using it.',1)},Ra.prototype.evaluate=function(e){return this.boundExpression.evaluate(e)},Ra.prototype.eachChild=function(){},Ra.prototype.outputDefined=function(){return!1},Ra.prototype.serialize=function(){return["var",this.name]};var ci=function(e,t,r,c,v){t===void 0&&(t=[]),c===void 0&&(c=new Hr),v===void 0&&(v=[]),this.registry=e,this.path=t,this.key=t.map(function(m){return"["+m+"]"}).join(""),this.scope=c,this.errors=v,this.expectedType=r};function ul(e,t){for(var r,c=e.length-1,v=0,m=c,_=0;v<=m;)if((r=e[_=Math.floor((v+m)/2)])<=t){if(_===c||t<e[_+1])return _;v=_+1}else{if(!(r>t))throw new Xa("Input is not a number.");m=_-1}return 0}ci.prototype.parse=function(e,t,r,c,v){return v===void 0&&(v={}),t?this.concat(t,r,c)._parse(e,v):this._parse(e,v)},ci.prototype._parse=function(e,t){function r(B,W,K){return K==="assert"?new sa(W,[B]):K==="coerce"?new ta(W,[B]):B}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');var c=e[0];if(typeof c!="string")return this.error("Expression name must be a string, but found "+typeof c+' instead. If you wanted a literal array, use ["literal", [...]].',0),null;var v=this.registry[c];if(v){var m=v.parse(e,this);if(!m)return null;if(this.expectedType){var _=this.expectedType,C=m.type;if(_.kind!=="string"&&_.kind!=="number"&&_.kind!=="boolean"&&_.kind!=="object"&&_.kind!=="array"||C.kind!=="value")if(_.kind!=="color"&&_.kind!=="formatted"&&_.kind!=="resolvedImage"||C.kind!=="value"&&C.kind!=="string"){if(this.checkSubtype(_,C))return null}else m=r(m,_,t.typeAnnotation||"coerce");else m=r(m,_,t.typeAnnotation||"assert")}if(!(m instanceof Wa)&&m.type.kind!=="resolvedImage"&&function B(W){if(W instanceof Ra)return B(W.boundExpression);if(W instanceof qa&&W.name==="error"||W instanceof La||W instanceof Ro)return!1;var K=W instanceof ta||W instanceof sa,oe=!0;return W.eachChild(function(ce){oe=K?oe&&B(ce):oe&&ce instanceof Wa}),!!oe&&Cs(W)&&Ps(W,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}(m)){var k=new rs;try{m=new Wa(m.type,m.evaluate(k))}catch(B){return this.error(B.message),null}}return m}return this.error('Unknown expression "'+c+'". If you wanted a literal array, use ["literal", [...]].',0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':"Expected an array, but found "+typeof e+" instead.")},ci.prototype.concat=function(e,t,r){var c=typeof e=="number"?this.path.concat(e):this.path,v=r?this.scope.concat(r):this.scope;return new ci(this.registry,c,t||null,v,this.errors)},ci.prototype.error=function(e){for(var t=[],r=arguments.length-1;r-- >0;)t[r]=arguments[r+1];var c=""+this.key+t.map(function(v){return"["+v+"]"}).join("");this.errors.push(new dr(c,e))},ci.prototype.checkSubtype=function(e,t){var r=ji(e,t);return r&&this.error(r),r};var ba=function(e,t,r){this.type=e,this.input=t,this.labels=[],this.outputs=[];for(var c=0,v=r;c<v.length;c+=1){var m=v[c],_=m[1];this.labels.push(m[0]),this.outputs.push(_)}};function Nn(e,t,r){return e*(1-r)+t*r}ba.parse=function(e,t){if(e.length-1<4)return t.error("Expected at least 4 arguments, but found only "+(e.length-1)+".");if((e.length-1)%2!=0)return t.error("Expected an even number of arguments.");var r=t.parse(e[1],1,vr);if(!r)return null;var c=[],v=null;t.expectedType&&t.expectedType.kind!=="value"&&(v=t.expectedType);for(var m=1;m<e.length;m+=2){var _=m===1?-1/0:e[m],C=e[m+1],k=m,B=m+1;if(typeof _!="number")return t.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',k);if(c.length&&c[c.length-1][0]>=_)return t.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',k);var W=t.parse(C,B,v);if(!W)return null;v=v||W.type,c.push([_,W])}return new ba(v,r,c)},ba.prototype.evaluate=function(e){var t=this.labels,r=this.outputs;if(t.length===1)return r[0].evaluate(e);var c=this.input.evaluate(e);if(c<=t[0])return r[0].evaluate(e);var v=t.length;return c>=t[v-1]?r[v-1].evaluate(e):r[ul(t,c)].evaluate(e)},ba.prototype.eachChild=function(e){e(this.input);for(var t=0,r=this.outputs;t<r.length;t+=1)e(r[t])},ba.prototype.outputDefined=function(){return this.outputs.every(function(e){return e.outputDefined()})},ba.prototype.serialize=function(){for(var e=["step",this.input.serialize()],t=0;t<this.labels.length;t++)t>0&&e.push(this.labels[t]),e.push(this.outputs[t].serialize());return e};var Ws=Object.freeze({__proto__:null,number:Nn,color:function(e,t,r){return new Vn(Nn(e.r,t.r,r),Nn(e.g,t.g,r),Nn(e.b,t.b,r),Nn(e.a,t.a,r))},array:function(e,t,r){return e.map(function(c,v){return Nn(c,t[v],r)})}}),Wl=6/29*3*(6/29),uo=Math.PI/180,je=180/Math.PI;function Pt(e){return e>.008856451679035631?Math.pow(e,1/3):e/Wl+4/29}function yr(e){return e>6/29?e*e*e:Wl*(e-4/29)}function On(e){return 255*(e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055)}function Gi(e){return(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function Sa(e){var t=Gi(e.r),r=Gi(e.g),c=Gi(e.b),v=Pt((.4124564*t+.3575761*r+.1804375*c)/.95047),m=Pt((.2126729*t+.7151522*r+.072175*c)/1);return{l:116*m-16,a:500*(v-m),b:200*(m-Pt((.0193339*t+.119192*r+.9503041*c)/1.08883)),alpha:e.a}}function Za(e){var t=(e.l+16)/116,r=isNaN(e.a)?t:t+e.a/500,c=isNaN(e.b)?t:t-e.b/200;return t=1*yr(t),r=.95047*yr(r),c=1.08883*yr(c),new Vn(On(3.2404542*r-1.5371385*t-.4985314*c),On(-.969266*r+1.8760108*t+.041556*c),On(.0556434*r-.2040259*t+1.0572252*c),e.alpha)}function ra(e,t,r){var c=t-e;return e+r*(c>180||c<-180?c-360*Math.round(c/360):c)}var Da={forward:Sa,reverse:Za,interpolate:function(e,t,r){return{l:Nn(e.l,t.l,r),a:Nn(e.a,t.a,r),b:Nn(e.b,t.b,r),alpha:Nn(e.alpha,t.alpha,r)}}},Do={forward:function(e){var t=Sa(e),r=t.l,c=t.a,v=t.b,m=Math.atan2(v,c)*je;return{h:m<0?m+360:m,c:Math.sqrt(c*c+v*v),l:r,alpha:e.a}},reverse:function(e){var t=e.h*uo,r=e.c;return Za({l:e.l,a:Math.cos(t)*r,b:Math.sin(t)*r,alpha:e.alpha})},interpolate:function(e,t,r){return{h:ra(e.h,t.h,r),c:Nn(e.c,t.c,r),l:Nn(e.l,t.l,r),alpha:Nn(e.alpha,t.alpha,r)}}},Co=Object.freeze({__proto__:null,lab:Da,hcl:Do}),bi=function(e,t,r,c,v){this.type=e,this.operator=t,this.interpolation=r,this.input=c,this.labels=[],this.outputs=[];for(var m=0,_=v;m<_.length;m+=1){var C=_[m],k=C[1];this.labels.push(C[0]),this.outputs.push(k)}};function Yu(e,t,r,c){var v=c-r,m=e-r;return v===0?0:t===1?m/v:(Math.pow(t,m)-1)/(Math.pow(t,v)-1)}bi.interpolationFactor=function(e,t,r,c){var v=0;if(e.name==="exponential")v=Yu(t,e.base,r,c);else if(e.name==="linear")v=Yu(t,1,r,c);else if(e.name==="cubic-bezier"){var m=e.controlPoints;v=new F(m[0],m[1],m[2],m[3]).solve(Yu(t,1,r,c))}return v},bi.parse=function(e,t){var r=e[0],c=e[1],v=e[2],m=e.slice(3);if(!Array.isArray(c)||c.length===0)return t.error("Expected an interpolation type expression.",1);if(c[0]==="linear")c={name:"linear"};else if(c[0]==="exponential"){var _=c[1];if(typeof _!="number")return t.error("Exponential interpolation requires a numeric base.",1,1);c={name:"exponential",base:_}}else{if(c[0]!=="cubic-bezier")return t.error("Unknown interpolation type "+String(c[0]),1,0);var C=c.slice(1);if(C.length!==4||C.some(function(st){return typeof st!="number"||st<0||st>1}))return t.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);c={name:"cubic-bezier",controlPoints:C}}if(e.length-1<4)return t.error("Expected at least 4 arguments, but found only "+(e.length-1)+".");if((e.length-1)%2!=0)return t.error("Expected an even number of arguments.");if(!(v=t.parse(v,2,vr)))return null;var k=[],B=null;r==="interpolate-hcl"||r==="interpolate-lab"?B=cn:t.expectedType&&t.expectedType.kind!=="value"&&(B=t.expectedType);for(var W=0;W<m.length;W+=2){var K=m[W],oe=m[W+1],ce=W+3,Ve=W+4;if(typeof K!="number")return t.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',ce);if(k.length&&k[k.length-1][0]>=K)return t.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',ce);var We=t.parse(oe,Ve,B);if(!We)return null;B=B||We.type,k.push([K,We])}return B.kind==="number"||B.kind==="color"||B.kind==="array"&&B.itemType.kind==="number"&&typeof B.N=="number"?new bi(B,r,c,v,k):t.error("Type "+Pi(B)+" is not interpolatable.")},bi.prototype.evaluate=function(e){var t=this.labels,r=this.outputs;if(t.length===1)return r[0].evaluate(e);var c=this.input.evaluate(e);if(c<=t[0])return r[0].evaluate(e);var v=t.length;if(c>=t[v-1])return r[v-1].evaluate(e);var m=ul(t,c),_=bi.interpolationFactor(this.interpolation,c,t[m],t[m+1]),C=r[m].evaluate(e),k=r[m+1].evaluate(e);return this.operator==="interpolate"?Ws[this.type.kind.toLowerCase()](C,k,_):this.operator==="interpolate-hcl"?Do.reverse(Do.interpolate(Do.forward(C),Do.forward(k),_)):Da.reverse(Da.interpolate(Da.forward(C),Da.forward(k),_))},bi.prototype.eachChild=function(e){e(this.input);for(var t=0,r=this.outputs;t<r.length;t+=1)e(r[t])},bi.prototype.outputDefined=function(){return this.outputs.every(function(e){return e.outputDefined()})},bi.prototype.serialize=function(){var e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);for(var t=[this.operator,e,this.input.serialize()],r=0;r<this.labels.length;r++)t.push(this.labels[r],this.outputs[r].serialize());return t};var lu=function(e,t){this.type=e,this.args=t};lu.parse=function(e,t){if(e.length<2)return t.error("Expectected at least one argument.");var r=null,c=t.expectedType;c&&c.kind!=="value"&&(r=c);for(var v=[],m=0,_=e.slice(1);m<_.length;m+=1){var C=t.parse(_[m],1+v.length,r,void 0,{typeAnnotation:"omit"});if(!C)return null;r=r||C.type,v.push(C)}var k=c&&v.some(function(B){return ji(c,B.type)});return new lu(k?pn:r,v)},lu.prototype.evaluate=function(e){for(var t,r=null,c=0,v=0,m=this.args;v<m.length&&(c++,(r=m[v].evaluate(e))&&r instanceof Ba&&!r.available&&(t||(t=r.name),r=null,c===this.args.length&&(r=t)),r===null);v+=1);return r},lu.prototype.eachChild=function(e){this.args.forEach(e)},lu.prototype.outputDefined=function(){return this.args.every(function(e){return e.outputDefined()})},lu.prototype.serialize=function(){var e=["coalesce"];return this.eachChild(function(t){e.push(t.serialize())}),e};var Yo=function(e,t){this.type=t.type,this.bindings=[].concat(e),this.result=t};Yo.prototype.evaluate=function(e){return this.result.evaluate(e)},Yo.prototype.eachChild=function(e){for(var t=0,r=this.bindings;t<r.length;t+=1)e(r[t][1]);e(this.result)},Yo.parse=function(e,t){if(e.length<4)return t.error("Expected at least 3 arguments, but found "+(e.length-1)+" instead.");for(var r=[],c=1;c<e.length-1;c+=2){var v=e[c];if(typeof v!="string")return t.error("Expected string, but found "+typeof v+" instead.",c);if(/[^a-zA-Z0-9_]/.test(v))return t.error("Variable names must contain only alphanumeric characters or '_'.",c);var m=t.parse(e[c+1],c+1);if(!m)return null;r.push([v,m])}var _=t.parse(e[e.length-1],e.length-1,t.expectedType,r);return _?new Yo(r,_):null},Yo.prototype.outputDefined=function(){return this.result.outputDefined()},Yo.prototype.serialize=function(){for(var e=["let"],t=0,r=this.bindings;t<r.length;t+=1){var c=r[t];e.push(c[0],c[1].serialize())}return e.push(this.result.serialize()),e};var ll=function(e,t,r){this.type=e,this.index=t,this.input=r};ll.parse=function(e,t){if(e.length!==3)return t.error("Expected 2 arguments, but found "+(e.length-1)+" instead.");var r=t.parse(e[1],1,vr),c=t.parse(e[2],2,Di(t.expectedType||pn));return r&&c?new ll(c.type.itemType,r,c):null},ll.prototype.evaluate=function(e){var t=this.index.evaluate(e),r=this.input.evaluate(e);if(t<0)throw new Xa("Array index out of bounds: "+t+" < 0.");if(t>=r.length)throw new Xa("Array index out of bounds: "+t+" > "+(r.length-1)+".");if(t!==Math.floor(t))throw new Xa("Array index must be an integer, but found "+t+" instead.");return r[t]},ll.prototype.eachChild=function(e){e(this.index),e(this.input)},ll.prototype.outputDefined=function(){return!1},ll.prototype.serialize=function(){return["at",this.index.serialize(),this.input.serialize()]};var bo=function(e,t){this.type=$r,this.needle=e,this.haystack=t};bo.parse=function(e,t){if(e.length!==3)return t.error("Expected 2 arguments, but found "+(e.length-1)+" instead.");var r=t.parse(e[1],1,pn),c=t.parse(e[2],2,pn);return r&&c?Rn(r.type,[$r,vn,vr,_n,pn])?new bo(r,c):t.error("Expected first argument to be of type boolean, string, number or null, but found "+Pi(r.type)+" instead"):null},bo.prototype.evaluate=function(e){var t=this.needle.evaluate(e),r=this.haystack.evaluate(e);if(!r)return!1;if(!Dn(t,["boolean","string","number","null"]))throw new Xa("Expected first argument to be of type boolean, string, number or null, but found "+Pi(_a(t))+" instead.");if(!Dn(r,["string","array"]))throw new Xa("Expected second argument to be of type array or string, but found "+Pi(_a(r))+" instead.");return r.indexOf(t)>=0},bo.prototype.eachChild=function(e){e(this.needle),e(this.haystack)},bo.prototype.outputDefined=function(){return!0},bo.prototype.serialize=function(){return["in",this.needle.serialize(),this.haystack.serialize()]};var bs=function(e,t,r){this.type=vr,this.needle=e,this.haystack=t,this.fromIndex=r};bs.parse=function(e,t){if(e.length<=2||e.length>=5)return t.error("Expected 3 or 4 arguments, but found "+(e.length-1)+" instead.");var r=t.parse(e[1],1,pn),c=t.parse(e[2],2,pn);if(!r||!c)return null;if(!Rn(r.type,[$r,vn,vr,_n,pn]))return t.error("Expected first argument to be of type boolean, string, number or null, but found "+Pi(r.type)+" instead");if(e.length===4){var v=t.parse(e[3],3,vr);return v?new bs(r,c,v):null}return new bs(r,c)},bs.prototype.evaluate=function(e){var t=this.needle.evaluate(e),r=this.haystack.evaluate(e);if(!Dn(t,["boolean","string","number","null"]))throw new Xa("Expected first argument to be of type boolean, string, number or null, but found "+Pi(_a(t))+" instead.");if(!Dn(r,["string","array"]))throw new Xa("Expected second argument to be of type array or string, but found "+Pi(_a(r))+" instead.");if(this.fromIndex){var c=this.fromIndex.evaluate(e);return r.indexOf(t,c)}return r.indexOf(t)},bs.prototype.eachChild=function(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)},bs.prototype.outputDefined=function(){return!1},bs.prototype.serialize=function(){if(this.fromIndex!=null&&this.fromIndex!==void 0){var e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]};var Po=function(e,t,r,c,v,m){this.inputType=e,this.type=t,this.input=r,this.cases=c,this.outputs=v,this.otherwise=m};Po.parse=function(e,t){if(e.length<5)return t.error("Expected at least 4 arguments, but found only "+(e.length-1)+".");if(e.length%2!=1)return t.error("Expected an even number of arguments.");var r,c;t.expectedType&&t.expectedType.kind!=="value"&&(c=t.expectedType);for(var v={},m=[],_=2;_<e.length-1;_+=2){var C=e[_],k=e[_+1];Array.isArray(C)||(C=[C]);var B=t.concat(_);if(C.length===0)return B.error("Expected at least one branch label.");for(var W=0,K=C;W<K.length;W+=1){var oe=K[W];if(typeof oe!="number"&&typeof oe!="string")return B.error("Branch labels must be numbers or strings.");if(typeof oe=="number"&&Math.abs(oe)>Number.MAX_SAFE_INTEGER)return B.error("Branch labels must be integers no larger than "+Number.MAX_SAFE_INTEGER+".");if(typeof oe=="number"&&Math.floor(oe)!==oe)return B.error("Numeric branch labels must be integer values.");if(r){if(B.checkSubtype(r,_a(oe)))return null}else r=_a(oe);if(v[String(oe)]!==void 0)return B.error("Branch labels must be unique.");v[String(oe)]=m.length}var ce=t.parse(k,_,c);if(!ce)return null;c=c||ce.type,m.push(ce)}var Ve=t.parse(e[1],1,pn);if(!Ve)return null;var We=t.parse(e[e.length-1],e.length-1,c);return We?Ve.type.kind!=="value"&&t.concat(1).checkSubtype(r,Ve.type)?null:new Po(r,c,Ve,v,m,We):null},Po.prototype.evaluate=function(e){var t=this.input.evaluate(e);return(_a(t)===this.inputType&&this.outputs[this.cases[t]]||this.otherwise).evaluate(e)},Po.prototype.eachChild=function(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)},Po.prototype.outputDefined=function(){return this.outputs.every(function(e){return e.outputDefined()})&&this.otherwise.outputDefined()},Po.prototype.serialize=function(){for(var e=this,t=["match",this.input.serialize()],r=[],c={},v=0,m=Object.keys(this.cases).sort();v<m.length;v+=1){var _=m[v];(K=c[this.cases[_]])===void 0?(c[this.cases[_]]=r.length,r.push([this.cases[_],[_]])):r[K][1].push(_)}for(var C=function(ce){return e.inputType.kind==="number"?Number(ce):ce},k=0,B=r;k<B.length;k+=1){var W=B[k],K=W[0],oe=W[1];t.push(oe.length===1?C(oe[0]):oe.map(C)),t.push(this.outputs[outputIndex$1].serialize())}return t.push(this.otherwise.serialize()),t};var cu=function(e,t,r){this.type=e,this.branches=t,this.otherwise=r};cu.parse=function(e,t){if(e.length<4)return t.error("Expected at least 3 arguments, but found only "+(e.length-1)+".");if(e.length%2!=0)return t.error("Expected an odd number of arguments.");var r;t.expectedType&&t.expectedType.kind!=="value"&&(r=t.expectedType);for(var c=[],v=1;v<e.length-1;v+=2){var m=t.parse(e[v],v,$r);if(!m)return null;var _=t.parse(e[v+1],v+1,r);if(!_)return null;c.push([m,_]),r=r||_.type}var C=t.parse(e[e.length-1],e.length-1,r);return C?new cu(r,c,C):null},cu.prototype.evaluate=function(e){for(var t=0,r=this.branches;t<r.length;t+=1){var c=r[t],v=c[1];if(c[0].evaluate(e))return v.evaluate(e)}return this.otherwise.evaluate(e)},cu.prototype.eachChild=function(e){for(var t=0,r=this.branches;t<r.length;t+=1){var c=r[t],v=c[1];e(c[0]),e(v)}e(this.otherwise)},cu.prototype.outputDefined=function(){return this.branches.every(function(e){return e[1].outputDefined()})&&this.otherwise.outputDefined()},cu.prototype.serialize=function(){var e=["case"];return this.eachChild(function(t){e.push(t.serialize())}),e};var Ms=function(e,t,r,c){this.type=e,this.input=t,this.beginIndex=r,this.endIndex=c};function uc(e,t){return e==="=="||e==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function Kc(e,t,r,c){return c.compare(t,r)===0}function Aa(e,t,r){var c=e!=="=="&&e!=="!=";return function(){function v(m,_,C){this.type=$r,this.lhs=m,this.rhs=_,this.collator=C,this.hasUntypedArgument=m.type.kind==="value"||_.type.kind==="value"}return v.parse=function(m,_){if(m.length!==3&&m.length!==4)return _.error("Expected two or three arguments.");var C=m[0],k=_.parse(m[1],1,pn);if(!k)return null;if(!uc(C,k.type))return _.concat(1).error('"'+C+`" comparisons are not supported for type '`+Pi(k.type)+"'.");var B=_.parse(m[2],2,pn);if(!B)return null;if(!uc(C,B.type))return _.concat(2).error('"'+C+`" comparisons are not supported for type '`+Pi(B.type)+"'.");if(k.type.kind!==B.type.kind&&k.type.kind!=="value"&&B.type.kind!=="value")return _.error("Cannot compare types '"+Pi(k.type)+"' and '"+Pi(B.type)+"'.");c&&(k.type.kind==="value"&&B.type.kind!=="value"?k=new sa(B.type,[k]):k.type.kind!=="value"&&B.type.kind==="value"&&(B=new sa(k.type,[B])));var W=null;if(m.length===4){if(k.type.kind!=="string"&&B.type.kind!=="string"&&k.type.kind!=="value"&&B.type.kind!=="value")return _.error("Cannot use collator to compare non-string types.");if(!(W=_.parse(m[3],3,_i)))return null}return new v(k,B,W)},v.prototype.evaluate=function(m){var _=this.lhs.evaluate(m),C=this.rhs.evaluate(m);if(c&&this.hasUntypedArgument){var k=_a(_),B=_a(C);if(k.kind!==B.kind||k.kind!=="string"&&k.kind!=="number")throw new Xa('Expected arguments for "'+e+'" to be (string, string) or (number, number), but found ('+k.kind+", "+B.kind+") instead.")}if(this.collator&&!c&&this.hasUntypedArgument){var W=_a(_),K=_a(C);if(W.kind!=="string"||K.kind!=="string")return t(m,_,C)}return this.collator?r(m,_,C,this.collator.evaluate(m)):t(m,_,C)},v.prototype.eachChild=function(m){m(this.lhs),m(this.rhs),this.collator&&m(this.collator)},v.prototype.outputDefined=function(){return!0},v.prototype.serialize=function(){var m=[e];return this.eachChild(function(_){m.push(_.serialize())}),m},v}()}Ms.parse=function(e,t){if(e.length<=2||e.length>=5)return t.error("Expected 3 or 4 arguments, but found "+(e.length-1)+" instead.");var r=t.parse(e[1],1,pn),c=t.parse(e[2],2,vr);if(!r||!c)return null;if(!Rn(r.type,[Di(pn),vn,pn]))return t.error("Expected first argument to be of type array or string, but found "+Pi(r.type)+" instead");if(e.length===4){var v=t.parse(e[3],3,vr);return v?new Ms(r.type,r,c,v):null}return new Ms(r.type,r,c)},Ms.prototype.evaluate=function(e){var t=this.input.evaluate(e),r=this.beginIndex.evaluate(e);if(!Dn(t,["string","array"]))throw new Xa("Expected first argument to be of type array or string, but found "+Pi(_a(t))+" instead.");if(this.endIndex){var c=this.endIndex.evaluate(e);return t.slice(r,c)}return t.slice(r)},Ms.prototype.eachChild=function(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)},Ms.prototype.outputDefined=function(){return!1},Ms.prototype.serialize=function(){if(this.endIndex!=null&&this.endIndex!==void 0){var e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]};var gf=Aa("==",function(e,t,r){return t===r},Kc),ku=Aa("!=",function(e,t,r){return t!==r},function(e,t,r,c){return!Kc(0,t,r,c)}),Ml=Aa("<",function(e,t,r){return t<r},function(e,t,r,c){return c.compare(t,r)<0}),Ic=Aa(">",function(e,t,r){return t>r},function(e,t,r,c){return c.compare(t,r)>0}),lc=Aa("<=",function(e,t,r){return t<=r},function(e,t,r,c){return c.compare(t,r)<=0}),eo=Aa(">=",function(e,t,r){return t>=r},function(e,t,r,c){return c.compare(t,r)>=0}),cl=function(e,t,r,c,v){this.type=vn,this.number=e,this.locale=t,this.currency=r,this.minFractionDigits=c,this.maxFractionDigits=v};cl.parse=function(e,t){if(e.length!==3)return t.error("Expected two arguments.");var r=t.parse(e[1],1,vr);if(!r)return null;var c=e[2];if(typeof c!="object"||Array.isArray(c))return t.error("NumberFormat options argument must be an object.");var v=null;if(c.locale&&!(v=t.parse(c.locale,1,vn)))return null;var m=null;if(c.currency&&!(m=t.parse(c.currency,1,vn)))return null;var _=null;if(c["min-fraction-digits"]&&!(_=t.parse(c["min-fraction-digits"],1,vr)))return null;var C=null;return c["max-fraction-digits"]&&!(C=t.parse(c["max-fraction-digits"],1,vr))?null:new cl(r,v,m,_,C)},cl.prototype.evaluate=function(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))},cl.prototype.eachChild=function(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)},cl.prototype.outputDefined=function(){return!1},cl.prototype.serialize=function(){var e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]};var fl=function(e){this.type=vr,this.input=e};fl.parse=function(e,t){if(e.length!==2)return t.error("Expected 1 argument, but found "+(e.length-1)+" instead.");var r=t.parse(e[1],1);return r?r.type.kind!=="array"&&r.type.kind!=="string"&&r.type.kind!=="value"?t.error("Expected argument of type string or array, but found "+Pi(r.type)+" instead."):new fl(r):null},fl.prototype.evaluate=function(e){var t=this.input.evaluate(e);if(typeof t=="string"||Array.isArray(t))return t.length;throw new Xa("Expected value to be of type string or array, but found "+Pi(_a(t))+" instead.")},fl.prototype.eachChild=function(e){e(this.input)},fl.prototype.outputDefined=function(){return!1},fl.prototype.serialize=function(){var e=["length"];return this.eachChild(function(t){e.push(t.serialize())}),e};var ns={"==":gf,"!=":ku,">":Ic,"<":Ml,">=":eo,"<=":lc,array:sa,at:ll,boolean:sa,case:cu,coalesce:lu,collator:La,format:Ya,image:Ta,in:bo,"index-of":bs,interpolate:bi,"interpolate-hcl":bi,"interpolate-lab":bi,length:fl,let:Yo,literal:Wa,match:Po,number:sa,"number-format":cl,object:sa,slice:Ms,step:ba,string:sa,"to-boolean":ta,"to-color":ta,"to-number":ta,"to-string":ta,var:Ra,within:Ro};function cc(e,t){var r=t[0],c=t[1],v=t[2],m=t[3];r=r.evaluate(e),c=c.evaluate(e),v=v.evaluate(e);var _=m?m.evaluate(e):1,C=xu(r,c,v,_);if(C)throw new Xa(C);return new Vn(r/255*_,c/255*_,v/255*_,_)}function Ku(e,t){return e in t}function Xs(e,t){var r=t[e];return r===void 0?null:r}function Ko(e){return{type:e}}function Oc(e){return{result:"success",value:e}}function bu(e){return{result:"error",value:e}}function $u(e){return e["property-type"]==="data-driven"||e["property-type"]==="cross-faded-data-driven"}function Of(e){return!!e.expression&&e.expression.parameters.indexOf("zoom")>-1}function hl(e){return!!e.expression&&e.expression.interpolated}function Ea(e){return e instanceof Number?"number":e instanceof String?"string":e instanceof Boolean?"boolean":Array.isArray(e)?"array":e===null?"null":typeof e}function Ju(e){return typeof e=="object"&&e!==null&&!Array.isArray(e)}function Xl(e){return e}function Yl(e,t,r){return e!==void 0?e:t!==void 0?t:r!==void 0?r:void 0}function Ys(e,t,r,c,v){return Yl(typeof r===v?c[r]:void 0,e.default,t.default)}function Lc(e,t,r){if(Ea(r)!=="number")return Yl(e.default,t.default);var c=e.stops.length;if(c===1||r<=e.stops[0][0])return e.stops[0][1];if(r>=e.stops[c-1][0])return e.stops[c-1][1];var v=ul(e.stops.map(function(m){return m[0]}),r);return e.stops[v][1]}function Kl(e,t,r){var c=e.base!==void 0?e.base:1;if(Ea(r)!=="number")return Yl(e.default,t.default);var v=e.stops.length;if(v===1||r<=e.stops[0][0])return e.stops[0][1];if(r>=e.stops[v-1][0])return e.stops[v-1][1];var m=ul(e.stops.map(function(K){return K[0]}),r),_=function(K,oe,ce,Ve){var We=Ve-ce,st=K-ce;return We===0?0:oe===1?st/We:(Math.pow(oe,st)-1)/(Math.pow(oe,We)-1)}(r,c,e.stops[m][0],e.stops[m+1][0]),C=e.stops[m][1],k=e.stops[m+1][1],B=Ws[t.type]||Xl;if(e.colorSpace&&e.colorSpace!=="rgb"){var W=Co[e.colorSpace];B=function(K,oe){return W.reverse(W.interpolate(W.forward(K),W.forward(oe),_))}}return typeof C.evaluate=="function"?{evaluate:function(){for(var K=[],oe=arguments.length;oe--;)K[oe]=arguments[oe];var ce=C.evaluate.apply(void 0,K),Ve=k.evaluate.apply(void 0,K);if(ce!==void 0&&Ve!==void 0)return B(ce,Ve,_)}}:B(C,k,_)}function $l(e,t,r){return t.type==="color"?r=Vn.parse(r):t.type==="formatted"?r=ki.fromString(r.toString()):t.type==="resolvedImage"?r=Ba.fromString(r.toString()):Ea(r)===t.type||t.type==="enum"&&t.values[r]||(r=void 0),Yl(r,e.default,t.default)}qa.register(ns,{error:[{kind:"error"},[vn],function(e,t){throw new Xa(t[0].evaluate(e))}],typeof:[vn,[pn],function(e,t){return Pi(_a(t[0].evaluate(e)))}],"to-rgba":[Di(vr,4),[cn],function(e,t){return t[0].evaluate(e).toArray()}],rgb:[cn,[vr,vr,vr],cc],rgba:[cn,[vr,vr,vr,vr],cc],has:{type:$r,overloads:[[[vn],function(e,t){return Ku(t[0].evaluate(e),e.properties())}],[[vn,pi],function(e,t){var r=t[1];return Ku(t[0].evaluate(e),r.evaluate(e))}]]},get:{type:pn,overloads:[[[vn],function(e,t){return Xs(t[0].evaluate(e),e.properties())}],[[vn,pi],function(e,t){var r=t[1];return Xs(t[0].evaluate(e),r.evaluate(e))}]]},"feature-state":[pn,[vn],function(e,t){return Xs(t[0].evaluate(e),e.featureState||{})}],properties:[pi,[],function(e){return e.properties()}],"geometry-type":[vn,[],function(e){return e.geometryType()}],id:[pn,[],function(e){return e.id()}],zoom:[vr,[],function(e){return e.globals.zoom}],"heatmap-density":[vr,[],function(e){return e.globals.heatmapDensity||0}],"line-progress":[vr,[],function(e){return e.globals.lineProgress||0}],accumulated:[pn,[],function(e){return e.globals.accumulated===void 0?null:e.globals.accumulated}],"+":[vr,Ko(vr),function(e,t){for(var r=0,c=0,v=t;c<v.length;c+=1)r+=v[c].evaluate(e);return r}],"*":[vr,Ko(vr),function(e,t){for(var r=1,c=0,v=t;c<v.length;c+=1)r*=v[c].evaluate(e);return r}],"-":{type:vr,overloads:[[[vr,vr],function(e,t){var r=t[1];return t[0].evaluate(e)-r.evaluate(e)}],[[vr],function(e,t){return-t[0].evaluate(e)}]]},"/":[vr,[vr,vr],function(e,t){var r=t[1];return t[0].evaluate(e)/r.evaluate(e)}],"%":[vr,[vr,vr],function(e,t){var r=t[1];return t[0].evaluate(e)%r.evaluate(e)}],ln2:[vr,[],function(){return Math.LN2}],pi:[vr,[],function(){return Math.PI}],e:[vr,[],function(){return Math.E}],"^":[vr,[vr,vr],function(e,t){var r=t[1];return Math.pow(t[0].evaluate(e),r.evaluate(e))}],sqrt:[vr,[vr],function(e,t){return Math.sqrt(t[0].evaluate(e))}],log10:[vr,[vr],function(e,t){return Math.log(t[0].evaluate(e))/Math.LN10}],ln:[vr,[vr],function(e,t){return Math.log(t[0].evaluate(e))}],log2:[vr,[vr],function(e,t){return Math.log(t[0].evaluate(e))/Math.LN2}],sin:[vr,[vr],function(e,t){return Math.sin(t[0].evaluate(e))}],cos:[vr,[vr],function(e,t){return Math.cos(t[0].evaluate(e))}],tan:[vr,[vr],function(e,t){return Math.tan(t[0].evaluate(e))}],asin:[vr,[vr],function(e,t){return Math.asin(t[0].evaluate(e))}],acos:[vr,[vr],function(e,t){return Math.acos(t[0].evaluate(e))}],atan:[vr,[vr],function(e,t){return Math.atan(t[0].evaluate(e))}],min:[vr,Ko(vr),function(e,t){return Math.min.apply(Math,t.map(function(r){return r.evaluate(e)}))}],max:[vr,Ko(vr),function(e,t){return Math.max.apply(Math,t.map(function(r){return r.evaluate(e)}))}],abs:[vr,[vr],function(e,t){return Math.abs(t[0].evaluate(e))}],round:[vr,[vr],function(e,t){var r=t[0].evaluate(e);return r<0?-Math.round(-r):Math.round(r)}],floor:[vr,[vr],function(e,t){return Math.floor(t[0].evaluate(e))}],ceil:[vr,[vr],function(e,t){return Math.ceil(t[0].evaluate(e))}],"filter-==":[$r,[vn,pn],function(e,t){var r=t[0],c=t[1];return e.properties()[r.value]===c.value}],"filter-id-==":[$r,[pn],function(e,t){var r=t[0];return e.id()===r.value}],"filter-type-==":[$r,[vn],function(e,t){var r=t[0];return e.geometryType()===r.value}],"filter-<":[$r,[vn,pn],function(e,t){var r=t[0],c=t[1],v=e.properties()[r.value],m=c.value;return typeof v==typeof m&&v<m}],"filter-id-<":[$r,[pn],function(e,t){var r=t[0],c=e.id(),v=r.value;return typeof c==typeof v&&c<v}],"filter->":[$r,[vn,pn],function(e,t){var r=t[0],c=t[1],v=e.properties()[r.value],m=c.value;return typeof v==typeof m&&v>m}],"filter-id->":[$r,[pn],function(e,t){var r=t[0],c=e.id(),v=r.value;return typeof c==typeof v&&c>v}],"filter-<=":[$r,[vn,pn],function(e,t){var r=t[0],c=t[1],v=e.properties()[r.value],m=c.value;return typeof v==typeof m&&v<=m}],"filter-id-<=":[$r,[pn],function(e,t){var r=t[0],c=e.id(),v=r.value;return typeof c==typeof v&&c<=v}],"filter->=":[$r,[vn,pn],function(e,t){var r=t[0],c=t[1],v=e.properties()[r.value],m=c.value;return typeof v==typeof m&&v>=m}],"filter-id->=":[$r,[pn],function(e,t){var r=t[0],c=e.id(),v=r.value;return typeof c==typeof v&&c>=v}],"filter-has":[$r,[pn],function(e,t){return t[0].value in e.properties()}],"filter-has-id":[$r,[],function(e){return e.id()!==null&&e.id()!==void 0}],"filter-type-in":[$r,[Di(vn)],function(e,t){return t[0].value.indexOf(e.geometryType())>=0}],"filter-id-in":[$r,[Di(pn)],function(e,t){return t[0].value.indexOf(e.id())>=0}],"filter-in-small":[$r,[vn,Di(pn)],function(e,t){var r=t[0];return t[1].value.indexOf(e.properties()[r.value])>=0}],"filter-in-large":[$r,[vn,Di(pn)],function(e,t){var r=t[0],c=t[1];return function(v,m,_,C){for(;_<=C;){var k=_+C>>1;if(m[k]===v)return!0;m[k]>v?C=k-1:_=k+1}return!1}(e.properties()[r.value],c.value,0,c.value.length-1)}],all:{type:$r,overloads:[[[$r,$r],function(e,t){var r=t[1];return t[0].evaluate(e)&&r.evaluate(e)}],[Ko($r),function(e,t){for(var r=0,c=t;r<c.length;r+=1)if(!c[r].evaluate(e))return!1;return!0}]]},any:{type:$r,overloads:[[[$r,$r],function(e,t){var r=t[1];return t[0].evaluate(e)||r.evaluate(e)}],[Ko($r),function(e,t){for(var r=0,c=t;r<c.length;r+=1)if(c[r].evaluate(e))return!0;return!1}]]},"!":[$r,[$r],function(e,t){return!t[0].evaluate(e)}],"is-supported-script":[$r,[vn],function(e,t){var r=e.globals&&e.globals.isSupportedScript;return!r||r(t[0].evaluate(e))}],upcase:[vn,[vn],function(e,t){return t[0].evaluate(e).toUpperCase()}],downcase:[vn,[vn],function(e,t){return t[0].evaluate(e).toLowerCase()}],concat:[vn,Ko(pn),function(e,t){return t.map(function(r){return oo(r.evaluate(e))}).join("")}],"resolved-locale":[vn,[_i],function(e,t){return t[0].evaluate(e).resolvedLocale()}]});var Qu=function(e,t){this.expression=e,this._warningHistory={},this._evaluator=new rs,this._defaultValue=t?function(r){return r.type==="color"&&Ju(r.default)?new Vn(0,0,0,0):r.type==="color"?Vn.parse(r.default)||null:r.default===void 0?null:r.default}(t):null,this._enumValues=t&&t.type==="enum"?t.values:null};function Su(e){return Array.isArray(e)&&e.length>0&&typeof e[0]=="string"&&e[0]in ns}function Il(e,t){var r=new ci(ns,[],t?function(v){var m={color:cn,string:vn,number:vr,enum:vn,boolean:$r,formatted:Xi,resolvedImage:mi};return v.type==="array"?Di(m[v.value]||pn,v.length):m[v.type]}(t):void 0),c=r.parse(e,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return c?Oc(new Qu(c,t)):bu(r.errors)}Qu.prototype.evaluateWithoutErrorHandling=function(e,t,r,c,v,m){return this._evaluator.globals=e,this._evaluator.feature=t,this._evaluator.featureState=r,this._evaluator.canonical=c,this._evaluator.availableImages=v||null,this._evaluator.formattedSection=m,this.expression.evaluate(this._evaluator)},Qu.prototype.evaluate=function(e,t,r,c,v,m){this._evaluator.globals=e,this._evaluator.feature=t||null,this._evaluator.featureState=r||null,this._evaluator.canonical=c,this._evaluator.availableImages=v||null,this._evaluator.formattedSection=m||null;try{var _=this.expression.evaluate(this._evaluator);if(_==null||typeof _=="number"&&_!=_)return this._defaultValue;if(this._enumValues&&!(_ in this._enumValues))throw new Xa("Expected value to be one of "+Object.keys(this._enumValues).map(function(C){return JSON.stringify(C)}).join(", ")+", but found "+JSON.stringify(_)+" instead.");return _}catch(C){return this._warningHistory[C.message]||(this._warningHistory[C.message]=!0,typeof console!="undefined"&&console.warn(C.message)),this._defaultValue}};var Ol=function(e,t){this.kind=e,this._styleExpression=t,this.isStateDependent=e!=="constant"&&!so(t.expression)};Ol.prototype.evaluateWithoutErrorHandling=function(e,t,r,c,v,m){return this._styleExpression.evaluateWithoutErrorHandling(e,t,r,c,v,m)},Ol.prototype.evaluate=function(e,t,r,c,v,m){return this._styleExpression.evaluate(e,t,r,c,v,m)};var pl=function(e,t,r,c){this.kind=e,this.zoomStops=r,this._styleExpression=t,this.isStateDependent=e!=="camera"&&!so(t.expression),this.interpolationType=c};function Rc(e,t){if((e=Il(e,t)).result==="error")return e;var r=e.value.expression,c=Cs(r);if(!c&&!$u(t))return bu([new dr("","data expressions not supported")]);var v=Ps(r,["zoom"]);if(!v&&!Of(t))return bu([new dr("","zoom expressions not supported")]);var m=function _(C){var k=null;if(C instanceof Yo)k=_(C.result);else if(C instanceof lu)for(var B=0,W=C.args;B<W.length&&!(k=_(W[B]));B+=1);else(C instanceof ba||C instanceof bi)&&C.input instanceof qa&&C.input.name==="zoom"&&(k=C);return k instanceof dr||C.eachChild(function(K){var oe=_(K);oe instanceof dr?k=oe:!k&&oe?k=new dr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):k&&oe&&k!==oe&&(k=new dr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),k}(r);return m||v?m instanceof dr?bu([m]):m instanceof bi&&!hl(t)?bu([new dr("",'"interpolate" expressions cannot be used with this property')]):Oc(m?new pl(c?"camera":"composite",e.value,m.labels,m instanceof bi?m.interpolation:void 0):new Ol(c?"constant":"source",e.value)):bu([new dr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}pl.prototype.evaluateWithoutErrorHandling=function(e,t,r,c,v,m){return this._styleExpression.evaluateWithoutErrorHandling(e,t,r,c,v,m)},pl.prototype.evaluate=function(e,t,r,c,v,m){return this._styleExpression.evaluate(e,t,r,c,v,m)},pl.prototype.interpolationFactor=function(e,t,r){return this.interpolationType?bi.interpolationFactor(this.interpolationType,e,t,r):0};var dl=function(e,t){this._parameters=e,this._specification=t,Ir(this,function r(c,v){var m,_,C,k=v.type==="color",B=c.stops&&typeof c.stops[0][0]=="object",W=B||!(B||c.property!==void 0),K=c.type||(hl(v)?"exponential":"interval");if(k&&((c=Ir({},c)).stops&&(c.stops=c.stops.map(function(wn){return[wn[0],Vn.parse(wn[1])]})),c.default=Vn.parse(c.default?c.default:v.default)),c.colorSpace&&c.colorSpace!=="rgb"&&!Co[c.colorSpace])throw new Error("Unknown color space: "+c.colorSpace);if(K==="exponential")m=Kl;else if(K==="interval")m=Lc;else if(K==="categorical"){m=Ys,_=Object.create(null);for(var oe=0,ce=c.stops;oe<ce.length;oe+=1){var Ve=ce[oe];_[Ve[0]]=Ve[1]}C=typeof c.stops[0][0]}else{if(K!=="identity")throw new Error('Unknown function type "'+K+'"');m=$l}if(B){for(var We={},st=[],et=0;et<c.stops.length;et++){var Tt=c.stops[et],Ut=Tt[0].zoom;We[Ut]===void 0&&(We[Ut]={zoom:Ut,type:c.type,property:c.property,default:c.default,stops:[]},st.push(Ut)),We[Ut].stops.push([Tt[0].value,Tt[1]])}for(var nr=[],hr=0,Mr=st;hr<Mr.length;hr+=1){var Yr=Mr[hr];nr.push([We[Yr].zoom,r(We[Yr],v)])}var hn={name:"linear"};return{kind:"composite",interpolationType:hn,interpolationFactor:bi.interpolationFactor.bind(void 0,hn),zoomStops:nr.map(function(wn){return wn[0]}),evaluate:function(wn,Jn){var yn=wn.zoom;return Kl({stops:nr,base:c.base},v,yn).evaluate(yn,Jn)}}}if(W){var Hn=K==="exponential"?{name:"exponential",base:c.base!==void 0?c.base:1}:null;return{kind:"camera",interpolationType:Hn,interpolationFactor:bi.interpolationFactor.bind(void 0,Hn),zoomStops:c.stops.map(function(wn){return wn[0]}),evaluate:function(wn){return m(c,v,wn.zoom,_,C)}}}return{kind:"source",evaluate:function(wn,Jn){var yn=Jn&&Jn.properties?Jn.properties[c.property]:void 0;return yn===void 0?Yl(c.default,v.default):m(c,v,yn,_,C)}}}(this._parameters,this._specification))};function Ks(e){var t=e.key,r=e.value,c=e.valueSpec||{},v=e.objectElementValidators||{},m=e.style,_=e.styleSpec,C=[],k=Ea(r);if(k!=="object")return[new De(t,r,"object expected, "+k+" found")];for(var B in r){var W=B.split(".")[0],K=c[W]||c["*"],oe=void 0;if(v[W])oe=v[W];else if(c[W])oe=Ni;else if(v["*"])oe=v["*"];else{if(!c["*"]){C.push(new De(t,r[B],'unknown property "'+B+'"'));continue}oe=Ni}C=C.concat(oe({key:(t&&t+".")+B,value:r[B],valueSpec:K,style:m,styleSpec:_,object:r,objectKey:B},r))}for(var ce in c)v[ce]||c[ce].required&&c[ce].default===void 0&&r[ce]===void 0&&C.push(new De(t,r,'missing required property "'+ce+'"'));return C}function Ll(e){var t=e.value,r=e.valueSpec,c=e.style,v=e.styleSpec,m=e.key,_=e.arrayElementValidator||Ni;if(Ea(t)!=="array")return[new De(m,t,"array expected, "+Ea(t)+" found")];if(r.length&&t.length!==r.length)return[new De(m,t,"array length "+r.length+" expected, length "+t.length+" found")];if(r["min-length"]&&t.length<r["min-length"])return[new De(m,t,"array length at least "+r["min-length"]+" expected, length "+t.length+" found")];var C={type:r.value,values:r.values};v.$version<7&&(C.function=r.function),Ea(r.value)==="object"&&(C=r.value);for(var k=[],B=0;B<t.length;B++)k=k.concat(_({array:t,arrayIndex:B,value:t[B],valueSpec:C,style:c,styleSpec:v,key:m+"["+B+"]"}));return k}function $c(e){var t=e.key,r=e.value,c=e.valueSpec,v=Ea(r);return v==="number"&&r!=r&&(v="NaN"),v!=="number"?[new De(t,r,"number expected, "+v+" found")]:"minimum"in c&&r<c.minimum?[new De(t,r,r+" is less than the minimum value "+c.minimum)]:"maximum"in c&&r>c.maximum?[new De(t,r,r+" is greater than the maximum value "+c.maximum)]:[]}function Jc(e){var t,r,c,v=e.valueSpec,m=Ur(e.value.type),_={},C=m!=="categorical"&&e.value.property===void 0,k=!C,B=Ea(e.value.stops)==="array"&&Ea(e.value.stops[0])==="array"&&Ea(e.value.stops[0][0])==="object",W=Ks({key:e.key,value:e.value,valueSpec:e.styleSpec.function,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{stops:function(ce){if(m==="identity")return[new De(ce.key,ce.value,'identity function may not have a "stops" property')];var Ve=[],We=ce.value;return Ve=Ve.concat(Ll({key:ce.key,value:We,valueSpec:ce.valueSpec,style:ce.style,styleSpec:ce.styleSpec,arrayElementValidator:K})),Ea(We)==="array"&&We.length===0&&Ve.push(new De(ce.key,We,"array must have at least one stop")),Ve},default:function(ce){return Ni({key:ce.key,value:ce.value,valueSpec:v,style:ce.style,styleSpec:ce.styleSpec})}}});return m==="identity"&&C&&W.push(new De(e.key,e.value,'missing required property "property"')),m==="identity"||e.value.stops||W.push(new De(e.key,e.value,'missing required property "stops"')),m==="exponential"&&e.valueSpec.expression&&!hl(e.valueSpec)&&W.push(new De(e.key,e.value,"exponential functions not supported")),e.styleSpec.$version>=8&&(k&&!$u(e.valueSpec)?W.push(new De(e.key,e.value,"property functions not supported")):C&&!Of(e.valueSpec)&&W.push(new De(e.key,e.value,"zoom functions not supported"))),m!=="categorical"&&!B||e.value.property!==void 0||W.push(new De(e.key,e.value,'"property" property is required')),W;function K(ce){var Ve=[],We=ce.value,st=ce.key;if(Ea(We)!=="array")return[new De(st,We,"array expected, "+Ea(We)+" found")];if(We.length!==2)return[new De(st,We,"array length 2 expected, length "+We.length+" found")];if(B){if(Ea(We[0])!=="object")return[new De(st,We,"object expected, "+Ea(We[0])+" found")];if(We[0].zoom===void 0)return[new De(st,We,"object stop key must have zoom")];if(We[0].value===void 0)return[new De(st,We,"object stop key must have value")];if(c&&c>Ur(We[0].zoom))return[new De(st,We[0].zoom,"stop zoom values must appear in ascending order")];Ur(We[0].zoom)!==c&&(c=Ur(We[0].zoom),r=void 0,_={}),Ve=Ve.concat(Ks({key:st+"[0]",value:We[0],valueSpec:{zoom:{}},style:ce.style,styleSpec:ce.styleSpec,objectElementValidators:{zoom:$c,value:oe}}))}else Ve=Ve.concat(oe({key:st+"[0]",value:We[0],valueSpec:{},style:ce.style,styleSpec:ce.styleSpec},We));return Su(jt(We[1]))?Ve.concat([new De(st+"[1]",We[1],"expressions are not allowed in function stops.")]):Ve.concat(Ni({key:st+"[1]",value:We[1],valueSpec:v,style:ce.style,styleSpec:ce.styleSpec}))}function oe(ce,Ve){var We=Ea(ce.value),st=Ur(ce.value),et=ce.value!==null?ce.value:Ve;if(t){if(We!==t)return[new De(ce.key,et,We+" stop domain type must match previous stop domain type "+t)]}else t=We;if(We!=="number"&&We!=="string"&&We!=="boolean")return[new De(ce.key,et,"stop domain value must be a number, string, or boolean")];if(We!=="number"&&m!=="categorical"){var Tt="number expected, "+We+" found";return $u(v)&&m===void 0&&(Tt+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new De(ce.key,et,Tt)]}return m!=="categorical"||We!=="number"||isFinite(st)&&Math.floor(st)===st?m!=="categorical"&&We==="number"&&r!==void 0&&st<r?[new De(ce.key,et,"stop domain values must appear in ascending order")]:(r=st,m==="categorical"&&st in _?[new De(ce.key,et,"stop domain values must be unique")]:(_[st]=!0,[])):[new De(ce.key,et,"integer expected, found "+st)]}}function ma(e){var t=(e.expressionContext==="property"?Rc:Il)(jt(e.value),e.valueSpec);if(t.result==="error")return t.value.map(function(c){return new De(""+e.key+c.key,e.value,c.message)});var r=t.value.expression||t.value._styleExpression.expression;if(e.expressionContext==="property"&&e.propertyKey==="text-font"&&!r.outputDefined())return[new De(e.key,e.value,'Invalid data expression for "'+e.propertyKey+'". Output values must be contained as literals within the expression.')];if(e.expressionContext==="property"&&e.propertyType==="layout"&&!so(r))return[new De(e.key,e.value,'"feature-state" data expressions are not supported with layout properties.')];if(e.expressionContext==="filter"&&!so(r))return[new De(e.key,e.value,'"feature-state" data expressions are not supported with filters.')];if(e.expressionContext&&e.expressionContext.indexOf("cluster")===0){if(!Ps(r,["zoom","feature-state"]))return[new De(e.key,e.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(e.expressionContext==="cluster-initial"&&!Cs(r))return[new De(e.key,e.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Jl(e){var t=e.key,r=e.value,c=e.valueSpec,v=[];return Array.isArray(c.values)?c.values.indexOf(Ur(r))===-1&&v.push(new De(t,r,"expected one of ["+c.values.join(", ")+"], "+JSON.stringify(r)+" found")):Object.keys(c.values).indexOf(Ur(r))===-1&&v.push(new De(t,r,"expected one of ["+Object.keys(c.values).join(", ")+"], "+JSON.stringify(r)+" found")),v}function fc(e){if(e===!0||e===!1)return!0;if(!Array.isArray(e)||e.length===0)return!1;switch(e[0]){case"has":return e.length>=2&&e[1]!=="$id"&&e[1]!=="$type";case"in":return e.length>=3&&(typeof e[1]!="string"||Array.isArray(e[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return e.length!==3||Array.isArray(e[1])||Array.isArray(e[2]);case"any":case"all":for(var t=0,r=e.slice(1);t<r.length;t+=1){var c=r[t];if(!fc(c)&&typeof c!="boolean")return!1}return!0;default:return!0}}dl.deserialize=function(e){return new dl(e._parameters,e._specification)},dl.serialize=function(e){return{_parameters:e._parameters,_specification:e._specification}};var qu={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Rl(e){if(e==null)return{filter:function(){return!0},needGeometry:!1};fc(e)||(e=Fu(e));var t=Il(e,qu);if(t.result==="error")throw new Error(t.value.map(function(r){return r.key+": "+r.message}).join(", "));return{filter:function(r,c,v){return t.value.evaluate(r,c,{},v)},needGeometry:function r(c){if(!Array.isArray(c))return!1;if(c[0]==="within")return!0;for(var v=1;v<c.length;v++)if(r(c[v]))return!0;return!1}(e)}}function hc(e,t){return e<t?-1:e>t?1:0}function Fu(e){if(!e)return!0;var t,r=e[0];return e.length<=1?r!=="any":r==="=="?Dc(e[1],e[2],"=="):r==="!="?Dl(Dc(e[1],e[2],"==")):r==="<"||r===">"||r==="<="||r===">="?Dc(e[1],e[2],r):r==="any"?(t=e.slice(1),["any"].concat(t.map(Fu))):r==="all"?["all"].concat(e.slice(1).map(Fu)):r==="none"?["all"].concat(e.slice(1).map(Fu).map(Dl)):r==="in"?Qc(e[1],e.slice(2)):r==="!in"?Dl(Qc(e[1],e.slice(2))):r==="has"?qc(e[1]):r==="!has"?Dl(qc(e[1])):r!=="within"||e}function Dc(e,t,r){switch(e){case"$type":return["filter-type-"+r,t];case"$id":return["filter-id-"+r,t];default:return["filter-"+r,e,t]}}function Qc(e,t){if(t.length===0)return!1;switch(e){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(function(r){return typeof r!=typeof t[0]})?["filter-in-large",e,["literal",t.sort(hc)]]:["filter-in-small",e,["literal",t]]}}function qc(e){switch(e){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",e]}}function Dl(e){return["!",e]}function kc(e){return fc(jt(e.value))?ma(Ir({},e,{expressionContext:"filter",valueSpec:{value:"boolean"}})):function t(r){var c=r.value,v=r.key;if(Ea(c)!=="array")return[new De(v,c,"array expected, "+Ea(c)+" found")];var m,_=r.styleSpec,C=[];if(c.length<1)return[new De(v,c,"filter array must have at least 1 element")];switch(C=C.concat(Jl({key:v+"[0]",value:c[0],valueSpec:_.filter_operator,style:r.style,styleSpec:r.styleSpec})),Ur(c[0])){case"<":case"<=":case">":case">=":c.length>=2&&Ur(c[1])==="$type"&&C.push(new De(v,c,'"$type" cannot be use with operator "'+c[0]+'"'));case"==":case"!=":c.length!==3&&C.push(new De(v,c,'filter array for operator "'+c[0]+'" must have 3 elements'));case"in":case"!in":c.length>=2&&(m=Ea(c[1]))!=="string"&&C.push(new De(v+"[1]",c[1],"string expected, "+m+" found"));for(var k=2;k<c.length;k++)m=Ea(c[k]),Ur(c[1])==="$type"?C=C.concat(Jl({key:v+"["+k+"]",value:c[k],valueSpec:_.geometry_type,style:r.style,styleSpec:r.styleSpec})):m!=="string"&&m!=="number"&&m!=="boolean"&&C.push(new De(v+"["+k+"]",c[k],"string, number, or boolean expected, "+m+" found"));break;case"any":case"all":case"none":for(var B=1;B<c.length;B++)C=C.concat(t({key:v+"["+B+"]",value:c[B],style:r.style,styleSpec:r.styleSpec}));break;case"has":case"!has":m=Ea(c[1]),c.length!==2?C.push(new De(v,c,'filter array for "'+c[0]+'" operator must have 2 elements')):m!=="string"&&C.push(new De(v+"[1]",c[1],"string expected, "+m+" found"));break;case"within":m=Ea(c[1]),c.length!==2?C.push(new De(v,c,'filter array for "'+c[0]+'" operator must have 2 elements')):m!=="object"&&C.push(new De(v+"[1]",c[1],"object expected, "+m+" found"))}return C}(e)}function Fc(e,t){var r=e.key,c=e.style,v=e.styleSpec,m=e.value,_=e.objectKey,C=v[t+"_"+e.layerType];if(!C)return[];var k=_.match(/^(.*)-transition$/);if(t==="paint"&&k&&C[k[1]]&&C[k[1]].transition)return Ni({key:r,value:m,valueSpec:v.transition,style:c,styleSpec:v});var B,W=e.valueSpec||C[_];if(!W)return[new De(r,m,'unknown property "'+_+'"')];if(Ea(m)==="string"&&$u(W)&&!W.tokens&&(B=/^{([^}]+)}$/.exec(m)))return[new De(r,m,'"'+_+'" does not support interpolation syntax\nUse an identity property function instead: `{ "type": "identity", "property": '+JSON.stringify(B[1])+" }`.")];var K=[];return e.layerType==="symbol"&&(_==="text-field"&&c&&!c.glyphs&&K.push(new De(r,m,'use of "text-field" requires a style "glyphs" property')),_==="text-font"&&Ju(jt(m))&&Ur(m.type)==="identity"&&K.push(new De(r,m,'"text-font" does not support identity functions'))),K.concat(Ni({key:e.key,value:m,valueSpec:W,style:c,styleSpec:v,expressionContext:"property",propertyType:t,propertyKey:_}))}function zc(e){return Fc(e,"paint")}function vl(e){return Fc(e,"layout")}function Nc(e){var t=[],r=e.value,c=e.key,v=e.style,m=e.styleSpec;r.type||r.ref||t.push(new De(c,r,'either "type" or "ref" is required'));var _,C=Ur(r.type),k=Ur(r.ref);if(r.id)for(var B=Ur(r.id),W=0;W<e.arrayIndex;W++){var K=v.layers[W];Ur(K.id)===B&&t.push(new De(c,r.id,'duplicate layer id "'+r.id+'", previously used at line '+K.id.__line__))}if("ref"in r)["type","source","source-layer","filter","layout"].forEach(function(Ve){Ve in r&&t.push(new De(c,r[Ve],'"'+Ve+'" is prohibited for ref layers'))}),v.layers.forEach(function(Ve){Ur(Ve.id)===k&&(_=Ve)}),_?_.ref?t.push(new De(c,r.ref,"ref cannot reference another ref layer")):C=Ur(_.type):t.push(new De(c,r.ref,'ref layer "'+k+'" not found'));else if(C!=="background")if(r.source){var oe=v.sources&&v.sources[r.source],ce=oe&&Ur(oe.type);oe?ce==="vector"&&C==="raster"?t.push(new De(c,r.source,'layer "'+r.id+'" requires a raster source')):ce==="raster"&&C!=="raster"?t.push(new De(c,r.source,'layer "'+r.id+'" requires a vector source')):ce!=="vector"||r["source-layer"]?ce==="raster-dem"&&C!=="hillshade"?t.push(new De(c,r.source,"raster-dem source can only be used with layer type 'hillshade'.")):C!=="line"||!r.paint||!r.paint["line-gradient"]||ce==="geojson"&&oe.lineMetrics||t.push(new De(c,r,'layer "'+r.id+'" specifies a line-gradient, which requires a GeoJSON source with `lineMetrics` enabled.')):t.push(new De(c,r,'layer "'+r.id+'" must specify a "source-layer"')):t.push(new De(c,r.source,'source "'+r.source+'" not found'))}else t.push(new De(c,r,'missing required property "source"'));return t=t.concat(Ks({key:c,value:r,valueSpec:m.layer,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{"*":function(){return[]},type:function(){return Ni({key:c+".type",value:r.type,valueSpec:m.layer.type,style:e.style,styleSpec:e.styleSpec,object:r,objectKey:"type"})},filter:kc,layout:function(Ve){return Ks({layer:r,key:Ve.key,value:Ve.value,style:Ve.style,styleSpec:Ve.styleSpec,objectElementValidators:{"*":function(We){return vl(Ir({layerType:C},We))}}})},paint:function(Ve){return Ks({layer:r,key:Ve.key,value:Ve.value,style:Ve.style,styleSpec:Ve.styleSpec,objectElementValidators:{"*":function(We){return zc(Ir({layerType:C},We))}}})}}}))}function zu(e){var t=e.value,r=e.key,c=Ea(t);return c!=="string"?[new De(r,t,"string expected, "+c+" found")]:[]}var ka={promoteId:function(e){var t=e.key,r=e.value;if(Ea(r)==="string")return zu({key:t,value:r});var c=[];for(var v in r)c.push.apply(c,zu({key:t+"."+v,value:r[v]}));return c}};function Ql(e){var t=e.value,r=e.key,c=e.styleSpec,v=e.style;if(!t.type)return[new De(r,t,'"type" is required')];var m,_=Ur(t.type);switch(_){case"vector":case"raster":case"raster-dem":return Ks({key:r,value:t,valueSpec:c["source_"+_.replace("-","_")],style:e.style,styleSpec:c,objectElementValidators:ka});case"geojson":if(m=Ks({key:r,value:t,valueSpec:c.source_geojson,style:v,styleSpec:c,objectElementValidators:ka}),t.cluster)for(var C in t.clusterProperties){var k=t.clusterProperties[C],B=k[0],W=typeof B=="string"?[B,["accumulated"],["get",C]]:B;m.push.apply(m,ma({key:r+"."+C+".map",value:k[1],expressionContext:"cluster-map"})),m.push.apply(m,ma({key:r+"."+C+".reduce",value:W,expressionContext:"cluster-reduce"}))}return m;case"video":return Ks({key:r,value:t,valueSpec:c.source_video,style:v,styleSpec:c});case"image":return Ks({key:r,value:t,valueSpec:c.source_image,style:v,styleSpec:c});case"canvas":return[new De(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Jl({key:r+".type",value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:v,styleSpec:c})}}function Nu(e){var t=e.value,r=e.styleSpec,c=r.light,v=e.style,m=[],_=Ea(t);if(t===void 0)return m;if(_!=="object")return m.concat([new De("light",t,"object expected, "+_+" found")]);for(var C in t){var k=C.match(/^(.*)-transition$/);m=m.concat(k&&c[k[1]]&&c[k[1]].transition?Ni({key:C,value:t[C],valueSpec:r.transition,style:v,styleSpec:r}):c[C]?Ni({key:C,value:t[C],valueSpec:c[C],style:v,styleSpec:r}):[new De(C,t[C],'unknown property "'+C+'"')])}return m}var el={"*":function(){return[]},array:Ll,boolean:function(e){var t=e.value,r=e.key,c=Ea(t);return c!=="boolean"?[new De(r,t,"boolean expected, "+c+" found")]:[]},number:$c,color:function(e){var t=e.key,r=e.value,c=Ea(r);return c!=="string"?[new De(t,r,"color expected, "+c+" found")]:li(r)===null?[new De(t,r,'color expected, "'+r+'" found')]:[]},constants:wt,enum:Jl,filter:kc,function:Jc,layer:Nc,object:Ks,source:Ql,light:Nu,string:zu,formatted:function(e){return zu(e).length===0?[]:ma(e)},resolvedImage:function(e){return zu(e).length===0?[]:ma(e)}};function Ni(e){var t=e.value,r=e.valueSpec,c=e.styleSpec;return r.expression&&Ju(Ur(t))?Jc(e):r.expression&&Su(jt(t))?ma(e):r.type&&el[r.type]?el[r.type](e):Ks(Ir({},e,{valueSpec:r.type?c[r.type]:r}))}function Pa(e){var t=e.value,r=e.key,c=zu(e);return c.length||(t.indexOf("{fontstack}")===-1&&c.push(new De(r,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&c.push(new De(r,t,'"glyphs" url must include a "{range}" token'))),c}function Ma(e,t){t===void 0&&(t=ue);var r=[];return r=r.concat(Ni({key:"",value:e,valueSpec:t.$root,styleSpec:t,style:e,objectElementValidators:{glyphs:Pa,"*":function(){return[]}}})),e.constants&&(r=r.concat(wt({key:"constants",value:e.constants,style:e,styleSpec:t}))),ql(r)}function ql(e){return[].concat(e).sort(function(t,r){return t.line-r.line})}function kl(e){return function(){for(var t=[],r=arguments.length;r--;)t[r]=arguments[r];return ql(e.apply(this,t))}}Ma.source=kl(Ql),Ma.light=kl(Nu),Ma.layer=kl(Nc),Ma.filter=kl(kc),Ma.paintProperty=kl(zc),Ma.layoutProperty=kl(vl);var ec=Ma,yf=ec.light,_f=ec.paintProperty,Fl=ec.layoutProperty;function Bu(e,t){var r=!1;if(t&&t.length)for(var c=0,v=t;c<v.length;c+=1)e.fire(new Le(new Error(v[c].message))),r=!0;return r}var Uu=to;function to(e,t,r){var c=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;var v=new Int32Array(this.arrayBuffer);e=v[0],this.d=(t=v[1])+2*(r=v[2]);for(var m=0;m<this.d*this.d;m++){var _=v[3+m],C=v[3+m+1];c.push(_===C?null:v.subarray(_,C))}var k=v[3+c.length+1];this.keys=v.subarray(v[3+c.length],k),this.bboxes=v.subarray(k),this.insert=this._insertReadonly}else{this.d=t+2*r;for(var B=0;B<this.d*this.d;B++)c.push([]);this.keys=[],this.bboxes=[]}this.n=t,this.extent=e,this.padding=r,this.scale=t/e,this.uid=0;var W=r/t*e;this.min=-W,this.max=e+W}to.prototype.insert=function(e,t,r,c,v){this._forEachCell(t,r,c,v,this._insertCell,this.uid++),this.keys.push(e),this.bboxes.push(t),this.bboxes.push(r),this.bboxes.push(c),this.bboxes.push(v)},to.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},to.prototype._insertCell=function(e,t,r,c,v,m){this.cells[v].push(m)},to.prototype.query=function(e,t,r,c,v){var m=this.min,_=this.max;if(e<=m&&t<=m&&_<=r&&_<=c&&!v)return Array.prototype.slice.call(this.keys);var C=[];return this._forEachCell(e,t,r,c,this._queryCell,C,{},v),C},to.prototype._queryCell=function(e,t,r,c,v,m,_,C){var k=this.cells[v];if(k!==null)for(var B=this.keys,W=this.bboxes,K=0;K<k.length;K++){var oe=k[K];if(_[oe]===void 0){var ce=4*oe;(C?C(W[ce+0],W[ce+1],W[ce+2],W[ce+3]):e<=W[ce+2]&&t<=W[ce+3]&&r>=W[ce+0]&&c>=W[ce+1])?(_[oe]=!0,m.push(B[oe])):_[oe]=!1}}},to.prototype._forEachCell=function(e,t,r,c,v,m,_,C){for(var k=this._convertToCellCoord(e),B=this._convertToCellCoord(t),W=this._convertToCellCoord(r),K=this._convertToCellCoord(c),oe=k;oe<=W;oe++)for(var ce=B;ce<=K;ce++){var Ve=this.d*ce+oe;if((!C||C(this._convertFromCellCoord(oe),this._convertFromCellCoord(ce),this._convertFromCellCoord(oe+1),this._convertFromCellCoord(ce+1)))&&v.call(this,e,t,r,c,Ve,m,_,C))return}},to.prototype._convertFromCellCoord=function(e){return(e-this.padding)/this.scale},to.prototype._convertToCellCoord=function(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))},to.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var e=this.cells,t=3+this.cells.length+1+1,r=0,c=0;c<this.cells.length;c++)r+=this.cells[c].length;var v=new Int32Array(t+r+this.keys.length+this.bboxes.length);v[0]=this.extent,v[1]=this.n,v[2]=this.padding;for(var m=t,_=0;_<e.length;_++){var C=e[_];v[3+_]=m,v.set(C,m),m+=C.length}return v[3+e.length]=m,v.set(this.keys,m),v[3+e.length+1]=m+=this.keys.length,v.set(this.bboxes,m),m+=this.bboxes.length,v.buffer};var ds=ne.ImageData,ml=ne.ImageBitmap,lo={};function Tn(e,t,r){r===void 0&&(r={}),Object.defineProperty(t,"_classRegistryKey",{value:e,writeable:!1}),lo[e]={klass:t,omit:r.omit||[],shallow:r.shallow||[]}}for(var Is in Tn("Object",Object),Uu.serialize=function(e,t){var r=e.toArrayBuffer();return t&&t.push(r),{buffer:r}},Uu.deserialize=function(e){return new Uu(e.buffer)},Tn("Grid",Uu),Tn("Color",Vn),Tn("Error",Error),Tn("ResolvedImage",Ba),Tn("StylePropertyFunction",dl),Tn("StyleExpression",Qu,{omit:["_evaluator"]}),Tn("ZoomDependentExpression",pl),Tn("ZoomConstantExpression",Ol),Tn("CompoundExpression",qa,{omit:["_evaluate"]}),ns)ns[Is]._classRegistryKey||Tn("Expression_"+Is,ns[Is]);function tc(e){return e&&typeof ArrayBuffer!="undefined"&&(e instanceof ArrayBuffer||e.constructor&&e.constructor.name==="ArrayBuffer")}function gl(e){return ml&&e instanceof ml}function $s(e,t){if(e==null||typeof e=="boolean"||typeof e=="number"||typeof e=="string"||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp)return e;if(tc(e)||gl(e))return t&&t.push(e),e;if(ArrayBuffer.isView(e)){var r=e;return t&&t.push(r.buffer),r}if(e instanceof ds)return t&&t.push(e.data.buffer),e;if(Array.isArray(e)){for(var c=[],v=0,m=e;v<m.length;v+=1)c.push($s(m[v],t));return c}if(typeof e=="object"){var _=e.constructor,C=_._classRegistryKey;if(!C)throw new Error("can't serialize object of unregistered class");var k=_.serialize?_.serialize(e,t):{};if(!_.serialize){for(var B in e)if(e.hasOwnProperty(B)&&!(lo[C].omit.indexOf(B)>=0)){var W=e[B];k[B]=lo[C].shallow.indexOf(B)>=0?W:$s(W,t)}e instanceof Error&&(k.message=e.message)}if(k.$name)throw new Error("$name property is reserved for worker serialization logic.");return C!=="Object"&&(k.$name=C),k}throw new Error("can't serialize object of type "+typeof e)}function Us(e){if(e==null||typeof e=="boolean"||typeof e=="number"||typeof e=="string"||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp||tc(e)||gl(e)||ArrayBuffer.isView(e)||e instanceof ds)return e;if(Array.isArray(e))return e.map(Us);if(typeof e=="object"){var t=e.$name||"Object",r=lo[t].klass;if(!r)throw new Error("can't deserialize unregistered class "+t);if(r.deserialize)return r.deserialize(e);for(var c=Object.create(r.prototype),v=0,m=Object.keys(e);v<m.length;v+=1){var _=m[v];if(_!=="$name"){var C=e[_];c[_]=lo[t].shallow.indexOf(_)>=0?C:Us(C)}}return c}throw new Error("can't deserialize object of type "+typeof e)}var yl=function(){this.first=!0};yl.prototype.update=function(e,t){var r=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=r,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=r,!0):(this.lastFloorZoom>r?(this.lastIntegerZoom=r+1,this.lastIntegerZoomTime=t):this.lastFloorZoom<r&&(this.lastIntegerZoom=r,this.lastIntegerZoomTime=t),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=r,!0))};var Jr={"Latin-1 Supplement":function(e){return e>=128&&e<=255},Arabic:function(e){return e>=1536&&e<=1791},"Arabic Supplement":function(e){return e>=1872&&e<=1919},"Arabic Extended-A":function(e){return e>=2208&&e<=2303},"Hangul Jamo":function(e){return e>=4352&&e<=4607},"Unified Canadian Aboriginal Syllabics":function(e){return e>=5120&&e<=5759},Khmer:function(e){return e>=6016&&e<=6143},"Unified Canadian Aboriginal Syllabics Extended":function(e){return e>=6320&&e<=6399},"General Punctuation":function(e){return e>=8192&&e<=8303},"Letterlike Symbols":function(e){return e>=8448&&e<=8527},"Number Forms":function(e){return e>=8528&&e<=8591},"Miscellaneous Technical":function(e){return e>=8960&&e<=9215},"Control Pictures":function(e){return e>=9216&&e<=9279},"Optical Character Recognition":function(e){return e>=9280&&e<=9311},"Enclosed Alphanumerics":function(e){return e>=9312&&e<=9471},"Geometric Shapes":function(e){return e>=9632&&e<=9727},"Miscellaneous Symbols":function(e){return e>=9728&&e<=9983},"Miscellaneous Symbols and Arrows":function(e){return e>=11008&&e<=11263},"CJK Radicals Supplement":function(e){return e>=11904&&e<=12031},"Kangxi Radicals":function(e){return e>=12032&&e<=12255},"Ideographic Description Characters":function(e){return e>=12272&&e<=12287},"CJK Symbols and Punctuation":function(e){return e>=12288&&e<=12351},Hiragana:function(e){return e>=12352&&e<=12447},Katakana:function(e){return e>=12448&&e<=12543},Bopomofo:function(e){return e>=12544&&e<=12591},"Hangul Compatibility Jamo":function(e){return e>=12592&&e<=12687},Kanbun:function(e){return e>=12688&&e<=12703},"Bopomofo Extended":function(e){return e>=12704&&e<=12735},"CJK Strokes":function(e){return e>=12736&&e<=12783},"Katakana Phonetic Extensions":function(e){return e>=12784&&e<=12799},"Enclosed CJK Letters and Months":function(e){return e>=12800&&e<=13055},"CJK Compatibility":function(e){return e>=13056&&e<=13311},"CJK Unified Ideographs Extension A":function(e){return e>=13312&&e<=19903},"Yijing Hexagram Symbols":function(e){return e>=19904&&e<=19967},"CJK Unified Ideographs":function(e){return e>=19968&&e<=40959},"Yi Syllables":function(e){return e>=40960&&e<=42127},"Yi Radicals":function(e){return e>=42128&&e<=42191},"Hangul Jamo Extended-A":function(e){return e>=43360&&e<=43391},"Hangul Syllables":function(e){return e>=44032&&e<=55215},"Hangul Jamo Extended-B":function(e){return e>=55216&&e<=55295},"Private Use Area":function(e){return e>=57344&&e<=63743},"CJK Compatibility Ideographs":function(e){return e>=63744&&e<=64255},"Arabic Presentation Forms-A":function(e){return e>=64336&&e<=65023},"Vertical Forms":function(e){return e>=65040&&e<=65055},"CJK Compatibility Forms":function(e){return e>=65072&&e<=65103},"Small Form Variants":function(e){return e>=65104&&e<=65135},"Arabic Presentation Forms-B":function(e){return e>=65136&&e<=65279},"Halfwidth and Fullwidth Forms":function(e){return e>=65280&&e<=65519}};function Bc(e){for(var t=0,r=e;t<r.length;t+=1)if(pc(r[t].charCodeAt(0)))return!0;return!1}function pc(e){return!(e!==746&&e!==747&&(e<4352||!(Jr["Bopomofo Extended"](e)||Jr.Bopomofo(e)||Jr["CJK Compatibility Forms"](e)&&!(e>=65097&&e<=65103)||Jr["CJK Compatibility Ideographs"](e)||Jr["CJK Compatibility"](e)||Jr["CJK Radicals Supplement"](e)||Jr["CJK Strokes"](e)||!(!Jr["CJK Symbols and Punctuation"](e)||e>=12296&&e<=12305||e>=12308&&e<=12319||e===12336)||Jr["CJK Unified Ideographs Extension A"](e)||Jr["CJK Unified Ideographs"](e)||Jr["Enclosed CJK Letters and Months"](e)||Jr["Hangul Compatibility Jamo"](e)||Jr["Hangul Jamo Extended-A"](e)||Jr["Hangul Jamo Extended-B"](e)||Jr["Hangul Jamo"](e)||Jr["Hangul Syllables"](e)||Jr.Hiragana(e)||Jr["Ideographic Description Characters"](e)||Jr.Kanbun(e)||Jr["Kangxi Radicals"](e)||Jr["Katakana Phonetic Extensions"](e)||Jr.Katakana(e)&&e!==12540||!(!Jr["Halfwidth and Fullwidth Forms"](e)||e===65288||e===65289||e===65293||e>=65306&&e<=65310||e===65339||e===65341||e===65343||e>=65371&&e<=65503||e===65507||e>=65512&&e<=65519)||!(!Jr["Small Form Variants"](e)||e>=65112&&e<=65118||e>=65123&&e<=65126)||Jr["Unified Canadian Aboriginal Syllabics"](e)||Jr["Unified Canadian Aboriginal Syllabics Extended"](e)||Jr["Vertical Forms"](e)||Jr["Yijing Hexagram Symbols"](e)||Jr["Yi Syllables"](e)||Jr["Yi Radicals"](e))))}function tl(e){return!(pc(e)||function(t){return!!(Jr["Latin-1 Supplement"](t)&&(t===167||t===169||t===174||t===177||t===188||t===189||t===190||t===215||t===247)||Jr["General Punctuation"](t)&&(t===8214||t===8224||t===8225||t===8240||t===8241||t===8251||t===8252||t===8258||t===8263||t===8264||t===8265||t===8273)||Jr["Letterlike Symbols"](t)||Jr["Number Forms"](t)||Jr["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||t===9003||t>=9085&&t<=9114||t>=9150&&t<=9165||t===9167||t>=9169&&t<=9179||t>=9186&&t<=9215)||Jr["Control Pictures"](t)&&t!==9251||Jr["Optical Character Recognition"](t)||Jr["Enclosed Alphanumerics"](t)||Jr["Geometric Shapes"](t)||Jr["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||Jr["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||Jr["CJK Symbols and Punctuation"](t)||Jr.Katakana(t)||Jr["Private Use Area"](t)||Jr["CJK Compatibility Forms"](t)||Jr["Small Form Variants"](t)||Jr["Halfwidth and Fullwidth Forms"](t)||t===8734||t===8756||t===8757||t>=9984&&t<=10087||t>=10102&&t<=10131||t===65532||t===65533)}(e))}function Js(e){return e>=1424&&e<=2303||Jr["Arabic Presentation Forms-A"](e)||Jr["Arabic Presentation Forms-B"](e)}function Ss(e,t){return!(!t&&Js(e)||e>=2304&&e<=3583||e>=3840&&e<=4255||Jr.Khmer(e))}function dc(e){for(var t=0,r=e;t<r.length;t+=1)if(Js(r[t].charCodeAt(0)))return!0;return!1}var vc=null,Os="unavailable",ju=null,_l=function(e){e&&typeof e=="string"&&e.indexOf("NetworkError")>-1&&(Os="error"),vc&&vc(e)};function zl(){ef.fire(new ie("pluginStateChange",{pluginStatus:Os,pluginURL:ju}))}var ef=new Ge,Uc=function(){return Os},Eu=function(){if(Os!=="deferred"||!ju)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Os="loading",zl(),ju&&Wi({url:ju},function(e){e?_l(e):(Os="loaded",zl())})},Qs={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:function(){return Os==="loaded"||Qs.applyArabicShaping!=null},isLoading:function(){return Os==="loading"},setState:function(e){Os=e.pluginStatus,ju=e.pluginURL},isParsed:function(){return Qs.applyArabicShaping!=null&&Qs.processBidirectionalText!=null&&Qs.processStyledBidirectionalText!=null},getPluginURL:function(){return ju}},Fi=function(e,t){this.zoom=e,t?(this.now=t.now,this.fadeDuration=t.fadeDuration,this.zoomHistory=t.zoomHistory,this.transition=t.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new yl,this.transition={})};Fi.prototype.isSupportedScript=function(e){return function(t,r){for(var c=0,v=t;c<v.length;c+=1)if(!Ss(v[c].charCodeAt(0),r))return!1;return!0}(e,Qs.isLoaded())},Fi.prototype.crossFadingFactor=function(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)},Fi.prototype.getCrossfadeParameters=function(){var e=this.zoom,t=e-Math.floor(e),r=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:t+(1-t)*r}:{fromScale:.5,toScale:1,t:1-(1-r)*t}};var Zu=function(e,t){this.property=e,this.value=t,this.expression=function(r,c){if(Ju(r))return new dl(r,c);if(Su(r)){var v=Rc(r,c);if(v.result==="error")throw new Error(v.value.map(function(_){return _.key+": "+_.message}).join(", "));return v.value}var m=r;return typeof r=="string"&&c.type==="color"&&(m=Vn.parse(r)),{kind:"constant",evaluate:function(){return m}}}(t===void 0?e.specification.default:t,e.specification)};Zu.prototype.isDataDriven=function(){return this.expression.kind==="source"||this.expression.kind==="composite"},Zu.prototype.possiblyEvaluate=function(e,t,r){return this.property.possiblyEvaluate(this,e,t,r)};var is=function(e){this.property=e,this.value=new Zu(e,void 0)};is.prototype.transitioned=function(e,t){return new xl(this.property,this.value,t,Xt({},e.transition,this.transition),e.now)},is.prototype.untransitioned=function(){return new xl(this.property,this.value,null,{},0)};var Mo=function(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)};Mo.prototype.getValue=function(e){return Ye(this._values[e].value.value)},Mo.prototype.setValue=function(e,t){this._values.hasOwnProperty(e)||(this._values[e]=new is(this._values[e].property)),this._values[e].value=new Zu(this._values[e].property,t===null?void 0:Ye(t))},Mo.prototype.getTransition=function(e){return Ye(this._values[e].transition)},Mo.prototype.setTransition=function(e,t){this._values.hasOwnProperty(e)||(this._values[e]=new is(this._values[e].property)),this._values[e].transition=Ye(t)||void 0},Mo.prototype.serialize=function(){for(var e={},t=0,r=Object.keys(this._values);t<r.length;t+=1){var c=r[t],v=this.getValue(c);v!==void 0&&(e[c]=v);var m=this.getTransition(c);m!==void 0&&(e[c+"-transition"]=m)}return e},Mo.prototype.transitioned=function(e,t){for(var r=new rl(this._properties),c=0,v=Object.keys(this._values);c<v.length;c+=1){var m=v[c];r._values[m]=this._values[m].transitioned(e,t._values[m])}return r},Mo.prototype.untransitioned=function(){for(var e=new rl(this._properties),t=0,r=Object.keys(this._values);t<r.length;t+=1){var c=r[t];e._values[c]=this._values[c].untransitioned()}return e};var xl=function(e,t,r,c,v){this.property=e,this.value=t,this.begin=v+c.delay||0,this.end=this.begin+c.duration||0,e.specification.transition&&(c.delay||c.duration)&&(this.prior=r)};xl.prototype.possiblyEvaluate=function(e,t,r){var c=e.now||0,v=this.value.possiblyEvaluate(e,t,r),m=this.prior;if(m){if(c>this.end)return this.prior=null,v;if(this.value.isDataDriven())return this.prior=null,v;if(c<this.begin)return m.possiblyEvaluate(e,t,r);var _=(c-this.begin)/(this.end-this.begin);return this.property.interpolate(m.possiblyEvaluate(e,t,r),v,function(C){if(C<=0)return 0;if(C>=1)return 1;var k=C*C,B=k*C;return 4*(C<.5?B:3*(C-k)+B-.75)}(_))}return v};var rl=function(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)};rl.prototype.possiblyEvaluate=function(e,t,r){for(var c=new nl(this._properties),v=0,m=Object.keys(this._values);v<m.length;v+=1){var _=m[v];c._values[_]=this._values[_].possiblyEvaluate(e,t,r)}return c},rl.prototype.hasTransition=function(){for(var e=0,t=Object.keys(this._values);e<t.length;e+=1)if(this._values[t[e]].prior)return!0;return!1};var fu=function(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)};fu.prototype.getValue=function(e){return Ye(this._values[e].value)},fu.prototype.setValue=function(e,t){this._values[e]=new Zu(this._values[e].property,t===null?void 0:Ye(t))},fu.prototype.serialize=function(){for(var e={},t=0,r=Object.keys(this._values);t<r.length;t+=1){var c=r[t],v=this.getValue(c);v!==void 0&&(e[c]=v)}return e},fu.prototype.possiblyEvaluate=function(e,t,r){for(var c=new nl(this._properties),v=0,m=Object.keys(this._values);v<m.length;v+=1){var _=m[v];c._values[_]=this._values[_].possiblyEvaluate(e,t,r)}return c};var vs=function(e,t,r){this.property=e,this.value=t,this.parameters=r};vs.prototype.isConstant=function(){return this.value.kind==="constant"},vs.prototype.constantOr=function(e){return this.value.kind==="constant"?this.value.value:e},vs.prototype.evaluate=function(e,t,r,c){return this.property.evaluate(this.value,this.parameters,e,t,r,c)};var nl=function(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)};nl.prototype.get=function(e){return this._values[e]};var Un=function(e){this.specification=e};Un.prototype.possiblyEvaluate=function(e,t){return e.expression.evaluate(t)},Un.prototype.interpolate=function(e,t,r){var c=Ws[this.specification.type];return c?c(e,t,r):e};var Mn=function(e,t){this.specification=e,this.overrides=t};Mn.prototype.possiblyEvaluate=function(e,t,r,c){return new vs(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(t,null,{},r,c)}:e.expression,t)},Mn.prototype.interpolate=function(e,t,r){if(e.value.kind!=="constant"||t.value.kind!=="constant")return e;if(e.value.value===void 0||t.value.value===void 0)return new vs(this,{kind:"constant",value:void 0},e.parameters);var c=Ws[this.specification.type];return c?new vs(this,{kind:"constant",value:c(e.value.value,t.value.value,r)},e.parameters):e},Mn.prototype.evaluate=function(e,t,r,c,v,m){return e.kind==="constant"?e.value:e.evaluate(t,r,c,v,m)};var rc=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.possiblyEvaluate=function(r,c,v,m){if(r.value===void 0)return new vs(this,{kind:"constant",value:void 0},c);if(r.expression.kind==="constant"){var _=r.expression.evaluate(c,null,{},v,m),C=r.property.specification.type==="resolvedImage"&&typeof _!="string"?_.name:_,k=this._calculate(C,C,C,c);return new vs(this,{kind:"constant",value:k},c)}if(r.expression.kind==="camera"){var B=this._calculate(r.expression.evaluate({zoom:c.zoom-1}),r.expression.evaluate({zoom:c.zoom}),r.expression.evaluate({zoom:c.zoom+1}),c);return new vs(this,{kind:"constant",value:B},c)}return new vs(this,r.expression,c)},t.prototype.evaluate=function(r,c,v,m,_,C){if(r.kind==="source"){var k=r.evaluate(c,v,m,_,C);return this._calculate(k,k,k,c)}return r.kind==="composite"?this._calculate(r.evaluate({zoom:Math.floor(c.zoom)-1},v,m),r.evaluate({zoom:Math.floor(c.zoom)},v,m),r.evaluate({zoom:Math.floor(c.zoom)+1},v,m),c):r.value},t.prototype._calculate=function(r,c,v,m){return m.zoom>m.zoomHistory.lastIntegerZoom?{from:r,to:c}:{from:v,to:c}},t.prototype.interpolate=function(r){return r},t}(Mn),as=function(e){this.specification=e};as.prototype.possiblyEvaluate=function(e,t,r,c){if(e.value!==void 0){if(e.expression.kind==="constant"){var v=e.expression.evaluate(t,null,{},r,c);return this._calculate(v,v,v,t)}return this._calculate(e.expression.evaluate(new Fi(Math.floor(t.zoom-1),t)),e.expression.evaluate(new Fi(Math.floor(t.zoom),t)),e.expression.evaluate(new Fi(Math.floor(t.zoom+1),t)),t)}},as.prototype._calculate=function(e,t,r,c){return c.zoom>c.zoomHistory.lastIntegerZoom?{from:e,to:t}:{from:r,to:t}},as.prototype.interpolate=function(e){return e};var vo=function(e){this.specification=e};vo.prototype.possiblyEvaluate=function(e,t,r,c){return!!e.expression.evaluate(t,null,{},r,c)},vo.prototype.interpolate=function(){return!1};var ko=function(e){for(var t in this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[],e){var r=e[t];r.specification.overridable&&this.overridableProperties.push(t);var c=this.defaultPropertyValues[t]=new Zu(r,void 0),v=this.defaultTransitionablePropertyValues[t]=new is(r);this.defaultTransitioningPropertyValues[t]=v.untransitioned(),this.defaultPossiblyEvaluatedValues[t]=c.possiblyEvaluate({})}};Tn("DataDrivenProperty",Mn),Tn("DataConstantProperty",Un),Tn("CrossFadedDataDrivenProperty",rc),Tn("CrossFadedProperty",as),Tn("ColorRampProperty",vo);var hu=function(e){function t(r,c){if(e.call(this),this.id=r.id,this.type=r.type,this._featureFilter={filter:function(){return!0},needGeometry:!1},r.type!=="custom"&&(this.metadata=(r=r).metadata,this.minzoom=r.minzoom,this.maxzoom=r.maxzoom,r.type!=="background"&&(this.source=r.source,this.sourceLayer=r["source-layer"],this.filter=r.filter),c.layout&&(this._unevaluatedLayout=new fu(c.layout)),c.paint)){for(var v in this._transitionablePaint=new Mo(c.paint),r.paint)this.setPaintProperty(v,r.paint[v],{validate:!1});for(var m in r.layout)this.setLayoutProperty(m,r.layout[m],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new nl(c.paint)}}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getCrossfadeParameters=function(){return this._crossfadeParameters},t.prototype.getLayoutProperty=function(r){return r==="visibility"?this.visibility:this._unevaluatedLayout.getValue(r)},t.prototype.setLayoutProperty=function(r,c,v){v===void 0&&(v={}),c!=null&&this._validate(Fl,"layers."+this.id+".layout."+r,r,c,v)||(r!=="visibility"?this._unevaluatedLayout.setValue(r,c):this.visibility=c)},t.prototype.getPaintProperty=function(r){return Gt(r,"-transition")?this._transitionablePaint.getTransition(r.slice(0,-"-transition".length)):this._transitionablePaint.getValue(r)},t.prototype.setPaintProperty=function(r,c,v){if(v===void 0&&(v={}),c!=null&&this._validate(_f,"layers."+this.id+".paint."+r,r,c,v))return!1;if(Gt(r,"-transition"))return this._transitionablePaint.setTransition(r.slice(0,-"-transition".length),c||void 0),!1;var m=this._transitionablePaint._values[r],_=m.property.specification["property-type"]==="cross-faded-data-driven",C=m.value.isDataDriven(),k=m.value;this._transitionablePaint.setValue(r,c),this._handleSpecialPaintPropertyUpdate(r);var B=this._transitionablePaint._values[r].value;return B.isDataDriven()||C||_||this._handleOverridablePaintPropertyUpdate(r,k,B)},t.prototype._handleSpecialPaintPropertyUpdate=function(r){},t.prototype._handleOverridablePaintPropertyUpdate=function(r,c,v){return!1},t.prototype.isHidden=function(r){return!!(this.minzoom&&r<this.minzoom)||!!(this.maxzoom&&r>=this.maxzoom)||this.visibility==="none"},t.prototype.updateTransitions=function(r){this._transitioningPaint=this._transitionablePaint.transitioned(r,this._transitioningPaint)},t.prototype.hasTransition=function(){return this._transitioningPaint.hasTransition()},t.prototype.recalculate=function(r,c){r.getCrossfadeParameters&&(this._crossfadeParameters=r.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(r,void 0,c)),this.paint=this._transitioningPaint.possiblyEvaluate(r,void 0,c)},t.prototype.serialize=function(){var r={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(r.layout=r.layout||{},r.layout.visibility=this.visibility),gt(r,function(c,v){return!(c===void 0||v==="layout"&&!Object.keys(c).length||v==="paint"&&!Object.keys(c).length)})},t.prototype._validate=function(r,c,v,m,_){return _===void 0&&(_={}),(!_||_.validate!==!1)&&Bu(this,r.call(ec,{key:c,layerType:this.type,objectKey:v,value:m,styleSpec:ue,style:{glyphs:!0,sprite:!0}}))},t.prototype.is3D=function(){return!1},t.prototype.isTileClipped=function(){return!1},t.prototype.hasOffscreenPass=function(){return!1},t.prototype.resize=function(){},t.prototype.isStateDependent=function(){for(var r in this.paint._values){var c=this.paint.get(r);if(c instanceof vs&&$u(c.property.specification)&&(c.value.kind==="source"||c.value.kind==="composite")&&c.value.isStateDependent)return!0}return!1},t}(Ge),js={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array},Nl=function(e,t){this._structArray=e,this._pos1=t*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8},Ki=function(){this.isTransferred=!1,this.capacity=-1,this.resize(0)};function So(e,t){t===void 0&&(t=1);var r=0,c=0;return{members:e.map(function(v){var m=js[v.type].BYTES_PER_ELEMENT,_=r=tf(r,Math.max(t,m)),C=v.components||1;return c=Math.max(c,m),r+=m*C,{name:v.name,type:v.type,components:C,offset:_}}),size:tf(r,Math.max(c,t)),alignment:t}}function tf(e,t){return Math.ceil(e/t)*t}Ki.serialize=function(e,t){return e._trim(),t&&(e.isTransferred=!0,t.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}},Ki.deserialize=function(e){var t=Object.create(this.prototype);return t.arrayBuffer=e.arrayBuffer,t.length=e.length,t.capacity=e.arrayBuffer.byteLength/t.bytesPerElement,t._refreshViews(),t},Ki.prototype._trim=function(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())},Ki.prototype.clear=function(){this.length=0},Ki.prototype.resize=function(e){this.reserve(e),this.length=e},Ki.prototype.reserve=function(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);var t=this.uint8;this._refreshViews(),t&&this.uint8.set(t)}},Ki.prototype._refreshViews=function(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")};var bl=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,c){var v=this.length;return this.resize(v+1),this.emplace(v,r,c)},t.prototype.emplace=function(r,c,v){var m=2*r;return this.int16[m+0]=c,this.int16[m+1]=v,r},t}(Ki);bl.prototype.bytesPerElement=4,Tn("StructArrayLayout2i4",bl);var mc=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,c,v,m){var _=this.length;return this.resize(_+1),this.emplace(_,r,c,v,m)},t.prototype.emplace=function(r,c,v,m,_){var C=4*r;return this.int16[C+0]=c,this.int16[C+1]=v,this.int16[C+2]=m,this.int16[C+3]=_,r},t}(Ki);mc.prototype.bytesPerElement=8,Tn("StructArrayLayout4i8",mc);var wu=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,c,v,m,_,C){var k=this.length;return this.resize(k+1),this.emplace(k,r,c,v,m,_,C)},t.prototype.emplace=function(r,c,v,m,_,C,k){var B=6*r;return this.int16[B+0]=c,this.int16[B+1]=v,this.int16[B+2]=m,this.int16[B+3]=_,this.int16[B+4]=C,this.int16[B+5]=k,r},t}(Ki);wu.prototype.bytesPerElement=12,Tn("StructArrayLayout2i4i12",wu);var Es=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,c,v,m,_,C){var k=this.length;return this.resize(k+1),this.emplace(k,r,c,v,m,_,C)},t.prototype.emplace=function(r,c,v,m,_,C,k){var B=4*r,W=8*r;return this.int16[B+0]=c,this.int16[B+1]=v,this.uint8[W+4]=m,this.uint8[W+5]=_,this.uint8[W+6]=C,this.uint8[W+7]=k,r},t}(Ki);Es.prototype.bytesPerElement=8,Tn("StructArrayLayout2i4ub8",Es);var il=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,c){var v=this.length;return this.resize(v+1),this.emplace(v,r,c)},t.prototype.emplace=function(r,c,v){var m=2*r;return this.float32[m+0]=c,this.float32[m+1]=v,r},t}(Ki);il.prototype.bytesPerElement=8,Tn("StructArrayLayout2f8",il);var Tu=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,c,v,m,_,C,k,B,W,K){var oe=this.length;return this.resize(oe+1),this.emplace(oe,r,c,v,m,_,C,k,B,W,K)},t.prototype.emplace=function(r,c,v,m,_,C,k,B,W,K,oe){var ce=10*r;return this.uint16[ce+0]=c,this.uint16[ce+1]=v,this.uint16[ce+2]=m,this.uint16[ce+3]=_,this.uint16[ce+4]=C,this.uint16[ce+5]=k,this.uint16[ce+6]=B,this.uint16[ce+7]=W,this.uint16[ce+8]=K,this.uint16[ce+9]=oe,r},t}(Ki);Tu.prototype.bytesPerElement=20,Tn("StructArrayLayout10ui20",Tu);var gc=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,c,v,m,_,C,k,B,W,K,oe,ce){var Ve=this.length;return this.resize(Ve+1),this.emplace(Ve,r,c,v,m,_,C,k,B,W,K,oe,ce)},t.prototype.emplace=function(r,c,v,m,_,C,k,B,W,K,oe,ce,Ve){var We=12*r;return this.int16[We+0]=c,this.int16[We+1]=v,this.int16[We+2]=m,this.int16[We+3]=_,this.uint16[We+4]=C,this.uint16[We+5]=k,this.uint16[We+6]=B,this.uint16[We+7]=W,this.int16[We+8]=K,this.int16[We+9]=oe,this.int16[We+10]=ce,this.int16[We+11]=Ve,r},t}(Ki);gc.prototype.bytesPerElement=24,Tn("StructArrayLayout4i4ui4i24",gc);var nc=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,c,v){var m=this.length;return this.resize(m+1),this.emplace(m,r,c,v)},t.prototype.emplace=function(r,c,v,m){var _=3*r;return this.float32[_+0]=c,this.float32[_+1]=v,this.float32[_+2]=m,r},t}(Ki);nc.prototype.bytesPerElement=12,Tn("StructArrayLayout3f12",nc);var yc=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r){var c=this.length;return this.resize(c+1),this.emplace(c,r)},t.prototype.emplace=function(r,c){return this.uint32[1*r+0]=c,r},t}(Ki);yc.prototype.bytesPerElement=4,Tn("StructArrayLayout1ul4",yc);var jc=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,c,v,m,_,C,k,B,W){var K=this.length;return this.resize(K+1),this.emplace(K,r,c,v,m,_,C,k,B,W)},t.prototype.emplace=function(r,c,v,m,_,C,k,B,W,K){var oe=10*r,ce=5*r;return this.int16[oe+0]=c,this.int16[oe+1]=v,this.int16[oe+2]=m,this.int16[oe+3]=_,this.int16[oe+4]=C,this.int16[oe+5]=k,this.uint32[ce+3]=B,this.uint16[oe+8]=W,this.uint16[oe+9]=K,r},t}(Ki);jc.prototype.bytesPerElement=20,Tn("StructArrayLayout6i1ul2ui20",jc);var Bl=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,c,v,m,_,C){var k=this.length;return this.resize(k+1),this.emplace(k,r,c,v,m,_,C)},t.prototype.emplace=function(r,c,v,m,_,C,k){var B=6*r;return this.int16[B+0]=c,this.int16[B+1]=v,this.int16[B+2]=m,this.int16[B+3]=_,this.int16[B+4]=C,this.int16[B+5]=k,r},t}(Ki);Bl.prototype.bytesPerElement=12,Tn("StructArrayLayout2i2i2i12",Bl);var qs=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,c,v,m,_){var C=this.length;return this.resize(C+1),this.emplace(C,r,c,v,m,_)},t.prototype.emplace=function(r,c,v,m,_,C){var k=4*r,B=8*r;return this.float32[k+0]=c,this.float32[k+1]=v,this.float32[k+2]=m,this.int16[B+6]=_,this.int16[B+7]=C,r},t}(Ki);qs.prototype.bytesPerElement=16,Tn("StructArrayLayout2f1f2i16",qs);var _c=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,c,v,m){var _=this.length;return this.resize(_+1),this.emplace(_,r,c,v,m)},t.prototype.emplace=function(r,c,v,m,_){var C=12*r,k=3*r;return this.uint8[C+0]=c,this.uint8[C+1]=v,this.float32[k+1]=m,this.float32[k+2]=_,r},t}(Ki);_c.prototype.bytesPerElement=12,Tn("StructArrayLayout2ub2f12",_c);var al=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,c,v){var m=this.length;return this.resize(m+1),this.emplace(m,r,c,v)},t.prototype.emplace=function(r,c,v,m){var _=3*r;return this.uint16[_+0]=c,this.uint16[_+1]=v,this.uint16[_+2]=m,r},t}(Ki);al.prototype.bytesPerElement=6,Tn("StructArrayLayout3ui6",al);var Au=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,c,v,m,_,C,k,B,W,K,oe,ce,Ve,We,st,et,Tt){var Ut=this.length;return this.resize(Ut+1),this.emplace(Ut,r,c,v,m,_,C,k,B,W,K,oe,ce,Ve,We,st,et,Tt)},t.prototype.emplace=function(r,c,v,m,_,C,k,B,W,K,oe,ce,Ve,We,st,et,Tt,Ut){var nr=24*r,hr=12*r,Mr=48*r;return this.int16[nr+0]=c,this.int16[nr+1]=v,this.uint16[nr+2]=m,this.uint16[nr+3]=_,this.uint32[hr+2]=C,this.uint32[hr+3]=k,this.uint32[hr+4]=B,this.uint16[nr+10]=W,this.uint16[nr+11]=K,this.uint16[nr+12]=oe,this.float32[hr+7]=ce,this.float32[hr+8]=Ve,this.uint8[Mr+36]=We,this.uint8[Mr+37]=st,this.uint8[Mr+38]=et,this.uint32[hr+10]=Tt,this.int16[nr+22]=Ut,r},t}(Ki);Au.prototype.bytesPerElement=48,Tn("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Au);var Ul=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,c,v,m,_,C,k,B,W,K,oe,ce,Ve,We,st,et,Tt,Ut,nr,hr,Mr,Yr,hn,Hn,wn,Jn,yn,Ui){var hi=this.length;return this.resize(hi+1),this.emplace(hi,r,c,v,m,_,C,k,B,W,K,oe,ce,Ve,We,st,et,Tt,Ut,nr,hr,Mr,Yr,hn,Hn,wn,Jn,yn,Ui)},t.prototype.emplace=function(r,c,v,m,_,C,k,B,W,K,oe,ce,Ve,We,st,et,Tt,Ut,nr,hr,Mr,Yr,hn,Hn,wn,Jn,yn,Ui,hi){var Zn=34*r,ea=17*r;return this.int16[Zn+0]=c,this.int16[Zn+1]=v,this.int16[Zn+2]=m,this.int16[Zn+3]=_,this.int16[Zn+4]=C,this.int16[Zn+5]=k,this.int16[Zn+6]=B,this.int16[Zn+7]=W,this.uint16[Zn+8]=K,this.uint16[Zn+9]=oe,this.uint16[Zn+10]=ce,this.uint16[Zn+11]=Ve,this.uint16[Zn+12]=We,this.uint16[Zn+13]=st,this.uint16[Zn+14]=et,this.uint16[Zn+15]=Tt,this.uint16[Zn+16]=Ut,this.uint16[Zn+17]=nr,this.uint16[Zn+18]=hr,this.uint16[Zn+19]=Mr,this.uint16[Zn+20]=Yr,this.uint16[Zn+21]=hn,this.uint16[Zn+22]=Hn,this.uint32[ea+12]=wn,this.float32[ea+13]=Jn,this.float32[ea+14]=yn,this.float32[ea+15]=Ui,this.float32[ea+16]=hi,r},t}(Ki);Ul.prototype.bytesPerElement=68,Tn("StructArrayLayout8i15ui1ul4f68",Ul);var pu=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r){var c=this.length;return this.resize(c+1),this.emplace(c,r)},t.prototype.emplace=function(r,c){return this.float32[1*r+0]=c,r},t}(Ki);pu.prototype.bytesPerElement=4,Tn("StructArrayLayout1f4",pu);var eu=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,c,v){var m=this.length;return this.resize(m+1),this.emplace(m,r,c,v)},t.prototype.emplace=function(r,c,v,m){var _=3*r;return this.int16[_+0]=c,this.int16[_+1]=v,this.int16[_+2]=m,r},t}(Ki);eu.prototype.bytesPerElement=6,Tn("StructArrayLayout3i6",eu);var xc=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,c,v){var m=this.length;return this.resize(m+1),this.emplace(m,r,c,v)},t.prototype.emplace=function(r,c,v,m){var _=4*r;return this.uint32[2*r+0]=c,this.uint16[_+2]=v,this.uint16[_+3]=m,r},t}(Ki);xc.prototype.bytesPerElement=8,Tn("StructArrayLayout1ul2ui8",xc);var bc=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,c){var v=this.length;return this.resize(v+1),this.emplace(v,r,c)},t.prototype.emplace=function(r,c,v){var m=2*r;return this.uint16[m+0]=c,this.uint16[m+1]=v,r},t}(Ki);bc.prototype.bytesPerElement=4,Tn("StructArrayLayout2ui4",bc);var Zc=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r){var c=this.length;return this.resize(c+1),this.emplace(c,r)},t.prototype.emplace=function(r,c){return this.uint16[1*r+0]=c,r},t}(Ki);Zc.prototype.bytesPerElement=2,Tn("StructArrayLayout1ui2",Zc);var Sc=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,c,v,m){var _=this.length;return this.resize(_+1),this.emplace(_,r,c,v,m)},t.prototype.emplace=function(r,c,v,m,_){var C=4*r;return this.float32[C+0]=c,this.float32[C+1]=v,this.float32[C+2]=m,this.float32[C+3]=_,r},t}(Ki);Sc.prototype.bytesPerElement=16,Tn("StructArrayLayout4f16",Sc);var n=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t;var r={anchorPointX:{configurable:!0},anchorPointY:{configurable:!0},x1:{configurable:!0},y1:{configurable:!0},x2:{configurable:!0},y2:{configurable:!0},featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0},anchorPoint:{configurable:!0}};return r.anchorPointX.get=function(){return this._structArray.int16[this._pos2+0]},r.anchorPointY.get=function(){return this._structArray.int16[this._pos2+1]},r.x1.get=function(){return this._structArray.int16[this._pos2+2]},r.y1.get=function(){return this._structArray.int16[this._pos2+3]},r.x2.get=function(){return this._structArray.int16[this._pos2+4]},r.y2.get=function(){return this._structArray.int16[this._pos2+5]},r.featureIndex.get=function(){return this._structArray.uint32[this._pos4+3]},r.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+8]},r.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+9]},r.anchorPoint.get=function(){return new Y(this.anchorPointX,this.anchorPointY)},Object.defineProperties(t.prototype,r),t}(Nl);n.prototype.size=20;var s=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.get=function(r){return new n(this,r)},t}(jc);Tn("CollisionBoxArray",s);var a=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t;var r={anchorX:{configurable:!0},anchorY:{configurable:!0},glyphStartIndex:{configurable:!0},numGlyphs:{configurable:!0},vertexStartIndex:{configurable:!0},lineStartIndex:{configurable:!0},lineLength:{configurable:!0},segment:{configurable:!0},lowerSize:{configurable:!0},upperSize:{configurable:!0},lineOffsetX:{configurable:!0},lineOffsetY:{configurable:!0},writingMode:{configurable:!0},placedOrientation:{configurable:!0},hidden:{configurable:!0},crossTileID:{configurable:!0},associatedIconIndex:{configurable:!0}};return r.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},r.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},r.glyphStartIndex.get=function(){return this._structArray.uint16[this._pos2+2]},r.numGlyphs.get=function(){return this._structArray.uint16[this._pos2+3]},r.vertexStartIndex.get=function(){return this._structArray.uint32[this._pos4+2]},r.lineStartIndex.get=function(){return this._structArray.uint32[this._pos4+3]},r.lineLength.get=function(){return this._structArray.uint32[this._pos4+4]},r.segment.get=function(){return this._structArray.uint16[this._pos2+10]},r.lowerSize.get=function(){return this._structArray.uint16[this._pos2+11]},r.upperSize.get=function(){return this._structArray.uint16[this._pos2+12]},r.lineOffsetX.get=function(){return this._structArray.float32[this._pos4+7]},r.lineOffsetY.get=function(){return this._structArray.float32[this._pos4+8]},r.writingMode.get=function(){return this._structArray.uint8[this._pos1+36]},r.placedOrientation.get=function(){return this._structArray.uint8[this._pos1+37]},r.placedOrientation.set=function(c){this._structArray.uint8[this._pos1+37]=c},r.hidden.get=function(){return this._structArray.uint8[this._pos1+38]},r.hidden.set=function(c){this._structArray.uint8[this._pos1+38]=c},r.crossTileID.get=function(){return this._structArray.uint32[this._pos4+10]},r.crossTileID.set=function(c){this._structArray.uint32[this._pos4+10]=c},r.associatedIconIndex.get=function(){return this._structArray.int16[this._pos2+22]},Object.defineProperties(t.prototype,r),t}(Nl);a.prototype.size=48;var h=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.get=function(r){return new a(this,r)},t}(Au);Tn("PlacedSymbolArray",h);var g=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t;var r={anchorX:{configurable:!0},anchorY:{configurable:!0},rightJustifiedTextSymbolIndex:{configurable:!0},centerJustifiedTextSymbolIndex:{configurable:!0},leftJustifiedTextSymbolIndex:{configurable:!0},verticalPlacedTextSymbolIndex:{configurable:!0},placedIconSymbolIndex:{configurable:!0},verticalPlacedIconSymbolIndex:{configurable:!0},key:{configurable:!0},textBoxStartIndex:{configurable:!0},textBoxEndIndex:{configurable:!0},verticalTextBoxStartIndex:{configurable:!0},verticalTextBoxEndIndex:{configurable:!0},iconBoxStartIndex:{configurable:!0},iconBoxEndIndex:{configurable:!0},verticalIconBoxStartIndex:{configurable:!0},verticalIconBoxEndIndex:{configurable:!0},featureIndex:{configurable:!0},numHorizontalGlyphVertices:{configurable:!0},numVerticalGlyphVertices:{configurable:!0},numIconVertices:{configurable:!0},numVerticalIconVertices:{configurable:!0},useRuntimeCollisionCircles:{configurable:!0},crossTileID:{configurable:!0},textBoxScale:{configurable:!0},textOffset0:{configurable:!0},textOffset1:{configurable:!0},collisionCircleDiameter:{configurable:!0}};return r.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},r.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},r.rightJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+2]},r.centerJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+3]},r.leftJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+4]},r.verticalPlacedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+5]},r.placedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+6]},r.verticalPlacedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+7]},r.key.get=function(){return this._structArray.uint16[this._pos2+8]},r.textBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+9]},r.textBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+10]},r.verticalTextBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+11]},r.verticalTextBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+12]},r.iconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+13]},r.iconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+14]},r.verticalIconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+15]},r.verticalIconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+16]},r.featureIndex.get=function(){return this._structArray.uint16[this._pos2+17]},r.numHorizontalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+18]},r.numVerticalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+19]},r.numIconVertices.get=function(){return this._structArray.uint16[this._pos2+20]},r.numVerticalIconVertices.get=function(){return this._structArray.uint16[this._pos2+21]},r.useRuntimeCollisionCircles.get=function(){return this._structArray.uint16[this._pos2+22]},r.crossTileID.get=function(){return this._structArray.uint32[this._pos4+12]},r.crossTileID.set=function(c){this._structArray.uint32[this._pos4+12]=c},r.textBoxScale.get=function(){return this._structArray.float32[this._pos4+13]},r.textOffset0.get=function(){return this._structArray.float32[this._pos4+14]},r.textOffset1.get=function(){return this._structArray.float32[this._pos4+15]},r.collisionCircleDiameter.get=function(){return this._structArray.float32[this._pos4+16]},Object.defineProperties(t.prototype,r),t}(Nl);g.prototype.size=68;var b=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.get=function(r){return new g(this,r)},t}(Ul);Tn("SymbolInstanceArray",b);var T=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getoffsetX=function(r){return this.float32[1*r+0]},t}(pu);Tn("GlyphOffsetArray",T);var R=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getx=function(r){return this.int16[3*r+0]},t.prototype.gety=function(r){return this.int16[3*r+1]},t.prototype.gettileUnitDistanceFromAnchor=function(r){return this.int16[3*r+2]},t}(eu);Tn("SymbolLineVertexArray",R);var V=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t;var r={featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0}};return r.featureIndex.get=function(){return this._structArray.uint32[this._pos4+0]},r.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+2]},r.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+3]},Object.defineProperties(t.prototype,r),t}(Nl);V.prototype.size=8;var te=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.get=function(r){return new V(this,r)},t}(xc);Tn("FeatureIndexArray",te);var de=So([{name:"a_pos",components:2,type:"Int16"}],4).members,ye=function(e){e===void 0&&(e=[]),this.segments=e};function xe(e,t){return 256*(e=$t(Math.floor(e),0,255))+$t(Math.floor(t),0,255)}ye.prototype.prepareSegment=function(e,t,r,c){var v=this.segments[this.segments.length-1];return e>ye.MAX_VERTEX_ARRAY_LENGTH&&Ne("Max vertices per segment is "+ye.MAX_VERTEX_ARRAY_LENGTH+": bucket requested "+e),(!v||v.vertexLength+e>ye.MAX_VERTEX_ARRAY_LENGTH||v.sortKey!==c)&&(v={vertexOffset:t.length,primitiveOffset:r.length,vertexLength:0,primitiveLength:0},c!==void 0&&(v.sortKey=c),this.segments.push(v)),v},ye.prototype.get=function(){return this.segments},ye.prototype.destroy=function(){for(var e=0,t=this.segments;e<t.length;e+=1){var r=t[e];for(var c in r.vaos)r.vaos[c].destroy()}},ye.simpleSegment=function(e,t,r,c){return new ye([{vertexOffset:e,primitiveOffset:t,vertexLength:r,primitiveLength:c,vaos:{},sortKey:0}])},ye.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Tn("SegmentVector",ye);var He=So([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),Ze=w(function(e){e.exports=function(t,r){var c,v,m,_,C,k,B,W;for(v=t.length-(c=3&t.length),m=r,C=3432918353,k=461845907,W=0;W<v;)B=255&t.charCodeAt(W)|(255&t.charCodeAt(++W))<<8|(255&t.charCodeAt(++W))<<16|(255&t.charCodeAt(++W))<<24,++W,m=27492+(65535&(_=5*(65535&(m=(m^=B=(65535&(B=(B=(65535&B)*C+(((B>>>16)*C&65535)<<16)&4294967295)<<15|B>>>17))*k+(((B>>>16)*k&65535)<<16)&4294967295)<<13|m>>>19))+((5*(m>>>16)&65535)<<16)&4294967295))+((58964+(_>>>16)&65535)<<16);switch(B=0,c){case 3:B^=(255&t.charCodeAt(W+2))<<16;case 2:B^=(255&t.charCodeAt(W+1))<<8;case 1:m^=B=(65535&(B=(B=(65535&(B^=255&t.charCodeAt(W)))*C+(((B>>>16)*C&65535)<<16)&4294967295)<<15|B>>>17))*k+(((B>>>16)*k&65535)<<16)&4294967295}return m^=t.length,m=2246822507*(65535&(m^=m>>>16))+((2246822507*(m>>>16)&65535)<<16)&4294967295,m=3266489909*(65535&(m^=m>>>13))+((3266489909*(m>>>16)&65535)<<16)&4294967295,(m^=m>>>16)>>>0}}),nt=w(function(e){e.exports=function(t,r){for(var c,v=t.length,m=r^v,_=0;v>=4;)c=1540483477*(65535&(c=255&t.charCodeAt(_)|(255&t.charCodeAt(++_))<<8|(255&t.charCodeAt(++_))<<16|(255&t.charCodeAt(++_))<<24))+((1540483477*(c>>>16)&65535)<<16),m=1540483477*(65535&m)+((1540483477*(m>>>16)&65535)<<16)^(c=1540483477*(65535&(c^=c>>>24))+((1540483477*(c>>>16)&65535)<<16)),v-=4,++_;switch(v){case 3:m^=(255&t.charCodeAt(_+2))<<16;case 2:m^=(255&t.charCodeAt(_+1))<<8;case 1:m=1540483477*(65535&(m^=255&t.charCodeAt(_)))+((1540483477*(m>>>16)&65535)<<16)}return m=1540483477*(65535&(m^=m>>>13))+((1540483477*(m>>>16)&65535)<<16),(m^=m>>>15)>>>0}}),ze=Ze,rt=nt;ze.murmur3=Ze,ze.murmur2=rt;var ht=function(){this.ids=[],this.positions=[],this.indexed=!1};ht.prototype.add=function(e,t,r,c){this.ids.push(or(e)),this.positions.push(t,r,c)},ht.prototype.getPositions=function(e){for(var t=or(e),r=0,c=this.ids.length-1;r<c;){var v=r+c>>1;this.ids[v]>=t?c=v:r=v+1}for(var m=[];this.ids[r]===t;)m.push({index:this.positions[3*r],start:this.positions[3*r+1],end:this.positions[3*r+2]}),r++;return m},ht.serialize=function(e,t){var r=new Float64Array(e.ids),c=new Uint32Array(e.positions);return function v(m,_,C,k){for(;C<k;){for(var B=m[C+k>>1],W=C-1,K=k+1;;){do W++;while(m[W]<B);do K--;while(m[K]>B);if(W>=K)break;rr(m,W,K),rr(_,3*W,3*K),rr(_,3*W+1,3*K+1),rr(_,3*W+2,3*K+2)}K-C<k-K?(v(m,_,C,K),C=K+1):(v(m,_,K+1,k),k=K)}}(r,c,0,r.length-1),t&&t.push(r.buffer,c.buffer),{ids:r,positions:c}},ht.deserialize=function(e){var t=new ht;return t.ids=e.ids,t.positions=e.positions,t.indexed=!0,t};var Nt=Math.pow(2,53)-1;function or(e){var t=+e;return!isNaN(t)&&t<=Nt?t:ze(String(e))}function rr(e,t,r){var c=e[t];e[t]=e[r],e[r]=c}Tn("FeaturePositionMap",ht);var sr=function(e,t){this.gl=e.gl,this.location=t},Lr=function(e){function t(r,c){e.call(this,r,c),this.current=0}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(r){this.current!==r&&(this.current=r,this.gl.uniform1i(this.location,r))},t}(sr),rn=function(e){function t(r,c){e.call(this,r,c),this.current=0}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(r){this.current!==r&&(this.current=r,this.gl.uniform1f(this.location,r))},t}(sr),Qr=function(e){function t(r,c){e.call(this,r,c),this.current=[0,0]}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(r){r[0]===this.current[0]&&r[1]===this.current[1]||(this.current=r,this.gl.uniform2f(this.location,r[0],r[1]))},t}(sr),xn=function(e){function t(r,c){e.call(this,r,c),this.current=[0,0,0]}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(r){r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]||(this.current=r,this.gl.uniform3f(this.location,r[0],r[1],r[2]))},t}(sr),jn=function(e){function t(r,c){e.call(this,r,c),this.current=[0,0,0,0]}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(r){r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]&&r[3]===this.current[3]||(this.current=r,this.gl.uniform4f(this.location,r[0],r[1],r[2],r[3]))},t}(sr),Xn=function(e){function t(r,c){e.call(this,r,c),this.current=Vn.transparent}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(r){r.r===this.current.r&&r.g===this.current.g&&r.b===this.current.b&&r.a===this.current.a||(this.current=r,this.gl.uniform4f(this.location,r.r,r.g,r.b,r.a))},t}(sr),Wn=new Float32Array(16),$i=function(e){function t(r,c){e.call(this,r,c),this.current=Wn}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(r){if(r[12]!==this.current[12]||r[0]!==this.current[0])return this.current=r,void this.gl.uniformMatrix4fv(this.location,!1,r);for(var c=1;c<16;c++)if(r[c]!==this.current[c]){this.current=r,this.gl.uniformMatrix4fv(this.location,!1,r);break}},t}(sr);function Sn(e){return[xe(255*e.r,255*e.g),xe(255*e.b,255*e.a)]}var oi=function(e,t,r){this.value=e,this.uniformNames=t.map(function(c){return"u_"+c}),this.type=r};oi.prototype.setUniform=function(e,t,r){e.set(r.constantOr(this.value))},oi.prototype.getBinding=function(e,t,r){return this.type==="color"?new Xn(e,t):new rn(e,t)};var Si=function(e,t){this.uniformNames=t.map(function(r){return"u_"+r}),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1};Si.prototype.setConstantPatternPositions=function(e,t){this.pixelRatioFrom=t.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=t.tlbr,this.patternTo=e.tlbr},Si.prototype.setUniform=function(e,t,r,c){var v=c==="u_pattern_to"?this.patternTo:c==="u_pattern_from"?this.patternFrom:c==="u_pixel_ratio_to"?this.pixelRatioTo:c==="u_pixel_ratio_from"?this.pixelRatioFrom:null;v&&e.set(v)},Si.prototype.getBinding=function(e,t,r){return r.substr(0,9)==="u_pattern"?new jn(e,t):new rn(e,t)};var ai=function(e,t,r,c){this.expression=e,this.type=r,this.maxValue=0,this.paintVertexAttributes=t.map(function(v){return{name:"a_"+v,type:"Float32",components:r==="color"?2:1,offset:0}}),this.paintVertexArray=new c};ai.prototype.populatePaintArray=function(e,t,r,c,v){var m=this.paintVertexArray.length,_=this.expression.evaluate(new Fi(0),t,{},c,[],v);this.paintVertexArray.resize(e),this._setPaintValue(m,e,_)},ai.prototype.updatePaintArray=function(e,t,r,c){var v=this.expression.evaluate({zoom:0},r,c);this._setPaintValue(e,t,v)},ai.prototype._setPaintValue=function(e,t,r){if(this.type==="color")for(var c=Sn(r),v=e;v<t;v++)this.paintVertexArray.emplace(v,c[0],c[1]);else{for(var m=e;m<t;m++)this.paintVertexArray.emplace(m,r);this.maxValue=Math.max(this.maxValue,Math.abs(r))}},ai.prototype.upload=function(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},ai.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()};var ii=function(e,t,r,c,v,m){this.expression=e,this.uniformNames=t.map(function(_){return"u_"+_+"_t"}),this.type=r,this.useIntegerZoom=c,this.zoom=v,this.maxValue=0,this.paintVertexAttributes=t.map(function(_){return{name:"a_"+_,type:"Float32",components:r==="color"?4:2,offset:0}}),this.paintVertexArray=new m};ii.prototype.populatePaintArray=function(e,t,r,c,v){var m=this.expression.evaluate(new Fi(this.zoom),t,{},c,[],v),_=this.expression.evaluate(new Fi(this.zoom+1),t,{},c,[],v),C=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(C,e,m,_)},ii.prototype.updatePaintArray=function(e,t,r,c){var v=this.expression.evaluate({zoom:this.zoom},r,c),m=this.expression.evaluate({zoom:this.zoom+1},r,c);this._setPaintValue(e,t,v,m)},ii.prototype._setPaintValue=function(e,t,r,c){if(this.type==="color")for(var v=Sn(r),m=Sn(c),_=e;_<t;_++)this.paintVertexArray.emplace(_,v[0],v[1],m[0],m[1]);else{for(var C=e;C<t;C++)this.paintVertexArray.emplace(C,r,c);this.maxValue=Math.max(this.maxValue,Math.abs(r),Math.abs(c))}},ii.prototype.upload=function(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},ii.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()},ii.prototype.setUniform=function(e,t){var r=this.useIntegerZoom?Math.floor(t.zoom):t.zoom,c=$t(this.expression.interpolationFactor(r,this.zoom,this.zoom+1),0,1);e.set(c)},ii.prototype.getBinding=function(e,t,r){return new rn(e,t)};var Ei=function(e,t,r,c,v,m){this.expression=e,this.type=t,this.useIntegerZoom=r,this.zoom=c,this.layerId=m,this.zoomInPaintVertexArray=new v,this.zoomOutPaintVertexArray=new v};Ei.prototype.populatePaintArray=function(e,t,r){var c=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(c,e,t.patterns&&t.patterns[this.layerId],r)},Ei.prototype.updatePaintArray=function(e,t,r,c,v){this._setPaintValues(e,t,r.patterns&&r.patterns[this.layerId],v)},Ei.prototype._setPaintValues=function(e,t,r,c){if(c&&r){var v=c[r.min],m=c[r.mid],_=c[r.max];if(v&&m&&_)for(var C=e;C<t;C++)this.zoomInPaintVertexArray.emplace(C,m.tl[0],m.tl[1],m.br[0],m.br[1],v.tl[0],v.tl[1],v.br[0],v.br[1],m.pixelRatio,v.pixelRatio),this.zoomOutPaintVertexArray.emplace(C,m.tl[0],m.tl[1],m.br[0],m.br[1],_.tl[0],_.tl[1],_.br[0],_.br[1],m.pixelRatio,_.pixelRatio)}},Ei.prototype.upload=function(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,He.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,He.members,this.expression.isStateDependent))},Ei.prototype.destroy=function(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()};var ri=function(e,t,r){this.binders={},this._buffers=[];var c=[];for(var v in e.paint._values)if(r(v)){var m=e.paint.get(v);if(m instanceof vs&&$u(m.property.specification)){var _=mo(v,e.type),C=m.value,k=m.property.specification.type,B=m.property.useIntegerZoom,W=m.property.specification["property-type"],K=W==="cross-faded"||W==="cross-faded-data-driven";if(C.kind==="constant")this.binders[v]=K?new Si(C.value,_):new oi(C.value,_,k),c.push("/u_"+v);else if(C.kind==="source"||K){var oe=Ja(v,k,"source");this.binders[v]=K?new Ei(C,k,B,t,oe,e.id):new ai(C,_,k,oe),c.push("/a_"+v)}else{var ce=Ja(v,k,"composite");this.binders[v]=new ii(C,_,k,B,t,ce),c.push("/z_"+v)}}}this.cacheKey=c.sort().join("")};ri.prototype.getMaxValue=function(e){var t=this.binders[e];return t instanceof ai||t instanceof ii?t.maxValue:0},ri.prototype.populatePaintArrays=function(e,t,r,c,v){for(var m in this.binders){var _=this.binders[m];(_ instanceof ai||_ instanceof ii||_ instanceof Ei)&&_.populatePaintArray(e,t,r,c,v)}},ri.prototype.setConstantPatternPositions=function(e,t){for(var r in this.binders){var c=this.binders[r];c instanceof Si&&c.setConstantPatternPositions(e,t)}},ri.prototype.updatePaintArrays=function(e,t,r,c,v){var m=!1;for(var _ in e)for(var C=0,k=t.getPositions(_);C<k.length;C+=1){var B=k[C],W=r.feature(B.index);for(var K in this.binders){var oe=this.binders[K];if((oe instanceof ai||oe instanceof ii||oe instanceof Ei)&&oe.expression.isStateDependent===!0){var ce=c.paint.get(K);oe.expression=ce.value,oe.updatePaintArray(B.start,B.end,W,e[_],v),m=!0}}}return m},ri.prototype.defines=function(){var e=[];for(var t in this.binders){var r=this.binders[t];(r instanceof oi||r instanceof Si)&&e.push.apply(e,r.uniformNames.map(function(c){return"#define HAS_UNIFORM_"+c}))}return e},ri.prototype.getBinderAttributes=function(){var e=[];for(var t in this.binders){var r=this.binders[t];if(r instanceof ai||r instanceof ii)for(var c=0;c<r.paintVertexAttributes.length;c++)e.push(r.paintVertexAttributes[c].name);else if(r instanceof Ei)for(var v=0;v<He.members.length;v++)e.push(He.members[v].name)}return e},ri.prototype.getBinderUniforms=function(){var e=[];for(var t in this.binders){var r=this.binders[t];if(r instanceof oi||r instanceof Si||r instanceof ii)for(var c=0,v=r.uniformNames;c<v.length;c+=1)e.push(v[c])}return e},ri.prototype.getPaintVertexBuffers=function(){return this._buffers},ri.prototype.getUniforms=function(e,t){var r=[];for(var c in this.binders){var v=this.binders[c];if(v instanceof oi||v instanceof Si||v instanceof ii)for(var m=0,_=v.uniformNames;m<_.length;m+=1){var C=_[m];if(t[C]){var k=v.getBinding(e,t[C],C);r.push({name:C,property:c,binding:k})}}}return r},ri.prototype.setUniforms=function(e,t,r,c){for(var v=0,m=t;v<m.length;v+=1){var _=m[v],C=_.name,k=_.property;this.binders[k].setUniform(_.binding,c,r.get(k),C)}},ri.prototype.updatePaintBuffers=function(e){for(var t in this._buffers=[],this.binders){var r=this.binders[t];if(e&&r instanceof Ei){var c=e.fromScale===2?r.zoomInPaintVertexBuffer:r.zoomOutPaintVertexBuffer;c&&this._buffers.push(c)}else(r instanceof ai||r instanceof ii)&&r.paintVertexBuffer&&this._buffers.push(r.paintVertexBuffer)}},ri.prototype.upload=function(e){for(var t in this.binders){var r=this.binders[t];(r instanceof ai||r instanceof ii||r instanceof Ei)&&r.upload(e)}this.updatePaintBuffers()},ri.prototype.destroy=function(){for(var e in this.binders){var t=this.binders[e];(t instanceof ai||t instanceof ii||t instanceof Ei)&&t.destroy()}};var Qn=function(e,t,r){r===void 0&&(r=function(){return!0}),this.programConfigurations={};for(var c=0,v=e;c<v.length;c+=1){var m=v[c];this.programConfigurations[m.id]=new ri(m,t,r)}this.needsUpload=!1,this._featureMap=new ht,this._bufferOffset=0};function mo(e,t){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[e]||[e.replace(t+"-","").replace(/-/g,"_")]}function Ja(e,t,r){var c={color:{source:il,composite:Sc},number:{source:pu,composite:il}},v=function(m){return{"line-pattern":{source:Tu,composite:Tu},"fill-pattern":{source:Tu,composite:Tu},"fill-extrusion-pattern":{source:Tu,composite:Tu}}[m]}(e);return v&&v[r]||c[t][r]}Qn.prototype.populatePaintArrays=function(e,t,r,c,v,m){for(var _ in this.programConfigurations)this.programConfigurations[_].populatePaintArrays(e,t,c,v,m);t.id!==void 0&&this._featureMap.add(t.id,r,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0},Qn.prototype.updatePaintArrays=function(e,t,r,c){for(var v=0,m=r;v<m.length;v+=1){var _=m[v];this.needsUpload=this.programConfigurations[_.id].updatePaintArrays(e,this._featureMap,t,_,c)||this.needsUpload}},Qn.prototype.get=function(e){return this.programConfigurations[e]},Qn.prototype.upload=function(e){if(this.needsUpload){for(var t in this.programConfigurations)this.programConfigurations[t].upload(e);this.needsUpload=!1}},Qn.prototype.destroy=function(){for(var e in this.programConfigurations)this.programConfigurations[e].destroy()},Tn("ConstantBinder",oi),Tn("CrossFadedConstantBinder",Si),Tn("SourceExpressionBinder",ai),Tn("CrossFadedCompositeBinder",Ei),Tn("CompositeExpressionBinder",ii),Tn("ProgramConfiguration",ri,{omit:["_buffers"]}),Tn("ProgramConfigurationSet",Qn);var os=Math.pow(2,14)-1,Fo=-os-1;function Qa(e){for(var t=8192/e.extent,r=e.loadGeometry(),c=0;c<r.length;c++)for(var v=r[c],m=0;m<v.length;m++){var _=v[m],C=Math.round(_.x*t),k=Math.round(_.y*t);_.x=$t(C,Fo,os),_.y=$t(k,Fo,os),(C<_.x||C>_.x+1||k<_.y||k>_.y+1)&&Ne("Geometry exceeds allowed extent, reduce your vector tile buffer size")}return r}function ro(e,t){return{type:e.type,id:e.id,properties:e.properties,geometry:t?Qa(e):[]}}function ms(e,t,r,c,v){e.emplaceBack(2*t+(c+1)/2,2*r+(v+1)/2)}var zo=function(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(function(t){return t.id}),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new bl,this.indexArray=new al,this.segments=new ye,this.programConfigurations=new Qn(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(function(t){return t.isStateDependent()}).map(function(t){return t.id})};function Cu(e,t){for(var r=0;r<e.length;r++)if(du(t,e[r]))return!0;for(var c=0;c<t.length;c++)if(du(e,t[c]))return!0;return!!Sl(e,t)}function ss(e,t,r){return!!du(e,t)||!!Ls(t,e,r)}function Zs(e,t){if(e.length===1)return jl(t,e[0]);for(var r=0;r<t.length;r++)for(var c=t[r],v=0;v<c.length;v++)if(du(e,c[v]))return!0;for(var m=0;m<e.length;m++)if(jl(t,e[m]))return!0;for(var _=0;_<t.length;_++)if(Sl(e,t[_]))return!0;return!1}function Vs(e,t,r){if(e.length>1){if(Sl(e,t))return!0;for(var c=0;c<t.length;c++)if(Ls(t[c],e,r))return!0}for(var v=0;v<e.length;v++)if(Ls(e[v],t,r))return!0;return!1}function Sl(e,t){if(e.length===0||t.length===0)return!1;for(var r=0;r<e.length-1;r++)for(var c=e[r],v=e[r+1],m=0;m<t.length-1;m++)if(El(c,v,t[m],t[m+1]))return!0;return!1}function El(e,t,r,c){return Ae(e,r,c)!==Ae(t,r,c)&&Ae(e,t,r)!==Ae(e,t,c)}function Ls(e,t,r){var c=r*r;if(t.length===1)return e.distSqr(t[0])<c;for(var v=1;v<t.length;v++)if(Vu(e,t[v-1],t[v])<c)return!0;return!1}function Vu(e,t,r){var c=t.distSqr(r);if(c===0)return e.distSqr(t);var v=((e.x-t.x)*(r.x-t.x)+(e.y-t.y)*(r.y-t.y))/c;return e.distSqr(v<0?t:v>1?r:r.sub(t)._mult(v)._add(t))}function jl(e,t){for(var r,c,v,m=!1,_=0;_<e.length;_++)for(var C=0,k=(r=e[_]).length-1;C<r.length;k=C++)(c=r[C]).y>t.y!=(v=r[k]).y>t.y&&t.x<(v.x-c.x)*(t.y-c.y)/(v.y-c.y)+c.x&&(m=!m);return m}function du(e,t){for(var r=!1,c=0,v=e.length-1;c<e.length;v=c++){var m=e[c],_=e[v];m.y>t.y!=_.y>t.y&&t.x<(_.x-m.x)*(t.y-m.y)/(_.y-m.y)+m.x&&(r=!r)}return r}function wl(e,t,r){var c=r[0],v=r[2];if(e.x<c.x&&t.x<c.x||e.x>v.x&&t.x>v.x||e.y<c.y&&t.y<c.y||e.y>v.y&&t.y>v.y)return!1;var m=Ae(e,t,r[0]);return m!==Ae(e,t,r[1])||m!==Ae(e,t,r[2])||m!==Ae(e,t,r[3])}function tu(e,t,r){var c=t.paint.get(e).value;return c.kind==="constant"?c.value:r.programConfigurations.get(t.id).getMaxValue(e)}function no(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function Pu(e,t,r,c,v){if(!t[0]&&!t[1])return e;var m=Y.convert(t)._mult(v);r==="viewport"&&m._rotate(-c);for(var _=[],C=0;C<e.length;C++)_.push(e[C].sub(m));return _}zo.prototype.populate=function(e,t,r){var c=this.layers[0],v=[],m=null;c.type==="circle"&&(m=c.layout.get("circle-sort-key"));for(var _=0,C=e;_<C.length;_+=1){var k=C[_],B=k.feature,W=k.id,K=k.index,oe=k.sourceLayerIndex,ce=this.layers[0]._featureFilter.needGeometry,Ve=ro(B,ce);if(this.layers[0]._featureFilter.filter(new Fi(this.zoom),Ve,r)){var We=m?m.evaluate(Ve,{},r):void 0,st={id:W,properties:B.properties,type:B.type,sourceLayerIndex:oe,index:K,geometry:ce?Ve.geometry:Qa(B),patterns:{},sortKey:We};v.push(st)}}m&&v.sort(function(hn,Hn){return hn.sortKey-Hn.sortKey});for(var et=0,Tt=v;et<Tt.length;et+=1){var Ut=Tt[et],nr=Ut.geometry,hr=Ut.index,Mr=Ut.sourceLayerIndex,Yr=e[hr].feature;this.addFeature(Ut,nr,hr,r),t.featureIndex.insert(Yr,nr,hr,Mr,this.index)}},zo.prototype.update=function(e,t,r){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,r)},zo.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},zo.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},zo.prototype.upload=function(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,de),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0},zo.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},zo.prototype.addFeature=function(e,t,r,c){for(var v=0,m=t;v<m.length;v+=1)for(var _=0,C=m[v];_<C.length;_+=1){var k=C[_],B=k.x,W=k.y;if(!(B<0||B>=8192||W<0||W>=8192)){var K=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),oe=K.vertexLength;ms(this.layoutVertexArray,B,W,-1,-1),ms(this.layoutVertexArray,B,W,1,-1),ms(this.layoutVertexArray,B,W,1,1),ms(this.layoutVertexArray,B,W,-1,1),this.indexArray.emplaceBack(oe,oe+1,oe+2),this.indexArray.emplaceBack(oe,oe+3,oe+2),K.vertexLength+=4,K.primitiveLength+=2}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,{},c)},Tn("CircleBucket",zo,{omit:["layers"]});var vu=new ko({"circle-sort-key":new Mn(ue.layout_circle["circle-sort-key"])}),ws={paint:new ko({"circle-radius":new Mn(ue.paint_circle["circle-radius"]),"circle-color":new Mn(ue.paint_circle["circle-color"]),"circle-blur":new Mn(ue.paint_circle["circle-blur"]),"circle-opacity":new Mn(ue.paint_circle["circle-opacity"]),"circle-translate":new Un(ue.paint_circle["circle-translate"]),"circle-translate-anchor":new Un(ue.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Un(ue.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Un(ue.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Mn(ue.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Mn(ue.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Mn(ue.paint_circle["circle-stroke-opacity"])}),layout:vu},Ji=typeof Float32Array!="undefined"?Float32Array:Array;function No(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function go(e,t,r){var c=t[0],v=t[1],m=t[2],_=t[3],C=t[4],k=t[5],B=t[6],W=t[7],K=t[8],oe=t[9],ce=t[10],Ve=t[11],We=t[12],st=t[13],et=t[14],Tt=t[15],Ut=r[0],nr=r[1],hr=r[2],Mr=r[3];return e[0]=Ut*c+nr*C+hr*K+Mr*We,e[1]=Ut*v+nr*k+hr*oe+Mr*st,e[2]=Ut*m+nr*B+hr*ce+Mr*et,e[3]=Ut*_+nr*W+hr*Ve+Mr*Tt,e[4]=(Ut=r[4])*c+(nr=r[5])*C+(hr=r[6])*K+(Mr=r[7])*We,e[5]=Ut*v+nr*k+hr*oe+Mr*st,e[6]=Ut*m+nr*B+hr*ce+Mr*et,e[7]=Ut*_+nr*W+hr*Ve+Mr*Tt,e[8]=(Ut=r[8])*c+(nr=r[9])*C+(hr=r[10])*K+(Mr=r[11])*We,e[9]=Ut*v+nr*k+hr*oe+Mr*st,e[10]=Ut*m+nr*B+hr*ce+Mr*et,e[11]=Ut*_+nr*W+hr*Ve+Mr*Tt,e[12]=(Ut=r[12])*c+(nr=r[13])*C+(hr=r[14])*K+(Mr=r[15])*We,e[13]=Ut*v+nr*k+hr*oe+Mr*st,e[14]=Ut*m+nr*B+hr*ce+Mr*et,e[15]=Ut*_+nr*W+hr*Ve+Mr*Tt,e}Math.hypot||(Math.hypot=function(){for(var e=arguments,t=0,r=arguments.length;r--;)t+=e[r]*e[r];return Math.sqrt(t)});var Mu,ru=go;function mu(e,t,r){var c=t[0],v=t[1],m=t[2],_=t[3];return e[0]=r[0]*c+r[4]*v+r[8]*m+r[12]*_,e[1]=r[1]*c+r[5]*v+r[9]*m+r[13]*_,e[2]=r[2]*c+r[6]*v+r[10]*m+r[14]*_,e[3]=r[3]*c+r[7]*v+r[11]*m+r[15]*_,e}Mu=new Ji(3),Ji!=Float32Array&&(Mu[0]=0,Mu[1]=0,Mu[2]=0),function(){var e=new Ji(4);Ji!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0)}();var Gu=(function(){var e=new Ji(2);Ji!=Float32Array&&(e[0]=0,e[1]=0)}(),function(e){function t(r){e.call(this,r,ws)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.createBucket=function(r){return new zo(r)},t.prototype.queryRadius=function(r){var c=r;return tu("circle-radius",this,c)+tu("circle-stroke-width",this,c)+no(this.paint.get("circle-translate"))},t.prototype.queryIntersectsFeature=function(r,c,v,m,_,C,k,B){for(var W=Pu(r,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),C.angle,k),K=this.paint.get("circle-radius").evaluate(c,v)+this.paint.get("circle-stroke-width").evaluate(c,v),oe=this.paint.get("circle-pitch-alignment")==="map",ce=oe?W:function(Yr,hn){return Yr.map(function(Hn){return Iu(Hn,hn)})}(W,B),Ve=oe?K*k:K,We=0,st=m;We<st.length;We+=1)for(var et=0,Tt=st[We];et<Tt.length;et+=1){var Ut=Tt[et],nr=oe?Ut:Iu(Ut,B),hr=Ve,Mr=mu([],[Ut.x,Ut.y,0,1],B);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?hr*=Mr[3]/C.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(hr*=C.cameraToCenterDistance/Mr[3]),ss(ce,nr,hr))return!0}return!1},t}(hu));function Iu(e,t){var r=mu([],[e.x,e.y,0,1],t);return new Y(r[0]/r[3],r[1]/r[3])}var Gs=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t}(zo);function nu(e,t,r,c){var v=t.width,m=t.height;if(c){if(c instanceof Uint8ClampedArray)c=new Uint8Array(c.buffer);else if(c.length!==v*m*r)throw new RangeError("mismatched image size")}else c=new Uint8Array(v*m*r);return e.width=v,e.height=m,e.data=c,e}function Tl(e,t,r){var c=t.width,v=t.height;if(c!==e.width||v!==e.height){var m=nu({},{width:c,height:v},r);rf(e,m,{x:0,y:0},{x:0,y:0},{width:Math.min(e.width,c),height:Math.min(e.height,v)},r),e.width=c,e.height=v,e.data=m.data}}function rf(e,t,r,c,v,m){if(v.width===0||v.height===0)return t;if(v.width>e.width||v.height>e.height||r.x>e.width-v.width||r.y>e.height-v.height)throw new RangeError("out of range source coordinates for image copy");if(v.width>t.width||v.height>t.height||c.x>t.width-v.width||c.y>t.height-v.height)throw new RangeError("out of range destination coordinates for image copy");for(var _=e.data,C=t.data,k=0;k<v.height;k++)for(var B=((r.y+k)*e.width+r.x)*m,W=((c.y+k)*t.width+c.x)*m,K=0;K<v.width*m;K++)C[W+K]=_[B+K];return t}Tn("HeatmapBucket",Gs,{omit:["layers"]});var gu=function(e,t){nu(this,e,1,t)};gu.prototype.resize=function(e){Tl(this,e,1)},gu.prototype.clone=function(){return new gu({width:this.width,height:this.height},new Uint8Array(this.data))},gu.copy=function(e,t,r,c,v){rf(e,t,r,c,v,1)};var ga=function(e,t){nu(this,e,4,t)};ga.prototype.resize=function(e){Tl(this,e,4)},ga.prototype.replace=function(e,t){t?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e},ga.prototype.clone=function(){return new ga({width:this.width,height:this.height},new Uint8Array(this.data))},ga.copy=function(e,t,r,c,v){rf(e,t,r,c,v,4)},Tn("AlphaImage",gu),Tn("RGBAImage",ga);var dh={paint:new ko({"heatmap-radius":new Mn(ue.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Mn(ue.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Un(ue.paint_heatmap["heatmap-intensity"]),"heatmap-color":new vo(ue.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Un(ue.paint_heatmap["heatmap-opacity"])})};function Hf(e){var t={},r=e.resolution||256,c=e.clips?e.clips.length:1,v=e.image||new ga({width:r,height:c}),m=function(Ve,We,st){t[e.evaluationKey]=st;var et=e.expression.evaluate(t);v.data[Ve+We+0]=Math.floor(255*et.r/et.a),v.data[Ve+We+1]=Math.floor(255*et.g/et.a),v.data[Ve+We+2]=Math.floor(255*et.b/et.a),v.data[Ve+We+3]=Math.floor(255*et.a)};if(e.clips)for(var _=0,C=0;_<c;++_,C+=4*r)for(var k=0,B=0;k<r;k++,B+=4){var W=k/(r-1),K=e.clips[_];m(C,B,K.start*(1-W)+K.end*W)}else for(var oe=0,ce=0;oe<r;oe++,ce+=4)m(0,ce,oe/(r-1));return v}var Wf=function(e){function t(r){e.call(this,r,dh),this._updateColorRamp()}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.createBucket=function(r){return new Gs(r)},t.prototype._handleSpecialPaintPropertyUpdate=function(r){r==="heatmap-color"&&this._updateColorRamp()},t.prototype._updateColorRamp=function(){this.colorRamp=Hf({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null},t.prototype.resize=function(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)},t.prototype.queryRadius=function(){return 0},t.prototype.queryIntersectsFeature=function(){return!1},t.prototype.hasOffscreenPass=function(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"},t}(hu),Zl={paint:new ko({"hillshade-illumination-direction":new Un(ue.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Un(ue.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Un(ue.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Un(ue.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Un(ue.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Un(ue.paint_hillshade["hillshade-accent-color"])})},Lf=function(e){function t(r){e.call(this,r,Zl)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.hasOffscreenPass=function(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"},t}(hu),vh=So([{name:"a_pos",components:2,type:"Int16"}],4).members,ic=xf,Rf=xf;function xf(e,t,r){r=r||2;var c,v,m,_,C,k,B,W=t&&t.length,K=W?t[0]*r:e.length,oe=Xf(e,0,K,r,!0),ce=[];if(!oe||oe.next===oe.prev)return ce;if(W&&(oe=function(We,st,et,Tt){var Ut,nr,hr,Mr=[];for(Ut=0,nr=st.length;Ut<nr;Ut++)(hr=Xf(We,st[Ut]*Tt,Ut<nr-1?st[Ut+1]*Tt:We.length,Tt,!1))===hr.next&&(hr.steiner=!0),Mr.push(gh(hr));for(Mr.sort(Jf),Ut=0;Ut<Mr.length;Ut++)Qf(Mr[Ut],et),et=Vl(et,et.next);return et}(e,t,oe,r)),e.length>80*r){c=m=e[0],v=_=e[1];for(var Ve=r;Ve<K;Ve+=r)(C=e[Ve])<c&&(c=C),(k=e[Ve+1])<v&&(v=k),C>m&&(m=C),k>_&&(_=k);B=(B=Math.max(m-c,_-v))!==0?1/B:0}return Vc(oe,ce,r,c,v,B),ce}function Xf(e,t,r,c,v){var m,_;if(v===q(e,t,r,c)>0)for(m=t;m<r;m+=c)_=U(m,e[m],e[m+1],_);else for(m=r-c;m>=t;m-=c)_=U(m,e[m],e[m+1],_);return _&&nf(_,_.next)&&(P(_),_=_.next),_}function Vl(e,t){if(!e)return e;t||(t=e);var r,c=e;do if(r=!1,c.steiner||!nf(c,c.next)&&yo(c.prev,c,c.next)!==0)c=c.next;else{if(P(c),(c=t=c.prev)===c.next)break;r=!0}while(r||c!==t);return t}function Vc(e,t,r,c,v,m,_){if(e){!_&&m&&function(W,K,oe,ce){var Ve=W;do Ve.z===null&&(Ve.z=kf(Ve.x,Ve.y,K,oe,ce)),Ve.prevZ=Ve.prev,Ve.nextZ=Ve.next,Ve=Ve.next;while(Ve!==W);Ve.prevZ.nextZ=null,Ve.prevZ=null,function(We){var st,et,Tt,Ut,nr,hr,Mr,Yr,hn=1;do{for(et=We,We=null,nr=null,hr=0;et;){for(hr++,Tt=et,Mr=0,st=0;st<hn&&(Mr++,Tt=Tt.nextZ);st++);for(Yr=hn;Mr>0||Yr>0&&Tt;)Mr!==0&&(Yr===0||!Tt||et.z<=Tt.z)?(Ut=et,et=et.nextZ,Mr--):(Ut=Tt,Tt=Tt.nextZ,Yr--),nr?nr.nextZ=Ut:We=Ut,Ut.prevZ=nr,nr=Ut;et=Tt}nr.nextZ=null,hn*=2}while(hr>1)}(Ve)}(e,c,v,m);for(var C,k,B=e;e.prev!==e.next;)if(C=e.prev,k=e.next,m?Yf(e,c,v,m):Df(e))t.push(C.i/r),t.push(e.i/r),t.push(k.i/r),P(e),e=k.next,B=k.next;else if((e=k)===B){_?_===1?Vc(e=Kf(Vl(e),t,r),t,r,c,v,m,2):_===2&&$f(e,t,r,c,v,m):Vc(Vl(e),t,r,c,v,m,1);break}}}function Df(e){var t=e.prev,r=e,c=e.next;if(yo(t,r,c)>=0)return!1;for(var v=e.next.next;v!==e.prev;){if(Ou(t.x,t.y,r.x,r.y,c.x,c.y,v.x,v.y)&&yo(v.prev,v,v.next)>=0)return!1;v=v.next}return!0}function Yf(e,t,r,c){var v=e.prev,m=e,_=e.next;if(yo(v,m,_)>=0)return!1;for(var C=v.x>m.x?v.x>_.x?v.x:_.x:m.x>_.x?m.x:_.x,k=v.y>m.y?v.y>_.y?v.y:_.y:m.y>_.y?m.y:_.y,B=kf(v.x<m.x?v.x<_.x?v.x:_.x:m.x<_.x?m.x:_.x,v.y<m.y?v.y<_.y?v.y:_.y:m.y<_.y?m.y:_.y,t,r,c),W=kf(C,k,t,r,c),K=e.prevZ,oe=e.nextZ;K&&K.z>=B&&oe&&oe.z<=W;){if(K!==e.prev&&K!==e.next&&Ou(v.x,v.y,m.x,m.y,_.x,_.y,K.x,K.y)&&yo(K.prev,K,K.next)>=0||(K=K.prevZ,oe!==e.prev&&oe!==e.next&&Ou(v.x,v.y,m.x,m.y,_.x,_.y,oe.x,oe.y)&&yo(oe.prev,oe,oe.next)>=0))return!1;oe=oe.nextZ}for(;K&&K.z>=B;){if(K!==e.prev&&K!==e.next&&Ou(v.x,v.y,m.x,m.y,_.x,_.y,K.x,K.y)&&yo(K.prev,K,K.next)>=0)return!1;K=K.prevZ}for(;oe&&oe.z<=W;){if(oe!==e.prev&&oe!==e.next&&Ou(v.x,v.y,m.x,m.y,_.x,_.y,oe.x,oe.y)&&yo(oe.prev,oe,oe.next)>=0)return!1;oe=oe.nextZ}return!0}function Kf(e,t,r){var c=e;do{var v=c.prev,m=c.next.next;!nf(v,m)&&Ff(v,c,c.next,m)&&ac(v,m)&&ac(m,v)&&(t.push(v.i/r),t.push(c.i/r),t.push(m.i/r),P(c),P(c.next),c=e=m),c=c.next}while(c!==e);return Vl(c)}function $f(e,t,r,c,v,m){var _=e;do{for(var C=_.next.next;C!==_.prev;){if(_.i!==C.i&&bf(_,C)){var k=N(_,C);return _=Vl(_,_.next),k=Vl(k,k.next),Vc(_,t,r,c,v,m),void Vc(k,t,r,c,v,m)}C=C.next}_=_.next}while(_!==e)}function Jf(e,t){return e.x-t.x}function Qf(e,t){if(t=function(c,v){var m,_=v,C=c.x,k=c.y,B=-1/0;do{if(k<=_.y&&k>=_.next.y&&_.next.y!==_.y){var W=_.x+(k-_.y)*(_.next.x-_.x)/(_.next.y-_.y);if(W<=C&&W>B){if(B=W,W===C){if(k===_.y)return _;if(k===_.next.y)return _.next}m=_.x<_.next.x?_:_.next}}_=_.next}while(_!==v);if(!m)return null;if(C===B)return m;var K,oe=m,ce=m.x,Ve=m.y,We=1/0;_=m;do C>=_.x&&_.x>=ce&&C!==_.x&&Ou(k<Ve?C:B,k,ce,Ve,k<Ve?B:C,k,_.x,_.y)&&(K=Math.abs(k-_.y)/(C-_.x),ac(_,c)&&(K<We||K===We&&(_.x>m.x||_.x===m.x&&mh(m,_)))&&(m=_,We=K)),_=_.next;while(_!==oe);return m}(e,t)){var r=N(t,e);Vl(t,t.next),Vl(r,r.next)}}function mh(e,t){return yo(e.prev,e,t.prev)<0&&yo(t.next,e,e.next)<0}function kf(e,t,r,c,v){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*v)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-c)*v)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function gh(e){var t=e,r=e;do(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next;while(t!==e);return r}function Ou(e,t,r,c,v,m,_,C){return(v-_)*(t-C)-(e-_)*(m-C)>=0&&(e-_)*(c-C)-(r-_)*(t-C)>=0&&(r-_)*(m-C)-(v-_)*(c-C)>=0}function bf(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(r,c){var v=r;do{if(v.i!==r.i&&v.next.i!==r.i&&v.i!==c.i&&v.next.i!==c.i&&Ff(v,v.next,r,c))return!0;v=v.next}while(v!==r);return!1}(e,t)&&(ac(e,t)&&ac(t,e)&&function(r,c){var v=r,m=!1,_=(r.x+c.x)/2,C=(r.y+c.y)/2;do v.y>C!=v.next.y>C&&v.next.y!==v.y&&_<(v.next.x-v.x)*(C-v.y)/(v.next.y-v.y)+v.x&&(m=!m),v=v.next;while(v!==r);return m}(e,t)&&(yo(e.prev,e,t.prev)||yo(e,t.prev,t))||nf(e,t)&&yo(e.prev,e,e.next)>0&&yo(t.prev,t,t.next)>0)}function yo(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function nf(e,t){return e.x===t.x&&e.y===t.y}function Ff(e,t,r,c){var v=Gc(yo(e,t,r)),m=Gc(yo(e,t,c)),_=Gc(yo(r,c,e)),C=Gc(yo(r,c,t));return v!==m&&_!==C||!(v!==0||!Al(e,r,t))||!(m!==0||!Al(e,c,t))||!(_!==0||!Al(r,e,c))||!(C!==0||!Al(r,t,c))}function Al(e,t,r){return t.x<=Math.max(e.x,r.x)&&t.x>=Math.min(e.x,r.x)&&t.y<=Math.max(e.y,r.y)&&t.y>=Math.min(e.y,r.y)}function Gc(e){return e>0?1:e<0?-1:0}function ac(e,t){return yo(e.prev,e,e.next)<0?yo(e,t,e.next)>=0&&yo(e,e.prev,t)>=0:yo(e,t,e.prev)<0||yo(e,e.next,t)<0}function N(e,t){var r=new O(e.i,e.x,e.y),c=new O(t.i,t.x,t.y),v=e.next,m=t.prev;return e.next=t,t.prev=e,r.next=v,v.prev=r,c.next=r,r.prev=c,m.next=c,c.prev=m,c}function U(e,t,r,c){var v=new O(e,t,r);return c?(v.next=c.next,v.prev=c,c.next.prev=v,c.next=v):(v.prev=v,v.next=v),v}function P(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function O(e,t,r){this.i=e,this.x=t,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function q(e,t,r,c){for(var v=0,m=t,_=r-c;m<r;m+=c)v+=(e[_]-e[m])*(e[m+1]+e[_+1]),_=m;return v}function ve(e,t,r,c,v){(function m(_,C,k,B,W){for(;B>k;){if(B-k>600){var K=B-k+1,oe=C-k+1,ce=Math.log(K),Ve=.5*Math.exp(2*ce/3),We=.5*Math.sqrt(ce*Ve*(K-Ve)/K)*(oe-K/2<0?-1:1);m(_,C,Math.max(k,Math.floor(C-oe*Ve/K+We)),Math.min(B,Math.floor(C+(K-oe)*Ve/K+We)),W)}var st=_[C],et=k,Tt=B;for($e(_,k,C),W(_[B],st)>0&&$e(_,k,B);et<Tt;){for($e(_,et,Tt),et++,Tt--;W(_[et],st)<0;)et++;for(;W(_[Tt],st)>0;)Tt--}W(_[k],st)===0?$e(_,k,Tt):$e(_,++Tt,B),Tt<=C&&(k=Tt+1),C<=Tt&&(B=Tt-1)}})(e,t,r||0,c||e.length-1,v||xt)}function $e(e,t,r){var c=e[t];e[t]=e[r],e[r]=c}function xt(e,t){return e<t?-1:e>t?1:0}function vt(e,t){var r=e.length;if(r<=1)return[e];for(var c,v,m=[],_=0;_<r;_++){var C=Be(e[_]);C!==0&&(e[_].area=Math.abs(C),v===void 0&&(v=C<0),v===C<0?(c&&m.push(c),c=[e[_]]):c.push(e[_]))}if(c&&m.push(c),t>1)for(var k=0;k<m.length;k++)m[k].length<=t||(ve(m[k],t,1,m[k].length-1,mr),m[k]=m[k].slice(0,t));return m}function mr(e,t){return t.area-e.area}function Br(e,t,r){for(var c=r.patternDependencies,v=!1,m=0,_=t;m<_.length;m+=1){var C=_[m].paint.get(e+"-pattern");C.isConstant()||(v=!0);var k=C.constantOr(null);k&&(v=!0,c[k.to]=!0,c[k.from]=!0)}return v}function In(e,t,r,c,v){for(var m=v.patternDependencies,_=0,C=t;_<C.length;_+=1){var k=C[_],B=k.paint.get(e+"-pattern").value;if(B.kind!=="constant"){var W=B.evaluate({zoom:c-1},r,{},v.availableImages),K=B.evaluate({zoom:c},r,{},v.availableImages),oe=B.evaluate({zoom:c+1},r,{},v.availableImages);K=K&&K.name?K.name:K,oe=oe&&oe.name?oe.name:oe,m[W=W&&W.name?W.name:W]=!0,m[K]=!0,m[oe]=!0,r.patterns[k.id]={min:W,mid:K,max:oe}}}return r}xf.deviation=function(e,t,r,c){var v=t&&t.length,m=Math.abs(q(e,0,v?t[0]*r:e.length,r));if(v)for(var _=0,C=t.length;_<C;_++)m-=Math.abs(q(e,t[_]*r,_<C-1?t[_+1]*r:e.length,r));var k=0;for(_=0;_<c.length;_+=3){var B=c[_]*r,W=c[_+1]*r,K=c[_+2]*r;k+=Math.abs((e[B]-e[K])*(e[W+1]-e[B+1])-(e[B]-e[W])*(e[K+1]-e[B+1]))}return m===0&&k===0?0:Math.abs((k-m)/m)},xf.flatten=function(e){for(var t=e[0][0].length,r={vertices:[],holes:[],dimensions:t},c=0,v=0;v<e.length;v++){for(var m=0;m<e[v].length;m++)for(var _=0;_<t;_++)r.vertices.push(e[v][m][_]);v>0&&r.holes.push(c+=e[v-1].length)}return r},ic.default=Rf;var Bn=function(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(function(t){return t.id}),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new bl,this.indexArray=new al,this.indexArray2=new bc,this.programConfigurations=new Qn(e.layers,e.zoom),this.segments=new ye,this.segments2=new ye,this.stateDependentLayerIds=this.layers.filter(function(t){return t.isStateDependent()}).map(function(t){return t.id})};Bn.prototype.populate=function(e,t,r){this.hasPattern=Br("fill",this.layers,t);for(var c=this.layers[0].layout.get("fill-sort-key"),v=[],m=0,_=e;m<_.length;m+=1){var C=_[m],k=C.feature,B=C.id,W=C.index,K=C.sourceLayerIndex,oe=this.layers[0]._featureFilter.needGeometry,ce=ro(k,oe);if(this.layers[0]._featureFilter.filter(new Fi(this.zoom),ce,r)){var Ve=c?c.evaluate(ce,{},r,t.availableImages):void 0,We={id:B,properties:k.properties,type:k.type,sourceLayerIndex:K,index:W,geometry:oe?ce.geometry:Qa(k),patterns:{},sortKey:Ve};v.push(We)}}c&&v.sort(function(Yr,hn){return Yr.sortKey-hn.sortKey});for(var st=0,et=v;st<et.length;st+=1){var Tt=et[st],Ut=Tt.geometry,nr=Tt.index,hr=Tt.sourceLayerIndex;if(this.hasPattern){var Mr=In("fill",this.layers,Tt,this.zoom,t);this.patternFeatures.push(Mr)}else this.addFeature(Tt,Ut,nr,r,{});t.featureIndex.insert(e[nr].feature,Ut,nr,hr,this.index)}},Bn.prototype.update=function(e,t,r){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,r)},Bn.prototype.addFeatures=function(e,t,r){for(var c=0,v=this.patternFeatures;c<v.length;c+=1){var m=v[c];this.addFeature(m,m.geometry,m.index,t,r)}},Bn.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},Bn.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Bn.prototype.upload=function(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,vh),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0},Bn.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())},Bn.prototype.addFeature=function(e,t,r,c,v){for(var m=0,_=vt(t,500);m<_.length;m+=1){for(var C=_[m],k=0,B=0,W=C;B<W.length;B+=1)k+=W[B].length;for(var K=this.segments.prepareSegment(k,this.layoutVertexArray,this.indexArray),oe=K.vertexLength,ce=[],Ve=[],We=0,st=C;We<st.length;We+=1){var et=st[We];if(et.length!==0){et!==C[0]&&Ve.push(ce.length/2);var Tt=this.segments2.prepareSegment(et.length,this.layoutVertexArray,this.indexArray2),Ut=Tt.vertexLength;this.layoutVertexArray.emplaceBack(et[0].x,et[0].y),this.indexArray2.emplaceBack(Ut+et.length-1,Ut),ce.push(et[0].x),ce.push(et[0].y);for(var nr=1;nr<et.length;nr++)this.layoutVertexArray.emplaceBack(et[nr].x,et[nr].y),this.indexArray2.emplaceBack(Ut+nr-1,Ut+nr),ce.push(et[nr].x),ce.push(et[nr].y);Tt.vertexLength+=et.length,Tt.primitiveLength+=et.length}}for(var hr=ic(ce,Ve),Mr=0;Mr<hr.length;Mr+=3)this.indexArray.emplaceBack(oe+hr[Mr],oe+hr[Mr+1],oe+hr[Mr+2]);K.vertexLength+=k,K.primitiveLength+=hr.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,v,c)},Tn("FillBucket",Bn,{omit:["layers","patternFeatures"]});var fi=new ko({"fill-sort-key":new Mn(ue.layout_fill["fill-sort-key"])}),Ci={paint:new ko({"fill-antialias":new Un(ue.paint_fill["fill-antialias"]),"fill-opacity":new Mn(ue.paint_fill["fill-opacity"]),"fill-color":new Mn(ue.paint_fill["fill-color"]),"fill-outline-color":new Mn(ue.paint_fill["fill-outline-color"]),"fill-translate":new Un(ue.paint_fill["fill-translate"]),"fill-translate-anchor":new Un(ue.paint_fill["fill-translate-anchor"]),"fill-pattern":new rc(ue.paint_fill["fill-pattern"])}),layout:fi},wi=function(e){function t(r){e.call(this,r,Ci)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.recalculate=function(r,c){e.prototype.recalculate.call(this,r,c);var v=this.paint._values["fill-outline-color"];v.value.kind==="constant"&&v.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])},t.prototype.createBucket=function(r){return new Bn(r)},t.prototype.queryRadius=function(){return no(this.paint.get("fill-translate"))},t.prototype.queryIntersectsFeature=function(r,c,v,m,_,C,k){return Zs(Pu(r,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),C.angle,k),m)},t.prototype.isTileClipped=function(){return!0},t}(hu),ha=So([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4).members,Ti=Va;function Va(e,t,r,c,v){this.properties={},this.extent=r,this.type=0,this._pbf=e,this._geometry=-1,this._keys=c,this._values=v,e.readFields(Bo,this,t)}function Bo(e,t,r){e==1?t.id=r.readVarint():e==2?function(c,v){for(var m=c.readVarint()+c.pos;c.pos<m;){var _=v._keys[c.readVarint()],C=v._values[c.readVarint()];v.properties[_]=C}}(r,t):e==3?t.type=r.readVarint():e==4&&(t._geometry=r.pos)}function Uo(e){for(var t,r,c=0,v=0,m=e.length,_=m-1;v<m;_=v++)c+=((r=e[_]).x-(t=e[v]).x)*(t.y+r.y);return c}Va.types=["Unknown","Point","LineString","Polygon"],Va.prototype.loadGeometry=function(){var e=this._pbf;e.pos=this._geometry;for(var t,r=e.readVarint()+e.pos,c=1,v=0,m=0,_=0,C=[];e.pos<r;){if(v<=0){var k=e.readVarint();c=7&k,v=k>>3}if(v--,c===1||c===2)m+=e.readSVarint(),_+=e.readSVarint(),c===1&&(t&&C.push(t),t=[]),t.push(new Y(m,_));else{if(c!==7)throw new Error("unknown command "+c);t&&t.push(t[0].clone())}}return t&&C.push(t),C},Va.prototype.bbox=function(){var e=this._pbf;e.pos=this._geometry;for(var t=e.readVarint()+e.pos,r=1,c=0,v=0,m=0,_=1/0,C=-1/0,k=1/0,B=-1/0;e.pos<t;){if(c<=0){var W=e.readVarint();r=7&W,c=W>>3}if(c--,r===1||r===2)(v+=e.readSVarint())<_&&(_=v),v>C&&(C=v),(m+=e.readSVarint())<k&&(k=m),m>B&&(B=m);else if(r!==7)throw new Error("unknown command "+r)}return[_,k,C,B]},Va.prototype.toGeoJSON=function(e,t,r){var c,v,m=this.extent*Math.pow(2,r),_=this.extent*e,C=this.extent*t,k=this.loadGeometry(),B=Va.types[this.type];function W(ce){for(var Ve=0;Ve<ce.length;Ve++){var We=ce[Ve];ce[Ve]=[360*(We.x+_)/m-180,360/Math.PI*Math.atan(Math.exp((180-360*(We.y+C)/m)*Math.PI/180))-90]}}switch(this.type){case 1:var K=[];for(c=0;c<k.length;c++)K[c]=k[c][0];W(k=K);break;case 2:for(c=0;c<k.length;c++)W(k[c]);break;case 3:for(k=function(ce){var Ve=ce.length;if(Ve<=1)return[ce];for(var We,st,et=[],Tt=0;Tt<Ve;Tt++){var Ut=Uo(ce[Tt]);Ut!==0&&(st===void 0&&(st=Ut<0),st===Ut<0?(We&&et.push(We),We=[ce[Tt]]):We.push(ce[Tt]))}return We&&et.push(We),et}(k),c=0;c<k.length;c++)for(v=0;v<k[c].length;v++)W(k[c][v])}k.length===1?k=k[0]:B="Multi"+B;var oe={type:"Feature",geometry:{type:B,coordinates:k},properties:this.properties};return"id"in this&&(oe.id=this.id),oe};var us=co;function co(e,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(ya,this,t),this.length=this._features.length}function ya(e,t,r){e===15?t.version=r.readVarint():e===1?t.name=r.readString():e===5?t.extent=r.readVarint():e===2?t._features.push(r.pos):e===3?t._keys.push(r.readString()):e===4&&t._values.push(function(c){for(var v=null,m=c.readVarint()+c.pos;c.pos<m;){var _=c.readVarint()>>3;v=_===1?c.readString():_===2?c.readFloat():_===3?c.readDouble():_===4?c.readVarint64():_===5?c.readVarint():_===6?c.readSVarint():_===7?c.readBoolean():null}return v}(r))}function pa(e,t,r){if(e===3){var c=new us(r,r.readVarint()+r.pos);c.length&&(t[c.name]=c)}}co.prototype.feature=function(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];var t=this._pbf.readVarint()+this._pbf.pos;return new Ti(this._pbf,t,this.extent,this._keys,this._values)};var _o={VectorTile:function(e,t){this.layers=e.readFields(pa,{},t)},VectorTileFeature:Ti,VectorTileLayer:us},fo=_o.VectorTileFeature.types,Ga=Math.pow(2,13);function $o(e,t,r,c,v,m,_,C){e.emplaceBack(t,r,2*Math.floor(c*Ga)+_,v*Ga*2,m*Ga*2,Math.round(C))}var Jo=function(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(function(t){return t.id}),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new wu,this.indexArray=new al,this.programConfigurations=new Qn(e.layers,e.zoom),this.segments=new ye,this.stateDependentLayerIds=this.layers.filter(function(t){return t.isStateDependent()}).map(function(t){return t.id})};function oc(e,t){return e.x===t.x&&(e.x<0||e.x>8192)||e.y===t.y&&(e.y<0||e.y>8192)}Jo.prototype.populate=function(e,t,r){this.features=[],this.hasPattern=Br("fill-extrusion",this.layers,t);for(var c=0,v=e;c<v.length;c+=1){var m=v[c],_=m.feature,C=m.id,k=m.index,B=m.sourceLayerIndex,W=this.layers[0]._featureFilter.needGeometry,K=ro(_,W);if(this.layers[0]._featureFilter.filter(new Fi(this.zoom),K,r)){var oe={id:C,sourceLayerIndex:B,index:k,geometry:W?K.geometry:Qa(_),properties:_.properties,type:_.type,patterns:{}};this.hasPattern?this.features.push(In("fill-extrusion",this.layers,oe,this.zoom,t)):this.addFeature(oe,oe.geometry,k,r,{}),t.featureIndex.insert(_,oe.geometry,k,B,this.index,!0)}}},Jo.prototype.addFeatures=function(e,t,r){for(var c=0,v=this.features;c<v.length;c+=1){var m=v[c];this.addFeature(m,m.geometry,m.index,t,r)}},Jo.prototype.update=function(e,t,r){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,r)},Jo.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},Jo.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Jo.prototype.upload=function(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,ha),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0},Jo.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Jo.prototype.addFeature=function(e,t,r,c,v){for(var m=0,_=vt(t,500);m<_.length;m+=1){for(var C=_[m],k=0,B=0,W=C;B<W.length;B+=1)k+=W[B].length;for(var K=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray),oe=0,ce=C;oe<ce.length;oe+=1){var Ve=ce[oe];if(Ve.length!==0&&!((ea=Ve).every(function(zi){return zi.x<0})||ea.every(function(zi){return zi.x>8192})||ea.every(function(zi){return zi.y<0})||ea.every(function(zi){return zi.y>8192})))for(var We=0,st=0;st<Ve.length;st++){var et=Ve[st];if(st>=1){var Tt=Ve[st-1];if(!oc(et,Tt)){K.vertexLength+4>ye.MAX_VERTEX_ARRAY_LENGTH&&(K=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));var Ut=et.sub(Tt)._perp()._unit(),nr=Tt.dist(et);We+nr>32768&&(We=0),$o(this.layoutVertexArray,et.x,et.y,Ut.x,Ut.y,0,0,We),$o(this.layoutVertexArray,et.x,et.y,Ut.x,Ut.y,0,1,We),$o(this.layoutVertexArray,Tt.x,Tt.y,Ut.x,Ut.y,0,0,We+=nr),$o(this.layoutVertexArray,Tt.x,Tt.y,Ut.x,Ut.y,0,1,We);var hr=K.vertexLength;this.indexArray.emplaceBack(hr,hr+2,hr+1),this.indexArray.emplaceBack(hr+1,hr+2,hr+3),K.vertexLength+=4,K.primitiveLength+=2}}}}if(K.vertexLength+k>ye.MAX_VERTEX_ARRAY_LENGTH&&(K=this.segments.prepareSegment(k,this.layoutVertexArray,this.indexArray)),fo[e.type]==="Polygon"){for(var Mr=[],Yr=[],hn=K.vertexLength,Hn=0,wn=C;Hn<wn.length;Hn+=1){var Jn=wn[Hn];if(Jn.length!==0){Jn!==C[0]&&Yr.push(Mr.length/2);for(var yn=0;yn<Jn.length;yn++){var Ui=Jn[yn];$o(this.layoutVertexArray,Ui.x,Ui.y,0,0,1,1,0),Mr.push(Ui.x),Mr.push(Ui.y)}}}for(var hi=ic(Mr,Yr),Zn=0;Zn<hi.length;Zn+=3)this.indexArray.emplaceBack(hn+hi[Zn],hn+hi[Zn+2],hn+hi[Zn+1]);K.primitiveLength+=hi.length/3,K.vertexLength+=k}}var ea;this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,v,c)},Tn("FillExtrusionBucket",Jo,{omit:["layers","features"]});var Gl={paint:new ko({"fill-extrusion-opacity":new Un(ue["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Mn(ue["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Un(ue["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Un(ue["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new rc(ue["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Mn(ue["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Mn(ue["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Un(ue["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})},gs=function(e){function t(r){e.call(this,r,Gl)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.createBucket=function(r){return new Jo(r)},t.prototype.queryRadius=function(){return no(this.paint.get("fill-extrusion-translate"))},t.prototype.is3D=function(){return!0},t.prototype.queryIntersectsFeature=function(r,c,v,m,_,C,k,B){var W=Pu(r,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),C.angle,k),K=this.paint.get("fill-extrusion-height").evaluate(c,v),oe=this.paint.get("fill-extrusion-base").evaluate(c,v),ce=function(We,st,et,Tt){for(var Ut=[],nr=0,hr=We;nr<hr.length;nr+=1){var Mr=hr[nr],Yr=[Mr.x,Mr.y,0,1];mu(Yr,Yr,st),Ut.push(new Y(Yr[0]/Yr[3],Yr[1]/Yr[3]))}return Ut}(W,B),Ve=function(We,st,et,Tt){for(var Ut=[],nr=[],hr=Tt[8]*st,Mr=Tt[9]*st,Yr=Tt[10]*st,hn=Tt[11]*st,Hn=Tt[8]*et,wn=Tt[9]*et,Jn=Tt[10]*et,yn=Tt[11]*et,Ui=0,hi=We;Ui<hi.length;Ui+=1){for(var Zn=[],ea=[],zi=0,ca=hi[Ui];zi<ca.length;zi+=1){var ei=ca[zi],wa=ei.x,To=ei.y,Oo=Tt[0]*wa+Tt[4]*To+Tt[12],xo=Tt[1]*wa+Tt[5]*To+Tt[13],Ao=Tt[2]*wa+Tt[6]*To+Tt[14],Lo=Tt[3]*wa+Tt[7]*To+Tt[15],As=Ao+Yr,zs=Lo+hn,ou=Oo+Hn,Ns=xo+wn,Du=Ao+Jn,Ho=Lo+yn,Bs=new Y((Oo+hr)/zs,(xo+Mr)/zs);Bs.z=As/zs,Zn.push(Bs);var aa=new Y(ou/Ho,Ns/Ho);aa.z=Du/Ho,ea.push(aa)}Ut.push(Zn),nr.push(ea)}return[Ut,nr]}(m,oe,K,B);return function(We,st,et){var Tt=1/0;Zs(et,st)&&(Tt=jo(et,st[0]));for(var Ut=0;Ut<st.length;Ut++)for(var nr=st[Ut],hr=We[Ut],Mr=0;Mr<nr.length-1;Mr++){var Yr=nr[Mr],hn=[Yr,nr[Mr+1],hr[Mr+1],hr[Mr],Yr];Cu(et,hn)&&(Tt=Math.min(Tt,jo(et,hn)))}return Tt!==1/0&&Tt}(Ve[0],Ve[1],ce)},t}(hu);function iu(e,t){return e.x*t.x+e.y*t.y}function jo(e,t){if(e.length===1){for(var r,c=0,v=t[c++];!r||v.equals(r);)if(!(r=t[c++]))return 1/0;for(;c<t.length;c++){var m=t[c],_=e[0],C=r.sub(v),k=m.sub(v),B=_.sub(v),W=iu(C,C),K=iu(C,k),oe=iu(k,k),ce=iu(B,C),Ve=iu(B,k),We=W*oe-K*K,st=(oe*ce-K*Ve)/We,et=(W*Ve-K*ce)/We,Tt=v.z*(1-st-et)+r.z*st+m.z*et;if(isFinite(Tt))return Tt}return 1/0}for(var Ut=1/0,nr=0,hr=t;nr<hr.length;nr+=1)Ut=Math.min(Ut,hr[nr].z);return Ut}var Lu=So([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4).members,Uh=So([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]).members,vp=_o.VectorTileFeature.types,mp=Math.cos(Math.PI/180*37.5),jh=Math.pow(2,14)/.5,au=function(e){var t=this;this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(function(r){return r.id}),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(function(r){t.gradients[r.id]={}}),this.layoutVertexArray=new Es,this.layoutVertexArray2=new il,this.indexArray=new al,this.programConfigurations=new Qn(e.layers,e.zoom),this.segments=new ye,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(function(r){return r.isStateDependent()}).map(function(r){return r.id})};au.prototype.populate=function(e,t,r){this.hasPattern=Br("line",this.layers,t);for(var c=this.layers[0].layout.get("line-sort-key"),v=[],m=0,_=e;m<_.length;m+=1){var C=_[m],k=C.feature,B=C.id,W=C.index,K=C.sourceLayerIndex,oe=this.layers[0]._featureFilter.needGeometry,ce=ro(k,oe);if(this.layers[0]._featureFilter.filter(new Fi(this.zoom),ce,r)){var Ve=c?c.evaluate(ce,{},r):void 0,We={id:B,properties:k.properties,type:k.type,sourceLayerIndex:K,index:W,geometry:oe?ce.geometry:Qa(k),patterns:{},sortKey:Ve};v.push(We)}}c&&v.sort(function(Yr,hn){return Yr.sortKey-hn.sortKey});for(var st=0,et=v;st<et.length;st+=1){var Tt=et[st],Ut=Tt.geometry,nr=Tt.index,hr=Tt.sourceLayerIndex;if(this.hasPattern){var Mr=In("line",this.layers,Tt,this.zoom,t);this.patternFeatures.push(Mr)}else this.addFeature(Tt,Ut,nr,r,{});t.featureIndex.insert(e[nr].feature,Ut,nr,hr,this.index)}},au.prototype.update=function(e,t,r){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,r)},au.prototype.addFeatures=function(e,t,r){for(var c=0,v=this.patternFeatures;c<v.length;c+=1){var m=v[c];this.addFeature(m,m.geometry,m.index,t,r)}},au.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},au.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},au.prototype.upload=function(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,Uh)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Lu),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0},au.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},au.prototype.lineFeatureClips=function(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}},au.prototype.addFeature=function(e,t,r,c,v){var m=this.layers[0].layout,_=m.get("line-join").evaluate(e,{}),C=m.get("line-cap"),k=m.get("line-miter-limit"),B=m.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(var W=0,K=t;W<K.length;W+=1)this.addLine(K[W],e,_,C,k,B);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,v,c)},au.prototype.addLine=function(e,t,r,c,v,m){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(var _=0;_<e.length-1;_++)this.totalDistance+=e[_].dist(e[_+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}for(var C=vp[t.type]==="Polygon",k=e.length;k>=2&&e[k-1].equals(e[k-2]);)k--;for(var B=0;B<k-1&&e[B].equals(e[B+1]);)B++;if(!(k<(C?3:2))){r==="bevel"&&(v=1.05);var W,K=this.overscaling<=16?122880/(512*this.overscaling):0,oe=this.segments.prepareSegment(10*k,this.layoutVertexArray,this.indexArray),ce=void 0,Ve=void 0,We=void 0,st=void 0;this.e1=this.e2=-1,C&&(st=e[B].sub(W=e[k-2])._unit()._perp());for(var et=B;et<k;et++)if(!(Ve=et===k-1?C?e[B+1]:void 0:e[et+1])||!e[et].equals(Ve)){st&&(We=st),W&&(ce=W),W=e[et],st=Ve?Ve.sub(W)._unit()._perp():We;var Tt=(We=We||st).add(st);Tt.x===0&&Tt.y===0||Tt._unit();var Ut=We.x*st.x+We.y*st.y,nr=Tt.x*st.x+Tt.y*st.y,hr=nr!==0?1/nr:1/0,Mr=2*Math.sqrt(2-2*nr),Yr=nr<mp&&ce&&Ve,hn=We.x*st.y-We.y*st.x>0;if(Yr&&et>B){var Hn=W.dist(ce);if(Hn>2*K){var wn=W.sub(W.sub(ce)._mult(K/Hn)._round());this.updateDistance(ce,wn),this.addCurrentVertex(wn,We,0,0,oe),ce=wn}}var Jn=ce&&Ve,yn=Jn?r:C?"butt":c;if(Jn&&yn==="round"&&(hr<m?yn="miter":hr<=2&&(yn="fakeround")),yn==="miter"&&hr>v&&(yn="bevel"),yn==="bevel"&&(hr>2&&(yn="flipbevel"),hr<v&&(yn="miter")),ce&&this.updateDistance(ce,W),yn==="miter")Tt._mult(hr),this.addCurrentVertex(W,Tt,0,0,oe);else if(yn==="flipbevel"){if(hr>100)Tt=st.mult(-1);else{var Ui=hr*We.add(st).mag()/We.sub(st).mag();Tt._perp()._mult(Ui*(hn?-1:1))}this.addCurrentVertex(W,Tt,0,0,oe),this.addCurrentVertex(W,Tt.mult(-1),0,0,oe)}else if(yn==="bevel"||yn==="fakeround"){var hi=-Math.sqrt(hr*hr-1),Zn=hn?hi:0,ea=hn?0:hi;if(ce&&this.addCurrentVertex(W,We,Zn,ea,oe),yn==="fakeround")for(var zi=Math.round(180*Mr/Math.PI/20),ca=1;ca<zi;ca++){var ei=ca/zi;if(ei!==.5){var wa=ei-.5;ei+=ei*wa*(ei-1)*((1.0904+Ut*(Ut*(3.55645-1.43519*Ut)-3.2452))*wa*wa+(.848013+Ut*(.215638*Ut-1.06021)))}var To=st.sub(We)._mult(ei)._add(We)._unit()._mult(hn?-1:1);this.addHalfVertex(W,To.x,To.y,!1,hn,0,oe)}Ve&&this.addCurrentVertex(W,st,-Zn,-ea,oe)}else if(yn==="butt")this.addCurrentVertex(W,Tt,0,0,oe);else if(yn==="square"){var Oo=ce?1:-1;this.addCurrentVertex(W,Tt,Oo,Oo,oe)}else yn==="round"&&(ce&&(this.addCurrentVertex(W,We,0,0,oe),this.addCurrentVertex(W,We,1,1,oe,!0)),Ve&&(this.addCurrentVertex(W,st,-1,-1,oe,!0),this.addCurrentVertex(W,st,0,0,oe)));if(Yr&&et<k-1){var xo=W.dist(Ve);if(xo>2*K){var Ao=W.add(Ve.sub(W)._mult(K/xo)._round());this.updateDistance(W,Ao),this.addCurrentVertex(Ao,st,0,0,oe),W=Ao}}}}},au.prototype.addCurrentVertex=function(e,t,r,c,v,m){m===void 0&&(m=!1);var _=t.y*c-t.x,C=-t.y-t.x*c;this.addHalfVertex(e,t.x+t.y*r,t.y-t.x*r,m,!1,r,v),this.addHalfVertex(e,_,C,m,!0,-c,v),this.distance>jh/2&&this.totalDistance===0&&(this.distance=0,this.addCurrentVertex(e,t,r,c,v,m))},au.prototype.addHalfVertex=function(e,t,r,c,v,m,_){var C=.5*(this.lineClips?this.scaledDistance*(jh-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((e.x<<1)+(c?1:0),(e.y<<1)+(v?1:0),Math.round(63*t)+128,Math.round(63*r)+128,1+(m===0?0:m<0?-1:1)|(63&C)<<2,C>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);var k=_.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,k),_.primitiveLength++),v?this.e2=k:this.e1=k},au.prototype.updateScaledDistance=function(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance},au.prototype.updateDistance=function(e,t){this.distance+=e.dist(t),this.updateScaledDistance()},Tn("LineBucket",au,{omit:["layers","patternFeatures"]});var yh=new ko({"line-cap":new Un(ue.layout_line["line-cap"]),"line-join":new Mn(ue.layout_line["line-join"]),"line-miter-limit":new Un(ue.layout_line["line-miter-limit"]),"line-round-limit":new Un(ue.layout_line["line-round-limit"]),"line-sort-key":new Mn(ue.layout_line["line-sort-key"])}),Zh={paint:new ko({"line-opacity":new Mn(ue.paint_line["line-opacity"]),"line-color":new Mn(ue.paint_line["line-color"]),"line-translate":new Un(ue.paint_line["line-translate"]),"line-translate-anchor":new Un(ue.paint_line["line-translate-anchor"]),"line-width":new Mn(ue.paint_line["line-width"]),"line-gap-width":new Mn(ue.paint_line["line-gap-width"]),"line-offset":new Mn(ue.paint_line["line-offset"]),"line-blur":new Mn(ue.paint_line["line-blur"]),"line-dasharray":new as(ue.paint_line["line-dasharray"]),"line-pattern":new rc(ue.paint_line["line-pattern"]),"line-gradient":new vo(ue.paint_line["line-gradient"])}),layout:yh},_h=new(function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.possiblyEvaluate=function(r,c){return c=new Fi(Math.floor(c.zoom),{now:c.now,fadeDuration:c.fadeDuration,zoomHistory:c.zoomHistory,transition:c.transition}),e.prototype.possiblyEvaluate.call(this,r,c)},t.prototype.evaluate=function(r,c,v,m){return c=Xt({},c,{zoom:Math.floor(c.zoom)}),e.prototype.evaluate.call(this,r,c,v,m)},t}(Mn))(Zh.paint.properties["line-width"].specification);_h.useIntegerZoom=!0;var xh=function(e){function t(r){e.call(this,r,Zh),this.gradientVersion=0}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._handleSpecialPaintPropertyUpdate=function(r){r==="line-gradient"&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof ba,this.gradientVersion=(this.gradientVersion+1)%be)},t.prototype.gradientExpression=function(){return this._transitionablePaint._values["line-gradient"].value.expression},t.prototype.recalculate=function(r,c){e.prototype.recalculate.call(this,r,c),this.paint._values["line-floorwidth"]=_h.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,r)},t.prototype.createBucket=function(r){return new au(r)},t.prototype.queryRadius=function(r){var c=r,v=Vh(tu("line-width",this,c),tu("line-gap-width",this,c)),m=tu("line-offset",this,c);return v/2+Math.abs(m)+no(this.paint.get("line-translate"))},t.prototype.queryIntersectsFeature=function(r,c,v,m,_,C,k){var B=Pu(r,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),C.angle,k),W=k/2*Vh(this.paint.get("line-width").evaluate(c,v),this.paint.get("line-gap-width").evaluate(c,v)),K=this.paint.get("line-offset").evaluate(c,v);return K&&(m=function(oe,ce){for(var Ve=[],We=new Y(0,0),st=0;st<oe.length;st++){for(var et=oe[st],Tt=[],Ut=0;Ut<et.length;Ut++){var nr=et[Ut],hr=et[Ut+1],Mr=Ut===0?We:nr.sub(et[Ut-1])._unit()._perp(),Yr=Ut===et.length-1?We:hr.sub(nr)._unit()._perp(),hn=Mr._add(Yr)._unit();hn._mult(1/(hn.x*Yr.x+hn.y*Yr.y)),Tt.push(hn._mult(ce)._add(nr))}Ve.push(Tt)}return Ve}(m,K*k)),function(oe,ce,Ve){for(var We=0;We<ce.length;We++){var st=ce[We];if(oe.length>=3){for(var et=0;et<st.length;et++)if(du(oe,st[et]))return!0}if(Vs(oe,st,Ve))return!0}return!1}(B,m,W)},t.prototype.isTileClipped=function(){return!0},t}(hu);function Vh(e,t){return t>0?t+2*e:e}var gp=So([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Gh=So([{name:"a_projected_pos",components:3,type:"Float32"}],4),Hh=(So([{name:"a_fade_opacity",components:1,type:"Uint32"}],4),So([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}])),bh=(So([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]),So([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4)),yp=So([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Sf(e,t,r){return e.sections.forEach(function(c){c.text=function(v,m,_){var C=m.layout.get("text-transform").evaluate(_,{});return C==="uppercase"?v=v.toLocaleUpperCase():C==="lowercase"&&(v=v.toLocaleLowerCase()),Qs.applyArabicShaping&&(v=Qs.applyArabicShaping(v)),v}(c.text,t,r)}),e}So([{name:"triangle",components:3,type:"Uint16"}]),So([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),So([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),So([{type:"Float32",name:"offsetX"}]),So([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var Ef={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"},Wh=function(e,t,r,c,v){var m,_,C=8*v-c-1,k=(1<<C)-1,B=k>>1,W=-7,K=r?v-1:0,oe=r?-1:1,ce=e[t+K];for(K+=oe,m=ce&(1<<-W)-1,ce>>=-W,W+=C;W>0;m=256*m+e[t+K],K+=oe,W-=8);for(_=m&(1<<-W)-1,m>>=-W,W+=c;W>0;_=256*_+e[t+K],K+=oe,W-=8);if(m===0)m=1-B;else{if(m===k)return _?NaN:1/0*(ce?-1:1);_+=Math.pow(2,c),m-=B}return(ce?-1:1)*_*Math.pow(2,m-c)},j=function(e,t,r,c,v,m){var _,C,k,B=8*m-v-1,W=(1<<B)-1,K=W>>1,oe=v===23?Math.pow(2,-24)-Math.pow(2,-77):0,ce=c?0:m-1,Ve=c?1:-1,We=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(C=isNaN(t)?1:0,_=W):(_=Math.floor(Math.log(t)/Math.LN2),t*(k=Math.pow(2,-_))<1&&(_--,k*=2),(t+=_+K>=1?oe/k:oe*Math.pow(2,1-K))*k>=2&&(_++,k/=2),_+K>=W?(C=0,_=W):_+K>=1?(C=(t*k-1)*Math.pow(2,v),_+=K):(C=t*Math.pow(2,K-1)*Math.pow(2,v),_=0));v>=8;e[r+ce]=255&C,ce+=Ve,C/=256,v-=8);for(_=_<<v|C,B+=v;B>0;e[r+ce]=255&_,ce+=Ve,_/=256,B-=8);e[r+ce-Ve]|=128*We},Se=ke;function ke(e){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(e)?e:new Uint8Array(e||0),this.pos=0,this.type=0,this.length=this.buf.length}ke.Varint=0,ke.Fixed64=1,ke.Bytes=2,ke.Fixed32=5;var qt=typeof TextDecoder=="undefined"?null:new TextDecoder("utf8");function wr(e){return e.type===ke.Bytes?e.readVarint()+e.pos:e.pos+1}function Yt(e,t,r){return r?4294967296*t+(e>>>0):4294967296*(t>>>0)+(e>>>0)}function pr(e,t,r){var c=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));r.realloc(c);for(var v=r.pos-1;v>=e;v--)r.buf[v+c]=r.buf[v]}function Zr(e,t){for(var r=0;r<e.length;r++)t.writeVarint(e[r])}function Wr(e,t){for(var r=0;r<e.length;r++)t.writeSVarint(e[r])}function en(e,t){for(var r=0;r<e.length;r++)t.writeFloat(e[r])}function Kr(e,t){for(var r=0;r<e.length;r++)t.writeDouble(e[r])}function an(e,t){for(var r=0;r<e.length;r++)t.writeBoolean(e[r])}function fn(e,t){for(var r=0;r<e.length;r++)t.writeFixed32(e[r])}function Vr(e,t){for(var r=0;r<e.length;r++)t.writeSFixed32(e[r])}function on(e,t){for(var r=0;r<e.length;r++)t.writeFixed64(e[r])}function zt(e,t){for(var r=0;r<e.length;r++)t.writeSFixed64(e[r])}function fr(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+16777216*e[t+3]}function Gr(e,t,r){e[r]=t,e[r+1]=t>>>8,e[r+2]=t>>>16,e[r+3]=t>>>24}function mn(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+(e[t+3]<<24)}function Dr(e,t,r){e===1&&r.readMessage(En,t)}function En(e,t,r){if(e===3){var c=r.readMessage(zr,{}),v=c.width,m=c.height,_=c.left,C=c.top,k=c.advance;t.push({id:c.id,bitmap:new gu({width:v+6,height:m+6},c.bitmap),metrics:{width:v,height:m,left:_,top:C,advance:k}})}}function zr(e,t,r){e===1?t.id=r.readVarint():e===2?t.bitmap=r.readBytes():e===3?t.width=r.readVarint():e===4?t.height=r.readVarint():e===5?t.left=r.readSVarint():e===6?t.top=r.readSVarint():e===7&&(t.advance=r.readVarint())}function sn(e){for(var t=0,r=0,c=0,v=e;c<v.length;c+=1){var m=v[c];t+=m.w*m.h,r=Math.max(r,m.w)}e.sort(function(We,st){return st.h-We.h});for(var _=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),r),h:1/0}],C=0,k=0,B=0,W=e;B<W.length;B+=1)for(var K=W[B],oe=_.length-1;oe>=0;oe--){var ce=_[oe];if(!(K.w>ce.w||K.h>ce.h)){if(K.x=ce.x,K.y=ce.y,k=Math.max(k,K.y+K.h),C=Math.max(C,K.x+K.w),K.w===ce.w&&K.h===ce.h){var Ve=_.pop();oe<_.length&&(_[oe]=Ve)}else K.h===ce.h?(ce.x+=K.w,ce.w-=K.w):K.w===ce.w?(ce.y+=K.h,ce.h-=K.h):(_.push({x:ce.x+K.w,y:ce.y,w:ce.w-K.w,h:K.h}),ce.y+=K.h,ce.h-=K.h);break}}return{w:C,h:k,fill:t/(C*k)||0}}ke.prototype={destroy:function(){this.buf=null},readFields:function(e,t,r){for(r=r||this.length;this.pos<r;){var c=this.readVarint(),v=c>>3,m=this.pos;this.type=7&c,e(v,t,this),this.pos===m&&this.skip(c)}return t},readMessage:function(e,t){return this.readFields(e,t,this.readVarint()+this.pos)},readFixed32:function(){var e=fr(this.buf,this.pos);return this.pos+=4,e},readSFixed32:function(){var e=mn(this.buf,this.pos);return this.pos+=4,e},readFixed64:function(){var e=fr(this.buf,this.pos)+4294967296*fr(this.buf,this.pos+4);return this.pos+=8,e},readSFixed64:function(){var e=fr(this.buf,this.pos)+4294967296*mn(this.buf,this.pos+4);return this.pos+=8,e},readFloat:function(){var e=Wh(this.buf,this.pos,!0,23,4);return this.pos+=4,e},readDouble:function(){var e=Wh(this.buf,this.pos,!0,52,8);return this.pos+=8,e},readVarint:function(e){var t,r,c=this.buf;return t=127&(r=c[this.pos++]),r<128?t:(t|=(127&(r=c[this.pos++]))<<7,r<128?t:(t|=(127&(r=c[this.pos++]))<<14,r<128?t:(t|=(127&(r=c[this.pos++]))<<21,r<128?t:function(v,m,_){var C,k,B=_.buf;if(C=(112&(k=B[_.pos++]))>>4,k<128||(C|=(127&(k=B[_.pos++]))<<3,k<128)||(C|=(127&(k=B[_.pos++]))<<10,k<128)||(C|=(127&(k=B[_.pos++]))<<17,k<128)||(C|=(127&(k=B[_.pos++]))<<24,k<128)||(C|=(1&(k=B[_.pos++]))<<31,k<128))return Yt(v,C,m);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(r=c[this.pos]))<<28,e,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var e=this.readVarint();return e%2==1?(e+1)/-2:e/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var e=this.readVarint()+this.pos,t=this.pos;return this.pos=e,e-t>=12&&qt?function(r,c,v){return qt.decode(r.subarray(c,v))}(this.buf,t,e):function(r,c,v){for(var m="",_=c;_<v;){var C,k,B,W=r[_],K=null,oe=W>239?4:W>223?3:W>191?2:1;if(_+oe>v)break;oe===1?W<128&&(K=W):oe===2?(192&(C=r[_+1]))==128&&(K=(31&W)<<6|63&C)<=127&&(K=null):oe===3?(k=r[_+2],(192&(C=r[_+1]))==128&&(192&k)==128&&((K=(15&W)<<12|(63&C)<<6|63&k)<=2047||K>=55296&&K<=57343)&&(K=null)):oe===4&&(k=r[_+2],B=r[_+3],(192&(C=r[_+1]))==128&&(192&k)==128&&(192&B)==128&&((K=(15&W)<<18|(63&C)<<12|(63&k)<<6|63&B)<=65535||K>=1114112)&&(K=null)),K===null?(K=65533,oe=1):K>65535&&(K-=65536,m+=String.fromCharCode(K>>>10&1023|55296),K=56320|1023&K),m+=String.fromCharCode(K),_+=oe}return m}(this.buf,t,e)},readBytes:function(){var e=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,e);return this.pos=e,t},readPackedVarint:function(e,t){if(this.type!==ke.Bytes)return e.push(this.readVarint(t));var r=wr(this);for(e=e||[];this.pos<r;)e.push(this.readVarint(t));return e},readPackedSVarint:function(e){if(this.type!==ke.Bytes)return e.push(this.readSVarint());var t=wr(this);for(e=e||[];this.pos<t;)e.push(this.readSVarint());return e},readPackedBoolean:function(e){if(this.type!==ke.Bytes)return e.push(this.readBoolean());var t=wr(this);for(e=e||[];this.pos<t;)e.push(this.readBoolean());return e},readPackedFloat:function(e){if(this.type!==ke.Bytes)return e.push(this.readFloat());var t=wr(this);for(e=e||[];this.pos<t;)e.push(this.readFloat());return e},readPackedDouble:function(e){if(this.type!==ke.Bytes)return e.push(this.readDouble());var t=wr(this);for(e=e||[];this.pos<t;)e.push(this.readDouble());return e},readPackedFixed32:function(e){if(this.type!==ke.Bytes)return e.push(this.readFixed32());var t=wr(this);for(e=e||[];this.pos<t;)e.push(this.readFixed32());return e},readPackedSFixed32:function(e){if(this.type!==ke.Bytes)return e.push(this.readSFixed32());var t=wr(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed32());return e},readPackedFixed64:function(e){if(this.type!==ke.Bytes)return e.push(this.readFixed64());var t=wr(this);for(e=e||[];this.pos<t;)e.push(this.readFixed64());return e},readPackedSFixed64:function(e){if(this.type!==ke.Bytes)return e.push(this.readSFixed64());var t=wr(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed64());return e},skip:function(e){var t=7&e;if(t===ke.Varint)for(;this.buf[this.pos++]>127;);else if(t===ke.Bytes)this.pos=this.readVarint()+this.pos;else if(t===ke.Fixed32)this.pos+=4;else{if(t!==ke.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(e,t){this.writeVarint(e<<3|t)},realloc:function(e){for(var t=this.length||16;t<this.pos+e;)t*=2;if(t!==this.length){var r=new Uint8Array(t);r.set(this.buf),this.buf=r,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(e){this.realloc(4),Gr(this.buf,e,this.pos),this.pos+=4},writeSFixed32:function(e){this.realloc(4),Gr(this.buf,e,this.pos),this.pos+=4},writeFixed64:function(e){this.realloc(8),Gr(this.buf,-1&e,this.pos),Gr(this.buf,Math.floor(e*(1/4294967296)),this.pos+4),this.pos+=8},writeSFixed64:function(e){this.realloc(8),Gr(this.buf,-1&e,this.pos),Gr(this.buf,Math.floor(e*(1/4294967296)),this.pos+4),this.pos+=8},writeVarint:function(e){(e=+e||0)>268435455||e<0?function(t,r){var c,v;if(t>=0?(c=t%4294967296|0,v=t/4294967296|0):(v=~(-t/4294967296),4294967295^(c=~(-t%4294967296))?c=c+1|0:(c=0,v=v+1|0)),t>=18446744073709552e3||t<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");r.realloc(10),function(m,_,C){C.buf[C.pos++]=127&m|128,m>>>=7,C.buf[C.pos++]=127&m|128,m>>>=7,C.buf[C.pos++]=127&m|128,m>>>=7,C.buf[C.pos++]=127&m|128,C.buf[C.pos]=127&(m>>>=7)}(c,0,r),function(m,_){var C=(7&m)<<4;_.buf[_.pos++]|=C|((m>>>=3)?128:0),m&&(_.buf[_.pos++]=127&m|((m>>>=7)?128:0),m&&(_.buf[_.pos++]=127&m|((m>>>=7)?128:0),m&&(_.buf[_.pos++]=127&m|((m>>>=7)?128:0),m&&(_.buf[_.pos++]=127&m|((m>>>=7)?128:0),m&&(_.buf[_.pos++]=127&m)))))}(v,r)}(e,this):(this.realloc(4),this.buf[this.pos++]=127&e|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=e>>>7&127))))},writeSVarint:function(e){this.writeVarint(e<0?2*-e-1:2*e)},writeBoolean:function(e){this.writeVarint(Boolean(e))},writeString:function(e){e=String(e),this.realloc(4*e.length),this.pos++;var t=this.pos;this.pos=function(c,v,m){for(var _,C,k=0;k<v.length;k++){if((_=v.charCodeAt(k))>55295&&_<57344){if(!C){_>56319||k+1===v.length?(c[m++]=239,c[m++]=191,c[m++]=189):C=_;continue}if(_<56320){c[m++]=239,c[m++]=191,c[m++]=189,C=_;continue}_=C-55296<<10|_-56320|65536,C=null}else C&&(c[m++]=239,c[m++]=191,c[m++]=189,C=null);_<128?c[m++]=_:(_<2048?c[m++]=_>>6|192:(_<65536?c[m++]=_>>12|224:(c[m++]=_>>18|240,c[m++]=_>>12&63|128),c[m++]=_>>6&63|128),c[m++]=63&_|128)}return m}(this.buf,e,this.pos);var r=this.pos-t;r>=128&&pr(t,r,this),this.pos=t-1,this.writeVarint(r),this.pos+=r},writeFloat:function(e){this.realloc(4),j(this.buf,e,this.pos,!0,23,4),this.pos+=4},writeDouble:function(e){this.realloc(8),j(this.buf,e,this.pos,!0,52,8),this.pos+=8},writeBytes:function(e){var t=e.length;this.writeVarint(t),this.realloc(t);for(var r=0;r<t;r++)this.buf[this.pos++]=e[r]},writeRawMessage:function(e,t){this.pos++;var r=this.pos;e(t,this);var c=this.pos-r;c>=128&&pr(r,c,this),this.pos=r-1,this.writeVarint(c),this.pos+=c},writeMessage:function(e,t,r){this.writeTag(e,ke.Bytes),this.writeRawMessage(t,r)},writePackedVarint:function(e,t){t.length&&this.writeMessage(e,Zr,t)},writePackedSVarint:function(e,t){t.length&&this.writeMessage(e,Wr,t)},writePackedBoolean:function(e,t){t.length&&this.writeMessage(e,an,t)},writePackedFloat:function(e,t){t.length&&this.writeMessage(e,en,t)},writePackedDouble:function(e,t){t.length&&this.writeMessage(e,Kr,t)},writePackedFixed32:function(e,t){t.length&&this.writeMessage(e,fn,t)},writePackedSFixed32:function(e,t){t.length&&this.writeMessage(e,Vr,t)},writePackedFixed64:function(e,t){t.length&&this.writeMessage(e,on,t)},writePackedSFixed64:function(e,t){t.length&&this.writeMessage(e,zt,t)},writeBytesField:function(e,t){this.writeTag(e,ke.Bytes),this.writeBytes(t)},writeFixed32Field:function(e,t){this.writeTag(e,ke.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(e,t){this.writeTag(e,ke.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(e,t){this.writeTag(e,ke.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(e,t){this.writeTag(e,ke.Fixed64),this.writeSFixed64(t)},writeVarintField:function(e,t){this.writeTag(e,ke.Varint),this.writeVarint(t)},writeSVarintField:function(e,t){this.writeTag(e,ke.Varint),this.writeSVarint(t)},writeStringField:function(e,t){this.writeTag(e,ke.Bytes),this.writeString(t)},writeFloatField:function(e,t){this.writeTag(e,ke.Fixed32),this.writeFloat(t)},writeDoubleField:function(e,t){this.writeTag(e,ke.Fixed64),this.writeDouble(t)},writeBooleanField:function(e,t){this.writeVarintField(e,Boolean(t))}};var Rr=function(e,t){var r=t.pixelRatio,c=t.version,v=t.stretchX,m=t.stretchY,_=t.content;this.paddedRect=e,this.pixelRatio=r,this.stretchX=v,this.stretchY=m,this.content=_,this.version=c},nn={tl:{configurable:!0},br:{configurable:!0},tlbr:{configurable:!0},displaySize:{configurable:!0}};nn.tl.get=function(){return[this.paddedRect.x+1,this.paddedRect.y+1]},nn.br.get=function(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]},nn.tlbr.get=function(){return this.tl.concat(this.br)},nn.displaySize.get=function(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]},Object.defineProperties(Rr.prototype,nn);var Kn=function(e,t){var r={},c={};this.haveRenderCallbacks=[];var v=[];this.addImages(e,r,v),this.addImages(t,c,v);var m=sn(v),_=new ga({width:m.w||1,height:m.h||1});for(var C in e){var k=e[C],B=r[C].paddedRect;ga.copy(k.data,_,{x:0,y:0},{x:B.x+1,y:B.y+1},k.data)}for(var W in t){var K=t[W],oe=c[W].paddedRect,ce=oe.x+1,Ve=oe.y+1,We=K.data.width,st=K.data.height;ga.copy(K.data,_,{x:0,y:0},{x:ce,y:Ve},K.data),ga.copy(K.data,_,{x:0,y:st-1},{x:ce,y:Ve-1},{width:We,height:1}),ga.copy(K.data,_,{x:0,y:0},{x:ce,y:Ve+st},{width:We,height:1}),ga.copy(K.data,_,{x:We-1,y:0},{x:ce-1,y:Ve},{width:1,height:st}),ga.copy(K.data,_,{x:0,y:0},{x:ce+We,y:Ve},{width:1,height:st})}this.image=_,this.iconPositions=r,this.patternPositions=c};Kn.prototype.addImages=function(e,t,r){for(var c in e){var v=e[c],m={x:0,y:0,w:v.data.width+2,h:v.data.height+2};r.push(m),t[c]=new Rr(m,v),v.hasRenderCallback&&this.haveRenderCallbacks.push(c)}},Kn.prototype.patchUpdatedImages=function(e,t){for(var r in e.dispatchRenderCallbacks(this.haveRenderCallbacks),e.updatedImages)this.patchUpdatedImage(this.iconPositions[r],e.getImage(r),t),this.patchUpdatedImage(this.patternPositions[r],e.getImage(r),t)},Kn.prototype.patchUpdatedImage=function(e,t,r){if(e&&t&&e.version!==t.version){e.version=t.version;var c=e.tl;r.update(t.data,void 0,{x:c[0],y:c[1]})}},Tn("ImagePosition",Rr),Tn("ImageAtlas",Kn);var Yn={horizontal:1,vertical:2,horizontalOnly:3},un=function(){this.scale=1,this.fontStack="",this.imageName=null};un.forText=function(e,t){var r=new un;return r.scale=e||1,r.fontStack=t,r},un.forImage=function(e){var t=new un;return t.imageName=e,t};var kr=function(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null};function Or(e,t,r,c,v,m,_,C,k,B,W,K,oe,ce,Ve,We){var st,et=kr.fromFeature(e,v);K===Yn.vertical&&et.verticalizePunctuation();var Tt=Qs.processBidirectionalText,Ut=Qs.processStyledBidirectionalText;if(Tt&&et.sections.length===1){st=[];for(var nr=0,hr=Tt(et.toString(),na(et,B,m,t,c,ce,Ve));nr<hr.length;nr+=1){var Mr=hr[nr],Yr=new kr;Yr.text=Mr,Yr.sections=et.sections;for(var hn=0;hn<Mr.length;hn++)Yr.sectionIndex.push(0);st.push(Yr)}}else if(Ut){st=[];for(var Hn=0,wn=Ut(et.text,et.sectionIndex,na(et,B,m,t,c,ce,Ve));Hn<wn.length;Hn+=1){var Jn=wn[Hn],yn=new kr;yn.text=Jn[0],yn.sectionIndex=Jn[1],yn.sections=et.sections,st.push(yn)}}else st=function(Zn,ea){for(var zi=[],ca=Zn.text,ei=0,wa=0,To=ea;wa<To.length;wa+=1){var Oo=To[wa];zi.push(Zn.substring(ei,Oo)),ei=Oo}return ei<ca.length&&zi.push(Zn.substring(ei,ca.length)),zi}(et,na(et,B,m,t,c,ce,Ve));var Ui=[],hi={positionedLines:Ui,text:et.toString(),top:W[1],bottom:W[1],left:W[0],right:W[0],writingMode:K,iconsInText:!1,verticalizable:!1};return function(Zn,ea,zi,ca,ei,wa,To,Oo,xo,Ao,Lo,As){for(var zs=0,ou=-17,Ns=0,Du=0,Ho=Oo==="right"?1:Oo==="left"?0:.5,Bs=0,aa=0,Ia=ei;aa<Ia.length;aa+=1){var Fa=Ia[aa];Fa.trim();var va=Fa.getMaxScale(),ys=24*(va-1),Hs={positionedGlyphs:[],lineOffset:0};Zn.positionedLines[Bs]=Hs;var Ha=Hs.positionedGlyphs,cs=0;if(Fa.length()){for(var su=0;su<Fa.length();su++){var oa=Fa.getSection(su),Wc=Fa.getSectionIndex(su),Cl=Fa.getCharCode(su),of=0,fs=null,sf=null,Ec=null,Eh=24,nh=!(xo===Yn.horizontal||!Lo&&!pc(Cl)||Lo&&(ui[Cl]||(wc=Cl,Jr.Arabic(wc)||Jr["Arabic Supplement"](wc)||Jr["Arabic Extended-A"](wc)||Jr["Arabic Presentation Forms-A"](wc)||Jr["Arabic Presentation Forms-B"](wc))));if(oa.imageName){var wh=ca[oa.imageName];if(!wh)continue;Ec=oa.imageName,Zn.iconsInText=Zn.iconsInText||!0,sf=wh.paddedRect;var Xc=wh.displaySize;oa.scale=24*oa.scale/As,of=ys+(24-Xc[1]*oa.scale),Eh=(fs={width:Xc[0],height:Xc[1],left:1,top:-3,advance:nh?Xc[1]:Xc[0]}).advance;var Nf=nh?Xc[0]*oa.scale-24*va:Xc[1]*oa.scale-24*va;Nf>0&&Nf>cs&&(cs=Nf)}else{var Ep=zi[oa.fontStack],Mf=Ep&&Ep[Cl];if(Mf&&Mf.rect)sf=Mf.rect,fs=Mf.metrics;else{var uf=ea[oa.fontStack],wp=uf&&uf[Cl];if(!wp)continue;fs=wp.metrics}of=24*(va-oa.scale)}nh?(Zn.verticalizable=!0,Ha.push({glyph:Cl,imageName:Ec,x:zs,y:ou+of,vertical:nh,scale:oa.scale,fontStack:oa.fontStack,sectionIndex:Wc,metrics:fs,rect:sf}),zs+=Eh*oa.scale+Ao):(Ha.push({glyph:Cl,imageName:Ec,x:zs,y:ou+of,vertical:nh,scale:oa.scale,fontStack:oa.fontStack,sectionIndex:Wc,metrics:fs,rect:sf}),zs+=fs.advance*oa.scale+Ao)}Ha.length!==0&&(Ns=Math.max(zs-Ao,Ns),Rs(Ha,0,Ha.length-1,Ho,cs)),zs=0;var ih=wa*va+cs;Hs.lineOffset=Math.max(cs,ys),ou+=ih,Du=Math.max(ih,Du),++Bs}else ou+=wa,++Bs}var wc,lf=ou- -17,ah=Qo(To),cf=ah.horizontalAlign,_s=ah.verticalAlign;(function($h,Jh,Oa,Th,If,ff,Ah,Ch,Qh){var oh,qh=(Jh-Oa)*If;oh=ff!==Ah?-Ch*Th- -17:(-Th*Qh+.5)*Ah;for(var Bf=0,sh=$h;Bf<sh.length;Bf+=1)for(var Uf=0,Ph=sh[Bf].positionedGlyphs;Uf<Ph.length;Uf+=1){var uh=Ph[Uf];uh.x+=qh,uh.y+=oh}})(Zn.positionedLines,Ho,cf,_s,Ns,Du,wa,lf,ei.length),Zn.top+=-_s*lf,Zn.bottom=Zn.top+lf,Zn.left+=-cf*Ns,Zn.right=Zn.left+Ns}(hi,t,r,c,st,_,C,k,K,B,oe,We),!function(Zn){for(var ea=0,zi=Zn;ea<zi.length;ea+=1)if(zi[ea].positionedGlyphs.length!==0)return!1;return!0}(Ui)&&hi}kr.fromFeature=function(e,t){for(var r=new kr,c=0;c<e.sections.length;c++){var v=e.sections[c];v.image?r.addImageSection(v):r.addTextSection(v,t)}return r},kr.prototype.length=function(){return this.text.length},kr.prototype.getSection=function(e){return this.sections[this.sectionIndex[e]]},kr.prototype.getSectionIndex=function(e){return this.sectionIndex[e]},kr.prototype.getCharCode=function(e){return this.text.charCodeAt(e)},kr.prototype.verticalizePunctuation=function(){this.text=function(e){for(var t="",r=0;r<e.length;r++){var c=e.charCodeAt(r+1)||null,v=e.charCodeAt(r-1)||null;t+=c&&tl(c)&&!Ef[e[r+1]]||v&&tl(v)&&!Ef[e[r-1]]||!Ef[e[r]]?e[r]:Ef[e[r]]}return t}(this.text)},kr.prototype.trim=function(){for(var e=0,t=0;t<this.text.length&&ui[this.text.charCodeAt(t)];t++)e++;for(var r=this.text.length,c=this.text.length-1;c>=0&&c>=e&&ui[this.text.charCodeAt(c)];c--)r--;this.text=this.text.substring(e,r),this.sectionIndex=this.sectionIndex.slice(e,r)},kr.prototype.substring=function(e,t){var r=new kr;return r.text=this.text.substring(e,t),r.sectionIndex=this.sectionIndex.slice(e,t),r.sections=this.sections,r},kr.prototype.toString=function(){return this.text},kr.prototype.getMaxScale=function(){var e=this;return this.sectionIndex.reduce(function(t,r){return Math.max(t,e.sections[r].scale)},0)},kr.prototype.addTextSection=function(e,t){this.text+=e.text,this.sections.push(un.forText(e.scale,e.fontStack||t));for(var r=this.sections.length-1,c=0;c<e.text.length;++c)this.sectionIndex.push(r)},kr.prototype.addImageSection=function(e){var t=e.image?e.image.name:"";if(t.length!==0){var r=this.getNextImageSectionCharCode();r?(this.text+=String.fromCharCode(r),this.sections.push(un.forImage(t)),this.sectionIndex.push(this.sections.length-1)):Ne("Reached maximum number of images 6401")}else Ne("Can't add FormattedSection with an empty image.")},kr.prototype.getNextImageSectionCharCode=function(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)};var ui={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},qn={};function Ln(e,t,r,c,v,m){if(t.imageName){var _=c[t.imageName];return _?_.displaySize[0]*t.scale*24/m+v:0}var C=r[t.fontStack],k=C&&C[e];return k?k.metrics.advance*t.scale+v:0}function Bi(e,t,r,c){var v=Math.pow(e-t,2);return c?e<t?v/2:2*v:v+Math.abs(r)*r}function Ai(e,t,r){var c=0;return e===10&&(c-=1e4),r&&(c+=150),e!==40&&e!==65288||(c+=50),t!==41&&t!==65289||(c+=50),c}function Mi(e,t,r,c,v,m){for(var _=null,C=Bi(t,r,v,m),k=0,B=c;k<B.length;k+=1){var W=B[k],K=Bi(t-W.x,r,v,m)+W.badness;K<=C&&(_=W,C=K)}return{index:e,x:t,priorBreak:_,badness:C}}function na(e,t,r,c,v,m,_){if(m!=="point")return[];if(!e)return[];for(var C,k=[],B=function(st,et,Tt,Ut,nr,hr){for(var Mr=0,Yr=0;Yr<st.length();Yr++){var hn=st.getSection(Yr);Mr+=Ln(st.getCharCode(Yr),hn,Ut,nr,et,hr)}return Mr/Math.max(1,Math.ceil(Mr/Tt))}(e,t,r,c,v,_),W=e.text.indexOf("\u200B")>=0,K=0,oe=0;oe<e.length();oe++){var ce=e.getSection(oe),Ve=e.getCharCode(oe);if(ui[Ve]||(K+=Ln(Ve,ce,c,v,t,_)),oe<e.length()-1){var We=!((C=Ve)<11904||!(Jr["Bopomofo Extended"](C)||Jr.Bopomofo(C)||Jr["CJK Compatibility Forms"](C)||Jr["CJK Compatibility Ideographs"](C)||Jr["CJK Compatibility"](C)||Jr["CJK Radicals Supplement"](C)||Jr["CJK Strokes"](C)||Jr["CJK Symbols and Punctuation"](C)||Jr["CJK Unified Ideographs Extension A"](C)||Jr["CJK Unified Ideographs"](C)||Jr["Enclosed CJK Letters and Months"](C)||Jr["Halfwidth and Fullwidth Forms"](C)||Jr.Hiragana(C)||Jr["Ideographic Description Characters"](C)||Jr["Kangxi Radicals"](C)||Jr["Katakana Phonetic Extensions"](C)||Jr.Katakana(C)||Jr["Vertical Forms"](C)||Jr["Yi Radicals"](C)||Jr["Yi Syllables"](C)));(qn[Ve]||We||ce.imageName)&&k.push(Mi(oe+1,K,B,k,Ai(Ve,e.getCharCode(oe+1),We&&W),!1))}}return function st(et){return et?st(et.priorBreak).concat(et.index):[]}(Mi(e.length(),K,B,k,0,!0))}function Qo(e){var t=.5,r=.5;switch(e){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(e){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:t,verticalAlign:r}}function Rs(e,t,r,c,v){if(c||v)for(var m=e[r],_=(e[r].x+m.metrics.advance*m.scale)*c,C=t;C<=r;C++)e[C].x-=_,e[C].y+=v}function Qi(e,t,r,c,v,m){var _,C=e.image;if(C.content){var k=C.content,B=C.pixelRatio||1;_=[k[0]/B,k[1]/B,C.displaySize[0]-k[2]/B,C.displaySize[1]-k[3]/B]}var W,K,oe,ce,Ve=t.left*m,We=t.right*m;r==="width"||r==="both"?(ce=v[0]+Ve-c[3],K=v[0]+We+c[1]):K=(ce=v[0]+(Ve+We-C.displaySize[0])/2)+C.displaySize[0];var st=t.top*m,et=t.bottom*m;return r==="height"||r==="both"?(W=v[1]+st-c[0],oe=v[1]+et+c[2]):oe=(W=v[1]+(st+et-C.displaySize[1])/2)+C.displaySize[1],{image:C,top:W,right:K,bottom:oe,left:ce,collisionPadding:_}}qn[10]=!0,qn[32]=!0,qn[38]=!0,qn[40]=!0,qn[41]=!0,qn[43]=!0,qn[45]=!0,qn[47]=!0,qn[173]=!0,qn[183]=!0,qn[8203]=!0,qn[8208]=!0,qn[8211]=!0,qn[8231]=!0;var Eo=function(e){function t(r,c,v,m){e.call(this,r,c),this.angle=v,m!==void 0&&(this.segment=m)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.clone=function(){return new t(this.x,this.y,this.angle,this.segment)},t}(Y);function ua(e,t){var r=t.expression;if(r.kind==="constant")return{kind:"constant",layoutSize:r.evaluate(new Fi(e+1))};if(r.kind==="source")return{kind:"source"};for(var c=r.zoomStops,v=r.interpolationType,m=0;m<c.length&&c[m]<=e;)m++;for(var _=m=Math.max(0,m-1);_<c.length&&c[_]<e+1;)_++;_=Math.min(c.length-1,_);var C=c[m],k=c[_];return r.kind==="composite"?{kind:"composite",minZoom:C,maxZoom:k,interpolationType:v}:{kind:"camera",minZoom:C,maxZoom:k,minSize:r.evaluate(new Fi(C)),maxSize:r.evaluate(new Fi(k)),interpolationType:v}}function wo(e,t,r){var c=t.uSize,v=r.lowerSize;return e.kind==="source"?v/128:e.kind==="composite"?Nn(v/128,r.upperSize/128,t.uSizeT):c}function qo(e,t){var r=0,c=0;if(e.kind==="constant")c=e.layoutSize;else if(e.kind!=="source"){var v=e.interpolationType,m=v?$t(bi.interpolationFactor(v,t,e.minZoom,e.maxZoom),0,1):0;e.kind==="camera"?c=Nn(e.minSize,e.maxSize,m):r=m}return{uSizeT:r,uSize:c}}Tn("Anchor",Eo);var es=Object.freeze({__proto__:null,getSizeData:ua,evaluateSizeForFeature:wo,evaluateSizeForZoom:qo,SIZE_PACK_FACTOR:128});function Ds(e,t,r,c,v){if(t.segment===void 0)return!0;for(var m=t,_=t.segment+1,C=0;C>-r/2;){if(--_<0)return!1;C-=e[_].dist(m),m=e[_]}C+=e[_].dist(e[_+1]),_++;for(var k=[],B=0;C<r/2;){var W=e[_],K=e[_+1];if(!K)return!1;var oe=e[_-1].angleTo(W)-W.angleTo(K);for(oe=Math.abs((oe+3*Math.PI)%(2*Math.PI)-Math.PI),k.push({distance:C,angleDelta:oe}),B+=oe;C-k[0].distance>c;)B-=k.shift().angleDelta;if(B>v)return!1;_++,C+=W.dist(K)}return!0}function ks(e){for(var t=0,r=0;r<e.length-1;r++)t+=e[r].dist(e[r+1]);return t}function Zo(e,t,r){return e?.6*t*r:0}function Ii(e,t){return Math.max(e?e.right-e.left:0,t?t.right-t.left:0)}function Fs(e,t,r,c,v,m){for(var _=Zo(r,v,m),C=Ii(r,c)*m,k=0,B=ks(e)/2,W=0;W<e.length-1;W++){var K=e[W],oe=e[W+1],ce=K.dist(oe);if(k+ce>B){var Ve=(B-k)/ce,We=Nn(K.x,oe.x,Ve),st=Nn(K.y,oe.y,Ve),et=new Eo(We,st,oe.angleTo(K),W);return et._round(),!_||Ds(e,et,C,_,t)?et:void 0}k+=ce}}function la(e,t,r,c,v,m,_,C,k){var B=Zo(c,m,_),W=Ii(c,v),K=W*_,oe=e[0].x===0||e[0].x===k||e[0].y===0||e[0].y===k;return t-K<t/4&&(t=K+t/4),function ce(Ve,We,st,et,Tt,Ut,nr,hr,Mr){for(var Yr=Ut/2,hn=ks(Ve),Hn=0,wn=We-st,Jn=[],yn=0;yn<Ve.length-1;yn++){for(var Ui=Ve[yn],hi=Ve[yn+1],Zn=Ui.dist(hi),ea=hi.angleTo(Ui);wn+st<Hn+Zn;){var zi=((wn+=st)-Hn)/Zn,ca=Nn(Ui.x,hi.x,zi),ei=Nn(Ui.y,hi.y,zi);if(ca>=0&&ca<Mr&&ei>=0&&ei<Mr&&wn-Yr>=0&&wn+Yr<=hn){var wa=new Eo(ca,ei,ea,yn);wa._round(),et&&!Ds(Ve,wa,Ut,et,Tt)||Jn.push(wa)}}Hn+=Zn}return hr||Jn.length||nr||(Jn=ce(Ve,Hn/2,st,et,Tt,Ut,nr,!0,Mr)),Jn}(e,oe?t/2*C%t:(W/2+2*m)*_*C%t,t,B,r,K,oe,!1,k)}function $n(e,t,r,c,v){for(var m=[],_=0;_<e.length;_++)for(var C=e[_],k=void 0,B=0;B<C.length-1;B++){var W=C[B],K=C[B+1];W.x<t&&K.x<t||(W.x<t?W=new Y(t,W.y+(t-W.x)/(K.x-W.x)*(K.y-W.y))._round():K.x<t&&(K=new Y(t,W.y+(t-W.x)/(K.x-W.x)*(K.y-W.y))._round()),W.y<r&&K.y<r||(W.y<r?W=new Y(W.x+(r-W.y)/(K.y-W.y)*(K.x-W.x),r)._round():K.y<r&&(K=new Y(W.x+(r-W.y)/(K.y-W.y)*(K.x-W.x),r)._round()),W.x>=c&&K.x>=c||(W.x>=c?W=new Y(c,W.y+(c-W.x)/(K.x-W.x)*(K.y-W.y))._round():K.x>=c&&(K=new Y(c,W.y+(c-W.x)/(K.x-W.x)*(K.y-W.y))._round()),W.y>=v&&K.y>=v||(W.y>=v?W=new Y(W.x+(v-W.y)/(K.y-W.y)*(K.x-W.x),v)._round():K.y>=v&&(K=new Y(W.x+(v-W.y)/(K.y-W.y)*(K.x-W.x),v)._round()),k&&W.equals(k[k.length-1])||m.push(k=[W]),k.push(K)))))}return m}function Hi(e,t,r,c){var v=[],m=e.image,_=m.pixelRatio,C=m.paddedRect.w-2,k=m.paddedRect.h-2,B=e.right-e.left,W=e.bottom-e.top,K=m.stretchX||[[0,C]],oe=m.stretchY||[[0,k]],ce=function(ca,ei){return ca+ei[1]-ei[0]},Ve=K.reduce(ce,0),We=oe.reduce(ce,0),st=C-Ve,et=k-We,Tt=0,Ut=Ve,nr=0,hr=We,Mr=0,Yr=st,hn=0,Hn=et;if(m.content&&c){var wn=m.content;Tt=ia(K,0,wn[0]),nr=ia(oe,0,wn[1]),Ut=ia(K,wn[0],wn[2]),hr=ia(oe,wn[1],wn[3]),Mr=wn[0]-Tt,hn=wn[1]-nr,Yr=wn[2]-wn[0]-Ut,Hn=wn[3]-wn[1]-hr}var Jn=function(ca,ei,wa,To){var Oo=yu(ca.stretch-Tt,Ut,B,e.left),xo=_u(ca.fixed-Mr,Yr,ca.stretch,Ve),Ao=yu(ei.stretch-nr,hr,W,e.top),Lo=_u(ei.fixed-hn,Hn,ei.stretch,We),As=yu(wa.stretch-Tt,Ut,B,e.left),zs=_u(wa.fixed-Mr,Yr,wa.stretch,Ve),ou=yu(To.stretch-nr,hr,W,e.top),Ns=_u(To.fixed-hn,Hn,To.stretch,We),Du=new Y(Oo,Ao),Ho=new Y(As,Ao),Bs=new Y(As,ou),aa=new Y(Oo,ou),Ia=new Y(xo/_,Lo/_),Fa=new Y(zs/_,Ns/_),va=t*Math.PI/180;if(va){var ys=Math.sin(va),Hs=Math.cos(va),Ha=[Hs,-ys,ys,Hs];Du._matMult(Ha),Ho._matMult(Ha),aa._matMult(Ha),Bs._matMult(Ha)}var cs=ca.stretch+ca.fixed,su=ei.stretch+ei.fixed;return{tl:Du,tr:Ho,bl:aa,br:Bs,tex:{x:m.paddedRect.x+1+cs,y:m.paddedRect.y+1+su,w:wa.stretch+wa.fixed-cs,h:To.stretch+To.fixed-su},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Ia,pixelOffsetBR:Fa,minFontScaleX:Yr/_/B,minFontScaleY:Hn/_/W,isSDF:r}};if(c&&(m.stretchX||m.stretchY))for(var yn=Io(K,st,Ve),Ui=Io(oe,et,We),hi=0;hi<yn.length-1;hi++)for(var Zn=yn[hi],ea=yn[hi+1],zi=0;zi<Ui.length-1;zi++)v.push(Jn(Zn,Ui[zi],ea,Ui[zi+1]));else v.push(Jn({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:C+1},{fixed:0,stretch:k+1}));return v}function ia(e,t,r){for(var c=0,v=0,m=e;v<m.length;v+=1){var _=m[v];c+=Math.max(t,Math.min(r,_[1]))-Math.max(t,Math.min(r,_[0]))}return c}function Io(e,t,r){for(var c=[{fixed:-1,stretch:0}],v=0,m=e;v<m.length;v+=1){var _=m[v],C=_[0],k=_[1],B=c[c.length-1];c.push({fixed:C-B.stretch,stretch:B.stretch}),c.push({fixed:C-B.stretch,stretch:B.stretch+(k-C)})}return c.push({fixed:t+1,stretch:r}),c}function yu(e,t,r,c){return e/t*r+c}function _u(e,t,r,c){return e-t*r/c}var Fe=function(e,t,r,c,v,m,_,C,k,B){if(this.boxStartIndex=e.length,k){var W=m.top,K=m.bottom,oe=m.collisionPadding;oe&&(W-=oe[1],K+=oe[3]);var ce=K-W;ce>0&&(ce=Math.max(10,ce),this.circleDiameter=ce)}else{var Ve=m.top*_-C,We=m.bottom*_+C,st=m.left*_-C,et=m.right*_+C,Tt=m.collisionPadding;if(Tt&&(st-=Tt[0]*_,Ve-=Tt[1]*_,et+=Tt[2]*_,We+=Tt[3]*_),B){var Ut=new Y(st,Ve),nr=new Y(et,Ve),hr=new Y(st,We),Mr=new Y(et,We),Yr=B*Math.PI/180;Ut._rotate(Yr),nr._rotate(Yr),hr._rotate(Yr),Mr._rotate(Yr),st=Math.min(Ut.x,nr.x,hr.x,Mr.x),et=Math.max(Ut.x,nr.x,hr.x,Mr.x),Ve=Math.min(Ut.y,nr.y,hr.y,Mr.y),We=Math.max(Ut.y,nr.y,hr.y,Mr.y)}e.emplaceBack(t.x,t.y,st,Ve,et,We,r,c,v)}this.boxEndIndex=e.length},er=function(e,t){if(e===void 0&&(e=[]),t===void 0&&(t=Wt),this.data=e,this.length=this.data.length,this.compare=t,this.length>0)for(var r=(this.length>>1)-1;r>=0;r--)this._down(r)};function Wt(e,t){return e<t?-1:e>t?1:0}function An(e,t,r){t===void 0&&(t=1),r===void 0&&(r=!1);for(var c=1/0,v=1/0,m=-1/0,_=-1/0,C=e[0],k=0;k<C.length;k++){var B=C[k];(!k||B.x<c)&&(c=B.x),(!k||B.y<v)&&(v=B.y),(!k||B.x>m)&&(m=B.x),(!k||B.y>_)&&(_=B.y)}var W=Math.min(m-c,_-v),K=W/2,oe=new er([],Vi);if(W===0)return new Y(c,v);for(var ce=c;ce<m;ce+=W)for(var Ve=v;Ve<_;Ve+=W)oe.push(new Oe(ce+K,Ve+K,K,e));for(var We=function(Tt){for(var Ut=0,nr=0,hr=0,Mr=Tt[0],Yr=0,hn=Mr.length,Hn=hn-1;Yr<hn;Hn=Yr++){var wn=Mr[Yr],Jn=Mr[Hn],yn=wn.x*Jn.y-Jn.x*wn.y;nr+=(wn.x+Jn.x)*yn,hr+=(wn.y+Jn.y)*yn,Ut+=3*yn}return new Oe(nr/Ut,hr/Ut,0,Tt)}(e),st=oe.length;oe.length;){var et=oe.pop();(et.d>We.d||!We.d)&&(We=et,r&&console.log("found best %d after %d probes",Math.round(1e4*et.d)/1e4,st)),et.max-We.d<=t||(oe.push(new Oe(et.p.x-(K=et.h/2),et.p.y-K,K,e)),oe.push(new Oe(et.p.x+K,et.p.y-K,K,e)),oe.push(new Oe(et.p.x-K,et.p.y+K,K,e)),oe.push(new Oe(et.p.x+K,et.p.y+K,K,e)),st+=4)}return r&&(console.log("num probes: "+st),console.log("best distance: "+We.d)),We.p}function Vi(e,t){return t.max-e.max}function Oe(e,t,r,c){this.p=new Y(e,t),this.h=r,this.d=function(v,m){for(var _=!1,C=1/0,k=0;k<m.length;k++)for(var B=m[k],W=0,K=B.length,oe=K-1;W<K;oe=W++){var ce=B[W],Ve=B[oe];ce.y>v.y!=Ve.y>v.y&&v.x<(Ve.x-ce.x)*(v.y-ce.y)/(Ve.y-ce.y)+ce.x&&(_=!_),C=Math.min(C,Vu(v,ce,Ve))}return(_?1:-1)*Math.sqrt(C)}(this.p,c),this.max=this.d+this.h*Math.SQRT2}er.prototype.push=function(e){this.data.push(e),this.length++,this._up(this.length-1)},er.prototype.pop=function(){if(this.length!==0){var e=this.data[0],t=this.data.pop();return this.length--,this.length>0&&(this.data[0]=t,this._down(0)),e}},er.prototype.peek=function(){return this.data[0]},er.prototype._up=function(e){for(var t=this.data,r=this.compare,c=t[e];e>0;){var v=e-1>>1,m=t[v];if(r(c,m)>=0)break;t[e]=m,e=v}t[e]=c},er.prototype._down=function(e){for(var t=this.data,r=this.compare,c=this.length>>1,v=t[e];e<c;){var m=1+(e<<1),_=t[m],C=m+1;if(C<this.length&&r(t[C],_)<0&&(m=C,_=t[C]),r(_,v)>=0)break;t[e]=_,e=m}t[e]=v};var _e=Number.POSITIVE_INFINITY;function at(e,t){return t[1]!==_e?function(r,c,v){var m=0,_=0;switch(c=Math.abs(c),v=Math.abs(v),r){case"top-right":case"top-left":case"top":_=v-7;break;case"bottom-right":case"bottom-left":case"bottom":_=7-v}switch(r){case"top-right":case"bottom-right":case"right":m=-c;break;case"top-left":case"bottom-left":case"left":m=c}return[m,_]}(e,t[0],t[1]):function(r,c){var v=0,m=0;c<0&&(c=0);var _=c/Math.sqrt(2);switch(r){case"top-right":case"top-left":m=_-7;break;case"bottom-right":case"bottom-left":m=7-_;break;case"bottom":m=7-c;break;case"top":m=c-7}switch(r){case"top-right":case"bottom-right":v=-_;break;case"top-left":case"bottom-left":v=_;break;case"left":v=c;break;case"right":v=-c}return[v,m]}(e,t[0])}function Ot(e){switch(e){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function kt(e,t,r,c,v,m,_,C,k,B,W,K,oe,ce,Ve){var We=function(nr,hr,Mr,Yr,hn,Hn,wn,Jn){for(var yn=Yr.layout.get("text-rotate").evaluate(Hn,{})*Math.PI/180,Ui=[],hi=0,Zn=hr.positionedLines;hi<Zn.length;hi+=1)for(var ea=Zn[hi],zi=0,ca=ea.positionedGlyphs;zi<ca.length;zi+=1){var ei=ca[zi];if(ei.rect){var wa=ei.rect||{},To=4,Oo=!0,xo=1,Ao=0,Lo=(hn||Jn)&&ei.vertical,As=ei.metrics.advance*ei.scale/2;if(Jn&&hr.verticalizable&&(Ao=ea.lineOffset/2-(ei.imageName?-(24-ei.metrics.width*ei.scale)/2:24*(ei.scale-1))),ei.imageName){var zs=wn[ei.imageName];Oo=zs.sdf,To=1/(xo=zs.pixelRatio)}var ou=hn?[ei.x+As,ei.y]:[0,0],Ns=hn?[0,0]:[ei.x+As+Mr[0],ei.y+Mr[1]-Ao],Du=[0,0];Lo&&(Du=Ns,Ns=[0,0]);var Ho=(ei.metrics.left-To)*ei.scale-As+Ns[0],Bs=(-ei.metrics.top-To)*ei.scale+Ns[1],aa=Ho+wa.w*ei.scale/xo,Ia=Bs+wa.h*ei.scale/xo,Fa=new Y(Ho,Bs),va=new Y(aa,Bs),ys=new Y(Ho,Ia),Hs=new Y(aa,Ia);if(Lo){var Ha=new Y(-As,As- -17),cs=-Math.PI/2,su=12-As,oa=new Y(22-su,-(ei.imageName?su:0)),Wc=new(Function.prototype.bind.apply(Y,[null].concat(Du)));Fa._rotateAround(cs,Ha)._add(oa)._add(Wc),va._rotateAround(cs,Ha)._add(oa)._add(Wc),ys._rotateAround(cs,Ha)._add(oa)._add(Wc),Hs._rotateAround(cs,Ha)._add(oa)._add(Wc)}if(yn){var Cl=Math.sin(yn),of=Math.cos(yn),fs=[of,-Cl,Cl,of];Fa._matMult(fs),va._matMult(fs),ys._matMult(fs),Hs._matMult(fs)}var sf=new Y(0,0),Ec=new Y(0,0);Ui.push({tl:Fa,tr:va,bl:ys,br:Hs,tex:wa,writingMode:hr.writingMode,glyphOffset:ou,sectionIndex:ei.sectionIndex,isSDF:Oo,pixelOffsetTL:sf,pixelOffsetBR:Ec,minFontScaleX:0,minFontScaleY:0})}}return Ui}(0,r,C,v,m,_,c,e.allowVerticalPlacement),st=e.textSizeData,et=null;st.kind==="source"?(et=[128*v.layout.get("text-size").evaluate(_,{})])[0]>32640&&Ne(e.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'):st.kind==="composite"&&((et=[128*ce.compositeTextSizes[0].evaluate(_,{},Ve),128*ce.compositeTextSizes[1].evaluate(_,{},Ve)])[0]>32640||et[1]>32640)&&Ne(e.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'),e.addSymbols(e.text,We,et,C,m,_,B,t,k.lineStartIndex,k.lineLength,oe,Ve);for(var Tt=0,Ut=W;Tt<Ut.length;Tt+=1)K[Ut[Tt]]=e.text.placedSymbolArray.length-1;return 4*We.length}function ft(e){for(var t in e)return e[t];return null}function ot(e,t,r,c){var v=e.compareText;if(t in v){for(var m=v[t],_=m.length-1;_>=0;_--)if(c.dist(m[_])<r)return!0}else v[t]=[];return v[t].push(c),!1}var St=_o.VectorTileFeature.types,Me=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function qe(e,t,r,c,v,m,_,C,k,B,W,K,oe){var ce=C?Math.min(32640,Math.round(C[0])):0,Ve=C?Math.min(32640,Math.round(C[1])):0;e.emplaceBack(t,r,Math.round(32*c),Math.round(32*v),m,_,(ce<<1)+(k?1:0),Ve,16*B,16*W,256*K,256*oe)}function Ce(e,t,r){e.emplaceBack(t.x,t.y,r),e.emplaceBack(t.x,t.y,r),e.emplaceBack(t.x,t.y,r),e.emplaceBack(t.x,t.y,r)}function At(e){for(var t=0,r=e.sections;t<r.length;t+=1)if(dc(r[t].text))return!0;return!1}var Bt=function(e){this.layoutVertexArray=new gc,this.indexArray=new al,this.programConfigurations=e,this.segments=new ye,this.dynamicLayoutVertexArray=new nc,this.opacityVertexArray=new yc,this.placedSymbolArray=new h};Bt.prototype.isEmpty=function(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0},Bt.prototype.upload=function(e,t,r,c){this.isEmpty()||(r&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,gp.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,t),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,Gh.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,Me,!0),this.opacityVertexBuffer.itemSize=1),(r||c)&&this.programConfigurations.upload(e))},Bt.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())},Tn("SymbolBuffers",Bt);var Sr=function(e,t,r){this.layoutVertexArray=new e,this.layoutAttributes=t,this.indexArray=new r,this.segments=new ye,this.collisionVertexArray=new _c};Sr.prototype.upload=function(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,Hh.members,!0)},Sr.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())},Tn("CollisionBuffers",Sr);var Kt=function(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(function(m){return m.id}),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=No([]),this.placementViewportMatrix=No([]);var t=this.layers[0]._unevaluatedLayout._values;this.textSizeData=ua(this.zoom,t["text-size"]),this.iconSizeData=ua(this.zoom,t["icon-size"]);var r=this.layers[0].layout,c=r.get("symbol-sort-key"),v=r.get("symbol-z-order");this.canOverlap=r.get("text-allow-overlap")||r.get("icon-allow-overlap")||r.get("text-ignore-placement")||r.get("icon-ignore-placement"),this.sortFeaturesByKey=v!=="viewport-y"&&c.constantOr(1)!==void 0,this.sortFeaturesByY=(v==="viewport-y"||v==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,r.get("symbol-placement")==="point"&&(this.writingModes=r.get("text-writing-mode").map(function(m){return Yn[m]})),this.stateDependentLayerIds=this.layers.filter(function(m){return m.isStateDependent()}).map(function(m){return m.id}),this.sourceID=e.sourceID};Kt.prototype.createArrays=function(){this.text=new Bt(new Qn(this.layers,this.zoom,function(e){return/^text/.test(e)})),this.icon=new Bt(new Qn(this.layers,this.zoom,function(e){return/^icon/.test(e)})),this.glyphOffsetArray=new T,this.lineVertexArray=new R,this.symbolInstances=new b},Kt.prototype.calculateGlyphDependencies=function(e,t,r,c,v){for(var m=0;m<e.length;m++)if(t[e.charCodeAt(m)]=!0,(r||c)&&v){var _=Ef[e.charAt(m)];_&&(t[_.charCodeAt(0)]=!0)}},Kt.prototype.populate=function(e,t,r){var c=this.layers[0],v=c.layout,m=v.get("text-font"),_=v.get("text-field"),C=v.get("icon-image"),k=(_.value.kind!=="constant"||_.value.value instanceof ki&&!_.value.value.isEmpty()||_.value.value.toString().length>0)&&(m.value.kind!=="constant"||m.value.value.length>0),B=C.value.kind!=="constant"||!!C.value.value||Object.keys(C.parameters).length>0,W=v.get("symbol-sort-key");if(this.features=[],k||B){for(var K=t.iconDependencies,oe=t.glyphDependencies,ce=t.availableImages,Ve=new Fi(this.zoom),We=0,st=e;We<st.length;We+=1){var et=st[We],Tt=et.feature,Ut=et.id,nr=et.index,hr=et.sourceLayerIndex,Mr=c._featureFilter.needGeometry,Yr=ro(Tt,Mr);if(c._featureFilter.filter(Ve,Yr,r)){Mr||(Yr.geometry=Qa(Tt));var hn=void 0;if(k){var Hn=c.getValueAndResolveTokens("text-field",Yr,r,ce),wn=ki.factory(Hn);At(wn)&&(this.hasRTLText=!0),(!this.hasRTLText||Uc()==="unavailable"||this.hasRTLText&&Qs.isParsed())&&(hn=Sf(wn,c,Yr))}var Jn=void 0;if(B){var yn=c.getValueAndResolveTokens("icon-image",Yr,r,ce);Jn=yn instanceof Ba?yn:Ba.fromString(yn)}if(hn||Jn){var Ui=this.sortFeaturesByKey?W.evaluate(Yr,{},r):void 0;if(this.features.push({id:Ut,text:hn,icon:Jn,index:nr,sourceLayerIndex:hr,geometry:Yr.geometry,properties:Tt.properties,type:St[Tt.type],sortKey:Ui}),Jn&&(K[Jn.name]=!0),hn){var hi=m.evaluate(Yr,{},r).join(","),Zn=v.get("text-rotation-alignment")==="map"&&v.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Yn.vertical)>=0;for(var ea=0,zi=hn.sections;ea<zi.length;ea+=1){var ca=zi[ea];if(ca.image)K[ca.image.name]=!0;else{var ei=Bc(hn.toString()),wa=ca.fontStack||hi,To=oe[wa]=oe[wa]||{};this.calculateGlyphDependencies(ca.text,To,Zn,this.allowVerticalPlacement,ei)}}}}}}v.get("symbol-placement")==="line"&&(this.features=function(Oo){var xo={},Ao={},Lo=[],As=0;function zs(Ha){Lo.push(Oo[Ha]),As++}function ou(Ha,cs,su){var oa=Ao[Ha];return delete Ao[Ha],Ao[cs]=oa,Lo[oa].geometry[0].pop(),Lo[oa].geometry[0]=Lo[oa].geometry[0].concat(su[0]),oa}function Ns(Ha,cs,su){var oa=xo[cs];return delete xo[cs],xo[Ha]=oa,Lo[oa].geometry[0].shift(),Lo[oa].geometry[0]=su[0].concat(Lo[oa].geometry[0]),oa}function Du(Ha,cs,su){var oa=su?cs[0][cs[0].length-1]:cs[0][0];return Ha+":"+oa.x+":"+oa.y}for(var Ho=0;Ho<Oo.length;Ho++){var Bs=Oo[Ho],aa=Bs.geometry,Ia=Bs.text?Bs.text.toString():null;if(Ia){var Fa=Du(Ia,aa),va=Du(Ia,aa,!0);if(Fa in Ao&&va in xo&&Ao[Fa]!==xo[va]){var ys=Ns(Fa,va,aa),Hs=ou(Fa,va,Lo[ys].geometry);delete xo[Fa],delete Ao[va],Ao[Du(Ia,Lo[Hs].geometry,!0)]=Hs,Lo[ys].geometry=null}else Fa in Ao?ou(Fa,va,aa):va in xo?Ns(Fa,va,aa):(zs(Ho),xo[Fa]=As-1,Ao[va]=As-1)}else zs(Ho)}return Lo.filter(function(Ha){return Ha.geometry})}(this.features)),this.sortFeaturesByKey&&this.features.sort(function(Oo,xo){return Oo.sortKey-xo.sortKey})}},Kt.prototype.update=function(e,t,r){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,t,this.layers,r),this.icon.programConfigurations.updatePaintArrays(e,t,this.layers,r))},Kt.prototype.isEmpty=function(){return this.symbolInstances.length===0&&!this.hasRTLText},Kt.prototype.uploadPending=function(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload},Kt.prototype.upload=function(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0},Kt.prototype.destroyDebugData=function(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()},Kt.prototype.destroy=function(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()},Kt.prototype.addToLineVertexArray=function(e,t){var r=this.lineVertexArray.length;if(e.segment!==void 0){for(var c=e.dist(t[e.segment+1]),v=e.dist(t[e.segment]),m={},_=e.segment+1;_<t.length;_++)m[_]={x:t[_].x,y:t[_].y,tileUnitDistanceFromAnchor:c},_<t.length-1&&(c+=t[_+1].dist(t[_]));for(var C=e.segment||0;C>=0;C--)m[C]={x:t[C].x,y:t[C].y,tileUnitDistanceFromAnchor:v},C>0&&(v+=t[C-1].dist(t[C]));for(var k=0;k<t.length;k++){var B=m[k];this.lineVertexArray.emplaceBack(B.x,B.y,B.tileUnitDistanceFromAnchor)}}return{lineStartIndex:r,lineLength:this.lineVertexArray.length-r}},Kt.prototype.addSymbols=function(e,t,r,c,v,m,_,C,k,B,W,K){for(var oe=e.indexArray,ce=e.layoutVertexArray,Ve=e.segments.prepareSegment(4*t.length,ce,oe,this.canOverlap?m.sortKey:void 0),We=this.glyphOffsetArray.length,st=Ve.vertexLength,et=this.allowVerticalPlacement&&_===Yn.vertical?Math.PI/2:0,Tt=m.text&&m.text.sections,Ut=0;Ut<t.length;Ut++){var nr=t[Ut],hr=nr.tl,Mr=nr.tr,Yr=nr.bl,hn=nr.br,Hn=nr.tex,wn=nr.pixelOffsetTL,Jn=nr.pixelOffsetBR,yn=nr.minFontScaleX,Ui=nr.minFontScaleY,hi=nr.glyphOffset,Zn=nr.isSDF,ea=nr.sectionIndex,zi=Ve.vertexLength,ca=hi[1];qe(ce,C.x,C.y,hr.x,ca+hr.y,Hn.x,Hn.y,r,Zn,wn.x,wn.y,yn,Ui),qe(ce,C.x,C.y,Mr.x,ca+Mr.y,Hn.x+Hn.w,Hn.y,r,Zn,Jn.x,wn.y,yn,Ui),qe(ce,C.x,C.y,Yr.x,ca+Yr.y,Hn.x,Hn.y+Hn.h,r,Zn,wn.x,Jn.y,yn,Ui),qe(ce,C.x,C.y,hn.x,ca+hn.y,Hn.x+Hn.w,Hn.y+Hn.h,r,Zn,Jn.x,Jn.y,yn,Ui),Ce(e.dynamicLayoutVertexArray,C,et),oe.emplaceBack(zi,zi+1,zi+2),oe.emplaceBack(zi+1,zi+2,zi+3),Ve.vertexLength+=4,Ve.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(hi[0]),Ut!==t.length-1&&ea===t[Ut+1].sectionIndex||e.programConfigurations.populatePaintArrays(ce.length,m,m.index,{},K,Tt&&Tt[ea])}e.placedSymbolArray.emplaceBack(C.x,C.y,We,this.glyphOffsetArray.length-We,st,k,B,C.segment,r?r[0]:0,r?r[1]:0,c[0],c[1],_,0,!1,0,W)},Kt.prototype._addCollisionDebugVertex=function(e,t,r,c,v,m){return t.emplaceBack(0,0),e.emplaceBack(r.x,r.y,c,v,Math.round(m.x),Math.round(m.y))},Kt.prototype.addCollisionDebugVertices=function(e,t,r,c,v,m,_){var C=v.segments.prepareSegment(4,v.layoutVertexArray,v.indexArray),k=C.vertexLength,B=v.layoutVertexArray,W=v.collisionVertexArray,K=_.anchorX,oe=_.anchorY;this._addCollisionDebugVertex(B,W,m,K,oe,new Y(e,t)),this._addCollisionDebugVertex(B,W,m,K,oe,new Y(r,t)),this._addCollisionDebugVertex(B,W,m,K,oe,new Y(r,c)),this._addCollisionDebugVertex(B,W,m,K,oe,new Y(e,c)),C.vertexLength+=4;var ce=v.indexArray;ce.emplaceBack(k,k+1),ce.emplaceBack(k+1,k+2),ce.emplaceBack(k+2,k+3),ce.emplaceBack(k+3,k),C.primitiveLength+=4},Kt.prototype.addDebugCollisionBoxes=function(e,t,r,c){for(var v=e;v<t;v++){var m=this.collisionBoxArray.get(v);this.addCollisionDebugVertices(m.x1,m.y1,m.x2,m.y2,c?this.textCollisionBox:this.iconCollisionBox,m.anchorPoint,r)}},Kt.prototype.generateCollisionDebugBuffers=function(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Sr(Bl,bh.members,bc),this.iconCollisionBox=new Sr(Bl,bh.members,bc);for(var e=0;e<this.symbolInstances.length;e++){var t=this.symbolInstances.get(e);this.addDebugCollisionBoxes(t.textBoxStartIndex,t.textBoxEndIndex,t,!0),this.addDebugCollisionBoxes(t.verticalTextBoxStartIndex,t.verticalTextBoxEndIndex,t,!0),this.addDebugCollisionBoxes(t.iconBoxStartIndex,t.iconBoxEndIndex,t,!1),this.addDebugCollisionBoxes(t.verticalIconBoxStartIndex,t.verticalIconBoxEndIndex,t,!1)}},Kt.prototype._deserializeCollisionBoxesForSymbol=function(e,t,r,c,v,m,_,C,k){for(var B={},W=t;W<r;W++){var K=e.get(W);B.textBox={x1:K.x1,y1:K.y1,x2:K.x2,y2:K.y2,anchorPointX:K.anchorPointX,anchorPointY:K.anchorPointY},B.textFeatureIndex=K.featureIndex;break}for(var oe=c;oe<v;oe++){var ce=e.get(oe);B.verticalTextBox={x1:ce.x1,y1:ce.y1,x2:ce.x2,y2:ce.y2,anchorPointX:ce.anchorPointX,anchorPointY:ce.anchorPointY},B.verticalTextFeatureIndex=ce.featureIndex;break}for(var Ve=m;Ve<_;Ve++){var We=e.get(Ve);B.iconBox={x1:We.x1,y1:We.y1,x2:We.x2,y2:We.y2,anchorPointX:We.anchorPointX,anchorPointY:We.anchorPointY},B.iconFeatureIndex=We.featureIndex;break}for(var st=C;st<k;st++){var et=e.get(st);B.verticalIconBox={x1:et.x1,y1:et.y1,x2:et.x2,y2:et.y2,anchorPointX:et.anchorPointX,anchorPointY:et.anchorPointY},B.verticalIconFeatureIndex=et.featureIndex;break}return B},Kt.prototype.deserializeCollisionBoxes=function(e){this.collisionArrays=[];for(var t=0;t<this.symbolInstances.length;t++){var r=this.symbolInstances.get(t);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,r.textBoxStartIndex,r.textBoxEndIndex,r.verticalTextBoxStartIndex,r.verticalTextBoxEndIndex,r.iconBoxStartIndex,r.iconBoxEndIndex,r.verticalIconBoxStartIndex,r.verticalIconBoxEndIndex))}},Kt.prototype.hasTextData=function(){return this.text.segments.get().length>0},Kt.prototype.hasIconData=function(){return this.icon.segments.get().length>0},Kt.prototype.hasDebugData=function(){return this.textCollisionBox&&this.iconCollisionBox},Kt.prototype.hasTextCollisionBoxData=function(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0},Kt.prototype.hasIconCollisionBoxData=function(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0},Kt.prototype.addIndicesForPlacedSymbol=function(e,t){for(var r=e.placedSymbolArray.get(t),c=r.vertexStartIndex+4*r.numGlyphs,v=r.vertexStartIndex;v<c;v+=4)e.indexArray.emplaceBack(v,v+1,v+2),e.indexArray.emplaceBack(v+1,v+2,v+3)},Kt.prototype.getSortedSymbolIndexes=function(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;for(var t=Math.sin(e),r=Math.cos(e),c=[],v=[],m=[],_=0;_<this.symbolInstances.length;++_){m.push(_);var C=this.symbolInstances.get(_);c.push(0|Math.round(t*C.anchorX+r*C.anchorY)),v.push(C.featureIndex)}return m.sort(function(k,B){return c[k]-c[B]||v[B]-v[k]}),m},Kt.prototype.addToSortKeyRanges=function(e,t){var r=this.sortKeyRanges[this.sortKeyRanges.length-1];r&&r.sortKey===t?r.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:t,symbolInstanceStart:e,symbolInstanceEnd:e+1})},Kt.prototype.sortFeatures=function(e){var t=this;if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(var r=0,c=this.symbolInstanceIndexes;r<c.length;r+=1){var v=this.symbolInstances.get(c[r]);this.featureSortOrder.push(v.featureIndex),[v.rightJustifiedTextSymbolIndex,v.centerJustifiedTextSymbolIndex,v.leftJustifiedTextSymbolIndex].forEach(function(m,_,C){m>=0&&C.indexOf(m)===_&&t.addIndicesForPlacedSymbol(t.text,m)}),v.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,v.verticalPlacedTextSymbolIndex),v.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,v.placedIconSymbolIndex),v.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,v.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}},Tn("SymbolBucket",Kt,{omit:["layers","collisionBoxArray","features","compareText"]}),Kt.MAX_GLYPHS=65535,Kt.addDynamicAttributes=Ce;var br=new ko({"symbol-placement":new Un(ue.layout_symbol["symbol-placement"]),"symbol-spacing":new Un(ue.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Un(ue.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Mn(ue.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Un(ue.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Un(ue.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Un(ue.layout_symbol["icon-ignore-placement"]),"icon-optional":new Un(ue.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Un(ue.layout_symbol["icon-rotation-alignment"]),"icon-size":new Mn(ue.layout_symbol["icon-size"]),"icon-text-fit":new Un(ue.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Un(ue.layout_symbol["icon-text-fit-padding"]),"icon-image":new Mn(ue.layout_symbol["icon-image"]),"icon-rotate":new Mn(ue.layout_symbol["icon-rotate"]),"icon-padding":new Un(ue.layout_symbol["icon-padding"]),"icon-keep-upright":new Un(ue.layout_symbol["icon-keep-upright"]),"icon-offset":new Mn(ue.layout_symbol["icon-offset"]),"icon-anchor":new Mn(ue.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Un(ue.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Un(ue.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Un(ue.layout_symbol["text-rotation-alignment"]),"text-field":new Mn(ue.layout_symbol["text-field"]),"text-font":new Mn(ue.layout_symbol["text-font"]),"text-size":new Mn(ue.layout_symbol["text-size"]),"text-max-width":new Mn(ue.layout_symbol["text-max-width"]),"text-line-height":new Un(ue.layout_symbol["text-line-height"]),"text-letter-spacing":new Mn(ue.layout_symbol["text-letter-spacing"]),"text-justify":new Mn(ue.layout_symbol["text-justify"]),"text-radial-offset":new Mn(ue.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Un(ue.layout_symbol["text-variable-anchor"]),"text-anchor":new Mn(ue.layout_symbol["text-anchor"]),"text-max-angle":new Un(ue.layout_symbol["text-max-angle"]),"text-writing-mode":new Un(ue.layout_symbol["text-writing-mode"]),"text-rotate":new Mn(ue.layout_symbol["text-rotate"]),"text-padding":new Un(ue.layout_symbol["text-padding"]),"text-keep-upright":new Un(ue.layout_symbol["text-keep-upright"]),"text-transform":new Mn(ue.layout_symbol["text-transform"]),"text-offset":new Mn(ue.layout_symbol["text-offset"]),"text-allow-overlap":new Un(ue.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Un(ue.layout_symbol["text-ignore-placement"]),"text-optional":new Un(ue.layout_symbol["text-optional"])}),Xr={paint:new ko({"icon-opacity":new Mn(ue.paint_symbol["icon-opacity"]),"icon-color":new Mn(ue.paint_symbol["icon-color"]),"icon-halo-color":new Mn(ue.paint_symbol["icon-halo-color"]),"icon-halo-width":new Mn(ue.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Mn(ue.paint_symbol["icon-halo-blur"]),"icon-translate":new Un(ue.paint_symbol["icon-translate"]),"icon-translate-anchor":new Un(ue.paint_symbol["icon-translate-anchor"]),"text-opacity":new Mn(ue.paint_symbol["text-opacity"]),"text-color":new Mn(ue.paint_symbol["text-color"],{runtimeType:cn,getOverride:function(e){return e.textColor},hasOverride:function(e){return!!e.textColor}}),"text-halo-color":new Mn(ue.paint_symbol["text-halo-color"]),"text-halo-width":new Mn(ue.paint_symbol["text-halo-width"]),"text-halo-blur":new Mn(ue.paint_symbol["text-halo-blur"]),"text-translate":new Un(ue.paint_symbol["text-translate"]),"text-translate-anchor":new Un(ue.paint_symbol["text-translate-anchor"])}),layout:br},Fn=function(e){this.type=e.property.overrides?e.property.overrides.runtimeType:_n,this.defaultValue=e};Fn.prototype.evaluate=function(e){if(e.formattedSection){var t=this.defaultValue.property.overrides;if(t&&t.hasOverride(e.formattedSection))return t.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default},Fn.prototype.eachChild=function(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)},Fn.prototype.outputDefined=function(){return!1},Fn.prototype.serialize=function(){return null},Tn("FormatSectionOverride",Fn,{omit:["defaultValue"]});var Oi=function(e){function t(r){e.call(this,r,Xr)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.recalculate=function(r,c){if(e.prototype.recalculate.call(this,r,c),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){var v=this.layout.get("text-writing-mode");if(v){for(var m=[],_=0,C=v;_<C.length;_+=1){var k=C[_];m.indexOf(k)<0&&m.push(k)}this.layout._values["text-writing-mode"]=m}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()},t.prototype.getValueAndResolveTokens=function(r,c,v,m){var _=this.layout.get(r).evaluate(c,{},v,m),C=this._unevaluatedLayout._values[r];return C.isDataDriven()||Su(C.value)||!_?_:function(k,B){return B.replace(/{([^{}]+)}/g,function(W,K){return K in k?String(k[K]):""})}(c.properties,_)},t.prototype.createBucket=function(r){return new Kt(r)},t.prototype.queryRadius=function(){return 0},t.prototype.queryIntersectsFeature=function(){return!1},t.prototype._setPaintOverrides=function(){for(var r=0,c=Xr.paint.overridableProperties;r<c.length;r+=1){var v=c[r];if(t.hasPaintOverride(this.layout,v)){var m,_=this.paint.get(v),C=new Fn(_),k=new Qu(C,_.property.specification);m=_.value.kind==="constant"||_.value.kind==="source"?new Ol("source",k):new pl("composite",k,_.value.zoomStops,_.value._interpolationType),this.paint._values[v]=new vs(_.property,m,_.parameters)}}},t.prototype._handleOverridablePaintPropertyUpdate=function(r,c,v){return!(!this.layout||c.isDataDriven()||v.isDataDriven())&&t.hasPaintOverride(this.layout,r)},t.hasPaintOverride=function(r,c){var v=r.get("text-field"),m=Xr.paint.properties[c],_=!1,C=function(W){for(var K=0,oe=W;K<oe.length;K+=1)if(m.overrides&&m.overrides.hasOverride(oe[K]))return void(_=!0)};if(v.value.kind==="constant"&&v.value.value instanceof ki)C(v.value.value.sections);else if(v.value.kind==="source"){var k=function(W){_||(W instanceof Wa&&_a(W.value)===Xi?C(W.value.sections):W instanceof Ya?C(W.sections):W.eachChild(k))},B=v.value;B._styleExpression&&k(B._styleExpression.expression)}return _},t}(hu),zn={paint:new ko({"background-color":new Un(ue.paint_background["background-color"]),"background-pattern":new as(ue.paint_background["background-pattern"]),"background-opacity":new Un(ue.paint_background["background-opacity"])})},ni=function(e){function t(r){e.call(this,r,zn)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t}(hu),gi={paint:new ko({"raster-opacity":new Un(ue.paint_raster["raster-opacity"]),"raster-hue-rotate":new Un(ue.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Un(ue.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Un(ue.paint_raster["raster-brightness-max"]),"raster-saturation":new Un(ue.paint_raster["raster-saturation"]),"raster-contrast":new Un(ue.paint_raster["raster-contrast"]),"raster-resampling":new Un(ue.paint_raster["raster-resampling"]),"raster-fade-duration":new Un(ue.paint_raster["raster-fade-duration"])})},da=function(e){function t(r){e.call(this,r,gi)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t}(hu),Vo=function(e){function t(r){e.call(this,r,{}),this.implementation=r}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.is3D=function(){return this.implementation.renderingMode==="3d"},t.prototype.hasOffscreenPass=function(){return this.implementation.prerender!==void 0},t.prototype.recalculate=function(){},t.prototype.updateTransitions=function(){},t.prototype.hasTransition=function(){},t.prototype.serialize=function(){},t.prototype.onAdd=function(r){this.implementation.onAdd&&this.implementation.onAdd(r,r.painter.context.gl)},t.prototype.onRemove=function(r){this.implementation.onRemove&&this.implementation.onRemove(r,r.painter.context.gl)},t}(hu),Ru={circle:Gu,heatmap:Wf,hillshade:Lf,fill:wi,"fill-extrusion":gs,line:xh,symbol:Oi,background:ni,raster:da},qf=ne.HTMLImageElement,Hu=ne.HTMLCanvasElement,Sh=ne.HTMLVideoElement,ol=ne.ImageData,wf=ne.ImageBitmap,Tf=function(e,t,r,c){this.context=e,this.format=r,this.texture=e.gl.createTexture(),this.update(t,c)};Tf.prototype.update=function(e,t,r){var c=e.width,v=e.height,m=!(this.size&&this.size[0]===c&&this.size[1]===v||r),_=this.context,C=_.gl;if(this.useMipmap=Boolean(t&&t.useMipmap),C.bindTexture(C.TEXTURE_2D,this.texture),_.pixelStoreUnpackFlipY.set(!1),_.pixelStoreUnpack.set(1),_.pixelStoreUnpackPremultiplyAlpha.set(this.format===C.RGBA&&(!t||t.premultiply!==!1)),m)this.size=[c,v],e instanceof qf||e instanceof Hu||e instanceof Sh||e instanceof ol||wf&&e instanceof wf?C.texImage2D(C.TEXTURE_2D,0,this.format,this.format,C.UNSIGNED_BYTE,e):C.texImage2D(C.TEXTURE_2D,0,this.format,c,v,0,this.format,C.UNSIGNED_BYTE,e.data);else{var k=r||{x:0,y:0},B=k.x,W=k.y;e instanceof qf||e instanceof Hu||e instanceof Sh||e instanceof ol||wf&&e instanceof wf?C.texSubImage2D(C.TEXTURE_2D,0,B,W,C.RGBA,C.UNSIGNED_BYTE,e):C.texSubImage2D(C.TEXTURE_2D,0,B,W,c,v,C.RGBA,C.UNSIGNED_BYTE,e.data)}this.useMipmap&&this.isSizePowerOfTwo()&&C.generateMipmap(C.TEXTURE_2D)},Tf.prototype.bind=function(e,t,r){var c=this.context.gl;c.bindTexture(c.TEXTURE_2D,this.texture),r!==c.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(r=c.LINEAR),e!==this.filter&&(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,e),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,r||e),this.filter=e),t!==this.wrap&&(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,t),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,t),this.wrap=t)},Tf.prototype.isSizePowerOfTwo=function(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0},Tf.prototype.destroy=function(){this.context.gl.deleteTexture(this.texture),this.texture=null};var Xh=function(e){var t=this;this._callback=e,this._triggered=!1,typeof MessageChannel!="undefined"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=function(){t._triggered=!1,t._callback()})};Xh.prototype.trigger=function(){var e=this;this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(function(){e._triggered=!1,e._callback()},0))},Xh.prototype.remove=function(){delete this._channel,this._callback=function(){}};var zf=function(e,t,r){this.target=e,this.parent=t,this.mapId=r,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},Cr(["receive","process"],this),this.invoker=new Xh(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=bt()?e:ne};function Up(e,t,r){var c=2*Math.PI*6378137/256/Math.pow(2,r);return[e*c-2*Math.PI*6378137/2,t*c-2*Math.PI*6378137/2]}zf.prototype.send=function(e,t,r,c,v){var m=this;v===void 0&&(v=!1);var _=Math.round(1e18*Math.random()).toString(36).substring(0,10);r&&(this.callbacks[_]=r);var C=Ee(this.globalScope)?void 0:[];return this.target.postMessage({id:_,type:e,hasCallback:!!r,targetMapId:c,mustQueue:v,sourceMapId:this.mapId,data:$s(t,C)},C),{cancel:function(){r&&delete m.callbacks[_],m.target.postMessage({id:_,type:"<cancel>",targetMapId:c,sourceMapId:m.mapId})}}},zf.prototype.receive=function(e){var t=e.data,r=t.id;if(r&&(!t.targetMapId||this.mapId===t.targetMapId))if(t.type==="<cancel>"){delete this.tasks[r];var c=this.cancelCallbacks[r];delete this.cancelCallbacks[r],c&&c()}else bt()||t.mustQueue?(this.tasks[r]=t,this.taskQueue.push(r),this.invoker.trigger()):this.processTask(r,t)},zf.prototype.process=function(){if(this.taskQueue.length){var e=this.taskQueue.shift(),t=this.tasks[e];delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),t&&this.processTask(e,t)}},zf.prototype.processTask=function(e,t){var r=this;if(t.type==="<response>"){var c=this.callbacks[e];delete this.callbacks[e],c&&(t.error?c(Us(t.error)):c(null,Us(t.data)))}else{var v=!1,m=Ee(this.globalScope)?void 0:[],_=t.hasCallback?function(W,K){v=!0,delete r.cancelCallbacks[e],r.target.postMessage({id:e,type:"<response>",sourceMapId:r.mapId,error:W?$s(W):null,data:$s(K,m)},m)}:function(W){v=!0},C=null,k=Us(t.data);if(this.parent[t.type])C=this.parent[t.type](t.sourceMapId,k,_);else if(this.parent.getWorkerSource){var B=t.type.split(".");C=this.parent.getWorkerSource(t.sourceMapId,B[0],k.source)[B[1]](k,_)}else _(new Error("Could not find function "+t.type));!v&&C&&C.cancel&&(this.cancelCallbacks[e]=C.cancel)}},zf.prototype.remove=function(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)};var Go=function(e,t){e&&(t?this.setSouthWest(e).setNorthEast(t):e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))};Go.prototype.setNorthEast=function(e){return this._ne=e instanceof io?new io(e.lng,e.lat):io.convert(e),this},Go.prototype.setSouthWest=function(e){return this._sw=e instanceof io?new io(e.lng,e.lat):io.convert(e),this},Go.prototype.extend=function(e){var t,r,c=this._sw,v=this._ne;if(e instanceof io)t=e,r=e;else{if(!(e instanceof Go))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(Go.convert(e)):this.extend(io.convert(e)):this;if(r=e._ne,!(t=e._sw)||!r)return this}return c||v?(c.lng=Math.min(t.lng,c.lng),c.lat=Math.min(t.lat,c.lat),v.lng=Math.max(r.lng,v.lng),v.lat=Math.max(r.lat,v.lat)):(this._sw=new io(t.lng,t.lat),this._ne=new io(r.lng,r.lat)),this},Go.prototype.getCenter=function(){return new io((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)},Go.prototype.getSouthWest=function(){return this._sw},Go.prototype.getNorthEast=function(){return this._ne},Go.prototype.getNorthWest=function(){return new io(this.getWest(),this.getNorth())},Go.prototype.getSouthEast=function(){return new io(this.getEast(),this.getSouth())},Go.prototype.getWest=function(){return this._sw.lng},Go.prototype.getSouth=function(){return this._sw.lat},Go.prototype.getEast=function(){return this._ne.lng},Go.prototype.getNorth=function(){return this._ne.lat},Go.prototype.toArray=function(){return[this._sw.toArray(),this._ne.toArray()]},Go.prototype.toString=function(){return"LngLatBounds("+this._sw.toString()+", "+this._ne.toString()+")"},Go.prototype.isEmpty=function(){return!(this._sw&&this._ne)},Go.prototype.contains=function(e){var t=io.convert(e),r=t.lng,c=t.lat,v=this._sw.lng<=r&&r<=this._ne.lng;return this._sw.lng>this._ne.lng&&(v=this._sw.lng>=r&&r>=this._ne.lng),this._sw.lat<=c&&c<=this._ne.lat&&v},Go.convert=function(e){return!e||e instanceof Go?e:new Go(e)};var io=function(e,t){if(isNaN(e)||isNaN(t))throw new Error("Invalid LngLat object: ("+e+", "+t+")");if(this.lng=+e,this.lat=+t,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")};io.prototype.wrap=function(){return new io(Zt(this.lng,-180,180),this.lat)},io.prototype.toArray=function(){return[this.lng,this.lat]},io.prototype.toString=function(){return"LngLat("+this.lng+", "+this.lat+")"},io.prototype.distanceTo=function(e){var t=Math.PI/180,r=this.lat*t,c=e.lat*t,v=Math.sin(r)*Math.sin(c)+Math.cos(r)*Math.cos(c)*Math.cos((e.lng-this.lng)*t);return 63710088e-1*Math.acos(Math.min(v,1))},io.prototype.toBounds=function(e){e===void 0&&(e=0);var t=360*e/40075017,r=t/Math.cos(Math.PI/180*this.lat);return new Go(new io(this.lng-r,this.lat-t),new io(this.lng+r,this.lat+t))},io.convert=function(e){if(e instanceof io)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new io(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new io(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")};var _p=2*Math.PI*63710088e-1;function jp(e){return _p*Math.cos(e*Math.PI/180)}function Zp(e){return(180+e)/360}function Vp(e){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e*Math.PI/360)))/360}function Gp(e,t){return e/jp(t)}function eh(e){return 360/Math.PI*Math.atan(Math.exp((180-360*e)*Math.PI/180))-90}var Af=function(e,t,r){r===void 0&&(r=0),this.x=+e,this.y=+t,this.z=+r};Af.fromLngLat=function(e,t){t===void 0&&(t=0);var r=io.convert(e);return new Af(Zp(r.lng),Vp(r.lat),Gp(t,r.lat))},Af.prototype.toLngLat=function(){return new io(360*this.x-180,eh(this.y))},Af.prototype.toAltitude=function(){return this.z*jp(eh(this.y))},Af.prototype.meterInMercatorCoordinateUnits=function(){return 1/_p*(e=eh(this.y),1/Math.cos(e*Math.PI/180));var e};var Cf=function(e,t,r){this.z=e,this.x=t,this.y=r,this.key=th(0,e,e,t,r)};Cf.prototype.equals=function(e){return this.z===e.z&&this.x===e.x&&this.y===e.y},Cf.prototype.url=function(e,t){var r,c,v,m,_,C=(c=this.y,v=this.z,m=Up(256*(r=this.x),256*(c=Math.pow(2,v)-c-1),v),_=Up(256*(r+1),256*(c+1),v),m[0]+","+m[1]+","+_[0]+","+_[1]),k=function(B,W,K){for(var oe,ce="",Ve=B;Ve>0;Ve--)ce+=(W&(oe=1<<Ve-1)?1:0)+(K&oe?2:0);return ce}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String(t==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",k).replace("{bbox-epsg-3857}",C)},Cf.prototype.getTilePoint=function(e){var t=Math.pow(2,this.z);return new Y(8192*(e.x*t-this.x),8192*(e.y*t-this.y))},Cf.prototype.toString=function(){return this.z+"/"+this.x+"/"+this.y};var xp=function(e,t){this.wrap=e,this.canonical=t,this.key=th(e,t.z,t.z,t.x,t.y)},ls=function(e,t,r,c,v){this.overscaledZ=e,this.wrap=t,this.canonical=new Cf(r,+c,+v),this.key=th(t,e,r,c,v)};function th(e,t,r,c,v){(e*=2)<0&&(e=-1*e-1);var m=1<<r;return(m*m*e+m*v+c).toString(36)+r.toString(36)+t.toString(36)}ls.prototype.equals=function(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)},ls.prototype.scaledTo=function(e){var t=this.canonical.z-e;return e>this.canonical.z?new ls(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new ls(e,this.wrap,e,this.canonical.x>>t,this.canonical.y>>t)},ls.prototype.calculateScaledKey=function(e,t){var r=this.canonical.z-e;return e>this.canonical.z?th(this.wrap*+t,e,this.canonical.z,this.canonical.x,this.canonical.y):th(this.wrap*+t,e,e,this.canonical.x>>r,this.canonical.y>>r)},ls.prototype.isChildOf=function(e){if(e.wrap!==this.wrap)return!1;var t=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>t&&e.canonical.y===this.canonical.y>>t},ls.prototype.children=function(e){if(this.overscaledZ>=e)return[new ls(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];var t=this.canonical.z+1,r=2*this.canonical.x,c=2*this.canonical.y;return[new ls(t,this.wrap,t,r,c),new ls(t,this.wrap,t,r+1,c),new ls(t,this.wrap,t,r,c+1),new ls(t,this.wrap,t,r+1,c+1)]},ls.prototype.isLessThan=function(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))},ls.prototype.wrapped=function(){return new ls(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)},ls.prototype.unwrapTo=function(e){return new ls(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)},ls.prototype.overscaleFactor=function(){return Math.pow(2,this.overscaledZ-this.canonical.z)},ls.prototype.toUnwrapped=function(){return new xp(this.wrap,this.canonical)},ls.prototype.toString=function(){return this.overscaledZ+"/"+this.canonical.x+"/"+this.canonical.y},ls.prototype.getTilePoint=function(e){return this.canonical.getTilePoint(new Af(e.x-this.wrap,e.y))},Tn("CanonicalTileID",Cf),Tn("OverscaledTileID",ls,{omit:["posMatrix"]});var af=function(e,t,r){if(this.uid=e,t.height!==t.width)throw new RangeError("DEM tiles must be square");if(r&&r!=="mapbox"&&r!=="terrarium")return Ne('"'+r+'" is not a valid encoding type. Valid types include "mapbox" and "terrarium".');this.stride=t.height;var c=this.dim=t.height-2;this.data=new Uint32Array(t.data.buffer),this.encoding=r||"mapbox";for(var v=0;v<c;v++)this.data[this._idx(-1,v)]=this.data[this._idx(0,v)],this.data[this._idx(c,v)]=this.data[this._idx(c-1,v)],this.data[this._idx(v,-1)]=this.data[this._idx(v,0)],this.data[this._idx(v,c)]=this.data[this._idx(v,c-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(c,-1)]=this.data[this._idx(c-1,0)],this.data[this._idx(-1,c)]=this.data[this._idx(0,c-1)],this.data[this._idx(c,c)]=this.data[this._idx(c-1,c-1)]};af.prototype.get=function(e,t){var r=new Uint8Array(this.data.buffer),c=4*this._idx(e,t);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(r[c],r[c+1],r[c+2])},af.prototype.getUnpackVector=function(){return this.encoding==="terrarium"?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]},af.prototype._idx=function(e,t){if(e<-1||e>=this.dim+1||t<-1||t>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(t+1)*this.stride+(e+1)},af.prototype._unpackMapbox=function(e,t,r){return(256*e*256+256*t+r)/10-1e4},af.prototype._unpackTerrarium=function(e,t,r){return 256*e+t+r/256-32768},af.prototype.getPixels=function(){return new ga({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))},af.prototype.backfillBorder=function(e,t,r){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");var c=t*this.dim,v=t*this.dim+this.dim,m=r*this.dim,_=r*this.dim+this.dim;switch(t){case-1:c=v-1;break;case 1:v=c+1}switch(r){case-1:m=_-1;break;case 1:_=m+1}for(var C=-t*this.dim,k=-r*this.dim,B=m;B<_;B++)for(var W=c;W<v;W++)this.data[this._idx(W,B)]=e.data[this._idx(W+C,B+k)]},Tn("DEMData",af);var Yh=function(e){this._stringToNumber={},this._numberToString=[];for(var t=0;t<e.length;t++){var r=e[t];this._stringToNumber[r]=t,this._numberToString[t]=r}};Yh.prototype.encode=function(e){return this._stringToNumber[e]},Yh.prototype.decode=function(e){return this._numberToString[e]};var Kh=function(e,t,r,c,v){this.type="Feature",this._vectorTileFeature=e,e._z=t,e._x=r,e._y=c,this.properties=e.properties,this.id=v},bp={geometry:{configurable:!0}};bp.geometry.get=function(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry},bp.geometry.set=function(e){this._geometry=e},Kh.prototype.toJSON=function(){var e={geometry:this.geometry};for(var t in this)t!=="_geometry"&&t!=="_vectorTileFeature"&&(e[t]=this[t]);return e},Object.defineProperties(Kh.prototype,bp);var rh=function(){this.state={},this.stateChanges={},this.deletedStates={}};rh.prototype.updateState=function(e,t,r){var c=String(t);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][c]=this.stateChanges[e][c]||{},Xt(this.stateChanges[e][c],r),this.deletedStates[e]===null)for(var v in this.deletedStates[e]={},this.state[e])v!==c&&(this.deletedStates[e][v]=null);else if(this.deletedStates[e]&&this.deletedStates[e][c]===null)for(var m in this.deletedStates[e][c]={},this.state[e][c])r[m]||(this.deletedStates[e][c][m]=null);else for(var _ in r)this.deletedStates[e]&&this.deletedStates[e][c]&&this.deletedStates[e][c][_]===null&&delete this.deletedStates[e][c][_]},rh.prototype.removeFeatureState=function(e,t,r){if(this.deletedStates[e]!==null){var c=String(t);if(this.deletedStates[e]=this.deletedStates[e]||{},r&&t!==void 0)this.deletedStates[e][c]!==null&&(this.deletedStates[e][c]=this.deletedStates[e][c]||{},this.deletedStates[e][c][r]=null);else if(t!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][c])for(r in this.deletedStates[e][c]={},this.stateChanges[e][c])this.deletedStates[e][c][r]=null;else this.deletedStates[e][c]=null;else this.deletedStates[e]=null}},rh.prototype.getState=function(e,t){var r=String(t),c=Xt({},(this.state[e]||{})[r],(this.stateChanges[e]||{})[r]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){var v=this.deletedStates[e][t];if(v===null)return{};for(var m in v)delete c[m]}return c},rh.prototype.initializeTileState=function(e,t){e.setFeatureState(this.state,t)},rh.prototype.coalesceChanges=function(e,t){var r={};for(var c in this.stateChanges){this.state[c]=this.state[c]||{};var v={};for(var m in this.stateChanges[c])this.state[c][m]||(this.state[c][m]={}),Xt(this.state[c][m],this.stateChanges[c][m]),v[m]=this.state[c][m];r[c]=v}for(var _ in this.deletedStates){this.state[_]=this.state[_]||{};var C={};if(this.deletedStates[_]===null)for(var k in this.state[_])C[k]={},this.state[_][k]={};else for(var B in this.deletedStates[_]){if(this.deletedStates[_][B]===null)this.state[_][B]={};else for(var W=0,K=Object.keys(this.deletedStates[_][B]);W<K.length;W+=1)delete this.state[_][B][K[W]];C[B]=this.state[_][B]}r[_]=r[_]||{},Xt(r[_],C)}if(this.stateChanges={},this.deletedStates={},Object.keys(r).length!==0)for(var oe in e)e[oe].setFeatureState(r,t)};var Hc=function(e,t){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Uu(8192,16,0),this.grid3D=new Uu(8192,16,0),this.featureIndexArray=new te,this.promoteId=t};function Hp(e,t,r,c,v){return ar(e,function(m,_){var C=t instanceof nl?t.get(_):null;return C&&C.evaluate?C.evaluate(r,c,v):C})}function Sp(e){for(var t=1/0,r=1/0,c=-1/0,v=-1/0,m=0,_=e;m<_.length;m+=1){var C=_[m];t=Math.min(t,C.x),r=Math.min(r,C.y),c=Math.max(c,C.x),v=Math.max(v,C.y)}return{minX:t,minY:r,maxX:c,maxY:v}}function Wp(e,t){return t-e}Hc.prototype.insert=function(e,t,r,c,v,m){var _=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(r,c,v);for(var C=m?this.grid3D:this.grid,k=0;k<t.length;k++){for(var B=t[k],W=[1/0,1/0,-1/0,-1/0],K=0;K<B.length;K++){var oe=B[K];W[0]=Math.min(W[0],oe.x),W[1]=Math.min(W[1],oe.y),W[2]=Math.max(W[2],oe.x),W[3]=Math.max(W[3],oe.y)}W[0]<8192&&W[1]<8192&&W[2]>=0&&W[3]>=0&&C.insert(_,W[0],W[1],W[2],W[3])}},Hc.prototype.loadVTLayers=function(){return this.vtLayers||(this.vtLayers=new _o.VectorTile(new Se(this.rawTileData)).layers,this.sourceLayerCoder=new Yh(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers},Hc.prototype.query=function(e,t,r,c){var v=this;this.loadVTLayers();for(var m=e.params||{},_=8192/e.tileSize/e.scale,C=Rl(m.filter),k=e.queryGeometry,B=e.queryPadding*_,W=Sp(k),K=this.grid.query(W.minX-B,W.minY-B,W.maxX+B,W.maxY+B),oe=Sp(e.cameraQueryGeometry),ce=this.grid3D.query(oe.minX-B,oe.minY-B,oe.maxX+B,oe.maxY+B,function(nr,hr,Mr,Yr){return function(hn,Hn,wn,Jn,yn){for(var Ui=0,hi=hn;Ui<hi.length;Ui+=1){var Zn=hi[Ui];if(Hn<=Zn.x&&wn<=Zn.y&&Jn>=Zn.x&&yn>=Zn.y)return!0}var ea=[new Y(Hn,wn),new Y(Hn,yn),new Y(Jn,yn),new Y(Jn,wn)];if(hn.length>2){for(var zi=0,ca=ea;zi<ca.length;zi+=1)if(du(hn,ca[zi]))return!0}for(var ei=0;ei<hn.length-1;ei++)if(wl(hn[ei],hn[ei+1],ea))return!0;return!1}(e.cameraQueryGeometry,nr-B,hr-B,Mr+B,Yr+B)}),Ve=0,We=ce;Ve<We.length;Ve+=1)K.push(We[Ve]);K.sort(Wp);for(var st,et={},Tt=function(nr){var hr=K[nr];if(hr!==st){st=hr;var Mr=v.featureIndexArray.get(hr),Yr=null;v.loadMatchingFeature(et,Mr.bucketIndex,Mr.sourceLayerIndex,Mr.featureIndex,C,m.layers,m.availableImages,t,r,c,function(hn,Hn,wn){return Yr||(Yr=Qa(hn)),Hn.queryIntersectsFeature(k,hn,wn,Yr,v.z,e.transform,_,e.pixelPosMatrix)})}},Ut=0;Ut<K.length;Ut++)Tt(Ut);return et},Hc.prototype.loadMatchingFeature=function(e,t,r,c,v,m,_,C,k,B,W){var K=this.bucketLayerIDs[t];if(!m||function(hn,Hn){for(var wn=0;wn<hn.length;wn++)if(Hn.indexOf(hn[wn])>=0)return!0;return!1}(m,K)){var oe=this.sourceLayerCoder.decode(r),ce=this.vtLayers[oe].feature(c);if(v.needGeometry){var Ve=ro(ce,!0);if(!v.filter(new Fi(this.tileID.overscaledZ),Ve,this.tileID.canonical))return}else if(!v.filter(new Fi(this.tileID.overscaledZ),ce))return;for(var We=this.getId(ce,oe),st=0;st<K.length;st++){var et=K[st];if(!(m&&m.indexOf(et)<0)){var Tt=C[et];if(Tt){var Ut={};We!==void 0&&B&&(Ut=B.getState(Tt.sourceLayer||"_geojsonTileLayer",We));var nr=Xt({},k[et]);nr.paint=Hp(nr.paint,Tt.paint,ce,Ut,_),nr.layout=Hp(nr.layout,Tt.layout,ce,Ut,_);var hr=!W||W(ce,Tt,Ut);if(hr){var Mr=new Kh(ce,this.z,this.x,this.y,We);Mr.layer=nr;var Yr=e[et];Yr===void 0&&(Yr=e[et]=[]),Yr.push({featureIndex:c,feature:Mr,intersectionZ:hr})}}}}}},Hc.prototype.lookupSymbolFeatures=function(e,t,r,c,v,m,_,C){var k={};this.loadVTLayers();for(var B=Rl(v),W=0,K=e;W<K.length;W+=1)this.loadMatchingFeature(k,r,c,K[W],B,m,_,C,t);return k},Hc.prototype.hasLayer=function(e){for(var t=0,r=this.bucketLayerIDs;t<r.length;t+=1)for(var c=0,v=r[t];c<v.length;c+=1)if(e===v[c])return!0;return!1},Hc.prototype.getId=function(e,t){var r=e.id;return this.promoteId&&typeof(r=e.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[t]])=="boolean"&&(r=Number(r)),r},Tn("FeatureIndex",Hc,{omit:["rawTileData","sourceLayerCoder"]});var Ts=function(e,t){this.tileID=e,this.uid=Lt(),this.uses=0,this.tileSize=t,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.expiredRequestCount=0,this.state="loading"};Ts.prototype.registerFadeDuration=function(e){var t=e+this.timeAdded;t<ln.now()||this.fadeEndTime&&t<this.fadeEndTime||(this.fadeEndTime=t)},Ts.prototype.wasRequested=function(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"},Ts.prototype.loadVectorData=function(e,t,r){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",e){for(var c in e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(B,W){var K={};if(!W)return K;for(var oe=function(){var We=Ve[ce],st=We.layerIds.map(function(Ut){return W.getLayer(Ut)}).filter(Boolean);if(st.length!==0){We.layers=st,We.stateDependentLayerIds&&(We.stateDependentLayers=We.stateDependentLayerIds.map(function(Ut){return st.filter(function(nr){return nr.id===Ut})[0]}));for(var et=0,Tt=st;et<Tt.length;et+=1)K[Tt[et].id]=We}},ce=0,Ve=B;ce<Ve.length;ce+=1)oe();return K}(e.buckets,t.style),this.hasSymbolBuckets=!1,this.buckets){var v=this.buckets[c];if(v instanceof Kt){if(this.hasSymbolBuckets=!0,!r)break;v.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(var m in this.buckets){var _=this.buckets[m];if(_ instanceof Kt&&_.hasRTLText){this.hasRTLText=!0,Qs.isLoading()||Qs.isLoaded()||Uc()!=="deferred"||Eu();break}}for(var C in this.queryPadding=0,this.buckets){var k=this.buckets[C];this.queryPadding=Math.max(this.queryPadding,t.style.getLayer(C).queryRadius(k))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage)}else this.collisionBoxArray=new s},Ts.prototype.unloadVectorData=function(){for(var e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"},Ts.prototype.getBucket=function(e){return this.buckets[e.id]},Ts.prototype.upload=function(e){for(var t in this.buckets){var r=this.buckets[t];r.uploadPending()&&r.upload(e)}var c=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Tf(e,this.imageAtlas.image,c.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Tf(e,this.glyphAtlasImage,c.ALPHA),this.glyphAtlasImage=null)},Ts.prototype.prepare=function(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)},Ts.prototype.queryRenderedFeatures=function(e,t,r,c,v,m,_,C,k,B){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:c,cameraQueryGeometry:v,scale:m,tileSize:this.tileSize,pixelPosMatrix:B,transform:C,params:_,queryPadding:this.queryPadding*k},e,t,r):{}},Ts.prototype.querySourceFeatures=function(e,t){var r=this.latestFeatureIndex;if(r&&r.rawTileData){var c=r.loadVTLayers(),v=t?t.sourceLayer:"",m=c._geojsonTileLayer||c[v];if(m)for(var _=Rl(t&&t.filter),C=this.tileID.canonical,k=C.z,B=C.x,W=C.y,K={z:k,x:B,y:W},oe=0;oe<m.length;oe++){var ce=m.feature(oe);if(_.needGeometry){var Ve=ro(ce,!0);if(!_.filter(new Fi(this.tileID.overscaledZ),Ve,this.tileID.canonical))continue}else if(!_.filter(new Fi(this.tileID.overscaledZ),ce))continue;var We=r.getId(ce,v),st=new Kh(ce,k,B,W,We);st.tile=K,e.push(st)}}},Ts.prototype.hasData=function(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"},Ts.prototype.patternsLoaded=function(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length},Ts.prototype.setExpiryData=function(e){var t=this.expirationTime;if(e.cacheControl){var r=ir(e.cacheControl);r["max-age"]&&(this.expirationTime=Date.now()+1e3*r["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){var c=Date.now(),v=!1;if(this.expirationTime>c)v=!1;else if(t)if(this.expirationTime<t)v=!0;else{var m=this.expirationTime-t;m?this.expirationTime=c+Math.max(m,3e4):v=!0}else v=!0;v?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}},Ts.prototype.getExpiryTimeout=function(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)},Ts.prototype.setFeatureState=function(e,t){if(this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(e).length!==0){var r=this.latestFeatureIndex.loadVTLayers();for(var c in this.buckets)if(t.style.hasLayer(c)){var v=this.buckets[c],m=v.layers[0].sourceLayer||"_geojsonTileLayer",_=r[m],C=e[m];if(_&&C&&Object.keys(C).length!==0){v.update(C,_,this.imageAtlas&&this.imageAtlas.patternPositions||{});var k=t&&t.style&&t.style.getLayer(c);k&&(this.queryPadding=Math.max(this.queryPadding,k.queryRadius(v)))}}}},Ts.prototype.holdingForFade=function(){return this.symbolFadeHoldUntil!==void 0},Ts.prototype.symbolFadeFinished=function(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<ln.now()},Ts.prototype.clearFadeHold=function(){this.symbolFadeHoldUntil=void 0},Ts.prototype.setHoldDuration=function(e){this.symbolFadeHoldUntil=ln.now()+e},Ts.prototype.setDependencies=function(e,t){for(var r={},c=0,v=t;c<v.length;c+=1)r[v[c]]=!0;this.dependencies[e]=r},Ts.prototype.hasDependency=function(e,t){for(var r=0,c=e;r<c.length;r+=1){var v=this.dependencies[c[r]];if(v){for(var m=0,_=t;m<_.length;m+=1)if(v[_[m]])return!0}}return!1};var Pf=ne.performance,Xp=function(e){this._marks={start:[e.url,"start"].join("#"),end:[e.url,"end"].join("#"),measure:e.url.toString()},Pf.mark(this._marks.start)};Xp.prototype.finish=function(){Pf.mark(this._marks.end);var e=Pf.getEntriesByName(this._marks.measure);return e.length===0&&(Pf.measure(this._marks.measure,this._marks.start,this._marks.end),e=Pf.getEntriesByName(this._marks.measure),Pf.clearMarks(this._marks.start),Pf.clearMarks(this._marks.end),Pf.clearMeasures(this._marks.measure)),e},p.Actor=zf,p.AlphaImage=gu,p.CanonicalTileID=Cf,p.CollisionBoxArray=s,p.Color=Vn,p.DEMData=af,p.DataConstantProperty=Un,p.DictionaryCoder=Yh,p.EXTENT=8192,p.ErrorEvent=Le,p.EvaluationParameters=Fi,p.Event=ie,p.Evented=Ge,p.FeatureIndex=Hc,p.FillBucket=Bn,p.FillExtrusionBucket=Jo,p.ImageAtlas=Kn,p.ImagePosition=Rr,p.LineBucket=au,p.LngLat=io,p.LngLatBounds=Go,p.MercatorCoordinate=Af,p.ONE_EM=24,p.OverscaledTileID=ls,p.Point=Y,p.Point$1=Y,p.Properties=ko,p.Protobuf=Se,p.RGBAImage=ga,p.RequestManager=Dt,p.RequestPerformance=Xp,p.ResourceType=gr,p.SegmentVector=ye,p.SourceFeatureState=rh,p.StructArrayLayout1ui2=Zc,p.StructArrayLayout2f1f2i16=qs,p.StructArrayLayout2i4=bl,p.StructArrayLayout3ui6=al,p.StructArrayLayout4i8=mc,p.SymbolBucket=Kt,p.Texture=Tf,p.Tile=Ts,p.Transitionable=Mo,p.Uniform1f=rn,p.Uniform1i=Lr,p.Uniform2f=Qr,p.Uniform3f=xn,p.Uniform4f=jn,p.UniformColor=Xn,p.UniformMatrix4f=$i,p.UnwrappedTileID=xp,p.ValidationError=De,p.WritingMode=Yn,p.ZoomHistory=yl,p.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e},p.addDynamicAttributes=Ce,p.asyncAll=function(e,t,r){if(!e.length)return r(null,[]);var c=e.length,v=new Array(e.length),m=null;e.forEach(function(_,C){t(_,function(k,B){k&&(m=k),v[C]=B,--c==0&&r(m,v)})})},p.bezier=we,p.bindAll=Cr,p.browser=ln,p.cacheEntryPossiblyAdded=function(e){++It>lt&&(e.getActor().send("enforceCacheSizeLimit",yt),It=0)},p.clamp=$t,p.clearTileCache=function(e){var t=ne.caches.delete("mapbox-tiles");e&&t.catch(e).then(function(){return e()})},p.clipLine=$n,p.clone=function(e){var t=new Ji(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},p.clone$1=Ye,p.clone$2=function(e){var t=new Ji(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},p.collisionCircleLayout=yp,p.config=tr,p.create=function(){var e=new Ji(16);return Ji!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e},p.create$1=function(){var e=new Ji(9);return Ji!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e},p.create$2=function(){var e=new Ji(4);return Ji!=Float32Array&&(e[1]=0,e[2]=0),e[0]=1,e[3]=1,e},p.createCommonjsModule=w,p.createExpression=Il,p.createLayout=So,p.createStyleLayer=function(e){return e.type==="custom"?new Vo(e):new Ru[e.type](e)},p.cross=function(e,t,r){var c=t[0],v=t[1],m=t[2],_=r[0],C=r[1],k=r[2];return e[0]=v*k-m*C,e[1]=m*_-c*k,e[2]=c*C-v*_,e},p.deepEqual=function e(t,r){if(Array.isArray(t)){if(!Array.isArray(r)||t.length!==r.length)return!1;for(var c=0;c<t.length;c++)if(!e(t[c],r[c]))return!1;return!0}if(typeof t=="object"&&t!==null&&r!==null){if(typeof r!="object"||Object.keys(t).length!==Object.keys(r).length)return!1;for(var v in t)if(!e(t[v],r[v]))return!1;return!0}return t===r},p.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]},p.dot$1=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]},p.ease=Ie,p.emitValidationErrors=Bu,p.endsWith=Gt,p.enforceCacheSizeLimit=function(e){lr(),Ht&&Ht.then(function(t){t.keys().then(function(r){for(var c=0;c<r.length-e;c++)t.delete(r[c])})})},p.evaluateSizeForFeature=wo,p.evaluateSizeForZoom=qo,p.evaluateVariableOffset=at,p.evented=ef,p.extend=Xt,p.featureFilter=Rl,p.filterObject=gt,p.fromRotation=function(e,t){var r=Math.sin(t),c=Math.cos(t);return e[0]=c,e[1]=r,e[2]=0,e[3]=-r,e[4]=c,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},p.getAnchorAlignment=Qo,p.getAnchorJustification=Ot,p.getArrayBuffer=Wi,p.getImage=I,p.getJSON=function(e,t){return Ri(Xt(e,{type:"json"}),t)},p.getRTLTextPluginStatus=Uc,p.getReferrer=Cn,p.getVideo=function(e,t){var r,c,v=ne.document.createElement("video");v.muted=!0,v.onloadstart=function(){t(null,v)};for(var m=0;m<e.length;m++){var _=ne.document.createElement("source");r=e[m],c=void 0,(c=ne.document.createElement("a")).href=r,(c.protocol!==ne.document.location.protocol||c.host!==ne.document.location.host)&&(v.crossOrigin="Anonymous"),_.src=e[m],v.appendChild(_)}return{cancel:function(){}}},p.identity=No,p.invert=function(e,t){var r=t[0],c=t[1],v=t[2],m=t[3],_=t[4],C=t[5],k=t[6],B=t[7],W=t[8],K=t[9],oe=t[10],ce=t[11],Ve=t[12],We=t[13],st=t[14],et=t[15],Tt=r*C-c*_,Ut=r*k-v*_,nr=r*B-m*_,hr=c*k-v*C,Mr=c*B-m*C,Yr=v*B-m*k,hn=W*We-K*Ve,Hn=W*st-oe*Ve,wn=W*et-ce*Ve,Jn=K*st-oe*We,yn=K*et-ce*We,Ui=oe*et-ce*st,hi=Tt*Ui-Ut*yn+nr*Jn+hr*wn-Mr*Hn+Yr*hn;return hi?(e[0]=(C*Ui-k*yn+B*Jn)*(hi=1/hi),e[1]=(v*yn-c*Ui-m*Jn)*hi,e[2]=(We*Yr-st*Mr+et*hr)*hi,e[3]=(oe*Mr-K*Yr-ce*hr)*hi,e[4]=(k*wn-_*Ui-B*Hn)*hi,e[5]=(r*Ui-v*wn+m*Hn)*hi,e[6]=(st*nr-Ve*Yr-et*Ut)*hi,e[7]=(W*Yr-oe*nr+ce*Ut)*hi,e[8]=(_*yn-C*wn+B*hn)*hi,e[9]=(c*wn-r*yn-m*hn)*hi,e[10]=(Ve*Mr-We*nr+et*Tt)*hi,e[11]=(K*nr-W*Mr-ce*Tt)*hi,e[12]=(C*Hn-_*Jn-k*hn)*hi,e[13]=(r*Jn-c*Hn+v*hn)*hi,e[14]=(We*Ut-Ve*hr-st*Tt)*hi,e[15]=(W*hr-K*Ut+oe*Tt)*hi,e):null},p.isChar=Jr,p.isMapboxURL=S,p.keysDifference=function(e,t){var r=[];for(var c in e)c in t||r.push(c);return r},p.makeRequest=Ri,p.mapObject=ar,p.mercatorXfromLng=Zp,p.mercatorYfromLat=Vp,p.mercatorZfromAltitude=Gp,p.mul=ru,p.multiply=go,p.mvt=_o,p.nextPowerOfTwo=function(e){return e<=1?1:Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))},p.normalize=function(e,t){var r=t[0],c=t[1],v=t[2],m=r*r+c*c+v*v;return m>0&&(m=1/Math.sqrt(m)),e[0]=t[0]*m,e[1]=t[1]*m,e[2]=t[2]*m,e},p.number=Nn,p.offscreenCanvasSupported=Qt,p.ortho=function(e,t,r,c,v,m,_){var C=1/(t-r),k=1/(c-v),B=1/(m-_);return e[0]=-2*C,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*k,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*B,e[11]=0,e[12]=(t+r)*C,e[13]=(v+c)*k,e[14]=(_+m)*B,e[15]=1,e},p.parseGlyphPBF=function(e){return new Se(e).readFields(Dr,[])},p.pbf=Se,p.performSymbolLayout=function(e,t,r,c,v,m,_){e.createArrays(),e.tilePixelRatio=8192/(512*e.overscaling),e.compareText={},e.iconsNeedLinear=!1;var C=e.layers[0].layout,k=e.layers[0]._unevaluatedLayout._values,B={};if(e.textSizeData.kind==="composite"){var W=e.textSizeData,K=W.maxZoom;B.compositeTextSizes=[k["text-size"].possiblyEvaluate(new Fi(W.minZoom),_),k["text-size"].possiblyEvaluate(new Fi(K),_)]}if(e.iconSizeData.kind==="composite"){var oe=e.iconSizeData,ce=oe.maxZoom;B.compositeIconSizes=[k["icon-size"].possiblyEvaluate(new Fi(oe.minZoom),_),k["icon-size"].possiblyEvaluate(new Fi(ce),_)]}B.layoutTextSize=k["text-size"].possiblyEvaluate(new Fi(e.zoom+1),_),B.layoutIconSize=k["icon-size"].possiblyEvaluate(new Fi(e.zoom+1),_),B.textMaxSize=k["text-size"].possiblyEvaluate(new Fi(18));for(var Ve=24*C.get("text-line-height"),We=C.get("text-rotation-alignment")==="map"&&C.get("symbol-placement")!=="point",st=C.get("text-keep-upright"),et=C.get("text-size"),Tt=function(){var hr=nr[Ut],Mr=C.get("text-font").evaluate(hr,{},_).join(","),Yr=et.evaluate(hr,{},_),hn=B.layoutTextSize.evaluate(hr,{},_),Hn=B.layoutIconSize.evaluate(hr,{},_),wn={horizontal:{},vertical:void 0},Jn=hr.text,yn=[0,0];if(Jn){var Ui=Jn.toString(),hi=24*C.get("text-letter-spacing").evaluate(hr,{},_),Zn=function(aa){for(var Ia=0,Fa=aa;Ia<Fa.length;Ia+=1)if(va=Fa[Ia].charCodeAt(0),Jr.Arabic(va)||Jr["Arabic Supplement"](va)||Jr["Arabic Extended-A"](va)||Jr["Arabic Presentation Forms-A"](va)||Jr["Arabic Presentation Forms-B"](va))return!1;var va;return!0}(Ui)?hi:0,ea=C.get("text-anchor").evaluate(hr,{},_),zi=C.get("text-variable-anchor");if(!zi){var ca=C.get("text-radial-offset").evaluate(hr,{},_);yn=ca?at(ea,[24*ca,_e]):C.get("text-offset").evaluate(hr,{},_).map(function(aa){return 24*aa})}var ei=We?"center":C.get("text-justify").evaluate(hr,{},_),wa=C.get("symbol-placement"),To=wa==="point"?24*C.get("text-max-width").evaluate(hr,{},_):0,Oo=function(){e.allowVerticalPlacement&&Bc(Ui)&&(wn.vertical=Or(Jn,t,r,v,Mr,To,Ve,ea,"left",Zn,yn,Yn.vertical,!0,wa,hn,Yr))};if(!We&&zi){for(var xo=ei==="auto"?zi.map(function(aa){return Ot(aa)}):[ei],Ao=!1,Lo=0;Lo<xo.length;Lo++){var As=xo[Lo];if(!wn.horizontal[As])if(Ao)wn.horizontal[As]=wn.horizontal[0];else{var zs=Or(Jn,t,r,v,Mr,To,Ve,"center",As,Zn,yn,Yn.horizontal,!1,wa,hn,Yr);zs&&(wn.horizontal[As]=zs,Ao=zs.positionedLines.length===1)}}Oo()}else{ei==="auto"&&(ei=Ot(ea));var ou=Or(Jn,t,r,v,Mr,To,Ve,ea,ei,Zn,yn,Yn.horizontal,!1,wa,hn,Yr);ou&&(wn.horizontal[ei]=ou),Oo(),Bc(Ui)&&We&&st&&(wn.vertical=Or(Jn,t,r,v,Mr,To,Ve,ea,ei,Zn,yn,Yn.vertical,!1,wa,hn,Yr))}}var Ns=void 0,Du=!1;if(hr.icon&&hr.icon.name){var Ho=c[hr.icon.name];Ho&&(Ns=function(aa,Ia,Fa){var va=Qo(Fa),ys=Ia[0]-aa.displaySize[0]*va.horizontalAlign,Hs=Ia[1]-aa.displaySize[1]*va.verticalAlign;return{image:aa,top:Hs,bottom:Hs+aa.displaySize[1],left:ys,right:ys+aa.displaySize[0]}}(v[hr.icon.name],C.get("icon-offset").evaluate(hr,{},_),C.get("icon-anchor").evaluate(hr,{},_)),Du=Ho.sdf,e.sdfIcons===void 0?e.sdfIcons=Ho.sdf:e.sdfIcons!==Ho.sdf&&Ne("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Ho.pixelRatio!==e.pixelRatio||C.get("icon-rotate").constantOr(1)!==0)&&(e.iconsNeedLinear=!0))}var Bs=ft(wn.horizontal)||wn.vertical;e.iconsInText=!!Bs&&Bs.iconsInText,(Bs||Ns)&&function(aa,Ia,Fa,va,ys,Hs,Ha,cs,su,oa,Wc){var Cl=Hs.textMaxSize.evaluate(Ia,{});Cl===void 0&&(Cl=Ha);var of,fs=aa.layers[0].layout,sf=fs.get("icon-offset").evaluate(Ia,{},Wc),Ec=ft(Fa.horizontal),Eh=Ha/24,nh=aa.tilePixelRatio*Eh,wh=aa.tilePixelRatio*Cl/24,Xc=aa.tilePixelRatio*cs,Nf=aa.tilePixelRatio*fs.get("symbol-spacing"),Ep=fs.get("text-padding")*aa.tilePixelRatio,Mf=fs.get("icon-padding")*aa.tilePixelRatio,uf=fs.get("text-max-angle")/180*Math.PI,wp=fs.get("text-rotation-alignment")==="map"&&fs.get("symbol-placement")!=="point",ih=fs.get("icon-rotation-alignment")==="map"&&fs.get("symbol-placement")!=="point",wc=fs.get("symbol-placement"),lf=Nf/2,ah=fs.get("icon-text-fit");va&&ah!=="none"&&(aa.allowVerticalPlacement&&Fa.vertical&&(of=Qi(va,Fa.vertical,ah,fs.get("icon-text-fit-padding"),sf,Eh)),Ec&&(va=Qi(va,Ec,ah,fs.get("icon-text-fit-padding"),sf,Eh)));var cf=function(Cd,Mh){Mh.x<0||Mh.x>=8192||Mh.y<0||Mh.y>=8192||function(ts,Tc,Pd,hf,Ap,$p,rp,Ac,np,Ih,ip,ap,Cp,Jp,lh,Qp,qp,ed,td,rd,Pl,op,nd,Cc,Md){var id,jf,Zf,ch,fh,hh=ts.addToLineVertexArray(Tc,Pd),ad=0,od=0,sd=0,Pp=0,Mp=-1,Ip=-1,pf={},ud=ze(""),Op=0,Lp=0;if(Ac._unevaluatedLayout.getValue("text-radial-offset")===void 0?(Op=(id=Ac.layout.get("text-offset").evaluate(Pl,{},Cc).map(function(lp){return 24*lp}))[0],Lp=id[1]):(Op=24*Ac.layout.get("text-radial-offset").evaluate(Pl,{},Cc),Lp=_e),ts.allowVerticalPlacement&&hf.vertical){var ld=Ac.layout.get("text-rotate").evaluate(Pl,{},Cc)+90;ch=new Fe(np,Tc,Ih,ip,ap,hf.vertical,Cp,Jp,lh,ld),rp&&(fh=new Fe(np,Tc,Ih,ip,ap,rp,qp,ed,lh,ld))}if(Ap){var Rp=Ac.layout.get("icon-rotate").evaluate(Pl,{}),Dp=Ac.layout.get("icon-text-fit")!=="none",kp=Hi(Ap,Rp,nd,Dp),sp=rp?Hi(rp,Rp,nd,Dp):void 0;Zf=new Fe(np,Tc,Ih,ip,ap,Ap,qp,ed,!1,Rp),ad=4*kp.length;var Vf=ts.iconSizeData,ph=null;Vf.kind==="source"?(ph=[128*Ac.layout.get("icon-size").evaluate(Pl,{})])[0]>32640&&Ne(ts.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'):Vf.kind==="composite"&&((ph=[128*op.compositeIconSizes[0].evaluate(Pl,{},Cc),128*op.compositeIconSizes[1].evaluate(Pl,{},Cc)])[0]>32640||ph[1]>32640)&&Ne(ts.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'),ts.addSymbols(ts.icon,kp,ph,rd,td,Pl,!1,Tc,hh.lineStartIndex,hh.lineLength,-1,Cc),Mp=ts.icon.placedSymbolArray.length-1,sp&&(od=4*sp.length,ts.addSymbols(ts.icon,sp,ph,rd,td,Pl,Yn.vertical,Tc,hh.lineStartIndex,hh.lineLength,-1,Cc),Ip=ts.icon.placedSymbolArray.length-1)}for(var cd in hf.horizontal){var up=hf.horizontal[cd];if(!jf){ud=ze(up.text);var Id=Ac.layout.get("text-rotate").evaluate(Pl,{},Cc);jf=new Fe(np,Tc,Ih,ip,ap,up,Cp,Jp,lh,Id)}var fd=up.positionedLines.length===1;if(sd+=kt(ts,Tc,up,$p,Ac,lh,Pl,Qp,hh,hf.vertical?Yn.horizontal:Yn.horizontalOnly,fd?Object.keys(hf.horizontal):[cd],pf,Mp,op,Cc),fd)break}hf.vertical&&(Pp+=kt(ts,Tc,hf.vertical,$p,Ac,lh,Pl,Qp,hh,Yn.vertical,["vertical"],pf,Ip,op,Cc));var Oh=jf?jf.boxStartIndex:ts.collisionBoxArray.length,Lh=jf?jf.boxEndIndex:ts.collisionBoxArray.length,Rh=ch?ch.boxStartIndex:ts.collisionBoxArray.length,Dh=ch?ch.boxEndIndex:ts.collisionBoxArray.length,Od=Zf?Zf.boxStartIndex:ts.collisionBoxArray.length,hd=Zf?Zf.boxEndIndex:ts.collisionBoxArray.length,Fp=fh?fh.boxStartIndex:ts.collisionBoxArray.length,Ld=fh?fh.boxEndIndex:ts.collisionBoxArray.length,Yc=-1,kh=function(lp,Fh){return lp&&lp.circleDiameter?Math.max(lp.circleDiameter,Fh):Fh};Yc=kh(jf,Yc),Yc=kh(ch,Yc),Yc=kh(Zf,Yc);var pd=(Yc=kh(fh,Yc))>-1?1:0;pd&&(Yc*=Md/24),ts.glyphOffsetArray.length>=Kt.MAX_GLYPHS&&Ne("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Pl.sortKey!==void 0&&ts.addToSortKeyRanges(ts.symbolInstances.length,Pl.sortKey),ts.symbolInstances.emplaceBack(Tc.x,Tc.y,pf.right>=0?pf.right:-1,pf.center>=0?pf.center:-1,pf.left>=0?pf.left:-1,pf.vertical||-1,Mp,Ip,ud,Oh,Lh,Rh,Dh,Od,hd,Fp,Ld,Ih,sd,Pp,ad,od,pd,0,Cp,Op,Lp,Yc)}(aa,Mh,Cd,Fa,va,ys,of,aa.layers[0],aa.collisionBoxArray,Ia.index,Ia.sourceLayerIndex,aa.index,nh,Ep,wp,su,Xc,Mf,ih,sf,Ia,Hs,oa,Wc,Ha)};if(wc==="line")for(var _s=0,$h=$n(Ia.geometry,0,0,8192,8192);_s<$h.length;_s+=1)for(var Jh=$h[_s],Oa=0,Th=la(Jh,Nf,uf,Fa.vertical||Ec,va,24,wh,aa.overscaling,8192);Oa<Th.length;Oa+=1){var If=Th[Oa];Ec&&ot(aa,Ec.text,lf,If)||cf(Jh,If)}else if(wc==="line-center")for(var ff=0,Ah=Ia.geometry;ff<Ah.length;ff+=1){var Ch=Ah[ff];if(Ch.length>1){var Qh=Fs(Ch,uf,Fa.vertical||Ec,va,24,wh);Qh&&cf(Ch,Qh)}}else if(Ia.type==="Polygon")for(var oh=0,qh=vt(Ia.geometry,0);oh<qh.length;oh+=1){var Bf=qh[oh],sh=An(Bf,16);cf(Bf[0],new Eo(sh.x,sh.y,0))}else if(Ia.type==="LineString")for(var Uf=0,Ph=Ia.geometry;Uf<Ph.length;Uf+=1){var uh=Ph[Uf];cf(uh,new Eo(uh[0].x,uh[0].y,0))}else if(Ia.type==="Point")for(var ep=0,Yp=Ia.geometry;ep<Yp.length;ep+=1)for(var tp=0,Kp=Yp[ep];tp<Kp.length;tp+=1){var Tp=Kp[tp];cf([Tp],new Eo(Tp.x,Tp.y,0))}}(e,hr,wn,Ns,c,B,hn,Hn,yn,Du,_)},Ut=0,nr=e.features;Ut<nr.length;Ut+=1)Tt();m&&e.generateCollisionDebugBuffers()},p.perspective=function(e,t,r,c,v){var m,_=1/Math.tan(t/2);return e[0]=_/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=_,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,v!=null&&v!==1/0?(e[10]=(v+c)*(m=1/(c-v)),e[14]=2*v*c*m):(e[10]=-1,e[14]=-2*c),e},p.pick=function(e,t){for(var r={},c=0;c<t.length;c++){var v=t[c];v in e&&(r[v]=e[v])}return r},p.plugin=Qs,p.polygonIntersectsPolygon=Cu,p.postMapLoadEvent=Ke,p.postTurnstileEvent=Ar,p.potpack=sn,p.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],p.register=Tn,p.registerForPluginStateChange=function(e){return e({pluginStatus:Os,pluginURL:ju}),ef.on("pluginStateChange",e),e},p.renderColorRamp=Hf,p.rotate=function(e,t,r){var c=t[0],v=t[1],m=t[2],_=t[3],C=Math.sin(r),k=Math.cos(r);return e[0]=c*k+m*C,e[1]=v*k+_*C,e[2]=c*-C+m*k,e[3]=v*-C+_*k,e},p.rotateX=function(e,t,r){var c=Math.sin(r),v=Math.cos(r),m=t[4],_=t[5],C=t[6],k=t[7],B=t[8],W=t[9],K=t[10],oe=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=m*v+B*c,e[5]=_*v+W*c,e[6]=C*v+K*c,e[7]=k*v+oe*c,e[8]=B*v-m*c,e[9]=W*v-_*c,e[10]=K*v-C*c,e[11]=oe*v-k*c,e},p.rotateZ=function(e,t,r){var c=Math.sin(r),v=Math.cos(r),m=t[0],_=t[1],C=t[2],k=t[3],B=t[4],W=t[5],K=t[6],oe=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=m*v+B*c,e[1]=_*v+W*c,e[2]=C*v+K*c,e[3]=k*v+oe*c,e[4]=B*v-m*c,e[5]=W*v-_*c,e[6]=K*v-C*c,e[7]=oe*v-k*c,e},p.scale=function(e,t,r){var c=r[0],v=r[1],m=r[2];return e[0]=t[0]*c,e[1]=t[1]*c,e[2]=t[2]*c,e[3]=t[3]*c,e[4]=t[4]*v,e[5]=t[5]*v,e[6]=t[6]*v,e[7]=t[7]*v,e[8]=t[8]*m,e[9]=t[9]*m,e[10]=t[10]*m,e[11]=t[11]*m,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},p.scale$1=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e},p.scale$2=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e},p.setCacheLimits=function(e,t){yt=e,lt=t},p.setRTLTextPlugin=function(e,t,r){if(r===void 0&&(r=!1),Os==="deferred"||Os==="loading"||Os==="loaded")throw new Error("setRTLTextPlugin cannot be called multiple times.");ju=ln.resolveURL(e),Os="deferred",vc=t,zl(),r||Eu()},p.sphericalToCartesian=function(e){var t=e[0],r=e[1],c=e[2];return r+=90,r*=Math.PI/180,c*=Math.PI/180,{x:t*Math.cos(r)*Math.sin(c),y:t*Math.sin(r)*Math.sin(c),z:t*Math.cos(c)}},p.sqrLen=function(e){var t=e[0],r=e[1];return t*t+r*r},p.styleSpec=ue,p.sub=function(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e},p.symbolSize=es,p.transformMat3=function(e,t,r){var c=t[0],v=t[1],m=t[2];return e[0]=c*r[0]+v*r[3]+m*r[6],e[1]=c*r[1]+v*r[4]+m*r[7],e[2]=c*r[2]+v*r[5]+m*r[8],e},p.transformMat4=mu,p.translate=function(e,t,r){var c,v,m,_,C,k,B,W,K,oe,ce,Ve,We=r[0],st=r[1],et=r[2];return t===e?(e[12]=t[0]*We+t[4]*st+t[8]*et+t[12],e[13]=t[1]*We+t[5]*st+t[9]*et+t[13],e[14]=t[2]*We+t[6]*st+t[10]*et+t[14],e[15]=t[3]*We+t[7]*st+t[11]*et+t[15]):(v=t[1],m=t[2],_=t[3],C=t[4],k=t[5],B=t[6],W=t[7],K=t[8],oe=t[9],ce=t[10],Ve=t[11],e[0]=c=t[0],e[1]=v,e[2]=m,e[3]=_,e[4]=C,e[5]=k,e[6]=B,e[7]=W,e[8]=K,e[9]=oe,e[10]=ce,e[11]=Ve,e[12]=c*We+C*st+K*et+t[12],e[13]=v*We+k*st+oe*et+t[13],e[14]=m*We+B*st+ce*et+t[14],e[15]=_*We+W*st+Ve*et+t[15]),e},p.triggerPluginCompletionEvent=_l,p.uniqueId=Lt,p.validateCustomStyleLayer=function(e){var t=[],r=e.id;return r===void 0&&t.push({message:"layers."+r+': missing required property "id"'}),e.render===void 0&&t.push({message:"layers."+r+': missing required method "render"'}),e.renderingMode&&e.renderingMode!=="2d"&&e.renderingMode!=="3d"&&t.push({message:"layers."+r+': property "renderingMode" must be either "2d" or "3d"'}),t},p.validateLight=yf,p.validateStyle=ec,p.values=function(e){var t=[];for(var r in e)t.push(e[r]);return t},p.vectorTile=_o,p.version="1.13.1",p.warnOnce=Ne,p.webpSupported=se,p.window=ne,p.wrap=Zt}),E(["./shared"],function(p){"use strict";function w(G){var I=typeof G;if(I==="number"||I==="boolean"||I==="string"||G==null)return JSON.stringify(G);if(Array.isArray(G)){for(var Z="[",$=0,ie=G;$<ie.length;$+=1)Z+=w(ie[$])+",";return Z+"]"}for(var Le=Object.keys(G).sort(),Ge="{",ue=0;ue<Le.length;ue++)Ge+=JSON.stringify(Le[ue])+":"+w(G[Le[ue]])+",";return Ge+"}"}function F(G){for(var I="",Z=0,$=p.refProperties;Z<$.length;Z+=1)I+="/"+w(G[$[Z]]);return I}var Q=function(G){this.keyCache={},G&&this.replace(G)};Q.prototype.replace=function(G){this._layerConfigs={},this._layers={},this.update(G,[])},Q.prototype.update=function(G,I){for(var Z=this,$=0,ie=G;$<ie.length;$+=1){var Le=ie[$];this._layerConfigs[Le.id]=Le;var Ge=this._layers[Le.id]=p.createStyleLayer(Le);Ge._featureFilter=p.featureFilter(Ge.filter),this.keyCache[Le.id]&&delete this.keyCache[Le.id]}for(var ue=0,De=I;ue<De.length;ue+=1){var wt=De[ue];delete this.keyCache[wt],delete this._layerConfigs[wt],delete this._layers[wt]}this.familiesBySource={};for(var Ir=0,Ur=function($r,cn){for(var pi={},pn=0;pn<$r.length;pn++){var _i=cn&&cn[$r[pn].id]||F($r[pn]);cn&&(cn[$r[pn].id]=_i);var Xi=pi[_i];Xi||(Xi=pi[_i]=[]),Xi.push($r[pn])}var mi=[];for(var Di in pi)mi.push(pi[Di]);return mi}(p.values(this._layerConfigs),this.keyCache);Ir<Ur.length;Ir+=1){var jt=Ur[Ir].map(function($r){return Z._layers[$r.id]}),dr=jt[0];if(dr.visibility!=="none"){var Hr=dr.source||"",_n=this.familiesBySource[Hr];_n||(_n=this.familiesBySource[Hr]={});var vr=dr.sourceLayer||"_geojsonTileLayer",vn=_n[vr];vn||(vn=_n[vr]=[]),vn.push(jt)}}};var Y=function(G){var I={},Z=[];for(var $ in G){var ie=G[$],Le=I[$]={};for(var Ge in ie){var ue=ie[+Ge];if(ue&&ue.bitmap.width!==0&&ue.bitmap.height!==0){var De={x:0,y:0,w:ue.bitmap.width+2,h:ue.bitmap.height+2};Z.push(De),Le[Ge]={rect:De,metrics:ue.metrics}}}}var wt=p.potpack(Z),Ir=new p.AlphaImage({width:wt.w||1,height:wt.h||1});for(var Ur in G){var jt=G[Ur];for(var dr in jt){var Hr=jt[+dr];if(Hr&&Hr.bitmap.width!==0&&Hr.bitmap.height!==0){var _n=I[Ur][dr].rect;p.AlphaImage.copy(Hr.bitmap,Ir,{x:0,y:0},{x:_n.x+1,y:_n.y+1},Hr.bitmap)}}}this.image=Ir,this.positions=I};p.register("GlyphAtlas",Y);var le=function(G){this.tileID=new p.OverscaledTileID(G.tileID.overscaledZ,G.tileID.wrap,G.tileID.canonical.z,G.tileID.canonical.x,G.tileID.canonical.y),this.uid=G.uid,this.zoom=G.zoom,this.pixelRatio=G.pixelRatio,this.tileSize=G.tileSize,this.source=G.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=G.showCollisionBoxes,this.collectResourceTiming=!!G.collectResourceTiming,this.returnDependencies=!!G.returnDependencies,this.promoteId=G.promoteId};function ne(G,I,Z){for(var $=new p.EvaluationParameters(I),ie=0,Le=G;ie<Le.length;ie+=1)Le[ie].recalculate($,Z)}function be(G,I){var Z=p.getArrayBuffer(G.request,function($,ie,Le,Ge){$?I($):ie&&I(null,{vectorTile:new p.vectorTile.VectorTile(new p.pbf(ie)),rawData:ie,cacheControl:Le,expires:Ge})});return function(){Z.cancel(),I()}}le.prototype.parse=function(G,I,Z,$,ie){var Le=this;this.status="parsing",this.data=G,this.collisionBoxArray=new p.CollisionBoxArray;var Ge=new p.DictionaryCoder(Object.keys(G.layers).sort()),ue=new p.FeatureIndex(this.tileID,this.promoteId);ue.bucketLayerIDs=[];var De,wt,Ir,Ur,jt={},dr={featureIndex:ue,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:Z},Hr=I.familiesBySource[this.source];for(var _n in Hr){var vr=G.layers[_n];if(vr){vr.version===1&&p.warnOnce('Vector tile source "'+this.source+'" layer "'+_n+'" does not use vector tile spec v2 and therefore may have some rendering errors.');for(var vn=Ge.encode(_n),$r=[],cn=0;cn<vr.length;cn++){var pi=vr.feature(cn),pn=ue.getId(pi,_n);$r.push({feature:pi,id:pn,index:cn,sourceLayerIndex:vn})}for(var _i=0,Xi=Hr[_n];_i<Xi.length;_i+=1){var mi=Xi[_i],Di=mi[0];Di.minzoom&&this.zoom<Math.floor(Di.minzoom)||Di.maxzoom&&this.zoom>=Di.maxzoom||Di.visibility!=="none"&&(ne(mi,this.zoom,Z),(jt[Di.id]=Di.createBucket({index:ue.bucketLayerIDs.length,layers:mi,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:vn,sourceID:this.source})).populate($r,dr,this.tileID.canonical),ue.bucketLayerIDs.push(mi.map(function(Dn){return Dn.id})))}}}var Pi=p.mapObject(dr.glyphDependencies,function(Dn){return Object.keys(Dn).map(Number)});Object.keys(Pi).length?$.send("getGlyphs",{uid:this.uid,stacks:Pi},function(Dn,li){De||(De=Dn,wt=li,Rn.call(Le))}):wt={};var po=Object.keys(dr.iconDependencies);po.length?$.send("getImages",{icons:po,source:this.source,tileID:this.tileID,type:"icons"},function(Dn,li){De||(De=Dn,Ir=li,Rn.call(Le))}):Ir={};var ji=Object.keys(dr.patternDependencies);function Rn(){if(De)return ie(De);if(wt&&Ir&&Ur){var Dn=new Y(wt),li=new p.ImageAtlas(Ir,Ur);for(var Vn in jt){var Na=jt[Vn];Na instanceof p.SymbolBucket?(ne(Na.layers,this.zoom,Z),p.performSymbolLayout(Na,wt,Dn.positions,Ir,li.iconPositions,this.showCollisionBoxes,this.tileID.canonical)):Na.hasPattern&&(Na instanceof p.LineBucket||Na instanceof p.FillBucket||Na instanceof p.FillExtrusionBucket)&&(ne(Na.layers,this.zoom,Z),Na.addFeatures(dr,this.tileID.canonical,li.patternPositions))}this.status="done",ie(null,{buckets:p.values(jt).filter(function(ps){return!ps.isEmpty()}),featureIndex:ue,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Dn.image,imageAtlas:li,glyphMap:this.returnDependencies?wt:null,iconMap:this.returnDependencies?Ir:null,glyphPositions:this.returnDependencies?Dn.positions:null})}}ji.length?$.send("getImages",{icons:ji,source:this.source,tileID:this.tileID,type:"patterns"},function(Dn,li){De||(De=Dn,Ur=li,Rn.call(Le))}):Ur={},Rn.call(this)};var we=function(G,I,Z,$){this.actor=G,this.layerIndex=I,this.availableImages=Z,this.loadVectorData=$||be,this.loading={},this.loaded={}};we.prototype.loadTile=function(G,I){var Z=this,$=G.uid;this.loading||(this.loading={});var ie=!!(G&&G.request&&G.request.collectResourceTiming)&&new p.RequestPerformance(G.request),Le=this.loading[$]=new le(G);Le.abort=this.loadVectorData(G,function(Ge,ue){if(delete Z.loading[$],Ge||!ue)return Le.status="done",Z.loaded[$]=Le,I(Ge);var De=ue.rawData,wt={};ue.expires&&(wt.expires=ue.expires),ue.cacheControl&&(wt.cacheControl=ue.cacheControl);var Ir={};if(ie){var Ur=ie.finish();Ur&&(Ir.resourceTiming=JSON.parse(JSON.stringify(Ur)))}Le.vectorTile=ue.vectorTile,Le.parse(ue.vectorTile,Z.layerIndex,Z.availableImages,Z.actor,function(jt,dr){if(jt||!dr)return I(jt);I(null,p.extend({rawTileData:De.slice(0)},dr,wt,Ir))}),Z.loaded=Z.loaded||{},Z.loaded[$]=Le})},we.prototype.reloadTile=function(G,I){var Z=this,$=this.loaded,ie=G.uid,Le=this;if($&&$[ie]){var Ge=$[ie];Ge.showCollisionBoxes=G.showCollisionBoxes;var ue=function(De,wt){var Ir=Ge.reloadCallback;Ir&&(delete Ge.reloadCallback,Ge.parse(Ge.vectorTile,Le.layerIndex,Z.availableImages,Le.actor,Ir)),I(De,wt)};Ge.status==="parsing"?Ge.reloadCallback=ue:Ge.status==="done"&&(Ge.vectorTile?Ge.parse(Ge.vectorTile,this.layerIndex,this.availableImages,this.actor,ue):ue())}},we.prototype.abortTile=function(G,I){var Z=this.loading,$=G.uid;Z&&Z[$]&&Z[$].abort&&(Z[$].abort(),delete Z[$]),I()},we.prototype.removeTile=function(G,I){var Z=this.loaded,$=G.uid;Z&&Z[$]&&delete Z[$],I()};var Ie=p.window.ImageBitmap,$t=function(){this.loaded={}};function Zt(G,I){if(G.length!==0){Xt(G[0],I);for(var Z=1;Z<G.length;Z++)Xt(G[Z],!I)}}function Xt(G,I){for(var Z=0,$=0,ie=G.length,Le=ie-1;$<ie;Le=$++)Z+=(G[$][0]-G[Le][0])*(G[Le][1]+G[$][1]);Z>=0!=!!I&&G.reverse()}$t.prototype.loadTile=function(G,I){var Z=G.uid,$=G.encoding,ie=G.rawImageData,Le=Ie&&ie instanceof Ie?this.getImageData(ie):ie,Ge=new p.DEMData(Z,Le,$);this.loaded=this.loaded||{},this.loaded[Z]=Ge,I(null,Ge)},$t.prototype.getImageData=function(G){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(G.width,G.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=G.width,this.offscreenCanvas.height=G.height,this.offscreenCanvasContext.drawImage(G,0,0,G.width,G.height);var I=this.offscreenCanvasContext.getImageData(-1,-1,G.width+2,G.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new p.RGBAImage({width:I.width,height:I.height},I.data)},$t.prototype.removeTile=function(G){var I=this.loaded,Z=G.uid;I&&I[Z]&&delete I[Z]};var Ft=p.vectorTile.VectorTileFeature.prototype.toGeoJSON,Lt=function(G){this._feature=G,this.extent=p.EXTENT,this.type=G.type,this.properties=G.tags,"id"in G&&!isNaN(G.id)&&(this.id=parseInt(G.id,10))};Lt.prototype.loadGeometry=function(){if(this._feature.type===1){for(var G=[],I=0,Z=this._feature.geometry;I<Z.length;I+=1){var $=Z[I];G.push([new p.Point$1($[0],$[1])])}return G}for(var ie=[],Le=0,Ge=this._feature.geometry;Le<Ge.length;Le+=1){for(var ue=[],De=0,wt=Ge[Le];De<wt.length;De+=1){var Ir=wt[De];ue.push(new p.Point$1(Ir[0],Ir[1]))}ie.push(ue)}return ie},Lt.prototype.toGeoJSON=function(G,I,Z){return Ft.call(this,G,I,Z)};var _t=function(G){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=p.EXTENT,this.length=G.length,this._features=G};_t.prototype.feature=function(G){return new Lt(this._features[G])};var pt=p.vectorTile.VectorTileFeature,Cr=Gt;function Gt(G,I){this.options=I||{},this.features=G,this.length=G.length}function ar(G,I){this.id=typeof G.id=="number"?G.id:void 0,this.type=G.type,this.rawGeometry=G.type===1?[G.geometry]:G.geometry,this.properties=G.tags,this.extent=I||4096}Gt.prototype.feature=function(G){return new ar(this.features[G],this.options.extent)},ar.prototype.loadGeometry=function(){var G=this.rawGeometry;this.geometry=[];for(var I=0;I<G.length;I++){for(var Z=G[I],$=[],ie=0;ie<Z.length;ie++)$.push(new p.Point$1(Z[ie][0],Z[ie][1]));this.geometry.push($)}return this.geometry},ar.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var G=this.geometry,I=1/0,Z=-1/0,$=1/0,ie=-1/0,Le=0;Le<G.length;Le++)for(var Ge=G[Le],ue=0;ue<Ge.length;ue++){var De=Ge[ue];I=Math.min(I,De.x),Z=Math.max(Z,De.x),$=Math.min($,De.y),ie=Math.max(ie,De.y)}return[I,$,Z,ie]},ar.prototype.toGeoJSON=pt.prototype.toGeoJSON;var gt=Et,Ye=Cr;function Et(G){var I=new p.pbf;return function(Z,$){for(var ie in Z.layers)$.writeMessage(3,Ne,Z.layers[ie])}(G,I),I.finish()}function Ne(G,I){var Z;I.writeVarintField(15,G.version||1),I.writeStringField(1,G.name||""),I.writeVarintField(5,G.extent||4096);var $={keys:[],values:[],keycache:{},valuecache:{}};for(Z=0;Z<G.length;Z++)$.feature=G.feature(Z),I.writeMessage(2,Ae,$);var ie=$.keys;for(Z=0;Z<ie.length;Z++)I.writeStringField(3,ie[Z]);var Le=$.values;for(Z=0;Z<Le.length;Z++)I.writeMessage(4,Ee,Le[Z])}function Ae(G,I){var Z=G.feature;Z.id!==void 0&&I.writeVarintField(1,Z.id),I.writeMessage(2,Be,G),I.writeVarintField(3,Z.type),I.writeMessage(4,re,Z)}function Be(G,I){var Z=G.feature,$=G.keys,ie=G.values,Le=G.keycache,Ge=G.valuecache;for(var ue in Z.properties){var De=Le[ue];De===void 0&&($.push(ue),Le[ue]=De=$.length-1),I.writeVarint(De);var wt=Z.properties[ue],Ir=typeof wt;Ir!=="string"&&Ir!=="boolean"&&Ir!=="number"&&(wt=JSON.stringify(wt));var Ur=Ir+":"+wt,jt=Ge[Ur];jt===void 0&&(ie.push(wt),Ge[Ur]=jt=ie.length-1),I.writeVarint(jt)}}function bt(G,I){return(I<<3)+(7&G)}function ir(G){return G<<1^G>>31}function re(G,I){for(var Z=G.loadGeometry(),$=G.type,ie=0,Le=0,Ge=Z.length,ue=0;ue<Ge;ue++){var De=Z[ue],wt=1;$===1&&(wt=De.length),I.writeVarint(bt(1,wt));for(var Ir=$===3?De.length-1:De.length,Ur=0;Ur<Ir;Ur++){Ur===1&&$!==1&&I.writeVarint(bt(2,Ir-1));var jt=De[Ur].x-ie,dr=De[Ur].y-Le;I.writeVarint(ir(jt)),I.writeVarint(ir(dr)),ie+=jt,Le+=dr}$===3&&I.writeVarint(bt(7,1))}}function Ee(G,I){var Z=typeof G;Z==="string"?I.writeStringField(1,G):Z==="boolean"?I.writeBooleanField(7,G):Z==="number"&&(G%1!=0?I.writeDoubleField(3,G):G<0?I.writeSVarintField(6,G):I.writeVarintField(5,G))}function ae(G,I,Z,$){me(G,Z,$),me(I,2*Z,2*$),me(I,2*Z+1,2*$+1)}function me(G,I,Z){var $=G[I];G[I]=G[Z],G[Z]=$}function Te(G,I,Z,$){var ie=G-Z,Le=I-$;return ie*ie+Le*Le}gt.fromVectorTileJs=Et,gt.fromGeojsonVt=function(G,I){I=I||{};var Z={};for(var $ in G)Z[$]=new Cr(G[$].features,I),Z[$].name=$,Z[$].version=I.version,Z[$].extent=I.extent;return Et({layers:Z})},gt.GeoJSONWrapper=Ye;var Qe=function(G){return G[0]},dt=function(G){return G[1]},Jt=function(G,I,Z,$,ie){I===void 0&&(I=Qe),Z===void 0&&(Z=dt),$===void 0&&($=64),ie===void 0&&(ie=Float64Array),this.nodeSize=$,this.points=G;for(var Le=G.length<65536?Uint16Array:Uint32Array,Ge=this.ids=new Le(G.length),ue=this.coords=new ie(2*G.length),De=0;De<G.length;De++)Ge[De]=De,ue[2*De]=I(G[De]),ue[2*De+1]=Z(G[De]);(function wt(Ir,Ur,jt,dr,Hr,_n){if(!(Hr-dr<=jt)){var vr=dr+Hr>>1;(function vn($r,cn,pi,pn,_i,Xi){for(;_i>pn;){if(_i-pn>600){var mi=_i-pn+1,Di=pi-pn+1,Pi=Math.log(mi),po=.5*Math.exp(2*Pi/3),ji=.5*Math.sqrt(Pi*po*(mi-po)/mi)*(Di-mi/2<0?-1:1);vn($r,cn,pi,Math.max(pn,Math.floor(pi-Di*po/mi+ji)),Math.min(_i,Math.floor(pi+(mi-Di)*po/mi+ji)),Xi)}var Rn=cn[2*pi+Xi],Dn=pn,li=_i;for(ae($r,cn,pn,pi),cn[2*_i+Xi]>Rn&&ae($r,cn,pn,_i);Dn<li;){for(ae($r,cn,Dn,li),Dn++,li--;cn[2*Dn+Xi]<Rn;)Dn++;for(;cn[2*li+Xi]>Rn;)li--}cn[2*pn+Xi]===Rn?ae($r,cn,pn,li):ae($r,cn,++li,_i),li<=pi&&(pn=li+1),pi<=li&&(_i=li-1)}})(Ir,Ur,vr,dr,Hr,_n%2),wt(Ir,Ur,jt,dr,vr-1,_n+1),wt(Ir,Ur,jt,vr+1,Hr,_n+1)}})(Ge,ue,$,0,Ge.length-1,0)};Jt.prototype.range=function(G,I,Z,$){return function(ie,Le,Ge,ue,De,wt,Ir){for(var Ur,jt,dr=[0,ie.length-1,0],Hr=[];dr.length;){var _n=dr.pop(),vr=dr.pop(),vn=dr.pop();if(vr-vn<=Ir)for(var $r=vn;$r<=vr;$r++)jt=Le[2*$r+1],(Ur=Le[2*$r])>=Ge&&Ur<=De&&jt>=ue&&jt<=wt&&Hr.push(ie[$r]);else{var cn=Math.floor((vn+vr)/2);jt=Le[2*cn+1],(Ur=Le[2*cn])>=Ge&&Ur<=De&&jt>=ue&&jt<=wt&&Hr.push(ie[cn]);var pi=(_n+1)%2;(_n===0?Ge<=Ur:ue<=jt)&&(dr.push(vn),dr.push(cn-1),dr.push(pi)),(_n===0?De>=Ur:wt>=jt)&&(dr.push(cn+1),dr.push(vr),dr.push(pi))}}return Hr}(this.ids,this.coords,G,I,Z,$,this.nodeSize)},Jt.prototype.within=function(G,I,Z){return function($,ie,Le,Ge,ue,De){for(var wt=[0,$.length-1,0],Ir=[],Ur=ue*ue;wt.length;){var jt=wt.pop(),dr=wt.pop(),Hr=wt.pop();if(dr-Hr<=De)for(var _n=Hr;_n<=dr;_n++)Te(ie[2*_n],ie[2*_n+1],Le,Ge)<=Ur&&Ir.push($[_n]);else{var vr=Math.floor((Hr+dr)/2),vn=ie[2*vr],$r=ie[2*vr+1];Te(vn,$r,Le,Ge)<=Ur&&Ir.push($[vr]);var cn=(jt+1)%2;(jt===0?Le-ue<=vn:Ge-ue<=$r)&&(wt.push(Hr),wt.push(vr-1),wt.push(cn)),(jt===0?Le+ue>=vn:Ge+ue>=$r)&&(wt.push(vr+1),wt.push(dr),wt.push(cn))}}return Ir}(this.ids,this.coords,G,I,Z,this.nodeSize)};var Nr={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(G){return G}},Fr=function(G){this.options=Mt(Object.create(Nr),G),this.trees=new Array(this.options.maxZoom+1)};function ln(G,I,Z,$,ie){return{x:G,y:I,zoom:1/0,id:Z,parentId:-1,numPoints:$,properties:ie}}function tr(G,I){var Z=G.geometry.coordinates,$=Z[1];return{x:Re(Z[0]),y:tt($),zoom:1/0,index:I,parentId:-1}}function se(G){return{type:"Feature",id:G.id,properties:ge(G),geometry:{type:"Point",coordinates:[($=G.x,360*($-.5)),(I=G.y,Z=(180-360*I)*Math.PI/180,360*Math.atan(Math.exp(Z))/Math.PI-90)]}};var I,Z,$}function ge(G){var I=G.numPoints,Z=I>=1e4?Math.round(I/1e3)+"k":I>=1e3?Math.round(I/100)/10+"k":I;return Mt(Mt({},G.properties),{cluster:!0,cluster_id:G.id,point_count:I,point_count_abbreviated:Z})}function Re(G){return G/360+.5}function tt(G){var I=Math.sin(G*Math.PI/180),Z=.5-.25*Math.log((1+I)/(1-I))/Math.PI;return Z<0?0:Z>1?1:Z}function Mt(G,I){for(var Z in I)G[Z]=I[Z];return G}function Dt(G){return G.x}function S(G){return G.y}function z(G,I,Z,$,ie,Le){var Ge=ie-Z,ue=Le-$;if(Ge!==0||ue!==0){var De=((G-Z)*Ge+(I-$)*ue)/(Ge*Ge+ue*ue);De>1?(Z=ie,$=Le):De>0&&(Z+=Ge*De,$+=ue*De)}return(Ge=G-Z)*Ge+(ue=I-$)*ue}function pe(G,I,Z,$){var ie={id:G===void 0?null:G,type:I,geometry:Z,tags:$,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Le){var Ge=Le.geometry,ue=Le.type;if(ue==="Point"||ue==="MultiPoint"||ue==="LineString")Ue(Le,Ge);else if(ue==="Polygon"||ue==="MultiLineString")for(var De=0;De<Ge.length;De++)Ue(Le,Ge[De]);else if(ue==="MultiPolygon")for(De=0;De<Ge.length;De++)for(var wt=0;wt<Ge[De].length;wt++)Ue(Le,Ge[De][wt])}(ie),ie}function Ue(G,I){for(var Z=0;Z<I.length;Z+=3)G.minX=Math.min(G.minX,I[Z]),G.minY=Math.min(G.minY,I[Z+1]),G.maxX=Math.max(G.maxX,I[Z]),G.maxY=Math.max(G.maxY,I[Z+1])}function Je(G,I,Z,$){if(I.geometry){var ie=I.geometry.coordinates,Le=I.geometry.type,Ge=Math.pow(Z.tolerance/((1<<Z.maxZoom)*Z.extent),2),ue=[],De=I.id;if(Z.promoteId?De=I.properties[Z.promoteId]:Z.generateId&&(De=$||0),Le==="Point")mt(ie,ue);else if(Le==="MultiPoint")for(var wt=0;wt<ie.length;wt++)mt(ie[wt],ue);else if(Le==="LineString")Ct(ie,ue,Ge,!1);else if(Le==="MultiLineString"){if(Z.lineMetrics){for(wt=0;wt<ie.length;wt++)Ct(ie[wt],ue=[],Ge,!1),G.push(pe(De,"LineString",ue,I.properties));return}H(ie,ue,Ge,!1)}else if(Le==="Polygon")H(ie,ue,Ge,!0);else{if(Le!=="MultiPolygon"){if(Le==="GeometryCollection"){for(wt=0;wt<I.geometry.geometries.length;wt++)Je(G,{id:De,geometry:I.geometry.geometries[wt],properties:I.properties},Z,$);return}throw new Error("Input data is not a valid GeoJSON object.")}for(wt=0;wt<ie.length;wt++){var Ir=[];H(ie[wt],Ir,Ge,!0),ue.push(Ir)}}G.push(pe(De,Le,ue,I.properties))}}function mt(G,I){I.push(Ht(G[0])),I.push(Vt(G[1])),I.push(0)}function Ct(G,I,Z,$){for(var ie,Le,Ge=0,ue=0;ue<G.length;ue++){var De=Ht(G[ue][0]),wt=Vt(G[ue][1]);I.push(De),I.push(wt),I.push(0),ue>0&&(Ge+=$?(ie*wt-De*Le)/2:Math.sqrt(Math.pow(De-ie,2)+Math.pow(wt-Le,2))),ie=De,Le=wt}var Ir=I.length-3;I[2]=1,function Ur(jt,dr,Hr,_n){for(var vr,vn=_n,$r=Hr-dr>>1,cn=Hr-dr,pi=jt[dr],pn=jt[dr+1],_i=jt[Hr],Xi=jt[Hr+1],mi=dr+3;mi<Hr;mi+=3){var Di=z(jt[mi],jt[mi+1],pi,pn,_i,Xi);if(Di>vn)vr=mi,vn=Di;else if(Di===vn){var Pi=Math.abs(mi-$r);Pi<cn&&(vr=mi,cn=Pi)}}vn>_n&&(vr-dr>3&&Ur(jt,dr,vr,_n),jt[vr+2]=vn,Hr-vr>3&&Ur(jt,vr,Hr,_n))}(I,0,Ir,Z),I[Ir+2]=1,I.size=Math.abs(Ge),I.start=0,I.end=I.size}function H(G,I,Z,$){for(var ie=0;ie<G.length;ie++){var Le=[];Ct(G[ie],Le,Z,$),I.push(Le)}}function Ht(G){return G/360+.5}function Vt(G){var I=Math.sin(G*Math.PI/180),Z=.5-.25*Math.log((1+I)/(1-I))/Math.PI;return Z<0?0:Z>1?1:Z}function _r(G,I,Z,$,ie,Le,Ge,ue){if($/=I,Le>=(Z/=I)&&Ge<$)return G;if(Ge<Z||Le>=$)return null;for(var De=[],wt=0;wt<G.length;wt++){var Ir=G[wt],Ur=Ir.geometry,jt=Ir.type,dr=ie===0?Ir.minX:Ir.minY,Hr=ie===0?Ir.maxX:Ir.maxY;if(dr>=Z&&Hr<$)De.push(Ir);else if(!(Hr<Z||dr>=$)){var _n=[];if(jt==="Point"||jt==="MultiPoint")Er(Ur,_n,Z,$,ie);else if(jt==="LineString")Ar(Ur,_n,Z,$,ie,!1,ue.lineMetrics);else if(jt==="MultiLineString")Ke(Ur,_n,Z,$,ie,!1);else if(jt==="Polygon")Ke(Ur,_n,Z,$,ie,!0);else if(jt==="MultiPolygon")for(var vr=0;vr<Ur.length;vr++){var vn=[];Ke(Ur[vr],vn,Z,$,ie,!0),vn.length&&_n.push(vn)}if(_n.length){if(ue.lineMetrics&&jt==="LineString"){for(vr=0;vr<_n.length;vr++)De.push(pe(Ir.id,jt,_n[vr],Ir.tags));continue}jt!=="LineString"&&jt!=="MultiLineString"||(_n.length===1?(jt="LineString",_n=_n[0]):jt="MultiLineString"),jt!=="Point"&&jt!=="MultiPoint"||(jt=_n.length===3?"Point":"MultiPoint"),De.push(pe(Ir.id,jt,_n,Ir.tags))}}}return De.length?De:null}function Er(G,I,Z,$,ie){for(var Le=0;Le<G.length;Le+=3){var Ge=G[Le+ie];Ge>=Z&&Ge<=$&&(I.push(G[Le]),I.push(G[Le+1]),I.push(G[Le+2]))}}function Ar(G,I,Z,$,ie,Le,Ge){for(var ue,De,wt=Pr(G),Ir=ie===0?lt:lr,Ur=G.start,jt=0;jt<G.length-3;jt+=3){var dr=G[jt],Hr=G[jt+1],_n=G[jt+2],vr=G[jt+3],vn=G[jt+4],$r=ie===0?dr:Hr,cn=ie===0?vr:vn,pi=!1;Ge&&(ue=Math.sqrt(Math.pow(dr-vr,2)+Math.pow(Hr-vn,2))),$r<Z?cn>Z&&(De=Ir(wt,dr,Hr,vr,vn,Z),Ge&&(wt.start=Ur+ue*De)):$r>$?cn<$&&(De=Ir(wt,dr,Hr,vr,vn,$),Ge&&(wt.start=Ur+ue*De)):yt(wt,dr,Hr,_n),cn<Z&&$r>=Z&&(De=Ir(wt,dr,Hr,vr,vn,Z),pi=!0),cn>$&&$r<=$&&(De=Ir(wt,dr,Hr,vr,vn,$),pi=!0),!Le&&pi&&(Ge&&(wt.end=Ur+ue*De),I.push(wt),wt=Pr(G)),Ge&&(Ur+=ue)}var pn=G.length-3;dr=G[pn],Hr=G[pn+1],_n=G[pn+2],($r=ie===0?dr:Hr)>=Z&&$r<=$&&yt(wt,dr,Hr,_n),pn=wt.length-3,Le&&pn>=3&&(wt[pn]!==wt[0]||wt[pn+1]!==wt[1])&&yt(wt,wt[0],wt[1],wt[2]),wt.length&&I.push(wt)}function Pr(G){var I=[];return I.size=G.size,I.start=G.start,I.end=G.end,I}function Ke(G,I,Z,$,ie,Le){for(var Ge=0;Ge<G.length;Ge++)Ar(G[Ge],I,Z,$,ie,Le,!1)}function yt(G,I,Z,$){G.push(I),G.push(Z),G.push($)}function lt(G,I,Z,$,ie,Le){var Ge=(Le-I)/($-I);return G.push(Le),G.push(Z+(ie-Z)*Ge),G.push(1),Ge}function lr(G,I,Z,$,ie,Le){var Ge=(Le-Z)/(ie-Z);return G.push(I+($-I)*Ge),G.push(Le),G.push(1),Ge}function qr(G,I){for(var Z=[],$=0;$<G.length;$++){var ie,Le=G[$],Ge=Le.type;if(Ge==="Point"||Ge==="MultiPoint"||Ge==="LineString")ie=ut(Le.geometry,I);else if(Ge==="MultiLineString"||Ge==="Polygon"){ie=[];for(var ue=0;ue<Le.geometry.length;ue++)ie.push(ut(Le.geometry[ue],I))}else if(Ge==="MultiPolygon")for(ie=[],ue=0;ue<Le.geometry.length;ue++){for(var De=[],wt=0;wt<Le.geometry[ue].length;wt++)De.push(ut(Le.geometry[ue][wt],I));ie.push(De)}Z.push(pe(Le.id,Ge,ie,Le.tags))}return Z}function ut(G,I){var Z=[];Z.size=G.size,G.start!==void 0&&(Z.start=G.start,Z.end=G.end);for(var $=0;$<G.length;$+=3)Z.push(G[$]+I,G[$+1],G[$+2]);return Z}function It(G,I){if(G.transformed)return G;var Z,$,ie,Le=1<<G.z,Ge=G.x,ue=G.y;for(Z=0;Z<G.features.length;Z++){var De=G.features[Z],wt=De.geometry,Ir=De.type;if(De.geometry=[],Ir===1)for($=0;$<wt.length;$+=2)De.geometry.push(Qt(wt[$],wt[$+1],I,Le,Ge,ue));else for($=0;$<wt.length;$++){var Ur=[];for(ie=0;ie<wt[$].length;ie+=2)Ur.push(Qt(wt[$][ie],wt[$][ie+1],I,Le,Ge,ue));De.geometry.push(Ur)}}return G.transformed=!0,G}function Qt(G,I,Z,$,ie,Le){return[Math.round(Z*(G*$-ie)),Math.round(Z*(I*$-Le))]}function gr(G,I,Z,$,ie){for(var Le=I===ie.maxZoom?0:ie.tolerance/((1<<I)*ie.extent),Ge={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:Z,y:$,z:I,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},ue=0;ue<G.length;ue++){Ge.numFeatures++,gn(Ge,G[ue],Le,ie);var De=G[ue].minX,wt=G[ue].minY,Ir=G[ue].maxX,Ur=G[ue].maxY;De<Ge.minX&&(Ge.minX=De),wt<Ge.minY&&(Ge.minY=wt),Ir>Ge.maxX&&(Ge.maxX=Ir),Ur>Ge.maxY&&(Ge.maxY=Ur)}return Ge}function gn(G,I,Z,$){var ie=I.geometry,Le=I.type,Ge=[];if(Le==="Point"||Le==="MultiPoint")for(var ue=0;ue<ie.length;ue+=3)Ge.push(ie[ue]),Ge.push(ie[ue+1]),G.numPoints++,G.numSimplified++;else if(Le==="LineString")Cn(Ge,ie,G,Z,!1,!1);else if(Le==="MultiLineString"||Le==="Polygon")for(ue=0;ue<ie.length;ue++)Cn(Ge,ie[ue],G,Z,Le==="Polygon",ue===0);else if(Le==="MultiPolygon")for(var De=0;De<ie.length;De++){var wt=ie[De];for(ue=0;ue<wt.length;ue++)Cn(Ge,wt[ue],G,Z,!0,ue===0)}if(Ge.length){var Ir=I.tags||null;if(Le==="LineString"&&$.lineMetrics){for(var Ur in Ir={},I.tags)Ir[Ur]=I.tags[Ur];Ir.mapbox_clip_start=ie.start/ie.size,Ir.mapbox_clip_end=ie.end/ie.size}var jt={geometry:Ge,type:Le==="Polygon"||Le==="MultiPolygon"?3:Le==="LineString"||Le==="MultiLineString"?2:1,tags:Ir};I.id!==null&&(jt.id=I.id),G.features.push(jt)}}function Cn(G,I,Z,$,ie,Le){var Ge=$*$;if($>0&&I.size<(ie?Ge:$))Z.numPoints+=I.length/3;else{for(var ue=[],De=0;De<I.length;De+=3)($===0||I[De+2]>Ge)&&(Z.numSimplified++,ue.push(I[De]),ue.push(I[De+1])),Z.numPoints++;ie&&function(wt,Ir){for(var Ur=0,jt=0,dr=wt.length,Hr=dr-2;jt<dr;Hr=jt,jt+=2)Ur+=(wt[jt]-wt[Hr])*(wt[jt+1]+wt[Hr+1]);if(Ur>0===Ir)for(jt=0,dr=wt.length;jt<dr/2;jt+=2){var _n=wt[jt],vr=wt[jt+1];wt[jt]=wt[dr-2-jt],wt[jt+1]=wt[dr-1-jt],wt[dr-2-jt]=_n,wt[dr-1-jt]=vr}}(ue,Le),G.push(ue)}}function vi(G,I){var Z=(I=this.options=function(ie,Le){for(var Ge in Le)ie[Ge]=Le[Ge];return ie}(Object.create(this.options),I)).debug;if(Z&&console.time("preprocess data"),I.maxZoom<0||I.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(I.promoteId&&I.generateId)throw new Error("promoteId and generateId cannot be used together.");var $=function(ie,Le){var Ge=[];if(ie.type==="FeatureCollection")for(var ue=0;ue<ie.features.length;ue++)Je(Ge,ie.features[ue],Le,ue);else Je(Ge,ie.type==="Feature"?ie:{geometry:ie},Le);return Ge}(G,I);this.tiles={},this.tileCoords=[],Z&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",I.indexMaxZoom,I.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),($=function(ie,Le){var Ge=Le.buffer/Le.extent,ue=ie,De=_r(ie,1,-1-Ge,Ge,0,-1,2,Le),wt=_r(ie,1,1-Ge,2+Ge,0,-1,2,Le);return(De||wt)&&(ue=_r(ie,1,-Ge,1+Ge,0,-1,2,Le)||[],De&&(ue=qr(De,1).concat(ue)),wt&&(ue=ue.concat(qr(wt,-1)))),ue}($,I)).length&&this.splitTile($,0,0,0),Z&&($.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function xi(G,I,Z){return 32*((1<<G)*Z+I)+G}function Ri(G,I){var Z=G.tileID.canonical;if(!this._geoJSONIndex)return I(null,null);var $=this._geoJSONIndex.getTile(Z.z,Z.x,Z.y);if(!$)return I(null,null);var ie=new _t($.features),Le=gt(ie);Le.byteOffset===0&&Le.byteLength===Le.buffer.byteLength||(Le=new Uint8Array(Le)),I(null,{vectorTile:ie,rawData:Le.buffer})}Fr.prototype.load=function(G){var I=this.options,Z=I.log,$=I.minZoom,ie=I.maxZoom,Le=I.nodeSize;Z&&console.time("total time");var Ge="prepare "+G.length+" points";Z&&console.time(Ge),this.points=G;for(var ue=[],De=0;De<G.length;De++)G[De].geometry&&ue.push(tr(G[De],De));this.trees[ie+1]=new Jt(ue,Dt,S,Le,Float32Array),Z&&console.timeEnd(Ge);for(var wt=ie;wt>=$;wt--){var Ir=+Date.now();ue=this._cluster(ue,wt),this.trees[wt]=new Jt(ue,Dt,S,Le,Float32Array),Z&&console.log("z%d: %d clusters in %dms",wt,ue.length,+Date.now()-Ir)}return Z&&console.timeEnd("total time"),this},Fr.prototype.getClusters=function(G,I){var Z=((G[0]+180)%360+360)%360-180,$=Math.max(-90,Math.min(90,G[1])),ie=G[2]===180?180:((G[2]+180)%360+360)%360-180,Le=Math.max(-90,Math.min(90,G[3]));if(G[2]-G[0]>=360)Z=-180,ie=180;else if(Z>ie){var Ge=this.getClusters([Z,$,180,Le],I),ue=this.getClusters([-180,$,ie,Le],I);return Ge.concat(ue)}for(var De=this.trees[this._limitZoom(I)],wt=[],Ir=0,Ur=De.range(Re(Z),tt(Le),Re(ie),tt($));Ir<Ur.length;Ir+=1){var jt=De.points[Ur[Ir]];wt.push(jt.numPoints?se(jt):this.points[jt.index])}return wt},Fr.prototype.getChildren=function(G){var I=this._getOriginId(G),Z=this._getOriginZoom(G),$="No cluster with the specified id.",ie=this.trees[Z];if(!ie)throw new Error($);var Le=ie.points[I];if(!Le)throw new Error($);for(var Ge=this.options.radius/(this.options.extent*Math.pow(2,Z-1)),ue=[],De=0,wt=ie.within(Le.x,Le.y,Ge);De<wt.length;De+=1){var Ir=ie.points[wt[De]];Ir.parentId===G&&ue.push(Ir.numPoints?se(Ir):this.points[Ir.index])}if(ue.length===0)throw new Error($);return ue},Fr.prototype.getLeaves=function(G,I,Z){var $=[];return this._appendLeaves($,G,I=I||10,Z=Z||0,0),$},Fr.prototype.getTile=function(G,I,Z){var $=this.trees[this._limitZoom(G)],ie=Math.pow(2,G),Le=this.options,Ge=Le.radius/Le.extent,ue=(Z-Ge)/ie,De=(Z+1+Ge)/ie,wt={features:[]};return this._addTileFeatures($.range((I-Ge)/ie,ue,(I+1+Ge)/ie,De),$.points,I,Z,ie,wt),I===0&&this._addTileFeatures($.range(1-Ge/ie,ue,1,De),$.points,ie,Z,ie,wt),I===ie-1&&this._addTileFeatures($.range(0,ue,Ge/ie,De),$.points,-1,Z,ie,wt),wt.features.length?wt:null},Fr.prototype.getClusterExpansionZoom=function(G){for(var I=this._getOriginZoom(G)-1;I<=this.options.maxZoom;){var Z=this.getChildren(G);if(I++,Z.length!==1)break;G=Z[0].properties.cluster_id}return I},Fr.prototype._appendLeaves=function(G,I,Z,$,ie){for(var Le=0,Ge=this.getChildren(I);Le<Ge.length;Le+=1){var ue=Ge[Le],De=ue.properties;if(De&&De.cluster?ie+De.point_count<=$?ie+=De.point_count:ie=this._appendLeaves(G,De.cluster_id,Z,$,ie):ie<$?ie++:G.push(ue),G.length===Z)break}return ie},Fr.prototype._addTileFeatures=function(G,I,Z,$,ie,Le){for(var Ge=0,ue=G;Ge<ue.length;Ge+=1){var De=I[ue[Ge]],wt=De.numPoints,Ir={type:1,geometry:[[Math.round(this.options.extent*(De.x*ie-Z)),Math.round(this.options.extent*(De.y*ie-$))]],tags:wt?ge(De):this.points[De.index].properties},Ur=void 0;wt?Ur=De.id:this.options.generateId?Ur=De.index:this.points[De.index].id&&(Ur=this.points[De.index].id),Ur!==void 0&&(Ir.id=Ur),Le.features.push(Ir)}},Fr.prototype._limitZoom=function(G){return Math.max(this.options.minZoom,Math.min(+G,this.options.maxZoom+1))},Fr.prototype._cluster=function(G,I){for(var Z=[],$=this.options,ie=$.reduce,Le=$.minPoints,Ge=$.radius/($.extent*Math.pow(2,I)),ue=0;ue<G.length;ue++){var De=G[ue];if(!(De.zoom<=I)){De.zoom=I;for(var wt=this.trees[I+1],Ir=wt.within(De.x,De.y,Ge),Ur=De.numPoints||1,jt=Ur,dr=0,Hr=Ir;dr<Hr.length;dr+=1){var _n=wt.points[Hr[dr]];_n.zoom>I&&(jt+=_n.numPoints||1)}if(jt>=Le){for(var vr=De.x*Ur,vn=De.y*Ur,$r=ie&&Ur>1?this._map(De,!0):null,cn=(ue<<5)+(I+1)+this.points.length,pi=0,pn=Ir;pi<pn.length;pi+=1){var _i=wt.points[pn[pi]];if(!(_i.zoom<=I)){_i.zoom=I;var Xi=_i.numPoints||1;vr+=_i.x*Xi,vn+=_i.y*Xi,_i.parentId=cn,ie&&($r||($r=this._map(De,!0)),ie($r,this._map(_i)))}}De.parentId=cn,Z.push(ln(vr/jt,vn/jt,cn,jt,$r))}else if(Z.push(De),jt>1)for(var mi=0,Di=Ir;mi<Di.length;mi+=1){var Pi=wt.points[Di[mi]];Pi.zoom<=I||(Pi.zoom=I,Z.push(Pi))}}}return Z},Fr.prototype._getOriginId=function(G){return G-this.points.length>>5},Fr.prototype._getOriginZoom=function(G){return(G-this.points.length)%32},Fr.prototype._map=function(G,I){if(G.numPoints)return I?Mt({},G.properties):G.properties;var Z=this.points[G.index].properties,$=this.options.map(Z);return I&&$===Z?Mt({},$):$},vi.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},vi.prototype.splitTile=function(G,I,Z,$,ie,Le,Ge){for(var ue=[G,I,Z,$],De=this.options,wt=De.debug;ue.length;){$=ue.pop(),Z=ue.pop(),I=ue.pop(),G=ue.pop();var Ir=1<<I,Ur=xi(I,Z,$),jt=this.tiles[Ur];if(!jt&&(wt>1&&console.time("creation"),jt=this.tiles[Ur]=gr(G,I,Z,$,De),this.tileCoords.push({z:I,x:Z,y:$}),wt)){wt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",I,Z,$,jt.numFeatures,jt.numPoints,jt.numSimplified),console.timeEnd("creation"));var dr="z"+I;this.stats[dr]=(this.stats[dr]||0)+1,this.total++}if(jt.source=G,ie){if(I===De.maxZoom||I===ie)continue;var Hr=1<<ie-I;if(Z!==Math.floor(Le/Hr)||$!==Math.floor(Ge/Hr))continue}else if(I===De.indexMaxZoom||jt.numPoints<=De.indexMaxPoints)continue;if(jt.source=null,G.length!==0){wt>1&&console.time("clipping");var _n,vr,vn,$r,cn,pi,pn=.5*De.buffer/De.extent,_i=.5-pn,Xi=.5+pn,mi=1+pn;_n=vr=vn=$r=null,cn=_r(G,Ir,Z-pn,Z+Xi,0,jt.minX,jt.maxX,De),pi=_r(G,Ir,Z+_i,Z+mi,0,jt.minX,jt.maxX,De),G=null,cn&&(_n=_r(cn,Ir,$-pn,$+Xi,1,jt.minY,jt.maxY,De),vr=_r(cn,Ir,$+_i,$+mi,1,jt.minY,jt.maxY,De),cn=null),pi&&(vn=_r(pi,Ir,$-pn,$+Xi,1,jt.minY,jt.maxY,De),$r=_r(pi,Ir,$+_i,$+mi,1,jt.minY,jt.maxY,De),pi=null),wt>1&&console.timeEnd("clipping"),ue.push(_n||[],I+1,2*Z,2*$),ue.push(vr||[],I+1,2*Z,2*$+1),ue.push(vn||[],I+1,2*Z+1,2*$),ue.push($r||[],I+1,2*Z+1,2*$+1)}}},vi.prototype.getTile=function(G,I,Z){var $=this.options,ie=$.extent,Le=$.debug;if(G<0||G>24)return null;var Ge=1<<G,ue=xi(G,I=(I%Ge+Ge)%Ge,Z);if(this.tiles[ue])return It(this.tiles[ue],ie);Le>1&&console.log("drilling down to z%d-%d-%d",G,I,Z);for(var De,wt=G,Ir=I,Ur=Z;!De&&wt>0;)wt--,Ir=Math.floor(Ir/2),Ur=Math.floor(Ur/2),De=this.tiles[xi(wt,Ir,Ur)];return De&&De.source?(Le>1&&console.log("found parent tile z%d-%d-%d",wt,Ir,Ur),Le>1&&console.time("drilling down"),this.splitTile(De.source,wt,Ir,Ur,G,I,Z),Le>1&&console.timeEnd("drilling down"),this.tiles[ue]?It(this.tiles[ue],ie):null):null};var Wi=function(G){function I(Z,$,ie,Le){G.call(this,Z,$,ie,Ri),Le&&(this.loadGeoJSON=Le)}return G&&(I.__proto__=G),(I.prototype=Object.create(G&&G.prototype)).constructor=I,I.prototype.loadData=function(Z,$){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),this._pendingCallback=$,this._pendingLoadDataParams=Z,this._state&&this._state!=="Idle"?this._state="NeedsLoadData":(this._state="Coalescing",this._loadData())},I.prototype._loadData=function(){var Z=this;if(this._pendingCallback&&this._pendingLoadDataParams){var $=this._pendingCallback,ie=this._pendingLoadDataParams;delete this._pendingCallback,delete this._pendingLoadDataParams;var Le=!!(ie&&ie.request&&ie.request.collectResourceTiming)&&new p.RequestPerformance(ie.request);this.loadGeoJSON(ie,function(Ge,ue){if(Ge||!ue)return $(Ge);if(typeof ue!="object")return $(new Error("Input data given to '"+ie.source+"' is not a valid GeoJSON object."));(function jt(dr,Hr){var _n,vr=dr&&dr.type;if(vr==="FeatureCollection")for(_n=0;_n<dr.features.length;_n++)jt(dr.features[_n],Hr);else if(vr==="GeometryCollection")for(_n=0;_n<dr.geometries.length;_n++)jt(dr.geometries[_n],Hr);else if(vr==="Feature")jt(dr.geometry,Hr);else if(vr==="Polygon")Zt(dr.coordinates,Hr);else if(vr==="MultiPolygon")for(_n=0;_n<dr.coordinates.length;_n++)Zt(dr.coordinates[_n],Hr);return dr})(ue,!0);try{if(ie.filter){var De=p.createExpression(ie.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(De.result==="error")throw new Error(De.value.map(function(jt){return jt.key+": "+jt.message}).join(", "));var wt=ue.features.filter(function(jt){return De.value.evaluate({zoom:0},jt)});ue={type:"FeatureCollection",features:wt}}Z._geoJSONIndex=ie.cluster?new Fr(function(jt){var dr=jt.superclusterOptions,Hr=jt.clusterProperties;if(!Hr||!dr)return dr;for(var _n={},vr={},vn={accumulated:null,zoom:0},$r={properties:null},cn=Object.keys(Hr),pi=0,pn=cn;pi<pn.length;pi+=1){var _i=pn[pi],Xi=Hr[_i],mi=Xi[0],Di=p.createExpression(Xi[1]),Pi=p.createExpression(typeof mi=="string"?[mi,["accumulated"],["get",_i]]:mi);_n[_i]=Di.value,vr[_i]=Pi.value}return dr.map=function(po){$r.properties=po;for(var ji={},Rn=0,Dn=cn;Rn<Dn.length;Rn+=1){var li=Dn[Rn];ji[li]=_n[li].evaluate(vn,$r)}return ji},dr.reduce=function(po,ji){$r.properties=ji;for(var Rn=0,Dn=cn;Rn<Dn.length;Rn+=1){var li=Dn[Rn];vn.accumulated=po[li],po[li]=vr[li].evaluate(vn,$r)}},dr}(ie)).load(ue.features):function(jt,dr){return new vi(jt,dr)}(ue,ie.geojsonVtOptions)}catch(jt){return $(jt)}Z.loaded={};var Ir={};if(Le){var Ur=Le.finish();Ur&&(Ir.resourceTiming={},Ir.resourceTiming[ie.source]=JSON.parse(JSON.stringify(Ur)))}$(null,Ir)})}},I.prototype.coalesce=function(){this._state==="Coalescing"?this._state="Idle":this._state==="NeedsLoadData"&&(this._state="Coalescing",this._loadData())},I.prototype.reloadTile=function(Z,$){var ie=this.loaded;return ie&&ie[Z.uid]?G.prototype.reloadTile.call(this,Z,$):this.loadTile(Z,$)},I.prototype.loadGeoJSON=function(Z,$){if(Z.request)p.getJSON(Z.request,$);else{if(typeof Z.data!="string")return $(new Error("Input data given to '"+Z.source+"' is not a valid GeoJSON object."));try{return $(null,JSON.parse(Z.data))}catch(ie){return $(new Error("Input data given to '"+Z.source+"' is not a valid GeoJSON object."))}}},I.prototype.removeSource=function(Z,$){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),$()},I.prototype.getClusterExpansionZoom=function(Z,$){try{$(null,this._geoJSONIndex.getClusterExpansionZoom(Z.clusterId))}catch(ie){$(ie)}},I.prototype.getClusterChildren=function(Z,$){try{$(null,this._geoJSONIndex.getChildren(Z.clusterId))}catch(ie){$(ie)}},I.prototype.getClusterLeaves=function(Z,$){try{$(null,this._geoJSONIndex.getLeaves(Z.clusterId,Z.limit,Z.offset))}catch(ie){$(ie)}},I}(we),si=function(G){var I=this;this.self=G,this.actor=new p.Actor(G,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:we,geojson:Wi},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=function(Z,$){if(I.workerSourceTypes[Z])throw new Error('Worker source with name "'+Z+'" already registered.');I.workerSourceTypes[Z]=$},this.self.registerRTLTextPlugin=function(Z){if(p.plugin.isParsed())throw new Error("RTL text plugin already registered.");p.plugin.applyArabicShaping=Z.applyArabicShaping,p.plugin.processBidirectionalText=Z.processBidirectionalText,p.plugin.processStyledBidirectionalText=Z.processStyledBidirectionalText}};return si.prototype.setReferrer=function(G,I){this.referrer=I},si.prototype.setImages=function(G,I,Z){for(var $ in this.availableImages[G]=I,this.workerSources[G]){var ie=this.workerSources[G][$];for(var Le in ie)ie[Le].availableImages=I}Z()},si.prototype.setLayers=function(G,I,Z){this.getLayerIndex(G).replace(I),Z()},si.prototype.updateLayers=function(G,I,Z){this.getLayerIndex(G).update(I.layers,I.removedIds),Z()},si.prototype.loadTile=function(G,I,Z){this.getWorkerSource(G,I.type,I.source).loadTile(I,Z)},si.prototype.loadDEMTile=function(G,I,Z){this.getDEMWorkerSource(G,I.source).loadTile(I,Z)},si.prototype.reloadTile=function(G,I,Z){this.getWorkerSource(G,I.type,I.source).reloadTile(I,Z)},si.prototype.abortTile=function(G,I,Z){this.getWorkerSource(G,I.type,I.source).abortTile(I,Z)},si.prototype.removeTile=function(G,I,Z){this.getWorkerSource(G,I.type,I.source).removeTile(I,Z)},si.prototype.removeDEMTile=function(G,I){this.getDEMWorkerSource(G,I.source).removeTile(I)},si.prototype.removeSource=function(G,I,Z){if(this.workerSources[G]&&this.workerSources[G][I.type]&&this.workerSources[G][I.type][I.source]){var $=this.workerSources[G][I.type][I.source];delete this.workerSources[G][I.type][I.source],$.removeSource!==void 0?$.removeSource(I,Z):Z()}},si.prototype.loadWorkerSource=function(G,I,Z){try{this.self.importScripts(I.url),Z()}catch($){Z($.toString())}},si.prototype.syncRTLPluginState=function(G,I,Z){try{p.plugin.setState(I);var $=p.plugin.getPluginURL();if(p.plugin.isLoaded()&&!p.plugin.isParsed()&&$!=null){this.self.importScripts($);var ie=p.plugin.isParsed();Z(ie?void 0:new Error("RTL Text Plugin failed to import scripts from "+$),ie)}}catch(Le){Z(Le.toString())}},si.prototype.getAvailableImages=function(G){var I=this.availableImages[G];return I||(I=[]),I},si.prototype.getLayerIndex=function(G){var I=this.layerIndexes[G];return I||(I=this.layerIndexes[G]=new Q),I},si.prototype.getWorkerSource=function(G,I,Z){var $=this;return this.workerSources[G]||(this.workerSources[G]={}),this.workerSources[G][I]||(this.workerSources[G][I]={}),this.workerSources[G][I][Z]||(this.workerSources[G][I][Z]=new this.workerSourceTypes[I]({send:function(ie,Le,Ge){$.actor.send(ie,Le,Ge,G)}},this.getLayerIndex(G),this.getAvailableImages(G))),this.workerSources[G][I][Z]},si.prototype.getDEMWorkerSource=function(G,I){return this.demWorkerSources[G]||(this.demWorkerSources[G]={}),this.demWorkerSources[G][I]||(this.demWorkerSources[G][I]=new $t),this.demWorkerSources[G][I]},si.prototype.enforceCacheSizeLimit=function(G,I){p.enforceCacheSizeLimit(I)},typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope&&(self.worker=new si(self)),si}),E(["./shared"],function(p){"use strict";var w=p.createCommonjsModule(function(n){function s(g){return!a(g)}function a(g){return typeof window=="undefined"||typeof document=="undefined"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var T,R,V=new Blob([""],{type:"text/javascript"}),te=URL.createObjectURL(V);try{R=new Worker(te),T=!0}catch(de){T=!1}return R&&R.terminate(),URL.revokeObjectURL(te),T}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var T=document.createElement("canvas");T.width=T.height=1;var R=T.getContext("2d");if(!R)return!1;var V=R.getImageData(0,0,1,1);return V&&V.width===T.width}()?(h[b=g&&g.failIfMajorPerformanceCaveat]===void 0&&(h[b]=function(T){var R=function(te){var de=document.createElement("canvas"),ye=Object.create(s.webGLContextAttributes);return ye.failIfMajorPerformanceCaveat=te,de.probablySupportsContext?de.probablySupportsContext("webgl",ye)||de.probablySupportsContext("experimental-webgl",ye):de.supportsContext?de.supportsContext("webgl",ye)||de.supportsContext("experimental-webgl",ye):de.getContext("webgl",ye)||de.getContext("experimental-webgl",ye)}(T);if(!R)return!1;var V=R.createShader(R.VERTEX_SHADER);return!(!V||R.isContextLost())&&(R.shaderSource(V,"void main() {}"),R.compileShader(V),R.getShaderParameter(V,R.COMPILE_STATUS)===!0)}(b)),h[b]?void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var b}n.exports?n.exports=s:window&&(window.mapboxgl=window.mapboxgl||{},window.mapboxgl.supported=s,window.mapboxgl.notSupportedReason=a);var h={};s.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0}}),F={create:function(n,s,a){var h=p.window.document.createElement(n);return s!==void 0&&(h.className=s),a&&a.appendChild(h),h},createNS:function(n,s){return p.window.document.createElementNS(n,s)}},Q=p.window.document&&p.window.document.documentElement.style;function Y(n){if(!Q)return n[0];for(var s=0;s<n.length;s++)if(n[s]in Q)return n[s];return n[0]}var le,ne=Y(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]);F.disableDrag=function(){Q&&ne&&(le=Q[ne],Q[ne]="none")},F.enableDrag=function(){Q&&ne&&(Q[ne]=le)};var be=Y(["transform","WebkitTransform"]);F.setTransform=function(n,s){n.style[be]=s};var we=!1;try{var Ie=Object.defineProperty({},"passive",{get:function(){we=!0}});p.window.addEventListener("test",Ie,Ie),p.window.removeEventListener("test",Ie,Ie)}catch(n){we=!1}F.addEventListener=function(n,s,a,h){h===void 0&&(h={}),n.addEventListener(s,a,"passive"in h&&we?h:h.capture)},F.removeEventListener=function(n,s,a,h){h===void 0&&(h={}),n.removeEventListener(s,a,"passive"in h&&we?h:h.capture)};var $t=function(n){n.preventDefault(),n.stopPropagation(),p.window.removeEventListener("click",$t,!0)};function Zt(n){var s=n.userImage;return!!(s&&s.render&&s.render())&&(n.data.replace(new Uint8Array(s.data.buffer)),!0)}F.suppressClick=function(){p.window.addEventListener("click",$t,!0),p.window.setTimeout(function(){p.window.removeEventListener("click",$t,!0)},0)},F.mousePos=function(n,s){var a=n.getBoundingClientRect();return new p.Point(s.clientX-a.left-n.clientLeft,s.clientY-a.top-n.clientTop)},F.touchPos=function(n,s){for(var a=n.getBoundingClientRect(),h=[],g=0;g<s.length;g++)h.push(new p.Point(s[g].clientX-a.left-n.clientLeft,s[g].clientY-a.top-n.clientTop));return h},F.mouseButton=function(n){return p.window.InstallTrigger!==void 0&&n.button===2&&n.ctrlKey&&p.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:n.button},F.remove=function(n){n.parentNode&&n.parentNode.removeChild(n)};var Xt=function(n){function s(){n.call(this),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new p.RGBAImage({width:1,height:1}),this.dirty=!0}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype.isLoaded=function(){return this.loaded},s.prototype.setLoaded=function(a){if(this.loaded!==a&&(this.loaded=a,a)){for(var h=0,g=this.requestors;h<g.length;h+=1){var b=g[h];this._notify(b.ids,b.callback)}this.requestors=[]}},s.prototype.getImage=function(a){return this.images[a]},s.prototype.addImage=function(a,h){this._validate(a,h)&&(this.images[a]=h)},s.prototype._validate=function(a,h){var g=!0;return this._validateStretch(h.stretchX,h.data&&h.data.width)||(this.fire(new p.ErrorEvent(new Error('Image "'+a+'" has invalid "stretchX" value'))),g=!1),this._validateStretch(h.stretchY,h.data&&h.data.height)||(this.fire(new p.ErrorEvent(new Error('Image "'+a+'" has invalid "stretchY" value'))),g=!1),this._validateContent(h.content,h)||(this.fire(new p.ErrorEvent(new Error('Image "'+a+'" has invalid "content" value'))),g=!1),g},s.prototype._validateStretch=function(a,h){if(!a)return!0;for(var g=0,b=0,T=a;b<T.length;b+=1){var R=T[b];if(R[0]<g||R[1]<R[0]||h<R[1])return!1;g=R[1]}return!0},s.prototype._validateContent=function(a,h){return!(a&&(a.length!==4||a[0]<0||h.data.width<a[0]||a[1]<0||h.data.height<a[1]||a[2]<0||h.data.width<a[2]||a[3]<0||h.data.height<a[3]||a[2]<a[0]||a[3]<a[1]))},s.prototype.updateImage=function(a,h){h.version=this.images[a].version+1,this.images[a]=h,this.updatedImages[a]=!0},s.prototype.removeImage=function(a){var h=this.images[a];delete this.images[a],delete this.patterns[a],h.userImage&&h.userImage.onRemove&&h.userImage.onRemove()},s.prototype.listImages=function(){return Object.keys(this.images)},s.prototype.getImages=function(a,h){var g=!0;if(!this.isLoaded())for(var b=0,T=a;b<T.length;b+=1)this.images[T[b]]||(g=!1);this.isLoaded()||g?this._notify(a,h):this.requestors.push({ids:a,callback:h})},s.prototype._notify=function(a,h){for(var g={},b=0,T=a;b<T.length;b+=1){var R=T[b];this.images[R]||this.fire(new p.Event("styleimagemissing",{id:R}));var V=this.images[R];V?g[R]={data:V.data.clone(),pixelRatio:V.pixelRatio,sdf:V.sdf,version:V.version,stretchX:V.stretchX,stretchY:V.stretchY,content:V.content,hasRenderCallback:Boolean(V.userImage&&V.userImage.render)}:p.warnOnce('Image "'+R+'" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.')}h(null,g)},s.prototype.getPixelSize=function(){var a=this.atlasImage;return{width:a.width,height:a.height}},s.prototype.getPattern=function(a){var h=this.patterns[a],g=this.getImage(a);if(!g)return null;if(h&&h.position.version===g.version)return h.position;if(h)h.position.version=g.version;else{var b={w:g.data.width+2,h:g.data.height+2,x:0,y:0},T=new p.ImagePosition(b,g);this.patterns[a]={bin:b,position:T}}return this._updatePatternAtlas(),this.patterns[a].position},s.prototype.bind=function(a){var h=a.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new p.Texture(a,this.atlasImage,h.RGBA),this.atlasTexture.bind(h.LINEAR,h.CLAMP_TO_EDGE)},s.prototype._updatePatternAtlas=function(){var a=[];for(var h in this.patterns)a.push(this.patterns[h].bin);var g=p.potpack(a),b=g.w,T=g.h,R=this.atlasImage;for(var V in R.resize({width:b||1,height:T||1}),this.patterns){var te=this.patterns[V].bin,de=te.x+1,ye=te.y+1,xe=this.images[V].data,He=xe.width,Ze=xe.height;p.RGBAImage.copy(xe,R,{x:0,y:0},{x:de,y:ye},{width:He,height:Ze}),p.RGBAImage.copy(xe,R,{x:0,y:Ze-1},{x:de,y:ye-1},{width:He,height:1}),p.RGBAImage.copy(xe,R,{x:0,y:0},{x:de,y:ye+Ze},{width:He,height:1}),p.RGBAImage.copy(xe,R,{x:He-1,y:0},{x:de-1,y:ye},{width:1,height:Ze}),p.RGBAImage.copy(xe,R,{x:0,y:0},{x:de+He,y:ye},{width:1,height:Ze})}this.dirty=!0},s.prototype.beginFrame=function(){this.callbackDispatchedThisFrame={}},s.prototype.dispatchRenderCallbacks=function(a){for(var h=0,g=a;h<g.length;h+=1){var b=g[h];if(!this.callbackDispatchedThisFrame[b]){this.callbackDispatchedThisFrame[b]=!0;var T=this.images[b];Zt(T)&&this.updateImage(b,T)}}},s}(p.Evented),Ft=pt,Lt=pt,_t=1e20;function pt(n,s,a,h,g,b){this.fontSize=n||24,this.buffer=s===void 0?3:s,this.cutoff=h||.25,this.fontFamily=g||"sans-serif",this.fontWeight=b||"normal",this.radius=a||8;var T=this.size=this.fontSize+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=T,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(T*T),this.gridInner=new Float64Array(T*T),this.f=new Float64Array(T),this.d=new Float64Array(T),this.z=new Float64Array(T+1),this.v=new Int16Array(T),this.middle=Math.round(T/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function Cr(n,s,a,h,g,b,T){for(var R=0;R<s;R++){for(var V=0;V<a;V++)h[V]=n[V*s+R];for(Gt(h,g,b,T,a),V=0;V<a;V++)n[V*s+R]=g[V]}for(V=0;V<a;V++){for(R=0;R<s;R++)h[R]=n[V*s+R];for(Gt(h,g,b,T,s),R=0;R<s;R++)n[V*s+R]=Math.sqrt(g[R])}}function Gt(n,s,a,h,g){a[0]=0,h[0]=-_t,h[1]=+_t;for(var b=1,T=0;b<g;b++){for(var R=(n[b]+b*b-(n[a[T]]+a[T]*a[T]))/(2*b-2*a[T]);R<=h[T];)T--,R=(n[b]+b*b-(n[a[T]]+a[T]*a[T]))/(2*b-2*a[T]);a[++T]=b,h[T]=R,h[T+1]=+_t}for(b=0,T=0;b<g;b++){for(;h[T+1]<b;)T++;s[b]=(b-a[T])*(b-a[T])+n[a[T]]}}pt.prototype.draw=function(n){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.fillText(n,this.buffer,this.middle);for(var s=this.ctx.getImageData(0,0,this.size,this.size),a=new Uint8ClampedArray(this.size*this.size),h=0;h<this.size*this.size;h++){var g=s.data[4*h+3]/255;this.gridOuter[h]=g===1?0:g===0?_t:Math.pow(Math.max(0,.5-g),2),this.gridInner[h]=g===1?_t:g===0?0:Math.pow(Math.max(0,g-.5),2)}for(Cr(this.gridOuter,this.size,this.size,this.f,this.d,this.v,this.z),Cr(this.gridInner,this.size,this.size,this.f,this.d,this.v,this.z),h=0;h<this.size*this.size;h++)a[h]=Math.max(0,Math.min(255,Math.round(255-255*((this.gridOuter[h]-this.gridInner[h])/this.radius+this.cutoff))));return a},Ft.default=Lt;var ar=function(n,s){this.requestManager=n,this.localIdeographFontFamily=s,this.entries={}};ar.prototype.setURL=function(n){this.url=n},ar.prototype.getGlyphs=function(n,s){var a=this,h=[];for(var g in n)for(var b=0,T=n[g];b<T.length;b+=1)h.push({stack:g,id:T[b]});p.asyncAll(h,function(R,V){var te=R.stack,de=R.id,ye=a.entries[te];ye||(ye=a.entries[te]={glyphs:{},requests:{},ranges:{}});var xe=ye.glyphs[de];if(xe===void 0){if(xe=a._tinySDF(ye,te,de))return ye.glyphs[de]=xe,void V(null,{stack:te,id:de,glyph:xe});var He=Math.floor(de/256);if(256*He>65535)V(new Error("glyphs > 65535 not supported"));else if(ye.ranges[He])V(null,{stack:te,id:de,glyph:xe});else{var Ze=ye.requests[He];Ze||(Ze=ye.requests[He]=[],ar.loadGlyphRange(te,He,a.url,a.requestManager,function(nt,ze){if(ze){for(var rt in ze)a._doesCharSupportLocalGlyph(+rt)||(ye.glyphs[+rt]=ze[+rt]);ye.ranges[He]=!0}for(var ht=0,Nt=Ze;ht<Nt.length;ht+=1)(0,Nt[ht])(nt,ze);delete ye.requests[He]})),Ze.push(function(nt,ze){nt?V(nt):ze&&V(null,{stack:te,id:de,glyph:ze[de]||null})})}}else V(null,{stack:te,id:de,glyph:xe})},function(R,V){if(R)s(R);else if(V){for(var te={},de=0,ye=V;de<ye.length;de+=1){var xe=ye[de],He=xe.stack,Ze=xe.id,nt=xe.glyph;(te[He]||(te[He]={}))[Ze]=nt&&{id:nt.id,bitmap:nt.bitmap.clone(),metrics:nt.metrics}}s(null,te)}})},ar.prototype._doesCharSupportLocalGlyph=function(n){return!!this.localIdeographFontFamily&&(p.isChar["CJK Unified Ideographs"](n)||p.isChar["Hangul Syllables"](n)||p.isChar.Hiragana(n)||p.isChar.Katakana(n))},ar.prototype._tinySDF=function(n,s,a){var h=this.localIdeographFontFamily;if(h&&this._doesCharSupportLocalGlyph(a)){var g=n.tinySDF;if(!g){var b="400";/bold/i.test(s)?b="900":/medium/i.test(s)?b="500":/light/i.test(s)&&(b="200"),g=n.tinySDF=new ar.TinySDF(24,3,8,.25,h,b)}return{id:a,bitmap:new p.AlphaImage({width:30,height:30},g.draw(String.fromCharCode(a))),metrics:{width:24,height:24,left:0,top:-8,advance:24}}}},ar.loadGlyphRange=function(n,s,a,h,g){var b=256*s,T=b+255,R=h.transformRequest(h.normalizeGlyphsURL(a).replace("{fontstack}",n).replace("{range}",b+"-"+T),p.ResourceType.Glyphs);p.getArrayBuffer(R,function(V,te){if(V)g(V);else if(te){for(var de={},ye=0,xe=p.parseGlyphPBF(te);ye<xe.length;ye+=1){var He=xe[ye];de[He.id]=He}g(null,de)}})},ar.TinySDF=Ft;var gt=function(){this.specification=p.styleSpec.light.position};gt.prototype.possiblyEvaluate=function(n,s){return p.sphericalToCartesian(n.expression.evaluate(s))},gt.prototype.interpolate=function(n,s,a){return{x:p.number(n.x,s.x,a),y:p.number(n.y,s.y,a),z:p.number(n.z,s.z,a)}};var Ye=new p.Properties({anchor:new p.DataConstantProperty(p.styleSpec.light.anchor),position:new gt,color:new p.DataConstantProperty(p.styleSpec.light.color),intensity:new p.DataConstantProperty(p.styleSpec.light.intensity)}),Et=function(n){function s(a){n.call(this),this._transitionable=new p.Transitionable(Ye),this.setLight(a),this._transitioning=this._transitionable.untransitioned()}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype.getLight=function(){return this._transitionable.serialize()},s.prototype.setLight=function(a,h){if(h===void 0&&(h={}),!this._validate(p.validateLight,a,h))for(var g in a){var b=a[g];p.endsWith(g,"-transition")?this._transitionable.setTransition(g.slice(0,-"-transition".length),b):this._transitionable.setValue(g,b)}},s.prototype.updateTransitions=function(a){this._transitioning=this._transitionable.transitioned(a,this._transitioning)},s.prototype.hasTransition=function(){return this._transitioning.hasTransition()},s.prototype.recalculate=function(a){this.properties=this._transitioning.possiblyEvaluate(a)},s.prototype._validate=function(a,h,g){return(!g||g.validate!==!1)&&p.emitValidationErrors(this,a.call(p.validateStyle,p.extend({value:h,style:{glyphs:!0,sprite:!0},styleSpec:p.styleSpec})))},s}(p.Evented),Ne=function(n,s){this.width=n,this.height=s,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}};Ne.prototype.getDash=function(n,s){var a=n.join(",")+String(s);return this.dashEntry[a]||(this.dashEntry[a]=this.addDash(n,s)),this.dashEntry[a]},Ne.prototype.getDashRanges=function(n,s,a){var h=[],g=n.length%2==1?-n[n.length-1]*a:0,b=n[0]*a,T=!0;h.push({left:g,right:b,isDash:T,zeroLength:n[0]===0});for(var R=n[0],V=1;V<n.length;V++){var te=n[V];h.push({left:g=R*a,right:b=(R+=te)*a,isDash:T=!T,zeroLength:te===0})}return h},Ne.prototype.addRoundDash=function(n,s,a){for(var h=s/2,g=-a;g<=a;g++)for(var b=this.width*(this.nextRow+a+g),T=0,R=n[T],V=0;V<this.width;V++){V/R.right>1&&(R=n[++T]);var te=Math.abs(V-R.left),de=Math.abs(V-R.right),ye=Math.min(te,de),xe=void 0,He=g/a*(h+1);if(R.isDash){var Ze=h-Math.abs(He);xe=Math.sqrt(ye*ye+Ze*Ze)}else xe=h-Math.sqrt(ye*ye+He*He);this.data[b+V]=Math.max(0,Math.min(255,xe+128))}},Ne.prototype.addRegularDash=function(n){for(var s=n.length-1;s>=0;--s){var a=n[s],h=n[s+1];a.zeroLength?n.splice(s,1):h&&h.isDash===a.isDash&&(h.left=a.left,n.splice(s,1))}var g=n[0],b=n[n.length-1];g.isDash===b.isDash&&(g.left=b.left-this.width,b.right=g.right+this.width);for(var T=this.width*this.nextRow,R=0,V=n[R],te=0;te<this.width;te++){te/V.right>1&&(V=n[++R]);var de=Math.abs(te-V.left),ye=Math.abs(te-V.right),xe=Math.min(de,ye);this.data[T+te]=Math.max(0,Math.min(255,(V.isDash?xe:-xe)+128))}},Ne.prototype.addDash=function(n,s){var a=s?7:0,h=2*a+1;if(this.nextRow+h>this.height)return p.warnOnce("LineAtlas out of space"),null;for(var g=0,b=0;b<n.length;b++)g+=n[b];if(g!==0){var T=this.width/g,R=this.getDashRanges(n,this.width,T);s?this.addRoundDash(R,T,a):this.addRegularDash(R)}var V={y:(this.nextRow+a+.5)/this.height,height:2*a/this.height,width:g};return this.nextRow+=h,this.dirty=!0,V},Ne.prototype.bind=function(n){var s=n.gl;this.texture?(s.bindTexture(s.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,s.texSubImage2D(s.TEXTURE_2D,0,0,0,this.width,this.height,s.ALPHA,s.UNSIGNED_BYTE,this.data))):(this.texture=s.createTexture(),s.bindTexture(s.TEXTURE_2D,this.texture),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.REPEAT),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.REPEAT),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.LINEAR),s.texImage2D(s.TEXTURE_2D,0,s.ALPHA,this.width,this.height,0,s.ALPHA,s.UNSIGNED_BYTE,this.data))};var Ae=function n(s,a){this.workerPool=s,this.actors=[],this.currentActor=0,this.id=p.uniqueId();for(var h=this.workerPool.acquire(this.id),g=0;g<h.length;g++){var b=new n.Actor(h[g],a,this.id);b.name="Worker "+g,this.actors.push(b)}};function Be(n,s,a){var h=function(g,b){if(g)return a(g);if(b){var T=p.pick(p.extend(b,n),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);b.vector_layers&&(T.vectorLayers=b.vector_layers,T.vectorLayerIds=T.vectorLayers.map(function(R){return R.id})),T.tiles=s.canonicalizeTileset(T,n.url),a(null,T)}};return n.url?p.getJSON(s.transformRequest(s.normalizeSourceURL(n.url),p.ResourceType.Source),h):p.browser.frame(function(){return h(null,n)})}Ae.prototype.broadcast=function(n,s,a){p.asyncAll(this.actors,function(h,g){h.send(n,s,g)},a=a||function(){})},Ae.prototype.getActor=function(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]},Ae.prototype.remove=function(){this.actors.forEach(function(n){n.remove()}),this.actors=[],this.workerPool.release(this.id)},Ae.Actor=p.Actor;var bt=function(n,s,a){this.bounds=p.LngLatBounds.convert(this.validateBounds(n)),this.minzoom=s||0,this.maxzoom=a||24};bt.prototype.validateBounds=function(n){return Array.isArray(n)&&n.length===4?[Math.max(-180,n[0]),Math.max(-90,n[1]),Math.min(180,n[2]),Math.min(90,n[3])]:[-180,-90,180,90]},bt.prototype.contains=function(n){var s=Math.pow(2,n.z),a=Math.floor(p.mercatorXfromLng(this.bounds.getWest())*s),h=Math.floor(p.mercatorYfromLat(this.bounds.getNorth())*s),g=Math.ceil(p.mercatorXfromLng(this.bounds.getEast())*s),b=Math.ceil(p.mercatorYfromLat(this.bounds.getSouth())*s);return n.x>=a&&n.x<g&&n.y>=h&&n.y<b};var ir=function(n){function s(a,h,g,b){if(n.call(this),this.id=a,this.dispatcher=g,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,p.extend(this,p.pick(h,["url","scheme","tileSize","promoteId"])),this._options=p.extend({type:"vector"},h),this._collectResourceTiming=h.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(b)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype.load=function(){var a=this;this._loaded=!1,this.fire(new p.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Be(this._options,this.map._requestManager,function(h,g){a._tileJSONRequest=null,a._loaded=!0,h?a.fire(new p.ErrorEvent(h)):g&&(p.extend(a,g),g.bounds&&(a.tileBounds=new bt(g.bounds,a.minzoom,a.maxzoom)),p.postTurnstileEvent(g.tiles,a.map._requestManager._customAccessToken),p.postMapLoadEvent(g.tiles,a.map._getMapId(),a.map._requestManager._skuToken,a.map._requestManager._customAccessToken),a.fire(new p.Event("data",{dataType:"source",sourceDataType:"metadata"})),a.fire(new p.Event("data",{dataType:"source",sourceDataType:"content"})))})},s.prototype.loaded=function(){return this._loaded},s.prototype.hasTile=function(a){return!this.tileBounds||this.tileBounds.contains(a.canonical)},s.prototype.onAdd=function(a){this.map=a,this.load()},s.prototype.setSourceProperty=function(a){this._tileJSONRequest&&this._tileJSONRequest.cancel(),a(),this.map.style.sourceCaches[this.id].clearTiles(),this.load()},s.prototype.setTiles=function(a){var h=this;return this.setSourceProperty(function(){h._options.tiles=a}),this},s.prototype.setUrl=function(a){var h=this;return this.setSourceProperty(function(){h.url=a,h._options.url=a}),this},s.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},s.prototype.serialize=function(){return p.extend({},this._options)},s.prototype.loadTile=function(a,h){var g=this.map._requestManager.normalizeTileURL(a.tileID.canonical.url(this.tiles,this.scheme)),b={request:this.map._requestManager.transformRequest(g,p.ResourceType.Tile),uid:a.uid,tileID:a.tileID,zoom:a.tileID.overscaledZ,tileSize:this.tileSize*a.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:p.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function T(R,V){return delete a.request,a.aborted?h(null):R&&R.status!==404?h(R):(V&&V.resourceTiming&&(a.resourceTiming=V.resourceTiming),this.map._refreshExpiredTiles&&V&&a.setExpiryData(V),a.loadVectorData(V,this.map.painter),p.cacheEntryPossiblyAdded(this.dispatcher),h(null),void(a.reloadCallback&&(this.loadTile(a,a.reloadCallback),a.reloadCallback=null)))}b.request.collectResourceTiming=this._collectResourceTiming,a.actor&&a.state!=="expired"?a.state==="loading"?a.reloadCallback=h:a.request=a.actor.send("reloadTile",b,T.bind(this)):(a.actor=this.dispatcher.getActor(),a.request=a.actor.send("loadTile",b,T.bind(this)))},s.prototype.abortTile=function(a){a.request&&(a.request.cancel(),delete a.request),a.actor&&a.actor.send("abortTile",{uid:a.uid,type:this.type,source:this.id},void 0)},s.prototype.unloadTile=function(a){a.unloadVectorData(),a.actor&&a.actor.send("removeTile",{uid:a.uid,type:this.type,source:this.id},void 0)},s.prototype.hasTransition=function(){return!1},s}(p.Evented),re=function(n){function s(a,h,g,b){n.call(this),this.id=a,this.dispatcher=g,this.setEventedParent(b),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=p.extend({type:"raster"},h),p.extend(this,p.pick(h,["url","scheme","tileSize"]))}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype.load=function(){var a=this;this._loaded=!1,this.fire(new p.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Be(this._options,this.map._requestManager,function(h,g){a._tileJSONRequest=null,a._loaded=!0,h?a.fire(new p.ErrorEvent(h)):g&&(p.extend(a,g),g.bounds&&(a.tileBounds=new bt(g.bounds,a.minzoom,a.maxzoom)),p.postTurnstileEvent(g.tiles),p.postMapLoadEvent(g.tiles,a.map._getMapId(),a.map._requestManager._skuToken),a.fire(new p.Event("data",{dataType:"source",sourceDataType:"metadata"})),a.fire(new p.Event("data",{dataType:"source",sourceDataType:"content"})))})},s.prototype.loaded=function(){return this._loaded},s.prototype.onAdd=function(a){this.map=a,this.load()},s.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},s.prototype.serialize=function(){return p.extend({},this._options)},s.prototype.hasTile=function(a){return!this.tileBounds||this.tileBounds.contains(a.canonical)},s.prototype.loadTile=function(a,h){var g=this,b=this.map._requestManager.normalizeTileURL(a.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);a.request=p.getImage(this.map._requestManager.transformRequest(b,p.ResourceType.Tile),function(T,R){if(delete a.request,a.aborted)a.state="unloaded",h(null);else if(T)a.state="errored",h(T);else if(R){g.map._refreshExpiredTiles&&a.setExpiryData(R),delete R.cacheControl,delete R.expires;var V=g.map.painter.context,te=V.gl;a.texture=g.map.painter.getTileTexture(R.width),a.texture?a.texture.update(R,{useMipmap:!0}):(a.texture=new p.Texture(V,R,te.RGBA,{useMipmap:!0}),a.texture.bind(te.LINEAR,te.CLAMP_TO_EDGE,te.LINEAR_MIPMAP_NEAREST),V.extTextureFilterAnisotropic&&te.texParameterf(te.TEXTURE_2D,V.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,V.extTextureFilterAnisotropicMax)),a.state="loaded",p.cacheEntryPossiblyAdded(g.dispatcher),h(null)}})},s.prototype.abortTile=function(a,h){a.request&&(a.request.cancel(),delete a.request),h()},s.prototype.unloadTile=function(a,h){a.texture&&this.map.painter.saveTileTexture(a.texture),h()},s.prototype.hasTransition=function(){return!1},s}(p.Evented),Ee=function(n){function s(a,h,g,b){n.call(this,a,h,g,b),this.type="raster-dem",this.maxzoom=22,this._options=p.extend({type:"raster-dem"},h),this.encoding=h.encoding||"mapbox"}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype.serialize=function(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}},s.prototype.loadTile=function(a,h){var g=this.map._requestManager.normalizeTileURL(a.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);function b(T,R){T&&(a.state="errored",h(T)),R&&(a.dem=R,a.needsHillshadePrepare=!0,a.state="loaded",h(null))}a.request=p.getImage(this.map._requestManager.transformRequest(g,p.ResourceType.Tile),function(T,R){if(delete a.request,a.aborted)a.state="unloaded",h(null);else if(T)a.state="errored",h(T);else if(R){this.map._refreshExpiredTiles&&a.setExpiryData(R),delete R.cacheControl,delete R.expires;var V=p.window.ImageBitmap&&R instanceof p.window.ImageBitmap&&p.offscreenCanvasSupported()?R:p.browser.getImageData(R,1),te={uid:a.uid,coord:a.tileID,source:this.id,rawImageData:V,encoding:this.encoding};a.actor&&a.state!=="expired"||(a.actor=this.dispatcher.getActor(),a.actor.send("loadDEMTile",te,b.bind(this)))}}.bind(this)),a.neighboringTiles=this._getNeighboringTiles(a.tileID)},s.prototype._getNeighboringTiles=function(a){var h=a.canonical,g=Math.pow(2,h.z),b=(h.x-1+g)%g,T=h.x===0?a.wrap-1:a.wrap,R=(h.x+1+g)%g,V=h.x+1===g?a.wrap+1:a.wrap,te={};return te[new p.OverscaledTileID(a.overscaledZ,T,h.z,b,h.y).key]={backfilled:!1},te[new p.OverscaledTileID(a.overscaledZ,V,h.z,R,h.y).key]={backfilled:!1},h.y>0&&(te[new p.OverscaledTileID(a.overscaledZ,T,h.z,b,h.y-1).key]={backfilled:!1},te[new p.OverscaledTileID(a.overscaledZ,a.wrap,h.z,h.x,h.y-1).key]={backfilled:!1},te[new p.OverscaledTileID(a.overscaledZ,V,h.z,R,h.y-1).key]={backfilled:!1}),h.y+1<g&&(te[new p.OverscaledTileID(a.overscaledZ,T,h.z,b,h.y+1).key]={backfilled:!1},te[new p.OverscaledTileID(a.overscaledZ,a.wrap,h.z,h.x,h.y+1).key]={backfilled:!1},te[new p.OverscaledTileID(a.overscaledZ,V,h.z,R,h.y+1).key]={backfilled:!1}),te},s.prototype.unloadTile=function(a){a.demTexture&&this.map.painter.saveTileTexture(a.demTexture),a.fbo&&(a.fbo.destroy(),delete a.fbo),a.dem&&delete a.dem,delete a.neighboringTiles,a.state="unloaded",a.actor&&a.actor.send("removeDEMTile",{uid:a.uid,source:this.id})},s}(re),ae=function(n){function s(a,h,g,b){n.call(this),this.id=a,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._loaded=!1,this.actor=g.getActor(),this.setEventedParent(b),this._data=h.data,this._options=p.extend({},h),this._collectResourceTiming=h.collectResourceTiming,this._resourceTiming=[],h.maxzoom!==void 0&&(this.maxzoom=h.maxzoom),h.type&&(this.type=h.type),h.attribution&&(this.attribution=h.attribution),this.promoteId=h.promoteId;var T=p.EXTENT/this.tileSize;this.workerOptions=p.extend({source:this.id,cluster:h.cluster||!1,geojsonVtOptions:{buffer:(h.buffer!==void 0?h.buffer:128)*T,tolerance:(h.tolerance!==void 0?h.tolerance:.375)*T,extent:p.EXTENT,maxZoom:this.maxzoom,lineMetrics:h.lineMetrics||!1,generateId:h.generateId||!1},superclusterOptions:{maxZoom:h.clusterMaxZoom!==void 0?Math.min(h.clusterMaxZoom,this.maxzoom-1):this.maxzoom-1,minPoints:Math.max(2,h.clusterMinPoints||2),extent:p.EXTENT,radius:(h.clusterRadius||50)*T,log:!1,generateId:h.generateId||!1},clusterProperties:h.clusterProperties,filter:h.filter},h.workerOptions)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype.load=function(){var a=this;this.fire(new p.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(h){if(h)a.fire(new p.ErrorEvent(h));else{var g={dataType:"source",sourceDataType:"metadata"};a._collectResourceTiming&&a._resourceTiming&&a._resourceTiming.length>0&&(g.resourceTiming=a._resourceTiming,a._resourceTiming=[]),a.fire(new p.Event("data",g))}})},s.prototype.onAdd=function(a){this.map=a,this.load()},s.prototype.setData=function(a){var h=this;return this._data=a,this.fire(new p.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(g){if(g)h.fire(new p.ErrorEvent(g));else{var b={dataType:"source",sourceDataType:"content"};h._collectResourceTiming&&h._resourceTiming&&h._resourceTiming.length>0&&(b.resourceTiming=h._resourceTiming,h._resourceTiming=[]),h.fire(new p.Event("data",b))}}),this},s.prototype.getClusterExpansionZoom=function(a,h){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:a,source:this.id},h),this},s.prototype.getClusterChildren=function(a,h){return this.actor.send("geojson.getClusterChildren",{clusterId:a,source:this.id},h),this},s.prototype.getClusterLeaves=function(a,h,g,b){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:a,limit:h,offset:g},b),this},s.prototype._updateWorkerData=function(a){var h=this;this._loaded=!1;var g=p.extend({},this.workerOptions),b=this._data;typeof b=="string"?(g.request=this.map._requestManager.transformRequest(p.browser.resolveURL(b),p.ResourceType.Source),g.request.collectResourceTiming=this._collectResourceTiming):g.data=JSON.stringify(b),this.actor.send(this.type+".loadData",g,function(T,R){h._removed||R&&R.abandoned||(h._loaded=!0,R&&R.resourceTiming&&R.resourceTiming[h.id]&&(h._resourceTiming=R.resourceTiming[h.id].slice(0)),h.actor.send(h.type+".coalesce",{source:g.source},null),a(T))})},s.prototype.loaded=function(){return this._loaded},s.prototype.loadTile=function(a,h){var g=this,b=a.actor?"reloadTile":"loadTile";a.actor=this.actor,a.request=this.actor.send(b,{type:this.type,uid:a.uid,tileID:a.tileID,zoom:a.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:p.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},function(T,R){return delete a.request,a.unloadVectorData(),a.aborted?h(null):T?h(T):(a.loadVectorData(R,g.map.painter,b==="reloadTile"),h(null))})},s.prototype.abortTile=function(a){a.request&&(a.request.cancel(),delete a.request),a.aborted=!0},s.prototype.unloadTile=function(a){a.unloadVectorData(),this.actor.send("removeTile",{uid:a.uid,type:this.type,source:this.id})},s.prototype.onRemove=function(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})},s.prototype.serialize=function(){return p.extend({},this._options,{type:this.type,data:this._data})},s.prototype.hasTransition=function(){return!1},s}(p.Evented),me=p.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]),Te=function(n){function s(a,h,g,b){n.call(this),this.id=a,this.dispatcher=g,this.coordinates=h.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(b),this.options=h}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype.load=function(a,h){var g=this;this._loaded=!1,this.fire(new p.Event("dataloading",{dataType:"source"})),this.url=this.options.url,p.getImage(this.map._requestManager.transformRequest(this.url,p.ResourceType.Image),function(b,T){g._loaded=!0,b?g.fire(new p.ErrorEvent(b)):T&&(g.image=T,a&&(g.coordinates=a),h&&h(),g._finishLoading())})},s.prototype.loaded=function(){return this._loaded},s.prototype.updateImage=function(a){var h=this;return this.image&&a.url?(this.options.url=a.url,this.load(a.coordinates,function(){h.texture=null}),this):this},s.prototype._finishLoading=function(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"metadata"})))},s.prototype.onAdd=function(a){this.map=a,this.load()},s.prototype.setCoordinates=function(a){var h=this;this.coordinates=a;var g=a.map(p.MercatorCoordinate.fromLngLat);this.tileID=function(T){for(var R=1/0,V=1/0,te=-1/0,de=-1/0,ye=0,xe=T;ye<xe.length;ye+=1){var He=xe[ye];R=Math.min(R,He.x),V=Math.min(V,He.y),te=Math.max(te,He.x),de=Math.max(de,He.y)}var Ze=Math.max(te-R,de-V),nt=Math.max(0,Math.floor(-Math.log(Ze)/Math.LN2)),ze=Math.pow(2,nt);return new p.CanonicalTileID(nt,Math.floor((R+te)/2*ze),Math.floor((V+de)/2*ze))}(g),this.minzoom=this.maxzoom=this.tileID.z;var b=g.map(function(T){return h.tileID.getTilePoint(T)._round()});return this._boundsArray=new p.StructArrayLayout4i8,this._boundsArray.emplaceBack(b[0].x,b[0].y,0,0),this._boundsArray.emplaceBack(b[1].x,b[1].y,p.EXTENT,0),this._boundsArray.emplaceBack(b[3].x,b[3].y,0,p.EXTENT),this._boundsArray.emplaceBack(b[2].x,b[2].y,p.EXTENT,p.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"content"})),this},s.prototype.prepare=function(){if(Object.keys(this.tiles).length!==0&&this.image){var a=this.map.painter.context,h=a.gl;for(var g in this.boundsBuffer||(this.boundsBuffer=a.createVertexBuffer(this._boundsArray,me.members)),this.boundsSegments||(this.boundsSegments=p.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new p.Texture(a,this.image,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE)),this.tiles){var b=this.tiles[g];b.state!=="loaded"&&(b.state="loaded",b.texture=this.texture)}}},s.prototype.loadTile=function(a,h){this.tileID&&this.tileID.equals(a.tileID.canonical)?(this.tiles[String(a.tileID.wrap)]=a,a.buckets={},h(null)):(a.state="errored",h(null))},s.prototype.serialize=function(){return{type:"image",url:this.options.url,coordinates:this.coordinates}},s.prototype.hasTransition=function(){return!1},s}(p.Evented),Qe=function(n){function s(a,h,g,b){n.call(this,a,h,g,b),this.roundZoom=!0,this.type="video",this.options=h}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype.load=function(){var a=this;this._loaded=!1;var h=this.options;this.urls=[];for(var g=0,b=h.urls;g<b.length;g+=1)this.urls.push(this.map._requestManager.transformRequest(b[g],p.ResourceType.Source).url);p.getVideo(this.urls,function(T,R){a._loaded=!0,T?a.fire(new p.ErrorEvent(T)):R&&(a.video=R,a.video.loop=!0,a.video.addEventListener("playing",function(){a.map.triggerRepaint()}),a.map&&a.video.play(),a._finishLoading())})},s.prototype.pause=function(){this.video&&this.video.pause()},s.prototype.play=function(){this.video&&this.video.play()},s.prototype.seek=function(a){if(this.video){var h=this.video.seekable;a<h.start(0)||a>h.end(0)?this.fire(new p.ErrorEvent(new p.ValidationError("sources."+this.id,null,"Playback for this video can be set only between the "+h.start(0)+" and "+h.end(0)+"-second mark."))):this.video.currentTime=a}},s.prototype.getVideo=function(){return this.video},s.prototype.onAdd=function(a){this.map||(this.map=a,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))},s.prototype.prepare=function(){if(!(Object.keys(this.tiles).length===0||this.video.readyState<2)){var a=this.map.painter.context,h=a.gl;for(var g in this.boundsBuffer||(this.boundsBuffer=a.createVertexBuffer(this._boundsArray,me.members)),this.boundsSegments||(this.boundsSegments=p.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE),h.texSubImage2D(h.TEXTURE_2D,0,0,0,h.RGBA,h.UNSIGNED_BYTE,this.video)):(this.texture=new p.Texture(a,this.video,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE)),this.tiles){var b=this.tiles[g];b.state!=="loaded"&&(b.state="loaded",b.texture=this.texture)}}},s.prototype.serialize=function(){return{type:"video",urls:this.urls,coordinates:this.coordinates}},s.prototype.hasTransition=function(){return this.video&&!this.video.paused},s}(Te),dt=function(n){function s(a,h,g,b){n.call(this,a,h,g,b),h.coordinates?Array.isArray(h.coordinates)&&h.coordinates.length===4&&!h.coordinates.some(function(T){return!Array.isArray(T)||T.length!==2||T.some(function(R){return typeof R!="number"})})||this.fire(new p.ErrorEvent(new p.ValidationError("sources."+a,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new p.ErrorEvent(new p.ValidationError("sources."+a,null,'missing required property "coordinates"'))),h.animate&&typeof h.animate!="boolean"&&this.fire(new p.ErrorEvent(new p.ValidationError("sources."+a,null,'optional "animate" property must be a boolean value'))),h.canvas?typeof h.canvas=="string"||h.canvas instanceof p.window.HTMLCanvasElement||this.fire(new p.ErrorEvent(new p.ValidationError("sources."+a,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new p.ErrorEvent(new p.ValidationError("sources."+a,null,'missing required property "canvas"'))),this.options=h,this.animate=h.animate===void 0||h.animate}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype.load=function(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof p.window.HTMLCanvasElement?this.options.canvas:p.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new p.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},s.prototype.getCanvas=function(){return this.canvas},s.prototype.onAdd=function(a){this.map=a,this.load(),this.canvas&&this.animate&&this.play()},s.prototype.onRemove=function(){this.pause()},s.prototype.prepare=function(){var a=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,a=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,a=!0),!this._hasInvalidDimensions()&&Object.keys(this.tiles).length!==0){var h=this.map.painter.context,g=h.gl;for(var b in this.boundsBuffer||(this.boundsBuffer=h.createVertexBuffer(this._boundsArray,me.members)),this.boundsSegments||(this.boundsSegments=p.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(a||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new p.Texture(h,this.canvas,g.RGBA,{premultiply:!0}),this.tiles){var T=this.tiles[b];T.state!=="loaded"&&(T.state="loaded",T.texture=this.texture)}}},s.prototype.serialize=function(){return{type:"canvas",coordinates:this.coordinates}},s.prototype.hasTransition=function(){return this._playing},s.prototype._hasInvalidDimensions=function(){for(var a=0,h=[this.canvas.width,this.canvas.height];a<h.length;a+=1){var g=h[a];if(isNaN(g)||g<=0)return!0}return!1},s}(Te),Jt={vector:ir,raster:re,"raster-dem":Ee,geojson:ae,video:Qe,image:Te,canvas:dt};function Nr(n,s){var a=p.identity([]);return p.translate(a,a,[1,1,0]),p.scale(a,a,[.5*n.width,.5*n.height,1]),p.multiply(a,a,n.calculatePosMatrix(s.toUnwrapped()))}function Fr(n,s,a,h,g,b){var T=function(nt,ze,rt){if(nt)for(var ht=0,Nt=nt;ht<Nt.length;ht+=1){var or=ze[Nt[ht]];if(or&&or.source===rt&&or.type==="fill-extrusion")return!0}else for(var rr in ze){var sr=ze[rr];if(sr.source===rt&&sr.type==="fill-extrusion")return!0}return!1}(g&&g.layers,s,n.id),R=b.maxPitchScaleFactor(),V=n.tilesIn(h,R,T);V.sort(ln);for(var te=[],de=0,ye=V;de<ye.length;de+=1){var xe=ye[de];te.push({wrappedTileID:xe.tileID.wrapped().key,queryResults:xe.tile.queryRenderedFeatures(s,a,n._state,xe.queryGeometry,xe.cameraQueryGeometry,xe.scale,g,b,R,Nr(n.transform,xe.tileID))})}var He=function(nt){for(var ze={},rt={},ht=0,Nt=nt;ht<Nt.length;ht+=1){var or=Nt[ht],rr=or.queryResults,sr=or.wrappedTileID,Lr=rt[sr]=rt[sr]||{};for(var rn in rr)for(var Qr=rr[rn],xn=Lr[rn]=Lr[rn]||{},jn=ze[rn]=ze[rn]||[],Xn=0,Wn=Qr;Xn<Wn.length;Xn+=1){var $i=Wn[Xn];xn[$i.featureIndex]||(xn[$i.featureIndex]=!0,jn.push($i))}}return ze}(te);for(var Ze in He)He[Ze].forEach(function(nt){var ze=nt.feature,rt=n.getFeatureState(ze.layer["source-layer"],ze.id);ze.source=ze.layer.source,ze.layer["source-layer"]&&(ze.sourceLayer=ze.layer["source-layer"]),ze.state=rt});return He}function ln(n,s){var a=n.tileID,h=s.tileID;return a.overscaledZ-h.overscaledZ||a.canonical.y-h.canonical.y||a.wrap-h.wrap||a.canonical.x-h.canonical.x}var tr=function(n,s){this.max=n,this.onRemove=s,this.reset()};tr.prototype.reset=function(){for(var n in this.data)for(var s=0,a=this.data[n];s<a.length;s+=1){var h=a[s];h.timeout&&clearTimeout(h.timeout),this.onRemove(h.value)}return this.data={},this.order=[],this},tr.prototype.add=function(n,s,a){var h=this,g=n.wrapped().key;this.data[g]===void 0&&(this.data[g]=[]);var b={value:s,timeout:void 0};if(a!==void 0&&(b.timeout=setTimeout(function(){h.remove(n,b)},a)),this.data[g].push(b),this.order.push(g),this.order.length>this.max){var T=this._getAndRemoveByKey(this.order[0]);T&&this.onRemove(T)}return this},tr.prototype.has=function(n){return n.wrapped().key in this.data},tr.prototype.getAndRemove=function(n){return this.has(n)?this._getAndRemoveByKey(n.wrapped().key):null},tr.prototype._getAndRemoveByKey=function(n){var s=this.data[n].shift();return s.timeout&&clearTimeout(s.timeout),this.data[n].length===0&&delete this.data[n],this.order.splice(this.order.indexOf(n),1),s.value},tr.prototype.getByKey=function(n){var s=this.data[n];return s?s[0].value:null},tr.prototype.get=function(n){return this.has(n)?this.data[n.wrapped().key][0].value:null},tr.prototype.remove=function(n,s){if(!this.has(n))return this;var a=n.wrapped().key,h=s===void 0?0:this.data[a].indexOf(s),g=this.data[a][h];return this.data[a].splice(h,1),g.timeout&&clearTimeout(g.timeout),this.data[a].length===0&&delete this.data[a],this.onRemove(g.value),this.order.splice(this.order.indexOf(a),1),this},tr.prototype.setMaxSize=function(n){for(this.max=n;this.order.length>this.max;){var s=this._getAndRemoveByKey(this.order[0]);s&&this.onRemove(s)}return this},tr.prototype.filter=function(n){var s=[];for(var a in this.data)for(var h=0,g=this.data[a];h<g.length;h+=1){var b=g[h];n(b.value)||s.push(b)}for(var T=0,R=s;T<R.length;T+=1){var V=R[T];this.remove(V.value.tileID,V)}};var se=function(n,s,a){this.context=n;var h=n.gl;this.buffer=h.createBuffer(),this.dynamicDraw=Boolean(a),this.context.unbindVAO(),n.bindElementBuffer.set(this.buffer),h.bufferData(h.ELEMENT_ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?h.DYNAMIC_DRAW:h.STATIC_DRAW),this.dynamicDraw||delete s.arrayBuffer};se.prototype.bind=function(){this.context.bindElementBuffer.set(this.buffer)},se.prototype.updateData=function(n){var s=this.context.gl;this.context.unbindVAO(),this.bind(),s.bufferSubData(s.ELEMENT_ARRAY_BUFFER,0,n.arrayBuffer)},se.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var ge={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"},Re=function(n,s,a,h){this.length=s.length,this.attributes=a,this.itemSize=s.bytesPerElement,this.dynamicDraw=h,this.context=n;var g=n.gl;this.buffer=g.createBuffer(),n.bindVertexBuffer.set(this.buffer),g.bufferData(g.ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?g.DYNAMIC_DRAW:g.STATIC_DRAW),this.dynamicDraw||delete s.arrayBuffer};Re.prototype.bind=function(){this.context.bindVertexBuffer.set(this.buffer)},Re.prototype.updateData=function(n){var s=this.context.gl;this.bind(),s.bufferSubData(s.ARRAY_BUFFER,0,n.arrayBuffer)},Re.prototype.enableAttributes=function(n,s){for(var a=0;a<this.attributes.length;a++){var h=s.attributes[this.attributes[a].name];h!==void 0&&n.enableVertexAttribArray(h)}},Re.prototype.setVertexAttribPointers=function(n,s,a){for(var h=0;h<this.attributes.length;h++){var g=this.attributes[h],b=s.attributes[g.name];b!==void 0&&n.vertexAttribPointer(b,g.components,n[ge[g.type]],!1,this.itemSize,g.offset+this.itemSize*(a||0))}},Re.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var tt=function(n){this.gl=n.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1};tt.prototype.get=function(){return this.current},tt.prototype.set=function(n){},tt.prototype.getDefault=function(){return this.default},tt.prototype.setDefault=function(){this.set(this.default)};var Mt=function(n){function s(){n.apply(this,arguments)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype.getDefault=function(){return p.Color.transparent},s.prototype.set=function(a){var h=this.current;(a.r!==h.r||a.g!==h.g||a.b!==h.b||a.a!==h.a||this.dirty)&&(this.gl.clearColor(a.r,a.g,a.b,a.a),this.current=a,this.dirty=!1)},s}(tt),Dt=function(n){function s(){n.apply(this,arguments)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype.getDefault=function(){return 1},s.prototype.set=function(a){(a!==this.current||this.dirty)&&(this.gl.clearDepth(a),this.current=a,this.dirty=!1)},s}(tt),S=function(n){function s(){n.apply(this,arguments)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype.getDefault=function(){return 0},s.prototype.set=function(a){(a!==this.current||this.dirty)&&(this.gl.clearStencil(a),this.current=a,this.dirty=!1)},s}(tt),z=function(n){function s(){n.apply(this,arguments)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype.getDefault=function(){return[!0,!0,!0,!0]},s.prototype.set=function(a){var h=this.current;(a[0]!==h[0]||a[1]!==h[1]||a[2]!==h[2]||a[3]!==h[3]||this.dirty)&&(this.gl.colorMask(a[0],a[1],a[2],a[3]),this.current=a,this.dirty=!1)},s}(tt),pe=function(n){function s(){n.apply(this,arguments)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype.getDefault=function(){return!0},s.prototype.set=function(a){(a!==this.current||this.dirty)&&(this.gl.depthMask(a),this.current=a,this.dirty=!1)},s}(tt),Ue=function(n){function s(){n.apply(this,arguments)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype.getDefault=function(){return 255},s.prototype.set=function(a){(a!==this.current||this.dirty)&&(this.gl.stencilMask(a),this.current=a,this.dirty=!1)},s}(tt),Je=function(n){function s(){n.apply(this,arguments)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype.getDefault=function(){return{func:this.gl.ALWAYS,ref:0,mask:255}},s.prototype.set=function(a){var h=this.current;(a.func!==h.func||a.ref!==h.ref||a.mask!==h.mask||this.dirty)&&(this.gl.stencilFunc(a.func,a.ref,a.mask),this.current=a,this.dirty=!1)},s}(tt),mt=function(n){function s(){n.apply(this,arguments)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype.getDefault=function(){var a=this.gl;return[a.KEEP,a.KEEP,a.KEEP]},s.prototype.set=function(a){var h=this.current;(a[0]!==h[0]||a[1]!==h[1]||a[2]!==h[2]||this.dirty)&&(this.gl.stencilOp(a[0],a[1],a[2]),this.current=a,this.dirty=!1)},s}(tt),Ct=function(n){function s(){n.apply(this,arguments)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype.getDefault=function(){return!1},s.prototype.set=function(a){if(a!==this.current||this.dirty){var h=this.gl;a?h.enable(h.STENCIL_TEST):h.disable(h.STENCIL_TEST),this.current=a,this.dirty=!1}},s}(tt),H=function(n){function s(){n.apply(this,arguments)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype.getDefault=function(){return[0,1]},s.prototype.set=function(a){var h=this.current;(a[0]!==h[0]||a[1]!==h[1]||this.dirty)&&(this.gl.depthRange(a[0],a[1]),this.current=a,this.dirty=!1)},s}(tt),Ht=function(n){function s(){n.apply(this,arguments)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype.getDefault=function(){return!1},s.prototype.set=function(a){if(a!==this.current||this.dirty){var h=this.gl;a?h.enable(h.DEPTH_TEST):h.disable(h.DEPTH_TEST),this.current=a,this.dirty=!1}},s}(tt),Vt=function(n){function s(){n.apply(this,arguments)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype.getDefault=function(){return this.gl.LESS},s.prototype.set=function(a){(a!==this.current||this.dirty)&&(this.gl.depthFunc(a),this.current=a,this.dirty=!1)},s}(tt),_r=function(n){function s(){n.apply(this,arguments)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype.getDefault=function(){return!1},s.prototype.set=function(a){if(a!==this.current||this.dirty){var h=this.gl;a?h.enable(h.BLEND):h.disable(h.BLEND),this.current=a,this.dirty=!1}},s}(tt),Er=function(n){function s(){n.apply(this,arguments)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype.getDefault=function(){var a=this.gl;return[a.ONE,a.ZERO]},s.prototype.set=function(a){var h=this.current;(a[0]!==h[0]||a[1]!==h[1]||this.dirty)&&(this.gl.blendFunc(a[0],a[1]),this.current=a,this.dirty=!1)},s}(tt),Ar=function(n){function s(){n.apply(this,arguments)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype.getDefault=function(){return p.Color.transparent},s.prototype.set=function(a){var h=this.current;(a.r!==h.r||a.g!==h.g||a.b!==h.b||a.a!==h.a||this.dirty)&&(this.gl.blendColor(a.r,a.g,a.b,a.a),this.current=a,this.dirty=!1)},s}(tt),Pr=function(n){function s(){n.apply(this,arguments)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype.getDefault=function(){return this.gl.FUNC_ADD},s.prototype.set=function(a){(a!==this.current||this.dirty)&&(this.gl.blendEquation(a),this.current=a,this.dirty=!1)},s}(tt),Ke=function(n){function s(){n.apply(this,arguments)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype.getDefault=function(){return!1},s.prototype.set=function(a){if(a!==this.current||this.dirty){var h=this.gl;a?h.enable(h.CULL_FACE):h.disable(h.CULL_FACE),this.current=a,this.dirty=!1}},s}(tt),yt=function(n){function s(){n.apply(this,arguments)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype.getDefault=function(){return this.gl.BACK},s.prototype.set=function(a){(a!==this.current||this.dirty)&&(this.gl.cullFace(a),this.current=a,this.dirty=!1)},s}(tt),lt=function(n){function s(){n.apply(this,arguments)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype.getDefault=function(){return this.gl.CCW},s.prototype.set=function(a){(a!==this.current||this.dirty)&&(this.gl.frontFace(a),this.current=a,this.dirty=!1)},s}(tt),lr=function(n){function s(){n.apply(this,arguments)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype.getDefault=function(){return null},s.prototype.set=function(a){(a!==this.current||this.dirty)&&(this.gl.useProgram(a),this.current=a,this.dirty=!1)},s}(tt),qr=function(n){function s(){n.apply(this,arguments)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype.getDefault=function(){return this.gl.TEXTURE0},s.prototype.set=function(a){(a!==this.current||this.dirty)&&(this.gl.activeTexture(a),this.current=a,this.dirty=!1)},s}(tt),ut=function(n){function s(){n.apply(this,arguments)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype.getDefault=function(){var a=this.gl;return[0,0,a.drawingBufferWidth,a.drawingBufferHeight]},s.prototype.set=function(a){var h=this.current;(a[0]!==h[0]||a[1]!==h[1]||a[2]!==h[2]||a[3]!==h[3]||this.dirty)&&(this.gl.viewport(a[0],a[1],a[2],a[3]),this.current=a,this.dirty=!1)},s}(tt),It=function(n){function s(){n.apply(this,arguments)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype.getDefault=function(){return null},s.prototype.set=function(a){if(a!==this.current||this.dirty){var h=this.gl;h.bindFramebuffer(h.FRAMEBUFFER,a),this.current=a,this.dirty=!1}},s}(tt),Qt=function(n){function s(){n.apply(this,arguments)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype.getDefault=function(){return null},s.prototype.set=function(a){if(a!==this.current||this.dirty){var h=this.gl;h.bindRenderbuffer(h.RENDERBUFFER,a),this.current=a,this.dirty=!1}},s}(tt),gr=function(n){function s(){n.apply(this,arguments)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype.getDefault=function(){return null},s.prototype.set=function(a){if(a!==this.current||this.dirty){var h=this.gl;h.bindTexture(h.TEXTURE_2D,a),this.current=a,this.dirty=!1}},s}(tt),gn=function(n){function s(){n.apply(this,arguments)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype.getDefault=function(){return null},s.prototype.set=function(a){if(a!==this.current||this.dirty){var h=this.gl;h.bindBuffer(h.ARRAY_BUFFER,a),this.current=a,this.dirty=!1}},s}(tt),Cn=function(n){function s(){n.apply(this,arguments)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype.getDefault=function(){return null},s.prototype.set=function(a){var h=this.gl;h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,a),this.current=a,this.dirty=!1},s}(tt),vi=function(n){function s(a){n.call(this,a),this.vao=a.extVertexArrayObject}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype.getDefault=function(){return null},s.prototype.set=function(a){this.vao&&(a!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(a),this.current=a,this.dirty=!1)},s}(tt),xi=function(n){function s(){n.apply(this,arguments)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype.getDefault=function(){return 4},s.prototype.set=function(a){if(a!==this.current||this.dirty){var h=this.gl;h.pixelStorei(h.UNPACK_ALIGNMENT,a),this.current=a,this.dirty=!1}},s}(tt),Ri=function(n){function s(){n.apply(this,arguments)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype.getDefault=function(){return!1},s.prototype.set=function(a){if(a!==this.current||this.dirty){var h=this.gl;h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,a),this.current=a,this.dirty=!1}},s}(tt),Wi=function(n){function s(){n.apply(this,arguments)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype.getDefault=function(){return!1},s.prototype.set=function(a){if(a!==this.current||this.dirty){var h=this.gl;h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,a),this.current=a,this.dirty=!1}},s}(tt),si=function(n){function s(a,h){n.call(this,a),this.context=a,this.parent=h}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype.getDefault=function(){return null},s}(tt),G=function(n){function s(){n.apply(this,arguments)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype.setDirty=function(){this.dirty=!0},s.prototype.set=function(a){if(a!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var h=this.gl;h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,a,0),this.current=a,this.dirty=!1}},s}(si),I=function(n){function s(){n.apply(this,arguments)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype.set=function(a){if(a!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var h=this.gl;h.framebufferRenderbuffer(h.FRAMEBUFFER,h.DEPTH_ATTACHMENT,h.RENDERBUFFER,a),this.current=a,this.dirty=!1}},s}(si),Z=function(n,s,a,h){this.context=n,this.width=s,this.height=a;var g=this.framebuffer=n.gl.createFramebuffer();this.colorAttachment=new G(n,g),h&&(this.depthAttachment=new I(n,g))};Z.prototype.destroy=function(){var n=this.context.gl,s=this.colorAttachment.get();if(s&&n.deleteTexture(s),this.depthAttachment){var a=this.depthAttachment.get();a&&n.deleteRenderbuffer(a)}n.deleteFramebuffer(this.framebuffer)};var $=function(n,s,a){this.func=n,this.mask=s,this.range=a};$.ReadOnly=!1,$.ReadWrite=!0,$.disabled=new $(519,$.ReadOnly,[0,1]);var ie=function(n,s,a,h,g,b){this.test=n,this.ref=s,this.mask=a,this.fail=h,this.depthFail=g,this.pass=b};ie.disabled=new ie({func:519,mask:0},0,0,7680,7680,7680);var Le=function(n,s,a){this.blendFunction=n,this.blendColor=s,this.mask=a};Le.disabled=new Le(Le.Replace=[1,0],p.Color.transparent,[!1,!1,!1,!1]),Le.unblended=new Le(Le.Replace,p.Color.transparent,[!0,!0,!0,!0]),Le.alphaBlended=new Le([1,771],p.Color.transparent,[!0,!0,!0,!0]);var Ge=function(n,s,a){this.enable=n,this.mode=s,this.frontFace=a};Ge.disabled=new Ge(!1,1029,2305),Ge.backCCW=new Ge(!0,1029,2305);var ue=function(n){this.gl=n,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new Mt(this),this.clearDepth=new Dt(this),this.clearStencil=new S(this),this.colorMask=new z(this),this.depthMask=new pe(this),this.stencilMask=new Ue(this),this.stencilFunc=new Je(this),this.stencilOp=new mt(this),this.stencilTest=new Ct(this),this.depthRange=new H(this),this.depthTest=new Ht(this),this.depthFunc=new Vt(this),this.blend=new _r(this),this.blendFunc=new Er(this),this.blendColor=new Ar(this),this.blendEquation=new Pr(this),this.cullFace=new Ke(this),this.cullFaceSide=new yt(this),this.frontFace=new lt(this),this.program=new lr(this),this.activeTexture=new qr(this),this.viewport=new ut(this),this.bindFramebuffer=new It(this),this.bindRenderbuffer=new Qt(this),this.bindTexture=new gr(this),this.bindVertexBuffer=new gn(this),this.bindElementBuffer=new Cn(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new vi(this),this.pixelStoreUnpack=new xi(this),this.pixelStoreUnpackPremultiplyAlpha=new Ri(this),this.pixelStoreUnpackFlipY=new Wi(this),this.extTextureFilterAnisotropic=n.getExtension("EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=n.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=n.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(n.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=n.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=n.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=n.getParameter(n.MAX_TEXTURE_SIZE)};ue.prototype.setDefault=function(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()},ue.prototype.setDirty=function(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0},ue.prototype.createIndexBuffer=function(n,s){return new se(this,n,s)},ue.prototype.createVertexBuffer=function(n,s,a){return new Re(this,n,s,a)},ue.prototype.createRenderbuffer=function(n,s,a){var h=this.gl,g=h.createRenderbuffer();return this.bindRenderbuffer.set(g),h.renderbufferStorage(h.RENDERBUFFER,n,s,a),this.bindRenderbuffer.set(null),g},ue.prototype.createFramebuffer=function(n,s,a){return new Z(this,n,s,a)},ue.prototype.clear=function(n){var s=n.color,a=n.depth,h=this.gl,g=0;s&&(g|=h.COLOR_BUFFER_BIT,this.clearColor.set(s),this.colorMask.set([!0,!0,!0,!0])),a!==void 0&&(g|=h.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(a),this.depthMask.set(!0)),h.clear(g)},ue.prototype.setCullFace=function(n){n.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(n.mode),this.frontFace.set(n.frontFace))},ue.prototype.setDepthMode=function(n){n.func!==this.gl.ALWAYS||n.mask?(this.depthTest.set(!0),this.depthFunc.set(n.func),this.depthMask.set(n.mask),this.depthRange.set(n.range)):this.depthTest.set(!1)},ue.prototype.setStencilMode=function(n){n.test.func!==this.gl.ALWAYS||n.mask?(this.stencilTest.set(!0),this.stencilMask.set(n.mask),this.stencilOp.set([n.fail,n.depthFail,n.pass]),this.stencilFunc.set({func:n.test.func,ref:n.ref,mask:n.test.mask})):this.stencilTest.set(!1)},ue.prototype.setColorMode=function(n){p.deepEqual(n.blendFunction,Le.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(n.blendFunction),this.blendColor.set(n.blendColor)),this.colorMask.set(n.mask)},ue.prototype.unbindVAO=function(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)};var De=function(n){function s(a,h,g){var b=this;n.call(this),this.id=a,this.dispatcher=g,this.on("data",function(T){T.dataType==="source"&&T.sourceDataType==="metadata"&&(b._sourceLoaded=!0),b._sourceLoaded&&!b._paused&&T.dataType==="source"&&T.sourceDataType==="content"&&(b.reload(),b.transform&&b.update(b.transform))}),this.on("error",function(){b._sourceErrored=!0}),this._source=function(T,R,V,te){var de=new Jt[R.type](T,R,V,te);if(de.id!==T)throw new Error("Expected Source id to be "+T+" instead of "+de.id);return p.bindAll(["load","abort","unload","serialize","prepare"],de),de}(a,h,g,this),this._tiles={},this._cache=new tr(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new p.SourceFeatureState}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype.onAdd=function(a){this.map=a,this._maxTileCacheSize=a?a._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(a)},s.prototype.onRemove=function(a){this._source&&this._source.onRemove&&this._source.onRemove(a)},s.prototype.loaded=function(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(var a in this._tiles){var h=this._tiles[a];if(h.state!=="loaded"&&h.state!=="errored")return!1}return!0},s.prototype.getSource=function(){return this._source},s.prototype.pause=function(){this._paused=!0},s.prototype.resume=function(){if(this._paused){var a=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,a&&this.reload(),this.transform&&this.update(this.transform)}},s.prototype._loadTile=function(a,h){return this._source.loadTile(a,h)},s.prototype._unloadTile=function(a){if(this._source.unloadTile)return this._source.unloadTile(a,function(){})},s.prototype._abortTile=function(a){if(this._source.abortTile)return this._source.abortTile(a,function(){})},s.prototype.serialize=function(){return this._source.serialize()},s.prototype.prepare=function(a){for(var h in this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._tiles){var g=this._tiles[h];g.upload(a),g.prepare(this.map.style.imageManager)}},s.prototype.getIds=function(){return p.values(this._tiles).map(function(a){return a.tileID}).sort(wt).map(function(a){return a.key})},s.prototype.getRenderableIds=function(a){var h=this,g=[];for(var b in this._tiles)this._isIdRenderable(b,a)&&g.push(this._tiles[b]);return a?g.sort(function(T,R){var V=T.tileID,te=R.tileID,de=new p.Point(V.canonical.x,V.canonical.y)._rotate(h.transform.angle),ye=new p.Point(te.canonical.x,te.canonical.y)._rotate(h.transform.angle);return V.overscaledZ-te.overscaledZ||ye.y-de.y||ye.x-de.x}).map(function(T){return T.tileID.key}):g.map(function(T){return T.tileID}).sort(wt).map(function(T){return T.key})},s.prototype.hasRenderableParent=function(a){var h=this.findLoadedParent(a,0);return!!h&&this._isIdRenderable(h.tileID.key)},s.prototype._isIdRenderable=function(a,h){return this._tiles[a]&&this._tiles[a].hasData()&&!this._coveredTiles[a]&&(h||!this._tiles[a].holdingForFade())},s.prototype.reload=function(){if(this._paused)this._shouldReloadOnResume=!0;else for(var a in this._cache.reset(),this._tiles)this._tiles[a].state!=="errored"&&this._reloadTile(a,"reloading")},s.prototype._reloadTile=function(a,h){var g=this._tiles[a];g&&(g.state!=="loading"&&(g.state=h),this._loadTile(g,this._tileLoaded.bind(this,g,a,h)))},s.prototype._tileLoaded=function(a,h,g,b){if(b)return a.state="errored",void(b.status!==404?this._source.fire(new p.ErrorEvent(b,{tile:a})):this.update(this.transform));a.timeAdded=p.browser.now(),g==="expired"&&(a.refreshedUponExpiration=!0),this._setTileReloadTimer(h,a),this.getSource().type==="raster-dem"&&a.dem&&this._backfillDEM(a),this._state.initializeTileState(a,this.map?this.map.painter:null),this._source.fire(new p.Event("data",{dataType:"source",tile:a,coord:a.tileID}))},s.prototype._backfillDEM=function(a){for(var h=this.getRenderableIds(),g=0;g<h.length;g++){var b=h[g];if(a.neighboringTiles&&a.neighboringTiles[b]){var T=this.getTileByID(b);R(a,T),R(T,a)}}function R(V,te){V.needsHillshadePrepare=!0;var de=te.tileID.canonical.x-V.tileID.canonical.x,ye=te.tileID.canonical.y-V.tileID.canonical.y,xe=Math.pow(2,V.tileID.canonical.z),He=te.tileID.key;de===0&&ye===0||Math.abs(ye)>1||(Math.abs(de)>1&&(Math.abs(de+xe)===1?de+=xe:Math.abs(de-xe)===1&&(de-=xe)),te.dem&&V.dem&&(V.dem.backfillBorder(te.dem,de,ye),V.neighboringTiles&&V.neighboringTiles[He]&&(V.neighboringTiles[He].backfilled=!0)))}},s.prototype.getTile=function(a){return this.getTileByID(a.key)},s.prototype.getTileByID=function(a){return this._tiles[a]},s.prototype._retainLoadedChildren=function(a,h,g,b){for(var T in this._tiles){var R=this._tiles[T];if(!(b[T]||!R.hasData()||R.tileID.overscaledZ<=h||R.tileID.overscaledZ>g)){for(var V=R.tileID;R&&R.tileID.overscaledZ>h+1;){var te=R.tileID.scaledTo(R.tileID.overscaledZ-1);(R=this._tiles[te.key])&&R.hasData()&&(V=te)}for(var de=V;de.overscaledZ>h;)if(a[(de=de.scaledTo(de.overscaledZ-1)).key]){b[V.key]=V;break}}}},s.prototype.findLoadedParent=function(a,h){if(a.key in this._loadedParentTiles){var g=this._loadedParentTiles[a.key];return g&&g.tileID.overscaledZ>=h?g:null}for(var b=a.overscaledZ-1;b>=h;b--){var T=a.scaledTo(b),R=this._getLoadedTile(T);if(R)return R}},s.prototype._getLoadedTile=function(a){var h=this._tiles[a.key];return h&&h.hasData()?h:this._cache.getByKey(a.wrapped().key)},s.prototype.updateCacheSize=function(a){var h=Math.ceil(a.width/this._source.tileSize)+1,g=Math.ceil(a.height/this._source.tileSize)+1,b=Math.floor(h*g*5),T=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,b):b;this._cache.setMaxSize(T)},s.prototype.handleWrapJump=function(a){var h=Math.round((a-(this._prevLng===void 0?a:this._prevLng))/360);if(this._prevLng=a,h){var g={};for(var b in this._tiles){var T=this._tiles[b];T.tileID=T.tileID.unwrapTo(T.tileID.wrap+h),g[T.tileID.key]=T}for(var R in this._tiles=g,this._timers)clearTimeout(this._timers[R]),delete this._timers[R];for(var V in this._tiles)this._setTileReloadTimer(V,this._tiles[V])}},s.prototype.update=function(a){var h=this;if(this.transform=a,this._sourceLoaded&&!this._paused){var g;this.updateCacheSize(a),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used?this._source.tileID?g=a.getVisibleUnwrappedCoordinates(this._source.tileID).map(function(Lr){return new p.OverscaledTileID(Lr.canonical.z,Lr.wrap,Lr.canonical.z,Lr.canonical.x,Lr.canonical.y)}):(g=a.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}),this._source.hasTile&&(g=g.filter(function(Lr){return h._source.hasTile(Lr)}))):g=[];var b=a.coveringZoomLevel(this._source),T=Math.max(b-s.maxOverzooming,this._source.minzoom),R=Math.max(b+s.maxUnderzooming,this._source.minzoom),V=this._updateRetainedTiles(g,b);if(Ir(this._source.type)){for(var te={},de={},ye=0,xe=Object.keys(V);ye<xe.length;ye+=1){var He=xe[ye],Ze=V[He],nt=this._tiles[He];if(nt&&!(nt.fadeEndTime&&nt.fadeEndTime<=p.browser.now())){var ze=this.findLoadedParent(Ze,T);ze&&(this._addTile(ze.tileID),te[ze.tileID.key]=ze.tileID),de[He]=Ze}}for(var rt in this._retainLoadedChildren(de,b,R,V),te)V[rt]||(this._coveredTiles[rt]=!0,V[rt]=te[rt])}for(var ht in V)this._tiles[ht].clearFadeHold();for(var Nt=0,or=p.keysDifference(this._tiles,V);Nt<or.length;Nt+=1){var rr=or[Nt],sr=this._tiles[rr];sr.hasSymbolBuckets&&!sr.holdingForFade()?sr.setHoldDuration(this.map._fadeDuration):sr.hasSymbolBuckets&&!sr.symbolFadeFinished()||this._removeTile(rr)}this._updateLoadedParentTileCache()}},s.prototype.releaseSymbolFadeTiles=function(){for(var a in this._tiles)this._tiles[a].holdingForFade()&&this._removeTile(a)},s.prototype._updateRetainedTiles=function(a,h){for(var g={},b={},T=Math.max(h-s.maxOverzooming,this._source.minzoom),R=Math.max(h+s.maxUnderzooming,this._source.minzoom),V={},te=0,de=a;te<de.length;te+=1){var ye=de[te],xe=this._addTile(ye);g[ye.key]=ye,xe.hasData()||h<this._source.maxzoom&&(V[ye.key]=ye)}this._retainLoadedChildren(V,h,R,g);for(var He=0,Ze=a;He<Ze.length;He+=1){var nt=Ze[He],ze=this._tiles[nt.key];if(!ze.hasData()){if(h+1>this._source.maxzoom){var rt=nt.children(this._source.maxzoom)[0],ht=this.getTile(rt);if(ht&&ht.hasData()){g[rt.key]=rt;continue}}else{var Nt=nt.children(this._source.maxzoom);if(g[Nt[0].key]&&g[Nt[1].key]&&g[Nt[2].key]&&g[Nt[3].key])continue}for(var or=ze.wasRequested(),rr=nt.overscaledZ-1;rr>=T;--rr){var sr=nt.scaledTo(rr);if(b[sr.key]||(b[sr.key]=!0,!(ze=this.getTile(sr))&&or&&(ze=this._addTile(sr)),ze&&(g[sr.key]=sr,or=ze.wasRequested(),ze.hasData())))break}}}return g},s.prototype._updateLoadedParentTileCache=function(){for(var a in this._loadedParentTiles={},this._tiles){for(var h=[],g=void 0,b=this._tiles[a].tileID;b.overscaledZ>0;){if(b.key in this._loadedParentTiles){g=this._loadedParentTiles[b.key];break}h.push(b.key);var T=b.scaledTo(b.overscaledZ-1);if(g=this._getLoadedTile(T))break;b=T}for(var R=0,V=h;R<V.length;R+=1)this._loadedParentTiles[V[R]]=g}},s.prototype._addTile=function(a){var h=this._tiles[a.key];if(h)return h;(h=this._cache.getAndRemove(a))&&(this._setTileReloadTimer(a.key,h),h.tileID=a,this._state.initializeTileState(h,this.map?this.map.painter:null),this._cacheTimers[a.key]&&(clearTimeout(this._cacheTimers[a.key]),delete this._cacheTimers[a.key],this._setTileReloadTimer(a.key,h)));var g=Boolean(h);return g||(h=new p.Tile(a,this._source.tileSize*a.overscaleFactor()),this._loadTile(h,this._tileLoaded.bind(this,h,a.key,h.state))),h?(h.uses++,this._tiles[a.key]=h,g||this._source.fire(new p.Event("dataloading",{tile:h,coord:h.tileID,dataType:"source"})),h):null},s.prototype._setTileReloadTimer=function(a,h){var g=this;a in this._timers&&(clearTimeout(this._timers[a]),delete this._timers[a]);var b=h.getExpiryTimeout();b&&(this._timers[a]=setTimeout(function(){g._reloadTile(a,"expired"),delete g._timers[a]},b))},s.prototype._removeTile=function(a){var h=this._tiles[a];h&&(h.uses--,delete this._tiles[a],this._timers[a]&&(clearTimeout(this._timers[a]),delete this._timers[a]),h.uses>0||(h.hasData()&&h.state!=="reloading"?this._cache.add(h.tileID,h,h.getExpiryTimeout()):(h.aborted=!0,this._abortTile(h),this._unloadTile(h))))},s.prototype.clearTiles=function(){for(var a in this._shouldReloadOnResume=!1,this._paused=!1,this._tiles)this._removeTile(a);this._cache.reset()},s.prototype.tilesIn=function(a,h,g){var b=this,T=[],R=this.transform;if(!R)return T;for(var V=g?R.getCameraQueryGeometry(a):a,te=a.map(function(rr){return R.pointCoordinate(rr)}),de=V.map(function(rr){return R.pointCoordinate(rr)}),ye=this.getIds(),xe=1/0,He=1/0,Ze=-1/0,nt=-1/0,ze=0,rt=de;ze<rt.length;ze+=1){var ht=rt[ze];xe=Math.min(xe,ht.x),He=Math.min(He,ht.y),Ze=Math.max(Ze,ht.x),nt=Math.max(nt,ht.y)}for(var Nt=function(rr){var sr=b._tiles[ye[rr]];if(!sr.holdingForFade()){var Lr=sr.tileID,rn=Math.pow(2,R.zoom-sr.tileID.overscaledZ),Qr=h*sr.queryPadding*p.EXTENT/sr.tileSize/rn,xn=[Lr.getTilePoint(new p.MercatorCoordinate(xe,He)),Lr.getTilePoint(new p.MercatorCoordinate(Ze,nt))];if(xn[0].x-Qr<p.EXTENT&&xn[0].y-Qr<p.EXTENT&&xn[1].x+Qr>=0&&xn[1].y+Qr>=0){var jn=te.map(function(Wn){return Lr.getTilePoint(Wn)}),Xn=de.map(function(Wn){return Lr.getTilePoint(Wn)});T.push({tile:sr,tileID:Lr,queryGeometry:jn,cameraQueryGeometry:Xn,scale:rn})}}},or=0;or<ye.length;or++)Nt(or);return T},s.prototype.getVisibleCoordinates=function(a){for(var h=this,g=this.getRenderableIds(a).map(function(V){return h._tiles[V].tileID}),b=0,T=g;b<T.length;b+=1){var R=T[b];R.posMatrix=this.transform.calculatePosMatrix(R.toUnwrapped())}return g},s.prototype.hasTransition=function(){if(this._source.hasTransition())return!0;if(Ir(this._source.type))for(var a in this._tiles){var h=this._tiles[a];if(h.fadeEndTime!==void 0&&h.fadeEndTime>=p.browser.now())return!0}return!1},s.prototype.setFeatureState=function(a,h,g){this._state.updateState(a=a||"_geojsonTileLayer",h,g)},s.prototype.removeFeatureState=function(a,h,g){this._state.removeFeatureState(a=a||"_geojsonTileLayer",h,g)},s.prototype.getFeatureState=function(a,h){return this._state.getState(a=a||"_geojsonTileLayer",h)},s.prototype.setDependencies=function(a,h,g){var b=this._tiles[a];b&&b.setDependencies(h,g)},s.prototype.reloadTilesForDependencies=function(a,h){for(var g in this._tiles)this._tiles[g].hasDependency(a,h)&&this._reloadTile(g,"reloading");this._cache.filter(function(b){return!b.hasDependency(a,h)})},s}(p.Evented);function wt(n,s){var a=Math.abs(2*n.wrap)-+(n.wrap<0),h=Math.abs(2*s.wrap)-+(s.wrap<0);return n.overscaledZ-s.overscaledZ||h-a||s.canonical.y-n.canonical.y||s.canonical.x-n.canonical.x}function Ir(n){return n==="raster"||n==="image"||n==="video"}function Ur(){return new p.window.Worker(Sc.workerUrl)}De.maxOverzooming=10,De.maxUnderzooming=3;var jt="mapboxgl_preloaded_worker_pool",dr=function(){this.active={}};dr.prototype.acquire=function(n){if(!this.workers)for(this.workers=[];this.workers.length<dr.workerCount;)this.workers.push(new Ur);return this.active[n]=!0,this.workers.slice()},dr.prototype.release=function(n){delete this.active[n],this.numActive()===0&&(this.workers.forEach(function(s){s.terminate()}),this.workers=null)},dr.prototype.isPreloaded=function(){return!!this.active[jt]},dr.prototype.numActive=function(){return Object.keys(this.active).length};var Hr,_n=Math.floor(p.browser.hardwareConcurrency/2);function vr(){return Hr||(Hr=new dr),Hr}function vn(n,s){var a={};for(var h in n)h!=="ref"&&(a[h]=n[h]);return p.refProperties.forEach(function(g){g in s&&(a[g]=s[g])}),a}function $r(n){n=n.slice();for(var s=Object.create(null),a=0;a<n.length;a++)s[n[a].id]=n[a];for(var h=0;h<n.length;h++)"ref"in n[h]&&(n[h]=vn(n[h],s[n[h].ref]));return n}dr.workerCount=Math.max(Math.min(_n,6),1);var cn={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function pi(n,s,a){a.push({command:cn.addSource,args:[n,s[n]]})}function pn(n,s,a){s.push({command:cn.removeSource,args:[n]}),a[n]=!0}function _i(n,s,a,h){pn(n,a,h),pi(n,s,a)}function Xi(n,s,a){var h;for(h in n[a])if(n[a].hasOwnProperty(h)&&h!=="data"&&!p.deepEqual(n[a][h],s[a][h]))return!1;for(h in s[a])if(s[a].hasOwnProperty(h)&&h!=="data"&&!p.deepEqual(n[a][h],s[a][h]))return!1;return!0}function mi(n,s,a,h,g,b){var T;for(T in s=s||{},n=n||{})n.hasOwnProperty(T)&&(p.deepEqual(n[T],s[T])||a.push({command:b,args:[h,T,s[T],g]}));for(T in s)s.hasOwnProperty(T)&&!n.hasOwnProperty(T)&&(p.deepEqual(n[T],s[T])||a.push({command:b,args:[h,T,s[T],g]}))}function Di(n){return n.id}function Pi(n,s){return n[s.id]=s,n}var po=function(n,s){this.reset(n,s)};po.prototype.reset=function(n,s){this.points=n||[],this._distances=[0];for(var a=1;a<this.points.length;a++)this._distances[a]=this._distances[a-1]+this.points[a].dist(this.points[a-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(s||0,.5*this.length),this.paddedLength=this.length-2*this.padding},po.prototype.lerp=function(n){if(this.points.length===1)return this.points[0];n=p.clamp(n,0,1);for(var s=1,a=this._distances[s],h=n*this.paddedLength+this.padding;a<h&&s<this._distances.length;)a=this._distances[++s];var g=s-1,b=this._distances[g],T=a-b,R=T>0?(h-b)/T:0;return this.points[g].mult(1-R).add(this.points[s].mult(R))};var ji=function(n,s,a){var h=this.boxCells=[],g=this.circleCells=[];this.xCellCount=Math.ceil(n/a),this.yCellCount=Math.ceil(s/a);for(var b=0;b<this.xCellCount*this.yCellCount;b++)h.push([]),g.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=n,this.height=s,this.xScale=this.xCellCount/n,this.yScale=this.yCellCount/s,this.boxUid=0,this.circleUid=0};function Rn(n,s,a,h,g){var b=p.create();return s?(p.scale(b,b,[1/g,1/g,1]),a||p.rotateZ(b,b,h.angle)):p.multiply(b,h.labelPlaneMatrix,n),b}function Dn(n,s,a,h,g){if(s){var b=p.clone(n);return p.scale(b,b,[g,g,1]),a||p.rotateZ(b,b,-h.angle),b}return h.glCoordMatrix}function li(n,s){var a=[n.x,n.y,0,1];Xa(a,a,s);var h=a[3];return{point:new p.Point(a[0]/h,a[1]/h),signedDistanceFromCamera:h}}function Vn(n,s){return .5+n/s*.5}function Na(n,s){var a=n[0]/n[3],h=n[1]/n[3];return a>=-s[0]&&a<=s[0]&&h>=-s[1]&&h<=s[1]}function ps(n,s,a,h,g,b,T,R){var V=h?n.textSizeData:n.iconSizeData,te=p.evaluateSizeForZoom(V,a.transform.zoom),de=[256/a.width*2+1,256/a.height*2+1],ye=h?n.text.dynamicLayoutVertexArray:n.icon.dynamicLayoutVertexArray;ye.clear();for(var xe=n.lineVertexArray,He=h?n.text.placedSymbolArray:n.icon.placedSymbolArray,Ze=a.transform.width/a.transform.height,nt=!1,ze=0;ze<He.length;ze++){var rt=He.get(ze);if(rt.hidden||rt.writingMode===p.WritingMode.vertical&&!nt)Wa(rt.numGlyphs,ye);else{nt=!1;var ht=[rt.anchorX,rt.anchorY,0,1];if(p.transformMat4(ht,ht,s),Na(ht,de)){var Nt=Vn(a.transform.cameraToCenterDistance,ht[3]),or=p.evaluateSizeForFeature(V,te,rt),rr=T?or/Nt:or*Nt,sr=new p.Point(rt.anchorX,rt.anchorY),Lr=li(sr,g).point,rn={},Qr=xu(rt,rr,!1,R,s,g,b,n.glyphOffsetArray,xe,ye,Lr,sr,rn,Ze);nt=Qr.useVertical,(Qr.notEnoughRoom||nt||Qr.needsFlipping&&xu(rt,rr,!0,R,s,g,b,n.glyphOffsetArray,xe,ye,Lr,sr,rn,Ze).notEnoughRoom)&&Wa(rt.numGlyphs,ye)}else Wa(rt.numGlyphs,ye)}}h?n.text.dynamicLayoutVertexBuffer.updateData(ye):n.icon.dynamicLayoutVertexBuffer.updateData(ye)}function ki(n,s,a,h,g,b,T,R,V,te,de){var ye=R.glyphStartIndex+R.numGlyphs,xe=R.lineStartIndex,He=R.lineStartIndex+R.lineLength,Ze=s.getoffsetX(R.glyphStartIndex),nt=s.getoffsetX(ye-1),ze=_a(n*Ze,a,h,g,b,T,R.segment,xe,He,V,te,de);if(!ze)return null;var rt=_a(n*nt,a,h,g,b,T,R.segment,xe,He,V,te,de);return rt?{first:ze,last:rt}:null}function Ba(n,s,a,h){return n===p.WritingMode.horizontal&&Math.abs(a.y-s.y)>Math.abs(a.x-s.x)*h?{useVertical:!0}:(n===p.WritingMode.vertical?s.y<a.y:s.x>a.x)?{needsFlipping:!0}:null}function xu(n,s,a,h,g,b,T,R,V,te,de,ye,xe,He){var Ze,nt=s/24,ze=n.lineOffsetX*nt,rt=n.lineOffsetY*nt;if(n.numGlyphs>1){var ht=n.glyphStartIndex+n.numGlyphs,Nt=n.lineStartIndex,or=n.lineStartIndex+n.lineLength,rr=ki(nt,R,ze,rt,a,de,ye,n,V,b,xe);if(!rr)return{notEnoughRoom:!0};var sr=li(rr.first.point,T).point,Lr=li(rr.last.point,T).point;if(h&&!a){var rn=Ba(n.writingMode,sr,Lr,He);if(rn)return rn}Ze=[rr.first];for(var Qr=n.glyphStartIndex+1;Qr<ht-1;Qr++)Ze.push(_a(nt*R.getoffsetX(Qr),ze,rt,a,de,ye,n.segment,Nt,or,V,b,xe));Ze.push(rr.last)}else{if(h&&!a){var xn=li(ye,g).point,jn=n.lineStartIndex+n.segment+1,Xn=new p.Point(V.getx(jn),V.gety(jn)),Wn=li(Xn,g),$i=Wn.signedDistanceFromCamera>0?Wn.point:uu(ye,Xn,xn,1,g),Sn=Ba(n.writingMode,xn,$i,He);if(Sn)return Sn}var oi=_a(nt*R.getoffsetX(n.glyphStartIndex),ze,rt,a,de,ye,n.segment,n.lineStartIndex,n.lineStartIndex+n.lineLength,V,b,xe);if(!oi)return{notEnoughRoom:!0};Ze=[oi]}for(var Si=0,ai=Ze;Si<ai.length;Si+=1){var ii=ai[Si];p.addDynamicAttributes(te,ii.point,ii.angle)}return{}}function uu(n,s,a,h,g){var b=li(n.add(n.sub(s)._unit()),g).point,T=a.sub(b);return a.add(T._mult(h/T.mag()))}function _a(n,s,a,h,g,b,T,R,V,te,de,ye){var xe=h?n-s:n+s,He=xe>0?1:-1,Ze=0;h&&(He*=-1,Ze=Math.PI),He<0&&(Ze+=Math.PI);for(var nt=He>0?R+T:R+T+1,ze=g,rt=g,ht=0,Nt=0,or=Math.abs(xe),rr=[];ht+Nt<=or;){if((nt+=He)<R||nt>=V)return null;if(rt=ze,rr.push(ze),(ze=ye[nt])===void 0){var sr=new p.Point(te.getx(nt),te.gety(nt)),Lr=li(sr,de);if(Lr.signedDistanceFromCamera>0)ze=ye[nt]=Lr.point;else{var rn=nt-He;ze=uu(ht===0?b:new p.Point(te.getx(rn),te.gety(rn)),sr,rt,or-ht+1,de)}}ht+=Nt,Nt=rt.dist(ze)}var Qr=(or-ht)/Nt,xn=ze.sub(rt),jn=xn.mult(Qr)._add(rt);jn._add(xn._unit()._perp()._mult(a*He));var Xn=Ze+Math.atan2(ze.y-rt.y,ze.x-rt.x);return rr.push(jn),{point:jn,angle:Xn,path:rr}}ji.prototype.keysLength=function(){return this.boxKeys.length+this.circleKeys.length},ji.prototype.insert=function(n,s,a,h,g){this._forEachCell(s,a,h,g,this._insertBoxCell,this.boxUid++),this.boxKeys.push(n),this.bboxes.push(s),this.bboxes.push(a),this.bboxes.push(h),this.bboxes.push(g)},ji.prototype.insertCircle=function(n,s,a,h){this._forEachCell(s-h,a-h,s+h,a+h,this._insertCircleCell,this.circleUid++),this.circleKeys.push(n),this.circles.push(s),this.circles.push(a),this.circles.push(h)},ji.prototype._insertBoxCell=function(n,s,a,h,g,b){this.boxCells[g].push(b)},ji.prototype._insertCircleCell=function(n,s,a,h,g,b){this.circleCells[g].push(b)},ji.prototype._query=function(n,s,a,h,g,b){if(a<0||n>this.width||h<0||s>this.height)return!g&&[];var T=[];if(n<=0&&s<=0&&this.width<=a&&this.height<=h){if(g)return!0;for(var R=0;R<this.boxKeys.length;R++)T.push({key:this.boxKeys[R],x1:this.bboxes[4*R],y1:this.bboxes[4*R+1],x2:this.bboxes[4*R+2],y2:this.bboxes[4*R+3]});for(var V=0;V<this.circleKeys.length;V++){var te=this.circles[3*V],de=this.circles[3*V+1],ye=this.circles[3*V+2];T.push({key:this.circleKeys[V],x1:te-ye,y1:de-ye,x2:te+ye,y2:de+ye})}return b?T.filter(b):T}return this._forEachCell(n,s,a,h,this._queryCell,T,{hitTest:g,seenUids:{box:{},circle:{}}},b),g?T.length>0:T},ji.prototype._queryCircle=function(n,s,a,h,g){var b=n-a,T=n+a,R=s-a,V=s+a;if(T<0||b>this.width||V<0||R>this.height)return!h&&[];var te=[];return this._forEachCell(b,R,T,V,this._queryCellCircle,te,{hitTest:h,circle:{x:n,y:s,radius:a},seenUids:{box:{},circle:{}}},g),h?te.length>0:te},ji.prototype.query=function(n,s,a,h,g){return this._query(n,s,a,h,!1,g)},ji.prototype.hitTest=function(n,s,a,h,g){return this._query(n,s,a,h,!0,g)},ji.prototype.hitTestCircle=function(n,s,a,h){return this._queryCircle(n,s,a,!0,h)},ji.prototype._queryCell=function(n,s,a,h,g,b,T,R){var V=T.seenUids,te=this.boxCells[g];if(te!==null)for(var de=this.bboxes,ye=0,xe=te;ye<xe.length;ye+=1){var He=xe[ye];if(!V.box[He]){V.box[He]=!0;var Ze=4*He;if(n<=de[Ze+2]&&s<=de[Ze+3]&&a>=de[Ze+0]&&h>=de[Ze+1]&&(!R||R(this.boxKeys[He]))){if(T.hitTest)return b.push(!0),!0;b.push({key:this.boxKeys[He],x1:de[Ze],y1:de[Ze+1],x2:de[Ze+2],y2:de[Ze+3]})}}}var nt=this.circleCells[g];if(nt!==null)for(var ze=this.circles,rt=0,ht=nt;rt<ht.length;rt+=1){var Nt=ht[rt];if(!V.circle[Nt]){V.circle[Nt]=!0;var or=3*Nt;if(this._circleAndRectCollide(ze[or],ze[or+1],ze[or+2],n,s,a,h)&&(!R||R(this.circleKeys[Nt]))){if(T.hitTest)return b.push(!0),!0;var rr=ze[or],sr=ze[or+1],Lr=ze[or+2];b.push({key:this.circleKeys[Nt],x1:rr-Lr,y1:sr-Lr,x2:rr+Lr,y2:sr+Lr})}}}},ji.prototype._queryCellCircle=function(n,s,a,h,g,b,T,R){var V=T.circle,te=T.seenUids,de=this.boxCells[g];if(de!==null)for(var ye=this.bboxes,xe=0,He=de;xe<He.length;xe+=1){var Ze=He[xe];if(!te.box[Ze]){te.box[Ze]=!0;var nt=4*Ze;if(this._circleAndRectCollide(V.x,V.y,V.radius,ye[nt+0],ye[nt+1],ye[nt+2],ye[nt+3])&&(!R||R(this.boxKeys[Ze])))return b.push(!0),!0}}var ze=this.circleCells[g];if(ze!==null)for(var rt=this.circles,ht=0,Nt=ze;ht<Nt.length;ht+=1){var or=Nt[ht];if(!te.circle[or]){te.circle[or]=!0;var rr=3*or;if(this._circlesCollide(rt[rr],rt[rr+1],rt[rr+2],V.x,V.y,V.radius)&&(!R||R(this.circleKeys[or])))return b.push(!0),!0}}},ji.prototype._forEachCell=function(n,s,a,h,g,b,T,R){for(var V=this._convertToXCellCoord(n),te=this._convertToYCellCoord(s),de=this._convertToXCellCoord(a),ye=this._convertToYCellCoord(h),xe=V;xe<=de;xe++)for(var He=te;He<=ye;He++)if(g.call(this,n,s,a,h,this.xCellCount*He+xe,b,T,R))return},ji.prototype._convertToXCellCoord=function(n){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(n*this.xScale)))},ji.prototype._convertToYCellCoord=function(n){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(n*this.yScale)))},ji.prototype._circlesCollide=function(n,s,a,h,g,b){var T=h-n,R=g-s,V=a+b;return V*V>T*T+R*R},ji.prototype._circleAndRectCollide=function(n,s,a,h,g,b,T){var R=(b-h)/2,V=Math.abs(n-(h+R));if(V>R+a)return!1;var te=(T-g)/2,de=Math.abs(s-(g+te));if(de>te+a)return!1;if(V<=R||de<=te)return!0;var ye=V-R,xe=de-te;return ye*ye+xe*xe<=a*a};var oo=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Wa(n,s){for(var a=0;a<n;a++){var h=s.length;s.resize(h+4),s.float32.set(oo,3*h)}}function Xa(n,s,a){var h=s[0],g=s[1];return n[0]=a[0]*h+a[4]*g+a[12],n[1]=a[1]*h+a[5]*g+a[13],n[3]=a[3]*h+a[7]*g+a[15],n}var Wo=function(n,s,a){s===void 0&&(s=new ji(n.width+200,n.height+200,25)),a===void 0&&(a=new ji(n.width+200,n.height+200,25)),this.transform=n,this.grid=s,this.ignoredGrid=a,this.pitchfactor=Math.cos(n._pitch)*n.cameraToCenterDistance,this.screenRightBoundary=n.width+100,this.screenBottomBoundary=n.height+100,this.gridRightBoundary=n.width+200,this.gridBottomBoundary=n.height+200};function sa(n,s,a){return s*(p.EXTENT/(n.tileSize*Math.pow(2,a-n.tileID.overscaledZ)))}Wo.prototype.placeCollisionBox=function(n,s,a,h,g){var b=this.projectAndGetPerspectiveRatio(h,n.anchorPointX,n.anchorPointY),T=a*b.perspectiveRatio,R=n.x1*T+b.point.x,V=n.y1*T+b.point.y,te=n.x2*T+b.point.x,de=n.y2*T+b.point.y;return!this.isInsideGrid(R,V,te,de)||!s&&this.grid.hitTest(R,V,te,de,g)?{box:[],offscreen:!1}:{box:[R,V,te,de],offscreen:this.isOffscreen(R,V,te,de)}},Wo.prototype.placeCollisionCircles=function(n,s,a,h,g,b,T,R,V,te,de,ye,xe){var He=[],Ze=new p.Point(s.anchorX,s.anchorY),nt=li(Ze,b),ze=Vn(this.transform.cameraToCenterDistance,nt.signedDistanceFromCamera),rt=(te?g/ze:g*ze)/p.ONE_EM,ht=li(Ze,T).point,Nt=ki(rt,h,s.lineOffsetX*rt,s.lineOffsetY*rt,!1,ht,Ze,s,a,T,{}),or=!1,rr=!1,sr=!0;if(Nt){for(var Lr=.5*ye*ze+xe,rn=new p.Point(-100,-100),Qr=new p.Point(this.screenRightBoundary,this.screenBottomBoundary),xn=new po,jn=Nt.first,Xn=Nt.last,Wn=[],$i=jn.path.length-1;$i>=1;$i--)Wn.push(jn.path[$i]);for(var Sn=1;Sn<Xn.path.length;Sn++)Wn.push(Xn.path[Sn]);var oi=2.5*Lr;if(R){var Si=Wn.map(function(Vs){return li(Vs,R)});Wn=Si.some(function(Vs){return Vs.signedDistanceFromCamera<=0})?[]:Si.map(function(Vs){return Vs.point})}var ai=[];if(Wn.length>0){for(var ii=Wn[0].clone(),Ei=Wn[0].clone(),ri=1;ri<Wn.length;ri++)ii.x=Math.min(ii.x,Wn[ri].x),ii.y=Math.min(ii.y,Wn[ri].y),Ei.x=Math.max(Ei.x,Wn[ri].x),Ei.y=Math.max(Ei.y,Wn[ri].y);ai=ii.x>=rn.x&&Ei.x<=Qr.x&&ii.y>=rn.y&&Ei.y<=Qr.y?[Wn]:Ei.x<rn.x||ii.x>Qr.x||Ei.y<rn.y||ii.y>Qr.y?[]:p.clipLine([Wn],rn.x,rn.y,Qr.x,Qr.y)}for(var Qn=0,mo=ai;Qn<mo.length;Qn+=1){var Ja;xn.reset(mo[Qn],.25*Lr),Ja=xn.length<=.5*Lr?1:Math.ceil(xn.paddedLength/oi)+1;for(var os=0;os<Ja;os++){var Fo=os/Math.max(Ja-1,1),Qa=xn.lerp(Fo),ro=Qa.x+100,ms=Qa.y+100;He.push(ro,ms,Lr,0);var zo=ro-Lr,Cu=ms-Lr,ss=ro+Lr,Zs=ms+Lr;if(sr=sr&&this.isOffscreen(zo,Cu,ss,Zs),rr=rr||this.isInsideGrid(zo,Cu,ss,Zs),!n&&this.grid.hitTestCircle(ro,ms,Lr,de)&&(or=!0,!V))return{circles:[],offscreen:!1,collisionDetected:or}}}}return{circles:!V&&or||!rr?[]:He,offscreen:sr,collisionDetected:or}},Wo.prototype.queryRenderedSymbols=function(n){if(n.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};for(var s=[],a=1/0,h=1/0,g=-1/0,b=-1/0,T=0,R=n;T<R.length;T+=1){var V=R[T],te=new p.Point(V.x+100,V.y+100);a=Math.min(a,te.x),h=Math.min(h,te.y),g=Math.max(g,te.x),b=Math.max(b,te.y),s.push(te)}for(var de={},ye={},xe=0,He=this.grid.query(a,h,g,b).concat(this.ignoredGrid.query(a,h,g,b));xe<He.length;xe+=1){var Ze=He[xe],nt=Ze.key;if(de[nt.bucketInstanceId]===void 0&&(de[nt.bucketInstanceId]={}),!de[nt.bucketInstanceId][nt.featureIndex]){var ze=[new p.Point(Ze.x1,Ze.y1),new p.Point(Ze.x2,Ze.y1),new p.Point(Ze.x2,Ze.y2),new p.Point(Ze.x1,Ze.y2)];p.polygonIntersectsPolygon(s,ze)&&(de[nt.bucketInstanceId][nt.featureIndex]=!0,ye[nt.bucketInstanceId]===void 0&&(ye[nt.bucketInstanceId]=[]),ye[nt.bucketInstanceId].push(nt.featureIndex))}}return ye},Wo.prototype.insertCollisionBox=function(n,s,a,h,g){(s?this.ignoredGrid:this.grid).insert({bucketInstanceId:a,featureIndex:h,collisionGroupID:g},n[0],n[1],n[2],n[3])},Wo.prototype.insertCollisionCircles=function(n,s,a,h,g){for(var b=s?this.ignoredGrid:this.grid,T={bucketInstanceId:a,featureIndex:h,collisionGroupID:g},R=0;R<n.length;R+=4)b.insertCircle(T,n[R],n[R+1],n[R+2])},Wo.prototype.projectAndGetPerspectiveRatio=function(n,s,a){var h=[s,a,0,1];return Xa(h,h,n),{point:new p.Point((h[0]/h[3]+1)/2*this.transform.width+100,(-h[1]/h[3]+1)/2*this.transform.height+100),perspectiveRatio:.5+this.transform.cameraToCenterDistance/h[3]*.5}},Wo.prototype.isOffscreen=function(n,s,a,h){return a<100||n>=this.screenRightBoundary||h<100||s>this.screenBottomBoundary},Wo.prototype.isInsideGrid=function(n,s,a,h){return a>=0&&n<this.gridRightBoundary&&h>=0&&s<this.gridBottomBoundary},Wo.prototype.getViewportMatrix=function(){var n=p.identity([]);return p.translate(n,n,[-100,-100,0]),n};var Ya=function(n,s,a,h){this.opacity=n?Math.max(0,Math.min(1,n.opacity+(n.placed?s:-s))):h&&a?1:0,this.placed=a};Ya.prototype.isHidden=function(){return this.opacity===0&&!this.placed};var Ta=function(n,s,a,h,g){this.text=new Ya(n?n.text:null,s,a,g),this.icon=new Ya(n?n.icon:null,s,h,g)};Ta.prototype.isHidden=function(){return this.text.isHidden()&&this.icon.isHidden()};var xa=function(n,s,a){this.text=n,this.icon=s,this.skipFade=a},ta=function(){this.invProjMatrix=p.create(),this.viewportMatrix=p.create(),this.circles=[]},sl=function(n,s,a,h,g){this.bucketInstanceId=n,this.featureIndex=s,this.sourceLayerIndex=a,this.bucketIndex=h,this.tileID=g},rs=function(n){this.crossSourceCollisions=n,this.maxGroupID=0,this.collisionGroups={}};function qa(n,s,a,h,g){var b=p.getAnchorAlignment(n),T=-(b.horizontalAlign-.5)*s,R=-(b.verticalAlign-.5)*a,V=p.evaluateVariableOffset(n,h);return new p.Point(T+V[0]*g,R+V[1]*g)}function La(n,s,a,h,g,b){var T=n.x1,R=n.x2,V=n.y1,te=n.y2,de=n.anchorPointX,ye=n.anchorPointY,xe=new p.Point(s,a);return h&&xe._rotate(g?b:-b),{x1:T+xe.x,y1:V+xe.y,x2:R+xe.x,y2:te+xe.y,anchorPointX:de,anchorPointY:ye}}rs.prototype.get=function(n){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[n]){var s=++this.maxGroupID;this.collisionGroups[n]={ID:s,predicate:function(a){return a.collisionGroupID===s}}}return this.collisionGroups[n]};var fa=function(n,s,a,h){this.transform=n.clone(),this.collisionIndex=new Wo(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=s,this.retainedQueryData={},this.collisionGroups=new rs(a),this.collisionCircleArrays={},this.prevPlacement=h,h&&(h.prevPlacement=void 0),this.placedOrientations={}};function he(n,s,a,h,g){n.emplaceBack(s?1:0,a?1:0,h||0,g||0),n.emplaceBack(s?1:0,a?1:0,h||0,g||0),n.emplaceBack(s?1:0,a?1:0,h||0,g||0),n.emplaceBack(s?1:0,a?1:0,h||0,g||0)}fa.prototype.getBucketParts=function(n,s,a,h){var g=a.getBucket(s),b=a.latestFeatureIndex;if(g&&b&&s.id===g.layerIds[0]){var T=a.collisionBoxArray,R=g.layers[0].layout,V=Math.pow(2,this.transform.zoom-a.tileID.overscaledZ),te=a.tileSize/p.EXTENT,de=this.transform.calculatePosMatrix(a.tileID.toUnwrapped()),ye=R.get("text-pitch-alignment")==="map",xe=R.get("text-rotation-alignment")==="map",He=sa(a,1,this.transform.zoom),Ze=Rn(de,ye,xe,this.transform,He),nt=null;if(ye){var ze=Dn(de,ye,xe,this.transform,He);nt=p.multiply([],this.transform.labelPlaneMatrix,ze)}this.retainedQueryData[g.bucketInstanceId]=new sl(g.bucketInstanceId,b,g.sourceLayerIndex,g.index,a.tileID);var rt={bucket:g,layout:R,posMatrix:de,textLabelPlaneMatrix:Ze,labelToScreenMatrix:nt,scale:V,textPixelRatio:te,holdingForFade:a.holdingForFade(),collisionBoxArray:T,partiallyEvaluatedTextSize:p.evaluateSizeForZoom(g.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(g.sourceID)};if(h)for(var ht=0,Nt=g.sortKeyRanges;ht<Nt.length;ht+=1){var or=Nt[ht];n.push({sortKey:or.sortKey,symbolInstanceStart:or.symbolInstanceStart,symbolInstanceEnd:or.symbolInstanceEnd,parameters:rt})}else n.push({symbolInstanceStart:0,symbolInstanceEnd:g.symbolInstances.length,parameters:rt})}},fa.prototype.attemptAnchorPlacement=function(n,s,a,h,g,b,T,R,V,te,de,ye,xe,He,Ze){var nt,ze=[ye.textOffset0,ye.textOffset1],rt=qa(n,a,h,ze,g),ht=this.collisionIndex.placeCollisionBox(La(s,rt.x,rt.y,b,T,this.transform.angle),de,R,V,te.predicate);if(!Ze||this.collisionIndex.placeCollisionBox(La(Ze,rt.x,rt.y,b,T,this.transform.angle),de,R,V,te.predicate).box.length!==0)return ht.box.length>0?(this.prevPlacement&&this.prevPlacement.variableOffsets[ye.crossTileID]&&this.prevPlacement.placements[ye.crossTileID]&&this.prevPlacement.placements[ye.crossTileID].text&&(nt=this.prevPlacement.variableOffsets[ye.crossTileID].anchor),this.variableOffsets[ye.crossTileID]={textOffset:ze,width:a,height:h,anchor:n,textBoxScale:g,prevAnchor:nt},this.markUsedJustification(xe,n,ye,He),xe.allowVerticalPlacement&&(this.markUsedOrientation(xe,He,ye),this.placedOrientations[ye.crossTileID]=He),{shift:rt,placedGlyphBoxes:ht}):void 0},fa.prototype.placeLayerBucketPart=function(n,s,a){var h=this,g=n.parameters,b=g.bucket,T=g.layout,R=g.posMatrix,V=g.textLabelPlaneMatrix,te=g.labelToScreenMatrix,de=g.textPixelRatio,ye=g.holdingForFade,xe=g.collisionBoxArray,He=g.partiallyEvaluatedTextSize,Ze=g.collisionGroup,nt=T.get("text-optional"),ze=T.get("icon-optional"),rt=T.get("text-allow-overlap"),ht=T.get("icon-allow-overlap"),Nt=T.get("text-rotation-alignment")==="map",or=T.get("text-pitch-alignment")==="map",rr=T.get("icon-text-fit")!=="none",sr=T.get("symbol-z-order")==="viewport-y",Lr=rt&&(ht||!b.hasIconData()||ze),rn=ht&&(rt||!b.hasTextData()||nt);!b.collisionArrays&&xe&&b.deserializeCollisionBoxes(xe);var Qr=function(Sn,oi){if(!s[Sn.crossTileID])if(ye)h.placements[Sn.crossTileID]=new xa(!1,!1,!1);else{var Si,ai=!1,ii=!1,Ei=!0,ri=null,Qn={box:null,offscreen:null},mo={box:null,offscreen:null},Ja=null,os=null,Fo=0,Qa=0,ro=0;oi.textFeatureIndex?Fo=oi.textFeatureIndex:Sn.useRuntimeCollisionCircles&&(Fo=Sn.featureIndex),oi.verticalTextFeatureIndex&&(Qa=oi.verticalTextFeatureIndex);var ms=oi.textBox;if(ms){var zo=function(Ji){var No=p.WritingMode.horizontal;if(b.allowVerticalPlacement&&!Ji&&h.prevPlacement){var go=h.prevPlacement.placedOrientations[Sn.crossTileID];go&&(h.placedOrientations[Sn.crossTileID]=go,h.markUsedOrientation(b,No=go,Sn))}return No},Cu=function(Ji,No){if(b.allowVerticalPlacement&&Sn.numVerticalGlyphVertices>0&&oi.verticalTextBox)for(var go=0,Mu=b.writingModes;go<Mu.length&&(Mu[go]===p.WritingMode.vertical?(Qn=No(),mo=Qn):Qn=Ji(),!(Qn&&Qn.box&&Qn.box.length));go+=1);else Qn=Ji()};if(T.get("text-variable-anchor")){var ss=T.get("text-variable-anchor");if(h.prevPlacement&&h.prevPlacement.variableOffsets[Sn.crossTileID]){var Zs=h.prevPlacement.variableOffsets[Sn.crossTileID];ss.indexOf(Zs.anchor)>0&&(ss=ss.filter(function(Ji){return Ji!==Zs.anchor})).unshift(Zs.anchor)}var Vs=function(Ji,No,go){for(var Mu=Ji.x2-Ji.x1,ru=Ji.y2-Ji.y1,mu=Sn.textBoxScale,Gu=rr&&!ht?No:null,Iu={box:[],offscreen:!1},Gs=rt?2*ss.length:ss.length,nu=0;nu<Gs;++nu){var Tl=h.attemptAnchorPlacement(ss[nu%ss.length],Ji,Mu,ru,mu,Nt,or,de,R,Ze,nu>=ss.length,Sn,b,go,Gu);if(Tl&&(Iu=Tl.placedGlyphBoxes)&&Iu.box&&Iu.box.length){ai=!0,ri=Tl.shift;break}}return Iu};Cu(function(){return Vs(ms,oi.iconBox,p.WritingMode.horizontal)},function(){var Ji=oi.verticalTextBox;return b.allowVerticalPlacement&&!(Qn&&Qn.box&&Qn.box.length)&&Sn.numVerticalGlyphVertices>0&&Ji?Vs(Ji,oi.verticalIconBox,p.WritingMode.vertical):{box:null,offscreen:null}}),Qn&&(ai=Qn.box,Ei=Qn.offscreen);var Sl=zo(Qn&&Qn.box);if(!ai&&h.prevPlacement){var El=h.prevPlacement.variableOffsets[Sn.crossTileID];El&&(h.variableOffsets[Sn.crossTileID]=El,h.markUsedJustification(b,El.anchor,Sn,Sl))}}else{var Ls=function(Ji,No){var go=h.collisionIndex.placeCollisionBox(Ji,rt,de,R,Ze.predicate);return go&&go.box&&go.box.length&&(h.markUsedOrientation(b,No,Sn),h.placedOrientations[Sn.crossTileID]=No),go};Cu(function(){return Ls(ms,p.WritingMode.horizontal)},function(){var Ji=oi.verticalTextBox;return b.allowVerticalPlacement&&Sn.numVerticalGlyphVertices>0&&Ji?Ls(Ji,p.WritingMode.vertical):{box:null,offscreen:null}}),zo(Qn&&Qn.box&&Qn.box.length)}}if(ai=(Si=Qn)&&Si.box&&Si.box.length>0,Ei=Si&&Si.offscreen,Sn.useRuntimeCollisionCircles){var Vu=b.text.placedSymbolArray.get(Sn.centerJustifiedTextSymbolIndex),jl=p.evaluateSizeForFeature(b.textSizeData,He,Vu),du=T.get("text-padding");Ja=h.collisionIndex.placeCollisionCircles(rt,Vu,b.lineVertexArray,b.glyphOffsetArray,jl,R,V,te,a,or,Ze.predicate,Sn.collisionCircleDiameter,du),ai=rt||Ja.circles.length>0&&!Ja.collisionDetected,Ei=Ei&&Ja.offscreen}if(oi.iconFeatureIndex&&(ro=oi.iconFeatureIndex),oi.iconBox){var wl=function(Ji){var No=rr&&ri?La(Ji,ri.x,ri.y,Nt,or,h.transform.angle):Ji;return h.collisionIndex.placeCollisionBox(No,ht,de,R,Ze.predicate)};ii=mo&&mo.box&&mo.box.length&&oi.verticalIconBox?(os=wl(oi.verticalIconBox)).box.length>0:(os=wl(oi.iconBox)).box.length>0,Ei=Ei&&os.offscreen}var tu=nt||Sn.numHorizontalGlyphVertices===0&&Sn.numVerticalGlyphVertices===0,no=ze||Sn.numIconVertices===0;if(tu||no?no?tu||(ii=ii&&ai):ai=ii&&ai:ii=ai=ii&&ai,ai&&Si&&Si.box&&h.collisionIndex.insertCollisionBox(Si.box,T.get("text-ignore-placement"),b.bucketInstanceId,mo&&mo.box&&Qa?Qa:Fo,Ze.ID),ii&&os&&h.collisionIndex.insertCollisionBox(os.box,T.get("icon-ignore-placement"),b.bucketInstanceId,ro,Ze.ID),Ja&&(ai&&h.collisionIndex.insertCollisionCircles(Ja.circles,T.get("text-ignore-placement"),b.bucketInstanceId,Fo,Ze.ID),a)){var Pu=b.bucketInstanceId,vu=h.collisionCircleArrays[Pu];vu===void 0&&(vu=h.collisionCircleArrays[Pu]=new ta);for(var ws=0;ws<Ja.circles.length;ws+=4)vu.circles.push(Ja.circles[ws+0]),vu.circles.push(Ja.circles[ws+1]),vu.circles.push(Ja.circles[ws+2]),vu.circles.push(Ja.collisionDetected?1:0)}h.placements[Sn.crossTileID]=new xa(ai||Lr,ii||rn,Ei||b.justReloaded),s[Sn.crossTileID]=!0}};if(sr)for(var xn=b.getSortedSymbolIndexes(this.transform.angle),jn=xn.length-1;jn>=0;--jn){var Xn=xn[jn];Qr(b.symbolInstances.get(Xn),b.collisionArrays[Xn])}else for(var Wn=n.symbolInstanceStart;Wn<n.symbolInstanceEnd;Wn++)Qr(b.symbolInstances.get(Wn),b.collisionArrays[Wn]);if(a&&b.bucketInstanceId in this.collisionCircleArrays){var $i=this.collisionCircleArrays[b.bucketInstanceId];p.invert($i.invProjMatrix,R),$i.viewportMatrix=this.collisionIndex.getViewportMatrix()}b.justReloaded=!1},fa.prototype.markUsedJustification=function(n,s,a,h){var g;g=h===p.WritingMode.vertical?a.verticalPlacedTextSymbolIndex:{left:a.leftJustifiedTextSymbolIndex,center:a.centerJustifiedTextSymbolIndex,right:a.rightJustifiedTextSymbolIndex}[p.getAnchorJustification(s)];for(var b=0,T=[a.leftJustifiedTextSymbolIndex,a.centerJustifiedTextSymbolIndex,a.rightJustifiedTextSymbolIndex,a.verticalPlacedTextSymbolIndex];b<T.length;b+=1){var R=T[b];R>=0&&(n.text.placedSymbolArray.get(R).crossTileID=g>=0&&R!==g?0:a.crossTileID)}},fa.prototype.markUsedOrientation=function(n,s,a){for(var h=s===p.WritingMode.horizontal||s===p.WritingMode.horizontalOnly?s:0,g=s===p.WritingMode.vertical?s:0,b=0,T=[a.leftJustifiedTextSymbolIndex,a.centerJustifiedTextSymbolIndex,a.rightJustifiedTextSymbolIndex];b<T.length;b+=1)n.text.placedSymbolArray.get(T[b]).placedOrientation=h;a.verticalPlacedTextSymbolIndex&&(n.text.placedSymbolArray.get(a.verticalPlacedTextSymbolIndex).placedOrientation=g)},fa.prototype.commit=function(n){this.commitTime=n,this.zoomAtLastRecencyCheck=this.transform.zoom;var s=this.prevPlacement,a=!1;this.prevZoomAdjustment=s?s.zoomAdjustment(this.transform.zoom):0;var h=s?s.symbolFadeChange(n):1,g=s?s.opacities:{},b=s?s.variableOffsets:{},T=s?s.placedOrientations:{};for(var R in this.placements){var V=this.placements[R],te=g[R];te?(this.opacities[R]=new Ta(te,h,V.text,V.icon),a=a||V.text!==te.text.placed||V.icon!==te.icon.placed):(this.opacities[R]=new Ta(null,h,V.text,V.icon,V.skipFade),a=a||V.text||V.icon)}for(var de in g){var ye=g[de];if(!this.opacities[de]){var xe=new Ta(ye,h,!1,!1);xe.isHidden()||(this.opacities[de]=xe,a=a||ye.text.placed||ye.icon.placed)}}for(var He in b)this.variableOffsets[He]||!this.opacities[He]||this.opacities[He].isHidden()||(this.variableOffsets[He]=b[He]);for(var Ze in T)this.placedOrientations[Ze]||!this.opacities[Ze]||this.opacities[Ze].isHidden()||(this.placedOrientations[Ze]=T[Ze]);a?this.lastPlacementChangeTime=n:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=s?s.lastPlacementChangeTime:n)},fa.prototype.updateLayerOpacities=function(n,s){for(var a={},h=0,g=s;h<g.length;h+=1){var b=g[h],T=b.getBucket(n);T&&b.latestFeatureIndex&&n.id===T.layerIds[0]&&this.updateBucketOpacities(T,a,b.collisionBoxArray)}},fa.prototype.updateBucketOpacities=function(n,s,a){var h=this;n.hasTextData()&&n.text.opacityVertexArray.clear(),n.hasIconData()&&n.icon.opacityVertexArray.clear(),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexArray.clear(),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexArray.clear();var g=n.layers[0].layout,b=new Ta(null,0,!1,!1,!0),T=g.get("text-allow-overlap"),R=g.get("icon-allow-overlap"),V=g.get("text-variable-anchor"),te=g.get("text-rotation-alignment")==="map",de=g.get("text-pitch-alignment")==="map",ye=g.get("icon-text-fit")!=="none",xe=new Ta(null,0,T&&(R||!n.hasIconData()||g.get("icon-optional")),R&&(T||!n.hasTextData()||g.get("text-optional")),!0);!n.collisionArrays&&a&&(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData())&&n.deserializeCollisionBoxes(a);for(var He=function(rt,ht,Nt){for(var or=0;or<ht/4;or++)rt.opacityVertexArray.emplaceBack(Nt)},Ze=function(rt){var ht=n.symbolInstances.get(rt),Nt=ht.numHorizontalGlyphVertices,or=ht.numVerticalGlyphVertices,rr=ht.crossTileID,sr=h.opacities[rr];s[rr]?sr=b:sr||(h.opacities[rr]=sr=xe),s[rr]=!0;var Lr=ht.numIconVertices>0,rn=h.placedOrientations[ht.crossTileID],Qr=rn===p.WritingMode.vertical,xn=rn===p.WritingMode.horizontal||rn===p.WritingMode.horizontalOnly;if(Nt>0||or>0){var jn=Ka(sr.text);He(n.text,Nt,Qr?$a:jn),He(n.text,or,xn?$a:jn);var Xn=sr.text.isHidden();[ht.rightJustifiedTextSymbolIndex,ht.centerJustifiedTextSymbolIndex,ht.leftJustifiedTextSymbolIndex].forEach(function(Qn){Qn>=0&&(n.text.placedSymbolArray.get(Qn).hidden=Xn||Qr?1:0)}),ht.verticalPlacedTextSymbolIndex>=0&&(n.text.placedSymbolArray.get(ht.verticalPlacedTextSymbolIndex).hidden=Xn||xn?1:0);var Wn=h.variableOffsets[ht.crossTileID];Wn&&h.markUsedJustification(n,Wn.anchor,ht,rn);var $i=h.placedOrientations[ht.crossTileID];$i&&(h.markUsedJustification(n,"left",ht,$i),h.markUsedOrientation(n,$i,ht))}if(Lr){var Sn=Ka(sr.icon),oi=!(ye&&ht.verticalPlacedIconSymbolIndex&&Qr);ht.placedIconSymbolIndex>=0&&(He(n.icon,ht.numIconVertices,oi?Sn:$a),n.icon.placedSymbolArray.get(ht.placedIconSymbolIndex).hidden=sr.icon.isHidden()),ht.verticalPlacedIconSymbolIndex>=0&&(He(n.icon,ht.numVerticalIconVertices,oi?$a:Sn),n.icon.placedSymbolArray.get(ht.verticalPlacedIconSymbolIndex).hidden=sr.icon.isHidden())}if(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData()){var Si=n.collisionArrays[rt];if(Si){var ai=new p.Point(0,0);if(Si.textBox||Si.verticalTextBox){var ii=!0;if(V){var Ei=h.variableOffsets[rr];Ei?(ai=qa(Ei.anchor,Ei.width,Ei.height,Ei.textOffset,Ei.textBoxScale),te&&ai._rotate(de?h.transform.angle:-h.transform.angle)):ii=!1}Si.textBox&&he(n.textCollisionBox.collisionVertexArray,sr.text.placed,!ii||Qr,ai.x,ai.y),Si.verticalTextBox&&he(n.textCollisionBox.collisionVertexArray,sr.text.placed,!ii||xn,ai.x,ai.y)}var ri=Boolean(!xn&&Si.verticalIconBox);Si.iconBox&&he(n.iconCollisionBox.collisionVertexArray,sr.icon.placed,ri,ye?ai.x:0,ye?ai.y:0),Si.verticalIconBox&&he(n.iconCollisionBox.collisionVertexArray,sr.icon.placed,!ri,ye?ai.x:0,ye?ai.y:0)}}},nt=0;nt<n.symbolInstances.length;nt++)Ze(nt);if(n.sortFeatures(this.transform.angle),this.retainedQueryData[n.bucketInstanceId]&&(this.retainedQueryData[n.bucketInstanceId].featureSortOrder=n.featureSortOrder),n.hasTextData()&&n.text.opacityVertexBuffer&&n.text.opacityVertexBuffer.updateData(n.text.opacityVertexArray),n.hasIconData()&&n.icon.opacityVertexBuffer&&n.icon.opacityVertexBuffer.updateData(n.icon.opacityVertexArray),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexBuffer&&n.iconCollisionBox.collisionVertexBuffer.updateData(n.iconCollisionBox.collisionVertexArray),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexBuffer&&n.textCollisionBox.collisionVertexBuffer.updateData(n.textCollisionBox.collisionVertexArray),n.bucketInstanceId in this.collisionCircleArrays){var ze=this.collisionCircleArrays[n.bucketInstanceId];n.placementInvProjMatrix=ze.invProjMatrix,n.placementViewportMatrix=ze.viewportMatrix,n.collisionCircleArray=ze.circles,delete this.collisionCircleArrays[n.bucketInstanceId]}},fa.prototype.symbolFadeChange=function(n){return this.fadeDuration===0?1:(n-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment},fa.prototype.zoomAdjustment=function(n){return Math.max(0,(this.transform.zoom-n)/1.5)},fa.prototype.hasTransitions=function(n){return this.stale||n-this.lastPlacementChangeTime<this.fadeDuration},fa.prototype.stillRecent=function(n,s){var a=this.zoomAtLastRecencyCheck===s?1-this.zoomAdjustment(s):1;return this.zoomAtLastRecencyCheck=s,this.commitTime+this.fadeDuration*a>n},fa.prototype.setStale=function(){this.stale=!0};var Pe=Math.pow(2,25),ct=Math.pow(2,24),cr=Math.pow(2,17),tn=Math.pow(2,16),kn=Math.pow(2,9),Zi=Math.pow(2,8),Yi=Math.pow(2,1);function Ka(n){if(n.opacity===0&&!n.placed)return 0;if(n.opacity===1&&n.placed)return 4294967295;var s=n.placed?1:0,a=Math.floor(127*n.opacity);return a*Pe+s*ct+a*cr+s*tn+a*kn+s*Zi+a*Yi+s}var $a=0,Xo=function(n){this._sortAcrossTiles=n.layout.get("symbol-z-order")!=="viewport-y"&&n.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]};Xo.prototype.continuePlacement=function(n,s,a,h,g){for(var b=this._bucketParts;this._currentTileIndex<n.length;)if(s.getBucketParts(b,h,n[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,g())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,b.sort(function(T,R){return T.sortKey-R.sortKey}));this._currentPartIndex<b.length;)if(s.placeLayerBucketPart(b[this._currentPartIndex],this._seenCrossTileIDs,a),this._currentPartIndex++,g())return!0;return!1};var xs=function(n,s,a,h,g,b,T){this.placement=new fa(n,g,b,T),this._currentPlacementIndex=s.length-1,this._forceFullPlacement=a,this._showCollisionBoxes=h,this._done=!1};xs.prototype.isDone=function(){return this._done},xs.prototype.continuePlacement=function(n,s,a){for(var h=this,g=p.browser.now(),b=function(){var V=p.browser.now()-g;return!h._forceFullPlacement&&V>2};this._currentPlacementIndex>=0;){var T=s[n[this._currentPlacementIndex]],R=this.placement.collisionIndex.transform.zoom;if(T.type==="symbol"&&(!T.minzoom||T.minzoom<=R)&&(!T.maxzoom||T.maxzoom>R)){if(this._inProgressLayer||(this._inProgressLayer=new Xo(T)),this._inProgressLayer.continuePlacement(a[T.source],this.placement,this._showCollisionBoxes,T,b))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0},xs.prototype.commit=function(n){return this.placement.commit(n),this.placement};var Hl=512/p.EXTENT/2,Xu=function(n,s,a){this.tileID=n,this.indexedSymbolInstances={},this.bucketInstanceId=a;for(var h=0;h<s.length;h++){var g=s.get(h),b=g.key;this.indexedSymbolInstances[b]||(this.indexedSymbolInstances[b]=[]),this.indexedSymbolInstances[b].push({crossTileID:g.crossTileID,coord:this.getScaledCoordinates(g,n)})}};Xu.prototype.getScaledCoordinates=function(n,s){var a=Hl/Math.pow(2,s.canonical.z-this.tileID.canonical.z);return{x:Math.floor((s.canonical.x*p.EXTENT+n.anchorX)*a),y:Math.floor((s.canonical.y*p.EXTENT+n.anchorY)*a)}},Xu.prototype.findMatches=function(n,s,a){for(var h=this.tileID.canonical.z<s.canonical.z?1:Math.pow(2,this.tileID.canonical.z-s.canonical.z),g=0;g<n.length;g++){var b=n.get(g);if(!b.crossTileID){var T=this.indexedSymbolInstances[b.key];if(T)for(var R=this.getScaledCoordinates(b,s),V=0,te=T;V<te.length;V+=1){var de=te[V];if(Math.abs(de.coord.x-R.x)<=h&&Math.abs(de.coord.y-R.y)<=h&&!a[de.crossTileID]){a[de.crossTileID]=!0,b.crossTileID=de.crossTileID;break}}}}};var Ro=function(){this.maxCrossTileID=0};Ro.prototype.generate=function(){return++this.maxCrossTileID};var Cs=function(){this.indexes={},this.usedCrossTileIDs={},this.lng=0};Cs.prototype.handleWrapJump=function(n){var s=Math.round((n-this.lng)/360);if(s!==0)for(var a in this.indexes){var h=this.indexes[a],g={};for(var b in h){var T=h[b];T.tileID=T.tileID.unwrapTo(T.tileID.wrap+s),g[T.tileID.key]=T}this.indexes[a]=g}this.lng=n},Cs.prototype.addBucket=function(n,s,a){if(this.indexes[n.overscaledZ]&&this.indexes[n.overscaledZ][n.key]){if(this.indexes[n.overscaledZ][n.key].bucketInstanceId===s.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(n.overscaledZ,this.indexes[n.overscaledZ][n.key])}for(var h=0;h<s.symbolInstances.length;h++)s.symbolInstances.get(h).crossTileID=0;this.usedCrossTileIDs[n.overscaledZ]||(this.usedCrossTileIDs[n.overscaledZ]={});var g=this.usedCrossTileIDs[n.overscaledZ];for(var b in this.indexes){var T=this.indexes[b];if(Number(b)>n.overscaledZ)for(var R in T){var V=T[R];V.tileID.isChildOf(n)&&V.findMatches(s.symbolInstances,n,g)}else{var te=T[n.scaledTo(Number(b)).key];te&&te.findMatches(s.symbolInstances,n,g)}}for(var de=0;de<s.symbolInstances.length;de++){var ye=s.symbolInstances.get(de);ye.crossTileID||(ye.crossTileID=a.generate(),g[ye.crossTileID]=!0)}return this.indexes[n.overscaledZ]===void 0&&(this.indexes[n.overscaledZ]={}),this.indexes[n.overscaledZ][n.key]=new Xu(n,s.symbolInstances,s.bucketInstanceId),!0},Cs.prototype.removeBucketCrossTileIDs=function(n,s){for(var a in s.indexedSymbolInstances)for(var h=0,g=s.indexedSymbolInstances[a];h<g.length;h+=1)delete this.usedCrossTileIDs[n][g[h].crossTileID]},Cs.prototype.removeStaleBuckets=function(n){var s=!1;for(var a in this.indexes){var h=this.indexes[a];for(var g in h)n[h[g].bucketInstanceId]||(this.removeBucketCrossTileIDs(a,h[g]),delete h[g],s=!0)}return s};var so=function(){this.layerIndexes={},this.crossTileIDs=new Ro,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}};so.prototype.addLayer=function(n,s,a){var h=this.layerIndexes[n.id];h===void 0&&(h=this.layerIndexes[n.id]=new Cs);var g=!1,b={};h.handleWrapJump(a);for(var T=0,R=s;T<R.length;T+=1){var V=R[T],te=V.getBucket(n);te&&n.id===te.layerIds[0]&&(te.bucketInstanceId||(te.bucketInstanceId=++this.maxBucketInstanceId),h.addBucket(V.tileID,te,this.crossTileIDs)&&(g=!0),b[te.bucketInstanceId]=!0)}return h.removeStaleBuckets(b)&&(g=!0),g},so.prototype.pruneUnusedLayers=function(n){var s={};for(var a in n.forEach(function(h){s[h]=!0}),this.layerIndexes)s[a]||delete this.layerIndexes[a]};var Ps=function(n,s){return p.emitValidationErrors(n,s&&s.filter(function(a){return a.identifier!=="source.canvas"}))},Ra=p.pick(cn,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),ci=p.pick(cn,["setCenter","setZoom","setBearing","setPitch"]),ul=function(){var n={},s=p.styleSpec.$version;for(var a in p.styleSpec.$root){var h,g=p.styleSpec.$root[a];g.required&&(h=a==="version"?s:g.type==="array"?[]:{})!=null&&(n[a]=h)}return n}(),ba=function(n){function s(a,h){var g=this;h===void 0&&(h={}),n.call(this),this.map=a,this.dispatcher=new Ae(vr(),this),this.imageManager=new Xt,this.imageManager.setEventedParent(this),this.glyphManager=new ar(a._requestManager,h.localIdeographFontFamily),this.lineAtlas=new Ne(256,512),this.crossTileSymbolIndex=new so,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new p.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",p.getReferrer());var b=this;this._rtlTextPluginCallback=s.registerForPluginStateChange(function(T){b.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:T.pluginStatus,pluginURL:T.pluginURL},function(R,V){if(p.triggerPluginCompletionEvent(R),V&&V.every(function(de){return de}))for(var te in b.sourceCaches)b.sourceCaches[te].reload()})}),this.on("data",function(T){if(T.dataType==="source"&&T.sourceDataType==="metadata"){var R=g.sourceCaches[T.sourceId];if(R){var V=R.getSource();if(V&&V.vectorLayerIds)for(var te in g._layers){var de=g._layers[te];de.source===V.id&&g._validateLayer(de)}}}})}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype.loadURL=function(a,h){var g=this;h===void 0&&(h={}),this.fire(new p.Event("dataloading",{dataType:"style"}));var b=typeof h.validate=="boolean"?h.validate:!p.isMapboxURL(a);a=this.map._requestManager.normalizeStyleURL(a,h.accessToken);var T=this.map._requestManager.transformRequest(a,p.ResourceType.Style);this._request=p.getJSON(T,function(R,V){g._request=null,R?g.fire(new p.ErrorEvent(R)):V&&g._load(V,b)})},s.prototype.loadJSON=function(a,h){var g=this;h===void 0&&(h={}),this.fire(new p.Event("dataloading",{dataType:"style"})),this._request=p.browser.frame(function(){g._request=null,g._load(a,h.validate!==!1)})},s.prototype.loadEmpty=function(){this.fire(new p.Event("dataloading",{dataType:"style"})),this._load(ul,!1)},s.prototype._load=function(a,h){if(!h||!Ps(this,p.validateStyle(a))){for(var g in this._loaded=!0,this.stylesheet=a,a.sources)this.addSource(g,a.sources[g],{validate:!1});a.sprite?this._loadSprite(a.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(a.glyphs);var b=$r(this.stylesheet.layers);this._order=b.map(function(te){return te.id}),this._layers={},this._serializedLayers={};for(var T=0,R=b;T<R.length;T+=1){var V=R[T];(V=p.createStyleLayer(V)).setEventedParent(this,{layer:{id:V.id}}),this._layers[V.id]=V,this._serializedLayers[V.id]=V.serialize()}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new Et(this.stylesheet.light),this.fire(new p.Event("data",{dataType:"style"})),this.fire(new p.Event("style.load"))}},s.prototype._loadSprite=function(a){var h=this;this._spriteRequest=function(g,b,T){var R,V,te,de=p.browser.devicePixelRatio>1?"@2x":"",ye=p.getJSON(b.transformRequest(b.normalizeSpriteURL(g,de,".json"),p.ResourceType.SpriteJSON),function(Ze,nt){ye=null,te||(te=Ze,R=nt,He())}),xe=p.getImage(b.transformRequest(b.normalizeSpriteURL(g,de,".png"),p.ResourceType.SpriteImage),function(Ze,nt){xe=null,te||(te=Ze,V=nt,He())});function He(){if(te)T(te);else if(R&&V){var Ze=p.browser.getImageData(V),nt={};for(var ze in R){var rt=R[ze],ht=rt.width,Nt=rt.height,or=rt.x,rr=rt.y,sr=rt.sdf,Lr=rt.pixelRatio,rn=rt.stretchX,Qr=rt.stretchY,xn=rt.content,jn=new p.RGBAImage({width:ht,height:Nt});p.RGBAImage.copy(Ze,jn,{x:or,y:rr},{x:0,y:0},{width:ht,height:Nt}),nt[ze]={data:jn,pixelRatio:Lr,sdf:sr,stretchX:rn,stretchY:Qr,content:xn}}T(null,nt)}}return{cancel:function(){ye&&(ye.cancel(),ye=null),xe&&(xe.cancel(),xe=null)}}}(a,this.map._requestManager,function(g,b){if(h._spriteRequest=null,g)h.fire(new p.ErrorEvent(g));else if(b)for(var T in b)h.imageManager.addImage(T,b[T]);h.imageManager.setLoaded(!0),h._availableImages=h.imageManager.listImages(),h.dispatcher.broadcast("setImages",h._availableImages),h.fire(new p.Event("data",{dataType:"style"}))})},s.prototype._validateLayer=function(a){var h=this.sourceCaches[a.source];if(h){var g=a.sourceLayer;if(g){var b=h.getSource();(b.type==="geojson"||b.vectorLayerIds&&b.vectorLayerIds.indexOf(g)===-1)&&this.fire(new p.ErrorEvent(new Error('Source layer "'+g+'" does not exist on source "'+b.id+'" as specified by style layer "'+a.id+'"')))}}},s.prototype.loaded=function(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(var a in this.sourceCaches)if(!this.sourceCaches[a].loaded())return!1;return!!this.imageManager.isLoaded()},s.prototype._serializeLayers=function(a){for(var h=[],g=0,b=a;g<b.length;g+=1){var T=this._layers[b[g]];T.type!=="custom"&&h.push(T.serialize())}return h},s.prototype.hasTransitions=function(){if(this.light&&this.light.hasTransition())return!0;for(var a in this.sourceCaches)if(this.sourceCaches[a].hasTransition())return!0;for(var h in this._layers)if(this._layers[h].hasTransition())return!0;return!1},s.prototype._checkLoaded=function(){if(!this._loaded)throw new Error("Style is not done loading")},s.prototype.update=function(a){if(this._loaded){var h=this._changed;if(this._changed){var g=Object.keys(this._updatedLayers),b=Object.keys(this._removedLayers);for(var T in(g.length||b.length)&&this._updateWorkerLayers(g,b),this._updatedSources){var R=this._updatedSources[T];R==="reload"?this._reloadSource(T):R==="clear"&&this._clearSource(T)}for(var V in this._updateTilesForChangedImages(),this._updatedPaintProps)this._layers[V].updateTransitions(a);this.light.updateTransitions(a),this._resetUpdates()}var te={};for(var de in this.sourceCaches){var ye=this.sourceCaches[de];te[de]=ye.used,ye.used=!1}for(var xe=0,He=this._order;xe<He.length;xe+=1){var Ze=this._layers[He[xe]];Ze.recalculate(a,this._availableImages),!Ze.isHidden(a.zoom)&&Ze.source&&(this.sourceCaches[Ze.source].used=!0)}for(var nt in te){var ze=this.sourceCaches[nt];te[nt]!==ze.used&&ze.fire(new p.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:nt}))}this.light.recalculate(a),this.z=a.zoom,h&&this.fire(new p.Event("data",{dataType:"style"}))}},s.prototype._updateTilesForChangedImages=function(){var a=Object.keys(this._changedImages);if(a.length){for(var h in this.sourceCaches)this.sourceCaches[h].reloadTilesForDependencies(["icons","patterns"],a);this._changedImages={}}},s.prototype._updateWorkerLayers=function(a,h){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(a),removedIds:h})},s.prototype._resetUpdates=function(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}},s.prototype.setState=function(a){var h=this;if(this._checkLoaded(),Ps(this,p.validateStyle(a)))return!1;(a=p.clone$1(a)).layers=$r(a.layers);var g=function(T,R){if(!T)return[{command:cn.setStyle,args:[R]}];var V=[];try{if(!p.deepEqual(T.version,R.version))return[{command:cn.setStyle,args:[R]}];p.deepEqual(T.center,R.center)||V.push({command:cn.setCenter,args:[R.center]}),p.deepEqual(T.zoom,R.zoom)||V.push({command:cn.setZoom,args:[R.zoom]}),p.deepEqual(T.bearing,R.bearing)||V.push({command:cn.setBearing,args:[R.bearing]}),p.deepEqual(T.pitch,R.pitch)||V.push({command:cn.setPitch,args:[R.pitch]}),p.deepEqual(T.sprite,R.sprite)||V.push({command:cn.setSprite,args:[R.sprite]}),p.deepEqual(T.glyphs,R.glyphs)||V.push({command:cn.setGlyphs,args:[R.glyphs]}),p.deepEqual(T.transition,R.transition)||V.push({command:cn.setTransition,args:[R.transition]}),p.deepEqual(T.light,R.light)||V.push({command:cn.setLight,args:[R.light]});var te={},de=[];(function(xe,He,Ze,nt){var ze;for(ze in He=He||{},xe=xe||{})xe.hasOwnProperty(ze)&&(He.hasOwnProperty(ze)||pn(ze,Ze,nt));for(ze in He)He.hasOwnProperty(ze)&&(xe.hasOwnProperty(ze)?p.deepEqual(xe[ze],He[ze])||(xe[ze].type==="geojson"&&He[ze].type==="geojson"&&Xi(xe,He,ze)?Ze.push({command:cn.setGeoJSONSourceData,args:[ze,He[ze].data]}):_i(ze,He,Ze,nt)):pi(ze,He,Ze))})(T.sources,R.sources,de,te);var ye=[];T.layers&&T.layers.forEach(function(xe){te[xe.source]?V.push({command:cn.removeLayer,args:[xe.id]}):ye.push(xe)}),V=V.concat(de),function(xe,He,Ze){He=He||[];var nt,ze,rt,ht,Nt,or,rr,sr=(xe=xe||[]).map(Di),Lr=He.map(Di),rn=xe.reduce(Pi,{}),Qr=He.reduce(Pi,{}),xn=sr.slice(),jn=Object.create(null);for(nt=0,ze=0;nt<sr.length;nt++)Qr.hasOwnProperty(rt=sr[nt])?ze++:(Ze.push({command:cn.removeLayer,args:[rt]}),xn.splice(xn.indexOf(rt,ze),1));for(nt=0,ze=0;nt<Lr.length;nt++)xn[xn.length-1-nt]!==(rt=Lr[Lr.length-1-nt])&&(rn.hasOwnProperty(rt)?(Ze.push({command:cn.removeLayer,args:[rt]}),xn.splice(xn.lastIndexOf(rt,xn.length-ze),1)):ze++,Ze.push({command:cn.addLayer,args:[Qr[rt],or=xn[xn.length-nt]]}),xn.splice(xn.length-nt,0,rt),jn[rt]=!0);for(nt=0;nt<Lr.length;nt++)if(ht=rn[rt=Lr[nt]],Nt=Qr[rt],!jn[rt]&&!p.deepEqual(ht,Nt))if(p.deepEqual(ht.source,Nt.source)&&p.deepEqual(ht["source-layer"],Nt["source-layer"])&&p.deepEqual(ht.type,Nt.type)){for(rr in mi(ht.layout,Nt.layout,Ze,rt,null,cn.setLayoutProperty),mi(ht.paint,Nt.paint,Ze,rt,null,cn.setPaintProperty),p.deepEqual(ht.filter,Nt.filter)||Ze.push({command:cn.setFilter,args:[rt,Nt.filter]}),p.deepEqual(ht.minzoom,Nt.minzoom)&&p.deepEqual(ht.maxzoom,Nt.maxzoom)||Ze.push({command:cn.setLayerZoomRange,args:[rt,Nt.minzoom,Nt.maxzoom]}),ht)ht.hasOwnProperty(rr)&&rr!=="layout"&&rr!=="paint"&&rr!=="filter"&&rr!=="metadata"&&rr!=="minzoom"&&rr!=="maxzoom"&&(rr.indexOf("paint.")===0?mi(ht[rr],Nt[rr],Ze,rt,rr.slice(6),cn.setPaintProperty):p.deepEqual(ht[rr],Nt[rr])||Ze.push({command:cn.setLayerProperty,args:[rt,rr,Nt[rr]]}));for(rr in Nt)Nt.hasOwnProperty(rr)&&!ht.hasOwnProperty(rr)&&rr!=="layout"&&rr!=="paint"&&rr!=="filter"&&rr!=="metadata"&&rr!=="minzoom"&&rr!=="maxzoom"&&(rr.indexOf("paint.")===0?mi(ht[rr],Nt[rr],Ze,rt,rr.slice(6),cn.setPaintProperty):p.deepEqual(ht[rr],Nt[rr])||Ze.push({command:cn.setLayerProperty,args:[rt,rr,Nt[rr]]}))}else Ze.push({command:cn.removeLayer,args:[rt]}),or=xn[xn.lastIndexOf(rt)+1],Ze.push({command:cn.addLayer,args:[Nt,or]})}(ye,R.layers,V)}catch(xe){console.warn("Unable to compute style diff:",xe),V=[{command:cn.setStyle,args:[R]}]}return V}(this.serialize(),a).filter(function(T){return!(T.command in ci)});if(g.length===0)return!1;var b=g.filter(function(T){return!(T.command in Ra)});if(b.length>0)throw new Error("Unimplemented: "+b.map(function(T){return T.command}).join(", ")+".");return g.forEach(function(T){T.command!=="setTransition"&&h[T.command].apply(h,T.args)}),this.stylesheet=a,!0},s.prototype.addImage=function(a,h){if(this.getImage(a))return this.fire(new p.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(a,h),this._afterImageUpdated(a)},s.prototype.updateImage=function(a,h){this.imageManager.updateImage(a,h)},s.prototype.getImage=function(a){return this.imageManager.getImage(a)},s.prototype.removeImage=function(a){if(!this.getImage(a))return this.fire(new p.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(a),this._afterImageUpdated(a)},s.prototype._afterImageUpdated=function(a){this._availableImages=this.imageManager.listImages(),this._changedImages[a]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new p.Event("data",{dataType:"style"}))},s.prototype.listImages=function(){return this._checkLoaded(),this.imageManager.listImages()},s.prototype.addSource=function(a,h,g){var b=this;if(g===void 0&&(g={}),this._checkLoaded(),this.sourceCaches[a]!==void 0)throw new Error("There is already a source with this ID");if(!h.type)throw new Error("The type property must be defined, but only the following properties were given: "+Object.keys(h).join(", ")+".");if(!(["vector","raster","geojson","video","image"].indexOf(h.type)>=0&&this._validate(p.validateStyle.source,"sources."+a,h,null,g))){this.map&&this.map._collectResourceTiming&&(h.collectResourceTiming=!0);var T=this.sourceCaches[a]=new De(a,h,this.dispatcher);T.style=this,T.setEventedParent(this,function(){return{isSourceLoaded:b.loaded(),source:T.serialize(),sourceId:a}}),T.onAdd(this.map),this._changed=!0}},s.prototype.removeSource=function(a){if(this._checkLoaded(),this.sourceCaches[a]===void 0)throw new Error("There is no source with this ID");for(var h in this._layers)if(this._layers[h].source===a)return this.fire(new p.ErrorEvent(new Error('Source "'+a+'" cannot be removed while layer "'+h+'" is using it.')));var g=this.sourceCaches[a];delete this.sourceCaches[a],delete this._updatedSources[a],g.fire(new p.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:a})),g.setEventedParent(null),g.clearTiles(),g.onRemove&&g.onRemove(this.map),this._changed=!0},s.prototype.setGeoJSONSourceData=function(a,h){this._checkLoaded(),this.sourceCaches[a].getSource().setData(h),this._changed=!0},s.prototype.getSource=function(a){return this.sourceCaches[a]&&this.sourceCaches[a].getSource()},s.prototype.addLayer=function(a,h,g){g===void 0&&(g={}),this._checkLoaded();var b=a.id;if(this.getLayer(b))this.fire(new p.ErrorEvent(new Error('Layer with id "'+b+'" already exists on this map')));else{var T;if(a.type==="custom"){if(Ps(this,p.validateCustomStyleLayer(a)))return;T=p.createStyleLayer(a)}else{if(typeof a.source=="object"&&(this.addSource(b,a.source),a=p.clone$1(a),a=p.extend(a,{source:b})),this._validate(p.validateStyle.layer,"layers."+b,a,{arrayIndex:-1},g))return;T=p.createStyleLayer(a),this._validateLayer(T),T.setEventedParent(this,{layer:{id:b}}),this._serializedLayers[T.id]=T.serialize()}var R=h?this._order.indexOf(h):this._order.length;if(h&&R===-1)this.fire(new p.ErrorEvent(new Error('Layer with id "'+h+'" does not exist on this map.')));else{if(this._order.splice(R,0,b),this._layerOrderChanged=!0,this._layers[b]=T,this._removedLayers[b]&&T.source&&T.type!=="custom"){var V=this._removedLayers[b];delete this._removedLayers[b],V.type!==T.type?this._updatedSources[T.source]="clear":(this._updatedSources[T.source]="reload",this.sourceCaches[T.source].pause())}this._updateLayer(T),T.onAdd&&T.onAdd(this.map)}}},s.prototype.moveLayer=function(a,h){if(this._checkLoaded(),this._changed=!0,this._layers[a]){if(a!==h){var g=this._order.indexOf(a);this._order.splice(g,1);var b=h?this._order.indexOf(h):this._order.length;h&&b===-1?this.fire(new p.ErrorEvent(new Error('Layer with id "'+h+'" does not exist on this map.'))):(this._order.splice(b,0,a),this._layerOrderChanged=!0)}}else this.fire(new p.ErrorEvent(new Error("The layer '"+a+"' does not exist in the map's style and cannot be moved.")))},s.prototype.removeLayer=function(a){this._checkLoaded();var h=this._layers[a];if(h){h.setEventedParent(null);var g=this._order.indexOf(a);this._order.splice(g,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[a]=h,delete this._layers[a],delete this._serializedLayers[a],delete this._updatedLayers[a],delete this._updatedPaintProps[a],h.onRemove&&h.onRemove(this.map)}else this.fire(new p.ErrorEvent(new Error("The layer '"+a+"' does not exist in the map's style and cannot be removed.")))},s.prototype.getLayer=function(a){return this._layers[a]},s.prototype.hasLayer=function(a){return a in this._layers},s.prototype.setLayerZoomRange=function(a,h,g){this._checkLoaded();var b=this.getLayer(a);b?b.minzoom===h&&b.maxzoom===g||(h!=null&&(b.minzoom=h),g!=null&&(b.maxzoom=g),this._updateLayer(b)):this.fire(new p.ErrorEvent(new Error("The layer '"+a+"' does not exist in the map's style and cannot have zoom extent.")))},s.prototype.setFilter=function(a,h,g){g===void 0&&(g={}),this._checkLoaded();var b=this.getLayer(a);if(b){if(!p.deepEqual(b.filter,h))return h==null?(b.filter=void 0,void this._updateLayer(b)):void(this._validate(p.validateStyle.filter,"layers."+b.id+".filter",h,null,g)||(b.filter=p.clone$1(h),this._updateLayer(b)))}else this.fire(new p.ErrorEvent(new Error("The layer '"+a+"' does not exist in the map's style and cannot be filtered.")))},s.prototype.getFilter=function(a){return p.clone$1(this.getLayer(a).filter)},s.prototype.setLayoutProperty=function(a,h,g,b){b===void 0&&(b={}),this._checkLoaded();var T=this.getLayer(a);T?p.deepEqual(T.getLayoutProperty(h),g)||(T.setLayoutProperty(h,g,b),this._updateLayer(T)):this.fire(new p.ErrorEvent(new Error("The layer '"+a+"' does not exist in the map's style and cannot be styled.")))},s.prototype.getLayoutProperty=function(a,h){var g=this.getLayer(a);if(g)return g.getLayoutProperty(h);this.fire(new p.ErrorEvent(new Error("The layer '"+a+"' does not exist in the map's style.")))},s.prototype.setPaintProperty=function(a,h,g,b){b===void 0&&(b={}),this._checkLoaded();var T=this.getLayer(a);T?p.deepEqual(T.getPaintProperty(h),g)||(T.setPaintProperty(h,g,b)&&this._updateLayer(T),this._changed=!0,this._updatedPaintProps[a]=!0):this.fire(new p.ErrorEvent(new Error("The layer '"+a+"' does not exist in the map's style and cannot be styled.")))},s.prototype.getPaintProperty=function(a,h){return this.getLayer(a).getPaintProperty(h)},s.prototype.setFeatureState=function(a,h){this._checkLoaded();var g=a.source,b=a.sourceLayer,T=this.sourceCaches[g];if(T!==void 0){var R=T.getSource().type;R==="geojson"&&b?this.fire(new p.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):R!=="vector"||b?(a.id===void 0&&this.fire(new p.ErrorEvent(new Error("The feature id parameter must be provided."))),T.setFeatureState(b,a.id,h)):this.fire(new p.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new p.ErrorEvent(new Error("The source '"+g+"' does not exist in the map's style.")))},s.prototype.removeFeatureState=function(a,h){this._checkLoaded();var g=a.source,b=this.sourceCaches[g];if(b!==void 0){var T=b.getSource().type,R=T==="vector"?a.sourceLayer:void 0;T!=="vector"||R?h&&typeof a.id!="string"&&typeof a.id!="number"?this.fire(new p.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):b.removeFeatureState(R,a.id,h):this.fire(new p.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new p.ErrorEvent(new Error("The source '"+g+"' does not exist in the map's style.")))},s.prototype.getFeatureState=function(a){this._checkLoaded();var h=a.source,g=a.sourceLayer,b=this.sourceCaches[h];if(b!==void 0){if(b.getSource().type!=="vector"||g)return a.id===void 0&&this.fire(new p.ErrorEvent(new Error("The feature id parameter must be provided."))),b.getFeatureState(g,a.id);this.fire(new p.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new p.ErrorEvent(new Error("The source '"+h+"' does not exist in the map's style.")))},s.prototype.getTransition=function(){return p.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)},s.prototype.serialize=function(){return p.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:p.mapObject(this.sourceCaches,function(a){return a.serialize()}),layers:this._serializeLayers(this._order)},function(a){return a!==void 0})},s.prototype._updateLayer=function(a){this._updatedLayers[a.id]=!0,a.source&&!this._updatedSources[a.source]&&this.sourceCaches[a.source].getSource().type!=="raster"&&(this._updatedSources[a.source]="reload",this.sourceCaches[a.source].pause()),this._changed=!0},s.prototype._flattenAndSortRenderedFeatures=function(a){for(var h=this,g=function(rn){return h._layers[rn].type==="fill-extrusion"},b={},T=[],R=this._order.length-1;R>=0;R--){var V=this._order[R];if(g(V)){b[V]=R;for(var te=0,de=a;te<de.length;te+=1){var ye=de[te][V];if(ye)for(var xe=0,He=ye;xe<He.length;xe+=1)T.push(He[xe])}}}T.sort(function(rn,Qr){return Qr.intersectionZ-rn.intersectionZ});for(var Ze=[],nt=this._order.length-1;nt>=0;nt--){var ze=this._order[nt];if(g(ze))for(var rt=T.length-1;rt>=0;rt--){var ht=T[rt].feature;if(b[ht.layer.id]<nt)break;Ze.push(ht),T.pop()}else for(var Nt=0,or=a;Nt<or.length;Nt+=1){var rr=or[Nt][ze];if(rr)for(var sr=0,Lr=rr;sr<Lr.length;sr+=1)Ze.push(Lr[sr].feature)}}return Ze},s.prototype.queryRenderedFeatures=function(a,h,g){h&&h.filter&&this._validate(p.validateStyle.filter,"queryRenderedFeatures.filter",h.filter,null,h);var b={};if(h&&h.layers){if(!Array.isArray(h.layers))return this.fire(new p.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(var T=0,R=h.layers;T<R.length;T+=1){var V=R[T],te=this._layers[V];if(!te)return this.fire(new p.ErrorEvent(new Error("The layer '"+V+"' does not exist in the map's style and cannot be queried for features."))),[];b[te.source]=!0}}var de=[];for(var ye in h.availableImages=this._availableImages,this.sourceCaches)h.layers&&!b[ye]||de.push(Fr(this.sourceCaches[ye],this._layers,this._serializedLayers,a,h,g));return this.placement&&de.push(function(xe,He,Ze,nt,ze,rt,ht){for(var Nt={},or=rt.queryRenderedSymbols(nt),rr=[],sr=0,Lr=Object.keys(or).map(Number);sr<Lr.length;sr+=1)rr.push(ht[Lr[sr]]);rr.sort(ln);for(var rn=function(){var Wn=xn[Qr],$i=Wn.featureIndex.lookupSymbolFeatures(or[Wn.bucketInstanceId],He,Wn.bucketIndex,Wn.sourceLayerIndex,ze.filter,ze.layers,ze.availableImages,xe);for(var Sn in $i){var oi=Nt[Sn]=Nt[Sn]||[],Si=$i[Sn];Si.sort(function(Ei,ri){var Qn=Wn.featureSortOrder;if(Qn){var mo=Qn.indexOf(Ei.featureIndex);return Qn.indexOf(ri.featureIndex)-mo}return ri.featureIndex-Ei.featureIndex});for(var ai=0,ii=Si;ai<ii.length;ai+=1)oi.push(ii[ai])}},Qr=0,xn=rr;Qr<xn.length;Qr+=1)rn();var jn=function(Wn){Nt[Wn].forEach(function($i){var Sn=$i.feature,oi=Ze[xe[Wn].source].getFeatureState(Sn.layer["source-layer"],Sn.id);Sn.source=Sn.layer.source,Sn.layer["source-layer"]&&(Sn.sourceLayer=Sn.layer["source-layer"]),Sn.state=oi})};for(var Xn in Nt)jn(Xn);return Nt}(this._layers,this._serializedLayers,this.sourceCaches,a,h,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(de)},s.prototype.querySourceFeatures=function(a,h){h&&h.filter&&this._validate(p.validateStyle.filter,"querySourceFeatures.filter",h.filter,null,h);var g=this.sourceCaches[a];return g?function(b,T){for(var R=b.getRenderableIds().map(function(He){return b.getTileByID(He)}),V=[],te={},de=0;de<R.length;de++){var ye=R[de],xe=ye.tileID.canonical.key;te[xe]||(te[xe]=!0,ye.querySourceFeatures(V,T))}return V}(g,h):[]},s.prototype.addSourceType=function(a,h,g){return s.getSourceType(a)?g(new Error('A source type called "'+a+'" already exists.')):(s.setSourceType(a,h),h.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:a,url:h.workerSourceURL},g):g(null,null))},s.prototype.getLight=function(){return this.light.getLight()},s.prototype.setLight=function(a,h){h===void 0&&(h={}),this._checkLoaded();var g=this.light.getLight(),b=!1;for(var T in a)if(!p.deepEqual(a[T],g[T])){b=!0;break}if(b){var R={now:p.browser.now(),transition:p.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(a,h),this.light.updateTransitions(R)}},s.prototype._validate=function(a,h,g,b,T){return T===void 0&&(T={}),(!T||T.validate!==!1)&&Ps(this,a.call(p.validateStyle,p.extend({key:h,style:this.serialize(),value:g,styleSpec:p.styleSpec},b)))},s.prototype._remove=function(){for(var a in this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),p.evented.off("pluginStateChange",this._rtlTextPluginCallback),this._layers)this._layers[a].setEventedParent(null);for(var h in this.sourceCaches)this.sourceCaches[h].clearTiles(),this.sourceCaches[h].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()},s.prototype._clearSource=function(a){this.sourceCaches[a].clearTiles()},s.prototype._reloadSource=function(a){this.sourceCaches[a].resume(),this.sourceCaches[a].reload()},s.prototype._updateSources=function(a){for(var h in this.sourceCaches)this.sourceCaches[h].update(a)},s.prototype._generateCollisionBoxes=function(){for(var a in this.sourceCaches)this._reloadSource(a)},s.prototype._updatePlacement=function(a,h,g,b,T){T===void 0&&(T=!1);for(var R=!1,V=!1,te={},de=0,ye=this._order;de<ye.length;de+=1){var xe=this._layers[ye[de]];if(xe.type==="symbol"){if(!te[xe.source]){var He=this.sourceCaches[xe.source];te[xe.source]=He.getRenderableIds(!0).map(function(ht){return He.getTileByID(ht)}).sort(function(ht,Nt){return Nt.tileID.overscaledZ-ht.tileID.overscaledZ||(ht.tileID.isLessThan(Nt.tileID)?-1:1)})}var Ze=this.crossTileSymbolIndex.addLayer(xe,te[xe.source],a.center.lng);R=R||Ze}}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((T=T||this._layerOrderChanged||g===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(p.browser.now(),a.zoom))&&(this.pauseablePlacement=new xs(a,this._order,T,h,g,b,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,te),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(p.browser.now()),V=!0),R&&this.pauseablePlacement.placement.setStale()),V||R)for(var nt=0,ze=this._order;nt<ze.length;nt+=1){var rt=this._layers[ze[nt]];rt.type==="symbol"&&this.placement.updateLayerOpacities(rt,te[rt.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(p.browser.now())},s.prototype._releaseSymbolFadeTiles=function(){for(var a in this.sourceCaches)this.sourceCaches[a].releaseSymbolFadeTiles()},s.prototype.getImages=function(a,h,g){this.imageManager.getImages(h.icons,g),this._updateTilesForChangedImages();var b=this.sourceCaches[h.source];b&&b.setDependencies(h.tileID.key,h.type,h.icons)},s.prototype.getGlyphs=function(a,h,g){this.glyphManager.getGlyphs(h.stacks,g)},s.prototype.getResource=function(a,h,g){return p.makeRequest(h,g)},s}(p.Evented);ba.getSourceType=function(n){return Jt[n]},ba.setSourceType=function(n,s){Jt[n]=s},ba.registerForPluginStateChange=p.registerForPluginStateChange;var Nn=p.createLayout([{name:"a_pos",type:"Int16",components:2}]),Ws=Aa(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}`),Wl=Aa(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),uo=Aa(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),je=Aa(`varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,0,1);} else {gl_Position=u_matrix*vec4(circle_center,0,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),Pt=Aa("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),yr=Aa(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),On=Aa(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),Gi=Aa("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,0.0,1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),Sa=Aa("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),Za=Aa("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,0,1);}"),ra=Aa(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),Da=Aa(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),Do=Aa(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),Co=Aa(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),bi=Aa(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),Yu=Aa(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),lu=Aa(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),Yo=Aa(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),ll=Aa(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),bo=Aa(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),bs=Aa(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),Po=Aa(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),cu=Aa(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),Ms=Aa(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),0.0,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));}`),uc=Aa(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),Kc=Aa(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`);function Aa(n,s){var a=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,h=s.match(/attribute ([\w]+) ([\w]+)/g),g=n.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),b=s.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),T=b?b.concat(g):g,R={};return{fragmentSource:n=n.replace(a,function(V,te,de,ye,xe){return R[xe]=!0,te==="define"?`
#ifndef HAS_UNIFORM_u_`+xe+`
varying `+de+" "+ye+" "+xe+`;
#else
uniform `+de+" "+ye+" u_"+xe+`;
#endif
`:`
#ifdef HAS_UNIFORM_u_`+xe+`
    `+de+" "+ye+" "+xe+" = u_"+xe+`;
#endif
`}),vertexSource:s=s.replace(a,function(V,te,de,ye,xe){var He=ye==="float"?"vec2":"vec4",Ze=xe.match(/color/)?"color":He;return R[xe]?te==="define"?`
#ifndef HAS_UNIFORM_u_`+xe+`
uniform lowp float u_`+xe+`_t;
attribute `+de+" "+He+" a_"+xe+`;
varying `+de+" "+ye+" "+xe+`;
#else
uniform `+de+" "+ye+" u_"+xe+`;
#endif
`:Ze==="vec4"?`
#ifndef HAS_UNIFORM_u_`+xe+`
    `+xe+" = a_"+xe+`;
#else
    `+de+" "+ye+" "+xe+" = u_"+xe+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+xe+`
    `+xe+" = unpack_mix_"+Ze+"(a_"+xe+", u_"+xe+`_t);
#else
    `+de+" "+ye+" "+xe+" = u_"+xe+`;
#endif
`:te==="define"?`
#ifndef HAS_UNIFORM_u_`+xe+`
uniform lowp float u_`+xe+`_t;
attribute `+de+" "+He+" a_"+xe+`;
#else
uniform `+de+" "+ye+" u_"+xe+`;
#endif
`:Ze==="vec4"?`
#ifndef HAS_UNIFORM_u_`+xe+`
    `+de+" "+ye+" "+xe+" = a_"+xe+`;
#else
    `+de+" "+ye+" "+xe+" = u_"+xe+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+xe+`
    `+de+" "+ye+" "+xe+" = unpack_mix_"+Ze+"(a_"+xe+", u_"+xe+`_t);
#else
    `+de+" "+ye+" "+xe+" = u_"+xe+`;
#endif
`}),staticAttributes:h,staticUniforms:T}}var gf=Object.freeze({__proto__:null,prelude:Ws,background:Wl,backgroundPattern:uo,circle:je,clippingMask:Pt,heatmap:yr,heatmapTexture:On,collisionBox:Gi,collisionCircle:Sa,debug:Za,fill:ra,fillOutline:Da,fillOutlinePattern:Do,fillPattern:Co,fillExtrusion:bi,fillExtrusionPattern:Yu,hillshadePrepare:lu,hillshade:Yo,line:ll,lineGradient:bo,linePattern:bs,lineSDF:Po,raster:cu,symbolIcon:Ms,symbolSDF:uc,symbolTextAndIcon:Kc}),ku=function(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null};function Ml(n){for(var s=[],a=0;a<n.length;a++)if(n[a]!==null){var h=n[a].split(" ");s.push(h.pop())}return s}ku.prototype.bind=function(n,s,a,h,g,b,T,R){this.context=n;for(var V=this.boundPaintVertexBuffers.length!==h.length,te=0;!V&&te<h.length;te++)this.boundPaintVertexBuffers[te]!==h[te]&&(V=!0);n.extVertexArrayObject&&this.vao&&this.boundProgram===s&&this.boundLayoutVertexBuffer===a&&!V&&this.boundIndexBuffer===g&&this.boundVertexOffset===b&&this.boundDynamicVertexBuffer===T&&this.boundDynamicVertexBuffer2===R?(n.bindVertexArrayOES.set(this.vao),T&&T.bind(),g&&g.dynamicDraw&&g.bind(),R&&R.bind()):this.freshBind(s,a,h,g,b,T,R)},ku.prototype.freshBind=function(n,s,a,h,g,b,T){var R,V=n.numAttributes,te=this.context,de=te.gl;if(te.extVertexArrayObject)this.vao&&this.destroy(),this.vao=te.extVertexArrayObject.createVertexArrayOES(),te.bindVertexArrayOES.set(this.vao),R=0,this.boundProgram=n,this.boundLayoutVertexBuffer=s,this.boundPaintVertexBuffers=a,this.boundIndexBuffer=h,this.boundVertexOffset=g,this.boundDynamicVertexBuffer=b,this.boundDynamicVertexBuffer2=T;else{R=te.currentNumAttributes||0;for(var ye=V;ye<R;ye++)de.disableVertexAttribArray(ye)}s.enableAttributes(de,n);for(var xe=0,He=a;xe<He.length;xe+=1)He[xe].enableAttributes(de,n);b&&b.enableAttributes(de,n),T&&T.enableAttributes(de,n),s.bind(),s.setVertexAttribPointers(de,n,g);for(var Ze=0,nt=a;Ze<nt.length;Ze+=1){var ze=nt[Ze];ze.bind(),ze.setVertexAttribPointers(de,n,g)}b&&(b.bind(),b.setVertexAttribPointers(de,n,g)),h&&h.bind(),T&&(T.bind(),T.setVertexAttribPointers(de,n,g)),te.currentNumAttributes=V},ku.prototype.destroy=function(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)};var Ic=function(n,s,a,h,g,b){var T=n.gl;this.program=T.createProgram();for(var R=Ml(a.staticAttributes),V=h?h.getBinderAttributes():[],te=R.concat(V),de=a.staticUniforms?Ml(a.staticUniforms):[],ye=h?h.getBinderUniforms():[],xe=[],He=0,Ze=de.concat(ye);He<Ze.length;He+=1){var nt=Ze[He];xe.indexOf(nt)<0&&xe.push(nt)}var ze=h?h.defines():[];b&&ze.push("#define OVERDRAW_INSPECTOR;");var rt=ze.concat(Ws.fragmentSource,a.fragmentSource).join(`
`),ht=ze.concat(Ws.vertexSource,a.vertexSource).join(`
`),Nt=T.createShader(T.FRAGMENT_SHADER);if(T.isContextLost())this.failedToCreate=!0;else{T.shaderSource(Nt,rt),T.compileShader(Nt),T.attachShader(this.program,Nt);var or=T.createShader(T.VERTEX_SHADER);if(T.isContextLost())this.failedToCreate=!0;else{T.shaderSource(or,ht),T.compileShader(or),T.attachShader(this.program,or),this.attributes={};var rr={};this.numAttributes=te.length;for(var sr=0;sr<this.numAttributes;sr++)te[sr]&&(T.bindAttribLocation(this.program,sr,te[sr]),this.attributes[te[sr]]=sr);T.linkProgram(this.program),T.deleteShader(or),T.deleteShader(Nt);for(var Lr=0;Lr<xe.length;Lr++){var rn=xe[Lr];if(rn&&!rr[rn]){var Qr=T.getUniformLocation(this.program,rn);Qr&&(rr[rn]=Qr)}}this.fixedUniforms=g(n,rr),this.binderUniforms=h?h.getUniforms(n,rr):[]}}};function lc(n,s,a){var h=1/sa(a,1,s.transform.tileZoom),g=Math.pow(2,a.tileID.overscaledZ),b=a.tileSize*Math.pow(2,s.transform.tileZoom)/g,T=b*(a.tileID.canonical.x+a.tileID.wrap*g),R=b*a.tileID.canonical.y;return{u_image:0,u_texsize:a.imageAtlasTexture.size,u_scale:[h,n.fromScale,n.toScale],u_fade:n.t,u_pixel_coord_upper:[T>>16,R>>16],u_pixel_coord_lower:[65535&T,65535&R]}}Ic.prototype.draw=function(n,s,a,h,g,b,T,R,V,te,de,ye,xe,He,Ze,nt){var ze,rt=n.gl;if(!this.failedToCreate){for(var ht in n.program.set(this.program),n.setDepthMode(a),n.setStencilMode(h),n.setColorMode(g),n.setCullFace(b),this.fixedUniforms)this.fixedUniforms[ht].set(T[ht]);He&&He.setUniforms(n,this.binderUniforms,ye,{zoom:xe});for(var Nt=(ze={},ze[rt.LINES]=2,ze[rt.TRIANGLES]=3,ze[rt.LINE_STRIP]=1,ze)[s],or=0,rr=de.get();or<rr.length;or+=1){var sr=rr[or],Lr=sr.vaos||(sr.vaos={});(Lr[R]||(Lr[R]=new ku)).bind(n,this,V,He?He.getPaintVertexBuffers():[],te,sr.vertexOffset,Ze,nt),rt.drawElements(s,sr.primitiveLength*Nt,rt.UNSIGNED_SHORT,sr.primitiveOffset*Nt*2)}}};var eo=function(n,s,a,h){var g=s.style.light,b=g.properties.get("position"),T=[b.x,b.y,b.z],R=p.create$1();g.properties.get("anchor")==="viewport"&&p.fromRotation(R,-s.transform.angle),p.transformMat3(T,T,R);var V=g.properties.get("color");return{u_matrix:n,u_lightpos:T,u_lightintensity:g.properties.get("intensity"),u_lightcolor:[V.r,V.g,V.b],u_vertical_gradient:+a,u_opacity:h}},cl=function(n,s,a,h,g,b,T){return p.extend(eo(n,s,a,h),lc(b,s,T),{u_height_factor:-Math.pow(2,g.overscaledZ)/T.tileSize/8})},fl=function(n){return{u_matrix:n}},ns=function(n,s,a,h){return p.extend(fl(n),lc(a,s,h))},cc=function(n,s){return{u_matrix:n,u_world:s}},Ku=function(n,s,a,h,g){return p.extend(ns(n,s,a,h),{u_world:g})},Xs=function(n,s,a,h){var g,b,T=n.transform;if(h.paint.get("circle-pitch-alignment")==="map"){var R=sa(a,1,T.zoom);g=!0,b=[R,R]}else g=!1,b=T.pixelsToGLUnits;return{u_camera_to_center_distance:T.cameraToCenterDistance,u_scale_with_map:+(h.paint.get("circle-pitch-scale")==="map"),u_matrix:n.translatePosMatrix(s.posMatrix,a,h.paint.get("circle-translate"),h.paint.get("circle-translate-anchor")),u_pitch_with_map:+g,u_device_pixel_ratio:p.browser.devicePixelRatio,u_extrude_scale:b}},Ko=function(n,s,a){var h=sa(a,1,s.zoom),g=Math.pow(2,s.zoom-a.tileID.overscaledZ),b=a.tileID.overscaleFactor();return{u_matrix:n,u_camera_to_center_distance:s.cameraToCenterDistance,u_pixels_to_tile_units:h,u_extrude_scale:[s.pixelsToGLUnits[0]/(h*g),s.pixelsToGLUnits[1]/(h*g)],u_overscale_factor:b}},Oc=function(n,s,a){return{u_matrix:n,u_inv_matrix:s,u_camera_to_center_distance:a.cameraToCenterDistance,u_viewport_size:[a.width,a.height]}},bu=function(n,s,a){return a===void 0&&(a=1),{u_matrix:n,u_color:s,u_overlay:0,u_overlay_scale:a}},$u=function(n){return{u_matrix:n}},Of=function(n,s,a,h){return{u_matrix:n,u_extrude_scale:sa(s,1,a),u_intensity:h}},hl=function(n,s,a){var h=n.transform;return{u_matrix:Ys(n,s,a),u_ratio:1/sa(s,1,h.zoom),u_device_pixel_ratio:p.browser.devicePixelRatio,u_units_to_pixels:[1/h.pixelsToGLUnits[0],1/h.pixelsToGLUnits[1]]}},Ea=function(n,s,a,h){return p.extend(hl(n,s,a),{u_image:0,u_image_height:h})},Ju=function(n,s,a,h){var g=n.transform,b=Yl(s,g);return{u_matrix:Ys(n,s,a),u_texsize:s.imageAtlasTexture.size,u_ratio:1/sa(s,1,g.zoom),u_device_pixel_ratio:p.browser.devicePixelRatio,u_image:0,u_scale:[b,h.fromScale,h.toScale],u_fade:h.t,u_units_to_pixels:[1/g.pixelsToGLUnits[0],1/g.pixelsToGLUnits[1]]}},Xl=function(n,s,a,h,g){var b=n.lineAtlas,T=Yl(s,n.transform),R=a.layout.get("line-cap")==="round",V=b.getDash(h.from,R),te=b.getDash(h.to,R),de=V.width*g.fromScale,ye=te.width*g.toScale;return p.extend(hl(n,s,a),{u_patternscale_a:[T/de,-V.height/2],u_patternscale_b:[T/ye,-te.height/2],u_sdfgamma:b.width/(256*Math.min(de,ye)*p.browser.devicePixelRatio)/2,u_image:0,u_tex_y_a:V.y,u_tex_y_b:te.y,u_mix:g.t})};function Yl(n,s){return 1/sa(n,1,s.tileZoom)}function Ys(n,s,a){return n.translatePosMatrix(s.tileID.posMatrix,s,a.paint.get("line-translate"),a.paint.get("line-translate-anchor"))}var Lc=function(n,s,a,h,g){return{u_matrix:n,u_tl_parent:s,u_scale_parent:a,u_buffer_scale:1,u_fade_t:h.mix,u_opacity:h.opacity*g.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:g.paint.get("raster-brightness-min"),u_brightness_high:g.paint.get("raster-brightness-max"),u_saturation_factor:(T=g.paint.get("raster-saturation"),T>0?1-1/(1.001-T):-T),u_contrast_factor:(b=g.paint.get("raster-contrast"),b>0?1/(1-b):1+b),u_spin_weights:Kl(g.paint.get("raster-hue-rotate"))};var b,T};function Kl(n){n*=Math.PI/180;var s=Math.sin(n),a=Math.cos(n);return[(2*a+1)/3,(-Math.sqrt(3)*s-a+1)/3,(Math.sqrt(3)*s-a+1)/3]}var $l,Qu=function(n,s,a,h,g,b,T,R,V,te){var de=g.transform;return{u_is_size_zoom_constant:+(n==="constant"||n==="source"),u_is_size_feature_constant:+(n==="constant"||n==="camera"),u_size_t:s?s.uSizeT:0,u_size:s?s.uSize:0,u_camera_to_center_distance:de.cameraToCenterDistance,u_pitch:de.pitch/360*2*Math.PI,u_rotate_symbol:+a,u_aspect_ratio:de.width/de.height,u_fade_change:g.options.fadeDuration?g.symbolFadeChange:1,u_matrix:b,u_label_plane_matrix:T,u_coord_matrix:R,u_is_text:+V,u_pitch_with_map:+h,u_texsize:te,u_texture:0}},Su=function(n,s,a,h,g,b,T,R,V,te,de){var ye=g.transform;return p.extend(Qu(n,s,a,h,g,b,T,R,V,te),{u_gamma_scale:h?Math.cos(ye._pitch)*ye.cameraToCenterDistance:1,u_device_pixel_ratio:p.browser.devicePixelRatio,u_is_halo:+de})},Il=function(n,s,a,h,g,b,T,R,V,te){return p.extend(Su(n,s,a,h,g,b,T,R,!0,V,!0),{u_texsize_icon:te,u_texture_icon:1})},Ol=function(n,s,a){return{u_matrix:n,u_opacity:s,u_color:a}},pl=function(n,s,a,h,g,b){return p.extend(function(T,R,V,te){var de=V.imageManager.getPattern(T.from.toString()),ye=V.imageManager.getPattern(T.to.toString()),xe=V.imageManager.getPixelSize(),He=xe.width,Ze=xe.height,nt=Math.pow(2,te.tileID.overscaledZ),ze=te.tileSize*Math.pow(2,V.transform.tileZoom)/nt,rt=ze*(te.tileID.canonical.x+te.tileID.wrap*nt),ht=ze*te.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:de.tl,u_pattern_br_a:de.br,u_pattern_tl_b:ye.tl,u_pattern_br_b:ye.br,u_texsize:[He,Ze],u_mix:R.t,u_pattern_size_a:de.displaySize,u_pattern_size_b:ye.displaySize,u_scale_a:R.fromScale,u_scale_b:R.toScale,u_tile_units_to_pixels:1/sa(te,1,V.transform.tileZoom),u_pixel_coord_upper:[rt>>16,ht>>16],u_pixel_coord_lower:[65535&rt,65535&ht]}}(h,b,a,g),{u_matrix:n,u_opacity:s})},Rc={fillExtrusion:function(n,s){return{u_matrix:new p.UniformMatrix4f(n,s.u_matrix),u_lightpos:new p.Uniform3f(n,s.u_lightpos),u_lightintensity:new p.Uniform1f(n,s.u_lightintensity),u_lightcolor:new p.Uniform3f(n,s.u_lightcolor),u_vertical_gradient:new p.Uniform1f(n,s.u_vertical_gradient),u_opacity:new p.Uniform1f(n,s.u_opacity)}},fillExtrusionPattern:function(n,s){return{u_matrix:new p.UniformMatrix4f(n,s.u_matrix),u_lightpos:new p.Uniform3f(n,s.u_lightpos),u_lightintensity:new p.Uniform1f(n,s.u_lightintensity),u_lightcolor:new p.Uniform3f(n,s.u_lightcolor),u_vertical_gradient:new p.Uniform1f(n,s.u_vertical_gradient),u_height_factor:new p.Uniform1f(n,s.u_height_factor),u_image:new p.Uniform1i(n,s.u_image),u_texsize:new p.Uniform2f(n,s.u_texsize),u_pixel_coord_upper:new p.Uniform2f(n,s.u_pixel_coord_upper),u_pixel_coord_lower:new p.Uniform2f(n,s.u_pixel_coord_lower),u_scale:new p.Uniform3f(n,s.u_scale),u_fade:new p.Uniform1f(n,s.u_fade),u_opacity:new p.Uniform1f(n,s.u_opacity)}},fill:function(n,s){return{u_matrix:new p.UniformMatrix4f(n,s.u_matrix)}},fillPattern:function(n,s){return{u_matrix:new p.UniformMatrix4f(n,s.u_matrix),u_image:new p.Uniform1i(n,s.u_image),u_texsize:new p.Uniform2f(n,s.u_texsize),u_pixel_coord_upper:new p.Uniform2f(n,s.u_pixel_coord_upper),u_pixel_coord_lower:new p.Uniform2f(n,s.u_pixel_coord_lower),u_scale:new p.Uniform3f(n,s.u_scale),u_fade:new p.Uniform1f(n,s.u_fade)}},fillOutline:function(n,s){return{u_matrix:new p.UniformMatrix4f(n,s.u_matrix),u_world:new p.Uniform2f(n,s.u_world)}},fillOutlinePattern:function(n,s){return{u_matrix:new p.UniformMatrix4f(n,s.u_matrix),u_world:new p.Uniform2f(n,s.u_world),u_image:new p.Uniform1i(n,s.u_image),u_texsize:new p.Uniform2f(n,s.u_texsize),u_pixel_coord_upper:new p.Uniform2f(n,s.u_pixel_coord_upper),u_pixel_coord_lower:new p.Uniform2f(n,s.u_pixel_coord_lower),u_scale:new p.Uniform3f(n,s.u_scale),u_fade:new p.Uniform1f(n,s.u_fade)}},circle:function(n,s){return{u_camera_to_center_distance:new p.Uniform1f(n,s.u_camera_to_center_distance),u_scale_with_map:new p.Uniform1i(n,s.u_scale_with_map),u_pitch_with_map:new p.Uniform1i(n,s.u_pitch_with_map),u_extrude_scale:new p.Uniform2f(n,s.u_extrude_scale),u_device_pixel_ratio:new p.Uniform1f(n,s.u_device_pixel_ratio),u_matrix:new p.UniformMatrix4f(n,s.u_matrix)}},collisionBox:function(n,s){return{u_matrix:new p.UniformMatrix4f(n,s.u_matrix),u_camera_to_center_distance:new p.Uniform1f(n,s.u_camera_to_center_distance),u_pixels_to_tile_units:new p.Uniform1f(n,s.u_pixels_to_tile_units),u_extrude_scale:new p.Uniform2f(n,s.u_extrude_scale),u_overscale_factor:new p.Uniform1f(n,s.u_overscale_factor)}},collisionCircle:function(n,s){return{u_matrix:new p.UniformMatrix4f(n,s.u_matrix),u_inv_matrix:new p.UniformMatrix4f(n,s.u_inv_matrix),u_camera_to_center_distance:new p.Uniform1f(n,s.u_camera_to_center_distance),u_viewport_size:new p.Uniform2f(n,s.u_viewport_size)}},debug:function(n,s){return{u_color:new p.UniformColor(n,s.u_color),u_matrix:new p.UniformMatrix4f(n,s.u_matrix),u_overlay:new p.Uniform1i(n,s.u_overlay),u_overlay_scale:new p.Uniform1f(n,s.u_overlay_scale)}},clippingMask:function(n,s){return{u_matrix:new p.UniformMatrix4f(n,s.u_matrix)}},heatmap:function(n,s){return{u_extrude_scale:new p.Uniform1f(n,s.u_extrude_scale),u_intensity:new p.Uniform1f(n,s.u_intensity),u_matrix:new p.UniformMatrix4f(n,s.u_matrix)}},heatmapTexture:function(n,s){return{u_matrix:new p.UniformMatrix4f(n,s.u_matrix),u_world:new p.Uniform2f(n,s.u_world),u_image:new p.Uniform1i(n,s.u_image),u_color_ramp:new p.Uniform1i(n,s.u_color_ramp),u_opacity:new p.Uniform1f(n,s.u_opacity)}},hillshade:function(n,s){return{u_matrix:new p.UniformMatrix4f(n,s.u_matrix),u_image:new p.Uniform1i(n,s.u_image),u_latrange:new p.Uniform2f(n,s.u_latrange),u_light:new p.Uniform2f(n,s.u_light),u_shadow:new p.UniformColor(n,s.u_shadow),u_highlight:new p.UniformColor(n,s.u_highlight),u_accent:new p.UniformColor(n,s.u_accent)}},hillshadePrepare:function(n,s){return{u_matrix:new p.UniformMatrix4f(n,s.u_matrix),u_image:new p.Uniform1i(n,s.u_image),u_dimension:new p.Uniform2f(n,s.u_dimension),u_zoom:new p.Uniform1f(n,s.u_zoom),u_unpack:new p.Uniform4f(n,s.u_unpack)}},line:function(n,s){return{u_matrix:new p.UniformMatrix4f(n,s.u_matrix),u_ratio:new p.Uniform1f(n,s.u_ratio),u_device_pixel_ratio:new p.Uniform1f(n,s.u_device_pixel_ratio),u_units_to_pixels:new p.Uniform2f(n,s.u_units_to_pixels)}},lineGradient:function(n,s){return{u_matrix:new p.UniformMatrix4f(n,s.u_matrix),u_ratio:new p.Uniform1f(n,s.u_ratio),u_device_pixel_ratio:new p.Uniform1f(n,s.u_device_pixel_ratio),u_units_to_pixels:new p.Uniform2f(n,s.u_units_to_pixels),u_image:new p.Uniform1i(n,s.u_image),u_image_height:new p.Uniform1f(n,s.u_image_height)}},linePattern:function(n,s){return{u_matrix:new p.UniformMatrix4f(n,s.u_matrix),u_texsize:new p.Uniform2f(n,s.u_texsize),u_ratio:new p.Uniform1f(n,s.u_ratio),u_device_pixel_ratio:new p.Uniform1f(n,s.u_device_pixel_ratio),u_image:new p.Uniform1i(n,s.u_image),u_units_to_pixels:new p.Uniform2f(n,s.u_units_to_pixels),u_scale:new p.Uniform3f(n,s.u_scale),u_fade:new p.Uniform1f(n,s.u_fade)}},lineSDF:function(n,s){return{u_matrix:new p.UniformMatrix4f(n,s.u_matrix),u_ratio:new p.Uniform1f(n,s.u_ratio),u_device_pixel_ratio:new p.Uniform1f(n,s.u_device_pixel_ratio),u_units_to_pixels:new p.Uniform2f(n,s.u_units_to_pixels),u_patternscale_a:new p.Uniform2f(n,s.u_patternscale_a),u_patternscale_b:new p.Uniform2f(n,s.u_patternscale_b),u_sdfgamma:new p.Uniform1f(n,s.u_sdfgamma),u_image:new p.Uniform1i(n,s.u_image),u_tex_y_a:new p.Uniform1f(n,s.u_tex_y_a),u_tex_y_b:new p.Uniform1f(n,s.u_tex_y_b),u_mix:new p.Uniform1f(n,s.u_mix)}},raster:function(n,s){return{u_matrix:new p.UniformMatrix4f(n,s.u_matrix),u_tl_parent:new p.Uniform2f(n,s.u_tl_parent),u_scale_parent:new p.Uniform1f(n,s.u_scale_parent),u_buffer_scale:new p.Uniform1f(n,s.u_buffer_scale),u_fade_t:new p.Uniform1f(n,s.u_fade_t),u_opacity:new p.Uniform1f(n,s.u_opacity),u_image0:new p.Uniform1i(n,s.u_image0),u_image1:new p.Uniform1i(n,s.u_image1),u_brightness_low:new p.Uniform1f(n,s.u_brightness_low),u_brightness_high:new p.Uniform1f(n,s.u_brightness_high),u_saturation_factor:new p.Uniform1f(n,s.u_saturation_factor),u_contrast_factor:new p.Uniform1f(n,s.u_contrast_factor),u_spin_weights:new p.Uniform3f(n,s.u_spin_weights)}},symbolIcon:function(n,s){return{u_is_size_zoom_constant:new p.Uniform1i(n,s.u_is_size_zoom_constant),u_is_size_feature_constant:new p.Uniform1i(n,s.u_is_size_feature_constant),u_size_t:new p.Uniform1f(n,s.u_size_t),u_size:new p.Uniform1f(n,s.u_size),u_camera_to_center_distance:new p.Uniform1f(n,s.u_camera_to_center_distance),u_pitch:new p.Uniform1f(n,s.u_pitch),u_rotate_symbol:new p.Uniform1i(n,s.u_rotate_symbol),u_aspect_ratio:new p.Uniform1f(n,s.u_aspect_ratio),u_fade_change:new p.Uniform1f(n,s.u_fade_change),u_matrix:new p.UniformMatrix4f(n,s.u_matrix),u_label_plane_matrix:new p.UniformMatrix4f(n,s.u_label_plane_matrix),u_coord_matrix:new p.UniformMatrix4f(n,s.u_coord_matrix),u_is_text:new p.Uniform1i(n,s.u_is_text),u_pitch_with_map:new p.Uniform1i(n,s.u_pitch_with_map),u_texsize:new p.Uniform2f(n,s.u_texsize),u_texture:new p.Uniform1i(n,s.u_texture)}},symbolSDF:function(n,s){return{u_is_size_zoom_constant:new p.Uniform1i(n,s.u_is_size_zoom_constant),u_is_size_feature_constant:new p.Uniform1i(n,s.u_is_size_feature_constant),u_size_t:new p.Uniform1f(n,s.u_size_t),u_size:new p.Uniform1f(n,s.u_size),u_camera_to_center_distance:new p.Uniform1f(n,s.u_camera_to_center_distance),u_pitch:new p.Uniform1f(n,s.u_pitch),u_rotate_symbol:new p.Uniform1i(n,s.u_rotate_symbol),u_aspect_ratio:new p.Uniform1f(n,s.u_aspect_ratio),u_fade_change:new p.Uniform1f(n,s.u_fade_change),u_matrix:new p.UniformMatrix4f(n,s.u_matrix),u_label_plane_matrix:new p.UniformMatrix4f(n,s.u_label_plane_matrix),u_coord_matrix:new p.UniformMatrix4f(n,s.u_coord_matrix),u_is_text:new p.Uniform1i(n,s.u_is_text),u_pitch_with_map:new p.Uniform1i(n,s.u_pitch_with_map),u_texsize:new p.Uniform2f(n,s.u_texsize),u_texture:new p.Uniform1i(n,s.u_texture),u_gamma_scale:new p.Uniform1f(n,s.u_gamma_scale),u_device_pixel_ratio:new p.Uniform1f(n,s.u_device_pixel_ratio),u_is_halo:new p.Uniform1i(n,s.u_is_halo)}},symbolTextAndIcon:function(n,s){return{u_is_size_zoom_constant:new p.Uniform1i(n,s.u_is_size_zoom_constant),u_is_size_feature_constant:new p.Uniform1i(n,s.u_is_size_feature_constant),u_size_t:new p.Uniform1f(n,s.u_size_t),u_size:new p.Uniform1f(n,s.u_size),u_camera_to_center_distance:new p.Uniform1f(n,s.u_camera_to_center_distance),u_pitch:new p.Uniform1f(n,s.u_pitch),u_rotate_symbol:new p.Uniform1i(n,s.u_rotate_symbol),u_aspect_ratio:new p.Uniform1f(n,s.u_aspect_ratio),u_fade_change:new p.Uniform1f(n,s.u_fade_change),u_matrix:new p.UniformMatrix4f(n,s.u_matrix),u_label_plane_matrix:new p.UniformMatrix4f(n,s.u_label_plane_matrix),u_coord_matrix:new p.UniformMatrix4f(n,s.u_coord_matrix),u_is_text:new p.Uniform1i(n,s.u_is_text),u_pitch_with_map:new p.Uniform1i(n,s.u_pitch_with_map),u_texsize:new p.Uniform2f(n,s.u_texsize),u_texsize_icon:new p.Uniform2f(n,s.u_texsize_icon),u_texture:new p.Uniform1i(n,s.u_texture),u_texture_icon:new p.Uniform1i(n,s.u_texture_icon),u_gamma_scale:new p.Uniform1f(n,s.u_gamma_scale),u_device_pixel_ratio:new p.Uniform1f(n,s.u_device_pixel_ratio),u_is_halo:new p.Uniform1i(n,s.u_is_halo)}},background:function(n,s){return{u_matrix:new p.UniformMatrix4f(n,s.u_matrix),u_opacity:new p.Uniform1f(n,s.u_opacity),u_color:new p.UniformColor(n,s.u_color)}},backgroundPattern:function(n,s){return{u_matrix:new p.UniformMatrix4f(n,s.u_matrix),u_opacity:new p.Uniform1f(n,s.u_opacity),u_image:new p.Uniform1i(n,s.u_image),u_pattern_tl_a:new p.Uniform2f(n,s.u_pattern_tl_a),u_pattern_br_a:new p.Uniform2f(n,s.u_pattern_br_a),u_pattern_tl_b:new p.Uniform2f(n,s.u_pattern_tl_b),u_pattern_br_b:new p.Uniform2f(n,s.u_pattern_br_b),u_texsize:new p.Uniform2f(n,s.u_texsize),u_mix:new p.Uniform1f(n,s.u_mix),u_pattern_size_a:new p.Uniform2f(n,s.u_pattern_size_a),u_pattern_size_b:new p.Uniform2f(n,s.u_pattern_size_b),u_scale_a:new p.Uniform1f(n,s.u_scale_a),u_scale_b:new p.Uniform1f(n,s.u_scale_b),u_pixel_coord_upper:new p.Uniform2f(n,s.u_pixel_coord_upper),u_pixel_coord_lower:new p.Uniform2f(n,s.u_pixel_coord_lower),u_tile_units_to_pixels:new p.Uniform1f(n,s.u_tile_units_to_pixels)}}};function dl(n,s,a,h,g,b,T){for(var R=n.context,V=R.gl,te=n.useProgram("collisionBox"),de=[],ye=0,xe=0,He=0;He<h.length;He++){var Ze=h[He],nt=s.getTile(Ze),ze=nt.getBucket(a);if(ze){var rt=Ze.posMatrix;g[0]===0&&g[1]===0||(rt=n.translatePosMatrix(Ze.posMatrix,nt,g,b));var ht=T?ze.textCollisionBox:ze.iconCollisionBox,Nt=ze.collisionCircleArray;if(Nt.length>0){var or=p.create(),rr=rt;p.mul(or,ze.placementInvProjMatrix,n.transform.glCoordMatrix),p.mul(or,or,ze.placementViewportMatrix),de.push({circleArray:Nt,circleOffset:xe,transform:rr,invTransform:or}),xe=ye+=Nt.length/4}ht&&te.draw(R,V.LINES,$.disabled,ie.disabled,n.colorModeForRenderPass(),Ge.disabled,Ko(rt,n.transform,nt),a.id,ht.layoutVertexBuffer,ht.indexBuffer,ht.segments,null,n.transform.zoom,null,null,ht.collisionVertexBuffer)}}if(T&&de.length){var sr=n.useProgram("collisionCircle"),Lr=new p.StructArrayLayout2f1f2i16;Lr.resize(4*ye),Lr._trim();for(var rn=0,Qr=0,xn=de;Qr<xn.length;Qr+=1)for(var jn=xn[Qr],Xn=0;Xn<jn.circleArray.length/4;Xn++){var Wn=4*Xn,$i=jn.circleArray[Wn+0],Sn=jn.circleArray[Wn+1],oi=jn.circleArray[Wn+2],Si=jn.circleArray[Wn+3];Lr.emplace(rn++,$i,Sn,oi,Si,0),Lr.emplace(rn++,$i,Sn,oi,Si,1),Lr.emplace(rn++,$i,Sn,oi,Si,2),Lr.emplace(rn++,$i,Sn,oi,Si,3)}(!$l||$l.length<2*ye)&&($l=function(Ja){var os=2*Ja,Fo=new p.StructArrayLayout3ui6;Fo.resize(os),Fo._trim();for(var Qa=0;Qa<os;Qa++){var ro=6*Qa;Fo.uint16[ro+0]=4*Qa+0,Fo.uint16[ro+1]=4*Qa+1,Fo.uint16[ro+2]=4*Qa+2,Fo.uint16[ro+3]=4*Qa+2,Fo.uint16[ro+4]=4*Qa+3,Fo.uint16[ro+5]=4*Qa+0}return Fo}(ye));for(var ai=R.createIndexBuffer($l,!0),ii=R.createVertexBuffer(Lr,p.collisionCircleLayout.members,!0),Ei=0,ri=de;Ei<ri.length;Ei+=1){var Qn=ri[Ei],mo=Oc(Qn.transform,Qn.invTransform,n.transform);sr.draw(R,V.TRIANGLES,$.disabled,ie.disabled,n.colorModeForRenderPass(),Ge.disabled,mo,a.id,ii,ai,p.SegmentVector.simpleSegment(0,2*Qn.circleOffset,Qn.circleArray.length,Qn.circleArray.length/2),null,n.transform.zoom,null,null,null)}ii.destroy(),ai.destroy()}}var Ks=p.identity(new Float32Array(16));function Ll(n,s,a,h,g,b){var T=p.getAnchorAlignment(n),R=-(T.horizontalAlign-.5)*s,V=-(T.verticalAlign-.5)*a,te=p.evaluateVariableOffset(n,h);return new p.Point((R/g+te[0])*b,(V/g+te[1])*b)}function $c(n,s,a,h,g,b,T,R,V,te,de){var ye=n.text.placedSymbolArray,xe=n.text.dynamicLayoutVertexArray,He=n.icon.dynamicLayoutVertexArray,Ze={};xe.clear();for(var nt=0;nt<ye.length;nt++){var ze=ye.get(nt),rt=ze.hidden||!ze.crossTileID||n.allowVerticalPlacement&&!ze.placedOrientation?null:h[ze.crossTileID];if(rt){var ht=new p.Point(ze.anchorX,ze.anchorY),Nt=li(ht,a?R:T),or=Vn(b.cameraToCenterDistance,Nt.signedDistanceFromCamera),rr=g.evaluateSizeForFeature(n.textSizeData,te,ze)*or/p.ONE_EM;a&&(rr*=n.tilePixelRatio/V);for(var sr=Ll(rt.anchor,rt.width,rt.height,rt.textOffset,rt.textBoxScale,rr),Lr=a?li(ht.add(sr),T).point:Nt.point.add(s?sr.rotate(-b.angle):sr),rn=n.allowVerticalPlacement&&ze.placedOrientation===p.WritingMode.vertical?Math.PI/2:0,Qr=0;Qr<ze.numGlyphs;Qr++)p.addDynamicAttributes(xe,Lr,rn);de&&ze.associatedIconIndex>=0&&(Ze[ze.associatedIconIndex]={shiftedAnchor:Lr,angle:rn})}else Wa(ze.numGlyphs,xe)}if(de){He.clear();for(var xn=n.icon.placedSymbolArray,jn=0;jn<xn.length;jn++){var Xn=xn.get(jn);if(Xn.hidden)Wa(Xn.numGlyphs,He);else{var Wn=Ze[jn];if(Wn)for(var $i=0;$i<Xn.numGlyphs;$i++)p.addDynamicAttributes(He,Wn.shiftedAnchor,Wn.angle);else Wa(Xn.numGlyphs,He)}}n.icon.dynamicLayoutVertexBuffer.updateData(He)}n.text.dynamicLayoutVertexBuffer.updateData(xe)}function Jc(n,s,a){return a.iconsInText&&s?"symbolTextAndIcon":n?"symbolSDF":"symbolIcon"}function ma(n,s,a,h,g,b,T,R,V,te,de,ye){for(var xe=n.context,He=xe.gl,Ze=n.transform,nt=R==="map",ze=V==="map",rt=nt&&a.layout.get("symbol-placement")!=="point",ht=nt&&!ze&&!rt,Nt=a.layout.get("symbol-sort-key").constantOr(1)!==void 0,or=!1,rr=n.depthModeForSublayer(0,$.ReadOnly),sr=a.layout.get("text-variable-anchor"),Lr=[],rn=0,Qr=h;rn<Qr.length;rn+=1){var xn=Qr[rn],jn=s.getTile(xn),Xn=jn.getBucket(a);if(Xn){var Wn=g?Xn.text:Xn.icon;if(Wn&&Wn.segments.get().length){var $i=Wn.programConfigurations.get(a.id),Sn=g||Xn.sdfIcons,oi=g?Xn.textSizeData:Xn.iconSizeData,Si=ze||Ze.pitch!==0,ai=n.useProgram(Jc(Sn,g,Xn),$i),ii=p.evaluateSizeForZoom(oi,Ze.zoom),Ei=void 0,ri=[0,0],Qn=void 0,mo=void 0,Ja=null,os=void 0;if(g)Qn=jn.glyphAtlasTexture,mo=He.LINEAR,Ei=jn.glyphAtlasTexture.size,Xn.iconsInText&&(ri=jn.imageAtlasTexture.size,Ja=jn.imageAtlasTexture,os=Si||n.options.rotating||n.options.zooming||oi.kind==="composite"||oi.kind==="camera"?He.LINEAR:He.NEAREST);else{var Fo=a.layout.get("icon-size").constantOr(0)!==1||Xn.iconsNeedLinear;Qn=jn.imageAtlasTexture,mo=Sn||n.options.rotating||n.options.zooming||Fo||Si?He.LINEAR:He.NEAREST,Ei=jn.imageAtlasTexture.size}var Qa=sa(jn,1,n.transform.zoom),ro=Rn(xn.posMatrix,ze,nt,n.transform,Qa),ms=Dn(xn.posMatrix,ze,nt,n.transform,Qa),zo=sr&&Xn.hasTextData(),Cu=a.layout.get("icon-text-fit")!=="none"&&zo&&Xn.hasIconData();rt&&ps(Xn,xn.posMatrix,n,g,ro,ms,ze,te);var ss=n.translatePosMatrix(xn.posMatrix,jn,b,T),Zs=rt||g&&sr||Cu?Ks:ro,Vs=n.translatePosMatrix(ms,jn,b,T,!0),Sl=Sn&&a.paint.get(g?"text-halo-width":"icon-halo-width").constantOr(1)!==0,El={program:ai,buffers:Wn,uniformValues:Sn?Xn.iconsInText?Il(oi.kind,ii,ht,ze,n,ss,Zs,Vs,Ei,ri):Su(oi.kind,ii,ht,ze,n,ss,Zs,Vs,g,Ei,!0):Qu(oi.kind,ii,ht,ze,n,ss,Zs,Vs,g,Ei),atlasTexture:Qn,atlasTextureIcon:Ja,atlasInterpolation:mo,atlasInterpolationIcon:os,isSDF:Sn,hasHalo:Sl};if(Nt&&Xn.canOverlap){or=!0;for(var Ls=0,Vu=Wn.segments.get();Ls<Vu.length;Ls+=1){var jl=Vu[Ls];Lr.push({segments:new p.SegmentVector([jl]),sortKey:jl.sortKey,state:El})}}else Lr.push({segments:Wn.segments,sortKey:0,state:El})}}}or&&Lr.sort(function(vu,ws){return vu.sortKey-ws.sortKey});for(var du=0,wl=Lr;du<wl.length;du+=1){var tu=wl[du],no=tu.state;if(xe.activeTexture.set(He.TEXTURE0),no.atlasTexture.bind(no.atlasInterpolation,He.CLAMP_TO_EDGE),no.atlasTextureIcon&&(xe.activeTexture.set(He.TEXTURE1),no.atlasTextureIcon&&no.atlasTextureIcon.bind(no.atlasInterpolationIcon,He.CLAMP_TO_EDGE)),no.isSDF){var Pu=no.uniformValues;no.hasHalo&&(Pu.u_is_halo=1,Jl(no.buffers,tu.segments,a,n,no.program,rr,de,ye,Pu)),Pu.u_is_halo=0}Jl(no.buffers,tu.segments,a,n,no.program,rr,de,ye,no.uniformValues)}}function Jl(n,s,a,h,g,b,T,R,V){var te=h.context;g.draw(te,te.gl.TRIANGLES,b,T,R,Ge.disabled,V,a.id,n.layoutVertexBuffer,n.indexBuffer,s,a.paint,h.transform.zoom,n.programConfigurations.get(a.id),n.dynamicLayoutVertexBuffer,n.opacityVertexBuffer)}function fc(n,s,a,h,g,b,T){var R,V,te,de,ye,xe=n.context.gl,He=a.paint.get("fill-pattern"),Ze=He&&He.constantOr(1),nt=a.getCrossfadeParameters();T?(V=Ze&&!a.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",R=xe.LINES):(V=Ze?"fillPattern":"fill",R=xe.TRIANGLES);for(var ze=0,rt=h;ze<rt.length;ze+=1){var ht=rt[ze],Nt=s.getTile(ht);if(!Ze||Nt.patternsLoaded()){var or=Nt.getBucket(a);if(or){var rr=or.programConfigurations.get(a.id),sr=n.useProgram(V,rr);Ze&&(n.context.activeTexture.set(xe.TEXTURE0),Nt.imageAtlasTexture.bind(xe.LINEAR,xe.CLAMP_TO_EDGE),rr.updatePaintBuffers(nt));var Lr=He.constantOr(null);if(Lr&&Nt.imageAtlas){var rn=Nt.imageAtlas,Qr=rn.patternPositions[Lr.to.toString()],xn=rn.patternPositions[Lr.from.toString()];Qr&&xn&&rr.setConstantPatternPositions(Qr,xn)}var jn=n.translatePosMatrix(ht.posMatrix,Nt,a.paint.get("fill-translate"),a.paint.get("fill-translate-anchor"));if(T){de=or.indexBuffer2,ye=or.segments2;var Xn=[xe.drawingBufferWidth,xe.drawingBufferHeight];te=V==="fillOutlinePattern"&&Ze?Ku(jn,n,nt,Nt,Xn):cc(jn,Xn)}else de=or.indexBuffer,ye=or.segments,te=Ze?ns(jn,n,nt,Nt):fl(jn);sr.draw(n.context,R,g,n.stencilModeForClipping(ht),b,Ge.disabled,te,a.id,or.layoutVertexBuffer,de,ye,a.paint,n.transform.zoom,rr)}}}}function qu(n,s,a,h,g,b,T){for(var R=n.context,V=R.gl,te=a.paint.get("fill-extrusion-pattern"),de=te.constantOr(1),ye=a.getCrossfadeParameters(),xe=a.paint.get("fill-extrusion-opacity"),He=0,Ze=h;He<Ze.length;He+=1){var nt=Ze[He],ze=s.getTile(nt),rt=ze.getBucket(a);if(rt){var ht=rt.programConfigurations.get(a.id),Nt=n.useProgram(de?"fillExtrusionPattern":"fillExtrusion",ht);de&&(n.context.activeTexture.set(V.TEXTURE0),ze.imageAtlasTexture.bind(V.LINEAR,V.CLAMP_TO_EDGE),ht.updatePaintBuffers(ye));var or=te.constantOr(null);if(or&&ze.imageAtlas){var rr=ze.imageAtlas,sr=rr.patternPositions[or.to.toString()],Lr=rr.patternPositions[or.from.toString()];sr&&Lr&&ht.setConstantPatternPositions(sr,Lr)}var rn=n.translatePosMatrix(nt.posMatrix,ze,a.paint.get("fill-extrusion-translate"),a.paint.get("fill-extrusion-translate-anchor")),Qr=a.paint.get("fill-extrusion-vertical-gradient"),xn=de?cl(rn,n,Qr,xe,nt,ye,ze):eo(rn,n,Qr,xe);Nt.draw(R,R.gl.TRIANGLES,g,b,T,Ge.backCCW,xn,a.id,rt.layoutVertexBuffer,rt.indexBuffer,rt.segments,a.paint,n.transform.zoom,ht)}}}function Rl(n,s,a,h,g,b){var T=n.context,R=T.gl,V=s.fbo;if(V){var te=n.useProgram("hillshade");T.activeTexture.set(R.TEXTURE0),R.bindTexture(R.TEXTURE_2D,V.colorAttachment.get());var de=function(ye,xe,He){var Ze=He.paint.get("hillshade-shadow-color"),nt=He.paint.get("hillshade-highlight-color"),ze=He.paint.get("hillshade-accent-color"),rt=He.paint.get("hillshade-illumination-direction")*(Math.PI/180);He.paint.get("hillshade-illumination-anchor")==="viewport"&&(rt-=ye.transform.angle);var ht,Nt,or,rr=!ye.options.moving;return{u_matrix:ye.transform.calculatePosMatrix(xe.tileID.toUnwrapped(),rr),u_image:0,u_latrange:(ht=xe.tileID,Nt=Math.pow(2,ht.canonical.z),or=ht.canonical.y,[new p.MercatorCoordinate(0,or/Nt).toLngLat().lat,new p.MercatorCoordinate(0,(or+1)/Nt).toLngLat().lat]),u_light:[He.paint.get("hillshade-exaggeration"),rt],u_shadow:Ze,u_highlight:nt,u_accent:ze}}(n,s,a);te.draw(T,R.TRIANGLES,h,g,b,Ge.disabled,de,a.id,n.rasterBoundsBuffer,n.quadTriangleIndexBuffer,n.rasterBoundsSegments)}}function hc(n,s,a,h,g,b){var T=n.context,R=T.gl,V=s.dem;if(V&&V.data){var te=V.dim,de=V.stride,ye=V.getPixels();if(T.activeTexture.set(R.TEXTURE1),T.pixelStoreUnpackPremultiplyAlpha.set(!1),s.demTexture=s.demTexture||n.getTileTexture(de),s.demTexture){var xe=s.demTexture;xe.update(ye,{premultiply:!1}),xe.bind(R.NEAREST,R.CLAMP_TO_EDGE)}else s.demTexture=new p.Texture(T,ye,R.RGBA,{premultiply:!1}),s.demTexture.bind(R.NEAREST,R.CLAMP_TO_EDGE);T.activeTexture.set(R.TEXTURE0);var He=s.fbo;if(!He){var Ze=new p.Texture(T,{width:te,height:te,data:null},R.RGBA);Ze.bind(R.LINEAR,R.CLAMP_TO_EDGE),(He=s.fbo=T.createFramebuffer(te,te,!0)).colorAttachment.set(Ze.texture)}T.bindFramebuffer.set(He.framebuffer),T.viewport.set([0,0,te,te]),n.useProgram("hillshadePrepare").draw(T,R.TRIANGLES,h,g,b,Ge.disabled,function(nt,ze){var rt=ze.stride,ht=p.create();return p.ortho(ht,0,p.EXTENT,-p.EXTENT,0,0,1),p.translate(ht,ht,[0,-p.EXTENT,0]),{u_matrix:ht,u_image:1,u_dimension:[rt,rt],u_zoom:nt.overscaledZ,u_unpack:ze.getUnpackVector()}}(s.tileID,V),a.id,n.rasterBoundsBuffer,n.quadTriangleIndexBuffer,n.rasterBoundsSegments),s.needsHillshadePrepare=!1}}function Fu(n,s,a,h,g){var b=h.paint.get("raster-fade-duration");if(b>0){var T=p.browser.now(),R=(T-n.timeAdded)/b,V=s?(T-s.timeAdded)/b:-1,te=a.getSource(),de=g.coveringZoomLevel({tileSize:te.tileSize,roundZoom:te.roundZoom}),ye=!s||Math.abs(s.tileID.overscaledZ-de)>Math.abs(n.tileID.overscaledZ-de),xe=ye&&n.refreshedUponExpiration?1:p.clamp(ye?R:1-V,0,1);return n.refreshedUponExpiration&&R>=1&&(n.refreshedUponExpiration=!1),s?{opacity:1,mix:1-xe}:{opacity:xe,mix:0}}return{opacity:1,mix:0}}var Dc=new p.Color(1,0,0,1),Qc=new p.Color(0,1,0,1),qc=new p.Color(0,0,1,1),Dl=new p.Color(1,0,1,1),kc=new p.Color(0,1,1,1);function Fc(n,s,a,h){vl(n,0,s+a/2,n.transform.width,a,h)}function zc(n,s,a,h){vl(n,s-a/2,0,a,n.transform.height,h)}function vl(n,s,a,h,g,b){var T=n.context,R=T.gl;R.enable(R.SCISSOR_TEST),R.scissor(s*p.browser.devicePixelRatio,a*p.browser.devicePixelRatio,h*p.browser.devicePixelRatio,g*p.browser.devicePixelRatio),T.clear({color:b}),R.disable(R.SCISSOR_TEST)}function Nc(n,s,a){var h=n.context,g=h.gl,b=a.posMatrix,T=n.useProgram("debug"),R=$.disabled,V=ie.disabled,te=n.colorModeForRenderPass();h.activeTexture.set(g.TEXTURE0),n.emptyTexture.bind(g.LINEAR,g.CLAMP_TO_EDGE),T.draw(h,g.LINE_STRIP,R,V,te,Ge.disabled,bu(b,p.Color.red),"$debug",n.debugBuffer,n.tileBorderIndexBuffer,n.debugSegments);var de=s.getTileByID(a.key).latestRawTileData,ye=Math.floor((de&&de.byteLength||0)/1024),xe=s.getTile(a).tileSize,He=512/Math.min(xe,512)*(a.overscaledZ/n.transform.zoom)*.5,Ze=a.canonical.toString();a.overscaledZ!==a.canonical.z&&(Ze+=" => "+a.overscaledZ),function(nt,ze){nt.initDebugOverlayCanvas();var rt=nt.debugOverlayCanvas,ht=nt.context.gl,Nt=nt.debugOverlayCanvas.getContext("2d");Nt.clearRect(0,0,rt.width,rt.height),Nt.shadowColor="white",Nt.shadowBlur=2,Nt.lineWidth=1.5,Nt.strokeStyle="white",Nt.textBaseline="top",Nt.font="bold 36px Open Sans, sans-serif",Nt.fillText(ze,5,5),Nt.strokeText(ze,5,5),nt.debugOverlayTexture.update(rt),nt.debugOverlayTexture.bind(ht.LINEAR,ht.CLAMP_TO_EDGE)}(n,Ze+" "+ye+"kb"),T.draw(h,g.TRIANGLES,R,V,Le.alphaBlended,Ge.disabled,bu(b,p.Color.transparent,He),"$debug",n.debugBuffer,n.quadTriangleIndexBuffer,n.debugSegments)}var zu={symbol:function(n,s,a,h,g){if(n.renderPass==="translucent"){var b=ie.disabled,T=n.colorModeForRenderPass();a.layout.get("text-variable-anchor")&&function(R,V,te,de,ye,xe,He){for(var Ze=V.transform,nt=ye==="map",ze=xe==="map",rt=0,ht=R;rt<ht.length;rt+=1){var Nt=ht[rt],or=de.getTile(Nt),rr=or.getBucket(te);if(rr&&rr.text&&rr.text.segments.get().length){var sr=p.evaluateSizeForZoom(rr.textSizeData,Ze.zoom),Lr=sa(or,1,V.transform.zoom),rn=Rn(Nt.posMatrix,ze,nt,V.transform,Lr),Qr=te.layout.get("icon-text-fit")!=="none"&&rr.hasIconData();if(sr){var xn=Math.pow(2,Ze.zoom-or.tileID.overscaledZ);$c(rr,nt,ze,He,p.symbolSize,Ze,rn,Nt.posMatrix,xn,sr,Qr)}}}}(h,n,a,s,a.layout.get("text-rotation-alignment"),a.layout.get("text-pitch-alignment"),g),a.paint.get("icon-opacity").constantOr(1)!==0&&ma(n,s,a,h,!1,a.paint.get("icon-translate"),a.paint.get("icon-translate-anchor"),a.layout.get("icon-rotation-alignment"),a.layout.get("icon-pitch-alignment"),a.layout.get("icon-keep-upright"),b,T),a.paint.get("text-opacity").constantOr(1)!==0&&ma(n,s,a,h,!0,a.paint.get("text-translate"),a.paint.get("text-translate-anchor"),a.layout.get("text-rotation-alignment"),a.layout.get("text-pitch-alignment"),a.layout.get("text-keep-upright"),b,T),s.map.showCollisionBoxes&&(dl(n,s,a,h,a.paint.get("text-translate"),a.paint.get("text-translate-anchor"),!0),dl(n,s,a,h,a.paint.get("icon-translate"),a.paint.get("icon-translate-anchor"),!1))}},circle:function(n,s,a,h){if(n.renderPass==="translucent"){var g=a.paint.get("circle-opacity"),b=a.paint.get("circle-stroke-width"),T=a.paint.get("circle-stroke-opacity"),R=a.layout.get("circle-sort-key").constantOr(1)!==void 0;if(g.constantOr(1)!==0||b.constantOr(1)!==0&&T.constantOr(1)!==0){for(var V=n.context,te=V.gl,de=n.depthModeForSublayer(0,$.ReadOnly),ye=ie.disabled,xe=n.colorModeForRenderPass(),He=[],Ze=0;Ze<h.length;Ze++){var nt=h[Ze],ze=s.getTile(nt),rt=ze.getBucket(a);if(rt){var ht=rt.programConfigurations.get(a.id),Nt={programConfiguration:ht,program:n.useProgram("circle",ht),layoutVertexBuffer:rt.layoutVertexBuffer,indexBuffer:rt.indexBuffer,uniformValues:Xs(n,nt,ze,a)};if(R)for(var or=0,rr=rt.segments.get();or<rr.length;or+=1){var sr=rr[or];He.push({segments:new p.SegmentVector([sr]),sortKey:sr.sortKey,state:Nt})}else He.push({segments:rt.segments,sortKey:0,state:Nt})}}R&&He.sort(function(jn,Xn){return jn.sortKey-Xn.sortKey});for(var Lr=0,rn=He;Lr<rn.length;Lr+=1){var Qr=rn[Lr],xn=Qr.state;xn.program.draw(V,te.TRIANGLES,de,ye,xe,Ge.disabled,xn.uniformValues,a.id,xn.layoutVertexBuffer,xn.indexBuffer,Qr.segments,a.paint,n.transform.zoom,xn.programConfiguration)}}}},heatmap:function(n,s,a,h){if(a.paint.get("heatmap-opacity")!==0)if(n.renderPass==="offscreen"){var g=n.context,b=g.gl,T=ie.disabled,R=new Le([b.ONE,b.ONE],p.Color.transparent,[!0,!0,!0,!0]);(function(He,Ze,nt){var ze=He.gl;He.activeTexture.set(ze.TEXTURE1),He.viewport.set([0,0,Ze.width/4,Ze.height/4]);var rt=nt.heatmapFbo;if(rt)ze.bindTexture(ze.TEXTURE_2D,rt.colorAttachment.get()),He.bindFramebuffer.set(rt.framebuffer);else{var ht=ze.createTexture();ze.bindTexture(ze.TEXTURE_2D,ht),ze.texParameteri(ze.TEXTURE_2D,ze.TEXTURE_WRAP_S,ze.CLAMP_TO_EDGE),ze.texParameteri(ze.TEXTURE_2D,ze.TEXTURE_WRAP_T,ze.CLAMP_TO_EDGE),ze.texParameteri(ze.TEXTURE_2D,ze.TEXTURE_MIN_FILTER,ze.LINEAR),ze.texParameteri(ze.TEXTURE_2D,ze.TEXTURE_MAG_FILTER,ze.LINEAR),rt=nt.heatmapFbo=He.createFramebuffer(Ze.width/4,Ze.height/4,!1),function(Nt,or,rr,sr){var Lr=Nt.gl;Lr.texImage2D(Lr.TEXTURE_2D,0,Lr.RGBA,or.width/4,or.height/4,0,Lr.RGBA,Nt.extRenderToTextureHalfFloat?Nt.extTextureHalfFloat.HALF_FLOAT_OES:Lr.UNSIGNED_BYTE,null),sr.colorAttachment.set(rr)}(He,Ze,ht,rt)}})(g,n,a),g.clear({color:p.Color.transparent});for(var V=0;V<h.length;V++){var te=h[V];if(!s.hasRenderableParent(te)){var de=s.getTile(te),ye=de.getBucket(a);if(ye){var xe=ye.programConfigurations.get(a.id);n.useProgram("heatmap",xe).draw(g,b.TRIANGLES,$.disabled,T,R,Ge.disabled,Of(te.posMatrix,de,n.transform.zoom,a.paint.get("heatmap-intensity")),a.id,ye.layoutVertexBuffer,ye.indexBuffer,ye.segments,a.paint,n.transform.zoom,xe)}}}g.viewport.set([0,0,n.width,n.height])}else n.renderPass==="translucent"&&(n.context.setColorMode(n.colorModeForRenderPass()),function(He,Ze){var nt=He.context,ze=nt.gl,rt=Ze.heatmapFbo;if(rt){nt.activeTexture.set(ze.TEXTURE0),ze.bindTexture(ze.TEXTURE_2D,rt.colorAttachment.get()),nt.activeTexture.set(ze.TEXTURE1);var ht=Ze.colorRampTexture;ht||(ht=Ze.colorRampTexture=new p.Texture(nt,Ze.colorRamp,ze.RGBA)),ht.bind(ze.LINEAR,ze.CLAMP_TO_EDGE),He.useProgram("heatmapTexture").draw(nt,ze.TRIANGLES,$.disabled,ie.disabled,He.colorModeForRenderPass(),Ge.disabled,function(Nt,or,rr,sr){var Lr=p.create();p.ortho(Lr,0,Nt.width,Nt.height,0,0,1);var rn=Nt.context.gl;return{u_matrix:Lr,u_world:[rn.drawingBufferWidth,rn.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:or.paint.get("heatmap-opacity")}}(He,Ze),Ze.id,He.viewportBuffer,He.quadTriangleIndexBuffer,He.viewportSegments,Ze.paint,He.transform.zoom)}}(n,a))},line:function(n,s,a,h){if(n.renderPass==="translucent"){var g=a.paint.get("line-opacity"),b=a.paint.get("line-width");if(g.constantOr(1)!==0&&b.constantOr(1)!==0)for(var T=n.depthModeForSublayer(0,$.ReadOnly),R=n.colorModeForRenderPass(),V=a.paint.get("line-dasharray"),te=a.paint.get("line-pattern"),de=te.constantOr(1),ye=a.paint.get("line-gradient"),xe=a.getCrossfadeParameters(),He=de?"linePattern":V?"lineSDF":ye?"lineGradient":"line",Ze=n.context,nt=Ze.gl,ze=!0,rt=0,ht=h;rt<ht.length;rt+=1){var Nt=ht[rt],or=s.getTile(Nt);if(!de||or.patternsLoaded()){var rr=or.getBucket(a);if(rr){var sr=rr.programConfigurations.get(a.id),Lr=n.context.program.get(),rn=n.useProgram(He,sr),Qr=ze||rn.program!==Lr,xn=te.constantOr(null);if(xn&&or.imageAtlas){var jn=or.imageAtlas,Xn=jn.patternPositions[xn.to.toString()],Wn=jn.patternPositions[xn.from.toString()];Xn&&Wn&&sr.setConstantPatternPositions(Xn,Wn)}var $i=de?Ju(n,or,a,xe):V?Xl(n,or,a,V,xe):ye?Ea(n,or,a,rr.lineClipsArray.length):hl(n,or,a);if(de)Ze.activeTexture.set(nt.TEXTURE0),or.imageAtlasTexture.bind(nt.LINEAR,nt.CLAMP_TO_EDGE),sr.updatePaintBuffers(xe);else if(V&&(Qr||n.lineAtlas.dirty))Ze.activeTexture.set(nt.TEXTURE0),n.lineAtlas.bind(Ze);else if(ye){var Sn=rr.gradients[a.id],oi=Sn.texture;if(a.gradientVersion!==Sn.version){var Si=256;if(a.stepInterpolant){var ai=s.getSource().maxzoom,ii=Nt.canonical.z===ai?Math.ceil(1<<n.transform.maxZoom-Nt.canonical.z):1;Si=p.clamp(p.nextPowerOfTwo(rr.maxLineLength/p.EXTENT*1024*ii),256,Ze.maxTextureSize)}Sn.gradient=p.renderColorRamp({expression:a.gradientExpression(),evaluationKey:"lineProgress",resolution:Si,image:Sn.gradient||void 0,clips:rr.lineClipsArray}),Sn.texture?Sn.texture.update(Sn.gradient):Sn.texture=new p.Texture(Ze,Sn.gradient,nt.RGBA),Sn.version=a.gradientVersion,oi=Sn.texture}Ze.activeTexture.set(nt.TEXTURE0),oi.bind(a.stepInterpolant?nt.NEAREST:nt.LINEAR,nt.CLAMP_TO_EDGE)}rn.draw(Ze,nt.TRIANGLES,T,n.stencilModeForClipping(Nt),R,Ge.disabled,$i,a.id,rr.layoutVertexBuffer,rr.indexBuffer,rr.segments,a.paint,n.transform.zoom,sr,rr.layoutVertexBuffer2),ze=!1}}}}},fill:function(n,s,a,h){var g=a.paint.get("fill-color"),b=a.paint.get("fill-opacity");if(b.constantOr(1)!==0){var T=n.colorModeForRenderPass(),R=a.paint.get("fill-pattern"),V=n.opaquePassEnabledForLayer()&&!R.constantOr(1)&&g.constantOr(p.Color.transparent).a===1&&b.constantOr(0)===1?"opaque":"translucent";if(n.renderPass===V){var te=n.depthModeForSublayer(1,n.renderPass==="opaque"?$.ReadWrite:$.ReadOnly);fc(n,s,a,h,te,T,!1)}if(n.renderPass==="translucent"&&a.paint.get("fill-antialias")){var de=n.depthModeForSublayer(a.getPaintProperty("fill-outline-color")?2:0,$.ReadOnly);fc(n,s,a,h,de,T,!0)}}},"fill-extrusion":function(n,s,a,h){var g=a.paint.get("fill-extrusion-opacity");if(g!==0&&n.renderPass==="translucent"){var b=new $(n.context.gl.LEQUAL,$.ReadWrite,n.depthRangeFor3D);if(g!==1||a.paint.get("fill-extrusion-pattern").constantOr(1))qu(n,s,a,h,b,ie.disabled,Le.disabled),qu(n,s,a,h,b,n.stencilModeFor3D(),n.colorModeForRenderPass());else{var T=n.colorModeForRenderPass();qu(n,s,a,h,b,ie.disabled,T)}}},hillshade:function(n,s,a,h){if(n.renderPass==="offscreen"||n.renderPass==="translucent"){for(var g=n.context,b=n.depthModeForSublayer(0,$.ReadOnly),T=n.colorModeForRenderPass(),R=n.renderPass==="translucent"?n.stencilConfigForOverlap(h):[{},h],V=R[0],te=0,de=R[1];te<de.length;te+=1){var ye=de[te],xe=s.getTile(ye);xe.needsHillshadePrepare&&n.renderPass==="offscreen"?hc(n,xe,a,b,ie.disabled,T):n.renderPass==="translucent"&&Rl(n,xe,a,b,V[ye.overscaledZ],T)}g.viewport.set([0,0,n.width,n.height])}},raster:function(n,s,a,h){if(n.renderPass==="translucent"&&a.paint.get("raster-opacity")!==0&&h.length)for(var g=n.context,b=g.gl,T=s.getSource(),R=n.useProgram("raster"),V=n.colorModeForRenderPass(),te=T instanceof Te?[{},h]:n.stencilConfigForOverlap(h),de=te[0],ye=te[1],xe=ye[ye.length-1].overscaledZ,He=!n.options.moving,Ze=0,nt=ye;Ze<nt.length;Ze+=1){var ze=nt[Ze],rt=n.depthModeForSublayer(ze.overscaledZ-xe,a.paint.get("raster-opacity")===1?$.ReadWrite:$.ReadOnly,b.LESS),ht=s.getTile(ze),Nt=n.transform.calculatePosMatrix(ze.toUnwrapped(),He);ht.registerFadeDuration(a.paint.get("raster-fade-duration"));var or=s.findLoadedParent(ze,0),rr=Fu(ht,or,s,a,n.transform),sr=void 0,Lr=void 0,rn=a.paint.get("raster-resampling")==="nearest"?b.NEAREST:b.LINEAR;g.activeTexture.set(b.TEXTURE0),ht.texture.bind(rn,b.CLAMP_TO_EDGE,b.LINEAR_MIPMAP_NEAREST),g.activeTexture.set(b.TEXTURE1),or?(or.texture.bind(rn,b.CLAMP_TO_EDGE,b.LINEAR_MIPMAP_NEAREST),sr=Math.pow(2,or.tileID.overscaledZ-ht.tileID.overscaledZ),Lr=[ht.tileID.canonical.x*sr%1,ht.tileID.canonical.y*sr%1]):ht.texture.bind(rn,b.CLAMP_TO_EDGE,b.LINEAR_MIPMAP_NEAREST);var Qr=Lc(Nt,Lr||[0,0],sr||1,rr,a);T instanceof Te?R.draw(g,b.TRIANGLES,rt,ie.disabled,V,Ge.disabled,Qr,a.id,T.boundsBuffer,n.quadTriangleIndexBuffer,T.boundsSegments):R.draw(g,b.TRIANGLES,rt,de[ze.overscaledZ],V,Ge.disabled,Qr,a.id,n.rasterBoundsBuffer,n.quadTriangleIndexBuffer,n.rasterBoundsSegments)}},background:function(n,s,a){var h=a.paint.get("background-color"),g=a.paint.get("background-opacity");if(g!==0){var b=n.context,T=b.gl,R=n.transform,V=R.tileSize,te=a.paint.get("background-pattern");if(!n.isPatternMissing(te)){var de=!te&&h.a===1&&g===1&&n.opaquePassEnabledForLayer()?"opaque":"translucent";if(n.renderPass===de){var ye=ie.disabled,xe=n.depthModeForSublayer(0,de==="opaque"?$.ReadWrite:$.ReadOnly),He=n.colorModeForRenderPass(),Ze=n.useProgram(te?"backgroundPattern":"background"),nt=R.coveringTiles({tileSize:V});te&&(b.activeTexture.set(T.TEXTURE0),n.imageManager.bind(n.context));for(var ze=a.getCrossfadeParameters(),rt=0,ht=nt;rt<ht.length;rt+=1){var Nt=ht[rt],or=n.transform.calculatePosMatrix(Nt.toUnwrapped()),rr=te?pl(or,g,n,te,{tileID:Nt,tileSize:V},ze):Ol(or,g,h);Ze.draw(b,T.TRIANGLES,xe,ye,He,Ge.disabled,rr,a.id,n.tileExtentBuffer,n.quadTriangleIndexBuffer,n.tileExtentSegments)}}}}},debug:function(n,s,a){for(var h=0;h<a.length;h++)Nc(n,s,a[h])},custom:function(n,s,a){var h=n.context,g=a.implementation;if(n.renderPass==="offscreen"){var b=g.prerender;b&&(n.setCustomLayerDefaults(),h.setColorMode(n.colorModeForRenderPass()),b.call(g,h.gl,n.transform.customLayerMatrix()),h.setDirty(),n.setBaseState())}else if(n.renderPass==="translucent"){n.setCustomLayerDefaults(),h.setColorMode(n.colorModeForRenderPass()),h.setStencilMode(ie.disabled);var T=g.renderingMode==="3d"?new $(n.context.gl.LEQUAL,$.ReadWrite,n.depthRangeFor3D):n.depthModeForSublayer(0,$.ReadOnly);h.setDepthMode(T),g.render(h.gl,n.transform.customLayerMatrix()),h.setDirty(),n.setBaseState(),h.bindFramebuffer.set(null)}}},ka=function(n,s){this.context=new ue(n),this.transform=s,this._tileTextures={},this.setup(),this.numSublayers=De.maxUnderzooming+De.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new so,this.gpuTimers={}};ka.prototype.resize=function(n,s){if(this.width=n*p.browser.devicePixelRatio,this.height=s*p.browser.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(var a=0,h=this.style._order;a<h.length;a+=1)this.style._layers[h[a]].resize()},ka.prototype.setup=function(){var n=this.context,s=new p.StructArrayLayout2i4;s.emplaceBack(0,0),s.emplaceBack(p.EXTENT,0),s.emplaceBack(0,p.EXTENT),s.emplaceBack(p.EXTENT,p.EXTENT),this.tileExtentBuffer=n.createVertexBuffer(s,Nn.members),this.tileExtentSegments=p.SegmentVector.simpleSegment(0,0,4,2);var a=new p.StructArrayLayout2i4;a.emplaceBack(0,0),a.emplaceBack(p.EXTENT,0),a.emplaceBack(0,p.EXTENT),a.emplaceBack(p.EXTENT,p.EXTENT),this.debugBuffer=n.createVertexBuffer(a,Nn.members),this.debugSegments=p.SegmentVector.simpleSegment(0,0,4,5);var h=new p.StructArrayLayout4i8;h.emplaceBack(0,0,0,0),h.emplaceBack(p.EXTENT,0,p.EXTENT,0),h.emplaceBack(0,p.EXTENT,0,p.EXTENT),h.emplaceBack(p.EXTENT,p.EXTENT,p.EXTENT,p.EXTENT),this.rasterBoundsBuffer=n.createVertexBuffer(h,me.members),this.rasterBoundsSegments=p.SegmentVector.simpleSegment(0,0,4,2);var g=new p.StructArrayLayout2i4;g.emplaceBack(0,0),g.emplaceBack(1,0),g.emplaceBack(0,1),g.emplaceBack(1,1),this.viewportBuffer=n.createVertexBuffer(g,Nn.members),this.viewportSegments=p.SegmentVector.simpleSegment(0,0,4,2);var b=new p.StructArrayLayout1ui2;b.emplaceBack(0),b.emplaceBack(1),b.emplaceBack(3),b.emplaceBack(2),b.emplaceBack(0),this.tileBorderIndexBuffer=n.createIndexBuffer(b);var T=new p.StructArrayLayout3ui6;T.emplaceBack(0,1,2),T.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=n.createIndexBuffer(T),this.emptyTexture=new p.Texture(n,{width:1,height:1,data:new Uint8Array([0,0,0,0])},n.gl.RGBA);var R=this.context.gl;this.stencilClearMode=new ie({func:R.ALWAYS,mask:0},0,255,R.ZERO,R.ZERO,R.ZERO)},ka.prototype.clearStencil=function(){var n=this.context,s=n.gl;this.nextStencilID=1,this.currentStencilSource=void 0;var a=p.create();p.ortho(a,0,this.width,this.height,0,0,1),p.scale(a,a,[s.drawingBufferWidth,s.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(n,s.TRIANGLES,$.disabled,this.stencilClearMode,Le.disabled,Ge.disabled,$u(a),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)},ka.prototype._renderTileClippingMasks=function(n,s){if(this.currentStencilSource!==n.source&&n.isTileClipped()&&s&&s.length){this.currentStencilSource=n.source;var a=this.context,h=a.gl;this.nextStencilID+s.length>256&&this.clearStencil(),a.setColorMode(Le.disabled),a.setDepthMode($.disabled);var g=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(var b=0,T=s;b<T.length;b+=1){var R=T[b],V=this._tileClippingMaskIDs[R.key]=this.nextStencilID++;g.draw(a,h.TRIANGLES,$.disabled,new ie({func:h.ALWAYS,mask:0},V,255,h.KEEP,h.KEEP,h.REPLACE),Le.disabled,Ge.disabled,$u(R.posMatrix),"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}},ka.prototype.stencilModeFor3D=function(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();var n=this.nextStencilID++,s=this.context.gl;return new ie({func:s.NOTEQUAL,mask:255},n,255,s.KEEP,s.KEEP,s.REPLACE)},ka.prototype.stencilModeForClipping=function(n){var s=this.context.gl;return new ie({func:s.EQUAL,mask:255},this._tileClippingMaskIDs[n.key],0,s.KEEP,s.KEEP,s.REPLACE)},ka.prototype.stencilConfigForOverlap=function(n){var s,a=this.context.gl,h=n.sort(function(V,te){return te.overscaledZ-V.overscaledZ}),g=h[h.length-1].overscaledZ,b=h[0].overscaledZ-g+1;if(b>1){this.currentStencilSource=void 0,this.nextStencilID+b>256&&this.clearStencil();for(var T={},R=0;R<b;R++)T[R+g]=new ie({func:a.GEQUAL,mask:255},R+this.nextStencilID,255,a.KEEP,a.KEEP,a.REPLACE);return this.nextStencilID+=b,[T,h]}return[(s={},s[g]=ie.disabled,s),h]},ka.prototype.colorModeForRenderPass=function(){var n=this.context.gl;return this._showOverdrawInspector?new Le([n.CONSTANT_COLOR,n.ONE],new p.Color(1/8,1/8,1/8,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Le.unblended:Le.alphaBlended},ka.prototype.depthModeForSublayer=function(n,s,a){if(!this.opaquePassEnabledForLayer())return $.disabled;var h=1-((1+this.currentLayer)*this.numSublayers+n)*this.depthEpsilon;return new $(a||this.context.gl.LEQUAL,s,[h,h])},ka.prototype.opaquePassEnabledForLayer=function(){return this.currentLayer<this.opaquePassCutoff},ka.prototype.render=function(n,s){var a=this;this.style=n,this.options=s,this.lineAtlas=n.lineAtlas,this.imageManager=n.imageManager,this.glyphManager=n.glyphManager,this.symbolFadeChange=n.placement.symbolFadeChange(p.browser.now()),this.imageManager.beginFrame();var h=this.style._order,g=this.style.sourceCaches;for(var b in g){var T=g[b];T.used&&T.prepare(this.context)}var R,V,te={},de={},ye={};for(var xe in g){var He=g[xe];te[xe]=He.getVisibleCoordinates(),de[xe]=te[xe].slice().reverse(),ye[xe]=He.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(var Ze=0;Ze<h.length;Ze++)if(this.style._layers[h[Ze]].is3D()){this.opaquePassCutoff=Ze;break}this.renderPass="offscreen";for(var nt=0,ze=h;nt<ze.length;nt+=1){var rt=this.style._layers[ze[nt]];if(rt.hasOffscreenPass()&&!rt.isHidden(this.transform.zoom)){var ht=de[rt.source];(rt.type==="custom"||ht.length)&&this.renderLayer(this,g[rt.source],rt,ht)}}for(this.context.bindFramebuffer.set(null),this.context.clear({color:s.showOverdrawInspector?p.Color.black:p.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=s.showOverdrawInspector,this.depthRangeFor3D=[0,1-(n._order.length+2)*this.numSublayers*this.depthEpsilon],this.renderPass="opaque",this.currentLayer=h.length-1;this.currentLayer>=0;this.currentLayer--){var Nt=this.style._layers[h[this.currentLayer]],or=g[Nt.source],rr=te[Nt.source];this._renderTileClippingMasks(Nt,rr),this.renderLayer(this,or,Nt,rr)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<h.length;this.currentLayer++){var sr=this.style._layers[h[this.currentLayer]],Lr=g[sr.source],rn=(sr.type==="symbol"?ye:de)[sr.source];this._renderTileClippingMasks(sr,te[sr.source]),this.renderLayer(this,Lr,sr,rn)}this.options.showTileBoundaries&&(p.values(this.style._layers).forEach(function(Qr){Qr.source&&!Qr.isHidden(a.transform.zoom)&&(Qr.source!==(V&&V.id)&&(V=a.style.sourceCaches[Qr.source]),(!R||R.getSource().maxzoom<V.getSource().maxzoom)&&(R=V))}),R&&zu.debug(this,R,R.getVisibleCoordinates())),this.options.showPadding&&function(Qr){var xn=Qr.transform.padding;Fc(Qr,Qr.transform.height-(xn.top||0),3,Dc),Fc(Qr,xn.bottom||0,3,Qc),zc(Qr,xn.left||0,3,qc),zc(Qr,Qr.transform.width-(xn.right||0),3,Dl);var jn=Qr.transform.centerPoint;(function(Xn,Wn,$i,Sn){vl(Xn,Wn-1,$i-10,2,20,Sn),vl(Xn,Wn-10,$i-1,20,2,Sn)})(Qr,jn.x,Qr.transform.height-jn.y,kc)}(this),this.context.setDefault()},ka.prototype.renderLayer=function(n,s,a,h){a.isHidden(this.transform.zoom)||(a.type==="background"||a.type==="custom"||h.length)&&(this.id=a.id,this.gpuTimingStart(a),zu[a.type](n,s,a,h,this.style.placement.variableOffsets),this.gpuTimingEnd())},ka.prototype.gpuTimingStart=function(n){if(this.options.gpuTiming){var s=this.context.extTimerQuery,a=this.gpuTimers[n.id];a||(a=this.gpuTimers[n.id]={calls:0,cpuTime:0,query:s.createQueryEXT()}),a.calls++,s.beginQueryEXT(s.TIME_ELAPSED_EXT,a.query)}},ka.prototype.gpuTimingEnd=function(){if(this.options.gpuTiming){var n=this.context.extTimerQuery;n.endQueryEXT(n.TIME_ELAPSED_EXT)}},ka.prototype.collectGpuTimers=function(){var n=this.gpuTimers;return this.gpuTimers={},n},ka.prototype.queryGpuTimers=function(n){var s={};for(var a in n){var h=n[a],g=this.context.extTimerQuery,b=g.getQueryObjectEXT(h.query,g.QUERY_RESULT_EXT)/1e6;g.deleteQueryEXT(h.query),s[a]=b}return s},ka.prototype.translatePosMatrix=function(n,s,a,h,g){if(!a[0]&&!a[1])return n;var b=g?h==="map"?this.transform.angle:0:h==="viewport"?-this.transform.angle:0;if(b){var T=Math.sin(b),R=Math.cos(b);a=[a[0]*R-a[1]*T,a[0]*T+a[1]*R]}var V=[g?a[0]:sa(s,a[0],this.transform.zoom),g?a[1]:sa(s,a[1],this.transform.zoom),0],te=new Float32Array(16);return p.translate(te,n,V),te},ka.prototype.saveTileTexture=function(n){var s=this._tileTextures[n.size[0]];s?s.push(n):this._tileTextures[n.size[0]]=[n]},ka.prototype.getTileTexture=function(n){var s=this._tileTextures[n];return s&&s.length>0?s.pop():null},ka.prototype.isPatternMissing=function(n){if(!n)return!1;if(!n.from||!n.to)return!0;var s=this.imageManager.getPattern(n.from.toString()),a=this.imageManager.getPattern(n.to.toString());return!s||!a},ka.prototype.useProgram=function(n,s){this.cache=this.cache||{};var a=""+n+(s?s.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"");return this.cache[a]||(this.cache[a]=new Ic(this.context,n,gf[n],s,Rc[n],this._showOverdrawInspector)),this.cache[a]},ka.prototype.setCustomLayerDefaults=function(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()},ka.prototype.setBaseState=function(){var n=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(n.FUNC_ADD)},ka.prototype.initDebugOverlayCanvas=function(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=p.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new p.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))},ka.prototype.destroy=function(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()};var Ql=function(n,s){this.points=n,this.planes=s};Ql.fromInvProjectionMatrix=function(n,s,a){var h=Math.pow(2,a),g=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(function(T){return p.transformMat4([],T,n)}).map(function(T){return p.scale$1([],T,1/T[3]/s*h)}),b=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(function(T){var R=p.sub([],g[T[0]],g[T[1]]),V=p.sub([],g[T[2]],g[T[1]]),te=p.normalize([],p.cross([],R,V)),de=-p.dot(te,g[T[1]]);return te.concat(de)});return new Ql(g,b)};var Nu=function(n,s){this.min=n,this.max=s,this.center=p.scale$2([],p.add([],this.min,this.max),.5)};Nu.prototype.quadrant=function(n){for(var s=[n%2==0,n<2],a=p.clone$2(this.min),h=p.clone$2(this.max),g=0;g<s.length;g++)a[g]=s[g]?this.min[g]:this.center[g],h[g]=s[g]?this.center[g]:this.max[g];return h[2]=this.max[2],new Nu(a,h)},Nu.prototype.distanceX=function(n){return Math.max(Math.min(this.max[0],n[0]),this.min[0])-n[0]},Nu.prototype.distanceY=function(n){return Math.max(Math.min(this.max[1],n[1]),this.min[1])-n[1]},Nu.prototype.intersects=function(n){for(var s=[[this.min[0],this.min[1],0,1],[this.max[0],this.min[1],0,1],[this.max[0],this.max[1],0,1],[this.min[0],this.max[1],0,1]],a=!0,h=0;h<n.planes.length;h++){for(var g=n.planes[h],b=0,T=0;T<s.length;T++)b+=p.dot$1(g,s[T])>=0;if(b===0)return 0;b!==s.length&&(a=!1)}if(a)return 2;for(var R=0;R<3;R++){for(var V=Number.MAX_VALUE,te=-Number.MAX_VALUE,de=0;de<n.points.length;de++){var ye=n.points[de][R]-this.min[R];V=Math.min(V,ye),te=Math.max(te,ye)}if(te<0||V>this.max[R]-this.min[R])return 0}return 1};var el=function(n,s,a,h){if(n===void 0&&(n=0),s===void 0&&(s=0),a===void 0&&(a=0),h===void 0&&(h=0),isNaN(n)||n<0||isNaN(s)||s<0||isNaN(a)||a<0||isNaN(h)||h<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=n,this.bottom=s,this.left=a,this.right=h};el.prototype.interpolate=function(n,s,a){return s.top!=null&&n.top!=null&&(this.top=p.number(n.top,s.top,a)),s.bottom!=null&&n.bottom!=null&&(this.bottom=p.number(n.bottom,s.bottom,a)),s.left!=null&&n.left!=null&&(this.left=p.number(n.left,s.left,a)),s.right!=null&&n.right!=null&&(this.right=p.number(n.right,s.right,a)),this},el.prototype.getCenter=function(n,s){var a=p.clamp((this.left+n-this.right)/2,0,n),h=p.clamp((this.top+s-this.bottom)/2,0,s);return new p.Point(a,h)},el.prototype.equals=function(n){return this.top===n.top&&this.bottom===n.bottom&&this.left===n.left&&this.right===n.right},el.prototype.clone=function(){return new el(this.top,this.bottom,this.left,this.right)},el.prototype.toJSON=function(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}};var Ni=function(n,s,a,h,g){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=g===void 0||g,this._minZoom=n||0,this._maxZoom=s||22,this._minPitch=a==null?0:a,this._maxPitch=h==null?60:h,this.setMaxBounds(),this.width=0,this.height=0,this._center=new p.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new el,this._posMatrixCache={},this._alignedPosMatrixCache={}},Pa={minZoom:{configurable:!0},maxZoom:{configurable:!0},minPitch:{configurable:!0},maxPitch:{configurable:!0},renderWorldCopies:{configurable:!0},worldSize:{configurable:!0},centerOffset:{configurable:!0},size:{configurable:!0},bearing:{configurable:!0},pitch:{configurable:!0},fov:{configurable:!0},zoom:{configurable:!0},center:{configurable:!0},padding:{configurable:!0},centerPoint:{configurable:!0},unmodified:{configurable:!0},point:{configurable:!0}};Ni.prototype.clone=function(){var n=new Ni(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return n.tileSize=this.tileSize,n.latRange=this.latRange,n.width=this.width,n.height=this.height,n._center=this._center,n.zoom=this.zoom,n.angle=this.angle,n._fov=this._fov,n._pitch=this._pitch,n._unmodified=this._unmodified,n._edgeInsets=this._edgeInsets.clone(),n._calcMatrices(),n},Pa.minZoom.get=function(){return this._minZoom},Pa.minZoom.set=function(n){this._minZoom!==n&&(this._minZoom=n,this.zoom=Math.max(this.zoom,n))},Pa.maxZoom.get=function(){return this._maxZoom},Pa.maxZoom.set=function(n){this._maxZoom!==n&&(this._maxZoom=n,this.zoom=Math.min(this.zoom,n))},Pa.minPitch.get=function(){return this._minPitch},Pa.minPitch.set=function(n){this._minPitch!==n&&(this._minPitch=n,this.pitch=Math.max(this.pitch,n))},Pa.maxPitch.get=function(){return this._maxPitch},Pa.maxPitch.set=function(n){this._maxPitch!==n&&(this._maxPitch=n,this.pitch=Math.min(this.pitch,n))},Pa.renderWorldCopies.get=function(){return this._renderWorldCopies},Pa.renderWorldCopies.set=function(n){n===void 0?n=!0:n===null&&(n=!1),this._renderWorldCopies=n},Pa.worldSize.get=function(){return this.tileSize*this.scale},Pa.centerOffset.get=function(){return this.centerPoint._sub(this.size._div(2))},Pa.size.get=function(){return new p.Point(this.width,this.height)},Pa.bearing.get=function(){return-this.angle/Math.PI*180},Pa.bearing.set=function(n){var s=-p.wrap(n,-180,180)*Math.PI/180;this.angle!==s&&(this._unmodified=!1,this.angle=s,this._calcMatrices(),this.rotationMatrix=p.create$2(),p.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))},Pa.pitch.get=function(){return this._pitch/Math.PI*180},Pa.pitch.set=function(n){var s=p.clamp(n,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==s&&(this._unmodified=!1,this._pitch=s,this._calcMatrices())},Pa.fov.get=function(){return this._fov/Math.PI*180},Pa.fov.set=function(n){n=Math.max(.01,Math.min(60,n)),this._fov!==n&&(this._unmodified=!1,this._fov=n/180*Math.PI,this._calcMatrices())},Pa.zoom.get=function(){return this._zoom},Pa.zoom.set=function(n){var s=Math.min(Math.max(n,this.minZoom),this.maxZoom);this._zoom!==s&&(this._unmodified=!1,this._zoom=s,this.scale=this.zoomScale(s),this.tileZoom=Math.floor(s),this.zoomFraction=s-this.tileZoom,this._constrain(),this._calcMatrices())},Pa.center.get=function(){return this._center},Pa.center.set=function(n){n.lat===this._center.lat&&n.lng===this._center.lng||(this._unmodified=!1,this._center=n,this._constrain(),this._calcMatrices())},Pa.padding.get=function(){return this._edgeInsets.toJSON()},Pa.padding.set=function(n){this._edgeInsets.equals(n)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,n,1),this._calcMatrices())},Pa.centerPoint.get=function(){return this._edgeInsets.getCenter(this.width,this.height)},Ni.prototype.isPaddingEqual=function(n){return this._edgeInsets.equals(n)},Ni.prototype.interpolatePadding=function(n,s,a){this._unmodified=!1,this._edgeInsets.interpolate(n,s,a),this._constrain(),this._calcMatrices()},Ni.prototype.coveringZoomLevel=function(n){var s=(n.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/n.tileSize));return Math.max(0,s)},Ni.prototype.getVisibleUnwrappedCoordinates=function(n){var s=[new p.UnwrappedTileID(0,n)];if(this._renderWorldCopies)for(var a=this.pointCoordinate(new p.Point(0,0)),h=this.pointCoordinate(new p.Point(this.width,0)),g=this.pointCoordinate(new p.Point(this.width,this.height)),b=this.pointCoordinate(new p.Point(0,this.height)),T=Math.floor(Math.min(a.x,h.x,g.x,b.x)),R=Math.floor(Math.max(a.x,h.x,g.x,b.x)),V=T-1;V<=R+1;V++)V!==0&&s.push(new p.UnwrappedTileID(V,n));return s},Ni.prototype.coveringTiles=function(n){var s=this.coveringZoomLevel(n),a=s;if(n.minzoom!==void 0&&s<n.minzoom)return[];n.maxzoom!==void 0&&s>n.maxzoom&&(s=n.maxzoom);var h=p.MercatorCoordinate.fromLngLat(this.center),g=Math.pow(2,s),b=[g*h.x,g*h.y,0],T=Ql.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,s),R=n.minzoom||0;this.pitch<=60&&this._edgeInsets.top<.1&&(R=s);var V=function(Qr){return{aabb:new Nu([Qr*g,0,0],[(Qr+1)*g,g,0]),zoom:0,x:0,y:0,wrap:Qr,fullyVisible:!1}},te=[],de=[],ye=s,xe=n.reparseOverscaled?a:s;if(this._renderWorldCopies)for(var He=1;He<=3;He++)te.push(V(-He)),te.push(V(He));for(te.push(V(0));te.length>0;){var Ze=te.pop(),nt=Ze.x,ze=Ze.y,rt=Ze.fullyVisible;if(!rt){var ht=Ze.aabb.intersects(T);if(ht===0)continue;rt=ht===2}var Nt=Ze.aabb.distanceX(b),or=Ze.aabb.distanceY(b),rr=Math.max(Math.abs(Nt),Math.abs(or));if(Ze.zoom===ye||rr>3+(1<<ye-Ze.zoom)-2&&Ze.zoom>=R)de.push({tileID:new p.OverscaledTileID(Ze.zoom===ye?xe:Ze.zoom,Ze.wrap,Ze.zoom,nt,ze),distanceSq:p.sqrLen([b[0]-.5-nt,b[1]-.5-ze])});else for(var sr=0;sr<4;sr++){var Lr=(nt<<1)+sr%2,rn=(ze<<1)+(sr>>1);te.push({aabb:Ze.aabb.quadrant(sr),zoom:Ze.zoom+1,x:Lr,y:rn,wrap:Ze.wrap,fullyVisible:rt})}}return de.sort(function(Qr,xn){return Qr.distanceSq-xn.distanceSq}).map(function(Qr){return Qr.tileID})},Ni.prototype.resize=function(n,s){this.width=n,this.height=s,this.pixelsToGLUnits=[2/n,-2/s],this._constrain(),this._calcMatrices()},Pa.unmodified.get=function(){return this._unmodified},Ni.prototype.zoomScale=function(n){return Math.pow(2,n)},Ni.prototype.scaleZoom=function(n){return Math.log(n)/Math.LN2},Ni.prototype.project=function(n){var s=p.clamp(n.lat,-this.maxValidLatitude,this.maxValidLatitude);return new p.Point(p.mercatorXfromLng(n.lng)*this.worldSize,p.mercatorYfromLat(s)*this.worldSize)},Ni.prototype.unproject=function(n){return new p.MercatorCoordinate(n.x/this.worldSize,n.y/this.worldSize).toLngLat()},Pa.point.get=function(){return this.project(this.center)},Ni.prototype.setLocationAtPoint=function(n,s){var a=this.pointCoordinate(s),h=this.pointCoordinate(this.centerPoint),g=this.locationCoordinate(n),b=new p.MercatorCoordinate(g.x-(a.x-h.x),g.y-(a.y-h.y));this.center=this.coordinateLocation(b),this._renderWorldCopies&&(this.center=this.center.wrap())},Ni.prototype.locationPoint=function(n){return this.coordinatePoint(this.locationCoordinate(n))},Ni.prototype.pointLocation=function(n){return this.coordinateLocation(this.pointCoordinate(n))},Ni.prototype.locationCoordinate=function(n){return p.MercatorCoordinate.fromLngLat(n)},Ni.prototype.coordinateLocation=function(n){return n.toLngLat()},Ni.prototype.pointCoordinate=function(n){var s=[n.x,n.y,0,1],a=[n.x,n.y,1,1];p.transformMat4(s,s,this.pixelMatrixInverse),p.transformMat4(a,a,this.pixelMatrixInverse);var h=s[3],g=a[3],b=s[1]/h,T=a[1]/g,R=s[2]/h,V=a[2]/g,te=R===V?0:(0-R)/(V-R);return new p.MercatorCoordinate(p.number(s[0]/h,a[0]/g,te)/this.worldSize,p.number(b,T,te)/this.worldSize)},Ni.prototype.coordinatePoint=function(n){var s=[n.x*this.worldSize,n.y*this.worldSize,0,1];return p.transformMat4(s,s,this.pixelMatrix),new p.Point(s[0]/s[3],s[1]/s[3])},Ni.prototype.getBounds=function(){return new p.LngLatBounds().extend(this.pointLocation(new p.Point(0,0))).extend(this.pointLocation(new p.Point(this.width,0))).extend(this.pointLocation(new p.Point(this.width,this.height))).extend(this.pointLocation(new p.Point(0,this.height)))},Ni.prototype.getMaxBounds=function(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new p.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null},Ni.prototype.setMaxBounds=function(n){n?(this.lngRange=[n.getWest(),n.getEast()],this.latRange=[n.getSouth(),n.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])},Ni.prototype.calculatePosMatrix=function(n,s){s===void 0&&(s=!1);var a=n.key,h=s?this._alignedPosMatrixCache:this._posMatrixCache;if(h[a])return h[a];var g=n.canonical,b=this.worldSize/this.zoomScale(g.z),T=g.x+Math.pow(2,g.z)*n.wrap,R=p.identity(new Float64Array(16));return p.translate(R,R,[T*b,g.y*b,0]),p.scale(R,R,[b/p.EXTENT,b/p.EXTENT,1]),p.multiply(R,s?this.alignedProjMatrix:this.projMatrix,R),h[a]=new Float32Array(R),h[a]},Ni.prototype.customLayerMatrix=function(){return this.mercatorMatrix.slice()},Ni.prototype._constrain=function(){if(this.center&&this.width&&this.height&&!this._constraining){this._constraining=!0;var n,s,a,h,g=-90,b=90,T=-180,R=180,V=this.size,te=this._unmodified;if(this.latRange){var de=this.latRange;g=p.mercatorYfromLat(de[1])*this.worldSize,n=(b=p.mercatorYfromLat(de[0])*this.worldSize)-g<V.y?V.y/(b-g):0}if(this.lngRange){var ye=this.lngRange;T=p.mercatorXfromLng(ye[0])*this.worldSize,s=(R=p.mercatorXfromLng(ye[1])*this.worldSize)-T<V.x?V.x/(R-T):0}var xe=this.point,He=Math.max(s||0,n||0);if(He)return this.center=this.unproject(new p.Point(s?(R+T)/2:xe.x,n?(b+g)/2:xe.y)),this.zoom+=this.scaleZoom(He),this._unmodified=te,void(this._constraining=!1);if(this.latRange){var Ze=xe.y,nt=V.y/2;Ze-nt<g&&(h=g+nt),Ze+nt>b&&(h=b-nt)}if(this.lngRange){var ze=xe.x,rt=V.x/2;ze-rt<T&&(a=T+rt),ze+rt>R&&(a=R-rt)}a===void 0&&h===void 0||(this.center=this.unproject(new p.Point(a!==void 0?a:xe.x,h!==void 0?h:xe.y))),this._unmodified=te,this._constraining=!1}},Ni.prototype._calcMatrices=function(){if(this.height){var n=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;var s=Math.PI/2+this._pitch,a=this._fov*(.5+n.y/this.height),h=Math.sin(a)*this.cameraToCenterDistance/Math.sin(p.clamp(Math.PI-s-a,.01,Math.PI-.01)),g=this.point,b=g.x,T=g.y,R=1.01*(Math.cos(Math.PI/2-this._pitch)*h+this.cameraToCenterDistance),V=this.height/50,te=new Float64Array(16);p.perspective(te,this._fov,this.width/this.height,V,R),te[8]=2*-n.x/this.width,te[9]=2*n.y/this.height,p.scale(te,te,[1,-1,1]),p.translate(te,te,[0,0,-this.cameraToCenterDistance]),p.rotateX(te,te,this._pitch),p.rotateZ(te,te,this.angle),p.translate(te,te,[-b,-T,0]),this.mercatorMatrix=p.scale([],te,[this.worldSize,this.worldSize,this.worldSize]),p.scale(te,te,[1,1,p.mercatorZfromAltitude(1,this.center.lat)*this.worldSize,1]),this.projMatrix=te,this.invProjMatrix=p.invert([],this.projMatrix);var de=this.width%2/2,ye=this.height%2/2,xe=Math.cos(this.angle),He=Math.sin(this.angle),Ze=b-Math.round(b)+xe*de+He*ye,nt=T-Math.round(T)+xe*ye+He*de,ze=new Float64Array(te);if(p.translate(ze,ze,[Ze>.5?Ze-1:Ze,nt>.5?nt-1:nt,0]),this.alignedProjMatrix=ze,te=p.create(),p.scale(te,te,[this.width/2,-this.height/2,1]),p.translate(te,te,[1,-1,0]),this.labelPlaneMatrix=te,te=p.create(),p.scale(te,te,[1,-1,1]),p.translate(te,te,[-1,-1,0]),p.scale(te,te,[2/this.width,2/this.height,1]),this.glCoordMatrix=te,this.pixelMatrix=p.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),!(te=p.invert(new Float64Array(16),this.pixelMatrix)))throw new Error("failed to invert matrix");this.pixelMatrixInverse=te,this._posMatrixCache={},this._alignedPosMatrixCache={}}},Ni.prototype.maxPitchScaleFactor=function(){if(!this.pixelMatrixInverse)return 1;var n=this.pointCoordinate(new p.Point(0,0)),s=[n.x*this.worldSize,n.y*this.worldSize,0,1];return p.transformMat4(s,s,this.pixelMatrix)[3]/this.cameraToCenterDistance},Ni.prototype.getCameraPoint=function(){var n=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new p.Point(0,n))},Ni.prototype.getCameraQueryGeometry=function(n){var s=this.getCameraPoint();if(n.length===1)return[n[0],s];for(var a=s.x,h=s.y,g=s.x,b=s.y,T=0,R=n;T<R.length;T+=1){var V=R[T];a=Math.min(a,V.x),h=Math.min(h,V.y),g=Math.max(g,V.x),b=Math.max(b,V.y)}return[new p.Point(a,h),new p.Point(g,h),new p.Point(g,b),new p.Point(a,b),new p.Point(a,h)]},Object.defineProperties(Ni.prototype,Pa);var Ma=function(n){var s,a,h,g;this._hashName=n&&encodeURIComponent(n),p.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=(s=this._updateHashUnthrottled.bind(this),a=!1,h=null,g=function(){h=null,a&&(s(),h=setTimeout(g,300),a=!1)},function(){return a=!0,h||g(),h})};Ma.prototype.addTo=function(n){return this._map=n,p.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this},Ma.prototype.remove=function(){return p.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this},Ma.prototype.getHashString=function(n){var s=this._map.getCenter(),a=Math.round(100*this._map.getZoom())/100,h=Math.ceil((a*Math.LN2+Math.log(512/360/.5))/Math.LN10),g=Math.pow(10,h),b=Math.round(s.lng*g)/g,T=Math.round(s.lat*g)/g,R=this._map.getBearing(),V=this._map.getPitch(),te="";if(te+=n?"/"+b+"/"+T+"/"+a:a+"/"+T+"/"+b,(R||V)&&(te+="/"+Math.round(10*R)/10),V&&(te+="/"+Math.round(V)),this._hashName){var de=this._hashName,ye=!1,xe=p.window.location.hash.slice(1).split("&").map(function(He){var Ze=He.split("=")[0];return Ze===de?(ye=!0,Ze+"="+te):He}).filter(function(He){return He});return ye||xe.push(de+"="+te),"#"+xe.join("&")}return"#"+te},Ma.prototype._getCurrentHash=function(){var n,s=this,a=p.window.location.hash.replace("#","");return this._hashName?(a.split("&").map(function(h){return h.split("=")}).forEach(function(h){h[0]===s._hashName&&(n=h)}),(n&&n[1]||"").split("/")):a.split("/")},Ma.prototype._onHashChange=function(){var n=this._getCurrentHash();if(n.length>=3&&!n.some(function(a){return isNaN(a)})){var s=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(n[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+n[2],+n[1]],zoom:+n[0],bearing:s,pitch:+(n[4]||0)}),!0}return!1},Ma.prototype._updateHashUnthrottled=function(){var n=p.window.location.href.replace(/(#.+)?$/,this.getHashString());try{p.window.history.replaceState(p.window.history.state,null,n)}catch(s){}};var ql={linearity:.3,easing:p.bezier(0,0,.3,1)},kl=p.extend({deceleration:2500,maxSpeed:1400},ql),ec=p.extend({deceleration:20,maxSpeed:1400},ql),yf=p.extend({deceleration:1e3,maxSpeed:360},ql),_f=p.extend({deceleration:1e3,maxSpeed:90},ql),Fl=function(n){this._map=n,this.clear()};function Bu(n,s){(!n.duration||n.duration<s.duration)&&(n.duration=s.duration,n.easing=s.easing)}function Uu(n,s,a){var h=a.maxSpeed,g=a.linearity,b=a.deceleration,T=p.clamp(n*g/(s/1e3),-h,h),R=Math.abs(T)/(b*g);return{easing:a.easing,duration:1e3*R,amount:T*(R/2)}}Fl.prototype.clear=function(){this._inertiaBuffer=[]},Fl.prototype.record=function(n){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:p.browser.now(),settings:n})},Fl.prototype._drainInertiaBuffer=function(){for(var n=this._inertiaBuffer,s=p.browser.now();n.length>0&&s-n[0].time>160;)n.shift()},Fl.prototype._onMoveEnd=function(n){if(this._drainInertiaBuffer(),!(this._inertiaBuffer.length<2)){for(var s={zoom:0,bearing:0,pitch:0,pan:new p.Point(0,0),pinchAround:void 0,around:void 0},a=0,h=this._inertiaBuffer;a<h.length;a+=1){var g=h[a].settings;s.zoom+=g.zoomDelta||0,s.bearing+=g.bearingDelta||0,s.pitch+=g.pitchDelta||0,g.panDelta&&s.pan._add(g.panDelta),g.around&&(s.around=g.around),g.pinchAround&&(s.pinchAround=g.pinchAround)}var b=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,T={};if(s.pan.mag()){var R=Uu(s.pan.mag(),b,p.extend({},kl,n||{}));T.offset=s.pan.mult(R.amount/s.pan.mag()),T.center=this._map.transform.center,Bu(T,R)}if(s.zoom){var V=Uu(s.zoom,b,ec);T.zoom=this._map.transform.zoom+V.amount,Bu(T,V)}if(s.bearing){var te=Uu(s.bearing,b,yf);T.bearing=this._map.transform.bearing+p.clamp(te.amount,-179,179),Bu(T,te)}if(s.pitch){var de=Uu(s.pitch,b,_f);T.pitch=this._map.transform.pitch+de.amount,Bu(T,de)}if(T.zoom||T.bearing){var ye=s.pinchAround===void 0?s.around:s.pinchAround;T.around=ye?this._map.unproject(ye):this._map.getCenter()}return this.clear(),p.extend(T,{noMoveStart:!0})}};var to=function(n){function s(h,g,b,T){T===void 0&&(T={});var R=F.mousePos(g.getCanvasContainer(),b),V=g.unproject(R);n.call(this,h,p.extend({point:R,lngLat:V,originalEvent:b},T)),this._defaultPrevented=!1,this.target=g}n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s;var a={defaultPrevented:{configurable:!0}};return s.prototype.preventDefault=function(){this._defaultPrevented=!0},a.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(s.prototype,a),s}(p.Event),ds=function(n){function s(h,g,b){var T=h==="touchend"?b.changedTouches:b.touches,R=F.touchPos(g.getCanvasContainer(),T),V=R.map(function(ye){return g.unproject(ye)}),te=R.reduce(function(ye,xe,He,Ze){return ye.add(xe.div(Ze.length))},new p.Point(0,0)),de=g.unproject(te);n.call(this,h,{points:R,point:te,lngLats:V,lngLat:de,originalEvent:b}),this._defaultPrevented=!1}n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s;var a={defaultPrevented:{configurable:!0}};return s.prototype.preventDefault=function(){this._defaultPrevented=!0},a.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(s.prototype,a),s}(p.Event),ml=function(n){function s(h,g,b){n.call(this,h,{originalEvent:b}),this._defaultPrevented=!1}n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s;var a={defaultPrevented:{configurable:!0}};return s.prototype.preventDefault=function(){this._defaultPrevented=!0},a.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(s.prototype,a),s}(p.Event),lo=function(n,s){this._map=n,this._clickTolerance=s.clickTolerance};lo.prototype.reset=function(){delete this._mousedownPos},lo.prototype.wheel=function(n){return this._firePreventable(new ml(n.type,this._map,n))},lo.prototype.mousedown=function(n,s){return this._mousedownPos=s,this._firePreventable(new to(n.type,this._map,n))},lo.prototype.mouseup=function(n){this._map.fire(new to(n.type,this._map,n))},lo.prototype.click=function(n,s){this._mousedownPos&&this._mousedownPos.dist(s)>=this._clickTolerance||this._map.fire(new to(n.type,this._map,n))},lo.prototype.dblclick=function(n){return this._firePreventable(new to(n.type,this._map,n))},lo.prototype.mouseover=function(n){this._map.fire(new to(n.type,this._map,n))},lo.prototype.mouseout=function(n){this._map.fire(new to(n.type,this._map,n))},lo.prototype.touchstart=function(n){return this._firePreventable(new ds(n.type,this._map,n))},lo.prototype.touchmove=function(n){this._map.fire(new ds(n.type,this._map,n))},lo.prototype.touchend=function(n){this._map.fire(new ds(n.type,this._map,n))},lo.prototype.touchcancel=function(n){this._map.fire(new ds(n.type,this._map,n))},lo.prototype._firePreventable=function(n){if(this._map.fire(n),n.defaultPrevented)return{}},lo.prototype.isEnabled=function(){return!0},lo.prototype.isActive=function(){return!1},lo.prototype.enable=function(){},lo.prototype.disable=function(){};var Tn=function(n){this._map=n};Tn.prototype.reset=function(){this._delayContextMenu=!1,delete this._contextMenuEvent},Tn.prototype.mousemove=function(n){this._map.fire(new to(n.type,this._map,n))},Tn.prototype.mousedown=function(){this._delayContextMenu=!0},Tn.prototype.mouseup=function(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new to("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)},Tn.prototype.contextmenu=function(n){this._delayContextMenu?this._contextMenuEvent=n:this._map.fire(new to(n.type,this._map,n)),this._map.listens("contextmenu")&&n.preventDefault()},Tn.prototype.isEnabled=function(){return!0},Tn.prototype.isActive=function(){return!1},Tn.prototype.enable=function(){},Tn.prototype.disable=function(){};var Is=function(n,s){this._map=n,this._el=n.getCanvasContainer(),this._container=n.getContainer(),this._clickTolerance=s.clickTolerance||1};function tc(n,s){for(var a={},h=0;h<n.length;h++)a[n[h].identifier]=s[h];return a}Is.prototype.isEnabled=function(){return!!this._enabled},Is.prototype.isActive=function(){return!!this._active},Is.prototype.enable=function(){this.isEnabled()||(this._enabled=!0)},Is.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},Is.prototype.mousedown=function(n,s){this.isEnabled()&&n.shiftKey&&n.button===0&&(F.disableDrag(),this._startPos=this._lastPos=s,this._active=!0)},Is.prototype.mousemoveWindow=function(n,s){if(this._active){var a=s;if(!(this._lastPos.equals(a)||!this._box&&a.dist(this._startPos)<this._clickTolerance)){var h=this._startPos;this._lastPos=a,this._box||(this._box=F.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",n));var g=Math.min(h.x,a.x),b=Math.max(h.x,a.x),T=Math.min(h.y,a.y),R=Math.max(h.y,a.y);F.setTransform(this._box,"translate("+g+"px,"+T+"px)"),this._box.style.width=b-g+"px",this._box.style.height=R-T+"px"}}},Is.prototype.mouseupWindow=function(n,s){var a=this;if(this._active&&n.button===0){var h=this._startPos,g=s;if(this.reset(),F.suppressClick(),h.x!==g.x||h.y!==g.y)return this._map.fire(new p.Event("boxzoomend",{originalEvent:n})),{cameraAnimation:function(b){return b.fitScreenCoordinates(h,g,a._map.getBearing(),{linear:!0})}};this._fireEvent("boxzoomcancel",n)}},Is.prototype.keydown=function(n){this._active&&n.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",n))},Is.prototype.reset=function(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(F.remove(this._box),this._box=null),F.enableDrag(),delete this._startPos,delete this._lastPos},Is.prototype._fireEvent=function(n,s){return this._map.fire(new p.Event(n,{originalEvent:s}))};var gl=function(n){this.reset(),this.numTouches=n.numTouches};gl.prototype.reset=function(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1},gl.prototype.touchstart=function(n,s,a){(this.centroid||a.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=n.timeStamp),a.length===this.numTouches&&(this.centroid=function(h){for(var g=new p.Point(0,0),b=0,T=h;b<T.length;b+=1)g._add(T[b]);return g.div(h.length)}(s),this.touches=tc(a,s)))},gl.prototype.touchmove=function(n,s,a){if(!this.aborted&&this.centroid){var h=tc(a,s);for(var g in this.touches){var b=h[g];(!b||b.dist(this.touches[g])>30)&&(this.aborted=!0)}}},gl.prototype.touchend=function(n,s,a){if((!this.centroid||n.timeStamp-this.startTime>500)&&(this.aborted=!0),a.length===0){var h=!this.aborted&&this.centroid;if(this.reset(),h)return h}};var $s=function(n){this.singleTap=new gl(n),this.numTaps=n.numTaps,this.reset()};$s.prototype.reset=function(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()},$s.prototype.touchstart=function(n,s,a){this.singleTap.touchstart(n,s,a)},$s.prototype.touchmove=function(n,s,a){this.singleTap.touchmove(n,s,a)},$s.prototype.touchend=function(n,s,a){var h=this.singleTap.touchend(n,s,a);if(h){var g=n.timeStamp-this.lastTime<500,b=!this.lastTap||this.lastTap.dist(h)<30;if(g&&b||this.reset(),this.count++,this.lastTime=n.timeStamp,this.lastTap=h,this.count===this.numTaps)return this.reset(),h}};var Us=function(){this._zoomIn=new $s({numTouches:1,numTaps:2}),this._zoomOut=new $s({numTouches:2,numTaps:1}),this.reset()};Us.prototype.reset=function(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()},Us.prototype.touchstart=function(n,s,a){this._zoomIn.touchstart(n,s,a),this._zoomOut.touchstart(n,s,a)},Us.prototype.touchmove=function(n,s,a){this._zoomIn.touchmove(n,s,a),this._zoomOut.touchmove(n,s,a)},Us.prototype.touchend=function(n,s,a){var h=this,g=this._zoomIn.touchend(n,s,a),b=this._zoomOut.touchend(n,s,a);return g?(this._active=!0,n.preventDefault(),setTimeout(function(){return h.reset()},0),{cameraAnimation:function(T){return T.easeTo({duration:300,zoom:T.getZoom()+1,around:T.unproject(g)},{originalEvent:n})}}):b?(this._active=!0,n.preventDefault(),setTimeout(function(){return h.reset()},0),{cameraAnimation:function(T){return T.easeTo({duration:300,zoom:T.getZoom()-1,around:T.unproject(b)},{originalEvent:n})}}):void 0},Us.prototype.touchcancel=function(){this.reset()},Us.prototype.enable=function(){this._enabled=!0},Us.prototype.disable=function(){this._enabled=!1,this.reset()},Us.prototype.isEnabled=function(){return this._enabled},Us.prototype.isActive=function(){return this._active};var yl={0:1,2:2},Jr=function(n){this.reset(),this._clickTolerance=n.clickTolerance||1};Jr.prototype.reset=function(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton},Jr.prototype._correctButton=function(n,s){return!1},Jr.prototype._move=function(n,s){return{}},Jr.prototype.mousedown=function(n,s){if(!this._lastPoint){var a=F.mouseButton(n);this._correctButton(n,a)&&(this._lastPoint=s,this._eventButton=a)}},Jr.prototype.mousemoveWindow=function(n,s){var a=this._lastPoint;if(a){if(n.preventDefault(),function(h,g){var b=yl[g];return h.buttons===void 0||(h.buttons&b)!==b}(n,this._eventButton))this.reset();else if(this._moved||!(s.dist(a)<this._clickTolerance))return this._moved=!0,this._lastPoint=s,this._move(a,s)}},Jr.prototype.mouseupWindow=function(n){this._lastPoint&&F.mouseButton(n)===this._eventButton&&(this._moved&&F.suppressClick(),this.reset())},Jr.prototype.enable=function(){this._enabled=!0},Jr.prototype.disable=function(){this._enabled=!1,this.reset()},Jr.prototype.isEnabled=function(){return this._enabled},Jr.prototype.isActive=function(){return this._active};var Bc=function(n){function s(){n.apply(this,arguments)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype.mousedown=function(a,h){n.prototype.mousedown.call(this,a,h),this._lastPoint&&(this._active=!0)},s.prototype._correctButton=function(a,h){return h===0&&!a.ctrlKey},s.prototype._move=function(a,h){return{around:h,panDelta:h.sub(a)}},s}(Jr),pc=function(n){function s(){n.apply(this,arguments)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype._correctButton=function(a,h){return h===0&&a.ctrlKey||h===2},s.prototype._move=function(a,h){var g=.8*(h.x-a.x);if(g)return this._active=!0,{bearingDelta:g}},s.prototype.contextmenu=function(a){a.preventDefault()},s}(Jr),tl=function(n){function s(){n.apply(this,arguments)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype._correctButton=function(a,h){return h===0&&a.ctrlKey||h===2},s.prototype._move=function(a,h){var g=-.5*(h.y-a.y);if(g)return this._active=!0,{pitchDelta:g}},s.prototype.contextmenu=function(a){a.preventDefault()},s}(Jr),Js=function(n){this._minTouches=1,this._clickTolerance=n.clickTolerance||1,this.reset()};Js.prototype.reset=function(){this._active=!1,this._touches={},this._sum=new p.Point(0,0)},Js.prototype.touchstart=function(n,s,a){return this._calculateTransform(n,s,a)},Js.prototype.touchmove=function(n,s,a){if(this._active&&!(a.length<this._minTouches))return n.preventDefault(),this._calculateTransform(n,s,a)},Js.prototype.touchend=function(n,s,a){this._calculateTransform(n,s,a),this._active&&a.length<this._minTouches&&this.reset()},Js.prototype.touchcancel=function(){this.reset()},Js.prototype._calculateTransform=function(n,s,a){a.length>0&&(this._active=!0);var h=tc(a,s),g=new p.Point(0,0),b=new p.Point(0,0),T=0;for(var R in h){var V=h[R],te=this._touches[R];te&&(g._add(V),b._add(V.sub(te)),T++,h[R]=V)}if(this._touches=h,!(T<this._minTouches)&&b.mag()){var de=b.div(T);if(this._sum._add(de),!(this._sum.mag()<this._clickTolerance))return{around:g.div(T),panDelta:de}}},Js.prototype.enable=function(){this._enabled=!0},Js.prototype.disable=function(){this._enabled=!1,this.reset()},Js.prototype.isEnabled=function(){return this._enabled},Js.prototype.isActive=function(){return this._active};var Ss=function(){this.reset()};function dc(n,s,a){for(var h=0;h<n.length;h++)if(n[h].identifier===a)return s[h]}function vc(n,s){return Math.log(n/s)/Math.LN2}Ss.prototype.reset=function(){this._active=!1,delete this._firstTwoTouches},Ss.prototype._start=function(n){},Ss.prototype._move=function(n,s,a){return{}},Ss.prototype.touchstart=function(n,s,a){this._firstTwoTouches||a.length<2||(this._firstTwoTouches=[a[0].identifier,a[1].identifier],this._start([s[0],s[1]]))},Ss.prototype.touchmove=function(n,s,a){if(this._firstTwoTouches){n.preventDefault();var h=this._firstTwoTouches,g=h[1],b=dc(a,s,h[0]),T=dc(a,s,g);if(b&&T){var R=this._aroundCenter?null:b.add(T).div(2);return this._move([b,T],R,n)}}},Ss.prototype.touchend=function(n,s,a){if(this._firstTwoTouches){var h=this._firstTwoTouches,g=h[1],b=dc(a,s,h[0]),T=dc(a,s,g);b&&T||(this._active&&F.suppressClick(),this.reset())}},Ss.prototype.touchcancel=function(){this.reset()},Ss.prototype.enable=function(n){this._enabled=!0,this._aroundCenter=!!n&&n.around==="center"},Ss.prototype.disable=function(){this._enabled=!1,this.reset()},Ss.prototype.isEnabled=function(){return this._enabled},Ss.prototype.isActive=function(){return this._active};var Os=function(n){function s(){n.apply(this,arguments)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype.reset=function(){n.prototype.reset.call(this),delete this._distance,delete this._startDistance},s.prototype._start=function(a){this._startDistance=this._distance=a[0].dist(a[1])},s.prototype._move=function(a,h){var g=this._distance;if(this._distance=a[0].dist(a[1]),this._active||!(Math.abs(vc(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:vc(this._distance,g),pinchAround:h}},s}(Ss);function ju(n,s){return 180*n.angleWith(s)/Math.PI}var _l=function(n){function s(){n.apply(this,arguments)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype.reset=function(){n.prototype.reset.call(this),delete this._minDiameter,delete this._startVector,delete this._vector},s.prototype._start=function(a){this._startVector=this._vector=a[0].sub(a[1]),this._minDiameter=a[0].dist(a[1])},s.prototype._move=function(a,h){var g=this._vector;if(this._vector=a[0].sub(a[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:ju(this._vector,g),pinchAround:h}},s.prototype._isBelowThreshold=function(a){this._minDiameter=Math.min(this._minDiameter,a.mag());var h=25/(Math.PI*this._minDiameter)*360,g=ju(a,this._startVector);return Math.abs(g)<h},s}(Ss);function zl(n){return Math.abs(n.y)>Math.abs(n.x)}var ef=function(n){function s(){n.apply(this,arguments)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype.reset=function(){n.prototype.reset.call(this),this._valid=void 0,delete this._firstMove,delete this._lastPoints},s.prototype._start=function(a){this._lastPoints=a,zl(a[0].sub(a[1]))&&(this._valid=!1)},s.prototype._move=function(a,h,g){var b=a[0].sub(this._lastPoints[0]),T=a[1].sub(this._lastPoints[1]);if(this._valid=this.gestureBeginsVertically(b,T,g.timeStamp),this._valid)return this._lastPoints=a,this._active=!0,{pitchDelta:(b.y+T.y)/2*-.5}},s.prototype.gestureBeginsVertically=function(a,h,g){if(this._valid!==void 0)return this._valid;var b=a.mag()>=2,T=h.mag()>=2;if(b||T){if(!b||!T)return this._firstMove===void 0&&(this._firstMove=g),g-this._firstMove<100&&void 0;var R=a.y>0==h.y>0;return zl(a)&&zl(h)&&R}},s}(Ss),Uc={panStep:100,bearingStep:15,pitchStep:10},Eu=function(){var n=Uc;this._panStep=n.panStep,this._bearingStep=n.bearingStep,this._pitchStep=n.pitchStep,this._rotationDisabled=!1};function Qs(n){return n*(2-n)}Eu.prototype.reset=function(){this._active=!1},Eu.prototype.keydown=function(n){var s=this;if(!(n.altKey||n.ctrlKey||n.metaKey)){var a=0,h=0,g=0,b=0,T=0;switch(n.keyCode){case 61:case 107:case 171:case 187:a=1;break;case 189:case 109:case 173:a=-1;break;case 37:n.shiftKey?h=-1:(n.preventDefault(),b=-1);break;case 39:n.shiftKey?h=1:(n.preventDefault(),b=1);break;case 38:n.shiftKey?g=1:(n.preventDefault(),T=-1);break;case 40:n.shiftKey?g=-1:(n.preventDefault(),T=1);break;default:return}return this._rotationDisabled&&(h=0,g=0),{cameraAnimation:function(R){var V=R.getZoom();R.easeTo({duration:300,easeId:"keyboardHandler",easing:Qs,zoom:a?Math.round(V)+a*(n.shiftKey?2:1):V,bearing:R.getBearing()+h*s._bearingStep,pitch:R.getPitch()+g*s._pitchStep,offset:[-b*s._panStep,-T*s._panStep],center:R.getCenter()},{originalEvent:n})}}}},Eu.prototype.enable=function(){this._enabled=!0},Eu.prototype.disable=function(){this._enabled=!1,this.reset()},Eu.prototype.isEnabled=function(){return this._enabled},Eu.prototype.isActive=function(){return this._active},Eu.prototype.disableRotation=function(){this._rotationDisabled=!0},Eu.prototype.enableRotation=function(){this._rotationDisabled=!1};var Fi=function(n,s){this._map=n,this._el=n.getCanvasContainer(),this._handler=s,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=1/450,p.bindAll(["_onTimeout"],this)};Fi.prototype.setZoomRate=function(n){this._defaultZoomRate=n},Fi.prototype.setWheelZoomRate=function(n){this._wheelZoomRate=n},Fi.prototype.isEnabled=function(){return!!this._enabled},Fi.prototype.isActive=function(){return!!this._active||this._finishTimeout!==void 0},Fi.prototype.isZooming=function(){return!!this._zooming},Fi.prototype.enable=function(n){this.isEnabled()||(this._enabled=!0,this._aroundCenter=n&&n.around==="center")},Fi.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},Fi.prototype.wheel=function(n){if(this.isEnabled()){var s=n.deltaMode===p.window.WheelEvent.DOM_DELTA_LINE?40*n.deltaY:n.deltaY,a=p.browser.now(),h=a-(this._lastWheelEventTime||0);this._lastWheelEventTime=a,s!==0&&s%4.000244140625==0?this._type="wheel":s!==0&&Math.abs(s)<4?this._type="trackpad":h>400?(this._type=null,this._lastValue=s,this._timeout=setTimeout(this._onTimeout,40,n)):this._type||(this._type=Math.abs(h*s)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,s+=this._lastValue)),n.shiftKey&&s&&(s/=4),this._type&&(this._lastWheelEvent=n,this._delta-=s,this._active||this._start(n)),n.preventDefault()}},Fi.prototype._onTimeout=function(n){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(n)},Fi.prototype._start=function(n){if(this._delta){this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);var s=F.mousePos(this._el,n);this._around=p.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(s)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}},Fi.prototype.renderFrame=function(){var n=this;if(this._frameId&&(this._frameId=null,this.isActive())){var s=this._map.transform;if(this._delta!==0){var a=this._type==="wheel"&&Math.abs(this._delta)>4.000244140625?this._wheelZoomRate:this._defaultZoomRate,h=2/(1+Math.exp(-Math.abs(this._delta*a)));this._delta<0&&h!==0&&(h=1/h);var g=typeof this._targetZoom=="number"?s.zoomScale(this._targetZoom):s.scale;this._targetZoom=Math.min(s.maxZoom,Math.max(s.minZoom,s.scaleZoom(g*h))),this._type==="wheel"&&(this._startZoom=s.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}var b,T=typeof this._targetZoom=="number"?this._targetZoom:s.zoom,R=this._startZoom,V=this._easing,te=!1;if(this._type==="wheel"&&R&&V){var de=Math.min((p.browser.now()-this._lastWheelEventTime)/200,1),ye=V(de);b=p.number(R,T,ye),de<1?this._frameId||(this._frameId=!0):te=!0}else b=T,te=!0;return this._active=!0,te&&(this._active=!1,this._finishTimeout=setTimeout(function(){n._zooming=!1,n._handler._triggerRenderFrame(),delete n._targetZoom,delete n._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!te,zoomDelta:b-s.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}},Fi.prototype._smoothOutEasing=function(n){var s=p.ease;if(this._prevEase){var a=this._prevEase,h=(p.browser.now()-a.start)/a.duration,g=a.easing(h+.01)-a.easing(h),b=.27/Math.sqrt(g*g+1e-4)*.01,T=Math.sqrt(.0729-b*b);s=p.bezier(b,T,.25,1)}return this._prevEase={start:p.browser.now(),duration:n,easing:s},s},Fi.prototype.reset=function(){this._active=!1};var Zu=function(n,s){this._clickZoom=n,this._tapZoom=s};Zu.prototype.enable=function(){this._clickZoom.enable(),this._tapZoom.enable()},Zu.prototype.disable=function(){this._clickZoom.disable(),this._tapZoom.disable()},Zu.prototype.isEnabled=function(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()},Zu.prototype.isActive=function(){return this._clickZoom.isActive()||this._tapZoom.isActive()};var is=function(){this.reset()};is.prototype.reset=function(){this._active=!1},is.prototype.dblclick=function(n,s){return n.preventDefault(),{cameraAnimation:function(a){a.easeTo({duration:300,zoom:a.getZoom()+(n.shiftKey?-1:1),around:a.unproject(s)},{originalEvent:n})}}},is.prototype.enable=function(){this._enabled=!0},is.prototype.disable=function(){this._enabled=!1,this.reset()},is.prototype.isEnabled=function(){return this._enabled},is.prototype.isActive=function(){return this._active};var Mo=function(){this._tap=new $s({numTouches:1,numTaps:1}),this.reset()};Mo.prototype.reset=function(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()},Mo.prototype.touchstart=function(n,s,a){this._swipePoint||(this._tapTime&&n.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?a.length>0&&(this._swipePoint=s[0],this._swipeTouch=a[0].identifier):this._tap.touchstart(n,s,a))},Mo.prototype.touchmove=function(n,s,a){if(this._tapTime){if(this._swipePoint){if(a[0].identifier!==this._swipeTouch)return;var h=s[0],g=h.y-this._swipePoint.y;return this._swipePoint=h,n.preventDefault(),this._active=!0,{zoomDelta:g/128}}}else this._tap.touchmove(n,s,a)},Mo.prototype.touchend=function(n,s,a){this._tapTime?this._swipePoint&&a.length===0&&this.reset():this._tap.touchend(n,s,a)&&(this._tapTime=n.timeStamp)},Mo.prototype.touchcancel=function(){this.reset()},Mo.prototype.enable=function(){this._enabled=!0},Mo.prototype.disable=function(){this._enabled=!1,this.reset()},Mo.prototype.isEnabled=function(){return this._enabled},Mo.prototype.isActive=function(){return this._active};var xl=function(n,s,a){this._el=n,this._mousePan=s,this._touchPan=a};xl.prototype.enable=function(n){this._inertiaOptions=n||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")},xl.prototype.disable=function(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")},xl.prototype.isEnabled=function(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()},xl.prototype.isActive=function(){return this._mousePan.isActive()||this._touchPan.isActive()};var rl=function(n,s,a){this._pitchWithRotate=n.pitchWithRotate,this._mouseRotate=s,this._mousePitch=a};rl.prototype.enable=function(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()},rl.prototype.disable=function(){this._mouseRotate.disable(),this._mousePitch.disable()},rl.prototype.isEnabled=function(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())},rl.prototype.isActive=function(){return this._mouseRotate.isActive()||this._mousePitch.isActive()};var fu=function(n,s,a,h){this._el=n,this._touchZoom=s,this._touchRotate=a,this._tapDragZoom=h,this._rotationDisabled=!1,this._enabled=!0};fu.prototype.enable=function(n){this._touchZoom.enable(n),this._rotationDisabled||this._touchRotate.enable(n),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")},fu.prototype.disable=function(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")},fu.prototype.isEnabled=function(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()},fu.prototype.isActive=function(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()},fu.prototype.disableRotation=function(){this._rotationDisabled=!0,this._touchRotate.disable()},fu.prototype.enableRotation=function(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()};var vs=function(n){return n.zoom||n.drag||n.pitch||n.rotate},nl=function(n){function s(){n.apply(this,arguments)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s}(p.Event);function Un(n){return n.panDelta&&n.panDelta.mag()||n.zoomDelta||n.bearingDelta||n.pitchDelta}var Mn=function(n,s){this._map=n,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Fl(n),this._bearingSnap=s.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(s),p.bindAll(["handleEvent","handleWindowEvent"],this);var a=this._el;this._listeners=[[a,"touchstart",{passive:!0}],[a,"touchmove",{passive:!1}],[a,"touchend",void 0],[a,"touchcancel",void 0],[a,"mousedown",void 0],[a,"mousemove",void 0],[a,"mouseup",void 0],[p.window.document,"mousemove",{capture:!0}],[p.window.document,"mouseup",void 0],[a,"mouseover",void 0],[a,"mouseout",void 0],[a,"dblclick",void 0],[a,"click",void 0],[a,"keydown",{capture:!1}],[a,"keyup",void 0],[a,"wheel",{passive:!1}],[a,"contextmenu",void 0],[p.window,"blur",void 0]];for(var h=0,g=this._listeners;h<g.length;h+=1){var b=g[h],T=b[0];F.addEventListener(T,b[1],T===p.window.document?this.handleWindowEvent:this.handleEvent,b[2])}};Mn.prototype.destroy=function(){for(var n=0,s=this._listeners;n<s.length;n+=1){var a=s[n],h=a[0];F.removeEventListener(h,a[1],h===p.window.document?this.handleWindowEvent:this.handleEvent,a[2])}},Mn.prototype._addDefaultHandlers=function(n){var s=this._map,a=s.getCanvasContainer();this._add("mapEvent",new lo(s,n));var h=s.boxZoom=new Is(s,n);this._add("boxZoom",h);var g=new Us,b=new is;s.doubleClickZoom=new Zu(b,g),this._add("tapZoom",g),this._add("clickZoom",b);var T=new Mo;this._add("tapDragZoom",T);var R=s.touchPitch=new ef;this._add("touchPitch",R);var V=new pc(n),te=new tl(n);s.dragRotate=new rl(n,V,te),this._add("mouseRotate",V,["mousePitch"]),this._add("mousePitch",te,["mouseRotate"]);var de=new Bc(n),ye=new Js(n);s.dragPan=new xl(a,de,ye),this._add("mousePan",de),this._add("touchPan",ye,["touchZoom","touchRotate"]);var xe=new _l,He=new Os;s.touchZoomRotate=new fu(a,He,xe,T),this._add("touchRotate",xe,["touchPan","touchZoom"]),this._add("touchZoom",He,["touchPan","touchRotate"]);var Ze=s.scrollZoom=new Fi(s,this);this._add("scrollZoom",Ze,["mousePan"]);var nt=s.keyboard=new Eu;this._add("keyboard",nt),this._add("blockableMapEvent",new Tn(s));for(var ze=0,rt=["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"];ze<rt.length;ze+=1){var ht=rt[ze];n.interactive&&n[ht]&&s[ht].enable(n[ht])}},Mn.prototype._add=function(n,s,a){this._handlers.push({handlerName:n,handler:s,allowed:a}),this._handlersById[n]=s},Mn.prototype.stop=function(n){if(!this._updatingCamera){for(var s=0,a=this._handlers;s<a.length;s+=1)a[s].handler.reset();this._inertia.clear(),this._fireEvents({},{},n),this._changes=[]}},Mn.prototype.isActive=function(){for(var n=0,s=this._handlers;n<s.length;n+=1)if(s[n].handler.isActive())return!0;return!1},Mn.prototype.isZooming=function(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()},Mn.prototype.isRotating=function(){return!!this._eventsInProgress.rotate},Mn.prototype.isMoving=function(){return Boolean(vs(this._eventsInProgress))||this.isZooming()},Mn.prototype._blockedByActive=function(n,s,a){for(var h in n)if(h!==a&&(!s||s.indexOf(h)<0))return!0;return!1},Mn.prototype.handleWindowEvent=function(n){this.handleEvent(n,n.type+"Window")},Mn.prototype._getMapTouches=function(n){for(var s=[],a=0,h=n;a<h.length;a+=1){var g=h[a];this._el.contains(g.target)&&s.push(g)}return s},Mn.prototype.handleEvent=function(n,s){if(n.type!=="blur"){this._updatingCamera=!0;for(var a=n.type==="renderFrame"?void 0:n,h={needsRenderFrame:!1},g={},b={},T=n.touches?this._getMapTouches(n.touches):void 0,R=T?F.touchPos(this._el,T):F.mousePos(this._el,n),V=0,te=this._handlers;V<te.length;V+=1){var de=te[V],ye=de.handlerName,xe=de.handler,He=de.allowed;if(xe.isEnabled()){var Ze=void 0;this._blockedByActive(b,He,ye)?xe.reset():xe[s||n.type]&&(Ze=xe[s||n.type](n,R,T),this.mergeHandlerResult(h,g,Ze,ye,a),Ze&&Ze.needsRenderFrame&&this._triggerRenderFrame()),(Ze||xe.isActive())&&(b[ye]=xe)}}var nt={};for(var ze in this._previousActiveHandlers)b[ze]||(nt[ze]=a);this._previousActiveHandlers=b,(Object.keys(nt).length||Un(h))&&(this._changes.push([h,g,nt]),this._triggerRenderFrame()),(Object.keys(b).length||Un(h))&&this._map._stop(!0),this._updatingCamera=!1;var rt=h.cameraAnimation;rt&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],rt(this._map))}else this.stop(!0)},Mn.prototype.mergeHandlerResult=function(n,s,a,h,g){if(a){p.extend(n,a);var b={handlerName:h,originalEvent:a.originalEvent||g};a.zoomDelta!==void 0&&(s.zoom=b),a.panDelta!==void 0&&(s.drag=b),a.pitchDelta!==void 0&&(s.pitch=b),a.bearingDelta!==void 0&&(s.rotate=b)}},Mn.prototype._applyChanges=function(){for(var n={},s={},a={},h=0,g=this._changes;h<g.length;h+=1){var b=g[h],T=b[0],R=b[1],V=b[2];T.panDelta&&(n.panDelta=(n.panDelta||new p.Point(0,0))._add(T.panDelta)),T.zoomDelta&&(n.zoomDelta=(n.zoomDelta||0)+T.zoomDelta),T.bearingDelta&&(n.bearingDelta=(n.bearingDelta||0)+T.bearingDelta),T.pitchDelta&&(n.pitchDelta=(n.pitchDelta||0)+T.pitchDelta),T.around!==void 0&&(n.around=T.around),T.pinchAround!==void 0&&(n.pinchAround=T.pinchAround),T.noInertia&&(n.noInertia=T.noInertia),p.extend(s,R),p.extend(a,V)}this._updateMapTransform(n,s,a),this._changes=[]},Mn.prototype._updateMapTransform=function(n,s,a){var h=this._map,g=h.transform;if(!Un(n))return this._fireEvents(s,a,!0);var b=n.panDelta,T=n.zoomDelta,R=n.bearingDelta,V=n.pitchDelta,te=n.around,de=n.pinchAround;de!==void 0&&(te=de),h._stop(!0),te=te||h.transform.centerPoint;var ye=g.pointLocation(b?te.sub(b):te);R&&(g.bearing+=R),V&&(g.pitch+=V),T&&(g.zoom+=T),g.setLocationAtPoint(ye,te),this._map._update(),n.noInertia||this._inertia.record(n),this._fireEvents(s,a,!0)},Mn.prototype._fireEvents=function(n,s,a){var h=this,g=vs(this._eventsInProgress),b=vs(n),T={};for(var R in n)this._eventsInProgress[R]||(T[R+"start"]=n[R].originalEvent),this._eventsInProgress[R]=n[R];for(var V in!g&&b&&this._fireEvent("movestart",b.originalEvent),T)this._fireEvent(V,T[V]);for(var te in b&&this._fireEvent("move",b.originalEvent),n)this._fireEvent(te,n[te].originalEvent);var de,ye={};for(var xe in this._eventsInProgress){var He=this._eventsInProgress[xe],Ze=He.handlerName,nt=He.originalEvent;this._handlersById[Ze].isActive()||(delete this._eventsInProgress[xe],ye[xe+"end"]=de=s[Ze]||nt)}for(var ze in ye)this._fireEvent(ze,ye[ze]);var rt=vs(this._eventsInProgress);if(a&&(g||b)&&!rt){this._updatingCamera=!0;var ht=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),Nt=function(or){return or!==0&&-h._bearingSnap<or&&or<h._bearingSnap};ht?(Nt(ht.bearing||this._map.getBearing())&&(ht.bearing=0),this._map.easeTo(ht,{originalEvent:de})):(this._map.fire(new p.Event("moveend",{originalEvent:de})),Nt(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}},Mn.prototype._fireEvent=function(n,s){this._map.fire(new p.Event(n,s?{originalEvent:s}:{}))},Mn.prototype._requestFrame=function(){var n=this;return this._map.triggerRepaint(),this._map._renderTaskQueue.add(function(s){delete n._frameId,n.handleEvent(new nl("renderFrame",{timeStamp:s})),n._applyChanges()})},Mn.prototype._triggerRenderFrame=function(){this._frameId===void 0&&(this._frameId=this._requestFrame())};var rc=function(n){function s(a,h){n.call(this),this._moving=!1,this._zooming=!1,this.transform=a,this._bearingSnap=h.bearingSnap,p.bindAll(["_renderFrameCallback"],this)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype.getCenter=function(){return new p.LngLat(this.transform.center.lng,this.transform.center.lat)},s.prototype.setCenter=function(a,h){return this.jumpTo({center:a},h)},s.prototype.panBy=function(a,h,g){return a=p.Point.convert(a).mult(-1),this.panTo(this.transform.center,p.extend({offset:a},h),g)},s.prototype.panTo=function(a,h,g){return this.easeTo(p.extend({center:a},h),g)},s.prototype.getZoom=function(){return this.transform.zoom},s.prototype.setZoom=function(a,h){return this.jumpTo({zoom:a},h),this},s.prototype.zoomTo=function(a,h,g){return this.easeTo(p.extend({zoom:a},h),g)},s.prototype.zoomIn=function(a,h){return this.zoomTo(this.getZoom()+1,a,h),this},s.prototype.zoomOut=function(a,h){return this.zoomTo(this.getZoom()-1,a,h),this},s.prototype.getBearing=function(){return this.transform.bearing},s.prototype.setBearing=function(a,h){return this.jumpTo({bearing:a},h),this},s.prototype.getPadding=function(){return this.transform.padding},s.prototype.setPadding=function(a,h){return this.jumpTo({padding:a},h),this},s.prototype.rotateTo=function(a,h,g){return this.easeTo(p.extend({bearing:a},h),g)},s.prototype.resetNorth=function(a,h){return this.rotateTo(0,p.extend({duration:1e3},a),h),this},s.prototype.resetNorthPitch=function(a,h){return this.easeTo(p.extend({bearing:0,pitch:0,duration:1e3},a),h),this},s.prototype.snapToNorth=function(a,h){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(a,h):this},s.prototype.getPitch=function(){return this.transform.pitch},s.prototype.setPitch=function(a,h){return this.jumpTo({pitch:a},h),this},s.prototype.cameraForBounds=function(a,h){a=p.LngLatBounds.convert(a);var g=h&&h.bearing||0;return this._cameraForBoxAndBearing(a.getNorthWest(),a.getSouthEast(),g,h)},s.prototype._cameraForBoxAndBearing=function(a,h,g,b){var T={top:0,bottom:0,right:0,left:0};if(typeof(b=p.extend({padding:T,offset:[0,0],maxZoom:this.transform.maxZoom},b)).padding=="number"){var R=b.padding;b.padding={top:R,bottom:R,right:R,left:R}}b.padding=p.extend(T,b.padding);var V=this.transform,te=V.padding,de=V.project(p.LngLat.convert(a)),ye=V.project(p.LngLat.convert(h)),xe=de.rotate(-g*Math.PI/180),He=ye.rotate(-g*Math.PI/180),Ze=new p.Point(Math.max(xe.x,He.x),Math.max(xe.y,He.y)),nt=new p.Point(Math.min(xe.x,He.x),Math.min(xe.y,He.y)),ze=Ze.sub(nt),rt=(V.width-(te.left+te.right+b.padding.left+b.padding.right))/ze.x,ht=(V.height-(te.top+te.bottom+b.padding.top+b.padding.bottom))/ze.y;if(!(ht<0||rt<0)){var Nt=Math.min(V.scaleZoom(V.scale*Math.min(rt,ht)),b.maxZoom),or=typeof b.offset.x=="number"?new p.Point(b.offset.x,b.offset.y):p.Point.convert(b.offset),rr=new p.Point((b.padding.left-b.padding.right)/2,(b.padding.top-b.padding.bottom)/2).rotate(g*Math.PI/180),sr=or.add(rr).mult(V.scale/V.zoomScale(Nt));return{center:V.unproject(de.add(ye).div(2).sub(sr)),zoom:Nt,bearing:g}}p.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")},s.prototype.fitBounds=function(a,h,g){return this._fitInternal(this.cameraForBounds(a,h),h,g)},s.prototype.fitScreenCoordinates=function(a,h,g,b,T){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(p.Point.convert(a)),this.transform.pointLocation(p.Point.convert(h)),g,b),b,T)},s.prototype._fitInternal=function(a,h,g){return a?(delete(h=p.extend(a,h)).padding,h.linear?this.easeTo(h,g):this.flyTo(h,g)):this},s.prototype.jumpTo=function(a,h){this.stop();var g=this.transform,b=!1,T=!1,R=!1;return"zoom"in a&&g.zoom!==+a.zoom&&(b=!0,g.zoom=+a.zoom),a.center!==void 0&&(g.center=p.LngLat.convert(a.center)),"bearing"in a&&g.bearing!==+a.bearing&&(T=!0,g.bearing=+a.bearing),"pitch"in a&&g.pitch!==+a.pitch&&(R=!0,g.pitch=+a.pitch),a.padding==null||g.isPaddingEqual(a.padding)||(g.padding=a.padding),this.fire(new p.Event("movestart",h)).fire(new p.Event("move",h)),b&&this.fire(new p.Event("zoomstart",h)).fire(new p.Event("zoom",h)).fire(new p.Event("zoomend",h)),T&&this.fire(new p.Event("rotatestart",h)).fire(new p.Event("rotate",h)).fire(new p.Event("rotateend",h)),R&&this.fire(new p.Event("pitchstart",h)).fire(new p.Event("pitch",h)).fire(new p.Event("pitchend",h)),this.fire(new p.Event("moveend",h))},s.prototype.easeTo=function(a,h){var g=this;this._stop(!1,a.easeId),((a=p.extend({offset:[0,0],duration:500,easing:p.ease},a)).animate===!1||!a.essential&&p.browser.prefersReducedMotion)&&(a.duration=0);var b=this.transform,T=this.getZoom(),R=this.getBearing(),V=this.getPitch(),te=this.getPadding(),de="zoom"in a?+a.zoom:T,ye="bearing"in a?this._normalizeBearing(a.bearing,R):R,xe="pitch"in a?+a.pitch:V,He="padding"in a?a.padding:b.padding,Ze=p.Point.convert(a.offset),nt=b.centerPoint.add(Ze),ze=b.pointLocation(nt),rt=p.LngLat.convert(a.center||ze);this._normalizeCenter(rt);var ht,Nt,or=b.project(ze),rr=b.project(rt).sub(or),sr=b.zoomScale(de-T);a.around&&(ht=p.LngLat.convert(a.around),Nt=b.locationPoint(ht));var Lr={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||de!==T,this._rotating=this._rotating||R!==ye,this._pitching=this._pitching||xe!==V,this._padding=!b.isPaddingEqual(He),this._easeId=a.easeId,this._prepareEase(h,a.noMoveStart,Lr),this._ease(function(rn){if(g._zooming&&(b.zoom=p.number(T,de,rn)),g._rotating&&(b.bearing=p.number(R,ye,rn)),g._pitching&&(b.pitch=p.number(V,xe,rn)),g._padding&&(b.interpolatePadding(te,He,rn),nt=b.centerPoint.add(Ze)),ht)b.setLocationAtPoint(ht,Nt);else{var Qr=b.zoomScale(b.zoom-T),xn=de>T?Math.min(2,sr):Math.max(.5,sr),jn=Math.pow(xn,1-rn),Xn=b.unproject(or.add(rr.mult(rn*jn)).mult(Qr));b.setLocationAtPoint(b.renderWorldCopies?Xn.wrap():Xn,nt)}g._fireMoveEvents(h)},function(rn){g._afterEase(h,rn)},a),this},s.prototype._prepareEase=function(a,h,g){g===void 0&&(g={}),this._moving=!0,h||g.moving||this.fire(new p.Event("movestart",a)),this._zooming&&!g.zooming&&this.fire(new p.Event("zoomstart",a)),this._rotating&&!g.rotating&&this.fire(new p.Event("rotatestart",a)),this._pitching&&!g.pitching&&this.fire(new p.Event("pitchstart",a))},s.prototype._fireMoveEvents=function(a){this.fire(new p.Event("move",a)),this._zooming&&this.fire(new p.Event("zoom",a)),this._rotating&&this.fire(new p.Event("rotate",a)),this._pitching&&this.fire(new p.Event("pitch",a))},s.prototype._afterEase=function(a,h){if(!this._easeId||!h||this._easeId!==h){delete this._easeId;var g=this._zooming,b=this._rotating,T=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,g&&this.fire(new p.Event("zoomend",a)),b&&this.fire(new p.Event("rotateend",a)),T&&this.fire(new p.Event("pitchend",a)),this.fire(new p.Event("moveend",a))}},s.prototype.flyTo=function(a,h){var g=this;if(!a.essential&&p.browser.prefersReducedMotion){var b=p.pick(a,["center","zoom","bearing","pitch","around"]);return this.jumpTo(b,h)}this.stop(),a=p.extend({offset:[0,0],speed:1.2,curve:1.42,easing:p.ease},a);var T=this.transform,R=this.getZoom(),V=this.getBearing(),te=this.getPitch(),de=this.getPadding(),ye="zoom"in a?p.clamp(+a.zoom,T.minZoom,T.maxZoom):R,xe="bearing"in a?this._normalizeBearing(a.bearing,V):V,He="pitch"in a?+a.pitch:te,Ze="padding"in a?a.padding:T.padding,nt=T.zoomScale(ye-R),ze=p.Point.convert(a.offset),rt=T.centerPoint.add(ze),ht=T.pointLocation(rt),Nt=p.LngLat.convert(a.center||ht);this._normalizeCenter(Nt);var or=T.project(ht),rr=T.project(Nt).sub(or),sr=a.curve,Lr=Math.max(T.width,T.height),rn=Lr/nt,Qr=rr.mag();if("minZoom"in a){var xn=p.clamp(Math.min(a.minZoom,R,ye),T.minZoom,T.maxZoom),jn=Lr/T.zoomScale(xn-R);sr=Math.sqrt(jn/Qr*2)}var Xn=sr*sr;function Wn(ri){var Qn=(rn*rn-Lr*Lr+(ri?-1:1)*Xn*Xn*Qr*Qr)/(2*(ri?rn:Lr)*Xn*Qr);return Math.log(Math.sqrt(Qn*Qn+1)-Qn)}function $i(ri){return(Math.exp(ri)-Math.exp(-ri))/2}function Sn(ri){return(Math.exp(ri)+Math.exp(-ri))/2}var oi=Wn(0),Si=function(ri){return Sn(oi)/Sn(oi+sr*ri)},ai=function(ri){return Lr*((Sn(oi)*($i(Qn=oi+sr*ri)/Sn(Qn))-$i(oi))/Xn)/Qr;var Qn},ii=(Wn(1)-oi)/sr;if(Math.abs(Qr)<1e-6||!isFinite(ii)){if(Math.abs(Lr-rn)<1e-6)return this.easeTo(a,h);var Ei=rn<Lr?-1:1;ii=Math.abs(Math.log(rn/Lr))/sr,ai=function(){return 0},Si=function(ri){return Math.exp(Ei*sr*ri)}}return a.duration="duration"in a?+a.duration:1e3*ii/("screenSpeed"in a?+a.screenSpeed/sr:+a.speed),a.maxDuration&&a.duration>a.maxDuration&&(a.duration=0),this._zooming=!0,this._rotating=V!==xe,this._pitching=He!==te,this._padding=!T.isPaddingEqual(Ze),this._prepareEase(h,!1),this._ease(function(ri){var Qn=ri*ii,mo=1/Si(Qn);T.zoom=ri===1?ye:R+T.scaleZoom(mo),g._rotating&&(T.bearing=p.number(V,xe,ri)),g._pitching&&(T.pitch=p.number(te,He,ri)),g._padding&&(T.interpolatePadding(de,Ze,ri),rt=T.centerPoint.add(ze));var Ja=ri===1?Nt:T.unproject(or.add(rr.mult(ai(Qn))).mult(mo));T.setLocationAtPoint(T.renderWorldCopies?Ja.wrap():Ja,rt),g._fireMoveEvents(h)},function(){return g._afterEase(h)},a),this},s.prototype.isEasing=function(){return!!this._easeFrameId},s.prototype.stop=function(){return this._stop()},s.prototype._stop=function(a,h){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){var g=this._onEaseEnd;delete this._onEaseEnd,g.call(this,h)}if(!a){var b=this.handlers;b&&b.stop(!1)}return this},s.prototype._ease=function(a,h,g){g.animate===!1||g.duration===0?(a(1),h()):(this._easeStart=p.browser.now(),this._easeOptions=g,this._onEaseFrame=a,this._onEaseEnd=h,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))},s.prototype._renderFrameCallback=function(){var a=Math.min((p.browser.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(a)),a<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},s.prototype._normalizeBearing=function(a,h){a=p.wrap(a,-180,180);var g=Math.abs(a-h);return Math.abs(a-360-h)<g&&(a-=360),Math.abs(a+360-h)<g&&(a+=360),a},s.prototype._normalizeCenter=function(a){var h=this.transform;if(h.renderWorldCopies&&!h.lngRange){var g=a.lng-h.center.lng;a.lng+=g>180?-360:g<-180?360:0}},s}(p.Evented),as=function(n){n===void 0&&(n={}),this.options=n,p.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)};as.prototype.getDefaultPosition=function(){return"bottom-right"},as.prototype.onAdd=function(n){var s=this.options&&this.options.compact;return this._map=n,this._container=F.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=F.create("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=F.create("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),s&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),s===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container},as.prototype.onRemove=function(){F.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0},as.prototype._setElementTitle=function(n,s){var a=this._map._getUIString("AttributionControl."+s);n.title=a,n.setAttribute("aria-label",a)},as.prototype._toggleAttribution=function(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","true"))},as.prototype._updateEditLink=function(){var n=this._editLink;n||(n=this._editLink=this._container.querySelector(".mapbox-improve-map"));var s=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||p.config.ACCESS_TOKEN}];if(n){var a=s.reduce(function(h,g,b){return g.value&&(h+=g.key+"="+g.value+(b<s.length-1?"&":"")),h},"?");n.href=p.config.FEEDBACK_URL+"/"+a+(this._map._hash?this._map._hash.getHashString(!0):""),n.rel="noopener nofollow",this._setElementTitle(n,"MapFeedback")}},as.prototype._updateData=function(n){!n||n.sourceDataType!=="metadata"&&n.sourceDataType!=="visibility"&&n.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())},as.prototype._updateAttributions=function(){if(this._map.style){var n=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?n=n.concat(this.options.customAttribution.map(function(R){return typeof R!="string"?"":R})):typeof this.options.customAttribution=="string"&&n.push(this.options.customAttribution)),this._map.style.stylesheet){var s=this._map.style.stylesheet;this.styleOwner=s.owner,this.styleId=s.id}var a=this._map.style.sourceCaches;for(var h in a){var g=a[h];if(g.used){var b=g.getSource();b.attribution&&n.indexOf(b.attribution)<0&&n.push(b.attribution)}}n.sort(function(R,V){return R.length-V.length});var T=(n=n.filter(function(R,V){for(var te=V+1;te<n.length;te++)if(n[te].indexOf(R)>=0)return!1;return!0})).join(" | ");T!==this._attribHTML&&(this._attribHTML=T,n.length?(this._innerContainer.innerHTML=T,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}},as.prototype._updateCompact=function(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")};var vo=function(){p.bindAll(["_updateLogo"],this),p.bindAll(["_updateCompact"],this)};vo.prototype.onAdd=function(n){this._map=n,this._container=F.create("div","mapboxgl-ctrl");var s=F.create("a","mapboxgl-ctrl-logo");return s.target="_blank",s.rel="noopener nofollow",s.href="https://www.mapbox.com/",s.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),s.setAttribute("rel","noopener nofollow"),this._container.appendChild(s),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container},vo.prototype.onRemove=function(){F.remove(this._container),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)},vo.prototype.getDefaultPosition=function(){return"bottom-left"},vo.prototype._updateLogo=function(n){n&&n.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")},vo.prototype._logoRequired=function(){if(this._map.style){var n=this._map.style.sourceCaches;for(var s in n)if(n[s].getSource().mapbox_logo)return!0;return!1}},vo.prototype._updateCompact=function(){var n=this._container.children;if(n.length){var s=n[0];this._map.getCanvasContainer().offsetWidth<250?s.classList.add("mapboxgl-compact"):s.classList.remove("mapboxgl-compact")}};var ko=function(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1};ko.prototype.add=function(n){var s=++this._id;return this._queue.push({callback:n,id:s,cancelled:!1}),s},ko.prototype.remove=function(n){for(var s=this._currentlyRunning,a=0,h=s?this._queue.concat(s):this._queue;a<h.length;a+=1){var g=h[a];if(g.id===n)return void(g.cancelled=!0)}},ko.prototype.run=function(n){n===void 0&&(n=0);var s=this._currentlyRunning=this._queue;this._queue=[];for(var a=0,h=s;a<h.length;a+=1){var g=h[a];if(!g.cancelled&&(g.callback(n),this._cleared))break}this._cleared=!1,this._currentlyRunning=!1},ko.prototype.clear=function(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]};var hu={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm"},js=p.window.HTMLImageElement,Nl=p.window.HTMLElement,Ki=p.window.ImageBitmap,So={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0},tf=function(n){function s(h){var g=this;if((h=p.extend({},So,h)).minZoom!=null&&h.maxZoom!=null&&h.minZoom>h.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(h.minPitch!=null&&h.maxPitch!=null&&h.minPitch>h.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(h.minPitch!=null&&h.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(h.maxPitch!=null&&h.maxPitch>60)throw new Error("maxPitch must be less than or equal to 60");var b=new Ni(h.minZoom,h.maxZoom,h.minPitch,h.maxPitch,h.renderWorldCopies);if(n.call(this,b,h),this._interactive=h.interactive,this._maxTileCacheSize=h.maxTileCacheSize,this._failIfMajorPerformanceCaveat=h.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=h.preserveDrawingBuffer,this._antialias=h.antialias,this._trackResize=h.trackResize,this._bearingSnap=h.bearingSnap,this._refreshExpiredTiles=h.refreshExpiredTiles,this._fadeDuration=h.fadeDuration,this._crossSourceCollisions=h.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=h.collectResourceTiming,this._renderTaskQueue=new ko,this._controls=[],this._mapId=p.uniqueId(),this._locale=p.extend({},hu,h.locale),this._clickTolerance=h.clickTolerance,this._requestManager=new p.RequestManager(h.transformRequest,h.accessToken),typeof h.container=="string"){if(this._container=p.window.document.getElementById(h.container),!this._container)throw new Error("Container '"+h.container+"' not found.")}else{if(!(h.container instanceof Nl))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=h.container}if(h.maxBounds&&this.setMaxBounds(h.maxBounds),p.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",function(){return g._update(!1)}),this.on("moveend",function(){return g._update(!1)}),this.on("zoom",function(){return g._update(!0)}),p.window!==void 0&&(p.window.addEventListener("online",this._onWindowOnline,!1),p.window.addEventListener("resize",this._onWindowResize,!1),p.window.addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new Mn(this,h),this._hash=h.hash&&new Ma(typeof h.hash=="string"&&h.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:h.center,zoom:h.zoom,bearing:h.bearing,pitch:h.pitch}),h.bounds&&(this.resize(),this.fitBounds(h.bounds,p.extend({},h.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=h.localIdeographFontFamily,h.style&&this.setStyle(h.style,{localIdeographFontFamily:h.localIdeographFontFamily}),h.attributionControl&&this.addControl(new as({customAttribution:h.customAttribution})),this.addControl(new vo,h.logoPosition),this.on("style.load",function(){g.transform.unmodified&&g.jumpTo(g.style.stylesheet)}),this.on("data",function(T){g._update(T.dataType==="style"),g.fire(new p.Event(T.dataType+"data",T))}),this.on("dataloading",function(T){g.fire(new p.Event(T.dataType+"dataloading",T))})}n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s;var a={showTileBoundaries:{configurable:!0},showPadding:{configurable:!0},showCollisionBoxes:{configurable:!0},showOverdrawInspector:{configurable:!0},repaint:{configurable:!0},vertices:{configurable:!0},version:{configurable:!0}};return s.prototype._getMapId=function(){return this._mapId},s.prototype.addControl=function(h,g){if(g===void 0&&(g=h.getDefaultPosition?h.getDefaultPosition():"top-right"),!h||!h.onAdd)return this.fire(new p.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));var b=h.onAdd(this);this._controls.push(h);var T=this._controlPositions[g];return g.indexOf("bottom")!==-1?T.insertBefore(b,T.firstChild):T.appendChild(b),this},s.prototype.removeControl=function(h){if(!h||!h.onRemove)return this.fire(new p.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));var g=this._controls.indexOf(h);return g>-1&&this._controls.splice(g,1),h.onRemove(this),this},s.prototype.hasControl=function(h){return this._controls.indexOf(h)>-1},s.prototype.resize=function(h){var g=this._containerDimensions(),b=g[0],T=g[1];this._resizeCanvas(b,T),this.transform.resize(b,T),this.painter.resize(b,T);var R=!this._moving;return R&&(this.stop(),this.fire(new p.Event("movestart",h)).fire(new p.Event("move",h))),this.fire(new p.Event("resize",h)),R&&this.fire(new p.Event("moveend",h)),this},s.prototype.getBounds=function(){return this.transform.getBounds()},s.prototype.getMaxBounds=function(){return this.transform.getMaxBounds()},s.prototype.setMaxBounds=function(h){return this.transform.setMaxBounds(p.LngLatBounds.convert(h)),this._update()},s.prototype.setMinZoom=function(h){if((h=h==null?-2:h)>=-2&&h<=this.transform.maxZoom)return this.transform.minZoom=h,this._update(),this.getZoom()<h&&this.setZoom(h),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")},s.prototype.getMinZoom=function(){return this.transform.minZoom},s.prototype.setMaxZoom=function(h){if((h=h==null?22:h)>=this.transform.minZoom)return this.transform.maxZoom=h,this._update(),this.getZoom()>h&&this.setZoom(h),this;throw new Error("maxZoom must be greater than the current minZoom")},s.prototype.getMaxZoom=function(){return this.transform.maxZoom},s.prototype.setMinPitch=function(h){if((h=h==null?0:h)<0)throw new Error("minPitch must be greater than or equal to 0");if(h>=0&&h<=this.transform.maxPitch)return this.transform.minPitch=h,this._update(),this.getPitch()<h&&this.setPitch(h),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")},s.prototype.getMinPitch=function(){return this.transform.minPitch},s.prototype.setMaxPitch=function(h){if((h=h==null?60:h)>60)throw new Error("maxPitch must be less than or equal to 60");if(h>=this.transform.minPitch)return this.transform.maxPitch=h,this._update(),this.getPitch()>h&&this.setPitch(h),this;throw new Error("maxPitch must be greater than the current minPitch")},s.prototype.getMaxPitch=function(){return this.transform.maxPitch},s.prototype.getRenderWorldCopies=function(){return this.transform.renderWorldCopies},s.prototype.setRenderWorldCopies=function(h){return this.transform.renderWorldCopies=h,this._update()},s.prototype.project=function(h){return this.transform.locationPoint(p.LngLat.convert(h))},s.prototype.unproject=function(h){return this.transform.pointLocation(p.Point.convert(h))},s.prototype.isMoving=function(){return this._moving||this.handlers.isMoving()},s.prototype.isZooming=function(){return this._zooming||this.handlers.isZooming()},s.prototype.isRotating=function(){return this._rotating||this.handlers.isRotating()},s.prototype._createDelegatedListener=function(h,g,b){var T,R=this;if(h==="mouseenter"||h==="mouseover"){var V=!1;return{layer:g,listener:b,delegates:{mousemove:function(de){var ye=R.getLayer(g)?R.queryRenderedFeatures(de.point,{layers:[g]}):[];ye.length?V||(V=!0,b.call(R,new to(h,R,de.originalEvent,{features:ye}))):V=!1},mouseout:function(){V=!1}}}}if(h==="mouseleave"||h==="mouseout"){var te=!1;return{layer:g,listener:b,delegates:{mousemove:function(de){(R.getLayer(g)?R.queryRenderedFeatures(de.point,{layers:[g]}):[]).length?te=!0:te&&(te=!1,b.call(R,new to(h,R,de.originalEvent)))},mouseout:function(de){te&&(te=!1,b.call(R,new to(h,R,de.originalEvent)))}}}}return{layer:g,listener:b,delegates:(T={},T[h]=function(de){var ye=R.getLayer(g)?R.queryRenderedFeatures(de.point,{layers:[g]}):[];ye.length&&(de.features=ye,b.call(R,de),delete de.features)},T)}},s.prototype.on=function(h,g,b){if(b===void 0)return n.prototype.on.call(this,h,g);var T=this._createDelegatedListener(h,g,b);for(var R in this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[h]=this._delegatedListeners[h]||[],this._delegatedListeners[h].push(T),T.delegates)this.on(R,T.delegates[R]);return this},s.prototype.once=function(h,g,b){if(b===void 0)return n.prototype.once.call(this,h,g);var T=this._createDelegatedListener(h,g,b);for(var R in T.delegates)this.once(R,T.delegates[R]);return this},s.prototype.off=function(h,g,b){var T=this;return b===void 0?n.prototype.off.call(this,h,g):(this._delegatedListeners&&this._delegatedListeners[h]&&function(R){for(var V=R[h],te=0;te<V.length;te++){var de=V[te];if(de.layer===g&&de.listener===b){for(var ye in de.delegates)T.off(ye,de.delegates[ye]);return V.splice(te,1),T}}}(this._delegatedListeners),this)},s.prototype.queryRenderedFeatures=function(h,g){if(!this.style)return[];var b;if(g!==void 0||h===void 0||h instanceof p.Point||Array.isArray(h)||(g=h,h=void 0),g=g||{},(h=h||[[0,0],[this.transform.width,this.transform.height]])instanceof p.Point||typeof h[0]=="number")b=[p.Point.convert(h)];else{var T=p.Point.convert(h[0]),R=p.Point.convert(h[1]);b=[T,new p.Point(R.x,T.y),R,new p.Point(T.x,R.y),T]}return this.style.queryRenderedFeatures(b,g,this.transform)},s.prototype.querySourceFeatures=function(h,g){return this.style.querySourceFeatures(h,g)},s.prototype.setStyle=function(h,g){return(g=p.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},g)).diff!==!1&&g.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&h?(this._diffStyle(h,g),this):(this._localIdeographFontFamily=g.localIdeographFontFamily,this._updateStyle(h,g))},s.prototype._getUIString=function(h){var g=this._locale[h];if(g==null)throw new Error("Missing UI string '"+h+"'");return g},s.prototype._updateStyle=function(h,g){return this.style&&(this.style.setEventedParent(null),this.style._remove()),h?(this.style=new ba(this,g||{}),this.style.setEventedParent(this,{style:this.style}),typeof h=="string"?this.style.loadURL(h):this.style.loadJSON(h),this):(delete this.style,this)},s.prototype._lazyInitEmptyStyle=function(){this.style||(this.style=new ba(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())},s.prototype._diffStyle=function(h,g){var b=this;if(typeof h=="string"){var T=this._requestManager.normalizeStyleURL(h),R=this._requestManager.transformRequest(T,p.ResourceType.Style);p.getJSON(R,function(V,te){V?b.fire(new p.ErrorEvent(V)):te&&b._updateDiff(te,g)})}else typeof h=="object"&&this._updateDiff(h,g)},s.prototype._updateDiff=function(h,g){try{this.style.setState(h)&&this._update(!0)}catch(b){p.warnOnce("Unable to perform style diff: "+(b.message||b.error||b)+".  Rebuilding the style from scratch."),this._updateStyle(h,g)}},s.prototype.getStyle=function(){if(this.style)return this.style.serialize()},s.prototype.isStyleLoaded=function(){return this.style?this.style.loaded():p.warnOnce("There is no style added to the map.")},s.prototype.addSource=function(h,g){return this._lazyInitEmptyStyle(),this.style.addSource(h,g),this._update(!0)},s.prototype.isSourceLoaded=function(h){var g=this.style&&this.style.sourceCaches[h];if(g!==void 0)return g.loaded();this.fire(new p.ErrorEvent(new Error("There is no source with ID '"+h+"'")))},s.prototype.areTilesLoaded=function(){var h=this.style&&this.style.sourceCaches;for(var g in h){var b=h[g]._tiles;for(var T in b){var R=b[T];if(R.state!=="loaded"&&R.state!=="errored")return!1}}return!0},s.prototype.addSourceType=function(h,g,b){return this._lazyInitEmptyStyle(),this.style.addSourceType(h,g,b)},s.prototype.removeSource=function(h){return this.style.removeSource(h),this._update(!0)},s.prototype.getSource=function(h){return this.style.getSource(h)},s.prototype.addImage=function(h,g,b){b===void 0&&(b={});var T=b.pixelRatio;T===void 0&&(T=1);var R=b.sdf;R===void 0&&(R=!1);var V=b.stretchX,te=b.stretchY,de=b.content;if(this._lazyInitEmptyStyle(),g instanceof js||Ki&&g instanceof Ki){var ye=p.browser.getImageData(g);this.style.addImage(h,{data:new p.RGBAImage({width:ye.width,height:ye.height},ye.data),pixelRatio:T,stretchX:V,stretchY:te,content:de,sdf:R,version:0})}else{if(g.width===void 0||g.height===void 0)return this.fire(new p.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));var xe=g;this.style.addImage(h,{data:new p.RGBAImage({width:g.width,height:g.height},new Uint8Array(g.data)),pixelRatio:T,stretchX:V,stretchY:te,content:de,sdf:R,version:0,userImage:xe}),xe.onAdd&&xe.onAdd(this,h)}},s.prototype.updateImage=function(h,g){var b=this.style.getImage(h);if(!b)return this.fire(new p.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));var T=g instanceof js||Ki&&g instanceof Ki?p.browser.getImageData(g):g,R=T.width,V=T.height,te=T.data;return R===void 0||V===void 0?this.fire(new p.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):R!==b.data.width||V!==b.data.height?this.fire(new p.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(b.data.replace(te,!(g instanceof js||Ki&&g instanceof Ki)),void this.style.updateImage(h,b))},s.prototype.hasImage=function(h){return h?!!this.style.getImage(h):(this.fire(new p.ErrorEvent(new Error("Missing required image id"))),!1)},s.prototype.removeImage=function(h){this.style.removeImage(h)},s.prototype.loadImage=function(h,g){p.getImage(this._requestManager.transformRequest(h,p.ResourceType.Image),g)},s.prototype.listImages=function(){return this.style.listImages()},s.prototype.addLayer=function(h,g){return this._lazyInitEmptyStyle(),this.style.addLayer(h,g),this._update(!0)},s.prototype.moveLayer=function(h,g){return this.style.moveLayer(h,g),this._update(!0)},s.prototype.removeLayer=function(h){return this.style.removeLayer(h),this._update(!0)},s.prototype.getLayer=function(h){return this.style.getLayer(h)},s.prototype.setLayerZoomRange=function(h,g,b){return this.style.setLayerZoomRange(h,g,b),this._update(!0)},s.prototype.setFilter=function(h,g,b){return b===void 0&&(b={}),this.style.setFilter(h,g,b),this._update(!0)},s.prototype.getFilter=function(h){return this.style.getFilter(h)},s.prototype.setPaintProperty=function(h,g,b,T){return T===void 0&&(T={}),this.style.setPaintProperty(h,g,b,T),this._update(!0)},s.prototype.getPaintProperty=function(h,g){return this.style.getPaintProperty(h,g)},s.prototype.setLayoutProperty=function(h,g,b,T){return T===void 0&&(T={}),this.style.setLayoutProperty(h,g,b,T),this._update(!0)},s.prototype.getLayoutProperty=function(h,g){return this.style.getLayoutProperty(h,g)},s.prototype.setLight=function(h,g){return g===void 0&&(g={}),this._lazyInitEmptyStyle(),this.style.setLight(h,g),this._update(!0)},s.prototype.getLight=function(){return this.style.getLight()},s.prototype.setFeatureState=function(h,g){return this.style.setFeatureState(h,g),this._update()},s.prototype.removeFeatureState=function(h,g){return this.style.removeFeatureState(h,g),this._update()},s.prototype.getFeatureState=function(h){return this.style.getFeatureState(h)},s.prototype.getContainer=function(){return this._container},s.prototype.getCanvasContainer=function(){return this._canvasContainer},s.prototype.getCanvas=function(){return this._canvas},s.prototype._containerDimensions=function(){var h=0,g=0;return this._container&&(h=this._container.clientWidth||400,g=this._container.clientHeight||300),[h,g]},s.prototype._detectMissingCSS=function(){p.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&p.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")},s.prototype._setupContainer=function(){var h=this._container;h.classList.add("mapboxgl-map"),(this._missingCSSCanary=F.create("div","mapboxgl-canary",h)).style.visibility="hidden",this._detectMissingCSS();var g=this._canvasContainer=F.create("div","mapboxgl-canvas-container",h);this._interactive&&g.classList.add("mapboxgl-interactive"),this._canvas=F.create("canvas","mapboxgl-canvas",g),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");var b=this._containerDimensions();this._resizeCanvas(b[0],b[1]);var T=this._controlContainer=F.create("div","mapboxgl-control-container",h),R=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(function(V){R[V]=F.create("div","mapboxgl-ctrl-"+V,T)}),this._container.addEventListener("scroll",this._onMapScroll,!1)},s.prototype._resizeCanvas=function(h,g){var b=p.browser.devicePixelRatio||1;this._canvas.width=b*h,this._canvas.height=b*g,this._canvas.style.width=h+"px",this._canvas.style.height=g+"px"},s.prototype._setupPainter=function(){var h=p.extend({},w.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),g=this._canvas.getContext("webgl",h)||this._canvas.getContext("experimental-webgl",h);g?(this.painter=new ka(g,this.transform),p.webpSupported.testSupport(g)):this.fire(new p.ErrorEvent(new Error("Failed to initialize WebGL")))},s.prototype._contextLost=function(h){h.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new p.Event("webglcontextlost",{originalEvent:h}))},s.prototype._contextRestored=function(h){this._setupPainter(),this.resize(),this._update(),this.fire(new p.Event("webglcontextrestored",{originalEvent:h}))},s.prototype._onMapScroll=function(h){if(h.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},s.prototype.loaded=function(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()},s.prototype._update=function(h){return this.style?(this._styleDirty=this._styleDirty||h,this._sourcesDirty=!0,this.triggerRepaint(),this):this},s.prototype._requestRenderFrame=function(h){return this._update(),this._renderTaskQueue.add(h)},s.prototype._cancelRenderFrame=function(h){this._renderTaskQueue.remove(h)},s.prototype._render=function(h){var g,b=this,T=0,R=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(g=R.createQueryEXT(),R.beginQueryEXT(R.TIME_ELAPSED_EXT,g),T=p.browser.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(h),!this._removed){var V=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;var te=this.transform.zoom,de=p.browser.now();this.style.zoomHistory.update(te,de);var ye=new p.EvaluationParameters(te,{now:de,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),xe=ye.crossFadingFactor();xe===1&&xe===this._crossFadingFactor||(V=!0,this._crossFadingFactor=xe),this.style.update(ye)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new p.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new p.Event("load"))),this.style&&(this.style.hasTransitions()||V)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){var He=p.browser.now()-T;R.endQueryEXT(R.TIME_ELAPSED_EXT,g),setTimeout(function(){var ze=R.getQueryObjectEXT(g,R.QUERY_RESULT_EXT)/1e6;R.deleteQueryEXT(g),b.fire(new p.Event("gpu-timing-frame",{cpuTime:He,gpuTime:ze}))},50)}if(this.listens("gpu-timing-layer")){var Ze=this.painter.collectGpuTimers();setTimeout(function(){var ze=b.painter.queryGpuTimers(Ze);b.fire(new p.Event("gpu-timing-layer",{layerTimes:ze}))},50)}var nt=this._sourcesDirty||this._styleDirty||this._placementDirty;return nt||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new p.Event("idle")),!this._loaded||this._fullyLoaded||nt||(this._fullyLoaded=!0),this}},s.prototype.remove=function(){this._hash&&this._hash.remove();for(var h=0,g=this._controls;h<g.length;h+=1)g[h].onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),p.window!==void 0&&(p.window.removeEventListener("resize",this._onWindowResize,!1),p.window.removeEventListener("orientationchange",this._onWindowResize,!1),p.window.removeEventListener("online",this._onWindowOnline,!1));var b=this.painter.context.gl.getExtension("WEBGL_lose_context");b&&b.loseContext(),bl(this._canvasContainer),bl(this._controlContainer),bl(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),this._removed=!0,this.fire(new p.Event("remove"))},s.prototype.triggerRepaint=function(){var h=this;this.style&&!this._frame&&(this._frame=p.browser.frame(function(g){h._frame=null,h._render(g)}))},s.prototype._onWindowOnline=function(){this._update()},s.prototype._onWindowResize=function(h){this._trackResize&&this.resize({originalEvent:h})._update()},a.showTileBoundaries.get=function(){return!!this._showTileBoundaries},a.showTileBoundaries.set=function(h){this._showTileBoundaries!==h&&(this._showTileBoundaries=h,this._update())},a.showPadding.get=function(){return!!this._showPadding},a.showPadding.set=function(h){this._showPadding!==h&&(this._showPadding=h,this._update())},a.showCollisionBoxes.get=function(){return!!this._showCollisionBoxes},a.showCollisionBoxes.set=function(h){this._showCollisionBoxes!==h&&(this._showCollisionBoxes=h,h?this.style._generateCollisionBoxes():this._update())},a.showOverdrawInspector.get=function(){return!!this._showOverdrawInspector},a.showOverdrawInspector.set=function(h){this._showOverdrawInspector!==h&&(this._showOverdrawInspector=h,this._update())},a.repaint.get=function(){return!!this._repaint},a.repaint.set=function(h){this._repaint!==h&&(this._repaint=h,this.triggerRepaint())},a.vertices.get=function(){return!!this._vertices},a.vertices.set=function(h){this._vertices=h,this._update()},s.prototype._setCacheLimits=function(h,g){p.setCacheLimits(h,g)},a.version.get=function(){return p.version},Object.defineProperties(s.prototype,a),s}(rc);function bl(n){n.parentNode&&n.parentNode.removeChild(n)}var mc={showCompass:!0,showZoom:!0,visualizePitch:!1},wu=function(n){var s=this;this.options=p.extend({},mc,n),this._container=F.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",function(a){return a.preventDefault()}),this.options.showZoom&&(p.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",function(a){return s._map.zoomIn({},{originalEvent:a})}),F.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",function(a){return s._map.zoomOut({},{originalEvent:a})}),F.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(p.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",function(a){s.options.visualizePitch?s._map.resetNorthPitch({},{originalEvent:a}):s._map.resetNorth({},{originalEvent:a})}),this._compassIcon=F.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))};wu.prototype._updateZoomButtons=function(){var n=this._map.getZoom(),s=n===this._map.getMaxZoom(),a=n===this._map.getMinZoom();this._zoomInButton.disabled=s,this._zoomOutButton.disabled=a,this._zoomInButton.setAttribute("aria-disabled",s.toString()),this._zoomOutButton.setAttribute("aria-disabled",a.toString())},wu.prototype._rotateCompassArrow=function(){var n=this.options.visualizePitch?"scale("+1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)+") rotateX("+this._map.transform.pitch+"deg) rotateZ("+this._map.transform.angle*(180/Math.PI)+"deg)":"rotate("+this._map.transform.angle*(180/Math.PI)+"deg)";this._compassIcon.style.transform=n},wu.prototype.onAdd=function(n){return this._map=n,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Es(this._map,this._compass,this.options.visualizePitch)),this._container},wu.prototype.onRemove=function(){F.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map},wu.prototype._createButton=function(n,s){var a=F.create("button",n,this._container);return a.type="button",a.addEventListener("click",s),a},wu.prototype._setButtonTitle=function(n,s){var a=this._map._getUIString("NavigationControl."+s);n.title=a,n.setAttribute("aria-label",a)};var Es=function(n,s,a){a===void 0&&(a=!1),this._clickTolerance=10,this.element=s,this.mouseRotate=new pc({clickTolerance:n.dragRotate._mouseRotate._clickTolerance}),this.map=n,a&&(this.mousePitch=new tl({clickTolerance:n.dragRotate._mousePitch._clickTolerance})),p.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),F.addEventListener(s,"mousedown",this.mousedown),F.addEventListener(s,"touchstart",this.touchstart,{passive:!1}),F.addEventListener(s,"touchmove",this.touchmove),F.addEventListener(s,"touchend",this.touchend),F.addEventListener(s,"touchcancel",this.reset)};function il(n,s,a){if(n=new p.LngLat(n.lng,n.lat),s){var h=new p.LngLat(n.lng-360,n.lat),g=new p.LngLat(n.lng+360,n.lat),b=a.locationPoint(n).distSqr(s);a.locationPoint(h).distSqr(s)<b?n=h:a.locationPoint(g).distSqr(s)<b&&(n=g)}for(;Math.abs(n.lng-a.center.lng)>180;){var T=a.locationPoint(n);if(T.x>=0&&T.y>=0&&T.x<=a.width&&T.y<=a.height)break;n.lng>a.center.lng?n.lng-=360:n.lng+=360}return n}Es.prototype.down=function(n,s){this.mouseRotate.mousedown(n,s),this.mousePitch&&this.mousePitch.mousedown(n,s),F.disableDrag()},Es.prototype.move=function(n,s){var a=this.map,h=this.mouseRotate.mousemoveWindow(n,s);if(h&&h.bearingDelta&&a.setBearing(a.getBearing()+h.bearingDelta),this.mousePitch){var g=this.mousePitch.mousemoveWindow(n,s);g&&g.pitchDelta&&a.setPitch(a.getPitch()+g.pitchDelta)}},Es.prototype.off=function(){var n=this.element;F.removeEventListener(n,"mousedown",this.mousedown),F.removeEventListener(n,"touchstart",this.touchstart,{passive:!1}),F.removeEventListener(n,"touchmove",this.touchmove),F.removeEventListener(n,"touchend",this.touchend),F.removeEventListener(n,"touchcancel",this.reset),this.offTemp()},Es.prototype.offTemp=function(){F.enableDrag(),F.removeEventListener(p.window,"mousemove",this.mousemove),F.removeEventListener(p.window,"mouseup",this.mouseup)},Es.prototype.mousedown=function(n){this.down(p.extend({},n,{ctrlKey:!0,preventDefault:function(){return n.preventDefault()}}),F.mousePos(this.element,n)),F.addEventListener(p.window,"mousemove",this.mousemove),F.addEventListener(p.window,"mouseup",this.mouseup)},Es.prototype.mousemove=function(n){this.move(n,F.mousePos(this.element,n))},Es.prototype.mouseup=function(n){this.mouseRotate.mouseupWindow(n),this.mousePitch&&this.mousePitch.mouseupWindow(n),this.offTemp()},Es.prototype.touchstart=function(n){n.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=F.touchPos(this.element,n.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:function(){return n.preventDefault()}},this._startPos))},Es.prototype.touchmove=function(n){n.targetTouches.length!==1?this.reset():(this._lastPos=F.touchPos(this.element,n.targetTouches)[0],this.move({preventDefault:function(){return n.preventDefault()}},this._lastPos))},Es.prototype.touchend=function(n){n.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()},Es.prototype.reset=function(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()};var Tu={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function gc(n,s,a){var h=n.classList;for(var g in Tu)h.remove("mapboxgl-"+a+"-anchor-"+g);h.add("mapboxgl-"+a+"-anchor-"+s)}var nc,yc=function(n){function s(a,h){if(n.call(this),(a instanceof p.window.HTMLElement||h)&&(a=p.extend({element:a},h)),p.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=a&&a.anchor||"center",this._color=a&&a.color||"#3FB1CE",this._scale=a&&a.scale||1,this._draggable=a&&a.draggable||!1,this._clickTolerance=a&&a.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=a&&a.rotation||0,this._rotationAlignment=a&&a.rotationAlignment||"auto",this._pitchAlignment=a&&a.pitchAlignment&&a.pitchAlignment!=="auto"?a.pitchAlignment:this._rotationAlignment,a&&a.element)this._element=a.element,this._offset=p.Point.convert(a&&a.offset||[0,0]);else{this._defaultMarker=!0,this._element=F.create("div"),this._element.setAttribute("aria-label","Map marker");var g=F.createNS("http://www.w3.org/2000/svg","svg");g.setAttributeNS(null,"display","block"),g.setAttributeNS(null,"height","41px"),g.setAttributeNS(null,"width","27px"),g.setAttributeNS(null,"viewBox","0 0 27 41");var b=F.createNS("http://www.w3.org/2000/svg","g");b.setAttributeNS(null,"stroke","none"),b.setAttributeNS(null,"stroke-width","1"),b.setAttributeNS(null,"fill","none"),b.setAttributeNS(null,"fill-rule","evenodd");var T=F.createNS("http://www.w3.org/2000/svg","g");T.setAttributeNS(null,"fill-rule","nonzero");var R=F.createNS("http://www.w3.org/2000/svg","g");R.setAttributeNS(null,"transform","translate(3.0, 29.0)"),R.setAttributeNS(null,"fill","#000000");for(var V=0,te=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];V<te.length;V+=1){var de=te[V],ye=F.createNS("http://www.w3.org/2000/svg","ellipse");ye.setAttributeNS(null,"opacity","0.04"),ye.setAttributeNS(null,"cx","10.5"),ye.setAttributeNS(null,"cy","5.80029008"),ye.setAttributeNS(null,"rx",de.rx),ye.setAttributeNS(null,"ry",de.ry),R.appendChild(ye)}var xe=F.createNS("http://www.w3.org/2000/svg","g");xe.setAttributeNS(null,"fill",this._color);var He=F.createNS("http://www.w3.org/2000/svg","path");He.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),xe.appendChild(He);var Ze=F.createNS("http://www.w3.org/2000/svg","g");Ze.setAttributeNS(null,"opacity","0.25"),Ze.setAttributeNS(null,"fill","#000000");var nt=F.createNS("http://www.w3.org/2000/svg","path");nt.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),Ze.appendChild(nt);var ze=F.createNS("http://www.w3.org/2000/svg","g");ze.setAttributeNS(null,"transform","translate(6.0, 7.0)"),ze.setAttributeNS(null,"fill","#FFFFFF");var rt=F.createNS("http://www.w3.org/2000/svg","g");rt.setAttributeNS(null,"transform","translate(8.0, 8.0)");var ht=F.createNS("http://www.w3.org/2000/svg","circle");ht.setAttributeNS(null,"fill","#000000"),ht.setAttributeNS(null,"opacity","0.25"),ht.setAttributeNS(null,"cx","5.5"),ht.setAttributeNS(null,"cy","5.5"),ht.setAttributeNS(null,"r","5.4999962");var Nt=F.createNS("http://www.w3.org/2000/svg","circle");Nt.setAttributeNS(null,"fill","#FFFFFF"),Nt.setAttributeNS(null,"cx","5.5"),Nt.setAttributeNS(null,"cy","5.5"),Nt.setAttributeNS(null,"r","5.4999962"),rt.appendChild(ht),rt.appendChild(Nt),T.appendChild(R),T.appendChild(xe),T.appendChild(Ze),T.appendChild(ze),T.appendChild(rt),g.appendChild(T),g.setAttributeNS(null,"height",41*this._scale+"px"),g.setAttributeNS(null,"width",27*this._scale+"px"),this._element.appendChild(g),this._offset=p.Point.convert(a&&a.offset||[0,-14])}this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",function(or){or.preventDefault()}),this._element.addEventListener("mousedown",function(or){or.preventDefault()}),gc(this._element,this._anchor,"marker"),this._popup=null}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype.addTo=function(a){return this.remove(),this._map=a,a.getCanvasContainer().appendChild(this._element),a.on("move",this._update),a.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this},s.prototype.remove=function(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),F.remove(this._element),this._popup&&this._popup.remove(),this},s.prototype.getLngLat=function(){return this._lngLat},s.prototype.setLngLat=function(a){return this._lngLat=p.LngLat.convert(a),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this},s.prototype.getElement=function(){return this._element},s.prototype.setPopup=function(a){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),a){if(!("offset"in a.options)){var h=Math.sqrt(Math.pow(13.5,2)/2);a.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[h,-1*(24.6+h)],"bottom-right":[-h,-1*(24.6+h)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=a,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this},s.prototype._onKeyPress=function(a){var h=a.code,g=a.charCode||a.keyCode;h!=="Space"&&h!=="Enter"&&g!==32&&g!==13||this.togglePopup()},s.prototype._onMapClick=function(a){var h=a.originalEvent.target,g=this._element;this._popup&&(h===g||g.contains(h))&&this.togglePopup()},s.prototype.getPopup=function(){return this._popup},s.prototype.togglePopup=function(){var a=this._popup;return a?(a.isOpen()?a.remove():a.addTo(this._map),this):this},s.prototype._update=function(a){if(this._map){this._map.transform.renderWorldCopies&&(this._lngLat=il(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);var h="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?h="rotateZ("+this._rotation+"deg)":this._rotationAlignment==="map"&&(h="rotateZ("+(this._rotation-this._map.getBearing())+"deg)");var g="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?g="rotateX(0deg)":this._pitchAlignment==="map"&&(g="rotateX("+this._map.getPitch()+"deg)"),a&&a.type!=="moveend"||(this._pos=this._pos.round()),F.setTransform(this._element,Tu[this._anchor]+" translate("+this._pos.x+"px, "+this._pos.y+"px) "+g+" "+h)}},s.prototype.getOffset=function(){return this._offset},s.prototype.setOffset=function(a){return this._offset=p.Point.convert(a),this._update(),this},s.prototype._onMove=function(a){if(!this._isDragging){var h=this._clickTolerance||this._map._clickTolerance;this._isDragging=a.point.dist(this._pointerdownPos)>=h}this._isDragging&&(this._pos=a.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new p.Event("dragstart"))),this.fire(new p.Event("drag")))},s.prototype._onUp=function(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new p.Event("dragend")),this._state="inactive"},s.prototype._addDragHandler=function(a){this._element.contains(a.originalEvent.target)&&(a.preventDefault(),this._positionDelta=a.point.sub(this._pos).add(this._offset),this._pointerdownPos=a.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},s.prototype.setDraggable=function(a){return this._draggable=!!a,this._map&&(a?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this},s.prototype.isDraggable=function(){return this._draggable},s.prototype.setRotation=function(a){return this._rotation=a||0,this._update(),this},s.prototype.getRotation=function(){return this._rotation},s.prototype.setRotationAlignment=function(a){return this._rotationAlignment=a||"auto",this._update(),this},s.prototype.getRotationAlignment=function(){return this._rotationAlignment},s.prototype.setPitchAlignment=function(a){return this._pitchAlignment=a&&a!=="auto"?a:this._rotationAlignment,this._update(),this},s.prototype.getPitchAlignment=function(){return this._pitchAlignment},s}(p.Evented),jc={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0},Bl=0,qs=!1,_c=function(n){function s(a){n.call(this),this.options=p.extend({},jc,a),p.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype.onAdd=function(a){var h;return this._map=a,this._container=F.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),h=this._setupUI,nc!==void 0?h(nc):p.window.navigator.permissions!==void 0?p.window.navigator.permissions.query({name:"geolocation"}).then(function(g){h(nc=g.state!=="denied")}):h(nc=!!p.window.navigator.geolocation),this._container},s.prototype.onRemove=function(){this._geolocationWatchID!==void 0&&(p.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),F.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Bl=0,qs=!1},s.prototype._isOutOfMapMaxBounds=function(a){var h=this._map.getMaxBounds(),g=a.coords;return h&&(g.longitude<h.getWest()||g.longitude>h.getEast()||g.latitude<h.getSouth()||g.latitude>h.getNorth())},s.prototype._setErrorState=function(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}},s.prototype._onSuccess=function(a){if(this._map){if(this._isOutOfMapMaxBounds(a))return this._setErrorState(),this.fire(new p.Event("outofmaxbounds",a)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=a,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(a),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(a),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new p.Event("geolocate",a)),this._finish()}},s.prototype._updateCamera=function(a){var h=new p.LngLat(a.coords.longitude,a.coords.latitude),g=a.coords.accuracy,b=this._map.getBearing(),T=p.extend({bearing:b},this.options.fitBoundsOptions);this._map.fitBounds(h.toBounds(g),T,{geolocateSource:!0})},s.prototype._updateMarker=function(a){if(a){var h=new p.LngLat(a.coords.longitude,a.coords.latitude);this._accuracyCircleMarker.setLngLat(h).addTo(this._map),this._userLocationDotMarker.setLngLat(h).addTo(this._map),this._accuracy=a.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},s.prototype._updateCircleRadius=function(){var a=this._map._container.clientHeight/2,h=this._map.unproject([0,a]),g=this._map.unproject([1,a]),b=h.distanceTo(g),T=Math.ceil(2*this._accuracy/b);this._circleElement.style.width=T+"px",this._circleElement.style.height=T+"px"},s.prototype._onZoom=function(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},s.prototype._onError=function(a){if(this._map){if(this.options.trackUserLocation)if(a.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;var h=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=h,this._geolocateButton.setAttribute("aria-label",h),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(a.code===3&&qs)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new p.Event("error",a)),this._finish()}},s.prototype._finish=function(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},s.prototype._setupUI=function(a){var h=this;if(this._container.addEventListener("contextmenu",function(T){return T.preventDefault()}),this._geolocateButton=F.create("button","mapboxgl-ctrl-geolocate",this._container),F.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",a===!1){p.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");var g=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=g,this._geolocateButton.setAttribute("aria-label",g)}else{var b=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=b,this._geolocateButton.setAttribute("aria-label",b)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=F.create("div","mapboxgl-user-location-dot"),this._userLocationDotMarker=new yc(this._dotElement),this._circleElement=F.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new yc({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",function(T){T.geolocateSource||h._watchState!=="ACTIVE_LOCK"||T.originalEvent&&T.originalEvent.type==="resize"||(h._watchState="BACKGROUND",h._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),h._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),h.fire(new p.Event("trackuserlocationend")))})},s.prototype.trigger=function(){if(!this._setup)return p.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new p.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Bl--,qs=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new p.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new p.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){var a;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),++Bl>1?(a={maximumAge:6e5,timeout:0},qs=!0):(a=this.options.positionOptions,qs=!1),this._geolocationWatchID=p.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,a)}}else p.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0},s.prototype._clearWatch=function(){p.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)},s}(p.Evented),al={maxWidth:100,unit:"metric"},Au=function(n){this.options=p.extend({},al,n),p.bindAll(["_onMove","setUnit"],this)};function Ul(n,s,a){var h=a&&a.maxWidth||100,g=n._container.clientHeight/2,b=n.unproject([0,g]),T=n.unproject([h,g]),R=b.distanceTo(T);if(a&&a.unit==="imperial"){var V=3.2808*R;V>5280?pu(s,h,V/5280,n._getUIString("ScaleControl.Miles")):pu(s,h,V,n._getUIString("ScaleControl.Feet"))}else a&&a.unit==="nautical"?pu(s,h,R/1852,n._getUIString("ScaleControl.NauticalMiles")):R>=1e3?pu(s,h,R/1e3,n._getUIString("ScaleControl.Kilometers")):pu(s,h,R,n._getUIString("ScaleControl.Meters"))}function pu(n,s,a,h){var g,b,T,R=(g=a,(b=Math.pow(10,(""+Math.floor(g)).length-1))*(T=(T=g/b)>=10?10:T>=5?5:T>=3?3:T>=2?2:T>=1?1:function(V){var te=Math.pow(10,Math.ceil(-Math.log(V)/Math.LN10));return Math.round(V*te)/te}(T)));n.style.width=s*(R/a)+"px",n.innerHTML=R+"&nbsp;"+h}Au.prototype.getDefaultPosition=function(){return"bottom-left"},Au.prototype._onMove=function(){Ul(this._map,this._container,this.options)},Au.prototype.onAdd=function(n){return this._map=n,this._container=F.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",n.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container},Au.prototype.onRemove=function(){F.remove(this._container),this._map.off("move",this._onMove),this._map=void 0},Au.prototype.setUnit=function(n){this.options.unit=n,Ul(this._map,this._container,this.options)};var eu=function(n){this._fullscreen=!1,n&&n.container&&(n.container instanceof p.window.HTMLElement?this._container=n.container:p.warnOnce("Full screen control 'container' must be a DOM element.")),p.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in p.window.document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in p.window.document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in p.window.document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in p.window.document&&(this._fullscreenchange="MSFullscreenChange")};eu.prototype.onAdd=function(n){return this._map=n,this._container||(this._container=this._map.getContainer()),this._controlContainer=F.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",p.warnOnce("This device does not support fullscreen mode.")),this._controlContainer},eu.prototype.onRemove=function(){F.remove(this._controlContainer),this._map=null,p.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)},eu.prototype._checkFullscreenSupport=function(){return!!(p.window.document.fullscreenEnabled||p.window.document.mozFullScreenEnabled||p.window.document.msFullscreenEnabled||p.window.document.webkitFullscreenEnabled)},eu.prototype._setupUI=function(){var n=this._fullscreenButton=F.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);F.create("span","mapboxgl-ctrl-icon",n).setAttribute("aria-hidden",!0),n.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),p.window.document.addEventListener(this._fullscreenchange,this._changeIcon)},eu.prototype._updateTitle=function(){var n=this._getTitle();this._fullscreenButton.setAttribute("aria-label",n),this._fullscreenButton.title=n},eu.prototype._getTitle=function(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")},eu.prototype._isFullscreen=function(){return this._fullscreen},eu.prototype._changeIcon=function(){(p.window.document.fullscreenElement||p.window.document.mozFullScreenElement||p.window.document.webkitFullscreenElement||p.window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())},eu.prototype._onClickFullscreen=function(){this._isFullscreen()?p.window.document.exitFullscreen?p.window.document.exitFullscreen():p.window.document.mozCancelFullScreen?p.window.document.mozCancelFullScreen():p.window.document.msExitFullscreen?p.window.document.msExitFullscreen():p.window.document.webkitCancelFullScreen&&p.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()};var xc={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},bc=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", "),Zc=function(n){function s(a){n.call(this),this.options=p.extend(Object.create(xc),a),p.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype.addTo=function(a){return this._map&&this.remove(),this._map=a,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new p.Event("open")),this},s.prototype.isOpen=function(){return!!this._map},s.prototype.remove=function(){return this._content&&F.remove(this._content),this._container&&(F.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new p.Event("close")),this},s.prototype.getLngLat=function(){return this._lngLat},s.prototype.setLngLat=function(a){return this._lngLat=p.LngLat.convert(a),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this},s.prototype.trackPointer=function(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this},s.prototype.getElement=function(){return this._container},s.prototype.setText=function(a){return this.setDOMContent(p.window.document.createTextNode(a))},s.prototype.setHTML=function(a){var h,g=p.window.document.createDocumentFragment(),b=p.window.document.createElement("body");for(b.innerHTML=a;h=b.firstChild;)g.appendChild(h);return this.setDOMContent(g)},s.prototype.getMaxWidth=function(){return this._container&&this._container.style.maxWidth},s.prototype.setMaxWidth=function(a){return this.options.maxWidth=a,this._update(),this},s.prototype.setDOMContent=function(a){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=F.create("div","mapboxgl-popup-content",this._container);return this._content.appendChild(a),this._createCloseButton(),this._update(),this._focusFirstElement(),this},s.prototype.addClassName=function(a){this._container&&this._container.classList.add(a)},s.prototype.removeClassName=function(a){this._container&&this._container.classList.remove(a)},s.prototype.setOffset=function(a){return this.options.offset=a,this._update(),this},s.prototype.toggleClassName=function(a){if(this._container)return this._container.classList.toggle(a)},s.prototype._createCloseButton=function(){this.options.closeButton&&(this._closeButton=F.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))},s.prototype._onMouseUp=function(a){this._update(a.point)},s.prototype._onMouseMove=function(a){this._update(a.point)},s.prototype._onDrag=function(a){this._update(a.point)},s.prototype._update=function(a){var h=this;if(this._map&&(this._lngLat||this._trackPointer)&&this._content&&(this._container||(this._container=F.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=F.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(function(ye){return h._container.classList.add(ye)}),this._trackPointer&&this._container.classList.add("mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=il(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||a)){var g=this._pos=this._trackPointer&&a?a:this._map.project(this._lngLat),b=this.options.anchor,T=function ye(xe){if(xe){if(typeof xe=="number"){var He=Math.round(Math.sqrt(.5*Math.pow(xe,2)));return{center:new p.Point(0,0),top:new p.Point(0,xe),"top-left":new p.Point(He,He),"top-right":new p.Point(-He,He),bottom:new p.Point(0,-xe),"bottom-left":new p.Point(He,-He),"bottom-right":new p.Point(-He,-He),left:new p.Point(xe,0),right:new p.Point(-xe,0)}}if(xe instanceof p.Point||Array.isArray(xe)){var Ze=p.Point.convert(xe);return{center:Ze,top:Ze,"top-left":Ze,"top-right":Ze,bottom:Ze,"bottom-left":Ze,"bottom-right":Ze,left:Ze,right:Ze}}return{center:p.Point.convert(xe.center||[0,0]),top:p.Point.convert(xe.top||[0,0]),"top-left":p.Point.convert(xe["top-left"]||[0,0]),"top-right":p.Point.convert(xe["top-right"]||[0,0]),bottom:p.Point.convert(xe.bottom||[0,0]),"bottom-left":p.Point.convert(xe["bottom-left"]||[0,0]),"bottom-right":p.Point.convert(xe["bottom-right"]||[0,0]),left:p.Point.convert(xe.left||[0,0]),right:p.Point.convert(xe.right||[0,0])}}return ye(new p.Point(0,0))}(this.options.offset);if(!b){var R,V=this._container.offsetWidth,te=this._container.offsetHeight;R=g.y+T.bottom.y<te?["top"]:g.y>this._map.transform.height-te?["bottom"]:[],g.x<V/2?R.push("left"):g.x>this._map.transform.width-V/2&&R.push("right"),b=R.length===0?"bottom":R.join("-")}var de=g.add(T[b]).round();F.setTransform(this._container,Tu[b]+" translate("+de.x+"px,"+de.y+"px)"),gc(this._container,b,"popup")}},s.prototype._focusFirstElement=function(){if(this.options.focusAfterOpen&&this._container){var a=this._container.querySelector(bc);a&&a.focus()}},s.prototype._onClose=function(){this.remove()},s}(p.Evented),Sc={version:p.version,supported:w,setRTLTextPlugin:p.setRTLTextPlugin,getRTLTextPluginStatus:p.getRTLTextPluginStatus,Map:tf,NavigationControl:wu,GeolocateControl:_c,AttributionControl:as,ScaleControl:Au,FullscreenControl:eu,Popup:Zc,Marker:yc,Style:ba,LngLat:p.LngLat,LngLatBounds:p.LngLatBounds,Point:p.Point,MercatorCoordinate:p.MercatorCoordinate,Evented:p.Evented,config:p.config,prewarm:function(){vr().acquire(jt)},clearPrewarmedResources:function(){var n=Hr;n&&(n.isPreloaded()&&n.numActive()===1?(n.release(jt),Hr=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return p.config.ACCESS_TOKEN},set accessToken(n){p.config.ACCESS_TOKEN=n},get baseApiUrl(){return p.config.API_URL},set baseApiUrl(n){p.config.API_URL=n},get workerCount(){return dr.workerCount},set workerCount(n){dr.workerCount=n},get maxParallelImageRequests(){return p.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(n){p.config.MAX_PARALLEL_IMAGE_REQUESTS=n},clearStorage:function(n){p.clearTileCache(n)},workerUrl:""};return Sc}),J})},86387:function(ur,L,x){"use strict";Object.defineProperty(L,"__esModule",{value:!0}),L.default=function(Xt){return(0,E.default)((0,le.default)(Xt)&&Xt.length>=1,"Must merge at least 1 JSON schema."),w.default.apply(void 0,[{}].concat(Zt(Xt),[function(Ft,Lt,_t){if(!(0,Q.default)(Ft)){if(_t==="required")return(0,be.default)(Ft.concat(Lt));if((0,Ie.default)(Ft)){if(!(0,Ie.default)(Lt))throw new Error('Failed to merge schemas because "'+_t+'" has different values.');return}E.default.deepEqual(Ft,Lt,'Failed to merge schemas because "'+_t+'" has different values: '+JSON.stringify(Ft)+" and "+JSON.stringify(Lt)+".")}}]))};var J=x(48583),E=$t(J),p=x(38554),w=$t(p),F=x(59722),Q=$t(F),Y=x(53778),le=$t(Y),ne=x(97644),be=$t(ne),we=x(8146),Ie=$t(we);function $t(Xt){return Xt&&Xt.__esModule?Xt:{default:Xt}}function Zt(Xt){if(Array.isArray(Xt)){for(var Ft=0,Lt=Array(Xt.length);Ft<Xt.length;Ft++)Lt[Ft]=Xt[Ft];return Lt}else return Array.from(Xt)}ur.exports=L.default},28660:function(ur,L,x){var J=x(34155);/*! *****************************************************************************
Copyright (C) Microsoft. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var E;(function(p){(function(w){var F=typeof x.g=="object"?x.g:typeof self=="object"?self:typeof this=="object"?this:Function("return this;")(),Q=Y(p);typeof F.Reflect=="undefined"?F.Reflect=p:Q=Y(F.Reflect,Q),w(Q);function Y(le,ne){return function(be,we){typeof le[be]!="function"&&Object.defineProperty(le,be,{configurable:!0,writable:!0,value:we}),ne&&ne(be,we)}}})(function(w){var F=Object.prototype.hasOwnProperty,Q=typeof Symbol=="function",Y=Q&&typeof Symbol.toPrimitive!="undefined"?Symbol.toPrimitive:"@@toPrimitive",le=Q&&typeof Symbol.iterator!="undefined"?Symbol.iterator:"@@iterator",ne=typeof Object.create=="function",be={__proto__:[]}instanceof Array,we=!ne&&!be,Ie={create:ne?function(){return Pr(Object.create(null))}:be?function(){return Pr({__proto__:null})}:function(){return Pr({})},has:we?function(Ke,yt){return F.call(Ke,yt)}:function(Ke,yt){return yt in Ke},get:we?function(Ke,yt){return F.call(Ke,yt)?Ke[yt]:void 0}:function(Ke,yt){return Ke[yt]}},$t=Object.getPrototypeOf(Function),Zt=typeof J=="object"&&{NODE_ENV:"production"}&&{NODE_ENV:"production"}.REFLECT_METADATA_USE_MAP_POLYFILL==="true",Xt=!Zt&&typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:_r(),Ft=!Zt&&typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:Er(),Lt=!Zt&&typeof WeakMap=="function"?WeakMap:Ar(),_t=new Lt;function pt(Ke,yt,lt,lr){if(Fr(lt)){if(!S(Ke))throw new TypeError;if(!pe(yt))throw new TypeError;return bt(Ke,yt)}else{if(!S(Ke))throw new TypeError;if(!se(yt))throw new TypeError;if(!se(lr)&&!Fr(lr)&&!ln(lr))throw new TypeError;return ln(lr)&&(lr=void 0),lt=Dt(lt),ir(Ke,yt,lt,lr)}}w("decorate",pt);function Cr(Ke,yt){function lt(lr,qr){if(!se(lr))throw new TypeError;if(!Fr(qr)&&!Ue(qr))throw new TypeError;Qe(Ke,yt,lr,qr)}return lt}w("metadata",Cr);function Gt(Ke,yt,lt,lr){if(!se(lt))throw new TypeError;return Fr(lr)||(lr=Dt(lr)),Qe(Ke,yt,lt,lr)}w("defineMetadata",Gt);function ar(Ke,yt,lt){if(!se(yt))throw new TypeError;return Fr(lt)||(lt=Dt(lt)),Ee(Ke,yt,lt)}w("hasMetadata",ar);function gt(Ke,yt,lt){if(!se(yt))throw new TypeError;return Fr(lt)||(lt=Dt(lt)),ae(Ke,yt,lt)}w("hasOwnMetadata",gt);function Ye(Ke,yt,lt){if(!se(yt))throw new TypeError;return Fr(lt)||(lt=Dt(lt)),me(Ke,yt,lt)}w("getMetadata",Ye);function Et(Ke,yt,lt){if(!se(yt))throw new TypeError;return Fr(lt)||(lt=Dt(lt)),Te(Ke,yt,lt)}w("getOwnMetadata",Et);function Ne(Ke,yt){if(!se(Ke))throw new TypeError;return Fr(yt)||(yt=Dt(yt)),dt(Ke,yt)}w("getMetadataKeys",Ne);function Ae(Ke,yt){if(!se(Ke))throw new TypeError;return Fr(yt)||(yt=Dt(yt)),Jt(Ke,yt)}w("getOwnMetadataKeys",Ae);function Be(Ke,yt,lt){if(!se(yt))throw new TypeError;Fr(lt)||(lt=Dt(lt));var lr=re(yt,lt,!1);if(Fr(lr)||!lr.delete(Ke))return!1;if(lr.size>0)return!0;var qr=_t.get(yt);return qr.delete(lt),qr.size>0||_t.delete(yt),!0}w("deleteMetadata",Be);function bt(Ke,yt){for(var lt=Ke.length-1;lt>=0;--lt){var lr=Ke[lt],qr=lr(yt);if(!Fr(qr)&&!ln(qr)){if(!pe(qr))throw new TypeError;yt=qr}}return yt}function ir(Ke,yt,lt,lr){for(var qr=Ke.length-1;qr>=0;--qr){var ut=Ke[qr],It=ut(yt,lt,lr);if(!Fr(It)&&!ln(It)){if(!se(It))throw new TypeError;lr=It}}return lr}function re(Ke,yt,lt){var lr=_t.get(Ke);if(Fr(lr)){if(!lt)return;lr=new Xt,_t.set(Ke,lr)}var qr=lr.get(yt);if(Fr(qr)){if(!lt)return;qr=new Xt,lr.set(yt,qr)}return qr}function Ee(Ke,yt,lt){var lr=ae(Ke,yt,lt);if(lr)return!0;var qr=Vt(yt);return ln(qr)?!1:Ee(Ke,qr,lt)}function ae(Ke,yt,lt){var lr=re(yt,lt,!1);return Fr(lr)?!1:tt(lr.has(Ke))}function me(Ke,yt,lt){var lr=ae(Ke,yt,lt);if(lr)return Te(Ke,yt,lt);var qr=Vt(yt);if(!ln(qr))return me(Ke,qr,lt)}function Te(Ke,yt,lt){var lr=re(yt,lt,!1);if(!Fr(lr))return lr.get(Ke)}function Qe(Ke,yt,lt,lr){var qr=re(lt,lr,!0);qr.set(Ke,yt)}function dt(Ke,yt){var lt=Jt(Ke,yt),lr=Vt(Ke);if(lr===null)return lt;var qr=dt(lr,yt);if(qr.length<=0)return lt;if(lt.length<=0)return qr;for(var ut=new Ft,It=[],Qt=0,gr=lt;Qt<gr.length;Qt++){var gn=gr[Qt],Cn=ut.has(gn);Cn||(ut.add(gn),It.push(gn))}for(var vi=0,xi=qr;vi<xi.length;vi++){var gn=xi[vi],Cn=ut.has(gn);Cn||(ut.add(gn),It.push(gn))}return It}function Jt(Ke,yt){var lt=[],lr=re(Ke,yt,!1);if(Fr(lr))return lt;for(var qr=lr.keys(),ut=mt(qr),It=0;;){var Qt=H(ut);if(!Qt)return lt.length=It,lt;var gr=Ct(Qt);try{lt[It]=gr}catch(gn){try{Ht(ut)}finally{throw gn}}It++}}function Nr(Ke){if(Ke===null)return 1;switch(typeof Ke){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return Ke===null?1:6;default:return 6}}function Fr(Ke){return Ke===void 0}function ln(Ke){return Ke===null}function tr(Ke){return typeof Ke=="symbol"}function se(Ke){return typeof Ke=="object"?Ke!==null:typeof Ke=="function"}function ge(Ke,yt){switch(Nr(Ke)){case 0:return Ke;case 1:return Ke;case 2:return Ke;case 3:return Ke;case 4:return Ke;case 5:return Ke}var lt=yt===3?"string":yt===5?"number":"default",lr=Je(Ke,Y);if(lr!==void 0){var qr=lr.call(Ke,lt);if(se(qr))throw new TypeError;return qr}return Re(Ke,lt==="default"?"number":lt)}function Re(Ke,yt){if(yt==="string"){var lt=Ke.toString;if(z(lt)){var lr=lt.call(Ke);if(!se(lr))return lr}var qr=Ke.valueOf;if(z(qr)){var lr=qr.call(Ke);if(!se(lr))return lr}}else{var qr=Ke.valueOf;if(z(qr)){var lr=qr.call(Ke);if(!se(lr))return lr}var ut=Ke.toString;if(z(ut)){var lr=ut.call(Ke);if(!se(lr))return lr}}throw new TypeError}function tt(Ke){return!!Ke}function Mt(Ke){return""+Ke}function Dt(Ke){var yt=ge(Ke,3);return tr(yt)?yt:Mt(yt)}function S(Ke){return Array.isArray?Array.isArray(Ke):Ke instanceof Object?Ke instanceof Array:Object.prototype.toString.call(Ke)==="[object Array]"}function z(Ke){return typeof Ke=="function"}function pe(Ke){return typeof Ke=="function"}function Ue(Ke){switch(Nr(Ke)){case 3:return!0;case 4:return!0;default:return!1}}function Je(Ke,yt){var lt=Ke[yt];if(lt!=null){if(!z(lt))throw new TypeError;return lt}}function mt(Ke){var yt=Je(Ke,le);if(!z(yt))throw new TypeError;var lt=yt.call(Ke);if(!se(lt))throw new TypeError;return lt}function Ct(Ke){return Ke.value}function H(Ke){var yt=Ke.next();return yt.done?!1:yt}function Ht(Ke){var yt=Ke.return;yt&&yt.call(Ke)}function Vt(Ke){var yt=Object.getPrototypeOf(Ke);if(typeof Ke!="function"||Ke===$t||yt!==$t)return yt;var lt=Ke.prototype,lr=lt&&Object.getPrototypeOf(lt);if(lr==null||lr===Object.prototype)return yt;var qr=lr.constructor;return typeof qr!="function"||qr===Ke?yt:qr}function _r(){var Ke={},yt=[],lt=function(){function It(Qt,gr,gn){this._index=0,this._keys=Qt,this._values=gr,this._selector=gn}return It.prototype["@@iterator"]=function(){return this},It.prototype[le]=function(){return this},It.prototype.next=function(){var Qt=this._index;if(Qt>=0&&Qt<this._keys.length){var gr=this._selector(this._keys[Qt],this._values[Qt]);return Qt+1>=this._keys.length?(this._index=-1,this._keys=yt,this._values=yt):this._index++,{value:gr,done:!1}}return{value:void 0,done:!0}},It.prototype.throw=function(Qt){throw this._index>=0&&(this._index=-1,this._keys=yt,this._values=yt),Qt},It.prototype.return=function(Qt){return this._index>=0&&(this._index=-1,this._keys=yt,this._values=yt),{value:Qt,done:!0}},It}();return function(){function It(){this._keys=[],this._values=[],this._cacheKey=Ke,this._cacheIndex=-2}return Object.defineProperty(It.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),It.prototype.has=function(Qt){return this._find(Qt,!1)>=0},It.prototype.get=function(Qt){var gr=this._find(Qt,!1);return gr>=0?this._values[gr]:void 0},It.prototype.set=function(Qt,gr){var gn=this._find(Qt,!0);return this._values[gn]=gr,this},It.prototype.delete=function(Qt){var gr=this._find(Qt,!1);if(gr>=0){for(var gn=this._keys.length,Cn=gr+1;Cn<gn;Cn++)this._keys[Cn-1]=this._keys[Cn],this._values[Cn-1]=this._values[Cn];return this._keys.length--,this._values.length--,Qt===this._cacheKey&&(this._cacheKey=Ke,this._cacheIndex=-2),!0}return!1},It.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=Ke,this._cacheIndex=-2},It.prototype.keys=function(){return new lt(this._keys,this._values,lr)},It.prototype.values=function(){return new lt(this._keys,this._values,qr)},It.prototype.entries=function(){return new lt(this._keys,this._values,ut)},It.prototype["@@iterator"]=function(){return this.entries()},It.prototype[le]=function(){return this.entries()},It.prototype._find=function(Qt,gr){return this._cacheKey!==Qt&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=Qt)),this._cacheIndex<0&&gr&&(this._cacheIndex=this._keys.length,this._keys.push(Qt),this._values.push(void 0)),this._cacheIndex},It}();function lr(It,Qt){return It}function qr(It,Qt){return Qt}function ut(It,Qt){return[It,Qt]}}function Er(){return function(){function Ke(){this._map=new Xt}return Object.defineProperty(Ke.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),Ke.prototype.has=function(yt){return this._map.has(yt)},Ke.prototype.add=function(yt){return this._map.set(yt,yt),this},Ke.prototype.delete=function(yt){return this._map.delete(yt)},Ke.prototype.clear=function(){this._map.clear()},Ke.prototype.keys=function(){return this._map.keys()},Ke.prototype.values=function(){return this._map.values()},Ke.prototype.entries=function(){return this._map.entries()},Ke.prototype["@@iterator"]=function(){return this.keys()},Ke.prototype[le]=function(){return this.keys()},Ke}()}function Ar(){var Ke=16,yt=Ie.create(),lt=lr();return function(){function gr(){this._key=lr()}return gr.prototype.has=function(gn){var Cn=qr(gn,!1);return Cn!==void 0?Ie.has(Cn,this._key):!1},gr.prototype.get=function(gn){var Cn=qr(gn,!1);return Cn!==void 0?Ie.get(Cn,this._key):void 0},gr.prototype.set=function(gn,Cn){var vi=qr(gn,!0);return vi[this._key]=Cn,this},gr.prototype.delete=function(gn){var Cn=qr(gn,!1);return Cn!==void 0?delete Cn[this._key]:!1},gr.prototype.clear=function(){this._key=lr()},gr}();function lr(){var gr;do gr="@@WeakMap@@"+Qt();while(Ie.has(yt,gr));return yt[gr]=!0,gr}function qr(gr,gn){if(!F.call(gr,lt)){if(!gn)return;Object.defineProperty(gr,lt,{value:Ie.create()})}return gr[lt]}function ut(gr,gn){for(var Cn=0;Cn<gn;++Cn)gr[Cn]=Math.random()*255|0;return gr}function It(gr){return typeof Uint8Array=="function"?typeof crypto!="undefined"?crypto.getRandomValues(new Uint8Array(gr)):typeof msCrypto!="undefined"?msCrypto.getRandomValues(new Uint8Array(gr)):ut(new Uint8Array(gr),gr):ut(new Array(gr),gr)}function Qt(){var gr=It(Ke);gr[6]=gr[6]&79|64,gr[8]=gr[8]&191|128;for(var gn="",Cn=0;Cn<Ke;++Cn){var vi=gr[Cn];(Cn===4||Cn===6||Cn===8)&&(gn+="-"),vi<16&&(gn+="0"),gn+=vi.toString(16).toLowerCase()}return gn}}function Pr(Ke){return Ke.__=void 0,delete Ke.__,Ke}})})(E||(E={}))},81550:function(ur){(function(L,x){ur.exports=x()})(this,function(){"use strict";var L=function(j){return j instanceof Uint8Array||j instanceof Uint16Array||j instanceof Uint32Array||j instanceof Int8Array||j instanceof Int16Array||j instanceof Int32Array||j instanceof Float32Array||j instanceof Float64Array||j instanceof Uint8ClampedArray},x=function(j,Se){for(var ke=Object.keys(Se),qt=0;qt<ke.length;++qt)j[ke[qt]]=Se[ke[qt]];return j},J=`
`;function E(j){return typeof atob!="undefined"?atob(j):"base64:"+j}function p(j){var Se=new Error("(regl) "+j);throw console.error(Se),Se}function w(j,Se){j||p(Se)}function F(j){return j?": "+j:""}function Q(j,Se,ke){j in Se||p("unknown parameter ("+j+")"+F(ke)+". possible values: "+Object.keys(Se).join())}function Y(j,Se){L(j)||p("invalid parameter type"+F(Se)+". must be a typed array")}function le(j,Se){switch(Se){case"number":return typeof j=="number";case"object":return typeof j=="object";case"string":return typeof j=="string";case"boolean":return typeof j=="boolean";case"function":return typeof j=="function";case"undefined":return typeof j=="undefined";case"symbol":return typeof j=="symbol"}}function ne(j,Se,ke){le(j,Se)||p("invalid parameter type"+F(ke)+". expected "+Se+", got "+typeof j)}function be(j,Se){j>=0&&(j|0)===j||p("invalid parameter type, ("+j+")"+F(Se)+". must be a nonnegative integer")}function we(j,Se,ke){Se.indexOf(j)<0&&p("invalid value"+F(ke)+". must be one of: "+Se)}var Ie=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function $t(j){Object.keys(j).forEach(function(Se){Ie.indexOf(Se)<0&&p('invalid regl constructor argument "'+Se+'". must be one of '+Ie)})}function Zt(j,Se){for(j=j+"";j.length<Se;)j=" "+j;return j}function Xt(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function Ft(j,Se){this.number=j,this.line=Se,this.errors=[]}function Lt(j,Se,ke){this.file=j,this.line=Se,this.message=ke}function _t(){var j=new Error,Se=(j.stack||j).toString(),ke=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(Se);if(ke)return ke[1];var qt=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(Se);return qt?qt[1]:"unknown"}function pt(){var j=new Error,Se=(j.stack||j).toString(),ke=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(Se);if(ke)return ke[1];var qt=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(Se);return qt?qt[1]:"unknown"}function Cr(j,Se){var ke=j.split(`
`),qt=1,wr=0,Yt={unknown:new Xt,0:new Xt};Yt.unknown.name=Yt[0].name=Se||_t(),Yt.unknown.lines.push(new Ft(0,""));for(var pr=0;pr<ke.length;++pr){var Zr=ke[pr],Wr=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec(Zr);if(Wr)switch(Wr[1]){case"line":var en=/(\d+)(\s+\d+)?/.exec(Wr[2]);en&&(qt=en[1]|0,en[2]&&(wr=en[2]|0,wr in Yt||(Yt[wr]=new Xt)));break;case"define":var Kr=/SHADER_NAME(_B64)?\s+(.*)$/.exec(Wr[2]);Kr&&(Yt[wr].name=Kr[1]?E(Kr[2]):Kr[2]);break}Yt[wr].lines.push(new Ft(qt++,Zr))}return Object.keys(Yt).forEach(function(an){var fn=Yt[an];fn.lines.forEach(function(Vr){fn.index[Vr.number]=Vr})}),Yt}function Gt(j){var Se=[];return j.split(`
`).forEach(function(ke){if(!(ke.length<5)){var qt=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(ke);qt?Se.push(new Lt(qt[1]|0,qt[2]|0,qt[3].trim())):ke.length>0&&Se.push(new Lt("unknown",0,ke))}}),Se}function ar(j,Se){Se.forEach(function(ke){var qt=j[ke.file];if(qt){var wr=qt.index[ke.line];if(wr){wr.errors.push(ke),qt.hasErrors=!0;return}}j.unknown.hasErrors=!0,j.unknown.lines[0].errors.push(ke)})}function gt(j,Se,ke,qt,wr){if(!j.getShaderParameter(Se,j.COMPILE_STATUS)){var Yt=j.getShaderInfoLog(Se),pr=qt===j.FRAGMENT_SHADER?"fragment":"vertex";ir(ke,"string",pr+" shader source must be a string",wr);var Zr=Cr(ke,wr),Wr=Gt(Yt);ar(Zr,Wr),Object.keys(Zr).forEach(function(en){var Kr=Zr[en];if(!Kr.hasErrors)return;var an=[""],fn=[""];function Vr(on,zt){an.push(on),fn.push(zt||"")}Vr("file number "+en+": "+Kr.name+`
`,"color:red;text-decoration:underline;font-weight:bold"),Kr.lines.forEach(function(on){if(on.errors.length>0){Vr(Zt(on.number,4)+"|  ","background-color:yellow; font-weight:bold"),Vr(on.line+J,"color:red; background-color:yellow; font-weight:bold");var zt=0;on.errors.forEach(function(fr){var Gr=fr.message,mn=/^\s*'(.*)'\s*:\s*(.*)$/.exec(Gr);if(mn){var Dr=mn[1];switch(Gr=mn[2],Dr){case"assign":Dr="=";break}zt=Math.max(on.line.indexOf(Dr,zt),0)}else zt=0;Vr(Zt("| ",6)),Vr(Zt("^^^",zt+3)+J,"font-weight:bold"),Vr(Zt("| ",6)),Vr(Gr+J,"font-weight:bold")}),Vr(Zt("| ",6)+J)}else Vr(Zt(on.number,4)+"|  "),Vr(on.line+J,"color:red")}),typeof document!="undefined"&&!window.chrome?(fn[0]=an.join("%c"),console.log.apply(console,fn)):console.log(an.join(""))}),w.raise("Error compiling "+pr+" shader, "+Zr[0].name)}}function Ye(j,Se,ke,qt,wr){if(!j.getProgramParameter(Se,j.LINK_STATUS)){var Yt=j.getProgramInfoLog(Se),pr=Cr(ke,wr),Zr=Cr(qt,wr),Wr='Error linking program with vertex shader, "'+Zr[0].name+'", and fragment shader "'+pr[0].name+'"';typeof document!="undefined"?console.log("%c"+Wr+J+"%c"+Yt,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(Wr+J+Yt),w.raise(Wr)}}function Et(j){j._commandRef=_t()}function Ne(j,Se,ke,qt){Et(j);function wr(Wr){return Wr?qt.id(Wr):0}j._fragId=wr(j.static.frag),j._vertId=wr(j.static.vert);function Yt(Wr,en){Object.keys(en).forEach(function(Kr){Wr[qt.id(Kr)]=!0})}var pr=j._uniformSet={};Yt(pr,Se.static),Yt(pr,Se.dynamic);var Zr=j._attributeSet={};Yt(Zr,ke.static),Yt(Zr,ke.dynamic),j._hasCount="count"in j.static||"count"in j.dynamic||"elements"in j.static||"elements"in j.dynamic}function Ae(j,Se){var ke=pt();p(j+" in command "+(Se||_t())+(ke==="unknown"?"":" called from "+ke))}function Be(j,Se,ke){j||Ae(Se,ke||_t())}function bt(j,Se,ke,qt){j in Se||Ae("unknown parameter ("+j+")"+F(ke)+". possible values: "+Object.keys(Se).join(),qt||_t())}function ir(j,Se,ke,qt){le(j,Se)||Ae("invalid parameter type"+F(ke)+". expected "+Se+", got "+typeof j,qt||_t())}function re(j){j()}function Ee(j,Se,ke){j.texture?we(j.texture._texture.internalformat,Se,"unsupported texture format for attachment"):we(j.renderbuffer._renderbuffer.format,ke,"unsupported renderbuffer format for attachment")}var ae=33071,me=9728,Te=9984,Qe=9985,dt=9986,Jt=9987,Nr=5120,Fr=5121,ln=5122,tr=5123,se=5124,ge=5125,Re=5126,tt=32819,Mt=32820,Dt=33635,S=34042,z=36193,pe={};pe[Nr]=pe[Fr]=1,pe[ln]=pe[tr]=pe[z]=pe[Dt]=pe[tt]=pe[Mt]=2,pe[se]=pe[ge]=pe[Re]=pe[S]=4;function Ue(j,Se){return j===Mt||j===tt||j===Dt?2:j===S?4:pe[j]*Se}function Je(j){return!(j&j-1)&&!!j}function mt(j,Se,ke){var qt,wr=Se.width,Yt=Se.height,pr=Se.channels;w(wr>0&&wr<=ke.maxTextureSize&&Yt>0&&Yt<=ke.maxTextureSize,"invalid texture shape"),(j.wrapS!==ae||j.wrapT!==ae)&&w(Je(wr)&&Je(Yt),"incompatible wrap mode for texture, both width and height must be power of 2"),Se.mipmask===1?wr!==1&&Yt!==1&&w(j.minFilter!==Te&&j.minFilter!==dt&&j.minFilter!==Qe&&j.minFilter!==Jt,"min filter requires mipmap"):(w(Je(wr)&&Je(Yt),"texture must be a square power of 2 to support mipmapping"),w(Se.mipmask===(wr<<1)-1,"missing or incomplete mipmap data")),Se.type===Re&&(ke.extensions.indexOf("oes_texture_float_linear")<0&&w(j.minFilter===me&&j.magFilter===me,"filter not supported, must enable oes_texture_float_linear"),w(!j.genMipmaps,"mipmap generation not supported with float textures"));var Zr=Se.images;for(qt=0;qt<16;++qt)if(Zr[qt]){var Wr=wr>>qt,en=Yt>>qt;w(Se.mipmask&1<<qt,"missing mipmap data");var Kr=Zr[qt];if(w(Kr.width===Wr&&Kr.height===en,"invalid shape for mip images"),w(Kr.format===Se.format&&Kr.internalformat===Se.internalformat&&Kr.type===Se.type,"incompatible type for mip image"),!Kr.compressed)if(Kr.data){var an=Math.ceil(Ue(Kr.type,pr)*Wr/Kr.unpackAlignment)*Kr.unpackAlignment;w(Kr.data.byteLength===an*en,"invalid data for image, buffer size is inconsistent with image format")}else Kr.element||Kr.copy}else j.genMipmaps||w((Se.mipmask&1<<qt)==0,"extra mipmap data");Se.compressed&&w(!j.genMipmaps,"mipmap generation for compressed images not supported")}function Ct(j,Se,ke,qt){var wr=j.width,Yt=j.height,pr=j.channels;w(wr>0&&wr<=qt.maxTextureSize&&Yt>0&&Yt<=qt.maxTextureSize,"invalid texture shape"),w(wr===Yt,"cube map must be square"),w(Se.wrapS===ae&&Se.wrapT===ae,"wrap mode not supported by cube map");for(var Zr=0;Zr<ke.length;++Zr){var Wr=ke[Zr];w(Wr.width===wr&&Wr.height===Yt,"inconsistent cube map face shape"),Se.genMipmaps&&(w(!Wr.compressed,"can not generate mipmap for compressed textures"),w(Wr.mipmask===1,"can not specify mipmaps and generate mipmaps"));for(var en=Wr.images,Kr=0;Kr<16;++Kr){var an=en[Kr];if(an){var fn=wr>>Kr,Vr=Yt>>Kr;w(Wr.mipmask&1<<Kr,"missing mipmap data"),w(an.width===fn&&an.height===Vr,"invalid shape for mip images"),w(an.format===j.format&&an.internalformat===j.internalformat&&an.type===j.type,"incompatible type for mip image"),an.compressed||(an.data?w(an.data.byteLength===fn*Vr*Math.max(Ue(an.type,pr),an.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):an.element||an.copy)}}}}var H=x(w,{optional:re,raise:p,commandRaise:Ae,command:Be,parameter:Q,commandParameter:bt,constructor:$t,type:ne,commandType:ir,isTypedArray:Y,nni:be,oneOf:we,shaderError:gt,linkError:Ye,callSite:pt,saveCommandRef:Et,saveDrawInfo:Ne,framebufferFormat:Ee,guessCommand:_t,texture2D:mt,textureCube:Ct}),Ht=0,Vt=0,_r=5,Er=6;function Ar(j,Se){this.id=Ht++,this.type=j,this.data=Se}function Pr(j){return j.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function Ke(j){if(j.length===0)return[];var Se=j.charAt(0),ke=j.charAt(j.length-1);if(j.length>1&&Se===ke&&(Se==='"'||Se==="'"))return['"'+Pr(j.substr(1,j.length-2))+'"'];var qt=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(j);if(qt)return Ke(j.substr(0,qt.index)).concat(Ke(qt[1])).concat(Ke(j.substr(qt.index+qt[0].length)));var wr=j.split(".");if(wr.length===1)return['"'+Pr(j)+'"'];for(var Yt=[],pr=0;pr<wr.length;++pr)Yt=Yt.concat(Ke(wr[pr]));return Yt}function yt(j){return"["+Ke(j).join("][")+"]"}function lt(j,Se){return new Ar(j,yt(Se+""))}function lr(j){return typeof j=="function"&&!j._reglType||j instanceof Ar}function qr(j,Se){if(typeof j=="function")return new Ar(Vt,j);if(typeof j=="number"||typeof j=="boolean")return new Ar(_r,j);if(Array.isArray(j))return new Ar(Er,j.map((ke,qt)=>qr(ke,Se+"["+qt+"]")));if(j instanceof Ar)return j;H(!1,"invalid option type in uniform "+Se)}var ut={DynamicVariable:Ar,define:lt,isDynamic:lr,unbox:qr,accessor:yt},It={next:typeof requestAnimationFrame=="function"?function(j){return requestAnimationFrame(j)}:function(j){return setTimeout(j,16)},cancel:typeof cancelAnimationFrame=="function"?function(j){return cancelAnimationFrame(j)}:clearTimeout},Qt=typeof performance!="undefined"&&performance.now?function(){return performance.now()}:function(){return+new Date};function gr(){var j={"":0},Se=[""];return{id:function(ke){var qt=j[ke];return qt||(qt=j[ke]=Se.length,Se.push(ke),qt)},str:function(ke){return Se[ke]}}}function gn(j,Se,ke){var qt=document.createElement("canvas");x(qt.style,{border:0,margin:0,padding:0,top:0,left:0}),j.appendChild(qt),j===document.body&&(qt.style.position="absolute",x(j.style,{margin:0,padding:0}));function wr(){var Zr=window.innerWidth,Wr=window.innerHeight;if(j!==document.body){var en=j.getBoundingClientRect();Zr=en.right-en.left,Wr=en.bottom-en.top}qt.width=ke*Zr,qt.height=ke*Wr,x(qt.style,{width:Zr+"px",height:Wr+"px"})}var Yt;j!==document.body&&typeof ResizeObserver=="function"?(Yt=new ResizeObserver(function(){setTimeout(wr)}),Yt.observe(j)):window.addEventListener("resize",wr,!1);function pr(){Yt?Yt.disconnect():window.removeEventListener("resize",wr),j.removeChild(qt)}return wr(),{canvas:qt,onDestroy:pr}}function Cn(j,Se){function ke(qt){try{return j.getContext(qt,Se)}catch(wr){return null}}return ke("webgl")||ke("experimental-webgl")||ke("webgl-experimental")}function vi(j){return typeof j.nodeName=="string"&&typeof j.appendChild=="function"&&typeof j.getBoundingClientRect=="function"}function xi(j){return typeof j.drawArrays=="function"||typeof j.drawElements=="function"}function Ri(j){return typeof j=="string"?j.split():(H(Array.isArray(j),"invalid extension array"),j)}function Wi(j){return typeof j=="string"?(H(typeof document!="undefined","not supported outside of DOM"),document.querySelector(j)):j}function si(j){var Se=j||{},ke,qt,wr,Yt,pr={},Zr=[],Wr=[],en=typeof window=="undefined"?1:window.devicePixelRatio,Kr=!1,an=function(on){on&&H.raise(on)},fn=function(){};if(typeof Se=="string"?(H(typeof document!="undefined","selector queries only supported in DOM enviroments"),ke=document.querySelector(Se),H(ke,"invalid query string for element")):typeof Se=="object"?vi(Se)?ke=Se:xi(Se)?(Yt=Se,wr=Yt.canvas):(H.constructor(Se),"gl"in Se?Yt=Se.gl:"canvas"in Se?wr=Wi(Se.canvas):"container"in Se&&(qt=Wi(Se.container)),"attributes"in Se&&(pr=Se.attributes,H.type(pr,"object","invalid context attributes")),"extensions"in Se&&(Zr=Ri(Se.extensions)),"optionalExtensions"in Se&&(Wr=Ri(Se.optionalExtensions)),"onDone"in Se&&(H.type(Se.onDone,"function","invalid or missing onDone callback"),an=Se.onDone),"profile"in Se&&(Kr=!!Se.profile),"pixelRatio"in Se&&(en=+Se.pixelRatio,H(en>0,"invalid pixel ratio"))):H.raise("invalid arguments to regl"),ke&&(ke.nodeName.toLowerCase()==="canvas"?wr=ke:qt=ke),!Yt){if(!wr){H(typeof document!="undefined","must manually specify webgl context outside of DOM environments");var Vr=gn(qt||document.body,an,en);if(!Vr)return null;wr=Vr.canvas,fn=Vr.onDestroy}pr.premultipliedAlpha===void 0&&(pr.premultipliedAlpha=!0),Yt=Cn(wr,pr)}return Yt?{gl:Yt,canvas:wr,container:qt,extensions:Zr,optionalExtensions:Wr,pixelRatio:en,profile:Kr,onDone:an,onDestroy:fn}:(fn(),an("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function G(j,Se){var ke={};function qt(pr){H.type(pr,"string","extension name must be string");var Zr=pr.toLowerCase(),Wr;try{Wr=ke[Zr]=j.getExtension(Zr)}catch(en){}return!!Wr}for(var wr=0;wr<Se.extensions.length;++wr){var Yt=Se.extensions[wr];if(!qt(Yt))return Se.onDestroy(),Se.onDone('"'+Yt+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return Se.optionalExtensions.forEach(qt),{extensions:ke,restore:function(){Object.keys(ke).forEach(function(pr){if(ke[pr]&&!qt(pr))throw new Error("(regl): error restoring extension "+pr)})}}}function I(j,Se){for(var ke=Array(j),qt=0;qt<j;++qt)ke[qt]=Se(qt);return ke}var Z=5120,$=5121,ie=5122,Le=5123,Ge=5124,ue=5125,De=5126;function wt(j){for(var Se=16;Se<=1<<28;Se*=16)if(j<=Se)return Se;return 0}function Ir(j){var Se,ke;return Se=(j>65535)<<4,j>>>=Se,ke=(j>255)<<3,j>>>=ke,Se|=ke,ke=(j>15)<<2,j>>>=ke,Se|=ke,ke=(j>3)<<1,j>>>=ke,Se|=ke,Se|j>>1}function Ur(){var j=I(8,function(){return[]});function Se(Yt){var pr=wt(Yt),Zr=j[Ir(pr)>>2];return Zr.length>0?Zr.pop():new ArrayBuffer(pr)}function ke(Yt){j[Ir(Yt.byteLength)>>2].push(Yt)}function qt(Yt,pr){var Zr=null;switch(Yt){case Z:Zr=new Int8Array(Se(pr),0,pr);break;case $:Zr=new Uint8Array(Se(pr),0,pr);break;case ie:Zr=new Int16Array(Se(2*pr),0,pr);break;case Le:Zr=new Uint16Array(Se(2*pr),0,pr);break;case Ge:Zr=new Int32Array(Se(4*pr),0,pr);break;case ue:Zr=new Uint32Array(Se(4*pr),0,pr);break;case De:Zr=new Float32Array(Se(4*pr),0,pr);break;default:return null}return Zr.length!==pr?Zr.subarray(0,pr):Zr}function wr(Yt){ke(Yt.buffer)}return{alloc:Se,free:ke,allocType:qt,freeType:wr}}var jt=Ur();jt.zero=Ur();var dr=3408,Hr=3410,_n=3411,vr=3412,vn=3413,$r=3414,cn=3415,pi=33901,pn=33902,_i=3379,Xi=3386,mi=34921,Di=36347,Pi=36348,po=35661,ji=35660,Rn=34930,Dn=36349,li=34076,Vn=34024,Na=7936,ps=7937,ki=7938,Ba=35724,xu=34047,uu=36063,_a=34852,oo=3553,Wa=34067,Xa=34069,Wo=33984,sa=6408,Ya=5126,Ta=5121,xa=36160,ta=36053,sl=36064,rs=16384,qa=function(j,Se){var ke=1;Se.ext_texture_filter_anisotropic&&(ke=j.getParameter(xu));var qt=1,wr=1;Se.webgl_draw_buffers&&(qt=j.getParameter(_a),wr=j.getParameter(uu));var Yt=!!Se.oes_texture_float;if(Yt){var pr=j.createTexture();j.bindTexture(oo,pr),j.texImage2D(oo,0,sa,1,1,0,sa,Ya,null);var Zr=j.createFramebuffer();if(j.bindFramebuffer(xa,Zr),j.framebufferTexture2D(xa,sl,oo,pr,0),j.bindTexture(oo,null),j.checkFramebufferStatus(xa)!==ta)Yt=!1;else{j.viewport(0,0,1,1),j.clearColor(1,0,0,1),j.clear(rs);var Wr=jt.allocType(Ya,4);j.readPixels(0,0,1,1,sa,Ya,Wr),j.getError()?Yt=!1:(j.deleteFramebuffer(Zr),j.deleteTexture(pr),Yt=Wr[0]===1),jt.freeType(Wr)}}var en=typeof navigator!="undefined"&&(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent)),Kr=!0;if(!en){var an=j.createTexture(),fn=jt.allocType(Ta,36);j.activeTexture(Wo),j.bindTexture(Wa,an),j.texImage2D(Xa,0,sa,3,3,0,sa,Ta,fn),jt.freeType(fn),j.bindTexture(Wa,null),j.deleteTexture(an),Kr=!j.getError()}return{colorBits:[j.getParameter(Hr),j.getParameter(_n),j.getParameter(vr),j.getParameter(vn)],depthBits:j.getParameter($r),stencilBits:j.getParameter(cn),subpixelBits:j.getParameter(dr),extensions:Object.keys(Se).filter(function(Vr){return!!Se[Vr]}),maxAnisotropic:ke,maxDrawbuffers:qt,maxColorAttachments:wr,pointSizeDims:j.getParameter(pi),lineWidthDims:j.getParameter(pn),maxViewportDims:j.getParameter(Xi),maxCombinedTextureUnits:j.getParameter(po),maxCubeMapSize:j.getParameter(li),maxRenderbufferSize:j.getParameter(Vn),maxTextureUnits:j.getParameter(Rn),maxTextureSize:j.getParameter(_i),maxAttributes:j.getParameter(mi),maxVertexUniforms:j.getParameter(Di),maxVertexTextureUnits:j.getParameter(ji),maxVaryingVectors:j.getParameter(Pi),maxFragmentUniforms:j.getParameter(Dn),glsl:j.getParameter(Ba),renderer:j.getParameter(ps),vendor:j.getParameter(Na),version:j.getParameter(ki),readFloat:Yt,npotTextureCube:Kr}};function La(j){return!!j&&typeof j=="object"&&Array.isArray(j.shape)&&Array.isArray(j.stride)&&typeof j.offset=="number"&&j.shape.length===j.stride.length&&(Array.isArray(j.data)||L(j.data))}var fa=function(j){return Object.keys(j).map(function(Se){return j[Se]})},he={shape:Zi,flatten:kn};function Pe(j,Se,ke){for(var qt=0;qt<Se;++qt)ke[qt]=j[qt]}function ct(j,Se,ke,qt){for(var wr=0,Yt=0;Yt<Se;++Yt)for(var pr=j[Yt],Zr=0;Zr<ke;++Zr)qt[wr++]=pr[Zr]}function cr(j,Se,ke,qt,wr,Yt){for(var pr=Yt,Zr=0;Zr<Se;++Zr)for(var Wr=j[Zr],en=0;en<ke;++en)for(var Kr=Wr[en],an=0;an<qt;++an)wr[pr++]=Kr[an]}function tn(j,Se,ke,qt,wr){for(var Yt=1,pr=ke+1;pr<Se.length;++pr)Yt*=Se[pr];var Zr=Se[ke];if(Se.length-ke==4){var Wr=Se[ke+1],en=Se[ke+2],Kr=Se[ke+3];for(pr=0;pr<Zr;++pr)cr(j[pr],Wr,en,Kr,qt,wr),wr+=Yt}else for(pr=0;pr<Zr;++pr)tn(j[pr],Se,ke+1,qt,wr),wr+=Yt}function kn(j,Se,ke,qt){var wr=1;if(Se.length)for(var Yt=0;Yt<Se.length;++Yt)wr*=Se[Yt];else wr=0;var pr=qt||jt.allocType(ke,wr);switch(Se.length){case 0:break;case 1:Pe(j,Se[0],pr);break;case 2:ct(j,Se[0],Se[1],pr);break;case 3:cr(j,Se[0],Se[1],Se[2],pr,0);break;default:tn(j,Se,0,pr,0)}return pr}function Zi(j){for(var Se=[],ke=j;ke.length;ke=ke[0])Se.push(ke.length);return Se}var Yi={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},Ka=5120,$a=5122,Xo=5124,xs=5121,Hl=5123,Xu=5125,Ro=5126,Cs=5126,so={int8:Ka,int16:$a,int32:Xo,uint8:xs,uint16:Hl,uint32:Xu,float:Ro,float32:Cs},Ps=35048,Ra=35040,ci={dynamic:Ps,stream:Ra,static:35044},ul=he.flatten,ba=he.shape,Nn=35044,Ws=35040,Wl=5121,uo=5126,je=[];je[5120]=1,je[5122]=2,je[5124]=4,je[5121]=1,je[5123]=2,je[5125]=4,je[5126]=4;function Pt(j){return Yi[Object.prototype.toString.call(j)]|0}function yr(j,Se){for(var ke=0;ke<Se.length;++ke)j[ke]=Se[ke]}function On(j,Se,ke,qt,wr,Yt,pr){for(var Zr=0,Wr=0;Wr<ke;++Wr)for(var en=0;en<qt;++en)j[Zr++]=Se[wr*Wr+Yt*en+pr]}function Gi(j,Se,ke,qt){var wr=0,Yt={};function pr(zt){this.id=wr++,this.buffer=j.createBuffer(),this.type=zt,this.usage=Nn,this.byteLength=0,this.dimension=1,this.dtype=Wl,this.persistentData=null,ke.profile&&(this.stats={size:0})}pr.prototype.bind=function(){j.bindBuffer(this.type,this.buffer)},pr.prototype.destroy=function(){fn(this)};var Zr=[];function Wr(zt,fr){var Gr=Zr.pop();return Gr||(Gr=new pr(zt)),Gr.bind(),an(Gr,fr,Ws,0,1,!1),Gr}function en(zt){Zr.push(zt)}function Kr(zt,fr,Gr){zt.byteLength=fr.byteLength,j.bufferData(zt.type,fr,Gr)}function an(zt,fr,Gr,mn,Dr,En){var zr;if(zt.usage=Gr,Array.isArray(fr)){if(zt.dtype=mn||uo,fr.length>0){var sn;if(Array.isArray(fr[0])){zr=ba(fr);for(var Rr=1,nn=1;nn<zr.length;++nn)Rr*=zr[nn];zt.dimension=Rr,sn=ul(fr,zr,zt.dtype),Kr(zt,sn,Gr),En?zt.persistentData=sn:jt.freeType(sn)}else if(typeof fr[0]=="number"){zt.dimension=Dr;var Kn=jt.allocType(zt.dtype,fr.length);yr(Kn,fr),Kr(zt,Kn,Gr),En?zt.persistentData=Kn:jt.freeType(Kn)}else L(fr[0])?(zt.dimension=fr[0].length,zt.dtype=mn||Pt(fr[0])||uo,sn=ul(fr,[fr.length,fr[0].length],zt.dtype),Kr(zt,sn,Gr),En?zt.persistentData=sn:jt.freeType(sn)):H.raise("invalid buffer data")}}else if(L(fr))zt.dtype=mn||Pt(fr),zt.dimension=Dr,Kr(zt,fr,Gr),En&&(zt.persistentData=new Uint8Array(new Uint8Array(fr.buffer)));else if(La(fr)){zr=fr.shape;var Yn=fr.stride,un=fr.offset,kr=0,Or=0,ui=0,qn=0;zr.length===1?(kr=zr[0],Or=1,ui=Yn[0],qn=0):zr.length===2?(kr=zr[0],Or=zr[1],ui=Yn[0],qn=Yn[1]):H.raise("invalid shape"),zt.dtype=mn||Pt(fr.data)||uo,zt.dimension=Or;var Ln=jt.allocType(zt.dtype,kr*Or);On(Ln,fr.data,kr,Or,ui,qn,un),Kr(zt,Ln,Gr),En?zt.persistentData=Ln:jt.freeType(Ln)}else fr instanceof ArrayBuffer?(zt.dtype=Wl,zt.dimension=Dr,Kr(zt,fr,Gr),En&&(zt.persistentData=new Uint8Array(new Uint8Array(fr)))):H.raise("invalid buffer data")}function fn(zt){Se.bufferCount--,qt(zt);var fr=zt.buffer;H(fr,"buffer must not be deleted already"),j.deleteBuffer(fr),zt.buffer=null,delete Yt[zt.id]}function Vr(zt,fr,Gr,mn){Se.bufferCount++;var Dr=new pr(fr);Yt[Dr.id]=Dr;function En(Rr){var nn=Nn,Kn=null,Yn=0,un=0,kr=1;return Array.isArray(Rr)||L(Rr)||La(Rr)||Rr instanceof ArrayBuffer?Kn=Rr:typeof Rr=="number"?Yn=Rr|0:Rr&&(H.type(Rr,"object","buffer arguments must be an object, a number or an array"),"data"in Rr&&(H(Kn===null||Array.isArray(Kn)||L(Kn)||La(Kn),"invalid data for buffer"),Kn=Rr.data),"usage"in Rr&&(H.parameter(Rr.usage,ci,"invalid buffer usage"),nn=ci[Rr.usage]),"type"in Rr&&(H.parameter(Rr.type,so,"invalid buffer type"),un=so[Rr.type]),"dimension"in Rr&&(H.type(Rr.dimension,"number","invalid dimension"),kr=Rr.dimension|0),"length"in Rr&&(H.nni(Yn,"buffer length must be a nonnegative integer"),Yn=Rr.length|0)),Dr.bind(),Kn?an(Dr,Kn,nn,un,kr,mn):(Yn&&j.bufferData(Dr.type,Yn,nn),Dr.dtype=un||Wl,Dr.usage=nn,Dr.dimension=kr,Dr.byteLength=Yn),ke.profile&&(Dr.stats.size=Dr.byteLength*je[Dr.dtype]),En}function zr(Rr,nn){H(nn+Rr.byteLength<=Dr.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+Rr.byteLength+" starting from offset "+nn+" to a buffer of size "+Dr.byteLength),j.bufferSubData(Dr.type,nn,Rr)}function sn(Rr,nn){var Kn=(nn||0)|0,Yn;if(Dr.bind(),L(Rr)||Rr instanceof ArrayBuffer)zr(Rr,Kn);else if(Array.isArray(Rr)){if(Rr.length>0)if(typeof Rr[0]=="number"){var un=jt.allocType(Dr.dtype,Rr.length);yr(un,Rr),zr(un,Kn),jt.freeType(un)}else if(Array.isArray(Rr[0])||L(Rr[0])){Yn=ba(Rr);var kr=ul(Rr,Yn,Dr.dtype);zr(kr,Kn),jt.freeType(kr)}else H.raise("invalid buffer data")}else if(La(Rr)){Yn=Rr.shape;var Or=Rr.stride,ui=0,qn=0,Ln=0,Bi=0;Yn.length===1?(ui=Yn[0],qn=1,Ln=Or[0],Bi=0):Yn.length===2?(ui=Yn[0],qn=Yn[1],Ln=Or[0],Bi=Or[1]):H.raise("invalid shape");var Ai=Array.isArray(Rr.data)?Dr.dtype:Pt(Rr.data),Mi=jt.allocType(Ai,ui*qn);On(Mi,Rr.data,ui,qn,Ln,Bi,Rr.offset),zr(Mi,Kn),jt.freeType(Mi)}else H.raise("invalid data for buffer subdata");return En}return Gr||En(zt),En._reglType="buffer",En._buffer=Dr,En.subdata=sn,ke.profile&&(En.stats=Dr.stats),En.destroy=function(){fn(Dr)},En}function on(){fa(Yt).forEach(function(zt){zt.buffer=j.createBuffer(),j.bindBuffer(zt.type,zt.buffer),j.bufferData(zt.type,zt.persistentData||zt.byteLength,zt.usage)})}return ke.profile&&(Se.getTotalBufferSize=function(){var zt=0;return Object.keys(Yt).forEach(function(fr){zt+=Yt[fr].stats.size}),zt}),{create:Vr,createStream:Wr,destroyStream:en,clear:function(){fa(Yt).forEach(fn),Zr.forEach(fn)},getBuffer:function(zt){return zt&&zt._buffer instanceof pr?zt._buffer:null},restore:on,_initBuffer:an}}var Sa=0,Za=0,ra=1,Da=1,Do=4,Co=4,bi={points:Sa,point:Za,lines:ra,line:Da,triangles:Do,triangle:Co,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},Yu=0,lu=1,Yo=4,ll=5120,bo=5121,bs=5122,Po=5123,cu=5124,Ms=5125,uc=34963,Kc=35040,Aa=35044;function gf(j,Se,ke,qt){var wr={},Yt=0,pr={uint8:bo,uint16:Po};Se.oes_element_index_uint&&(pr.uint32=Ms);function Zr(on){this.id=Yt++,wr[this.id]=this,this.buffer=on,this.primType=Yo,this.vertCount=0,this.type=0}Zr.prototype.bind=function(){this.buffer.bind()};var Wr=[];function en(on){var zt=Wr.pop();return zt||(zt=new Zr(ke.create(null,uc,!0,!1)._buffer)),an(zt,on,Kc,-1,-1,0,0),zt}function Kr(on){Wr.push(on)}function an(on,zt,fr,Gr,mn,Dr,En){on.buffer.bind();var zr;if(zt){var sn=En;!En&&(!L(zt)||La(zt)&&!L(zt.data))&&(sn=Se.oes_element_index_uint?Ms:Po),ke._initBuffer(on.buffer,zt,fr,sn,3)}else j.bufferData(uc,Dr,fr),on.buffer.dtype=zr||bo,on.buffer.usage=fr,on.buffer.dimension=3,on.buffer.byteLength=Dr;if(zr=En,!En){switch(on.buffer.dtype){case bo:case ll:zr=bo;break;case Po:case bs:zr=Po;break;case Ms:case cu:zr=Ms;break;default:H.raise("unsupported type for element array")}on.buffer.dtype=zr}on.type=zr,H(zr!==Ms||!!Se.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var Rr=mn;Rr<0&&(Rr=on.buffer.byteLength,zr===Po?Rr>>=1:zr===Ms&&(Rr>>=2)),on.vertCount=Rr;var nn=Gr;if(Gr<0){nn=Yo;var Kn=on.buffer.dimension;Kn===1&&(nn=Yu),Kn===2&&(nn=lu),Kn===3&&(nn=Yo)}on.primType=nn}function fn(on){qt.elementsCount--,H(on.buffer!==null,"must not double destroy elements"),delete wr[on.id],on.buffer.destroy(),on.buffer=null}function Vr(on,zt){var fr=ke.create(null,uc,!0),Gr=new Zr(fr._buffer);qt.elementsCount++;function mn(Dr){if(!Dr)fr(),Gr.primType=Yo,Gr.vertCount=0,Gr.type=bo;else if(typeof Dr=="number")fr(Dr),Gr.primType=Yo,Gr.vertCount=Dr|0,Gr.type=bo;else{var En=null,zr=Aa,sn=-1,Rr=-1,nn=0,Kn=0;Array.isArray(Dr)||L(Dr)||La(Dr)?En=Dr:(H.type(Dr,"object","invalid arguments for elements"),"data"in Dr&&(En=Dr.data,H(Array.isArray(En)||L(En)||La(En),"invalid data for element buffer")),"usage"in Dr&&(H.parameter(Dr.usage,ci,"invalid element buffer usage"),zr=ci[Dr.usage]),"primitive"in Dr&&(H.parameter(Dr.primitive,bi,"invalid element buffer primitive"),sn=bi[Dr.primitive]),"count"in Dr&&(H(typeof Dr.count=="number"&&Dr.count>=0,"invalid vertex count for elements"),Rr=Dr.count|0),"type"in Dr&&(H.parameter(Dr.type,pr,"invalid buffer type"),Kn=pr[Dr.type]),"length"in Dr?nn=Dr.length|0:(nn=Rr,Kn===Po||Kn===bs?nn*=2:(Kn===Ms||Kn===cu)&&(nn*=4))),an(Gr,En,zr,sn,Rr,nn,Kn)}return mn}return mn(on),mn._reglType="elements",mn._elements=Gr,mn.subdata=function(Dr,En){return fr.subdata(Dr,En),mn},mn.destroy=function(){fn(Gr)},mn}return{create:Vr,createStream:en,destroyStream:Kr,getElements:function(on){return typeof on=="function"&&on._elements instanceof Zr?on._elements:null},clear:function(){fa(wr).forEach(fn)}}}var ku=new Float32Array(1),Ml=new Uint32Array(ku.buffer),Ic=5123;function lc(j){for(var Se=jt.allocType(Ic,j.length),ke=0;ke<j.length;++ke)if(isNaN(j[ke]))Se[ke]=65535;else if(j[ke]===Infinity)Se[ke]=31744;else if(j[ke]===-Infinity)Se[ke]=64512;else{ku[0]=j[ke];var qt=Ml[0],wr=qt>>>31<<15,Yt=(qt<<1>>>24)-127,pr=qt>>13&(1<<10)-1;if(Yt<-24)Se[ke]=wr;else if(Yt<-14){var Zr=-14-Yt;Se[ke]=wr+(pr+(1<<10)>>Zr)}else Yt>15?Se[ke]=wr+31744:Se[ke]=wr+(Yt+15<<10)+pr}return Se}function eo(j){return Array.isArray(j)||L(j)}var cl=function(j){return!(j&j-1)&&!!j},fl=34467,ns=3553,cc=34067,Ku=34069,Xs=6408,Ko=6406,Oc=6407,bu=6409,$u=6410,Of=32854,hl=32855,Ea=36194,Ju=32819,Xl=32820,Yl=33635,Ys=34042,Lc=6402,Kl=34041,$l=35904,Qu=35906,Su=36193,Il=33776,Ol=33777,pl=33778,Rc=33779,dl=35986,Ks=35987,Ll=34798,$c=35840,Jc=35841,ma=35842,Jl=35843,fc=36196,qu=5121,Rl=5123,hc=5125,Fu=5126,Dc=10242,Qc=10243,qc=10497,Dl=33071,kc=33648,Fc=10240,zc=10241,vl=9728,Nc=9729,zu=9984,ka=9985,Ql=9986,Nu=9987,el=33170,Ni=4352,Pa=4353,Ma=4354,ql=34046,kl=3317,ec=37440,yf=37441,_f=37443,Fl=37444,Bu=33984,Uu=[zu,Ql,ka,Nu],to=[0,bu,$u,Oc,Xs],ds={};ds[bu]=ds[Ko]=ds[Lc]=1,ds[Kl]=ds[$u]=2,ds[Oc]=ds[$l]=3,ds[Xs]=ds[Qu]=4;function ml(j){return"[object "+j+"]"}var lo=ml("HTMLCanvasElement"),Tn=ml("OffscreenCanvas"),Is=ml("CanvasRenderingContext2D"),tc=ml("ImageBitmap"),gl=ml("HTMLImageElement"),$s=ml("HTMLVideoElement"),Us=Object.keys(Yi).concat([lo,Tn,Is,tc,gl,$s]),yl=[];yl[qu]=1,yl[Fu]=4,yl[Su]=2,yl[Rl]=2,yl[hc]=4;var Jr=[];Jr[Of]=2,Jr[hl]=2,Jr[Ea]=2,Jr[Kl]=4,Jr[Il]=.5,Jr[Ol]=.5,Jr[pl]=1,Jr[Rc]=1,Jr[dl]=.5,Jr[Ks]=1,Jr[Ll]=1,Jr[$c]=.5,Jr[Jc]=.25,Jr[ma]=.5,Jr[Jl]=.25,Jr[fc]=.5;function Bc(j){return Array.isArray(j)&&(j.length===0||typeof j[0]=="number")}function pc(j){if(!Array.isArray(j))return!1;var Se=j.length;return!(Se===0||!eo(j[0]))}function tl(j){return Object.prototype.toString.call(j)}function Js(j){return tl(j)===lo}function Ss(j){return tl(j)===Tn}function dc(j){return tl(j)===Is}function vc(j){return tl(j)===tc}function Os(j){return tl(j)===gl}function ju(j){return tl(j)===$s}function _l(j){if(!j)return!1;var Se=tl(j);return Us.indexOf(Se)>=0?!0:Bc(j)||pc(j)||La(j)}function zl(j){return Yi[Object.prototype.toString.call(j)]|0}function ef(j,Se){var ke=Se.length;switch(j.type){case qu:case Rl:case hc:case Fu:var qt=jt.allocType(j.type,ke);qt.set(Se),j.data=qt;break;case Su:j.data=lc(Se);break;default:H.raise("unsupported texture type, must specify a typed array")}}function Uc(j,Se){return jt.allocType(j.type===Su?Fu:j.type,Se)}function Eu(j,Se){j.type===Su?(j.data=lc(Se),jt.freeType(Se)):j.data=Se}function Qs(j,Se,ke,qt,wr,Yt){for(var pr=j.width,Zr=j.height,Wr=j.channels,en=pr*Zr*Wr,Kr=Uc(j,en),an=0,fn=0;fn<Zr;++fn)for(var Vr=0;Vr<pr;++Vr)for(var on=0;on<Wr;++on)Kr[an++]=Se[ke*Vr+qt*fn+wr*on+Yt];Eu(j,Kr)}function Fi(j,Se,ke,qt,wr,Yt){var pr;if(typeof Jr[j]!="undefined"?pr=Jr[j]:pr=ds[j]*yl[Se],Yt&&(pr*=6),wr){for(var Zr=0,Wr=ke;Wr>=1;)Zr+=pr*Wr*Wr,Wr/=2;return Zr}else return pr*ke*qt}function Zu(j,Se,ke,qt,wr,Yt,pr){var Zr={"don't care":Ni,"dont care":Ni,nice:Ma,fast:Pa},Wr={repeat:qc,clamp:Dl,mirror:kc},en={nearest:vl,linear:Nc},Kr=x({mipmap:Nu,"nearest mipmap nearest":zu,"linear mipmap nearest":ka,"nearest mipmap linear":Ql,"linear mipmap linear":Nu},en),an={none:0,browser:Fl},fn={uint8:qu,rgba4:Ju,rgb565:Yl,"rgb5 a1":Xl},Vr={alpha:Ko,luminance:bu,"luminance alpha":$u,rgb:Oc,rgba:Xs,rgba4:Of,"rgb5 a1":hl,rgb565:Ea},on={};Se.ext_srgb&&(Vr.srgb=$l,Vr.srgba=Qu),Se.oes_texture_float&&(fn.float32=fn.float=Fu),Se.oes_texture_half_float&&(fn.float16=fn["half float"]=Su),Se.webgl_depth_texture&&(x(Vr,{depth:Lc,"depth stencil":Kl}),x(fn,{uint16:Rl,uint32:hc,"depth stencil":Ys})),Se.webgl_compressed_texture_s3tc&&x(on,{"rgb s3tc dxt1":Il,"rgba s3tc dxt1":Ol,"rgba s3tc dxt3":pl,"rgba s3tc dxt5":Rc}),Se.webgl_compressed_texture_atc&&x(on,{"rgb atc":dl,"rgba atc explicit alpha":Ks,"rgba atc interpolated alpha":Ll}),Se.webgl_compressed_texture_pvrtc&&x(on,{"rgb pvrtc 4bppv1":$c,"rgb pvrtc 2bppv1":Jc,"rgba pvrtc 4bppv1":ma,"rgba pvrtc 2bppv1":Jl}),Se.webgl_compressed_texture_etc1&&(on["rgb etc1"]=fc);var zt=Array.prototype.slice.call(j.getParameter(fl));Object.keys(on).forEach(function(Fe){var er=on[Fe];zt.indexOf(er)>=0&&(Vr[Fe]=er)});var fr=Object.keys(Vr);ke.textureFormats=fr;var Gr=[];Object.keys(Vr).forEach(function(Fe){var er=Vr[Fe];Gr[er]=Fe});var mn=[];Object.keys(fn).forEach(function(Fe){var er=fn[Fe];mn[er]=Fe});var Dr=[];Object.keys(en).forEach(function(Fe){var er=en[Fe];Dr[er]=Fe});var En=[];Object.keys(Kr).forEach(function(Fe){var er=Kr[Fe];En[er]=Fe});var zr=[];Object.keys(Wr).forEach(function(Fe){var er=Wr[Fe];zr[er]=Fe});var sn=fr.reduce(function(Fe,er){var Wt=Vr[er];return Wt===bu||Wt===Ko||Wt===bu||Wt===$u||Wt===Lc||Wt===Kl||Se.ext_srgb&&(Wt===$l||Wt===Qu)?Fe[Wt]=Wt:Wt===hl||er.indexOf("rgba")>=0?Fe[Wt]=Xs:Fe[Wt]=Oc,Fe},{});function Rr(){this.internalformat=Xs,this.format=Xs,this.type=qu,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=Fl,this.width=0,this.height=0,this.channels=0}function nn(Fe,er){Fe.internalformat=er.internalformat,Fe.format=er.format,Fe.type=er.type,Fe.compressed=er.compressed,Fe.premultiplyAlpha=er.premultiplyAlpha,Fe.flipY=er.flipY,Fe.unpackAlignment=er.unpackAlignment,Fe.colorSpace=er.colorSpace,Fe.width=er.width,Fe.height=er.height,Fe.channels=er.channels}function Kn(Fe,er){if(!(typeof er!="object"||!er)){if("premultiplyAlpha"in er&&(H.type(er.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),Fe.premultiplyAlpha=er.premultiplyAlpha),"flipY"in er&&(H.type(er.flipY,"boolean","invalid texture flip"),Fe.flipY=er.flipY),"alignment"in er&&(H.oneOf(er.alignment,[1,2,4,8],"invalid texture unpack alignment"),Fe.unpackAlignment=er.alignment),"colorSpace"in er&&(H.parameter(er.colorSpace,an,"invalid colorSpace"),Fe.colorSpace=an[er.colorSpace]),"type"in er){var Wt=er.type;H(Se.oes_texture_float||!(Wt==="float"||Wt==="float32"),"you must enable the OES_texture_float extension in order to use floating point textures."),H(Se.oes_texture_half_float||!(Wt==="half float"||Wt==="float16"),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),H(Se.webgl_depth_texture||!(Wt==="uint16"||Wt==="uint32"||Wt==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),H.parameter(Wt,fn,"invalid texture type"),Fe.type=fn[Wt]}var An=Fe.width,Vi=Fe.height,Oe=Fe.channels,_e=!1;"shape"in er?(H(Array.isArray(er.shape)&&er.shape.length>=2,"shape must be an array"),An=er.shape[0],Vi=er.shape[1],er.shape.length===3&&(Oe=er.shape[2],H(Oe>0&&Oe<=4,"invalid number of channels"),_e=!0),H(An>=0&&An<=ke.maxTextureSize,"invalid width"),H(Vi>=0&&Vi<=ke.maxTextureSize,"invalid height")):("radius"in er&&(An=Vi=er.radius,H(An>=0&&An<=ke.maxTextureSize,"invalid radius")),"width"in er&&(An=er.width,H(An>=0&&An<=ke.maxTextureSize,"invalid width")),"height"in er&&(Vi=er.height,H(Vi>=0&&Vi<=ke.maxTextureSize,"invalid height")),"channels"in er&&(Oe=er.channels,H(Oe>0&&Oe<=4,"invalid number of channels"),_e=!0)),Fe.width=An|0,Fe.height=Vi|0,Fe.channels=Oe|0;var at=!1;if("format"in er){var Ot=er.format;H(Se.webgl_depth_texture||!(Ot==="depth"||Ot==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),H.parameter(Ot,Vr,"invalid texture format");var kt=Fe.internalformat=Vr[Ot];Fe.format=sn[kt],Ot in fn&&("type"in er||(Fe.type=fn[Ot])),Ot in on&&(Fe.compressed=!0),at=!0}!_e&&at?Fe.channels=ds[Fe.format]:_e&&!at?Fe.channels!==to[Fe.format]&&(Fe.format=Fe.internalformat=to[Fe.channels]):at&&_e&&H(Fe.channels===ds[Fe.format],"number of channels inconsistent with specified format")}}function Yn(Fe){j.pixelStorei(ec,Fe.flipY),j.pixelStorei(yf,Fe.premultiplyAlpha),j.pixelStorei(_f,Fe.colorSpace),j.pixelStorei(kl,Fe.unpackAlignment)}function un(){Rr.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function kr(Fe,er){var Wt=null;if(_l(er)?Wt=er:er&&(H.type(er,"object","invalid pixel data type"),Kn(Fe,er),"x"in er&&(Fe.xOffset=er.x|0),"y"in er&&(Fe.yOffset=er.y|0),_l(er.data)&&(Wt=er.data)),H(!Fe.compressed||Wt instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),er.copy){H(!Wt,"can not specify copy and data field for the same texture");var An=wr.viewportWidth,Vi=wr.viewportHeight;Fe.width=Fe.width||An-Fe.xOffset,Fe.height=Fe.height||Vi-Fe.yOffset,Fe.needsCopy=!0,H(Fe.xOffset>=0&&Fe.xOffset<An&&Fe.yOffset>=0&&Fe.yOffset<Vi&&Fe.width>0&&Fe.width<=An&&Fe.height>0&&Fe.height<=Vi,"copy texture read out of bounds")}else if(!Wt)Fe.width=Fe.width||1,Fe.height=Fe.height||1,Fe.channels=Fe.channels||4;else if(L(Wt))Fe.channels=Fe.channels||4,Fe.data=Wt,!("type"in er)&&Fe.type===qu&&(Fe.type=zl(Wt));else if(Bc(Wt))Fe.channels=Fe.channels||4,ef(Fe,Wt),Fe.alignment=1,Fe.needsFree=!0;else if(La(Wt)){var Oe=Wt.data;!Array.isArray(Oe)&&Fe.type===qu&&(Fe.type=zl(Oe));var _e=Wt.shape,at=Wt.stride,Ot,kt,ft,ot,St,Me;_e.length===3?(ft=_e[2],Me=at[2]):(H(_e.length===2,"invalid ndarray pixel data, must be 2 or 3D"),ft=1,Me=1),Ot=_e[0],kt=_e[1],ot=at[0],St=at[1],Fe.alignment=1,Fe.width=Ot,Fe.height=kt,Fe.channels=ft,Fe.format=Fe.internalformat=to[ft],Fe.needsFree=!0,Qs(Fe,Oe,ot,St,Me,Wt.offset)}else if(Js(Wt)||Ss(Wt)||dc(Wt))Js(Wt)||Ss(Wt)?Fe.element=Wt:Fe.element=Wt.canvas,Fe.width=Fe.element.width,Fe.height=Fe.element.height,Fe.channels=4;else if(vc(Wt))Fe.element=Wt,Fe.width=Wt.width,Fe.height=Wt.height,Fe.channels=4;else if(Os(Wt))Fe.element=Wt,Fe.width=Wt.naturalWidth,Fe.height=Wt.naturalHeight,Fe.channels=4;else if(ju(Wt))Fe.element=Wt,Fe.width=Wt.videoWidth,Fe.height=Wt.videoHeight,Fe.channels=4;else if(pc(Wt)){var qe=Fe.width||Wt[0].length,Ce=Fe.height||Wt.length,At=Fe.channels;eo(Wt[0][0])?At=At||Wt[0][0].length:At=At||1;for(var Bt=he.shape(Wt),Sr=1,Kt=0;Kt<Bt.length;++Kt)Sr*=Bt[Kt];var br=Uc(Fe,Sr);he.flatten(Wt,Bt,"",br),Eu(Fe,br),Fe.alignment=1,Fe.width=qe,Fe.height=Ce,Fe.channels=At,Fe.format=Fe.internalformat=to[At],Fe.needsFree=!0}Fe.type===Fu?H(ke.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):Fe.type===Su&&H(ke.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function Or(Fe,er,Wt){var An=Fe.element,Vi=Fe.data,Oe=Fe.internalformat,_e=Fe.format,at=Fe.type,Ot=Fe.width,kt=Fe.height;Yn(Fe),An?j.texImage2D(er,Wt,_e,_e,at,An):Fe.compressed?j.compressedTexImage2D(er,Wt,Oe,Ot,kt,0,Vi):Fe.needsCopy?(qt(),j.copyTexImage2D(er,Wt,_e,Fe.xOffset,Fe.yOffset,Ot,kt,0)):j.texImage2D(er,Wt,_e,Ot,kt,0,_e,at,Vi||null)}function ui(Fe,er,Wt,An,Vi){var Oe=Fe.element,_e=Fe.data,at=Fe.internalformat,Ot=Fe.format,kt=Fe.type,ft=Fe.width,ot=Fe.height;Yn(Fe),Oe?j.texSubImage2D(er,Vi,Wt,An,Ot,kt,Oe):Fe.compressed?j.compressedTexSubImage2D(er,Vi,Wt,An,at,ft,ot,_e):Fe.needsCopy?(qt(),j.copyTexSubImage2D(er,Vi,Wt,An,Fe.xOffset,Fe.yOffset,ft,ot)):j.texSubImage2D(er,Vi,Wt,An,ft,ot,Ot,kt,_e)}var qn=[];function Ln(){return qn.pop()||new un}function Bi(Fe){Fe.needsFree&&jt.freeType(Fe.data),un.call(Fe),qn.push(Fe)}function Ai(){Rr.call(this),this.genMipmaps=!1,this.mipmapHint=Ni,this.mipmask=0,this.images=Array(16)}function Mi(Fe,er,Wt){var An=Fe.images[0]=Ln();Fe.mipmask=1,An.width=Fe.width=er,An.height=Fe.height=Wt,An.channels=Fe.channels=4}function na(Fe,er){var Wt=null;if(_l(er))Wt=Fe.images[0]=Ln(),nn(Wt,Fe),kr(Wt,er),Fe.mipmask=1;else if(Kn(Fe,er),Array.isArray(er.mipmap))for(var An=er.mipmap,Vi=0;Vi<An.length;++Vi)Wt=Fe.images[Vi]=Ln(),nn(Wt,Fe),Wt.width>>=Vi,Wt.height>>=Vi,kr(Wt,An[Vi]),Fe.mipmask|=1<<Vi;else Wt=Fe.images[0]=Ln(),nn(Wt,Fe),kr(Wt,er),Fe.mipmask=1;nn(Fe,Fe.images[0]),Fe.compressed&&(Fe.internalformat===Il||Fe.internalformat===Ol||Fe.internalformat===pl||Fe.internalformat===Rc)&&H(Fe.width%4==0&&Fe.height%4==0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function Qo(Fe,er){for(var Wt=Fe.images,An=0;An<Wt.length;++An){if(!Wt[An])return;Or(Wt[An],er,An)}}var Rs=[];function Qi(){var Fe=Rs.pop()||new Ai;Rr.call(Fe),Fe.mipmask=0;for(var er=0;er<16;++er)Fe.images[er]=null;return Fe}function Eo(Fe){for(var er=Fe.images,Wt=0;Wt<er.length;++Wt)er[Wt]&&Bi(er[Wt]),er[Wt]=null;Rs.push(Fe)}function ua(){this.minFilter=vl,this.magFilter=vl,this.wrapS=Dl,this.wrapT=Dl,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=Ni}function wo(Fe,er){if("min"in er){var Wt=er.min;H.parameter(Wt,Kr),Fe.minFilter=Kr[Wt],Uu.indexOf(Fe.minFilter)>=0&&!("faces"in er)&&(Fe.genMipmaps=!0)}if("mag"in er){var An=er.mag;H.parameter(An,en),Fe.magFilter=en[An]}var Vi=Fe.wrapS,Oe=Fe.wrapT;if("wrap"in er){var _e=er.wrap;typeof _e=="string"?(H.parameter(_e,Wr),Vi=Oe=Wr[_e]):Array.isArray(_e)&&(H.parameter(_e[0],Wr),H.parameter(_e[1],Wr),Vi=Wr[_e[0]],Oe=Wr[_e[1]])}else{if("wrapS"in er){var at=er.wrapS;H.parameter(at,Wr),Vi=Wr[at]}if("wrapT"in er){var Ot=er.wrapT;H.parameter(Ot,Wr),Oe=Wr[Ot]}}if(Fe.wrapS=Vi,Fe.wrapT=Oe,"anisotropic"in er){var kt=er.anisotropic;H(typeof kt=="number"&&kt>=1&&kt<=ke.maxAnisotropic,"aniso samples must be between 1 and "),Fe.anisotropic=er.anisotropic}if("mipmap"in er){var ft=!1;switch(typeof er.mipmap){case"string":H.parameter(er.mipmap,Zr,"invalid mipmap hint"),Fe.mipmapHint=Zr[er.mipmap],Fe.genMipmaps=!0,ft=!0;break;case"boolean":ft=Fe.genMipmaps=er.mipmap;break;case"object":H(Array.isArray(er.mipmap),"invalid mipmap type"),Fe.genMipmaps=!1,ft=!0;break;default:H.raise("invalid mipmap type")}ft&&!("min"in er)&&(Fe.minFilter=zu)}}function qo(Fe,er){j.texParameteri(er,zc,Fe.minFilter),j.texParameteri(er,Fc,Fe.magFilter),j.texParameteri(er,Dc,Fe.wrapS),j.texParameteri(er,Qc,Fe.wrapT),Se.ext_texture_filter_anisotropic&&j.texParameteri(er,ql,Fe.anisotropic),Fe.genMipmaps&&(j.hint(el,Fe.mipmapHint),j.generateMipmap(er))}var es=0,Ds={},ks=ke.maxTextureUnits,Zo=Array(ks).map(function(){return null});function Ii(Fe){Rr.call(this),this.mipmask=0,this.internalformat=Xs,this.id=es++,this.refCount=1,this.target=Fe,this.texture=j.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new ua,pr.profile&&(this.stats={size:0})}function Fs(Fe){j.activeTexture(Bu),j.bindTexture(Fe.target,Fe.texture)}function la(){var Fe=Zo[0];Fe?j.bindTexture(Fe.target,Fe.texture):j.bindTexture(ns,null)}function $n(Fe){var er=Fe.texture;H(er,"must not double destroy texture");var Wt=Fe.unit,An=Fe.target;Wt>=0&&(j.activeTexture(Bu+Wt),j.bindTexture(An,null),Zo[Wt]=null),j.deleteTexture(er),Fe.texture=null,Fe.params=null,Fe.pixels=null,Fe.refCount=0,delete Ds[Fe.id],Yt.textureCount--}x(Ii.prototype,{bind:function(){var Fe=this;Fe.bindCount+=1;var er=Fe.unit;if(er<0){for(var Wt=0;Wt<ks;++Wt){var An=Zo[Wt];if(An){if(An.bindCount>0)continue;An.unit=-1}Zo[Wt]=Fe,er=Wt;break}er>=ks&&H.raise("insufficient number of texture units"),pr.profile&&Yt.maxTextureUnits<er+1&&(Yt.maxTextureUnits=er+1),Fe.unit=er,j.activeTexture(Bu+er),j.bindTexture(Fe.target,Fe.texture)}return er},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&$n(this)}});function Hi(Fe,er){var Wt=new Ii(ns);Ds[Wt.id]=Wt,Yt.textureCount++;function An(_e,at){var Ot=Wt.texInfo;ua.call(Ot);var kt=Qi();return typeof _e=="number"?typeof at=="number"?Mi(kt,_e|0,at|0):Mi(kt,_e|0,_e|0):_e?(H.type(_e,"object","invalid arguments to regl.texture"),wo(Ot,_e),na(kt,_e)):Mi(kt,1,1),Ot.genMipmaps&&(kt.mipmask=(kt.width<<1)-1),Wt.mipmask=kt.mipmask,nn(Wt,kt),H.texture2D(Ot,kt,ke),Wt.internalformat=kt.internalformat,An.width=kt.width,An.height=kt.height,Fs(Wt),Qo(kt,ns),qo(Ot,ns),la(),Eo(kt),pr.profile&&(Wt.stats.size=Fi(Wt.internalformat,Wt.type,kt.width,kt.height,Ot.genMipmaps,!1)),An.format=Gr[Wt.internalformat],An.type=mn[Wt.type],An.mag=Dr[Ot.magFilter],An.min=En[Ot.minFilter],An.wrapS=zr[Ot.wrapS],An.wrapT=zr[Ot.wrapT],An}function Vi(_e,at,Ot,kt){H(!!_e,"must specify image data");var ft=at|0,ot=Ot|0,St=kt|0,Me=Ln();return nn(Me,Wt),Me.width=0,Me.height=0,kr(Me,_e),Me.width=Me.width||(Wt.width>>St)-ft,Me.height=Me.height||(Wt.height>>St)-ot,H(Wt.type===Me.type&&Wt.format===Me.format&&Wt.internalformat===Me.internalformat,"incompatible format for texture.subimage"),H(ft>=0&&ot>=0&&ft+Me.width<=Wt.width&&ot+Me.height<=Wt.height,"texture.subimage write out of bounds"),H(Wt.mipmask&1<<St,"missing mipmap data"),H(Me.data||Me.element||Me.needsCopy,"missing image data"),Fs(Wt),ui(Me,ns,ft,ot,St),la(),Bi(Me),An}function Oe(_e,at){var Ot=_e|0,kt=at|0||Ot;if(Ot===Wt.width&&kt===Wt.height)return An;An.width=Wt.width=Ot,An.height=Wt.height=kt,Fs(Wt);for(var ft=0;Wt.mipmask>>ft;++ft){var ot=Ot>>ft,St=kt>>ft;if(!ot||!St)break;j.texImage2D(ns,ft,Wt.format,ot,St,0,Wt.format,Wt.type,null)}return la(),pr.profile&&(Wt.stats.size=Fi(Wt.internalformat,Wt.type,Ot,kt,!1,!1)),An}return An(Fe,er),An.subimage=Vi,An.resize=Oe,An._reglType="texture2d",An._texture=Wt,pr.profile&&(An.stats=Wt.stats),An.destroy=function(){Wt.decRef()},An}function ia(Fe,er,Wt,An,Vi,Oe){var _e=new Ii(cc);Ds[_e.id]=_e,Yt.cubeCount++;var at=new Array(6);function Ot(ot,St,Me,qe,Ce,At){var Bt,Sr=_e.texInfo;for(ua.call(Sr),Bt=0;Bt<6;++Bt)at[Bt]=Qi();if(typeof ot=="number"||!ot){var Kt=ot|0||1;for(Bt=0;Bt<6;++Bt)Mi(at[Bt],Kt,Kt)}else if(typeof ot=="object")if(St)na(at[0],ot),na(at[1],St),na(at[2],Me),na(at[3],qe),na(at[4],Ce),na(at[5],At);else if(wo(Sr,ot),Kn(_e,ot),"faces"in ot){var br=ot.faces;for(H(Array.isArray(br)&&br.length===6,"cube faces must be a length 6 array"),Bt=0;Bt<6;++Bt)H(typeof br[Bt]=="object"&&!!br[Bt],"invalid input for cube map face"),nn(at[Bt],_e),na(at[Bt],br[Bt])}else for(Bt=0;Bt<6;++Bt)na(at[Bt],ot);else H.raise("invalid arguments to cube map");for(nn(_e,at[0]),ke.npotTextureCube||H(cl(_e.width)&&cl(_e.height),"your browser does not support non power or two texture dimensions"),Sr.genMipmaps?_e.mipmask=(at[0].width<<1)-1:_e.mipmask=at[0].mipmask,H.textureCube(_e,Sr,at,ke),_e.internalformat=at[0].internalformat,Ot.width=at[0].width,Ot.height=at[0].height,Fs(_e),Bt=0;Bt<6;++Bt)Qo(at[Bt],Ku+Bt);for(qo(Sr,cc),la(),pr.profile&&(_e.stats.size=Fi(_e.internalformat,_e.type,Ot.width,Ot.height,Sr.genMipmaps,!0)),Ot.format=Gr[_e.internalformat],Ot.type=mn[_e.type],Ot.mag=Dr[Sr.magFilter],Ot.min=En[Sr.minFilter],Ot.wrapS=zr[Sr.wrapS],Ot.wrapT=zr[Sr.wrapT],Bt=0;Bt<6;++Bt)Eo(at[Bt]);return Ot}function kt(ot,St,Me,qe,Ce){H(!!St,"must specify image data"),H(typeof ot=="number"&&ot===(ot|0)&&ot>=0&&ot<6,"invalid face");var At=Me|0,Bt=qe|0,Sr=Ce|0,Kt=Ln();return nn(Kt,_e),Kt.width=0,Kt.height=0,kr(Kt,St),Kt.width=Kt.width||(_e.width>>Sr)-At,Kt.height=Kt.height||(_e.height>>Sr)-Bt,H(_e.type===Kt.type&&_e.format===Kt.format&&_e.internalformat===Kt.internalformat,"incompatible format for texture.subimage"),H(At>=0&&Bt>=0&&At+Kt.width<=_e.width&&Bt+Kt.height<=_e.height,"texture.subimage write out of bounds"),H(_e.mipmask&1<<Sr,"missing mipmap data"),H(Kt.data||Kt.element||Kt.needsCopy,"missing image data"),Fs(_e),ui(Kt,Ku+ot,At,Bt,Sr),la(),Bi(Kt),Ot}function ft(ot){var St=ot|0;if(St!==_e.width){Ot.width=_e.width=St,Ot.height=_e.height=St,Fs(_e);for(var Me=0;Me<6;++Me)for(var qe=0;_e.mipmask>>qe;++qe)j.texImage2D(Ku+Me,qe,_e.format,St>>qe,St>>qe,0,_e.format,_e.type,null);return la(),pr.profile&&(_e.stats.size=Fi(_e.internalformat,_e.type,Ot.width,Ot.height,!1,!0)),Ot}}return Ot(Fe,er,Wt,An,Vi,Oe),Ot.subimage=kt,Ot.resize=ft,Ot._reglType="textureCube",Ot._texture=_e,pr.profile&&(Ot.stats=_e.stats),Ot.destroy=function(){_e.decRef()},Ot}function Io(){for(var Fe=0;Fe<ks;++Fe)j.activeTexture(Bu+Fe),j.bindTexture(ns,null),Zo[Fe]=null;fa(Ds).forEach($n),Yt.cubeCount=0,Yt.textureCount=0}pr.profile&&(Yt.getTotalTextureSize=function(){var Fe=0;return Object.keys(Ds).forEach(function(er){Fe+=Ds[er].stats.size}),Fe});function yu(){for(var Fe=0;Fe<ks;++Fe){var er=Zo[Fe];er&&(er.bindCount=0,er.unit=-1,Zo[Fe]=null)}fa(Ds).forEach(function(Wt){Wt.texture=j.createTexture(),j.bindTexture(Wt.target,Wt.texture);for(var An=0;An<32;++An)if((Wt.mipmask&1<<An)!=0)if(Wt.target===ns)j.texImage2D(ns,An,Wt.internalformat,Wt.width>>An,Wt.height>>An,0,Wt.internalformat,Wt.type,null);else for(var Vi=0;Vi<6;++Vi)j.texImage2D(Ku+Vi,An,Wt.internalformat,Wt.width>>An,Wt.height>>An,0,Wt.internalformat,Wt.type,null);qo(Wt.texInfo,Wt.target)})}function _u(){for(var Fe=0;Fe<ks;++Fe){var er=Zo[Fe];er&&(er.bindCount=0,er.unit=-1,Zo[Fe]=null),j.activeTexture(Bu+Fe),j.bindTexture(ns,null),j.bindTexture(cc,null)}}return{create2D:Hi,createCube:ia,clear:Io,getTexture:function(Fe){return null},restore:yu,refresh:_u}}var is=36161,Mo=32854,xl=32855,rl=36194,fu=33189,vs=36168,nl=34041,Un=35907,Mn=34836,rc=34842,as=34843,vo=[];vo[Mo]=2,vo[xl]=2,vo[rl]=2,vo[fu]=2,vo[vs]=1,vo[nl]=4,vo[Un]=4,vo[Mn]=16,vo[rc]=8,vo[as]=6;function ko(j,Se,ke){return vo[j]*Se*ke}var hu=function(j,Se,ke,qt,wr){var Yt={rgba4:Mo,rgb565:rl,"rgb5 a1":xl,depth:fu,stencil:vs,"depth stencil":nl};Se.ext_srgb&&(Yt.srgba=Un),Se.ext_color_buffer_half_float&&(Yt.rgba16f=rc,Yt.rgb16f=as),Se.webgl_color_buffer_float&&(Yt.rgba32f=Mn);var pr=[];Object.keys(Yt).forEach(function(Vr){var on=Yt[Vr];pr[on]=Vr});var Zr=0,Wr={};function en(Vr){this.id=Zr++,this.refCount=1,this.renderbuffer=Vr,this.format=Mo,this.width=0,this.height=0,wr.profile&&(this.stats={size:0})}en.prototype.decRef=function(){--this.refCount<=0&&Kr(this)};function Kr(Vr){var on=Vr.renderbuffer;H(on,"must not double destroy renderbuffer"),j.bindRenderbuffer(is,null),j.deleteRenderbuffer(on),Vr.renderbuffer=null,Vr.refCount=0,delete Wr[Vr.id],qt.renderbufferCount--}function an(Vr,on){var zt=new en(j.createRenderbuffer());Wr[zt.id]=zt,qt.renderbufferCount++;function fr(mn,Dr){var En=0,zr=0,sn=Mo;if(typeof mn=="object"&&mn){var Rr=mn;if("shape"in Rr){var nn=Rr.shape;H(Array.isArray(nn)&&nn.length>=2,"invalid renderbuffer shape"),En=nn[0]|0,zr=nn[1]|0}else"radius"in Rr&&(En=zr=Rr.radius|0),"width"in Rr&&(En=Rr.width|0),"height"in Rr&&(zr=Rr.height|0);"format"in Rr&&(H.parameter(Rr.format,Yt,"invalid renderbuffer format"),sn=Yt[Rr.format])}else typeof mn=="number"?(En=mn|0,typeof Dr=="number"?zr=Dr|0:zr=En):mn?H.raise("invalid arguments to renderbuffer constructor"):En=zr=1;if(H(En>0&&zr>0&&En<=ke.maxRenderbufferSize&&zr<=ke.maxRenderbufferSize,"invalid renderbuffer size"),!(En===zt.width&&zr===zt.height&&sn===zt.format))return fr.width=zt.width=En,fr.height=zt.height=zr,zt.format=sn,j.bindRenderbuffer(is,zt.renderbuffer),j.renderbufferStorage(is,sn,En,zr),H(j.getError()===0,"invalid render buffer format"),wr.profile&&(zt.stats.size=ko(zt.format,zt.width,zt.height)),fr.format=pr[zt.format],fr}function Gr(mn,Dr){var En=mn|0,zr=Dr|0||En;return En===zt.width&&zr===zt.height||(H(En>0&&zr>0&&En<=ke.maxRenderbufferSize&&zr<=ke.maxRenderbufferSize,"invalid renderbuffer size"),fr.width=zt.width=En,fr.height=zt.height=zr,j.bindRenderbuffer(is,zt.renderbuffer),j.renderbufferStorage(is,zt.format,En,zr),H(j.getError()===0,"invalid render buffer format"),wr.profile&&(zt.stats.size=ko(zt.format,zt.width,zt.height))),fr}return fr(Vr,on),fr.resize=Gr,fr._reglType="renderbuffer",fr._renderbuffer=zt,wr.profile&&(fr.stats=zt.stats),fr.destroy=function(){zt.decRef()},fr}wr.profile&&(qt.getTotalRenderbufferSize=function(){var Vr=0;return Object.keys(Wr).forEach(function(on){Vr+=Wr[on].stats.size}),Vr});function fn(){fa(Wr).forEach(function(Vr){Vr.renderbuffer=j.createRenderbuffer(),j.bindRenderbuffer(is,Vr.renderbuffer),j.renderbufferStorage(is,Vr.format,Vr.width,Vr.height)}),j.bindRenderbuffer(is,null)}return{create:an,clear:function(){fa(Wr).forEach(Kr)},restore:fn}},js=36160,Nl=36161,Ki=3553,So=34069,tf=36064,bl=36096,mc=36128,wu=33306,Es=36053,il=36054,Tu=36055,gc=36057,nc=36061,yc=36193,jc=5121,Bl=5126,qs=6407,_c=6408,al=6402,Au=[qs,_c],Ul=[];Ul[_c]=4,Ul[qs]=3;var pu=[];pu[jc]=1,pu[Bl]=4,pu[yc]=2;var eu=32854,xc=32855,bc=36194,Zc=33189,Sc=36168,n=34041,s=35907,a=34836,h=34842,g=34843,b=[eu,xc,bc,s,h,g,a],T={};T[Es]="complete",T[il]="incomplete attachment",T[gc]="incomplete dimensions",T[Tu]="incomplete, missing attachment",T[nc]="unsupported";function R(j,Se,ke,qt,wr,Yt){var pr={cur:null,next:null,dirty:!1,setFBO:null},Zr=["rgba"],Wr=["rgba4","rgb565","rgb5 a1"];Se.ext_srgb&&Wr.push("srgba"),Se.ext_color_buffer_half_float&&Wr.push("rgba16f","rgb16f"),Se.webgl_color_buffer_float&&Wr.push("rgba32f");var en=["uint8"];Se.oes_texture_half_float&&en.push("half float","float16"),Se.oes_texture_float&&en.push("float","float32");function Kr(un,kr,Or){this.target=un,this.texture=kr,this.renderbuffer=Or;var ui=0,qn=0;kr?(ui=kr.width,qn=kr.height):Or&&(ui=Or.width,qn=Or.height),this.width=ui,this.height=qn}function an(un){un&&(un.texture&&un.texture._texture.decRef(),un.renderbuffer&&un.renderbuffer._renderbuffer.decRef())}function fn(un,kr,Or){if(!!un)if(un.texture){var ui=un.texture._texture,qn=Math.max(1,ui.width),Ln=Math.max(1,ui.height);H(qn===kr&&Ln===Or,"inconsistent width/height for supplied texture"),ui.refCount+=1}else{var Bi=un.renderbuffer._renderbuffer;H(Bi.width===kr&&Bi.height===Or,"inconsistent width/height for renderbuffer"),Bi.refCount+=1}}function Vr(un,kr){kr&&(kr.texture?j.framebufferTexture2D(js,un,kr.target,kr.texture._texture.texture,0):j.framebufferRenderbuffer(js,un,Nl,kr.renderbuffer._renderbuffer.renderbuffer))}function on(un){var kr=Ki,Or=null,ui=null,qn=un;typeof un=="object"&&(qn=un.data,"target"in un&&(kr=un.target|0)),H.type(qn,"function","invalid attachment data");var Ln=qn._reglType;return Ln==="texture2d"?(Or=qn,H(kr===Ki)):Ln==="textureCube"?(Or=qn,H(kr>=So&&kr<So+6,"invalid cube map target")):Ln==="renderbuffer"?(ui=qn,kr=Nl):H.raise("invalid regl object for attachment"),new Kr(kr,Or,ui)}function zt(un,kr,Or,ui,qn){if(Or){var Ln=qt.create2D({width:un,height:kr,format:ui,type:qn});return Ln._texture.refCount=0,new Kr(Ki,Ln,null)}else{var Bi=wr.create({width:un,height:kr,format:ui});return Bi._renderbuffer.refCount=0,new Kr(Nl,null,Bi)}}function fr(un){return un&&(un.texture||un.renderbuffer)}function Gr(un,kr,Or){un&&(un.texture?un.texture.resize(kr,Or):un.renderbuffer&&un.renderbuffer.resize(kr,Or),un.width=kr,un.height=Or)}var mn=0,Dr={};function En(){this.id=mn++,Dr[this.id]=this,this.framebuffer=j.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function zr(un){un.colorAttachments.forEach(an),an(un.depthAttachment),an(un.stencilAttachment),an(un.depthStencilAttachment)}function sn(un){var kr=un.framebuffer;H(kr,"must not double destroy framebuffer"),j.deleteFramebuffer(kr),un.framebuffer=null,Yt.framebufferCount--,delete Dr[un.id]}function Rr(un){var kr;j.bindFramebuffer(js,un.framebuffer);var Or=un.colorAttachments;for(kr=0;kr<Or.length;++kr)Vr(tf+kr,Or[kr]);for(kr=Or.length;kr<ke.maxColorAttachments;++kr)j.framebufferTexture2D(js,tf+kr,Ki,null,0);j.framebufferTexture2D(js,wu,Ki,null,0),j.framebufferTexture2D(js,bl,Ki,null,0),j.framebufferTexture2D(js,mc,Ki,null,0),Vr(bl,un.depthAttachment),Vr(mc,un.stencilAttachment),Vr(wu,un.depthStencilAttachment);var ui=j.checkFramebufferStatus(js);!j.isContextLost()&&ui!==Es&&H.raise("framebuffer configuration not supported, status = "+T[ui]),j.bindFramebuffer(js,pr.next?pr.next.framebuffer:null),pr.cur=pr.next,j.getError()}function nn(un,kr){var Or=new En;Yt.framebufferCount++;function ui(Ln,Bi){var Ai;H(pr.next!==Or,"can not update framebuffer which is currently in use");var Mi=0,na=0,Qo=!0,Rs=!0,Qi=null,Eo=!0,ua="rgba",wo="uint8",qo=1,es=null,Ds=null,ks=null,Zo=!1;if(typeof Ln=="number")Mi=Ln|0,na=Bi|0||Mi;else if(!Ln)Mi=na=1;else{H.type(Ln,"object","invalid arguments for framebuffer");var Ii=Ln;if("shape"in Ii){var Fs=Ii.shape;H(Array.isArray(Fs)&&Fs.length>=2,"invalid shape for framebuffer"),Mi=Fs[0],na=Fs[1]}else"radius"in Ii&&(Mi=na=Ii.radius),"width"in Ii&&(Mi=Ii.width),"height"in Ii&&(na=Ii.height);("color"in Ii||"colors"in Ii)&&(Qi=Ii.color||Ii.colors,Array.isArray(Qi)&&H(Qi.length===1||Se.webgl_draw_buffers,"multiple render targets not supported")),Qi||("colorCount"in Ii&&(qo=Ii.colorCount|0,H(qo>0,"invalid color buffer count")),"colorTexture"in Ii&&(Eo=!!Ii.colorTexture,ua="rgba4"),"colorType"in Ii&&(wo=Ii.colorType,Eo?(H(Se.oes_texture_float||!(wo==="float"||wo==="float32"),"you must enable OES_texture_float in order to use floating point framebuffer objects"),H(Se.oes_texture_half_float||!(wo==="half float"||wo==="float16"),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):wo==="half float"||wo==="float16"?(H(Se.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),ua="rgba16f"):(wo==="float"||wo==="float32")&&(H(Se.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),ua="rgba32f"),H.oneOf(wo,en,"invalid color type")),"colorFormat"in Ii&&(ua=Ii.colorFormat,Zr.indexOf(ua)>=0?Eo=!0:Wr.indexOf(ua)>=0?Eo=!1:Eo?H.oneOf(Ii.colorFormat,Zr,"invalid color format for texture"):H.oneOf(Ii.colorFormat,Wr,"invalid color format for renderbuffer"))),("depthTexture"in Ii||"depthStencilTexture"in Ii)&&(Zo=!!(Ii.depthTexture||Ii.depthStencilTexture),H(!Zo||Se.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in Ii&&(typeof Ii.depth=="boolean"?Qo=Ii.depth:(es=Ii.depth,Rs=!1)),"stencil"in Ii&&(typeof Ii.stencil=="boolean"?Rs=Ii.stencil:(Ds=Ii.stencil,Qo=!1)),"depthStencil"in Ii&&(typeof Ii.depthStencil=="boolean"?Qo=Rs=Ii.depthStencil:(ks=Ii.depthStencil,Qo=!1,Rs=!1))}var la=null,$n=null,Hi=null,ia=null;if(Array.isArray(Qi))la=Qi.map(on);else if(Qi)la=[on(Qi)];else for(la=new Array(qo),Ai=0;Ai<qo;++Ai)la[Ai]=zt(Mi,na,Eo,ua,wo);H(Se.webgl_draw_buffers||la.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),H(la.length<=ke.maxColorAttachments,"too many color attachments, not supported"),Mi=Mi||la[0].width,na=na||la[0].height,es?$n=on(es):Qo&&!Rs&&($n=zt(Mi,na,Zo,"depth","uint32")),Ds?Hi=on(Ds):Rs&&!Qo&&(Hi=zt(Mi,na,!1,"stencil","uint8")),ks?ia=on(ks):!es&&!Ds&&Rs&&Qo&&(ia=zt(Mi,na,Zo,"depth stencil","depth stencil")),H(!!es+!!Ds+!!ks<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var Io=null;for(Ai=0;Ai<la.length;++Ai)if(fn(la[Ai],Mi,na),H(!la[Ai]||la[Ai].texture&&Au.indexOf(la[Ai].texture._texture.format)>=0||la[Ai].renderbuffer&&b.indexOf(la[Ai].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+Ai+" is invalid"),la[Ai]&&la[Ai].texture){var yu=Ul[la[Ai].texture._texture.format]*pu[la[Ai].texture._texture.type];Io===null?Io=yu:H(Io===yu,"all color attachments much have the same number of bits per pixel.")}return fn($n,Mi,na),H(!$n||$n.texture&&$n.texture._texture.format===al||$n.renderbuffer&&$n.renderbuffer._renderbuffer.format===Zc,"invalid depth attachment for framebuffer object"),fn(Hi,Mi,na),H(!Hi||Hi.renderbuffer&&Hi.renderbuffer._renderbuffer.format===Sc,"invalid stencil attachment for framebuffer object"),fn(ia,Mi,na),H(!ia||ia.texture&&ia.texture._texture.format===n||ia.renderbuffer&&ia.renderbuffer._renderbuffer.format===n,"invalid depth-stencil attachment for framebuffer object"),zr(Or),Or.width=Mi,Or.height=na,Or.colorAttachments=la,Or.depthAttachment=$n,Or.stencilAttachment=Hi,Or.depthStencilAttachment=ia,ui.color=la.map(fr),ui.depth=fr($n),ui.stencil=fr(Hi),ui.depthStencil=fr(ia),ui.width=Or.width,ui.height=Or.height,Rr(Or),ui}function qn(Ln,Bi){H(pr.next!==Or,"can not resize a framebuffer which is currently in use");var Ai=Math.max(Ln|0,1),Mi=Math.max(Bi|0||Ai,1);if(Ai===Or.width&&Mi===Or.height)return ui;for(var na=Or.colorAttachments,Qo=0;Qo<na.length;++Qo)Gr(na[Qo],Ai,Mi);return Gr(Or.depthAttachment,Ai,Mi),Gr(Or.stencilAttachment,Ai,Mi),Gr(Or.depthStencilAttachment,Ai,Mi),Or.width=ui.width=Ai,Or.height=ui.height=Mi,Rr(Or),ui}return ui(un,kr),x(ui,{resize:qn,_reglType:"framebuffer",_framebuffer:Or,destroy:function(){sn(Or),zr(Or)},use:function(Ln){pr.setFBO({framebuffer:ui},Ln)}})}function Kn(un){var kr=Array(6);function Or(qn){var Ln;H(kr.indexOf(pr.next)<0,"can not update framebuffer which is currently in use");var Bi={color:null},Ai=0,Mi=null,na="rgba",Qo="uint8",Rs=1;if(typeof qn=="number")Ai=qn|0;else if(!qn)Ai=1;else{H.type(qn,"object","invalid arguments for framebuffer");var Qi=qn;if("shape"in Qi){var Eo=Qi.shape;H(Array.isArray(Eo)&&Eo.length>=2,"invalid shape for framebuffer"),H(Eo[0]===Eo[1],"cube framebuffer must be square"),Ai=Eo[0]}else"radius"in Qi&&(Ai=Qi.radius|0),"width"in Qi?(Ai=Qi.width|0,"height"in Qi&&H(Qi.height===Ai,"must be square")):"height"in Qi&&(Ai=Qi.height|0);("color"in Qi||"colors"in Qi)&&(Mi=Qi.color||Qi.colors,Array.isArray(Mi)&&H(Mi.length===1||Se.webgl_draw_buffers,"multiple render targets not supported")),Mi||("colorCount"in Qi&&(Rs=Qi.colorCount|0,H(Rs>0,"invalid color buffer count")),"colorType"in Qi&&(H.oneOf(Qi.colorType,en,"invalid color type"),Qo=Qi.colorType),"colorFormat"in Qi&&(na=Qi.colorFormat,H.oneOf(Qi.colorFormat,Zr,"invalid color format for texture"))),"depth"in Qi&&(Bi.depth=Qi.depth),"stencil"in Qi&&(Bi.stencil=Qi.stencil),"depthStencil"in Qi&&(Bi.depthStencil=Qi.depthStencil)}var ua;if(Mi)if(Array.isArray(Mi))for(ua=[],Ln=0;Ln<Mi.length;++Ln)ua[Ln]=Mi[Ln];else ua=[Mi];else{ua=Array(Rs);var wo={radius:Ai,format:na,type:Qo};for(Ln=0;Ln<Rs;++Ln)ua[Ln]=qt.createCube(wo)}for(Bi.color=Array(ua.length),Ln=0;Ln<ua.length;++Ln){var qo=ua[Ln];H(typeof qo=="function"&&qo._reglType==="textureCube","invalid cube map"),Ai=Ai||qo.width,H(qo.width===Ai&&qo.height===Ai,"invalid cube map shape"),Bi.color[Ln]={target:So,data:ua[Ln]}}for(Ln=0;Ln<6;++Ln){for(var es=0;es<ua.length;++es)Bi.color[es].target=So+Ln;Ln>0&&(Bi.depth=kr[0].depth,Bi.stencil=kr[0].stencil,Bi.depthStencil=kr[0].depthStencil),kr[Ln]?kr[Ln](Bi):kr[Ln]=nn(Bi)}return x(Or,{width:Ai,height:Ai,color:ua})}function ui(qn){var Ln,Bi=qn|0;if(H(Bi>0&&Bi<=ke.maxCubeMapSize,"invalid radius for cube fbo"),Bi===Or.width)return Or;var Ai=Or.color;for(Ln=0;Ln<Ai.length;++Ln)Ai[Ln].resize(Bi);for(Ln=0;Ln<6;++Ln)kr[Ln].resize(Bi);return Or.width=Or.height=Bi,Or}return Or(un),x(Or,{faces:kr,resize:ui,_reglType:"framebufferCube",destroy:function(){kr.forEach(function(qn){qn.destroy()})}})}function Yn(){pr.cur=null,pr.next=null,pr.dirty=!0,fa(Dr).forEach(function(un){un.framebuffer=j.createFramebuffer(),Rr(un)})}return x(pr,{getFramebuffer:function(un){if(typeof un=="function"&&un._reglType==="framebuffer"){var kr=un._framebuffer;if(kr instanceof En)return kr}return null},create:nn,createCube:Kn,clear:function(){fa(Dr).forEach(sn)},restore:Yn})}var V=5126,te=34962;function de(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=V,this.offset=0,this.stride=0,this.divisor=0}function ye(j,Se,ke,qt,wr){for(var Yt=ke.maxAttributes,pr=new Array(Yt),Zr=0;Zr<Yt;++Zr)pr[Zr]=new de;var Wr=0,en={},Kr={Record:de,scope:{},state:pr,currentVAO:null,targetVAO:null,restore:fn()?Dr:function(){},createVAO:En,getVAO:on,destroyBuffer:an,setVAO:fn()?zt:fr,clear:fn()?Gr:function(){}};function an(zr){for(var sn=0;sn<pr.length;++sn){var Rr=pr[sn];Rr.buffer===zr&&(j.disableVertexAttribArray(sn),Rr.buffer=null)}}function fn(){return Se.oes_vertex_array_object}function Vr(){return Se.angle_instanced_arrays}function on(zr){return typeof zr=="function"&&zr._vao?zr._vao:null}function zt(zr){if(zr!==Kr.currentVAO){var sn=fn();zr?sn.bindVertexArrayOES(zr.vao):sn.bindVertexArrayOES(null),Kr.currentVAO=zr}}function fr(zr){if(zr!==Kr.currentVAO){if(zr)zr.bindAttrs();else for(var sn=Vr(),Rr=0;Rr<pr.length;++Rr){var nn=pr[Rr];nn.buffer?(j.enableVertexAttribArray(Rr),j.vertexAttribPointer(Rr,nn.size,nn.type,nn.normalized,nn.stride,nn.offfset),sn&&nn.divisor&&sn.vertexAttribDivisorANGLE(Rr,nn.divisor)):(j.disableVertexAttribArray(Rr),j.vertexAttrib4f(Rr,nn.x,nn.y,nn.z,nn.w))}Kr.currentVAO=zr}}function Gr(){fa(en).forEach(function(zr){zr.destroy()})}function mn(){this.id=++Wr,this.attributes=[];var zr=fn();zr?this.vao=zr.createVertexArrayOES():this.vao=null,en[this.id]=this,this.buffers=[]}mn.prototype.bindAttrs=function(){for(var zr=Vr(),sn=this.attributes,Rr=0;Rr<sn.length;++Rr){var nn=sn[Rr];nn.buffer?(j.enableVertexAttribArray(Rr),j.bindBuffer(te,nn.buffer.buffer),j.vertexAttribPointer(Rr,nn.size,nn.type,nn.normalized,nn.stride,nn.offset),zr&&nn.divisor&&zr.vertexAttribDivisorANGLE(Rr,nn.divisor)):(j.disableVertexAttribArray(Rr),j.vertexAttrib4f(Rr,nn.x,nn.y,nn.z,nn.w))}for(var Kn=sn.length;Kn<Yt;++Kn)j.disableVertexAttribArray(Kn)},mn.prototype.refresh=function(){var zr=fn();zr&&(zr.bindVertexArrayOES(this.vao),this.bindAttrs(),Kr.currentVAO=this)},mn.prototype.destroy=function(){if(this.vao){var zr=fn();this===Kr.currentVAO&&(Kr.currentVAO=null,zr.bindVertexArrayOES(null)),zr.deleteVertexArrayOES(this.vao),this.vao=null}en[this.id]&&(delete en[this.id],qt.vaoCount-=1)};function Dr(){var zr=fn();zr&&fa(en).forEach(function(sn){sn.refresh()})}function En(zr){var sn=new mn;qt.vaoCount+=1;function Rr(nn){H(Array.isArray(nn),"arguments to vertex array constructor must be an array"),H(nn.length<Yt,"too many attributes"),H(nn.length>0,"must specify at least one attribute");var Kn={},Yn=sn.attributes;Yn.length=nn.length;for(var un=0;un<nn.length;++un){var kr=nn[un],Or=Yn[un]=new de,ui=kr.data||kr;if(Array.isArray(ui)||L(ui)||La(ui)){var qn;sn.buffers[un]&&(qn=sn.buffers[un],L(ui)&&qn._buffer.byteLength>=ui.byteLength?qn.subdata(ui):(qn.destroy(),sn.buffers[un]=null)),sn.buffers[un]||(qn=sn.buffers[un]=wr.create(kr,te,!1,!0)),Or.buffer=wr.getBuffer(qn),Or.size=Or.buffer.dimension|0,Or.normalized=!1,Or.type=Or.buffer.dtype,Or.offset=0,Or.stride=0,Or.divisor=0,Or.state=1,Kn[un]=1}else wr.getBuffer(kr)?(Or.buffer=wr.getBuffer(kr),Or.size=Or.buffer.dimension|0,Or.normalized=!1,Or.type=Or.buffer.dtype,Or.offset=0,Or.stride=0,Or.divisor=0,Or.state=1):wr.getBuffer(kr.buffer)?(Or.buffer=wr.getBuffer(kr.buffer),Or.size=(+kr.size||Or.buffer.dimension)|0,Or.normalized=!!kr.normalized||!1,"type"in kr?(H.parameter(kr.type,so,"invalid buffer type"),Or.type=so[kr.type]):Or.type=Or.buffer.dtype,Or.offset=(kr.offset||0)|0,Or.stride=(kr.stride||0)|0,Or.divisor=(kr.divisor||0)|0,Or.state=1,H(Or.size>=1&&Or.size<=4,"size must be between 1 and 4"),H(Or.offset>=0,"invalid offset"),H(Or.stride>=0&&Or.stride<=255,"stride must be between 0 and 255"),H(Or.divisor>=0,"divisor must be positive"),H(!Or.divisor||!!Se.angle_instanced_arrays,"ANGLE_instanced_arrays must be enabled to use divisor")):"x"in kr?(H(un>0,"first attribute must not be a constant"),Or.x=+kr.x||0,Or.y=+kr.y||0,Or.z=+kr.z||0,Or.w=+kr.w||0,Or.state=2):H(!1,"invalid attribute spec for location "+un)}for(var Ln=0;Ln<sn.buffers.length;++Ln)!Kn[Ln]&&sn.buffers[Ln]&&(sn.buffers[Ln].destroy(),sn.buffers[Ln]=null);return sn.refresh(),Rr}return Rr.destroy=function(){for(var nn=0;nn<sn.buffers.length;++nn)sn.buffers[nn]&&sn.buffers[nn].destroy();sn.buffers.length=0,sn.destroy()},Rr._vao=sn,Rr._reglType="vao",Rr(zr)}return Kr}var xe=35632,He=35633,Ze=35718,nt=35721;function ze(j,Se,ke,qt){var wr={},Yt={};function pr(zt,fr,Gr,mn){this.name=zt,this.id=fr,this.location=Gr,this.info=mn}function Zr(zt,fr){for(var Gr=0;Gr<zt.length;++Gr)if(zt[Gr].id===fr.id){zt[Gr].location=fr.location;return}zt.push(fr)}function Wr(zt,fr,Gr){var mn=zt===xe?wr:Yt,Dr=mn[fr];if(!Dr){var En=Se.str(fr);Dr=j.createShader(zt),j.shaderSource(Dr,En),j.compileShader(Dr),H.shaderError(j,Dr,En,zt,Gr),mn[fr]=Dr}return Dr}var en={},Kr=[],an=0;function fn(zt,fr){this.id=an++,this.fragId=zt,this.vertId=fr,this.program=null,this.uniforms=[],this.attributes=[],this.refCount=1,qt.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function Vr(zt,fr,Gr){var mn,Dr,En=Wr(xe,zt.fragId),zr=Wr(He,zt.vertId),sn=zt.program=j.createProgram();if(j.attachShader(sn,En),j.attachShader(sn,zr),Gr)for(mn=0;mn<Gr.length;++mn){var Rr=Gr[mn];j.bindAttribLocation(sn,Rr[0],Rr[1])}j.linkProgram(sn),H.linkError(j,sn,Se.str(zt.fragId),Se.str(zt.vertId),fr);var nn=j.getProgramParameter(sn,Ze);qt.profile&&(zt.stats.uniformsCount=nn);var Kn=zt.uniforms;for(mn=0;mn<nn;++mn)if(Dr=j.getActiveUniform(sn,mn),Dr)if(Dr.size>1)for(var Yn=0;Yn<Dr.size;++Yn){var un=Dr.name.replace("[0]","["+Yn+"]");Zr(Kn,new pr(un,Se.id(un),j.getUniformLocation(sn,un),Dr))}else Zr(Kn,new pr(Dr.name,Se.id(Dr.name),j.getUniformLocation(sn,Dr.name),Dr));var kr=j.getProgramParameter(sn,nt);qt.profile&&(zt.stats.attributesCount=kr);var Or=zt.attributes;for(mn=0;mn<kr;++mn)Dr=j.getActiveAttrib(sn,mn),Dr&&Zr(Or,new pr(Dr.name,Se.id(Dr.name),j.getAttribLocation(sn,Dr.name),Dr))}qt.profile&&(ke.getMaxUniformsCount=function(){var zt=0;return Kr.forEach(function(fr){fr.stats.uniformsCount>zt&&(zt=fr.stats.uniformsCount)}),zt},ke.getMaxAttributesCount=function(){var zt=0;return Kr.forEach(function(fr){fr.stats.attributesCount>zt&&(zt=fr.stats.attributesCount)}),zt});function on(){wr={},Yt={};for(var zt=0;zt<Kr.length;++zt)Vr(Kr[zt],null,Kr[zt].attributes.map(function(fr){return[fr.location,fr.name]}))}return{clear:function(){var zt=j.deleteShader.bind(j);fa(wr).forEach(zt),wr={},fa(Yt).forEach(zt),Yt={},Kr.forEach(function(fr){j.deleteProgram(fr.program)}),Kr.length=0,en={},ke.shaderCount=0},program:function(zt,fr,Gr,mn){H.command(zt>=0,"missing vertex shader",Gr),H.command(fr>=0,"missing fragment shader",Gr);var Dr=en[fr];Dr||(Dr=en[fr]={});var En=Dr[zt];if(En&&(En.refCount++,!mn))return En;var zr=new fn(fr,zt);return ke.shaderCount++,Vr(zr,Gr,mn),En||(Dr[zt]=zr),Kr.push(zr),x(zr,{destroy:function(){if(zr.refCount--,zr.refCount<=0){j.deleteProgram(zr.program);var sn=Kr.indexOf(zr);Kr.splice(sn,1),ke.shaderCount--}Dr[zr.vertId].refCount<=0&&(j.deleteShader(Yt[zr.vertId]),delete Yt[zr.vertId],delete en[zr.fragId][zr.vertId]),Object.keys(en[zr.fragId]).length||(j.deleteShader(wr[zr.fragId]),delete wr[zr.fragId],delete en[zr.fragId])}})},restore:on,shader:Wr,frag:-1,vert:-1}}var rt=6408,ht=5121,Nt=3333,or=5126;function rr(j,Se,ke,qt,wr,Yt,pr){function Zr(Kr){var an;Se.next===null?(H(wr.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),an=ht):(H(Se.next.colorAttachments[0].texture!==null,"You cannot read from a renderbuffer"),an=Se.next.colorAttachments[0].texture._texture.type,Yt.oes_texture_float?(H(an===ht||an===or,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),an===or&&H(pr.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):H(an===ht,"Reading from a framebuffer is only allowed for the type 'uint8'"));var fn=0,Vr=0,on=qt.framebufferWidth,zt=qt.framebufferHeight,fr=null;L(Kr)?fr=Kr:Kr&&(H.type(Kr,"object","invalid arguments to regl.read()"),fn=Kr.x|0,Vr=Kr.y|0,H(fn>=0&&fn<qt.framebufferWidth,"invalid x offset for regl.read"),H(Vr>=0&&Vr<qt.framebufferHeight,"invalid y offset for regl.read"),on=(Kr.width||qt.framebufferWidth-fn)|0,zt=(Kr.height||qt.framebufferHeight-Vr)|0,fr=Kr.data||null),fr&&(an===ht?H(fr instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):an===or&&H(fr instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),H(on>0&&on+fn<=qt.framebufferWidth,"invalid width for read pixels"),H(zt>0&&zt+Vr<=qt.framebufferHeight,"invalid height for read pixels"),ke();var Gr=on*zt*4;return fr||(an===ht?fr=new Uint8Array(Gr):an===or&&(fr=fr||new Float32Array(Gr))),H.isTypedArray(fr,"data buffer for regl.read() must be a typedarray"),H(fr.byteLength>=Gr,"data buffer for regl.read() too small"),j.pixelStorei(Nt,4),j.readPixels(fn,Vr,on,zt,rt,an,fr),fr}function Wr(Kr){var an;return Se.setFBO({framebuffer:Kr.framebuffer},function(){an=Zr(Kr)}),an}function en(Kr){return!Kr||!("framebuffer"in Kr)?Zr(Kr):Wr(Kr)}return en}function sr(j){return Array.prototype.slice.call(j)}function Lr(j){return sr(j).join("")}function rn(){var j=0,Se=[],ke=[];function qt(an){for(var fn=0;fn<ke.length;++fn)if(ke[fn]===an)return Se[fn];var Vr="g"+j++;return Se.push(Vr),ke.push(an),Vr}function wr(){var an=[];function fn(){an.push.apply(an,sr(arguments))}var Vr=[];function on(){var zt="v"+j++;return Vr.push(zt),arguments.length>0&&(an.push(zt,"="),an.push.apply(an,sr(arguments)),an.push(";")),zt}return x(fn,{def:on,toString:function(){return Lr([Vr.length>0?"var "+Vr.join(",")+";":"",Lr(an)])}})}function Yt(){var an=wr(),fn=wr(),Vr=an.toString,on=fn.toString;function zt(fr,Gr){fn(fr,Gr,"=",an.def(fr,Gr),";")}return x(function(){an.apply(an,sr(arguments))},{def:an.def,entry:an,exit:fn,save:zt,set:function(fr,Gr,mn){zt(fr,Gr),an(fr,Gr,"=",mn,";")},toString:function(){return Vr()+on()}})}function pr(){var an=Lr(arguments),fn=Yt(),Vr=Yt(),on=fn.toString,zt=Vr.toString;return x(fn,{then:function(){return fn.apply(fn,sr(arguments)),this},else:function(){return Vr.apply(Vr,sr(arguments)),this},toString:function(){var fr=zt();return fr&&(fr="else{"+fr+"}"),Lr(["if(",an,"){",on(),"}",fr])}})}var Zr=wr(),Wr={};function en(an,fn){var Vr=[];function on(){var Dr="a"+Vr.length;return Vr.push(Dr),Dr}fn=fn||0;for(var zt=0;zt<fn;++zt)on();var fr=Yt(),Gr=fr.toString,mn=Wr[an]=x(fr,{arg:on,toString:function(){return Lr(["function(",Vr.join(),"){",Gr(),"}"])}});return mn}function Kr(){var an=['"use strict";',Zr,"return {"];Object.keys(Wr).forEach(function(on){an.push('"',on,'":',Wr[on].toString(),",")}),an.push("}");var fn=Lr(an).replace(/;/g,`;
`).replace(/}/g,`}
`).replace(/{/g,`{
`),Vr=Function.apply(null,Se.concat(fn));return Vr.apply(null,ke)}return{global:Zr,link:qt,block:wr,proc:en,scope:Yt,cond:pr,compile:Kr}}var Qr="xyzw".split(""),xn=5121,jn=1,Xn=2,Wn=0,$i=1,Sn=2,oi=3,Si=4,ai=5,ii=6,Ei="dither",ri="blend.enable",Qn="blend.color",mo="blend.equation",Ja="blend.func",os="depth.enable",Fo="depth.func",Qa="depth.range",ro="depth.mask",ms="colorMask",zo="cull.enable",Cu="cull.face",ss="frontFace",Zs="lineWidth",Vs="polygonOffset.enable",Sl="polygonOffset.offset",El="sample.alpha",Ls="sample.enable",Vu="sample.coverage",jl="stencil.enable",du="stencil.mask",wl="stencil.func",tu="stencil.opFront",no="stencil.opBack",Pu="scissor.enable",vu="scissor.box",ws="viewport",Ji="profile",No="framebuffer",go="vert",Mu="frag",ru="elements",mu="primitive",Gu="count",Iu="offset",Gs="instances",nu="vao",Tl="Width",rf="Height",gu=No+Tl,ga=No+rf,dh=ws+Tl,Hf=ws+rf,Wf="drawingBuffer",Zl=Wf+Tl,Lf=Wf+rf,vh=[Ja,mo,wl,tu,no,Vu,ws,vu,Sl],ic=34962,Rf=34963,xf=35632,Xf=35633,Vl=3553,Vc=34067,Df=2884,Yf=3042,Kf=3024,$f=2960,Jf=2929,Qf=3089,mh=32823,kf=32926,gh=32928,Ou=5126,bf=35664,yo=35665,nf=35666,Ff=5124,Al=35667,Gc=35668,ac=35669,N=35670,U=35671,P=35672,O=35673,q=35674,ve=35675,$e=35676,xt=35678,vt=35680,mr=4,Br=1028,In=1029,Bn=2304,fi=2305,Ci=32775,wi=32776,ha=519,Ti=7680,Va=0,Bo=1,Uo=32774,us=513,co=36160,ya=36064,pa={"0":0,"1":1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},_o=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],fo={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},Ga={"0":0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},$o={frag:xf,vert:Xf},Jo={cw:Bn,ccw:fi};function oc(j){return Array.isArray(j)||L(j)||La(j)}function Gl(j){return j.sort(function(Se,ke){return Se===ws?-1:ke===ws?1:Se<ke?-1:1})}function gs(j,Se,ke,qt){this.thisDep=j,this.contextDep=Se,this.propDep=ke,this.append=qt}function iu(j){return j&&!(j.thisDep||j.contextDep||j.propDep)}function jo(j){return new gs(!1,!1,!1,j)}function Lu(j,Se){var ke=j.type;if(ke===Wn){var qt=j.data.length;return new gs(!0,qt>=1,qt>=2,Se)}else if(ke===Si){var wr=j.data;return new gs(wr.thisDep,wr.contextDep,wr.propDep,Se)}else{if(ke===ai)return new gs(!1,!1,!1,Se);if(ke===ii){for(var Yt=!1,pr=!1,Zr=!1,Wr=0;Wr<j.data.length;++Wr){var en=j.data[Wr];if(en.type===$i)Zr=!0;else if(en.type===Sn)pr=!0;else if(en.type===oi)Yt=!0;else if(en.type===Wn){Yt=!0;var Kr=en.data;Kr>=1&&(pr=!0),Kr>=2&&(Zr=!0)}else en.type===Si&&(Yt=Yt||en.data.thisDep,pr=pr||en.data.contextDep,Zr=Zr||en.data.propDep)}return new gs(Yt,pr,Zr,Se)}else return new gs(ke===oi,ke===Sn,ke===$i,Se)}}var Uh=new gs(!1,!1,!1,function(){});function vp(j,Se,ke,qt,wr,Yt,pr,Zr,Wr,en,Kr,an,fn,Vr,on){var zt=en.Record,fr={add:32774,subtract:32778,"reverse subtract":32779};ke.ext_blend_minmax&&(fr.min=Ci,fr.max=wi);var Gr=ke.angle_instanced_arrays,mn=ke.webgl_draw_buffers,Dr={dirty:!0,profile:on.profile},En={},zr=[],sn={},Rr={};function nn(Oe){return Oe.replace(".","_")}function Kn(Oe,_e,at){var Ot=nn(Oe);zr.push(Oe),En[Ot]=Dr[Ot]=!!at,sn[Ot]=_e}function Yn(Oe,_e,at){var Ot=nn(Oe);zr.push(Oe),Array.isArray(at)?(Dr[Ot]=at.slice(),En[Ot]=at.slice()):Dr[Ot]=En[Ot]=at,Rr[Ot]=_e}Kn(Ei,Kf),Kn(ri,Yf),Yn(Qn,"blendColor",[0,0,0,0]),Yn(mo,"blendEquationSeparate",[Uo,Uo]),Yn(Ja,"blendFuncSeparate",[Bo,Va,Bo,Va]),Kn(os,Jf,!0),Yn(Fo,"depthFunc",us),Yn(Qa,"depthRange",[0,1]),Yn(ro,"depthMask",!0),Yn(ms,ms,[!0,!0,!0,!0]),Kn(zo,Df),Yn(Cu,"cullFace",In),Yn(ss,ss,fi),Yn(Zs,Zs,1),Kn(Vs,mh),Yn(Sl,"polygonOffset",[0,0]),Kn(El,kf),Kn(Ls,gh),Yn(Vu,"sampleCoverage",[1,!1]),Kn(jl,$f),Yn(du,"stencilMask",-1),Yn(wl,"stencilFunc",[ha,0,-1]),Yn(tu,"stencilOpSeparate",[Br,Ti,Ti,Ti]),Yn(no,"stencilOpSeparate",[In,Ti,Ti,Ti]),Kn(Pu,Qf),Yn(vu,"scissor",[0,0,j.drawingBufferWidth,j.drawingBufferHeight]),Yn(ws,ws,[0,0,j.drawingBufferWidth,j.drawingBufferHeight]);var un={gl:j,context:fn,strings:Se,next:En,current:Dr,draw:an,elements:Yt,buffer:wr,shader:Kr,attributes:en.state,vao:en,uniforms:Wr,framebuffer:Zr,extensions:ke,timer:Vr,isBufferArgs:oc},kr={primTypes:bi,compareFuncs:fo,blendFuncs:pa,blendEquations:fr,stencilOps:Ga,glTypes:so,orientationType:Jo};H.optional(function(){un.isArrayLike=eo}),mn&&(kr.backBuffer=[In],kr.drawBuffer=I(qt.maxDrawbuffers,function(Oe){return Oe===0?[0]:I(Oe,function(_e){return ya+_e})}));var Or=0;function ui(){var Oe=rn(),_e=Oe.link,at=Oe.global;Oe.id=Or++,Oe.batchId="0";var Ot=_e(un),kt=Oe.shared={props:"a0"};Object.keys(un).forEach(function(qe){kt[qe]=at.def(Ot,".",qe)}),H.optional(function(){Oe.CHECK=_e(H),Oe.commandStr=H.guessCommand(),Oe.command=_e(Oe.commandStr),Oe.assert=function(qe,Ce,At){qe("if(!(",Ce,"))",this.CHECK,".commandRaise(",_e(At),",",this.command,");")},kr.invalidBlendCombinations=_o});var ft=Oe.next={},ot=Oe.current={};Object.keys(Rr).forEach(function(qe){Array.isArray(Dr[qe])&&(ft[qe]=at.def(kt.next,".",qe),ot[qe]=at.def(kt.current,".",qe))});var St=Oe.constants={};Object.keys(kr).forEach(function(qe){St[qe]=at.def(JSON.stringify(kr[qe]))}),Oe.invoke=function(qe,Ce){switch(Ce.type){case Wn:var At=["this",kt.context,kt.props,Oe.batchId];return qe.def(_e(Ce.data),".call(",At.slice(0,Math.max(Ce.data.length+1,4)),")");case $i:return qe.def(kt.props,Ce.data);case Sn:return qe.def(kt.context,Ce.data);case oi:return qe.def("this",Ce.data);case Si:return Ce.data.append(Oe,qe),Ce.data.ref;case ai:return Ce.data.toString();case ii:return Ce.data.map(function(Bt){return Oe.invoke(qe,Bt)})}},Oe.attribCache={};var Me={};return Oe.scopeAttrib=function(qe){var Ce=Se.id(qe);if(Ce in Me)return Me[Ce];var At=en.scope[Ce];At||(At=en.scope[Ce]=new zt);var Bt=Me[Ce]=_e(At);return Bt},Oe}function qn(Oe){var _e=Oe.static,at=Oe.dynamic,Ot;if(Ji in _e){var kt=!!_e[Ji];Ot=jo(function(ot,St){return kt}),Ot.enable=kt}else if(Ji in at){var ft=at[Ji];Ot=Lu(ft,function(ot,St){return ot.invoke(St,ft)})}return Ot}function Ln(Oe,_e){var at=Oe.static,Ot=Oe.dynamic;if(No in at){var kt=at[No];return kt?(kt=Zr.getFramebuffer(kt),H.command(kt,"invalid framebuffer object"),jo(function(ot,St){var Me=ot.link(kt),qe=ot.shared;St.set(qe.framebuffer,".next",Me);var Ce=qe.context;return St.set(Ce,"."+gu,Me+".width"),St.set(Ce,"."+ga,Me+".height"),Me})):jo(function(ot,St){var Me=ot.shared;St.set(Me.framebuffer,".next","null");var qe=Me.context;return St.set(qe,"."+gu,qe+"."+Zl),St.set(qe,"."+ga,qe+"."+Lf),"null"})}else if(No in Ot){var ft=Ot[No];return Lu(ft,function(ot,St){var Me=ot.invoke(St,ft),qe=ot.shared,Ce=qe.framebuffer,At=St.def(Ce,".getFramebuffer(",Me,")");H.optional(function(){ot.assert(St,"!"+Me+"||"+At,"invalid framebuffer object")}),St.set(Ce,".next",At);var Bt=qe.context;return St.set(Bt,"."+gu,At+"?"+At+".width:"+Bt+"."+Zl),St.set(Bt,"."+ga,At+"?"+At+".height:"+Bt+"."+Lf),At})}else return null}function Bi(Oe,_e,at){var Ot=Oe.static,kt=Oe.dynamic;function ft(Me){if(Me in Ot){var qe=Ot[Me];H.commandType(qe,"object","invalid "+Me,at.commandStr);var Ce=!0,At=qe.x|0,Bt=qe.y|0,Sr,Kt;return"width"in qe?(Sr=qe.width|0,H.command(Sr>=0,"invalid "+Me,at.commandStr)):Ce=!1,"height"in qe?(Kt=qe.height|0,H.command(Kt>=0,"invalid "+Me,at.commandStr)):Ce=!1,new gs(!Ce&&_e&&_e.thisDep,!Ce&&_e&&_e.contextDep,!Ce&&_e&&_e.propDep,function(Fn,Oi){var zn=Fn.shared.context,ni=Sr;"width"in qe||(ni=Oi.def(zn,".",gu,"-",At));var gi=Kt;return"height"in qe||(gi=Oi.def(zn,".",ga,"-",Bt)),[At,Bt,ni,gi]})}else if(Me in kt){var br=kt[Me],Xr=Lu(br,function(Fn,Oi){var zn=Fn.invoke(Oi,br);H.optional(function(){Fn.assert(Oi,zn+"&&typeof "+zn+'==="object"',"invalid "+Me)});var ni=Fn.shared.context,gi=Oi.def(zn,".x|0"),da=Oi.def(zn,".y|0"),Vo=Oi.def('"width" in ',zn,"?",zn,".width|0:","(",ni,".",gu,"-",gi,")"),Ru=Oi.def('"height" in ',zn,"?",zn,".height|0:","(",ni,".",ga,"-",da,")");return H.optional(function(){Fn.assert(Oi,Vo+">=0&&"+Ru+">=0","invalid "+Me)}),[gi,da,Vo,Ru]});return _e&&(Xr.thisDep=Xr.thisDep||_e.thisDep,Xr.contextDep=Xr.contextDep||_e.contextDep,Xr.propDep=Xr.propDep||_e.propDep),Xr}else return _e?new gs(_e.thisDep,_e.contextDep,_e.propDep,function(Fn,Oi){var zn=Fn.shared.context;return[0,0,Oi.def(zn,".",gu),Oi.def(zn,".",ga)]}):null}var ot=ft(ws);if(ot){var St=ot;ot=new gs(ot.thisDep,ot.contextDep,ot.propDep,function(Me,qe){var Ce=St.append(Me,qe),At=Me.shared.context;return qe.set(At,"."+dh,Ce[2]),qe.set(At,"."+Hf,Ce[3]),Ce})}return{viewport:ot,scissor_box:ft(vu)}}function Ai(Oe,_e){var at=Oe.static,Ot=typeof at[Mu]=="string"&&typeof at[go]=="string";if(Ot){if(Object.keys(_e.dynamic).length>0)return null;var kt=_e.static,ft=Object.keys(kt);if(ft.length>0&&typeof kt[ft[0]]=="number"){for(var ot=[],St=0;St<ft.length;++St)H(typeof kt[ft[St]]=="number","must specify all vertex attribute locations when using vaos"),ot.push([kt[ft[St]]|0,ft[St]]);return ot}}return null}function Mi(Oe,_e,at){var Ot=Oe.static,kt=Oe.dynamic;function ft(Ce){if(Ce in Ot){var At=Se.id(Ot[Ce]);H.optional(function(){Kr.shader($o[Ce],At,H.guessCommand())});var Bt=jo(function(){return At});return Bt.id=At,Bt}else if(Ce in kt){var Sr=kt[Ce];return Lu(Sr,function(Kt,br){var Xr=Kt.invoke(br,Sr),Fn=br.def(Kt.shared.strings,".id(",Xr,")");return H.optional(function(){br(Kt.shared.shader,".shader(",$o[Ce],",",Fn,",",Kt.command,");")}),Fn})}return null}var ot=ft(Mu),St=ft(go),Me=null,qe;return iu(ot)&&iu(St)?(Me=Kr.program(St.id,ot.id,null,at),qe=jo(function(Ce,At){return Ce.link(Me)})):qe=new gs(ot&&ot.thisDep||St&&St.thisDep,ot&&ot.contextDep||St&&St.contextDep,ot&&ot.propDep||St&&St.propDep,function(Ce,At){var Bt=Ce.shared.shader,Sr;ot?Sr=ot.append(Ce,At):Sr=At.def(Bt,".",Mu);var Kt;St?Kt=St.append(Ce,At):Kt=At.def(Bt,".",go);var br=Bt+".program("+Kt+","+Sr;return H.optional(function(){br+=","+Ce.command}),At.def(br+")")}),{frag:ot,vert:St,progVar:qe,program:Me}}function na(Oe,_e){var at=Oe.static,Ot=Oe.dynamic;function kt(){if(ru in at){var Ce=at[ru];oc(Ce)?Ce=Yt.getElements(Yt.create(Ce,!0)):Ce&&(Ce=Yt.getElements(Ce),H.command(Ce,"invalid elements",_e.commandStr));var At=jo(function(Sr,Kt){if(Ce){var br=Sr.link(Ce);return Sr.ELEMENTS=br,br}return Sr.ELEMENTS=null,null});return At.value=Ce,At}else if(ru in Ot){var Bt=Ot[ru];return Lu(Bt,function(Sr,Kt){var br=Sr.shared,Xr=br.isBufferArgs,Fn=br.elements,Oi=Sr.invoke(Kt,Bt),zn=Kt.def("null"),ni=Kt.def(Xr,"(",Oi,")"),gi=Sr.cond(ni).then(zn,"=",Fn,".createStream(",Oi,");").else(zn,"=",Fn,".getElements(",Oi,");");return H.optional(function(){Sr.assert(gi.else,"!"+Oi+"||"+zn,"invalid elements")}),Kt.entry(gi),Kt.exit(Sr.cond(ni).then(Fn,".destroyStream(",zn,");")),Sr.ELEMENTS=zn,zn})}return null}var ft=kt();function ot(){if(mu in at){var Ce=at[mu];return H.commandParameter(Ce,bi,"invalid primitve",_e.commandStr),jo(function(Bt,Sr){return bi[Ce]})}else if(mu in Ot){var At=Ot[mu];return Lu(At,function(Bt,Sr){var Kt=Bt.constants.primTypes,br=Bt.invoke(Sr,At);return H.optional(function(){Bt.assert(Sr,br+" in "+Kt,"invalid primitive, must be one of "+Object.keys(bi))}),Sr.def(Kt,"[",br,"]")})}else if(ft)return iu(ft)?ft.value?jo(function(Bt,Sr){return Sr.def(Bt.ELEMENTS,".primType")}):jo(function(){return mr}):new gs(ft.thisDep,ft.contextDep,ft.propDep,function(Bt,Sr){var Kt=Bt.ELEMENTS;return Sr.def(Kt,"?",Kt,".primType:",mr)});return null}function St(Ce,At){if(Ce in at){var Bt=at[Ce]|0;return H.command(!At||Bt>=0,"invalid "+Ce,_e.commandStr),jo(function(Kt,br){return At&&(Kt.OFFSET=Bt),Bt})}else if(Ce in Ot){var Sr=Ot[Ce];return Lu(Sr,function(Kt,br){var Xr=Kt.invoke(br,Sr);return At&&(Kt.OFFSET=Xr,H.optional(function(){Kt.assert(br,Xr+">=0","invalid "+Ce)})),Xr})}else if(At&&ft)return jo(function(Kt,br){return Kt.OFFSET="0",0});return null}var Me=St(Iu,!0);function qe(){if(Gu in at){var Ce=at[Gu]|0;return H.command(typeof Ce=="number"&&Ce>=0,"invalid vertex count",_e.commandStr),jo(function(){return Ce})}else if(Gu in Ot){var At=Ot[Gu];return Lu(At,function(Kt,br){var Xr=Kt.invoke(br,At);return H.optional(function(){Kt.assert(br,"typeof "+Xr+'==="number"&&'+Xr+">=0&&"+Xr+"===("+Xr+"|0)","invalid vertex count")}),Xr})}else if(ft)if(iu(ft)){if(ft)return Me?new gs(Me.thisDep,Me.contextDep,Me.propDep,function(Kt,br){var Xr=br.def(Kt.ELEMENTS,".vertCount-",Kt.OFFSET);return H.optional(function(){Kt.assert(br,Xr+">=0","invalid vertex offset/element buffer too small")}),Xr}):jo(function(Kt,br){return br.def(Kt.ELEMENTS,".vertCount")});var Bt=jo(function(){return-1});return H.optional(function(){Bt.MISSING=!0}),Bt}else{var Sr=new gs(ft.thisDep||Me.thisDep,ft.contextDep||Me.contextDep,ft.propDep||Me.propDep,function(Kt,br){var Xr=Kt.ELEMENTS;return Kt.OFFSET?br.def(Xr,"?",Xr,".vertCount-",Kt.OFFSET,":-1"):br.def(Xr,"?",Xr,".vertCount:-1")});return H.optional(function(){Sr.DYNAMIC=!0}),Sr}return null}return{elements:ft,primitive:ot(),count:qe(),instances:St(Gs,!1),offset:Me}}function Qo(Oe,_e){var at=Oe.static,Ot=Oe.dynamic,kt={};return zr.forEach(function(ft){var ot=nn(ft);function St(Me,qe){if(ft in at){var Ce=Me(at[ft]);kt[ot]=jo(function(){return Ce})}else if(ft in Ot){var At=Ot[ft];kt[ot]=Lu(At,function(Bt,Sr){return qe(Bt,Sr,Bt.invoke(Sr,At))})}}switch(ft){case zo:case ri:case Ei:case jl:case os:case Pu:case Vs:case El:case Ls:case ro:return St(function(Me){return H.commandType(Me,"boolean",ft,_e.commandStr),Me},function(Me,qe,Ce){return H.optional(function(){Me.assert(qe,"typeof "+Ce+'==="boolean"',"invalid flag "+ft,Me.commandStr)}),Ce});case Fo:return St(function(Me){return H.commandParameter(Me,fo,"invalid "+ft,_e.commandStr),fo[Me]},function(Me,qe,Ce){var At=Me.constants.compareFuncs;return H.optional(function(){Me.assert(qe,Ce+" in "+At,"invalid "+ft+", must be one of "+Object.keys(fo))}),qe.def(At,"[",Ce,"]")});case Qa:return St(function(Me){return H.command(eo(Me)&&Me.length===2&&typeof Me[0]=="number"&&typeof Me[1]=="number"&&Me[0]<=Me[1],"depth range is 2d array",_e.commandStr),Me},function(Me,qe,Ce){H.optional(function(){Me.assert(qe,Me.shared.isArrayLike+"("+Ce+")&&"+Ce+".length===2&&typeof "+Ce+'[0]==="number"&&typeof '+Ce+'[1]==="number"&&'+Ce+"[0]<="+Ce+"[1]","depth range must be a 2d array")});var At=qe.def("+",Ce,"[0]"),Bt=qe.def("+",Ce,"[1]");return[At,Bt]});case Ja:return St(function(Me){H.commandType(Me,"object","blend.func",_e.commandStr);var qe="srcRGB"in Me?Me.srcRGB:Me.src,Ce="srcAlpha"in Me?Me.srcAlpha:Me.src,At="dstRGB"in Me?Me.dstRGB:Me.dst,Bt="dstAlpha"in Me?Me.dstAlpha:Me.dst;return H.commandParameter(qe,pa,ot+".srcRGB",_e.commandStr),H.commandParameter(Ce,pa,ot+".srcAlpha",_e.commandStr),H.commandParameter(At,pa,ot+".dstRGB",_e.commandStr),H.commandParameter(Bt,pa,ot+".dstAlpha",_e.commandStr),H.command(_o.indexOf(qe+", "+At)===-1,"unallowed blending combination (srcRGB, dstRGB) = ("+qe+", "+At+")",_e.commandStr),[pa[qe],pa[At],pa[Ce],pa[Bt]]},function(Me,qe,Ce){var At=Me.constants.blendFuncs;H.optional(function(){Me.assert(qe,Ce+"&&typeof "+Ce+'==="object"',"invalid blend func, must be an object")});function Bt(zn,ni){var gi=qe.def('"',zn,ni,'" in ',Ce,"?",Ce,".",zn,ni,":",Ce,".",zn);return H.optional(function(){Me.assert(qe,gi+" in "+At,"invalid "+ft+"."+zn+ni+", must be one of "+Object.keys(pa))}),gi}var Sr=Bt("src","RGB"),Kt=Bt("dst","RGB");H.optional(function(){var zn=Me.constants.invalidBlendCombinations;Me.assert(qe,zn+".indexOf("+Sr+'+", "+'+Kt+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")});var br=qe.def(At,"[",Sr,"]"),Xr=qe.def(At,"[",Bt("src","Alpha"),"]"),Fn=qe.def(At,"[",Kt,"]"),Oi=qe.def(At,"[",Bt("dst","Alpha"),"]");return[br,Fn,Xr,Oi]});case mo:return St(function(Me){if(typeof Me=="string")return H.commandParameter(Me,fr,"invalid "+ft,_e.commandStr),[fr[Me],fr[Me]];if(typeof Me=="object")return H.commandParameter(Me.rgb,fr,ft+".rgb",_e.commandStr),H.commandParameter(Me.alpha,fr,ft+".alpha",_e.commandStr),[fr[Me.rgb],fr[Me.alpha]];H.commandRaise("invalid blend.equation",_e.commandStr)},function(Me,qe,Ce){var At=Me.constants.blendEquations,Bt=qe.def(),Sr=qe.def(),Kt=Me.cond("typeof ",Ce,'==="string"');return H.optional(function(){function br(Xr,Fn,Oi){Me.assert(Xr,Oi+" in "+At,"invalid "+Fn+", must be one of "+Object.keys(fr))}br(Kt.then,ft,Ce),Me.assert(Kt.else,Ce+"&&typeof "+Ce+'==="object"',"invalid "+ft),br(Kt.else,ft+".rgb",Ce+".rgb"),br(Kt.else,ft+".alpha",Ce+".alpha")}),Kt.then(Bt,"=",Sr,"=",At,"[",Ce,"];"),Kt.else(Bt,"=",At,"[",Ce,".rgb];",Sr,"=",At,"[",Ce,".alpha];"),qe(Kt),[Bt,Sr]});case Qn:return St(function(Me){return H.command(eo(Me)&&Me.length===4,"blend.color must be a 4d array",_e.commandStr),I(4,function(qe){return+Me[qe]})},function(Me,qe,Ce){return H.optional(function(){Me.assert(qe,Me.shared.isArrayLike+"("+Ce+")&&"+Ce+".length===4","blend.color must be a 4d array")}),I(4,function(At){return qe.def("+",Ce,"[",At,"]")})});case du:return St(function(Me){return H.commandType(Me,"number",ot,_e.commandStr),Me|0},function(Me,qe,Ce){return H.optional(function(){Me.assert(qe,"typeof "+Ce+'==="number"',"invalid stencil.mask")}),qe.def(Ce,"|0")});case wl:return St(function(Me){H.commandType(Me,"object",ot,_e.commandStr);var qe=Me.cmp||"keep",Ce=Me.ref||0,At="mask"in Me?Me.mask:-1;return H.commandParameter(qe,fo,ft+".cmp",_e.commandStr),H.commandType(Ce,"number",ft+".ref",_e.commandStr),H.commandType(At,"number",ft+".mask",_e.commandStr),[fo[qe],Ce,At]},function(Me,qe,Ce){var At=Me.constants.compareFuncs;H.optional(function(){function br(){Me.assert(qe,Array.prototype.join.call(arguments,""),"invalid stencil.func")}br(Ce+"&&typeof ",Ce,'==="object"'),br('!("cmp" in ',Ce,")||(",Ce,".cmp in ",At,")")});var Bt=qe.def('"cmp" in ',Ce,"?",At,"[",Ce,".cmp]",":",Ti),Sr=qe.def(Ce,".ref|0"),Kt=qe.def('"mask" in ',Ce,"?",Ce,".mask|0:-1");return[Bt,Sr,Kt]});case tu:case no:return St(function(Me){H.commandType(Me,"object",ot,_e.commandStr);var qe=Me.fail||"keep",Ce=Me.zfail||"keep",At=Me.zpass||"keep";return H.commandParameter(qe,Ga,ft+".fail",_e.commandStr),H.commandParameter(Ce,Ga,ft+".zfail",_e.commandStr),H.commandParameter(At,Ga,ft+".zpass",_e.commandStr),[ft===no?In:Br,Ga[qe],Ga[Ce],Ga[At]]},function(Me,qe,Ce){var At=Me.constants.stencilOps;H.optional(function(){Me.assert(qe,Ce+"&&typeof "+Ce+'==="object"',"invalid "+ft)});function Bt(Sr){return H.optional(function(){Me.assert(qe,'!("'+Sr+'" in '+Ce+")||("+Ce+"."+Sr+" in "+At+")","invalid "+ft+"."+Sr+", must be one of "+Object.keys(Ga))}),qe.def('"',Sr,'" in ',Ce,"?",At,"[",Ce,".",Sr,"]:",Ti)}return[ft===no?In:Br,Bt("fail"),Bt("zfail"),Bt("zpass")]});case Sl:return St(function(Me){H.commandType(Me,"object",ot,_e.commandStr);var qe=Me.factor|0,Ce=Me.units|0;return H.commandType(qe,"number",ot+".factor",_e.commandStr),H.commandType(Ce,"number",ot+".units",_e.commandStr),[qe,Ce]},function(Me,qe,Ce){H.optional(function(){Me.assert(qe,Ce+"&&typeof "+Ce+'==="object"',"invalid "+ft)});var At=qe.def(Ce,".factor|0"),Bt=qe.def(Ce,".units|0");return[At,Bt]});case Cu:return St(function(Me){var qe=0;return Me==="front"?qe=Br:Me==="back"&&(qe=In),H.command(!!qe,ot,_e.commandStr),qe},function(Me,qe,Ce){return H.optional(function(){Me.assert(qe,Ce+'==="front"||'+Ce+'==="back"',"invalid cull.face")}),qe.def(Ce,'==="front"?',Br,":",In)});case Zs:return St(function(Me){return H.command(typeof Me=="number"&&Me>=qt.lineWidthDims[0]&&Me<=qt.lineWidthDims[1],"invalid line width, must be a positive number between "+qt.lineWidthDims[0]+" and "+qt.lineWidthDims[1],_e.commandStr),Me},function(Me,qe,Ce){return H.optional(function(){Me.assert(qe,"typeof "+Ce+'==="number"&&'+Ce+">="+qt.lineWidthDims[0]+"&&"+Ce+"<="+qt.lineWidthDims[1],"invalid line width")}),Ce});case ss:return St(function(Me){return H.commandParameter(Me,Jo,ot,_e.commandStr),Jo[Me]},function(Me,qe,Ce){return H.optional(function(){Me.assert(qe,Ce+'==="cw"||'+Ce+'==="ccw"',"invalid frontFace, must be one of cw,ccw")}),qe.def(Ce+'==="cw"?'+Bn+":"+fi)});case ms:return St(function(Me){return H.command(eo(Me)&&Me.length===4,"color.mask must be length 4 array",_e.commandStr),Me.map(function(qe){return!!qe})},function(Me,qe,Ce){return H.optional(function(){Me.assert(qe,Me.shared.isArrayLike+"("+Ce+")&&"+Ce+".length===4","invalid color.mask")}),I(4,function(At){return"!!"+Ce+"["+At+"]"})});case Vu:return St(function(Me){H.command(typeof Me=="object"&&Me,ot,_e.commandStr);var qe="value"in Me?Me.value:1,Ce=!!Me.invert;return H.command(typeof qe=="number"&&qe>=0&&qe<=1,"sample.coverage.value must be a number between 0 and 1",_e.commandStr),[qe,Ce]},function(Me,qe,Ce){H.optional(function(){Me.assert(qe,Ce+"&&typeof "+Ce+'==="object"',"invalid sample.coverage")});var At=qe.def('"value" in ',Ce,"?+",Ce,".value:1"),Bt=qe.def("!!",Ce,".invert");return[At,Bt]})}}),kt}function Rs(Oe,_e){var at=Oe.static,Ot=Oe.dynamic,kt={};return Object.keys(at).forEach(function(ft){var ot=at[ft],St;if(typeof ot=="number"||typeof ot=="boolean")St=jo(function(){return ot});else if(typeof ot=="function"){var Me=ot._reglType;Me==="texture2d"||Me==="textureCube"?St=jo(function(qe){return qe.link(ot)}):Me==="framebuffer"||Me==="framebufferCube"?(H.command(ot.color.length>0,'missing color attachment for framebuffer sent to uniform "'+ft+'"',_e.commandStr),St=jo(function(qe){return qe.link(ot.color[0])})):H.commandRaise('invalid data for uniform "'+ft+'"',_e.commandStr)}else eo(ot)?St=jo(function(qe){var Ce=qe.global.def("[",I(ot.length,function(At){return H.command(typeof ot[At]=="number"||typeof ot[At]=="boolean","invalid uniform "+ft,qe.commandStr),ot[At]}),"]");return Ce}):H.commandRaise('invalid or missing data for uniform "'+ft+'"',_e.commandStr);St.value=ot,kt[ft]=St}),Object.keys(Ot).forEach(function(ft){var ot=Ot[ft];kt[ft]=Lu(ot,function(St,Me){return St.invoke(Me,ot)})}),kt}function Qi(Oe,_e){var at=Oe.static,Ot=Oe.dynamic,kt={};return Object.keys(at).forEach(function(ft){var ot=at[ft],St=Se.id(ft),Me=new zt;if(oc(ot))Me.state=jn,Me.buffer=wr.getBuffer(wr.create(ot,ic,!1,!0)),Me.type=0;else{var qe=wr.getBuffer(ot);if(qe)Me.state=jn,Me.buffer=qe,Me.type=0;else if(H.command(typeof ot=="object"&&ot,"invalid data for attribute "+ft,_e.commandStr),"constant"in ot){var Ce=ot.constant;Me.buffer="null",Me.state=Xn,typeof Ce=="number"?Me.x=Ce:(H.command(eo(Ce)&&Ce.length>0&&Ce.length<=4,"invalid constant for attribute "+ft,_e.commandStr),Qr.forEach(function(Fn,Oi){Oi<Ce.length&&(Me[Fn]=Ce[Oi])}))}else{oc(ot.buffer)?qe=wr.getBuffer(wr.create(ot.buffer,ic,!1,!0)):qe=wr.getBuffer(ot.buffer),H.command(!!qe,'missing buffer for attribute "'+ft+'"',_e.commandStr);var At=ot.offset|0;H.command(At>=0,'invalid offset for attribute "'+ft+'"',_e.commandStr);var Bt=ot.stride|0;H.command(Bt>=0&&Bt<256,'invalid stride for attribute "'+ft+'", must be integer betweeen [0, 255]',_e.commandStr);var Sr=ot.size|0;H.command(!("size"in ot)||Sr>0&&Sr<=4,'invalid size for attribute "'+ft+'", must be 1,2,3,4',_e.commandStr);var Kt=!!ot.normalized,br=0;"type"in ot&&(H.commandParameter(ot.type,so,"invalid type for attribute "+ft,_e.commandStr),br=so[ot.type]);var Xr=ot.divisor|0;"divisor"in ot&&(H.command(Xr===0||Gr,'cannot specify divisor for attribute "'+ft+'", instancing not supported',_e.commandStr),H.command(Xr>=0,'invalid divisor for attribute "'+ft+'"',_e.commandStr)),H.optional(function(){var Fn=_e.commandStr,Oi=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(ot).forEach(function(zn){H.command(Oi.indexOf(zn)>=0,'unknown parameter "'+zn+'" for attribute pointer "'+ft+'" (valid parameters are '+Oi+")",Fn)})}),Me.buffer=qe,Me.state=jn,Me.size=Sr,Me.normalized=Kt,Me.type=br||qe.dtype,Me.offset=At,Me.stride=Bt,Me.divisor=Xr}}kt[ft]=jo(function(Fn,Oi){var zn=Fn.attribCache;if(St in zn)return zn[St];var ni={isStream:!1};return Object.keys(Me).forEach(function(gi){ni[gi]=Me[gi]}),Me.buffer&&(ni.buffer=Fn.link(Me.buffer),ni.type=ni.type||ni.buffer+".dtype"),zn[St]=ni,ni})}),Object.keys(Ot).forEach(function(ft){var ot=Ot[ft];function St(Me,qe){var Ce=Me.invoke(qe,ot),At=Me.shared,Bt=Me.constants,Sr=At.isBufferArgs,Kt=At.buffer;H.optional(function(){Me.assert(qe,Ce+"&&(typeof "+Ce+'==="object"||typeof '+Ce+'==="function")&&('+Sr+"("+Ce+")||"+Kt+".getBuffer("+Ce+")||"+Kt+".getBuffer("+Ce+".buffer)||"+Sr+"("+Ce+'.buffer)||("constant" in '+Ce+"&&(typeof "+Ce+'.constant==="number"||'+At.isArrayLike+"("+Ce+".constant))))",'invalid dynamic attribute "'+ft+'"')});var br={isStream:qe.def(!1)},Xr=new zt;Xr.state=jn,Object.keys(Xr).forEach(function(ni){br[ni]=qe.def(""+Xr[ni])});var Fn=br.buffer,Oi=br.type;qe("if(",Sr,"(",Ce,")){",br.isStream,"=true;",Fn,"=",Kt,".createStream(",ic,",",Ce,");",Oi,"=",Fn,".dtype;","}else{",Fn,"=",Kt,".getBuffer(",Ce,");","if(",Fn,"){",Oi,"=",Fn,".dtype;",'}else if("constant" in ',Ce,"){",br.state,"=",Xn,";","if(typeof "+Ce+'.constant === "number"){',br[Qr[0]],"=",Ce,".constant;",Qr.slice(1).map(function(ni){return br[ni]}).join("="),"=0;","}else{",Qr.map(function(ni,gi){return br[ni]+"="+Ce+".constant.length>"+gi+"?"+Ce+".constant["+gi+"]:0;"}).join(""),"}}else{","if(",Sr,"(",Ce,".buffer)){",Fn,"=",Kt,".createStream(",ic,",",Ce,".buffer);","}else{",Fn,"=",Kt,".getBuffer(",Ce,".buffer);","}",Oi,'="type" in ',Ce,"?",Bt.glTypes,"[",Ce,".type]:",Fn,".dtype;",br.normalized,"=!!",Ce,".normalized;");function zn(ni){qe(br[ni],"=",Ce,".",ni,"|0;")}return zn("size"),zn("offset"),zn("stride"),zn("divisor"),qe("}}"),qe.exit("if(",br.isStream,"){",Kt,".destroyStream(",Fn,");","}"),br}kt[ft]=Lu(ot,St)}),kt}function Eo(Oe,_e){var at=Oe.static,Ot=Oe.dynamic;if(nu in at){var kt=at[nu];return kt!==null&&en.getVAO(kt)===null&&(kt=en.createVAO(kt)),jo(function(ot){return ot.link(en.getVAO(kt))})}else if(nu in Ot){var ft=Ot[nu];return Lu(ft,function(ot,St){var Me=ot.invoke(St,ft);return St.def(ot.shared.vao+".getVAO("+Me+")")})}return null}function ua(Oe){var _e=Oe.static,at=Oe.dynamic,Ot={};return Object.keys(_e).forEach(function(kt){var ft=_e[kt];Ot[kt]=jo(function(ot,St){return typeof ft=="number"||typeof ft=="boolean"?""+ft:ot.link(ft)})}),Object.keys(at).forEach(function(kt){var ft=at[kt];Ot[kt]=Lu(ft,function(ot,St){return ot.invoke(St,ft)})}),Ot}function wo(Oe,_e,at,Ot,kt){var ft=Oe.static,ot=Oe.dynamic;H.optional(function(){var zn=[No,go,Mu,ru,mu,Iu,Gu,Gs,Ji,nu].concat(zr);function ni(gi){Object.keys(gi).forEach(function(da){H.command(zn.indexOf(da)>=0,'unknown parameter "'+da+'"',kt.commandStr)})}ni(ft),ni(ot)});var St=Ai(Oe,_e),Me=Ln(Oe,kt),qe=Bi(Oe,Me,kt),Ce=na(Oe,kt),At=Qo(Oe,kt),Bt=Mi(Oe,kt,St);function Sr(zn){var ni=qe[zn];ni&&(At[zn]=ni)}Sr(ws),Sr(nn(vu));var Kt=Object.keys(At).length>0,br={framebuffer:Me,draw:Ce,shader:Bt,state:At,dirty:Kt,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}};if(br.profile=qn(Oe,kt),br.uniforms=Rs(at,kt),br.drawVAO=br.scopeVAO=Eo(Oe,kt),!br.drawVAO&&Bt.program&&!St&&ke.angle_instanced_arrays){var Xr=!0,Fn=Bt.program.attributes.map(function(zn){var ni=_e.static[zn];return Xr=Xr&&!!ni,ni});if(Xr&&Fn.length>0){var Oi=en.getVAO(en.createVAO(Fn));br.drawVAO=new gs(null,null,null,function(zn,ni){return zn.link(Oi)}),br.useVAO=!0}}return St?br.useVAO=!0:br.attributes=Qi(_e,kt),br.context=ua(Ot,kt),br}function qo(Oe,_e,at){var Ot=Oe.shared,kt=Ot.context,ft=Oe.scope();Object.keys(at).forEach(function(ot){_e.save(kt,"."+ot);var St=at[ot],Me=St.append(Oe,_e);Array.isArray(Me)?ft(kt,".",ot,"=[",Me.join(),"];"):ft(kt,".",ot,"=",Me,";")}),_e(ft)}function es(Oe,_e,at,Ot){var kt=Oe.shared,ft=kt.gl,ot=kt.framebuffer,St;mn&&(St=_e.def(kt.extensions,".webgl_draw_buffers"));var Me=Oe.constants,qe=Me.drawBuffer,Ce=Me.backBuffer,At;at?At=at.append(Oe,_e):At=_e.def(ot,".next"),Ot||_e("if(",At,"!==",ot,".cur){"),_e("if(",At,"){",ft,".bindFramebuffer(",co,",",At,".framebuffer);"),mn&&_e(St,".drawBuffersWEBGL(",qe,"[",At,".colorAttachments.length]);"),_e("}else{",ft,".bindFramebuffer(",co,",null);"),mn&&_e(St,".drawBuffersWEBGL(",Ce,");"),_e("}",ot,".cur=",At,";"),Ot||_e("}")}function Ds(Oe,_e,at){var Ot=Oe.shared,kt=Ot.gl,ft=Oe.current,ot=Oe.next,St=Ot.current,Me=Ot.next,qe=Oe.cond(St,".dirty");zr.forEach(function(Ce){var At=nn(Ce);if(!(At in at.state)){var Bt,Sr;if(At in ot){Bt=ot[At],Sr=ft[At];var Kt=I(Dr[At].length,function(Xr){return qe.def(Bt,"[",Xr,"]")});qe(Oe.cond(Kt.map(function(Xr,Fn){return Xr+"!=="+Sr+"["+Fn+"]"}).join("||")).then(kt,".",Rr[At],"(",Kt,");",Kt.map(function(Xr,Fn){return Sr+"["+Fn+"]="+Xr}).join(";"),";"))}else{Bt=qe.def(Me,".",At);var br=Oe.cond(Bt,"!==",St,".",At);qe(br),At in sn?br(Oe.cond(Bt).then(kt,".enable(",sn[At],");").else(kt,".disable(",sn[At],");"),St,".",At,"=",Bt,";"):br(kt,".",Rr[At],"(",Bt,");",St,".",At,"=",Bt,";")}}}),Object.keys(at.state).length===0&&qe(St,".dirty=false;"),_e(qe)}function ks(Oe,_e,at,Ot){var kt=Oe.shared,ft=Oe.current,ot=kt.current,St=kt.gl;Gl(Object.keys(at)).forEach(function(Me){var qe=at[Me];if(!(Ot&&!Ot(qe))){var Ce=qe.append(Oe,_e);if(sn[Me]){var At=sn[Me];iu(qe)?Ce?_e(St,".enable(",At,");"):_e(St,".disable(",At,");"):_e(Oe.cond(Ce).then(St,".enable(",At,");").else(St,".disable(",At,");")),_e(ot,".",Me,"=",Ce,";")}else if(eo(Ce)){var Bt=ft[Me];_e(St,".",Rr[Me],"(",Ce,");",Ce.map(function(Sr,Kt){return Bt+"["+Kt+"]="+Sr}).join(";"),";")}else _e(St,".",Rr[Me],"(",Ce,");",ot,".",Me,"=",Ce,";")}})}function Zo(Oe,_e){Gr&&(Oe.instancing=_e.def(Oe.shared.extensions,".angle_instanced_arrays"))}function Ii(Oe,_e,at,Ot,kt){var ft=Oe.shared,ot=Oe.stats,St=ft.current,Me=ft.timer,qe=at.profile;function Ce(){return typeof performance=="undefined"?"Date.now()":"performance.now()"}var At,Bt;function Sr(zn){At=_e.def(),zn(At,"=",Ce(),";"),typeof kt=="string"?zn(ot,".count+=",kt,";"):zn(ot,".count++;"),Vr&&(Ot?(Bt=_e.def(),zn(Bt,"=",Me,".getNumPendingQueries();")):zn(Me,".beginQuery(",ot,");"))}function Kt(zn){zn(ot,".cpuTime+=",Ce(),"-",At,";"),Vr&&(Ot?zn(Me,".pushScopeStats(",Bt,",",Me,".getNumPendingQueries(),",ot,");"):zn(Me,".endQuery();"))}function br(zn){var ni=_e.def(St,".profile");_e(St,".profile=",zn,";"),_e.exit(St,".profile=",ni,";")}var Xr;if(qe){if(iu(qe)){qe.enable?(Sr(_e),Kt(_e.exit),br("true")):br("false");return}Xr=qe.append(Oe,_e),br(Xr)}else Xr=_e.def(St,".profile");var Fn=Oe.block();Sr(Fn),_e("if(",Xr,"){",Fn,"}");var Oi=Oe.block();Kt(Oi),_e.exit("if(",Xr,"){",Oi,"}")}function Fs(Oe,_e,at,Ot,kt){var ft=Oe.shared;function ot(Me){switch(Me){case bf:case Al:case U:return 2;case yo:case Gc:case P:return 3;case nf:case ac:case O:return 4;default:return 1}}function St(Me,qe,Ce){var At=ft.gl,Bt=_e.def(Me,".location"),Sr=_e.def(ft.attributes,"[",Bt,"]"),Kt=Ce.state,br=Ce.buffer,Xr=[Ce.x,Ce.y,Ce.z,Ce.w],Fn=["buffer","normalized","offset","stride"];function Oi(){_e("if(!",Sr,".buffer){",At,".enableVertexAttribArray(",Bt,");}");var ni=Ce.type,gi;if(Ce.size?gi=_e.def(Ce.size,"||",qe):gi=qe,_e("if(",Sr,".type!==",ni,"||",Sr,".size!==",gi,"||",Fn.map(function(Vo){return Sr+"."+Vo+"!=="+Ce[Vo]}).join("||"),"){",At,".bindBuffer(",ic,",",br,".buffer);",At,".vertexAttribPointer(",[Bt,gi,ni,Ce.normalized,Ce.stride,Ce.offset],");",Sr,".type=",ni,";",Sr,".size=",gi,";",Fn.map(function(Vo){return Sr+"."+Vo+"="+Ce[Vo]+";"}).join(""),"}"),Gr){var da=Ce.divisor;_e("if(",Sr,".divisor!==",da,"){",Oe.instancing,".vertexAttribDivisorANGLE(",[Bt,da],");",Sr,".divisor=",da,";}")}}function zn(){_e("if(",Sr,".buffer){",At,".disableVertexAttribArray(",Bt,");",Sr,".buffer=null;","}if(",Qr.map(function(ni,gi){return Sr+"."+ni+"!=="+Xr[gi]}).join("||"),"){",At,".vertexAttrib4f(",Bt,",",Xr,");",Qr.map(function(ni,gi){return Sr+"."+ni+"="+Xr[gi]+";"}).join(""),"}")}Kt===jn?Oi():Kt===Xn?zn():(_e("if(",Kt,"===",jn,"){"),Oi(),_e("}else{"),zn(),_e("}"))}Ot.forEach(function(Me){var qe=Me.name,Ce=at.attributes[qe],At;if(Ce){if(!kt(Ce))return;At=Ce.append(Oe,_e)}else{if(!kt(Uh))return;var Bt=Oe.scopeAttrib(qe);H.optional(function(){Oe.assert(_e,Bt+".state","missing attribute "+qe)}),At={},Object.keys(new zt).forEach(function(Sr){At[Sr]=_e.def(Bt,".",Sr)})}St(Oe.link(Me),ot(Me.info.type),At)})}function la(Oe,_e,at,Ot,kt){for(var ft=Oe.shared,ot=ft.gl,St,Me=0;Me<Ot.length;++Me){var qe=Ot[Me],Ce=qe.name,At=qe.info.type,Bt=at.uniforms[Ce],Sr=Oe.link(qe),Kt=Sr+".location",br;if(Bt){if(!kt(Bt))continue;if(iu(Bt)){var Xr=Bt.value;if(H.command(Xr!==null&&typeof Xr!="undefined",'missing uniform "'+Ce+'"',Oe.commandStr),At===xt||At===vt){H.command(typeof Xr=="function"&&(At===xt&&(Xr._reglType==="texture2d"||Xr._reglType==="framebuffer")||At===vt&&(Xr._reglType==="textureCube"||Xr._reglType==="framebufferCube")),"invalid texture for uniform "+Ce,Oe.commandStr);var Fn=Oe.link(Xr._texture||Xr.color[0]._texture);_e(ot,".uniform1i(",Kt,",",Fn+".bind());"),_e.exit(Fn,".unbind();")}else if(At===q||At===ve||At===$e){H.optional(function(){H.command(eo(Xr),"invalid matrix for uniform "+Ce,Oe.commandStr),H.command(At===q&&Xr.length===4||At===ve&&Xr.length===9||At===$e&&Xr.length===16,"invalid length for matrix uniform "+Ce,Oe.commandStr)});var Oi=Oe.global.def("new Float32Array(["+Array.prototype.slice.call(Xr)+"])"),zn=2;At===ve?zn=3:At===$e&&(zn=4),_e(ot,".uniformMatrix",zn,"fv(",Kt,",false,",Oi,");")}else{switch(At){case Ou:H.commandType(Xr,"number","uniform "+Ce,Oe.commandStr),St="1f";break;case bf:H.command(eo(Xr)&&Xr.length===2,"uniform "+Ce,Oe.commandStr),St="2f";break;case yo:H.command(eo(Xr)&&Xr.length===3,"uniform "+Ce,Oe.commandStr),St="3f";break;case nf:H.command(eo(Xr)&&Xr.length===4,"uniform "+Ce,Oe.commandStr),St="4f";break;case N:H.commandType(Xr,"boolean","uniform "+Ce,Oe.commandStr),St="1i";break;case Ff:H.commandType(Xr,"number","uniform "+Ce,Oe.commandStr),St="1i";break;case U:H.command(eo(Xr)&&Xr.length===2,"uniform "+Ce,Oe.commandStr),St="2i";break;case Al:H.command(eo(Xr)&&Xr.length===2,"uniform "+Ce,Oe.commandStr),St="2i";break;case P:H.command(eo(Xr)&&Xr.length===3,"uniform "+Ce,Oe.commandStr),St="3i";break;case Gc:H.command(eo(Xr)&&Xr.length===3,"uniform "+Ce,Oe.commandStr),St="3i";break;case O:H.command(eo(Xr)&&Xr.length===4,"uniform "+Ce,Oe.commandStr),St="4i";break;case ac:H.command(eo(Xr)&&Xr.length===4,"uniform "+Ce,Oe.commandStr),St="4i";break}_e(ot,".uniform",St,"(",Kt,",",eo(Xr)?Array.prototype.slice.call(Xr):Xr,");")}continue}else br=Bt.append(Oe,_e)}else{if(!kt(Uh))continue;br=_e.def(ft.uniforms,"[",Se.id(Ce),"]")}At===xt?(H(!Array.isArray(br),"must specify a scalar prop for textures"),_e("if(",br,"&&",br,'._reglType==="framebuffer"){',br,"=",br,".color[0];","}")):At===vt&&(H(!Array.isArray(br),"must specify a scalar prop for cube maps"),_e("if(",br,"&&",br,'._reglType==="framebufferCube"){',br,"=",br,".color[0];","}")),H.optional(function(){function Ru(ol,wf){Oe.assert(_e,ol,'bad data or missing for uniform "'+Ce+'".  '+wf)}function qf(ol){H(!Array.isArray(br),"must not specify an array type for uniform"),Ru("typeof "+br+'==="'+ol+'"',"invalid type, expected "+ol)}function Hu(ol,wf){Array.isArray(br)?H(br.length===ol,"must have length "+ol):Ru(ft.isArrayLike+"("+br+")&&"+br+".length==="+ol,"invalid vector, should have length "+ol,Oe.commandStr)}function Sh(ol){H(!Array.isArray(br),"must not specify a value type"),Ru("typeof "+br+'==="function"&&'+br+'._reglType==="texture'+(ol===Vl?"2d":"Cube")+'"',"invalid texture type",Oe.commandStr)}switch(At){case Ff:qf("number");break;case Al:Hu(2,"number");break;case Gc:Hu(3,"number");break;case ac:Hu(4,"number");break;case Ou:qf("number");break;case bf:Hu(2,"number");break;case yo:Hu(3,"number");break;case nf:Hu(4,"number");break;case N:qf("boolean");break;case U:Hu(2,"boolean");break;case P:Hu(3,"boolean");break;case O:Hu(4,"boolean");break;case q:Hu(4,"number");break;case ve:Hu(9,"number");break;case $e:Hu(16,"number");break;case xt:Sh(Vl);break;case vt:Sh(Vc);break}});var ni=1;switch(At){case xt:case vt:var gi=_e.def(br,"._texture");_e(ot,".uniform1i(",Kt,",",gi,".bind());"),_e.exit(gi,".unbind();");continue;case Ff:case N:St="1i";break;case Al:case U:St="2i",ni=2;break;case Gc:case P:St="3i",ni=3;break;case ac:case O:St="4i",ni=4;break;case Ou:St="1f";break;case bf:St="2f",ni=2;break;case yo:St="3f",ni=3;break;case nf:St="4f",ni=4;break;case q:St="Matrix2fv";break;case ve:St="Matrix3fv";break;case $e:St="Matrix4fv";break}if(_e(ot,".uniform",St,"(",Kt,","),St.charAt(0)==="M"){var da=Math.pow(At-q+2,2),Vo=Oe.global.def("new Float32Array(",da,")");Array.isArray(br)?_e("false,(",I(da,function(Ru){return Vo+"["+Ru+"]="+br[Ru]}),",",Vo,")"):_e("false,(Array.isArray(",br,")||",br," instanceof Float32Array)?",br,":(",I(da,function(Ru){return Vo+"["+Ru+"]="+br+"["+Ru+"]"}),",",Vo,")")}else ni>1?_e(I(ni,function(Ru){return Array.isArray(br)?br[Ru]:br+"["+Ru+"]"})):(H(!Array.isArray(br),"uniform value must not be an array"),_e(br));_e(");")}}function $n(Oe,_e,at,Ot){var kt=Oe.shared,ft=kt.gl,ot=kt.draw,St=Ot.draw;function Me(){var gi=St.elements,da,Vo=_e;return gi?((gi.contextDep&&Ot.contextDynamic||gi.propDep)&&(Vo=at),da=gi.append(Oe,Vo)):da=Vo.def(ot,".",ru),da&&Vo("if("+da+")"+ft+".bindBuffer("+Rf+","+da+".buffer.buffer);"),da}function qe(){var gi=St.count,da,Vo=_e;return gi?((gi.contextDep&&Ot.contextDynamic||gi.propDep)&&(Vo=at),da=gi.append(Oe,Vo),H.optional(function(){gi.MISSING&&Oe.assert(_e,"false","missing vertex count"),gi.DYNAMIC&&Oe.assert(Vo,da+">=0","missing vertex count")})):(da=Vo.def(ot,".",Gu),H.optional(function(){Oe.assert(Vo,da+">=0","missing vertex count")})),da}var Ce=Me();function At(gi){var da=St[gi];return da?da.contextDep&&Ot.contextDynamic||da.propDep?da.append(Oe,at):da.append(Oe,_e):_e.def(ot,".",gi)}var Bt=At(mu),Sr=At(Iu),Kt=qe();if(typeof Kt=="number"){if(Kt===0)return}else at("if(",Kt,"){"),at.exit("}");var br,Xr;Gr&&(br=At(Gs),Xr=Oe.instancing);var Fn=Ce+".type",Oi=St.elements&&iu(St.elements);function zn(){function gi(){at(Xr,".drawElementsInstancedANGLE(",[Bt,Kt,Fn,Sr+"<<(("+Fn+"-"+xn+")>>1)",br],");")}function da(){at(Xr,".drawArraysInstancedANGLE(",[Bt,Sr,Kt,br],");")}Ce?Oi?gi():(at("if(",Ce,"){"),gi(),at("}else{"),da(),at("}")):da()}function ni(){function gi(){at(ft+".drawElements("+[Bt,Kt,Fn,Sr+"<<(("+Fn+"-"+xn+")>>1)"]+");")}function da(){at(ft+".drawArrays("+[Bt,Sr,Kt]+");")}Ce?Oi?gi():(at("if(",Ce,"){"),gi(),at("}else{"),da(),at("}")):da()}Gr&&(typeof br!="number"||br>=0)?typeof br=="string"?(at("if(",br,">0){"),zn(),at("}else if(",br,"<0){"),ni(),at("}")):zn():ni()}function Hi(Oe,_e,at,Ot,kt){var ft=ui(),ot=ft.proc("body",kt);return H.optional(function(){ft.commandStr=_e.commandStr,ft.command=ft.link(_e.commandStr)}),Gr&&(ft.instancing=ot.def(ft.shared.extensions,".angle_instanced_arrays")),Oe(ft,ot,at,Ot),ft.compile().body}function ia(Oe,_e,at,Ot){Zo(Oe,_e),at.useVAO?at.drawVAO?_e(Oe.shared.vao,".setVAO(",at.drawVAO.append(Oe,_e),");"):_e(Oe.shared.vao,".setVAO(",Oe.shared.vao,".targetVAO);"):(_e(Oe.shared.vao,".setVAO(null);"),Fs(Oe,_e,at,Ot.attributes,function(){return!0})),la(Oe,_e,at,Ot.uniforms,function(){return!0}),$n(Oe,_e,_e,at)}function Io(Oe,_e){var at=Oe.proc("draw",1);Zo(Oe,at),qo(Oe,at,_e.context),es(Oe,at,_e.framebuffer),Ds(Oe,at,_e),ks(Oe,at,_e.state),Ii(Oe,at,_e,!1,!0);var Ot=_e.shader.progVar.append(Oe,at);if(at(Oe.shared.gl,".useProgram(",Ot,".program);"),_e.shader.program)ia(Oe,at,_e,_e.shader.program);else{at(Oe.shared.vao,".setVAO(null);");var kt=Oe.global.def("{}"),ft=at.def(Ot,".id"),ot=at.def(kt,"[",ft,"]");at(Oe.cond(ot).then(ot,".call(this,a0);").else(ot,"=",kt,"[",ft,"]=",Oe.link(function(St){return Hi(ia,Oe,_e,St,1)}),"(",Ot,");",ot,".call(this,a0);"))}Object.keys(_e.state).length>0&&at(Oe.shared.current,".dirty=true;")}function yu(Oe,_e,at,Ot){Oe.batchId="a1",Zo(Oe,_e);function kt(){return!0}Fs(Oe,_e,at,Ot.attributes,kt),la(Oe,_e,at,Ot.uniforms,kt),$n(Oe,_e,_e,at)}function _u(Oe,_e,at,Ot){Zo(Oe,_e);var kt=at.contextDep,ft=_e.def(),ot="a0",St="a1",Me=_e.def();Oe.shared.props=Me,Oe.batchId=ft;var qe=Oe.scope(),Ce=Oe.scope();_e(qe.entry,"for(",ft,"=0;",ft,"<",St,";++",ft,"){",Me,"=",ot,"[",ft,"];",Ce,"}",qe.exit);function At(Fn){return Fn.contextDep&&kt||Fn.propDep}function Bt(Fn){return!At(Fn)}if(at.needsContext&&qo(Oe,Ce,at.context),at.needsFramebuffer&&es(Oe,Ce,at.framebuffer),ks(Oe,Ce,at.state,At),at.profile&&At(at.profile)&&Ii(Oe,Ce,at,!1,!0),Ot)at.useVAO?at.drawVAO?At(at.drawVAO)?Ce(Oe.shared.vao,".setVAO(",at.drawVAO.append(Oe,Ce),");"):qe(Oe.shared.vao,".setVAO(",at.drawVAO.append(Oe,qe),");"):qe(Oe.shared.vao,".setVAO(",Oe.shared.vao,".targetVAO);"):(qe(Oe.shared.vao,".setVAO(null);"),Fs(Oe,qe,at,Ot.attributes,Bt),Fs(Oe,Ce,at,Ot.attributes,At)),la(Oe,qe,at,Ot.uniforms,Bt),la(Oe,Ce,at,Ot.uniforms,At),$n(Oe,qe,Ce,at);else{var Sr=Oe.global.def("{}"),Kt=at.shader.progVar.append(Oe,Ce),br=Ce.def(Kt,".id"),Xr=Ce.def(Sr,"[",br,"]");Ce(Oe.shared.gl,".useProgram(",Kt,".program);","if(!",Xr,"){",Xr,"=",Sr,"[",br,"]=",Oe.link(function(Fn){return Hi(yu,Oe,at,Fn,2)}),"(",Kt,");}",Xr,".call(this,a0[",ft,"],",ft,");")}}function Fe(Oe,_e){var at=Oe.proc("batch",2);Oe.batchId="0",Zo(Oe,at);var Ot=!1,kt=!0;Object.keys(_e.context).forEach(function(Sr){Ot=Ot||_e.context[Sr].propDep}),Ot||(qo(Oe,at,_e.context),kt=!1);var ft=_e.framebuffer,ot=!1;ft?(ft.propDep?Ot=ot=!0:ft.contextDep&&Ot&&(ot=!0),ot||es(Oe,at,ft)):es(Oe,at,null),_e.state.viewport&&_e.state.viewport.propDep&&(Ot=!0);function St(Sr){return Sr.contextDep&&Ot||Sr.propDep}Ds(Oe,at,_e),ks(Oe,at,_e.state,function(Sr){return!St(Sr)}),(!_e.profile||!St(_e.profile))&&Ii(Oe,at,_e,!1,"a1"),_e.contextDep=Ot,_e.needsContext=kt,_e.needsFramebuffer=ot;var Me=_e.shader.progVar;if(Me.contextDep&&Ot||Me.propDep)_u(Oe,at,_e,null);else{var qe=Me.append(Oe,at);if(at(Oe.shared.gl,".useProgram(",qe,".program);"),_e.shader.program)_u(Oe,at,_e,_e.shader.program);else{at(Oe.shared.vao,".setVAO(null);");var Ce=Oe.global.def("{}"),At=at.def(qe,".id"),Bt=at.def(Ce,"[",At,"]");at(Oe.cond(Bt).then(Bt,".call(this,a0,a1);").else(Bt,"=",Ce,"[",At,"]=",Oe.link(function(Sr){return Hi(_u,Oe,_e,Sr,2)}),"(",qe,");",Bt,".call(this,a0,a1);"))}}Object.keys(_e.state).length>0&&at(Oe.shared.current,".dirty=true;")}function er(Oe,_e){var at=Oe.proc("scope",3);Oe.batchId="a2";var Ot=Oe.shared,kt=Ot.current;qo(Oe,at,_e.context),_e.framebuffer&&_e.framebuffer.append(Oe,at),Gl(Object.keys(_e.state)).forEach(function(ot){var St=_e.state[ot],Me=St.append(Oe,at);eo(Me)?Me.forEach(function(qe,Ce){at.set(Oe.next[ot],"["+Ce+"]",qe)}):at.set(Ot.next,"."+ot,Me)}),Ii(Oe,at,_e,!0,!0),[ru,Iu,Gu,Gs,mu].forEach(function(ot){var St=_e.draw[ot];!St||at.set(Ot.draw,"."+ot,""+St.append(Oe,at))}),Object.keys(_e.uniforms).forEach(function(ot){var St=_e.uniforms[ot].append(Oe,at);Array.isArray(St)&&(St="["+St.join()+"]"),at.set(Ot.uniforms,"["+Se.id(ot)+"]",St)}),Object.keys(_e.attributes).forEach(function(ot){var St=_e.attributes[ot].append(Oe,at),Me=Oe.scopeAttrib(ot);Object.keys(new zt).forEach(function(qe){at.set(Me,"."+qe,St[qe])})}),_e.scopeVAO&&at.set(Ot.vao,".targetVAO",_e.scopeVAO.append(Oe,at));function ft(ot){var St=_e.shader[ot];St&&at.set(Ot.shader,"."+ot,St.append(Oe,at))}ft(go),ft(Mu),Object.keys(_e.state).length>0&&(at(kt,".dirty=true;"),at.exit(kt,".dirty=true;")),at("a1(",Oe.shared.context,",a0,",Oe.batchId,");")}function Wt(Oe){if(!(typeof Oe!="object"||eo(Oe))){for(var _e=Object.keys(Oe),at=0;at<_e.length;++at)if(ut.isDynamic(Oe[_e[at]]))return!0;return!1}}function An(Oe,_e,at){var Ot=_e.static[at];if(!Ot||!Wt(Ot))return;var kt=Oe.global,ft=Object.keys(Ot),ot=!1,St=!1,Me=!1,qe=Oe.global.def("{}");ft.forEach(function(At){var Bt=Ot[At];if(ut.isDynamic(Bt)){typeof Bt=="function"&&(Bt=Ot[At]=ut.unbox(Bt));var Sr=Lu(Bt,null);ot=ot||Sr.thisDep,Me=Me||Sr.propDep,St=St||Sr.contextDep}else{switch(kt(qe,".",At,"="),typeof Bt){case"number":kt(Bt);break;case"string":kt('"',Bt,'"');break;case"object":Array.isArray(Bt)&&kt("[",Bt.join(),"]");break;default:kt(Oe.link(Bt));break}kt(";")}});function Ce(At,Bt){ft.forEach(function(Sr){var Kt=Ot[Sr];if(!!ut.isDynamic(Kt)){var br=At.invoke(Bt,Kt);Bt(qe,".",Sr,"=",br,";")}})}_e.dynamic[at]=new ut.DynamicVariable(Si,{thisDep:ot,contextDep:St,propDep:Me,ref:qe,append:Ce}),delete _e.static[at]}function Vi(Oe,_e,at,Ot,kt){var ft=ui();ft.stats=ft.link(kt),Object.keys(_e.static).forEach(function(St){An(ft,_e,St)}),vh.forEach(function(St){An(ft,Oe,St)});var ot=wo(Oe,_e,at,Ot,ft);return Io(ft,ot),er(ft,ot),Fe(ft,ot),x(ft.compile(),{destroy:function(){ot.shader.program.destroy()}})}return{next:En,current:Dr,procs:function(){var Oe=ui(),_e=Oe.proc("poll"),at=Oe.proc("refresh"),Ot=Oe.block();_e(Ot),at(Ot);var kt=Oe.shared,ft=kt.gl,ot=kt.next,St=kt.current;Ot(St,".dirty=false;"),es(Oe,_e),es(Oe,at,null,!0);var Me;Gr&&(Me=Oe.link(Gr)),ke.oes_vertex_array_object&&at(Oe.link(ke.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var qe=0;qe<qt.maxAttributes;++qe){var Ce=at.def(kt.attributes,"[",qe,"]"),At=Oe.cond(Ce,".buffer");At.then(ft,".enableVertexAttribArray(",qe,");",ft,".bindBuffer(",ic,",",Ce,".buffer.buffer);",ft,".vertexAttribPointer(",qe,",",Ce,".size,",Ce,".type,",Ce,".normalized,",Ce,".stride,",Ce,".offset);").else(ft,".disableVertexAttribArray(",qe,");",ft,".vertexAttrib4f(",qe,",",Ce,".x,",Ce,".y,",Ce,".z,",Ce,".w);",Ce,".buffer=null;"),at(At),Gr&&at(Me,".vertexAttribDivisorANGLE(",qe,",",Ce,".divisor);")}return at(Oe.shared.vao,".currentVAO=null;",Oe.shared.vao,".setVAO(",Oe.shared.vao,".targetVAO);"),Object.keys(sn).forEach(function(Bt){var Sr=sn[Bt],Kt=Ot.def(ot,".",Bt),br=Oe.block();br("if(",Kt,"){",ft,".enable(",Sr,")}else{",ft,".disable(",Sr,")}",St,".",Bt,"=",Kt,";"),at(br),_e("if(",Kt,"!==",St,".",Bt,"){",br,"}")}),Object.keys(Rr).forEach(function(Bt){var Sr=Rr[Bt],Kt=Dr[Bt],br,Xr,Fn=Oe.block();if(Fn(ft,".",Sr,"("),eo(Kt)){var Oi=Kt.length;br=Oe.global.def(ot,".",Bt),Xr=Oe.global.def(St,".",Bt),Fn(I(Oi,function(zn){return br+"["+zn+"]"}),");",I(Oi,function(zn){return Xr+"["+zn+"]="+br+"["+zn+"];"}).join("")),_e("if(",I(Oi,function(zn){return br+"["+zn+"]!=="+Xr+"["+zn+"]"}).join("||"),"){",Fn,"}")}else br=Ot.def(ot,".",Bt),Xr=Ot.def(St,".",Bt),Fn(br,");",St,".",Bt,"=",br,";"),_e("if(",br,"!==",Xr,"){",Fn,"}");at(Fn)}),Oe.compile()}(),compile:Vi}}function mp(){return{vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}}var jh=34918,au=34919,yh=35007,Zh=function(j,Se){if(!Se.ext_disjoint_timer_query)return null;var ke=[];function qt(){return ke.pop()||Se.ext_disjoint_timer_query.createQueryEXT()}function wr(Gr){ke.push(Gr)}var Yt=[];function pr(Gr){var mn=qt();Se.ext_disjoint_timer_query.beginQueryEXT(yh,mn),Yt.push(mn),Vr(Yt.length-1,Yt.length,Gr)}function Zr(){Se.ext_disjoint_timer_query.endQueryEXT(yh)}function Wr(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null}var en=[];function Kr(){return en.pop()||new Wr}function an(Gr){en.push(Gr)}var fn=[];function Vr(Gr,mn,Dr){var En=Kr();En.startQueryIndex=Gr,En.endQueryIndex=mn,En.sum=0,En.stats=Dr,fn.push(En)}var on=[],zt=[];function fr(){var Gr,mn,Dr=Yt.length;if(Dr!==0){zt.length=Math.max(zt.length,Dr+1),on.length=Math.max(on.length,Dr+1),on[0]=0,zt[0]=0;var En=0;for(Gr=0,mn=0;mn<Yt.length;++mn){var zr=Yt[mn];Se.ext_disjoint_timer_query.getQueryObjectEXT(zr,au)?(En+=Se.ext_disjoint_timer_query.getQueryObjectEXT(zr,jh),wr(zr)):Yt[Gr++]=zr,on[mn+1]=En,zt[mn+1]=Gr}for(Yt.length=Gr,Gr=0,mn=0;mn<fn.length;++mn){var sn=fn[mn],Rr=sn.startQueryIndex,nn=sn.endQueryIndex;sn.sum+=on[nn]-on[Rr];var Kn=zt[Rr],Yn=zt[nn];Yn===Kn?(sn.stats.gpuTime+=sn.sum/1e6,an(sn)):(sn.startQueryIndex=Kn,sn.endQueryIndex=Yn,fn[Gr++]=sn)}fn.length=Gr}}return{beginQuery:pr,endQuery:Zr,pushScopeStats:Vr,update:fr,getNumPendingQueries:function(){return Yt.length},clear:function(){ke.push.apply(ke,Yt);for(var Gr=0;Gr<ke.length;Gr++)Se.ext_disjoint_timer_query.deleteQueryEXT(ke[Gr]);Yt.length=0,ke.length=0},restore:function(){Yt.length=0,ke.length=0}}},_h=16384,xh=256,Vh=1024,gp=34962,Gh="webglcontextlost",Hh="webglcontextrestored",bh=1,yp=2,Sf=3;function Ef(j,Se){for(var ke=0;ke<j.length;++ke)if(j[ke]===Se)return ke;return-1}function Wh(j){var Se=si(j);if(!Se)return null;var ke=Se.gl,qt=ke.getContextAttributes(),wr=ke.isContextLost(),Yt=G(ke,Se);if(!Yt)return null;var pr=gr(),Zr=mp(),Wr=Yt.extensions,en=Zh(ke,Wr),Kr=Qt(),an=ke.drawingBufferWidth,fn=ke.drawingBufferHeight,Vr={tick:0,time:0,viewportWidth:an,viewportHeight:fn,framebufferWidth:an,framebufferHeight:fn,drawingBufferWidth:an,drawingBufferHeight:fn,pixelRatio:Se.pixelRatio},on={},zt={elements:null,primitive:4,count:-1,offset:0,instances:-1},fr=qa(ke,Wr),Gr=Gi(ke,Zr,Se,Dr),mn=ye(ke,Wr,fr,Zr,Gr);function Dr($n){return mn.destroyBuffer($n)}var En=gf(ke,Wr,Gr,Zr),zr=ze(ke,pr,Zr,Se),sn=Zu(ke,Wr,fr,function(){Kn.procs.poll()},Vr,Zr,Se),Rr=hu(ke,Wr,fr,Zr,Se),nn=R(ke,Wr,fr,sn,Rr,Zr),Kn=vp(ke,pr,Wr,fr,Gr,En,sn,nn,on,mn,zr,zt,Vr,en,Se),Yn=rr(ke,nn,Kn.procs.poll,Vr,qt,Wr,fr),un=Kn.next,kr=ke.canvas,Or=[],ui=[],qn=[],Ln=[Se.onDestroy],Bi=null;function Ai(){if(Or.length===0){en&&en.update(),Bi=null;return}Bi=It.next(Ai),ks();for(var $n=Or.length-1;$n>=0;--$n){var Hi=Or[$n];Hi&&Hi(Vr,null,0)}ke.flush(),en&&en.update()}function Mi(){!Bi&&Or.length>0&&(Bi=It.next(Ai))}function na(){Bi&&(It.cancel(Ai),Bi=null)}function Qo($n){$n.preventDefault(),wr=!0,na(),ui.forEach(function(Hi){Hi()})}function Rs($n){ke.getError(),wr=!1,Yt.restore(),zr.restore(),Gr.restore(),sn.restore(),Rr.restore(),nn.restore(),mn.restore(),en&&en.restore(),Kn.procs.refresh(),Mi(),qn.forEach(function(Hi){Hi()})}kr&&(kr.addEventListener(Gh,Qo,!1),kr.addEventListener(Hh,Rs,!1));function Qi(){Or.length=0,na(),kr&&(kr.removeEventListener(Gh,Qo),kr.removeEventListener(Hh,Rs)),zr.clear(),nn.clear(),Rr.clear(),sn.clear(),En.clear(),Gr.clear(),mn.clear(),en&&en.clear(),Ln.forEach(function($n){$n()})}function Eo($n){H(!!$n,"invalid args to regl({...})"),H.type($n,"object","invalid args to regl({...})");function Hi(kt){var ft=x({},kt);delete ft.uniforms,delete ft.attributes,delete ft.context,delete ft.vao,"stencil"in ft&&ft.stencil.op&&(ft.stencil.opBack=ft.stencil.opFront=ft.stencil.op,delete ft.stencil.op);function ot(St){if(St in ft){var Me=ft[St];delete ft[St],Object.keys(Me).forEach(function(qe){ft[St+"."+qe]=Me[qe]})}}return ot("blend"),ot("depth"),ot("cull"),ot("stencil"),ot("polygonOffset"),ot("scissor"),ot("sample"),"vao"in kt&&(ft.vao=kt.vao),ft}function ia(kt,ft){var ot={},St={};return Object.keys(kt).forEach(function(Me){var qe=kt[Me];if(ut.isDynamic(qe)){St[Me]=ut.unbox(qe,Me);return}else if(ft&&Array.isArray(qe)){for(var Ce=0;Ce<qe.length;++Ce)if(ut.isDynamic(qe[Ce])){St[Me]=ut.unbox(qe,Me);return}}ot[Me]=qe}),{dynamic:St,static:ot}}var Io=ia($n.context||{},!0),yu=ia($n.uniforms||{},!0),_u=ia($n.attributes||{},!1),Fe=ia(Hi($n),!1),er={gpuTime:0,cpuTime:0,count:0},Wt=Kn.compile(Fe,_u,yu,Io,er),An=Wt.draw,Vi=Wt.batch,Oe=Wt.scope,_e=[];function at(kt){for(;_e.length<kt;)_e.push(null);return _e}function Ot(kt,ft){var ot;if(wr&&H.raise("context lost"),typeof kt=="function")return Oe.call(this,null,kt,0);if(typeof ft=="function")if(typeof kt=="number")for(ot=0;ot<kt;++ot)Oe.call(this,null,ft,ot);else if(Array.isArray(kt))for(ot=0;ot<kt.length;++ot)Oe.call(this,kt[ot],ft,ot);else return Oe.call(this,kt,ft,0);else if(typeof kt=="number"){if(kt>0)return Vi.call(this,at(kt|0),kt|0)}else if(Array.isArray(kt)){if(kt.length)return Vi.call(this,kt,kt.length)}else return An.call(this,kt)}return x(Ot,{stats:er,destroy:function(){Wt.destroy()}})}var ua=nn.setFBO=Eo({framebuffer:ut.define.call(null,bh,"framebuffer")});function wo($n,Hi){var ia=0;Kn.procs.poll();var Io=Hi.color;Io&&(ke.clearColor(+Io[0]||0,+Io[1]||0,+Io[2]||0,+Io[3]||0),ia|=_h),"depth"in Hi&&(ke.clearDepth(+Hi.depth),ia|=xh),"stencil"in Hi&&(ke.clearStencil(Hi.stencil|0),ia|=Vh),H(!!ia,"called regl.clear with no buffer specified"),ke.clear(ia)}function qo($n){if(H(typeof $n=="object"&&$n,"regl.clear() takes an object as input"),"framebuffer"in $n)if($n.framebuffer&&$n.framebuffer_reglType==="framebufferCube")for(var Hi=0;Hi<6;++Hi)ua(x({framebuffer:$n.framebuffer.faces[Hi]},$n),wo);else ua($n,wo);else wo(null,$n)}function es($n){H.type($n,"function","regl.frame() callback must be a function"),Or.push($n);function Hi(){var ia=Ef(Or,$n);H(ia>=0,"cannot cancel a frame twice");function Io(){var yu=Ef(Or,Io);Or[yu]=Or[Or.length-1],Or.length-=1,Or.length<=0&&na()}Or[ia]=Io}return Mi(),{cancel:Hi}}function Ds(){var $n=un.viewport,Hi=un.scissor_box;$n[0]=$n[1]=Hi[0]=Hi[1]=0,Vr.viewportWidth=Vr.framebufferWidth=Vr.drawingBufferWidth=$n[2]=Hi[2]=ke.drawingBufferWidth,Vr.viewportHeight=Vr.framebufferHeight=Vr.drawingBufferHeight=$n[3]=Hi[3]=ke.drawingBufferHeight}function ks(){Vr.tick+=1,Vr.time=Ii(),Ds(),Kn.procs.poll()}function Zo(){sn.refresh(),Ds(),Kn.procs.refresh(),en&&en.update()}function Ii(){return(Qt()-Kr)/1e3}Zo();function Fs($n,Hi){H.type(Hi,"function","listener callback must be a function");var ia;switch($n){case"frame":return es(Hi);case"lost":ia=ui;break;case"restore":ia=qn;break;case"destroy":ia=Ln;break;default:H.raise("invalid event, must be one of frame,lost,restore,destroy")}return ia.push(Hi),{cancel:function(){for(var Io=0;Io<ia.length;++Io)if(ia[Io]===Hi){ia[Io]=ia[ia.length-1],ia.pop();return}}}}var la=x(Eo,{clear:qo,prop:ut.define.bind(null,bh),context:ut.define.bind(null,yp),this:ut.define.bind(null,Sf),draw:Eo({}),buffer:function($n){return Gr.create($n,gp,!1,!1)},elements:function($n){return En.create($n,!1)},texture:sn.create2D,cube:sn.createCube,renderbuffer:Rr.create,framebuffer:nn.create,framebufferCube:nn.createCube,vao:mn.createVAO,attributes:qt,frame:es,on:Fs,limits:fr,hasExtension:function($n){return fr.extensions.indexOf($n.toLowerCase())>=0},read:Yn,destroy:Qi,_gl:ke,_refresh:Zo,poll:function(){ks(),en&&en.update()},now:Ii,stats:Zr});return Se.onDone(null,la),la}return Wh})},69848:function(ur){(function(L,x){ur.exports=x()})(this,function(){"use strict";function L(gt,Ye,Et,Ne,Ae,Be){if(!(Ae-Ne<=Et)){var bt=Ne+Ae>>1;x(gt,Ye,bt,Ne,Ae,Be%2),L(gt,Ye,Et,Ne,bt-1,Be+1),L(gt,Ye,Et,bt+1,Ae,Be+1)}}function x(gt,Ye,Et,Ne,Ae,Be){for(;Ae>Ne;){if(Ae-Ne>600){var bt=Ae-Ne+1,ir=Et-Ne+1,re=Math.log(bt),Ee=.5*Math.exp(2*re/3),ae=.5*Math.sqrt(re*Ee*(bt-Ee)/bt)*(ir-bt/2<0?-1:1),me=Math.max(Ne,Math.floor(Et-ir*Ee/bt+ae)),Te=Math.min(Ae,Math.floor(Et+(bt-ir)*Ee/bt+ae));x(gt,Ye,Et,me,Te,Be)}var Qe=Ye[2*Et+Be],dt=Ne,Jt=Ae;for(J(gt,Ye,Ne,Et),Ye[2*Ae+Be]>Qe&&J(gt,Ye,Ne,Ae);dt<Jt;){for(J(gt,Ye,dt,Jt),dt++,Jt--;Ye[2*dt+Be]<Qe;)dt++;for(;Ye[2*Jt+Be]>Qe;)Jt--}Ye[2*Ne+Be]===Qe?J(gt,Ye,Ne,Jt):(Jt++,J(gt,Ye,Jt,Ae)),Jt<=Et&&(Ne=Jt+1),Et<=Jt&&(Ae=Jt-1)}}function J(gt,Ye,Et,Ne){E(gt,Et,Ne),E(Ye,2*Et,2*Ne),E(Ye,2*Et+1,2*Ne+1)}function E(gt,Ye,Et){var Ne=gt[Ye];gt[Ye]=gt[Et],gt[Et]=Ne}function p(gt,Ye,Et,Ne,Ae,Be,bt){for(var ir=[0,gt.length-1,0],re=[],Ee,ae;ir.length;){var me=ir.pop(),Te=ir.pop(),Qe=ir.pop();if(Te-Qe<=bt){for(var dt=Qe;dt<=Te;dt++)Ee=Ye[2*dt],ae=Ye[2*dt+1],Ee>=Et&&Ee<=Ae&&ae>=Ne&&ae<=Be&&re.push(gt[dt]);continue}var Jt=Math.floor((Qe+Te)/2);Ee=Ye[2*Jt],ae=Ye[2*Jt+1],Ee>=Et&&Ee<=Ae&&ae>=Ne&&ae<=Be&&re.push(gt[Jt]);var Nr=(me+1)%2;(me===0?Et<=Ee:Ne<=ae)&&(ir.push(Qe),ir.push(Jt-1),ir.push(Nr)),(me===0?Ae>=Ee:Be>=ae)&&(ir.push(Jt+1),ir.push(Te),ir.push(Nr))}return re}function w(gt,Ye,Et,Ne,Ae,Be){for(var bt=[0,gt.length-1,0],ir=[],re=Ae*Ae;bt.length;){var Ee=bt.pop(),ae=bt.pop(),me=bt.pop();if(ae-me<=Be){for(var Te=me;Te<=ae;Te++)F(Ye[2*Te],Ye[2*Te+1],Et,Ne)<=re&&ir.push(gt[Te]);continue}var Qe=Math.floor((me+ae)/2),dt=Ye[2*Qe],Jt=Ye[2*Qe+1];F(dt,Jt,Et,Ne)<=re&&ir.push(gt[Qe]);var Nr=(Ee+1)%2;(Ee===0?Et-Ae<=dt:Ne-Ae<=Jt)&&(bt.push(me),bt.push(Qe-1),bt.push(Nr)),(Ee===0?Et+Ae>=dt:Ne+Ae>=Jt)&&(bt.push(Qe+1),bt.push(ae),bt.push(Nr))}return ir}function F(gt,Ye,Et,Ne){var Ae=gt-Et,Be=Ye-Ne;return Ae*Ae+Be*Be}var Q=function(gt){return gt[0]},Y=function(gt){return gt[1]},le=function(Ye,Et,Ne,Ae,Be){Et===void 0&&(Et=Q),Ne===void 0&&(Ne=Y),Ae===void 0&&(Ae=64),Be===void 0&&(Be=Float64Array),this.nodeSize=Ae,this.points=Ye;for(var bt=Ye.length<65536?Uint16Array:Uint32Array,ir=this.ids=new bt(Ye.length),re=this.coords=new Be(Ye.length*2),Ee=0;Ee<Ye.length;Ee++)ir[Ee]=Ee,re[2*Ee]=Et(Ye[Ee]),re[2*Ee+1]=Ne(Ye[Ee]);L(ir,re,Ae,0,ir.length-1,0)};le.prototype.range=function(Ye,Et,Ne,Ae){return p(this.ids,this.coords,Ye,Et,Ne,Ae,this.nodeSize)},le.prototype.within=function(Ye,Et,Ne){return w(this.ids,this.coords,Ye,Et,Ne,this.nodeSize)};var ne={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(gt){return gt}},be=Math.fround||function(gt){return function(Ye){return gt[0]=+Ye,gt[0]}}(new Float32Array(1)),we=function(Ye){this.options=Cr(Object.create(ne),Ye),this.trees=new Array(this.options.maxZoom+1)};we.prototype.load=function(Ye){var Et=this.options,Ne=Et.log,Ae=Et.minZoom,Be=Et.maxZoom,bt=Et.nodeSize;Ne&&console.time("total time");var ir="prepare "+Ye.length+" points";Ne&&console.time(ir),this.points=Ye;for(var re=[],Ee=0;Ee<Ye.length;Ee++)!Ye[Ee].geometry||re.push($t(Ye[Ee],Ee));this.trees[Be+1]=new le(re,Gt,ar,bt,Float32Array),Ne&&console.timeEnd(ir);for(var ae=Be;ae>=Ae;ae--){var me=+Date.now();re=this._cluster(re,ae),this.trees[ae]=new le(re,Gt,ar,bt,Float32Array),Ne&&console.log("z%d: %d clusters in %dms",ae,re.length,+Date.now()-me)}return Ne&&console.timeEnd("total time"),this},we.prototype.getClusters=function(Ye,Et){var Ne=((Ye[0]+180)%360+360)%360-180,Ae=Math.max(-90,Math.min(90,Ye[1])),Be=Ye[2]===180?180:((Ye[2]+180)%360+360)%360-180,bt=Math.max(-90,Math.min(90,Ye[3]));if(Ye[2]-Ye[0]>=360)Ne=-180,Be=180;else if(Ne>Be){var ir=this.getClusters([Ne,Ae,180,bt],Et),re=this.getClusters([-180,Ae,Be,bt],Et);return ir.concat(re)}for(var Ee=this.trees[this._limitZoom(Et)],ae=Ee.range(Ft(Ne),Lt(bt),Ft(Be),Lt(Ae)),me=[],Te=0,Qe=ae;Te<Qe.length;Te+=1){var dt=Qe[Te],Jt=Ee.points[dt];me.push(Jt.numPoints?Zt(Jt):this.points[Jt.index])}return me},we.prototype.getChildren=function(Ye){var Et=this._getOriginId(Ye),Ne=this._getOriginZoom(Ye),Ae="No cluster with the specified id.",Be=this.trees[Ne];if(!Be)throw new Error(Ae);var bt=Be.points[Et];if(!bt)throw new Error(Ae);for(var ir=this.options.radius/(this.options.extent*Math.pow(2,Ne-1)),re=Be.within(bt.x,bt.y,ir),Ee=[],ae=0,me=re;ae<me.length;ae+=1){var Te=me[ae],Qe=Be.points[Te];Qe.parentId===Ye&&Ee.push(Qe.numPoints?Zt(Qe):this.points[Qe.index])}if(Ee.length===0)throw new Error(Ae);return Ee},we.prototype.getLeaves=function(Ye,Et,Ne){Et=Et||10,Ne=Ne||0;var Ae=[];return this._appendLeaves(Ae,Ye,Et,Ne,0),Ae},we.prototype.getTile=function(Ye,Et,Ne){var Ae=this.trees[this._limitZoom(Ye)],Be=Math.pow(2,Ye),bt=this.options,ir=bt.extent,re=bt.radius,Ee=re/ir,ae=(Ne-Ee)/Be,me=(Ne+1+Ee)/Be,Te={features:[]};return this._addTileFeatures(Ae.range((Et-Ee)/Be,ae,(Et+1+Ee)/Be,me),Ae.points,Et,Ne,Be,Te),Et===0&&this._addTileFeatures(Ae.range(1-Ee/Be,ae,1,me),Ae.points,Be,Ne,Be,Te),Et===Be-1&&this._addTileFeatures(Ae.range(0,ae,Ee/Be,me),Ae.points,-1,Ne,Be,Te),Te.features.length?Te:null},we.prototype.getClusterExpansionZoom=function(Ye){for(var Et=this._getOriginZoom(Ye)-1;Et<=this.options.maxZoom;){var Ne=this.getChildren(Ye);if(Et++,Ne.length!==1)break;Ye=Ne[0].properties.cluster_id}return Et},we.prototype._appendLeaves=function(Ye,Et,Ne,Ae,Be){for(var bt=this.getChildren(Et),ir=0,re=bt;ir<re.length;ir+=1){var Ee=re[ir],ae=Ee.properties;if(ae&&ae.cluster?Be+ae.point_count<=Ae?Be+=ae.point_count:Be=this._appendLeaves(Ye,ae.cluster_id,Ne,Ae,Be):Be<Ae?Be++:Ye.push(Ee),Ye.length===Ne)break}return Be},we.prototype._addTileFeatures=function(Ye,Et,Ne,Ae,Be,bt){for(var ir=0,re=Ye;ir<re.length;ir+=1){var Ee=re[ir],ae=Et[Ee],me=ae.numPoints,Te=void 0,Qe=void 0,dt=void 0;if(me)Te=Xt(ae),Qe=ae.x,dt=ae.y;else{var Jt=this.points[ae.index];Te=Jt.properties,Qe=Ft(Jt.geometry.coordinates[0]),dt=Lt(Jt.geometry.coordinates[1])}var Nr={type:1,geometry:[[Math.round(this.options.extent*(Qe*Be-Ne)),Math.round(this.options.extent*(dt*Be-Ae))]],tags:Te},Fr=void 0;me?Fr=ae.id:this.options.generateId?Fr=ae.index:this.points[ae.index].id&&(Fr=this.points[ae.index].id),Fr!==void 0&&(Nr.id=Fr),bt.features.push(Nr)}},we.prototype._limitZoom=function(Ye){return Math.max(this.options.minZoom,Math.min(+Ye,this.options.maxZoom+1))},we.prototype._cluster=function(Ye,Et){for(var Ne=[],Ae=this.options,Be=Ae.radius,bt=Ae.extent,ir=Ae.reduce,re=Ae.minPoints,Ee=Be/(bt*Math.pow(2,Et)),ae=0;ae<Ye.length;ae++){var me=Ye[ae];if(!(me.zoom<=Et)){me.zoom=Et;for(var Te=this.trees[Et+1],Qe=Te.within(me.x,me.y,Ee),dt=me.numPoints||1,Jt=dt,Nr=0,Fr=Qe;Nr<Fr.length;Nr+=1){var ln=Fr[Nr],tr=Te.points[ln];tr.zoom>Et&&(Jt+=tr.numPoints||1)}if(Jt>=re){for(var se=me.x*dt,ge=me.y*dt,Re=ir&&dt>1?this._map(me,!0):null,tt=(ae<<5)+(Et+1)+this.points.length,Mt=0,Dt=Qe;Mt<Dt.length;Mt+=1){var S=Dt[Mt],z=Te.points[S];if(!(z.zoom<=Et)){z.zoom=Et;var pe=z.numPoints||1;se+=z.x*pe,ge+=z.y*pe,z.parentId=tt,ir&&(Re||(Re=this._map(me,!0)),ir(Re,this._map(z)))}}me.parentId=tt,Ne.push(Ie(se/Jt,ge/Jt,tt,Jt,Re))}else if(Ne.push(me),Jt>1)for(var Ue=0,Je=Qe;Ue<Je.length;Ue+=1){var mt=Je[Ue],Ct=Te.points[mt];Ct.zoom<=Et||(Ct.zoom=Et,Ne.push(Ct))}}}return Ne},we.prototype._getOriginId=function(Ye){return Ye-this.points.length>>5},we.prototype._getOriginZoom=function(Ye){return(Ye-this.points.length)%32},we.prototype._map=function(Ye,Et){if(Ye.numPoints)return Et?Cr({},Ye.properties):Ye.properties;var Ne=this.points[Ye.index].properties,Ae=this.options.map(Ne);return Et&&Ae===Ne?Cr({},Ae):Ae};function Ie(gt,Ye,Et,Ne,Ae){return{x:be(gt),y:be(Ye),zoom:Infinity,id:Et,parentId:-1,numPoints:Ne,properties:Ae}}function $t(gt,Ye){var Et=gt.geometry.coordinates,Ne=Et[0],Ae=Et[1];return{x:be(Ft(Ne)),y:be(Lt(Ae)),zoom:Infinity,index:Ye,parentId:-1}}function Zt(gt){return{type:"Feature",id:gt.id,properties:Xt(gt),geometry:{type:"Point",coordinates:[_t(gt.x),pt(gt.y)]}}}function Xt(gt){var Ye=gt.numPoints,Et=Ye>=1e4?Math.round(Ye/1e3)+"k":Ye>=1e3?Math.round(Ye/100)/10+"k":Ye;return Cr(Cr({},gt.properties),{cluster:!0,cluster_id:gt.id,point_count:Ye,point_count_abbreviated:Et})}function Ft(gt){return gt/360+.5}function Lt(gt){var Ye=Math.sin(gt*Math.PI/180),Et=.5-.25*Math.log((1+Ye)/(1-Ye))/Math.PI;return Et<0?0:Et>1?1:Et}function _t(gt){return(gt-.5)*360}function pt(gt){var Ye=(180-gt*360)*Math.PI/180;return 360*Math.atan(Math.exp(Ye))/Math.PI-90}function Cr(gt,Ye){for(var Et in Ye)gt[Et]=Ye[Et];return gt}function Gt(gt){return gt.x}function ar(gt){return gt.y}return we})},75752:function(ur){ur.exports.RADIUS=6378137,ur.exports.FLATTENING=1/298.257223563,ur.exports.POLAR_RADIUS=63567523142e-4}}]);
